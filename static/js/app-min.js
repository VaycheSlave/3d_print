(()=>{var gz=Object.create;var xc=Object.defineProperty,vz=Object.defineProperties,_z=Object.getOwnPropertyDescriptor,yz=Object.getOwnPropertyDescriptors,xz=Object.getOwnPropertyNames,hT=Object.getOwnPropertySymbols,bz=Object.getPrototypeOf,uT=Object.prototype.hasOwnProperty,wz=Object.prototype.propertyIsEnumerable;var _y=(t,e,i)=>e in t?xc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Wt=(t,e)=>{for(var i in e||(e={}))uT.call(e,i)&&_y(t,i,e[i]);if(hT)for(var i of hT(e))wz.call(e,i)&&_y(t,i,e[i]);return t},Ro=(t,e)=>vz(t,yz(e));var _m=(t,e)=>()=>(t&&(e=t(t=0)),e);var ae=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),yy=(t,e)=>{for(var i in e)xc(t,i,{get:e[i],enumerable:!0})},cT=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of xz(e))!uT.call(t,n)&&n!==i&&xc(t,n,{get:()=>e[n],enumerable:!(r=_z(e,n))||r.enumerable});return t};var Qi=(t,e,i)=>(i=t!=null?gz(bz(t)):{},cT(e||!t||!t.__esModule?xc(i,"default",{value:t,enumerable:!0}):i,t)),fT=t=>cT(xc({},"__esModule",{value:!0}),t);var xs=(t,e,i)=>(_y(t,typeof e!="symbol"?e+"":e,i),i);function xD(t,e,i,r){switch(t){case-2:return i<e;case-1:return r>=e&&i<e;case 0:return i<e&&r>e;case 1:return i<=e&&r>e;case 2:return r>e;case 4:return!0}}function bD(t,e){let i=t.childBefore(e);for(;i;){let r=i.lastChild;if(!r||r.to!=i.to)break;r.type.isError&&r.from==r.to?(t=i,i=r.prevSibling):i=r}return t}function au(t,e,i,r){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let a=!r&&t instanceof Rs&&t.index<0?null:t.parent;if(!a)return t;t=a}let o=r?0:cr.IgnoreOverlays;if(r)for(let a=t,l=a.parent;l;a=l,l=a.parent)a instanceof Rs&&a.index<0&&((n=l.enter(e,i,o))===null||n===void 0?void 0:n.from)!=a.from&&(t=l);for(;;){let a=t.enter(e,i,o);if(!a)return t;t=a}}function iv(t,e,i,r){let n=t.cursor(),o=[];if(!n.firstChild())return o;if(i!=null){for(;!n.type.is(i);)if(!n.nextSibling())return o}for(;;){if(r!=null&&n.type.is(r))return o;if(n.type.is(e)&&o.push(n.node),!n.nextSibling())return r==null?o:[]}}function rv(t,e,i=e.length-1){for(let r=t.parent;i>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[i]&&e[i]!=r.name)return!1;i--}}return!0}function Jb(t){return t.children.some(e=>e instanceof Qo||!e.type.isAnonymous||Jb(e))}function vW(t){var e;let{buffer:i,nodeSet:r,maxBufferLength:n=1024,reused:o=[],minRepeatType:a=r.types.length}=t,l=Array.isArray(i)?new _f(i,i.length):i,h=r.types,u=0,c=0;function f(y,w,S,R,E){let{id:T,start:A,end:C,size:M}=l,D=c;for(;M<0;)if(l.next(),M==-1){let k=o[T];S.push(k),R.push(A-y);return}else if(M==-3){u=T;return}else if(M==-4){c=T;return}else throw new RangeError(`Unrecognized record size: ${M}`);let O=h[T],P,L,I=A-y;if(C-A<=n&&(L=g(l.pos-w,E))){let k=new Uint16Array(L.size-L.skip),B=l.pos-L.size,F=k.length;for(;l.pos>B;)F=p(L.start,k,F);P=new Qo(k,C-L.start,r),I=L.start-y}else{let k=l.pos-M;l.next();let B=[],F=[],W=T>=a?T:-1,V=0,N=C;for(;l.pos>k;)W>=0&&l.id==W&&l.size>=0?(l.end<=N-n&&(m(B,F,A,V,l.end,N,W,D),V=B.length,N=l.end),l.next()):f(A,k,B,F,W);if(W>=0&&V>0&&V<B.length&&m(B,F,A,V,A,N,W,D),B.reverse(),F.reverse(),W>-1&&V>0){let ne=d(O);P=$b(O,B,F,0,B.length,0,C-A,ne,ne)}else P=v(O,B,F,C-A,D-C)}S.push(P),R.push(I)}function d(y){return(w,S,R)=>{let E=0,T=w.length-1,A,C;if(T>=0&&(A=w[T])instanceof Xi){if(!T&&A.type==y&&A.length==R)return A;(C=A.prop(It.lookAhead))&&(E=S[T]+A.length+C)}return v(y,w,S,R,E)}}function m(y,w,S,R,E,T,A,C){let M=[],D=[];for(;y.length>R;)M.push(y.pop()),D.push(w.pop()+S-E);y.push(v(r.types[A],M,D,T-E,C-T)),w.push(E-S)}function v(y,w,S,R,E=0,T){if(u){let A=[It.contextHash,u];T=T?[A].concat(T):[A]}if(E>25){let A=[It.lookAhead,E];T=T?[A].concat(T):[A]}return new Xi(y,w,S,R,T)}function g(y,w){let S=l.fork(),R=0,E=0,T=0,A=S.end-n,C={size:0,start:0,skip:0};e:for(let M=S.pos-y;S.pos>M;){let D=S.size;if(S.id==w&&D>=0){C.size=R,C.start=E,C.skip=T,T+=4,R+=4,S.next();continue}let O=S.pos-D;if(D<0||O<M||S.start<A)break;let P=S.id>=a?4:0,L=S.start;for(S.next();S.pos>O;){if(S.size<0)if(S.size==-3)P+=4;else break e;else S.id>=a&&(P+=4);S.next()}E=L,R+=D,T+=P}return(w<0||R==y)&&(C.size=R,C.start=E,C.skip=T),C.size>4?C:void 0}function p(y,w,S){let{id:R,start:E,end:T,size:A}=l;if(l.next(),A>=0&&R<a){let C=S;if(A>4){let M=l.pos-(A-4);for(;l.pos>M;)S=p(y,w,S)}w[--S]=C,w[--S]=T-y,w[--S]=E-y,w[--S]=R}else A==-3?u=R:A==-4&&(c=R);return S}let _=[],x=[];for(;l.pos>0;)f(t.start||0,t.bufferStart||0,_,x,-1);let b=(e=t.length)!==null&&e!==void 0?e:_.length?x[0]+_[0].length:0;return new Xi(h[t.topID],_.reverse(),x.reverse(),b)}function tv(t,e){if(!t.isAnonymous||e instanceof Qo||e.type!=t)return 1;let i=yD.get(e);if(i==null){i=1;for(let r of e.children){if(r.type!=t||!(r instanceof Xi)){i=1;break}i+=tv(t,r)}yD.set(e,i)}return i}function $b(t,e,i,r,n,o,a,l,h){let u=0;for(let v=r;v<n;v++)u+=tv(t,e[v]);let c=Math.ceil(u*1.5/8),f=[],d=[];function m(v,g,p,_,x){for(let b=p;b<_;){let y=b,w=g[b],S=tv(t,v[b]);for(b++;b<_;b++){let R=tv(t,v[b]);if(S+R>=c)break;S+=R}if(b==y+1){if(S>c){let R=v[y];m(R.children,R.positions,0,R.children.length,g[y]+x);continue}f.push(v[y])}else{let R=g[b-1]+v[b-1].length-w;f.push($b(t,v,g,y,b,w,R,null,h))}d.push(w+x-o)}}return m(e,i,r,n,0),(l||h)(f,d,a)}var mW,vf,It,gW,kr,ev,_D,cr,Xi,_f,Qo,Rs,Kb,po,lu,yD,mo,yf,Qb,dwe,xf=_m(()=>{mW=0,vf=class{constructor(e,i){this.from=e,this.to=i}},It=class{constructor(e={}){this.id=mW++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=kr.match(e)),i=>{let r=e(i);return r===void 0?null:[this,r]}}};It.closedBy=new It({deserialize:t=>t.split(" ")});It.openedBy=new It({deserialize:t=>t.split(" ")});It.group=new It({deserialize:t=>t.split(" ")});It.contextHash=new It({perNode:!0});It.lookAhead=new It({perNode:!0});It.mounted=new It({perNode:!0});gW=Object.create(null),kr=class{constructor(e,i,r,n=0){this.name=e,this.props=i,this.id=r,this.flags=n}static define(e){let i=e.props&&e.props.length?Object.create(null):gW,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new kr(e.name||"",i,e.id,r);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(n)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");i[o[0].id]=o[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let i=this.prop(It.group);return i?i.indexOf(e)>-1:!1}return this.id==e}static match(e){let i=Object.create(null);for(let r in e)for(let n of r.split(" "))i[n]=e[r];return r=>{for(let n=r.prop(It.group),o=-1;o<(n?n.length:0);o++){let a=i[o<0?r.name:n[o]];if(a)return a}}}};kr.none=new kr("",Object.create(null),0,8);ev=new WeakMap,_D=new WeakMap;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(cr||(cr={}));Xi=class{constructor(e,i,r,n,o){if(this.type=e,this.children=i,this.positions=r,this.length=n,this.props=null,o&&o.length){this.props=Object.create(null);for(let[a,l]of o)this.props[typeof a=="number"?a:a.id]=l}}toString(){let e=this.prop(It.mounted);if(e&&!e.overlay)return e.tree.toString();let i="";for(let r of this.children){let n=r.toString();n&&(i&&(i+=","),i+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(i.length?"("+i+")":""):i}cursor(e=0){return new lu(this.topNode,e)}cursorAt(e,i=0,r=0){let n=ev.get(this)||this.topNode,o=new lu(n);return o.moveTo(e,i),ev.set(this,o._tree),o}get topNode(){return new Rs(this,0,0,null)}resolve(e,i=0){let r=au(ev.get(this)||this.topNode,e,i,!1);return ev.set(this,r),r}resolveInner(e,i=0){let r=au(_D.get(this)||this.topNode,e,i,!0);return _D.set(this,r),r}iterate(e){let{enter:i,leave:r,from:n=0,to:o=this.length}=e;for(let a=this.cursor((e.mode||0)|cr.IncludeAnonymous);;){let l=!1;if(a.from<=o&&a.to>=n&&(a.type.isAnonymous||i(a)!==!1)){if(a.firstChild())continue;l=!0}for(;l&&r&&!a.type.isAnonymous&&r(a),!a.nextSibling();){if(!a.parent())return;l=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let i in this.props)e.push([+i,this.props[i]]);return e}balance(e={}){return this.children.length<=8?this:$b(kr.none,this.children,this.positions,0,this.children.length,0,this.length,(i,r,n)=>new Xi(this.type,i,r,n,this.propValues),e.makeTree||((i,r,n)=>new Xi(kr.none,i,r,n)))}static build(e){return vW(e)}};Xi.empty=new Xi(kr.none,[],[],0);_f=class{constructor(e,i){this.buffer=e,this.index=i}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new _f(this.buffer,this.index)}},Qo=class{constructor(e,i,r){this.buffer=e,this.length=i,this.set=r}get type(){return kr.none}toString(){let e=[];for(let i=0;i<this.buffer.length;)e.push(this.childString(i)),i=this.buffer[i+3];return e.join(",")}childString(e){let i=this.buffer[e],r=this.buffer[e+3],n=this.set.types[i],o=n.name;if(/\W/.test(o)&&!n.isError&&(o=JSON.stringify(o)),e+=4,r==e)return o;let a=[];for(;e<r;)a.push(this.childString(e)),e=this.buffer[e+3];return o+"("+a.join(",")+")"}findChild(e,i,r,n,o){let{buffer:a}=this,l=-1;for(let h=e;h!=i&&!(xD(o,n,a[h+1],a[h+2])&&(l=h,r>0));h=a[h+3]);return l}slice(e,i,r){let n=this.buffer,o=new Uint16Array(i-e),a=0;for(let l=e,h=0;l<i;){o[h++]=n[l++],o[h++]=n[l++]-r;let u=o[h++]=n[l++]-r;o[h++]=n[l++]-e,a=Math.max(a,u)}return new Qo(o,a,this.set)}};Rs=class{constructor(e,i,r,n){this._tree=e,this.from=i,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,i,r,n,o=0){for(let a=this;;){for(let{children:l,positions:h}=a._tree,u=i>0?l.length:-1;e!=u;e+=i){let c=l[e],f=h[e]+a.from;if(xD(n,r,f,f+c.length)){if(c instanceof Qo){if(o&cr.ExcludeBuffers)continue;let d=c.findChild(0,c.buffer.length,i,r-f,n);if(d>-1)return new po(new Kb(a,c,e,f),null,d)}else if(o&cr.IncludeAnonymous||!c.type.isAnonymous||Jb(c)){let d;if(!(o&cr.IgnoreMounts)&&c.props&&(d=c.prop(It.mounted))&&!d.overlay)return new Rs(d.tree,f,e,a);let m=new Rs(c,f,e,a);return o&cr.IncludeAnonymous||!m.type.isAnonymous?m:m.nextChild(i<0?c.children.length-1:0,i,r,n)}}}if(o&cr.IncludeAnonymous||!a.type.isAnonymous||(a.index>=0?e=a.index+i:e=i<0?-1:a._parent._tree.children.length,a=a._parent,!a))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,i,r=0){let n;if(!(r&cr.IgnoreOverlays)&&(n=this._tree.prop(It.mounted))&&n.overlay){let o=e-this.from;for(let{from:a,to:l}of n.overlay)if((i>0?a<=o:a<o)&&(i<0?l>=o:l>o))return new Rs(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,i,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new lu(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,i=0){return au(this,e,i,!1)}resolveInner(e,i=0){return au(this,e,i,!0)}enterUnfinishedNodesBefore(e){return bD(this,e)}getChild(e,i=null,r=null){let n=iv(this,e,i,r);return n.length?n[0]:null}getChildren(e,i=null,r=null){return iv(this,e,i,r)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return rv(this,e)}};Kb=class{constructor(e,i,r,n){this.parent=e,this.buffer=i,this.index=r,this.start=n}},po=class{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,i,r){this.context=e,this._parent=i,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,i,r){let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],e,i-this.context.start,r);return o<0?null:new po(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,i,r=0){if(r&cr.ExcludeBuffers)return null;let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],i>0?1:-1,e-this.context.start,i);return o<0?null:new po(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,i=e.buffer[this.index+3];return i<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new po(this.context,this._parent,i):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,i=this._parent?this._parent.index+4:0;return this.index==i?this.externalSibling(-1):new po(this.context,this._parent,e.findChild(i,this.index,-1,0,4))}cursor(e=0){return new lu(this,e)}get tree(){return null}toTree(){let e=[],i=[],{buffer:r}=this.context,n=this.index+4,o=r.buffer[this.index+3];if(o>n){let a=r.buffer[this.index+1];e.push(r.slice(n,o,a)),i.push(0)}return new Xi(this.type,e,i,this.to-this.from)}resolve(e,i=0){return au(this,e,i,!1)}resolveInner(e,i=0){return au(this,e,i,!0)}enterUnfinishedNodesBefore(e){return bD(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,i=null,r=null){let n=iv(this,e,i,r);return n.length?n[0]:null}getChildren(e,i=null,r=null){return iv(this,e,i,r)}get node(){return this}matchContext(e){return rv(this,e)}},lu=class{get name(){return this.type.name}constructor(e,i=0){if(this.mode=i,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Rs)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,i){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=i||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof Rs?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,i,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,i,r,this.mode));let{buffer:n}=this.buffer,o=n.findChild(this.index+4,n.buffer[this.index+3],e,i-this.buffer.start,r);return o<0?!1:(this.stack.push(this.index),this.yieldBuf(o))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,i,r=this.mode){return this.buffer?r&cr.ExcludeBuffers?!1:this.enterChild(1,e,i):this.yield(this._tree.enter(e,i,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&cr.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&cr.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:i}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(i.findChild(n,this.index,-1,0,4))}else{let n=i.buffer[this.index+3];if(n<(r<0?i.buffer.length:i.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let i,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let o=0;o<this.index;o++)if(n.buffer.buffer[o+3]<this.index)return!1;({index:i,parent:r}=n)}else({index:i,_parent:r}=this._tree);for(;r;{index:i,_parent:r}=r)if(i>-1)for(let o=i+e,a=e<0?-1:r._tree.children.length;o!=a;o+=e){let l=r._tree.children[o];if(this.mode&cr.IncludeAnonymous||l instanceof Qo||!l.type.isAnonymous||Jb(l))return!1}return!0}move(e,i){if(i&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,i=0){for(;(this.from==this.to||(i<1?this.from>=e:this.from>e)||(i>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,i););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,i=null,r=0;if(e&&e.context==this.buffer){e:for(let n=this.index,o=this.stack.length;o>=0;){for(let a=e;a;a=a._parent)if(a.index==n){if(n==this.index)return a;i=a,r=o+1;break e}n=this.stack[--o]}}for(let n=r;n<this.stack.length;n++)i=new po(this.buffer,i,this.stack[n]);return this.bufferNode=new po(this.buffer,i,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,i){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;n&&i&&i(this),n=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return rv(this.node,e);let{buffer:i}=this.buffer,{types:r}=i.set;for(let n=e.length-1,o=this.stack.length-1;n>=0;o--){if(o<0)return rv(this.node,e,n);let a=r[i.buffer[this.stack[o]]];if(!a.isAnonymous){if(e[n]&&e[n]!=a.name)return!1;n--}}return!0}};yD=new WeakMap;mo=class{constructor(e,i,r,n,o=!1,a=!1){this.from=e,this.to=i,this.tree=r,this.offset=n,this.open=(o?1:0)|(a?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,i=[],r=!1){let n=[new mo(0,e.length,e,0,!1,r)];for(let o of i)o.to>e.length&&n.push(o);return n}static applyChanges(e,i,r=128){if(!i.length)return e;let n=[],o=1,a=e.length?e[0]:null;for(let l=0,h=0,u=0;;l++){let c=l<i.length?i[l]:null,f=c?c.fromA:1e9;if(f-h>=r)for(;a&&a.from<f;){let d=a;if(h>=d.from||f<=d.to||u){let m=Math.max(d.from,h)-u,v=Math.min(d.to,f)-u;d=m>=v?null:new mo(m,v,d.tree,d.offset+u,l>0,!!c)}if(d&&n.push(d),a.to>f)break;a=o<e.length?e[o++]:null}if(!c)break;h=c.toA,u=c.toA-c.toB}return n}},yf=class{startParse(e,i,r){return typeof e=="string"&&(e=new Qb(e)),r=r?r.length?r.map(n=>new vf(n.from,n.to)):[new vf(0,0)]:[new vf(0,e.length)],this.createParse(e,i||[],r)}parse(e,i,r){let n=this.startParse(e,i,r);for(;;){let o=n.advance();if(o)return o}}},Qb=class{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,i){return this.string.slice(e,i)}},dwe=new It({perNode:!0})});var UI=ae(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});var FI=1024,cV=0,dn=class{constructor(e,i){this.from=e,this.to=i}},ii=class{constructor(e={}){this.id=cV++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=mn.match(e)),i=>{let r=e(i);return r===void 0?null:[this,r]}}};ii.closedBy=new ii({deserialize:t=>t.split(" ")});ii.openedBy=new ii({deserialize:t=>t.split(" ")});ii.group=new ii({deserialize:t=>t.split(" ")});ii.contextHash=new ii({perNode:!0});ii.lookAhead=new ii({perNode:!0});ii.mounted=new ii({perNode:!0});var Pv=class{constructor(e,i,r){this.tree=e,this.overlay=i,this.parser=r}},fV=Object.create(null),mn=class{constructor(e,i,r,n=0){this.name=e,this.props=i,this.id=r,this.flags=n}static define(e){let i=e.props&&e.props.length?Object.create(null):fV,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new mn(e.name||"",i,e.id,r);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(n)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");i[o[0].id]=o[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let i=this.prop(ii.group);return i?i.indexOf(e)>-1:!1}return this.id==e}static match(e){let i=Object.create(null);for(let r in e)for(let n of r.split(" "))i[n]=e[r];return r=>{for(let n=r.prop(ii.group),o=-1;o<(n?n.length:0);o++){let a=i[o<0?r.name:n[o]];if(a)return a}}}};mn.none=new mn("",Object.create(null),0,8);var Rf=class{constructor(e){this.types=e;for(let i=0;i<e.length;i++)if(e[i].id!=i)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let i=[];for(let r of this.types){let n=null;for(let o of e){let a=o(r);a&&(n||(n=Object.assign({},r.props)),n[a[0].id]=a[1])}i.push(n?new mn(r.name,n,r.id,r.flags):r)}return new Rf(i)}},Tv=new WeakMap,LI=new WeakMap;Ut.IterMode=void 0;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(Ut.IterMode||(Ut.IterMode={}));var Nr=class{constructor(e,i,r,n,o){if(this.type=e,this.children=i,this.positions=r,this.length=n,this.props=null,o&&o.length){this.props=Object.create(null);for(let[a,l]of o)this.props[typeof a=="number"?a:a.id]=l}}toString(){let e=this.prop(ii.mounted);if(e&&!e.overlay)return e.tree.toString();let i="";for(let r of this.children){let n=r.toString();n&&(i&&(i+=","),i+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(i.length?"("+i+")":""):i}cursor(e=0){return new Wa(this.topNode,e)}cursorAt(e,i=0,r=0){let n=Tv.get(this)||this.topNode,o=new Wa(n);return o.moveTo(e,i),Tv.set(this,o._tree),o}get topNode(){return new pn(this,0,0,null)}resolve(e,i=0){let r=gu(Tv.get(this)||this.topNode,e,i,!1);return Tv.set(this,r),r}resolveInner(e,i=0){let r=gu(LI.get(this)||this.topNode,e,i,!0);return LI.set(this,r),r}iterate(e){let{enter:i,leave:r,from:n=0,to:o=this.length}=e;for(let a=this.cursor((e.mode||0)|Ut.IterMode.IncludeAnonymous);;){let l=!1;if(a.from<=o&&a.to>=n&&(a.type.isAnonymous||i(a)!==!1)){if(a.firstChild())continue;l=!0}for(;l&&r&&!a.type.isAnonymous&&r(a),!a.nextSibling();){if(!a.parent())return;l=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let i in this.props)e.push([+i,this.props[i]]);return e}balance(e={}){return this.children.length<=8?this:Lw(mn.none,this.children,this.positions,0,this.children.length,0,this.length,(i,r,n)=>new Nr(this.type,i,r,n,this.propValues),e.makeTree||((i,r,n)=>new Nr(mn.none,i,r,n)))}static build(e){return dV(e)}};Nr.empty=new Nr(mn.none,[],[],0);var Lf=class{constructor(e,i){this.buffer=e,this.index=i}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Lf(this.buffer,this.index)}},bo=class{constructor(e,i,r){this.buffer=e,this.length=i,this.set=r}get type(){return mn.none}toString(){let e=[];for(let i=0;i<this.buffer.length;)e.push(this.childString(i)),i=this.buffer[i+3];return e.join(",")}childString(e){let i=this.buffer[e],r=this.buffer[e+3],n=this.set.types[i],o=n.name;if(/\W/.test(o)&&!n.isError&&(o=JSON.stringify(o)),e+=4,r==e)return o;let a=[];for(;e<r;)a.push(this.childString(e)),e=this.buffer[e+3];return o+"("+a.join(",")+")"}findChild(e,i,r,n,o){let{buffer:a}=this,l=-1;for(let h=e;h!=i&&!(BI(o,n,a[h+1],a[h+2])&&(l=h,r>0));h=a[h+3]);return l}slice(e,i,r){let n=this.buffer,o=new Uint16Array(i-e),a=0;for(let l=e,h=0;l<i;){o[h++]=n[l++],o[h++]=n[l++]-r;let u=o[h++]=n[l++]-r;o[h++]=n[l++]-e,a=Math.max(a,u)}return new bo(o,a,this.set)}};function BI(t,e,i,r){switch(t){case-2:return i<e;case-1:return r>=e&&i<e;case 0:return i<e&&r>e;case 1:return i<=e&&r>e;case 2:return r>e;case 4:return!0}}function NI(t,e){let i=t.childBefore(e);for(;i;){let r=i.lastChild;if(!r||r.to!=i.to)break;r.type.isError&&r.from==r.to?(t=i,i=r.prevSibling):i=r}return t}function gu(t,e,i,r){for(var n;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let a=!r&&t instanceof pn&&t.index<0?null:t.parent;if(!a)return t;t=a}let o=r?0:Ut.IterMode.IgnoreOverlays;if(r)for(let a=t,l=a.parent;l;a=l,l=a.parent)a instanceof pn&&a.index<0&&((n=l.enter(e,i,o))===null||n===void 0?void 0:n.from)!=a.from&&(t=l);for(;;){let a=t.enter(e,i,o);if(!a)return t;t=a}}var pn=class{constructor(e,i,r,n){this._tree=e,this.from=i,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,i,r,n,o=0){for(let a=this;;){for(let{children:l,positions:h}=a._tree,u=i>0?l.length:-1;e!=u;e+=i){let c=l[e],f=h[e]+a.from;if(BI(n,r,f,f+c.length)){if(c instanceof bo){if(o&Ut.IterMode.ExcludeBuffers)continue;let d=c.findChild(0,c.buffer.length,i,r-f,n);if(d>-1)return new ss(new ww(a,c,e,f),null,d)}else if(o&Ut.IterMode.IncludeAnonymous||!c.type.isAnonymous||Rw(c)){let d;if(!(o&Ut.IterMode.IgnoreMounts)&&c.props&&(d=c.prop(ii.mounted))&&!d.overlay)return new pn(d.tree,f,e,a);let m=new pn(c,f,e,a);return o&Ut.IterMode.IncludeAnonymous||!m.type.isAnonymous?m:m.nextChild(i<0?c.children.length-1:0,i,r,n)}}}if(o&Ut.IterMode.IncludeAnonymous||!a.type.isAnonymous||(a.index>=0?e=a.index+i:e=i<0?-1:a._parent._tree.children.length,a=a._parent,!a))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,i,r=0){let n;if(!(r&Ut.IterMode.IgnoreOverlays)&&(n=this._tree.prop(ii.mounted))&&n.overlay){let o=e-this.from;for(let{from:a,to:l}of n.overlay)if((i>0?a<=o:a<o)&&(i<0?l>=o:l>o))return new pn(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,i,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new Wa(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,i=0){return gu(this,e,i,!1)}resolveInner(e,i=0){return gu(this,e,i,!0)}enterUnfinishedNodesBefore(e){return NI(this,e)}getChild(e,i=null,r=null){let n=Rv(this,e,i,r);return n.length?n[0]:null}getChildren(e,i=null,r=null){return Rv(this,e,i,r)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return Lv(this,e)}};function Rv(t,e,i,r){let n=t.cursor(),o=[];if(!n.firstChild())return o;if(i!=null){for(;!n.type.is(i);)if(!n.nextSibling())return o}for(;;){if(r!=null&&n.type.is(r))return o;if(n.type.is(e)&&o.push(n.node),!n.nextSibling())return r==null?o:[]}}function Lv(t,e,i=e.length-1){for(let r=t.parent;i>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[i]&&e[i]!=r.name)return!1;i--}}return!0}var ww=class{constructor(e,i,r,n){this.parent=e,this.buffer=i,this.index=r,this.start=n}},ss=class{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,i,r){this.context=e,this._parent=i,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,i,r){let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],e,i-this.context.start,r);return o<0?null:new ss(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,i,r=0){if(r&Ut.IterMode.ExcludeBuffers)return null;let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],i>0?1:-1,e-this.context.start,i);return o<0?null:new ss(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,i=e.buffer[this.index+3];return i<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new ss(this.context,this._parent,i):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,i=this._parent?this._parent.index+4:0;return this.index==i?this.externalSibling(-1):new ss(this.context,this._parent,e.findChild(i,this.index,-1,0,4))}cursor(e=0){return new Wa(this,e)}get tree(){return null}toTree(){let e=[],i=[],{buffer:r}=this.context,n=this.index+4,o=r.buffer[this.index+3];if(o>n){let a=r.buffer[this.index+1];e.push(r.slice(n,o,a)),i.push(0)}return new Nr(this.type,e,i,this.to-this.from)}resolve(e,i=0){return gu(this,e,i,!1)}resolveInner(e,i=0){return gu(this,e,i,!0)}enterUnfinishedNodesBefore(e){return NI(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,i=null,r=null){let n=Rv(this,e,i,r);return n.length?n[0]:null}getChildren(e,i=null,r=null){return Rv(this,e,i,r)}get node(){return this}matchContext(e){return Lv(this,e)}},Wa=class{get name(){return this.type.name}constructor(e,i=0){if(this.mode=i,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof pn)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,i){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=i||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof pn?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,i,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,i,r,this.mode));let{buffer:n}=this.buffer,o=n.findChild(this.index+4,n.buffer[this.index+3],e,i-this.buffer.start,r);return o<0?!1:(this.stack.push(this.index),this.yieldBuf(o))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,i,r=this.mode){return this.buffer?r&Ut.IterMode.ExcludeBuffers?!1:this.enterChild(1,e,i):this.yield(this._tree.enter(e,i,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Ut.IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Ut.IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:i}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(i.findChild(n,this.index,-1,0,4))}else{let n=i.buffer[this.index+3];if(n<(r<0?i.buffer.length:i.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let i,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let o=0;o<this.index;o++)if(n.buffer.buffer[o+3]<this.index)return!1;({index:i,parent:r}=n)}else({index:i,_parent:r}=this._tree);for(;r;{index:i,_parent:r}=r)if(i>-1)for(let o=i+e,a=e<0?-1:r._tree.children.length;o!=a;o+=e){let l=r._tree.children[o];if(this.mode&Ut.IterMode.IncludeAnonymous||l instanceof bo||!l.type.isAnonymous||Rw(l))return!1}return!0}move(e,i){if(i&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,i=0){for(;(this.from==this.to||(i<1?this.from>=e:this.from>e)||(i>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,i););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,i=null,r=0;if(e&&e.context==this.buffer){e:for(let n=this.index,o=this.stack.length;o>=0;){for(let a=e;a;a=a._parent)if(a.index==n){if(n==this.index)return a;i=a,r=o+1;break e}n=this.stack[--o]}}for(let n=r;n<this.stack.length;n++)i=new ss(this.buffer,i,this.stack[n]);return this.bufferNode=new ss(this.buffer,i,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,i){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;n&&i&&i(this),n=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return Lv(this.node,e);let{buffer:i}=this.buffer,{types:r}=i.set;for(let n=e.length-1,o=this.stack.length-1;n>=0;o--){if(o<0)return Lv(this.node,e,n);let a=r[i.buffer[this.stack[o]]];if(!a.isAnonymous){if(e[n]&&e[n]!=a.name)return!1;n--}}return!0}};function Rw(t){return t.children.some(e=>e instanceof bo||!e.type.isAnonymous||Rw(e))}function dV(t){var e;let{buffer:i,nodeSet:r,maxBufferLength:n=FI,reused:o=[],minRepeatType:a=r.types.length}=t,l=Array.isArray(i)?new Lf(i,i.length):i,h=r.types,u=0,c=0;function f(y,w,S,R,E){let{id:T,start:A,end:C,size:M}=l,D=c;for(;M<0;)if(l.next(),M==-1){let k=o[T];S.push(k),R.push(A-y);return}else if(M==-3){u=T;return}else if(M==-4){c=T;return}else throw new RangeError(`Unrecognized record size: ${M}`);let O=h[T],P,L,I=A-y;if(C-A<=n&&(L=g(l.pos-w,E))){let k=new Uint16Array(L.size-L.skip),B=l.pos-L.size,F=k.length;for(;l.pos>B;)F=p(L.start,k,F);P=new bo(k,C-L.start,r),I=L.start-y}else{let k=l.pos-M;l.next();let B=[],F=[],W=T>=a?T:-1,V=0,N=C;for(;l.pos>k;)W>=0&&l.id==W&&l.size>=0?(l.end<=N-n&&(m(B,F,A,V,l.end,N,W,D),V=B.length,N=l.end),l.next()):f(A,k,B,F,W);if(W>=0&&V>0&&V<B.length&&m(B,F,A,V,A,N,W,D),B.reverse(),F.reverse(),W>-1&&V>0){let ne=d(O);P=Lw(O,B,F,0,B.length,0,C-A,ne,ne)}else P=v(O,B,F,C-A,D-C)}S.push(P),R.push(I)}function d(y){return(w,S,R)=>{let E=0,T=w.length-1,A,C;if(T>=0&&(A=w[T])instanceof Nr){if(!T&&A.type==y&&A.length==R)return A;(C=A.prop(ii.lookAhead))&&(E=S[T]+A.length+C)}return v(y,w,S,R,E)}}function m(y,w,S,R,E,T,A,C){let M=[],D=[];for(;y.length>R;)M.push(y.pop()),D.push(w.pop()+S-E);y.push(v(r.types[A],M,D,T-E,C-T)),w.push(E-S)}function v(y,w,S,R,E=0,T){if(u){let A=[ii.contextHash,u];T=T?[A].concat(T):[A]}if(E>25){let A=[ii.lookAhead,E];T=T?[A].concat(T):[A]}return new Nr(y,w,S,R,T)}function g(y,w){let S=l.fork(),R=0,E=0,T=0,A=S.end-n,C={size:0,start:0,skip:0};e:for(let M=S.pos-y;S.pos>M;){let D=S.size;if(S.id==w&&D>=0){C.size=R,C.start=E,C.skip=T,T+=4,R+=4,S.next();continue}let O=S.pos-D;if(D<0||O<M||S.start<A)break;let P=S.id>=a?4:0,L=S.start;for(S.next();S.pos>O;){if(S.size<0)if(S.size==-3)P+=4;else break e;else S.id>=a&&(P+=4);S.next()}E=L,R+=D,T+=P}return(w<0||R==y)&&(C.size=R,C.start=E,C.skip=T),C.size>4?C:void 0}function p(y,w,S){let{id:R,start:E,end:T,size:A}=l;if(l.next(),A>=0&&R<a){let C=S;if(A>4){let M=l.pos-(A-4);for(;l.pos>M;)S=p(y,w,S)}w[--S]=C,w[--S]=T-y,w[--S]=E-y,w[--S]=R}else A==-3?u=R:A==-4&&(c=R);return S}let _=[],x=[];for(;l.pos>0;)f(t.start||0,t.bufferStart||0,_,x,-1);let b=(e=t.length)!==null&&e!==void 0?e:_.length?x[0]+_[0].length:0;return new Nr(h[t.topID],_.reverse(),x.reverse(),b)}var OI=new WeakMap;function Av(t,e){if(!t.isAnonymous||e instanceof bo||e.type!=t)return 1;let i=OI.get(e);if(i==null){i=1;for(let r of e.children){if(r.type!=t||!(r instanceof Nr)){i=1;break}i+=Av(t,r)}OI.set(e,i)}return i}function Lw(t,e,i,r,n,o,a,l,h){let u=0;for(let v=r;v<n;v++)u+=Av(t,e[v]);let c=Math.ceil(u*1.5/8),f=[],d=[];function m(v,g,p,_,x){for(let b=p;b<_;){let y=b,w=g[b],S=Av(t,v[b]);for(b++;b<_;b++){let R=Av(t,v[b]);if(S+R>=c)break;S+=R}if(b==y+1){if(S>c){let R=v[y];m(R.children,R.positions,0,R.children.length,g[y]+x);continue}f.push(v[y])}else{let R=g[b-1]+v[b-1].length-w;f.push(Lw(t,v,g,y,b,w,R,null,h))}d.push(w+x-o)}}return m(e,i,r,n,0),(l||h)(f,d,a)}var Sw=class{constructor(){this.map=new WeakMap}setBuffer(e,i,r){let n=this.map.get(e);n||this.map.set(e,n=new Map),n.set(i,r)}getBuffer(e,i){let r=this.map.get(e);return r&&r.get(i)}set(e,i){e instanceof ss?this.setBuffer(e.context.buffer,e.index,i):e instanceof pn&&this.map.set(e.tree,i)}get(e){return e instanceof ss?this.getBuffer(e.context.buffer,e.index):e instanceof pn?this.map.get(e.tree):void 0}cursorSet(e,i){e.buffer?this.setBuffer(e.buffer.buffer,e.index,i):this.map.set(e.tree,i)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}},Va=class{constructor(e,i,r,n,o=!1,a=!1){this.from=e,this.to=i,this.tree=r,this.offset=n,this.open=(o?1:0)|(a?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,i=[],r=!1){let n=[new Va(0,e.length,e,0,!1,r)];for(let o of i)o.to>e.length&&n.push(o);return n}static applyChanges(e,i,r=128){if(!i.length)return e;let n=[],o=1,a=e.length?e[0]:null;for(let l=0,h=0,u=0;;l++){let c=l<i.length?i[l]:null,f=c?c.fromA:1e9;if(f-h>=r)for(;a&&a.from<f;){let d=a;if(h>=d.from||f<=d.to||u){let m=Math.max(d.from,h)-u,v=Math.min(d.to,f)-u;d=m>=v?null:new Va(m,v,d.tree,d.offset+u,l>0,!!c)}if(d&&n.push(d),a.to>f)break;a=o<e.length?e[o++]:null}if(!c)break;h=c.toA,u=c.toA-c.toB}return n}},Cw=class{startParse(e,i,r){return typeof e=="string"&&(e=new Mw(e)),r=r?r.length?r.map(n=>new dn(n.from,n.to)):[new dn(0,0)]:[new dn(0,e.length)],this.createParse(e,i||[],r)}parse(e,i,r){let n=this.startParse(e,i,r);for(;;){let o=n.advance();if(o)return o}}},Mw=class{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,i){return this.string.slice(e,i)}};function pV(t){return(e,i,r,n)=>new Aw(e,t,i,r,n)}var Ov=class{constructor(e,i,r,n,o){this.parser=e,this.parse=i,this.overlay=r,this.target=n,this.ranges=o}},Ew=class{constructor(e,i,r,n,o,a,l){this.parser=e,this.predicate=i,this.mounts=r,this.index=n,this.start=o,this.target=a,this.prev=l,this.depth=0,this.ranges=[]}},Tw=new ii({perNode:!0}),Aw=class{constructor(e,i,r,n,o){this.nest=i,this.input=r,this.fragments=n,this.ranges=o,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let r=this.baseParse.advance();if(!r)return null;if(this.baseParse=null,this.baseTree=r,this.startInner(),this.stoppedAt!=null)for(let n of this.inner)n.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let r=this.baseTree;return this.stoppedAt!=null&&(r=new Nr(r.type,r.children,r.positions,r.length,r.propValues.concat([[Tw,this.stoppedAt]]))),r}let e=this.inner[this.innerDone],i=e.parse.advance();if(i){this.innerDone++;let r=Object.assign(Object.create(null),e.target.props);r[ii.mounted.id]=new Pv(i,e.overlay,e.parser),e.target.props=r}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let i=this.innerDone;i<this.inner.length;i++)this.inner[i].ranges[0].from<e&&(e=Math.min(e,this.inner[i].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let i=this.innerDone;i<this.inner.length;i++)this.inner[i].parse.stopAt(e)}startInner(){let e=new Pw(this.fragments),i=null,r=null,n=new Wa(new pn(this.baseTree,this.ranges[0].from,0,null),Ut.IterMode.IncludeAnonymous|Ut.IterMode.IgnoreMounts);e:for(let o,a;this.stoppedAt==null||n.from<this.stoppedAt;){let l=!0,h;if(e.hasNode(n)){if(i){let u=i.mounts.find(c=>c.frag.from<=n.from&&c.frag.to>=n.to&&c.mount.overlay);if(u)for(let c of u.mount.overlay){let f=c.from+u.pos,d=c.to+u.pos;f>=n.from&&d<=n.to&&!i.ranges.some(m=>m.from<d&&m.to>f)&&i.ranges.push({from:f,to:d})}}l=!1}else if(r&&(a=mV(r.ranges,n.from,n.to)))l=a!=2;else if(!n.type.isAnonymous&&n.from<n.to&&(o=this.nest(n,this.input))){n.tree||gV(n);let u=e.findMounts(n.from,o.parser);if(typeof o.overlay=="function")i=new Ew(o.parser,o.overlay,u,this.inner.length,n.from,n.tree,i);else{let c=II(this.ranges,o.overlay||[new dn(n.from,n.to)]);c.length&&this.inner.push(new Ov(o.parser,o.parser.startParse(this.input,kI(u,c),c),o.overlay?o.overlay.map(f=>new dn(f.from-n.from,f.to-n.from)):null,n.tree,c)),o.overlay?c.length&&(r={ranges:c,depth:0,prev:r}):l=!1}}else i&&(h=i.predicate(n))&&(h===!0&&(h=new dn(n.from,n.to)),h.from<h.to&&i.ranges.push(h));if(l&&n.firstChild())i&&i.depth++,r&&r.depth++;else for(;!n.nextSibling();){if(!n.parent())break e;if(i&&!--i.depth){let u=II(this.ranges,i.ranges);u.length&&this.inner.splice(i.index,0,new Ov(i.parser,i.parser.startParse(this.input,kI(i.mounts,u),u),i.ranges.map(c=>new dn(c.from-i.start,c.to-i.start)),i.target,u)),i=i.prev}r&&!--r.depth&&(r=r.prev)}}}};function mV(t,e,i){for(let r of t){if(r.from>=i)break;if(r.to>e)return r.from<=e&&r.to>=i?2:1}return 0}function DI(t,e,i,r,n,o){if(e<i){let a=t.buffer[e+1];r.push(t.slice(e,i,a)),n.push(a-o)}}function gV(t){let{node:e}=t,i=0;do t.parent(),i++;while(!t.tree);let r=0,n=t.tree,o=0;for(;o=n.positions[r]+t.from,!(o<=e.from&&o+n.children[r].length>=e.to);r++);let a=n.children[r],l=a.buffer;function h(u,c,f,d,m){let v=u;for(;l[v+2]+o<=e.from;)v=l[v+3];let g=[],p=[];DI(a,u,v,g,p,d);let _=l[v+1],x=l[v+2],b=_+o==e.from&&x+o==e.to&&l[v]==e.type.id;return g.push(b?e.toTree():h(v+4,l[v+3],a.set.types[l[v]],_,x-_)),p.push(_-d),DI(a,l[v+3],c,g,p,d),new Nr(f,g,p,m)}n.children[r]=h(0,l.length,mn.none,0,a.length);for(let u=0;u<=i;u++)t.childAfter(e.from)}var Dv=class{constructor(e,i){this.offset=i,this.done=!1,this.cursor=e.cursor(Ut.IterMode.IncludeAnonymous|Ut.IterMode.IgnoreMounts)}moveTo(e){let{cursor:i}=this,r=e-this.offset;for(;!this.done&&i.from<r;)i.to>=e&&i.enter(r,1,Ut.IterMode.IgnoreOverlays|Ut.IterMode.ExcludeBuffers)||i.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let i=this.cursor.tree;;){if(i==e.tree)return!0;if(i.children.length&&i.positions[0]==0&&i.children[0]instanceof Nr)i=i.children[0];else break}return!1}},Pw=class{constructor(e){var i;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let r=this.curFrag=e[0];this.curTo=(i=r.tree.prop(Tw))!==null&&i!==void 0?i:r.to,this.inner=new Dv(r.tree,-r.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let i=this.curFrag=this.fragments[this.fragI];this.curTo=(e=i.tree.prop(Tw))!==null&&e!==void 0?e:i.to,this.inner=new Dv(i.tree,-i.offset)}}findMounts(e,i){var r;let n=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let o=this.inner.cursor.node;o;o=o.parent){let a=(r=o.tree)===null||r===void 0?void 0:r.prop(ii.mounted);if(a&&a.parser==i)for(let l=this.fragI;l<this.fragments.length;l++){let h=this.fragments[l];if(h.from>=o.to)break;h.tree==this.curFrag.tree&&n.push({frag:h,pos:o.from-h.offset,mount:a})}}}return n}};function II(t,e){let i=null,r=e;for(let n=1,o=0;n<t.length;n++){let a=t[n-1].to,l=t[n].from;for(;o<r.length;o++){let h=r[o];if(h.from>=l)break;h.to<=a||(i||(r=i=e.slice()),h.from<a?(i[o]=new dn(h.from,a),h.to>l&&i.splice(o+1,0,new dn(l,h.to))):h.to>l?i[o--]=new dn(l,h.to):i.splice(o--,1))}}return r}function vV(t,e,i,r){let n=0,o=0,a=!1,l=!1,h=-1e9,u=[];for(;;){let c=n==t.length?1e9:a?t[n].to:t[n].from,f=o==e.length?1e9:l?e[o].to:e[o].from;if(a!=l){let d=Math.max(h,i),m=Math.min(c,f,r);d<m&&u.push(new dn(d,m))}if(h=Math.min(c,f),h==1e9)break;c==h&&(a?(a=!1,n++):a=!0),f==h&&(l?(l=!1,o++):l=!0)}return u}function kI(t,e){let i=[];for(let{pos:r,mount:n,frag:o}of t){let a=r+(n.overlay?n.overlay[0].from:0),l=a+n.tree.length,h=Math.max(o.from,a),u=Math.min(o.to,l);if(n.overlay){let c=n.overlay.map(d=>new dn(d.from+r,d.to+r)),f=vV(e,c,h,u);for(let d=0,m=h;;d++){let v=d==f.length,g=v?u:f[d].from;if(g>m&&i.push(new Va(m,g,n.tree,-a,o.from>=m||o.openStart,o.to<=g||o.openEnd)),v)break;m=f[d].to}}else i.push(new Va(h,u,n.tree,-a,o.from>=a||o.openStart,o.to<=l||o.openEnd))}return i}Ut.DefaultBufferLength=FI;Ut.MountedTree=Pv;Ut.NodeProp=ii;Ut.NodeSet=Rf;Ut.NodeType=mn;Ut.NodeWeakMap=Sw;Ut.Parser=Cw;Ut.Tree=Nr;Ut.TreeBuffer=bo;Ut.TreeCursor=Wa;Ut.TreeFragment=Va;Ut.parseMixed=pV});var zw=ae(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});var os=UI(),Wl=class{constructor(e,i,r,n,o,a,l,h,u,c=0,f){this.p=e,this.stack=i,this.state=r,this.reducePos=n,this.pos=o,this.score=a,this.buffer=l,this.bufferBase=h,this.curContext=u,this.lookAhead=c,this.parent=f}toString(){return`[${this.stack.filter((e,i)=>i%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,i,r=0){let n=e.parser.context;return new Wl(e,[],i,r,r,0,[],0,n?new kv(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,i){this.stack.push(this.state,i,this.bufferBase+this.buffer.length),this.state=e}reduce(e){let i=e>>19,r=e&65535,{parser:n}=this.p,o=n.dynamicPrecedence(r);if(o&&(this.score+=o),i==0){this.pushState(n.getGoto(this.state,r,!0),this.reducePos),r<n.minRepeatTerm&&this.storeNode(r,this.reducePos,this.reducePos,4,!0),this.reduceContext(r,this.reducePos);return}let a=this.stack.length-(i-1)*3-(e&262144?6:0),l=this.stack[a-2],h=this.stack[a-1],u=this.bufferBase+this.buffer.length-h;if(r<n.minRepeatTerm||e&131072){let c=n.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(r,l,c,u+4,!0)}if(e&262144)this.state=this.stack[a];else{let c=this.stack[a-3];this.state=n.getGoto(c,r,!0)}for(;this.stack.length>a;)this.stack.pop();this.reduceContext(r,l)}storeNode(e,i,r,n=4,o=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let a=this,l=this.buffer.length;if(l==0&&a.parent&&(l=a.bufferBase-a.parent.bufferBase,a=a.parent),l>0&&a.buffer[l-4]==0&&a.buffer[l-1]>-1){if(i==r)return;if(a.buffer[l-2]>=i){a.buffer[l-2]=r;return}}}if(!o||this.pos==r)this.buffer.push(e,i,r,n);else{let a=this.buffer.length;if(a>0&&this.buffer[a-4]!=0)for(;a>0&&this.buffer[a-2]>r;)this.buffer[a]=this.buffer[a-4],this.buffer[a+1]=this.buffer[a-3],this.buffer[a+2]=this.buffer[a-2],this.buffer[a+3]=this.buffer[a-1],a-=4,n>4&&(n-=4);this.buffer[a]=e,this.buffer[a+1]=i,this.buffer[a+2]=r,this.buffer[a+3]=n}}shift(e,i,r){let n=this.pos;if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=r,this.shiftContext(i,n),i<=this.p.parser.maxNode&&this.buffer.push(i,n,r,4);else{let o=e,{parser:a}=this.p;(r>this.pos||i<=a.maxNode)&&(this.pos=r,a.stateFlag(o,1)||(this.reducePos=r)),this.pushState(o,n),this.shiftContext(i,n),i<=a.maxNode&&this.buffer.push(i,n,r,4)}}apply(e,i,r){e&65536?this.reduce(e):this.shift(e,i,r)}useNode(e,i){let r=this.p.reused.length-1;(r<0||this.p.reused[r]!=e)&&(this.p.reused.push(e),r++);let n=this.pos;this.reducePos=this.pos=n+e.length,this.pushState(i,n),this.buffer.push(r,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,i=e.buffer.length;for(;i>0&&e.buffer[i-2]>e.reducePos;)i-=4;let r=e.buffer.slice(i),n=e.bufferBase+i;for(;e&&n==e.bufferBase;)e=e.parent;return new Wl(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,r,n,this.curContext,this.lookAhead,e)}recoverByDelete(e,i){let r=e<=this.p.parser.maxNode;r&&this.storeNode(e,this.pos,i,4),this.storeNode(0,this.pos,i,r?8:4),this.pos=this.reducePos=i,this.score-=190}canShift(e){for(let i=new Iw(this);;){let r=this.p.parser.stateSlot(i.state,4)||this.p.parser.hasAction(i.state,e);if(r==0)return!1;if(!(r&65536))return!0;i.reduce(r)}}recoverByInsert(e){if(this.stack.length>=300)return[];let i=this.p.parser.nextStates(this.state);if(i.length>4<<1||this.stack.length>=120){let n=[];for(let o=0,a;o<i.length;o+=2)(a=i[o+1])!=this.state&&this.p.parser.hasAction(a,e)&&n.push(i[o],a);if(this.stack.length<120)for(let o=0;n.length<4<<1&&o<i.length;o+=2){let a=i[o+1];n.some((l,h)=>h&1&&l==a)||n.push(i[o],a)}i=n}let r=[];for(let n=0;n<i.length&&r.length<4;n+=2){let o=i[n+1];if(o==this.state)continue;let a=this.split();a.pushState(o,this.pos),a.storeNode(0,a.pos,a.pos,4,!0),a.shiftContext(i[n],this.pos),a.score-=200,r.push(a)}return r}forceReduce(){let e=this.p.parser.stateSlot(this.state,5);if(!(e&65536))return!1;let{parser:i}=this.p;if(!i.validAction(this.state,e)){let r=e>>19,n=e&65535,o=this.stack.length-r*3;if(o<0||i.getGoto(this.stack[o],n,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(e),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let i=0;i<this.stack.length;i+=3)if(this.stack[i]!=e.stack[i])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,i){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(i)))}reduceContext(e,i){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(i)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(e){if(e!=this.curContext.context){let i=new kv(this.curContext.tracker,e);i.hash!=this.curContext.hash&&this.emitContext(),this.curContext=i}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}},kv=class{constructor(e,i){this.tracker=e,this.context=i,this.hash=e.strict?e.hash(i):0}},GI;(function(t){t[t.Insert=200]="Insert",t[t.Delete=190]="Delete",t[t.Reduce=100]="Reduce",t[t.MaxNext=4]="MaxNext",t[t.MaxInsertStackDepth=300]="MaxInsertStackDepth",t[t.DampenInsertStackDepth=120]="DampenInsertStackDepth"})(GI||(GI={}));var Iw=class{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let i=e&65535,r=e>>19;r==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(r-1)*3;let n=this.start.p.parser.getGoto(this.stack[this.base-3],i,!0);this.state=n}},yu=class{constructor(e,i,r){this.stack=e,this.pos=i,this.index=r,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,i=e.bufferBase+e.buffer.length){return new yu(e,i,i-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new yu(this.stack,this.pos,this.index)}},vu=class{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}},zI=new vu,Fv=class{constructor(e,i){this.input=e,this.ranges=i,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=zI,this.rangeIndex=0,this.pos=this.chunkPos=i[0].from,this.range=i[0],this.end=i[i.length-1].to,this.readNext()}resolveOffset(e,i){let r=this.range,n=this.rangeIndex,o=this.pos+e;for(;o<r.from;){if(!n)return null;let a=this.ranges[--n];o-=r.from-a.to,r=a}for(;i<0?o>r.to:o>=r.to;){if(n==this.ranges.length-1)return null;let a=this.ranges[++n];o+=a.from-r.to,r=a}return o}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let i of this.ranges)if(i.to>e)return Math.max(e,i.from);return this.end}peek(e){let i=this.chunkOff+e,r,n;if(i>=0&&i<this.chunk.length)r=this.pos+e,n=this.chunk.charCodeAt(i);else{let o=this.resolveOffset(e,1);if(o==null)return-1;if(r=o,r>=this.chunk2Pos&&r<this.chunk2Pos+this.chunk2.length)n=this.chunk2.charCodeAt(r-this.chunk2Pos);else{let a=this.rangeIndex,l=this.range;for(;l.to<=r;)l=this.ranges[++a];this.chunk2=this.input.chunk(this.chunk2Pos=r),r+this.chunk2.length>l.to&&(this.chunk2=this.chunk2.slice(0,l.to-r)),n=this.chunk2.charCodeAt(0)}}return r>=this.token.lookAhead&&(this.token.lookAhead=r+1),n}acceptToken(e,i=0){let r=i?this.resolveOffset(i,-1):this.pos;if(r==null||r<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=r}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:i}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=i,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),i=this.pos+e.length;this.chunk=i>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,i){if(i?(this.token=i,i.start=e,i.lookAhead=e+1,i.value=i.extended=-1):this.token=zI,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,i){if(e>=this.chunkPos&&i<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,i-this.chunkPos);if(e>=this.chunk2Pos&&i<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,i-this.chunk2Pos);if(e>=this.range.from&&i<=this.range.to)return this.input.read(e,i);let r="";for(let n of this.ranges){if(n.from>=i)break;n.to>e&&(r+=this.input.read(Math.max(n.from,e),Math.min(n.to,i)))}return r}},_u=class{constructor(e,i){this.data=e,this.id=i}token(e,i){_V(this.data,e,i,this.id)}};_u.prototype.contextual=_u.prototype.fallback=_u.prototype.extend=!1;var kw=class{constructor(e,i={}){this.token=e,this.contextual=!!i.contextual,this.fallback=!!i.fallback,this.extend=!!i.extend}};function _V(t,e,i,r){let n=0,o=1<<r,{parser:a}=i.p,{dialect:l}=a;e:for(;o&t[n];){let h=t[n+1];for(let d=n+3;d<h;d+=2)if((t[d+1]&o)>0){let m=t[d];if(l.allows(m)&&(e.token.value==-1||e.token.value==m||a.overrides(m,e.token.value))){e.acceptToken(m);break}}let u=e.next,c=0,f=t[n+2];if(e.next<0&&f>c&&t[h+f*3-3]==65535&&t[h+f*3-3]==65535){n=t[h+f*3-1];continue e}for(;c<f;){let d=c+f>>1,m=h+d+(d<<1),v=t[m],g=t[m+1]||65536;if(u<v)f=d;else if(u>=g)c=d+1;else{n=t[m+2],e.advance();continue e}}break}}function Iv(t,e=Uint16Array){if(typeof t!="string")return t;let i=null;for(let r=0,n=0;r<t.length;){let o=0;for(;;){let a=t.charCodeAt(r++),l=!1;if(a==126){o=65535;break}a>=92&&a--,a>=34&&a--;let h=a-32;if(h>=46&&(h-=46,l=!0),o+=h,l)break;o*=46}i?i[n++]=o:i=new e(o)}return i}var Ds=typeof process!="undefined"&&process.env&&/\bparse\b/.test(process.env.LOG),Ow=null,HI;(function(t){t[t.Margin=25]="Margin"})(HI||(HI={}));function WI(t,e,i){let r=t.cursor(os.IterMode.IncludeAnonymous);for(r.moveTo(e);;)if(!(i<0?r.childBefore(e):r.childAfter(e)))for(;;){if((i<0?r.to<e:r.from>e)&&!r.type.isError)return i<0?Math.max(0,Math.min(r.to-1,e-25)):Math.min(t.length,Math.max(r.from+1,e+25));if(i<0?r.prevSibling():r.nextSibling())break;if(!r.parent())return i<0?0:t.length}}var Fw=class{constructor(e,i){this.fragments=e,this.nodeSet=i,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?WI(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?WI(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let i=this.trees.length-1;if(i<0)return this.nextFragment(),null;let r=this.trees[i],n=this.index[i];if(n==r.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let o=r.children[n],a=this.start[i]+r.positions[n];if(a>e)return this.nextStart=a,null;if(o instanceof os.Tree){if(a==e){if(a<this.safeFrom)return null;let l=a+o.length;if(l<=this.safeTo){let h=o.prop(os.NodeProp.lookAhead);if(!h||l+h<this.fragment.to)return o}}this.index[i]++,a+o.length>=Math.max(this.safeFrom,e)&&(this.trees.push(o),this.start.push(a),this.index.push(0))}else this.index[i]++,this.nextStart=a+o.length}}},Bw=class{constructor(e,i){this.stream=i,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(r=>new vu)}getActions(e){let i=0,r=null,{parser:n}=e.p,{tokenizers:o}=n,a=n.stateSlot(e.state,3),l=e.curContext?e.curContext.hash:0,h=0;for(let u=0;u<o.length;u++){if(!(1<<u&a))continue;let c=o[u],f=this.tokens[u];if(!(r&&!c.fallback)&&((c.contextual||f.start!=e.pos||f.mask!=a||f.context!=l)&&(this.updateCachedToken(f,c,e),f.mask=a,f.context=l),f.lookAhead>f.end+25&&(h=Math.max(f.lookAhead,h)),f.value!=0)){let d=i;if(f.extended>-1&&(i=this.addActions(e,f.extended,f.end,i)),i=this.addActions(e,f.value,f.end,i),!c.extend&&(r=f,i>d))break}}for(;this.actions.length>i;)this.actions.pop();return h&&e.setLookAhead(h),!r&&e.pos==this.stream.end&&(r=new vu,r.value=e.p.parser.eofTerm,r.start=r.end=e.pos,i=this.addActions(e,r.value,r.end,i)),this.mainToken=r,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let i=new vu,{pos:r,p:n}=e;return i.start=r,i.end=Math.min(r+1,n.stream.end),i.value=r==n.stream.end?n.parser.eofTerm:0,i}updateCachedToken(e,i,r){let n=this.stream.clipPos(r.pos);if(i.token(this.stream.reset(n,e),r),e.value>-1){let{parser:o}=r.p;for(let a=0;a<o.specialized.length;a++)if(o.specialized[a]==e.value){let l=o.specializers[a](this.stream.read(e.start,e.end),r);if(l>=0&&r.p.parser.dialect.allows(l>>1)){l&1?e.extended=l>>1:e.value=l>>1;break}}}else e.value=0,e.end=this.stream.clipPos(n+1)}putAction(e,i,r,n){for(let o=0;o<n;o+=3)if(this.actions[o]==e)return n;return this.actions[n++]=e,this.actions[n++]=i,this.actions[n++]=r,n}addActions(e,i,r,n){let{state:o}=e,{parser:a}=e.p,{data:l}=a;for(let h=0;h<2;h++)for(let u=a.stateSlot(o,h?2:1);;u+=3){if(l[u]==65535)if(l[u+1]==1)u=$o(l,u+2);else{n==0&&l[u+1]==2&&(n=this.putAction($o(l,u+2),i,r,n));break}l[u]==i&&(n=this.putAction($o(l,u+1),i,r,n))}return n}},VI;(function(t){t[t.Distance=5]="Distance",t[t.MaxRemainingPerStep=3]="MaxRemainingPerStep",t[t.MinBufferLengthPrune=500]="MinBufferLengthPrune",t[t.ForceReduceLimit=10]="ForceReduceLimit",t[t.CutDepth=15e3]="CutDepth",t[t.CutTo=9e3]="CutTo"})(VI||(VI={}));var Nw=class{constructor(e,i,r,n){this.parser=e,this.input=i,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.stream=new Fv(i,n),this.tokens=new Bw(e,this.stream),this.topTerm=e.top[1];let{from:o}=n[0];this.stacks=[Wl.start(this,e.top[0],o)],this.fragments=r.length&&this.stream.end-o>e.bufferLength*4?new Fw(r,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,i=this.minStackPos,r=this.stacks=[],n,o;for(let a=0;a<e.length;a++){let l=e[a];for(;;){if(this.tokens.mainToken=null,l.pos>i)r.push(l);else{if(this.advanceStack(l,r,e))continue;{n||(n=[],o=[]),n.push(l);let h=this.tokens.getMainToken(l);o.push(h.value,h.end)}}break}}if(!r.length){let a=n&&yV(n);if(a)return this.stackToTree(a);if(this.parser.strict)throw Ds&&n&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+i);this.recovering||(this.recovering=5)}if(this.recovering&&n){let a=this.stoppedAt!=null&&n[0].pos>this.stoppedAt?n[0]:this.runRecovery(n,o,r);if(a)return this.stackToTree(a.forceAll())}if(this.recovering){let a=this.recovering==1?1:this.recovering*3;if(r.length>a)for(r.sort((l,h)=>h.score-l.score);r.length>a;)r.pop();r.some(l=>l.reducePos>i)&&this.recovering--}else if(r.length>1){e:for(let a=0;a<r.length-1;a++){let l=r[a];for(let h=a+1;h<r.length;h++){let u=r[h];if(l.sameState(u)||l.buffer.length>500&&u.buffer.length>500)if((l.score-u.score||l.buffer.length-u.buffer.length)>0)r.splice(h--,1);else{r.splice(a--,1);continue e}}}}this.minStackPos=r[0].pos;for(let a=1;a<r.length;a++)r[a].pos<this.minStackPos&&(this.minStackPos=r[a].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,i,r){let n=e.pos,{parser:o}=this,a=Ds?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&n>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let u=e.curContext&&e.curContext.tracker.strict,c=u?e.curContext.hash:0;for(let f=this.fragments.nodeAt(n);f;){let d=this.parser.nodeSet.types[f.type.id]==f.type?o.getGoto(e.state,f.type.id):-1;if(d>-1&&f.length&&(!u||(f.prop(os.NodeProp.contextHash)||0)==c))return e.useNode(f,d),Ds&&console.log(a+this.stackID(e)+` (via reuse of ${o.getName(f.type.id)})`),!0;if(!(f instanceof os.Tree)||f.children.length==0||f.positions[0]>0)break;let m=f.children[0];if(m instanceof os.Tree&&f.positions[0]==0)f=m;else break}}let l=o.stateSlot(e.state,4);if(l>0)return e.reduce(l),Ds&&console.log(a+this.stackID(e)+` (via always-reduce ${o.getName(l&65535)})`),!0;if(e.stack.length>=15e3)for(;e.stack.length>9e3&&e.forceReduce(););let h=this.tokens.getActions(e);for(let u=0;u<h.length;){let c=h[u++],f=h[u++],d=h[u++],m=u==h.length||!r,v=m?e:e.split();if(v.apply(c,f,d),Ds&&console.log(a+this.stackID(v)+` (via ${c&65536?`reduce of ${o.getName(c&65535)}`:"shift"} for ${o.getName(f)} @ ${n}${v==e?"":", split"})`),m)return!0;v.pos>n?i.push(v):r.push(v)}return!1}advanceFully(e,i){let r=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>r)return jI(e,i),!0}}runRecovery(e,i,r){let n=null,o=!1;for(let a=0;a<e.length;a++){let l=e[a],h=i[a<<1],u=i[(a<<1)+1],c=Ds?this.stackID(l)+" -> ":"";if(l.deadEnd&&(o||(o=!0,l.restart(),Ds&&console.log(c+this.stackID(l)+" (restarted)"),this.advanceFully(l,r))))continue;let f=l.split(),d=c;for(let m=0;f.forceReduce()&&m<10&&(Ds&&console.log(d+this.stackID(f)+" (via force-reduce)"),!this.advanceFully(f,r));m++)Ds&&(d=this.stackID(f)+" -> ");for(let m of l.recoverByInsert(h))Ds&&console.log(c+this.stackID(m)+" (via recover-insert)"),this.advanceFully(m,r);this.stream.end>l.pos?(u==l.pos&&(u++,h=0),l.recoverByDelete(h,u),Ds&&console.log(c+this.stackID(l)+` (via recover-delete ${this.parser.getName(h)})`),jI(l,r)):(!n||n.score<l.score)&&(n=l)}return n}stackToTree(e){return e.close(),os.Tree.build({buffer:yu.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let i=(Ow||(Ow=new WeakMap)).get(e);return i||Ow.set(e,i=String.fromCodePoint(this.nextStackID++)),i+e}};function jI(t,e){for(let i=0;i<e.length;i++){let r=e[i];if(r.pos==t.pos&&r.sameState(t)){e[i].score<t.score&&(e[i]=t);return}}e.push(t)}var Uw=class{constructor(e,i,r){this.source=e,this.flags=i,this.disabled=r}allows(e){return!this.disabled||this.disabled[e]==0}},Dw=t=>t,Gw=class{constructor(e){this.start=e.start,this.shift=e.shift||Dw,this.reduce=e.reduce||Dw,this.reuse=e.reuse||Dw,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}},xu=class extends os.Parser{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (${14})`);let i=e.nodeNames.split(" ");this.minRepeatTerm=i.length;for(let l=0;l<e.repeatNodeCount;l++)i.push("");let r=Object.keys(e.topRules).map(l=>e.topRules[l][1]),n=[];for(let l=0;l<i.length;l++)n.push([]);function o(l,h,u){n[l].push([h,h.deserialize(String(u))])}if(e.nodeProps)for(let l of e.nodeProps){let h=l[0];typeof h=="string"&&(h=os.NodeProp[h]);for(let u=1;u<l.length;){let c=l[u++];if(c>=0)o(c,h,l[u++]);else{let f=l[u+-c];for(let d=-c;d>0;d--)o(l[u++],h,f);u++}}}this.nodeSet=new os.NodeSet(i.map((l,h)=>os.NodeType.define({name:h>=this.minRepeatTerm?void 0:l,id:h,props:n[h],top:r.indexOf(h)>-1,error:h==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(h)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=os.DefaultBufferLength;let a=Iv(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let l=0;l<this.specializerSpecs.length;l++)this.specialized[l]=this.specializerSpecs[l].term;this.specializers=this.specializerSpecs.map(XI),this.states=Iv(e.states,Uint32Array),this.data=Iv(e.stateData),this.goto=Iv(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(l=>typeof l=="number"?new _u(a,l):l),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,i,r){let n=new Nw(this,e,i,r);for(let o of this.wrappers)n=o(n,e,i,r);return n}getGoto(e,i,r=!1){let n=this.goto;if(i>=n[0])return-1;for(let o=n[i+1];;){let a=n[o++],l=a&1,h=n[o++];if(l&&r)return h;for(let u=o+(a>>1);o<u;o++)if(n[o]==e)return h;if(l)return-1}}hasAction(e,i){let r=this.data;for(let n=0;n<2;n++)for(let o=this.stateSlot(e,n?2:1),a;;o+=3){if((a=r[o])==65535)if(r[o+1]==1)a=r[o=$o(r,o+2)];else{if(r[o+1]==2)return $o(r,o+2);break}if(a==i||a==0)return $o(r,o+1)}return 0}stateSlot(e,i){return this.states[e*6+i]}stateFlag(e,i){return(this.stateSlot(e,0)&i)>0}validAction(e,i){if(i==this.stateSlot(e,4))return!0;for(let r=this.stateSlot(e,1);;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=$o(this.data,r+2);else return!1;if(i==$o(this.data,r+1))return!0}}nextStates(e){let i=[];for(let r=this.stateSlot(e,1);;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=$o(this.data,r+2);else break;if(!(this.data[r+2]&1)){let n=this.data[r+1];i.some((o,a)=>a&1&&o==n)||i.push(this.data[r],n)}}return i}overrides(e,i){let r=qI(this.data,this.tokenPrecTable,i);return r<0||qI(this.data,this.tokenPrecTable,e)<r}configure(e){let i=Object.assign(Object.create(xu.prototype),this);if(e.props&&(i.nodeSet=this.nodeSet.extend(...e.props)),e.top){let r=this.topRules[e.top];if(!r)throw new RangeError(`Invalid top rule name ${e.top}`);i.top=r}return e.tokenizers&&(i.tokenizers=this.tokenizers.map(r=>{let n=e.tokenizers.find(o=>o.from==r);return n?n.to:r})),e.specializers&&(i.specializers=this.specializers.slice(),i.specializerSpecs=this.specializerSpecs.map((r,n)=>{let o=e.specializers.find(l=>l.from==r.external);if(!o)return r;let a=Object.assign(Object.assign({},r),{external:o.to});return i.specializers[n]=XI(a),a})),e.contextTracker&&(i.context=e.contextTracker),e.dialect&&(i.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(i.strict=e.strict),e.wrap&&(i.wrappers=i.wrappers.concat(e.wrap)),e.bufferLength!=null&&(i.bufferLength=e.bufferLength),i}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let i=this.dynamicPrecedences;return i==null?0:i[e]||0}parseDialect(e){let i=Object.keys(this.dialects),r=i.map(()=>!1);if(e)for(let o of e.split(" ")){let a=i.indexOf(o);a>=0&&(r[a]=!0)}let n=null;for(let o=0;o<i.length;o++)if(!r[o])for(let a=this.dialects[i[o]],l;(l=this.data[a++])!=65535;)(n||(n=new Uint8Array(this.maxTerm+1)))[l]=1;return new Uw(e,r,n)}static deserialize(e){return new xu(e)}};function $o(t,e){return t[e]|t[e+1]<<16}function qI(t,e,i){for(let r=e,n;(n=t[r])!=65535;r++)if(n==i)return r-e;return-1}function yV(t){let e=null;for(let i of t){let r=i.p.stoppedAt;(i.pos==i.p.stream.end||r!=null&&i.pos>r)&&i.p.parser.stateFlag(i.state,2)&&(!e||e.score<i.score)&&(e=i)}return e}function XI(t){if(t.external){let e=t.extend?1:0;return(i,r)=>t.external(i,r)<<1|e}return t.get}Vl.ContextTracker=Gw;Vl.ExternalTokenizer=kw;Vl.InputStream=Fv;Vl.LRParser=xu;Vl.Stack=Wl});function xV(t,e,i,r){let n=0,o=1<<r,{parser:a}=i.p,{dialect:l}=a;e:for(;o&t[n];){let h=t[n+1];for(let d=n+3;d<h;d+=2)if((t[d+1]&o)>0){let m=t[d];if(l.allows(m)&&(e.token.value==-1||e.token.value==m||a.overrides(m,e.token.value))){e.acceptToken(m);break}}let u=e.next,c=0,f=t[n+2];if(e.next<0&&f>c&&t[h+f*3-3]==65535&&t[h+f*3-3]==65535){n=t[h+f*3-1];continue e}for(;c<f;){let d=c+f>>1,m=h+d+(d<<1),v=t[m],g=t[m+1]||65536;if(u<v)f=d;else if(u>=g)c=d+1;else{n=t[m+2],e.advance();continue e}}break}}var YI,Hw,Bwe,Of,Kr,Nwe,ZI,KI,Ww=_m(()=>{xf();(function(t){t[t.Insert=200]="Insert",t[t.Delete=190]="Delete",t[t.Reduce=100]="Reduce",t[t.MaxNext=4]="MaxNext",t[t.MaxInsertStackDepth=300]="MaxInsertStackDepth",t[t.DampenInsertStackDepth=120]="DampenInsertStackDepth"})(YI||(YI={}));Hw=class{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}},Bwe=new Hw,Of=class{constructor(e,i){this.data=e,this.id=i}token(e,i){xV(this.data,e,i,this.id)}};Of.prototype.contextual=Of.prototype.fallback=Of.prototype.extend=!1;Kr=class{constructor(e,i={}){this.token=e,this.contextual=!!i.contextual,this.fallback=!!i.fallback,this.extend=!!i.extend}};Nwe=typeof process!="undefined"&&process.env&&/\bparse\b/.test(process.env.LOG);(function(t){t[t.Margin=25]="Margin"})(ZI||(ZI={}));(function(t){t[t.Distance=5]="Distance",t[t.MaxRemainingPerStep=3]="MaxRemainingPerStep",t[t.MinBufferLengthPrune=500]="MinBufferLengthPrune",t[t.ForceReduceLimit=10]="ForceReduceLimit",t[t.CutDepth=15e3]="CutDepth",t[t.CutTo=9e3]="CutTo"})(KI||(KI={}))});var JI=ae((Gwe,QI)=>{QI.exports={EndLine:1,ServerParamTextNoDQuote:2,ServerParamTextNoSQuote:3,ServerParamTextNoSpace:4,NumberParam:5,String:6,string:77,LineError:7,GeneralServerCommand:8,StartFunction:9,EndFunction:10,StartWhile:11,EndWhile:12,StartDialog:13,EndDialog:14,StartIf:15,EndIf:16,SCSet:17,SCUnset:18,SCCall:19,SCDialogInput:20,SCReportVariables:21,SCDialogInputDropdown:22,SCCallAndSave:23,SCMonitorCall:24,SCTimedCall:25,SCNoParam:26,SC1Param:27,SC2Params:28,SCCall1:29,GCodeParam:30,GCodeCodeLetter:31,gCodeIdentifier:78,Scope:32,Program:33,ServerLine:34,Function:36,ServerParameterList:37,ServerParameter:38,SQuote:39,CExpressionStart:40,CExpression:41,ParenOpen:42,Comma:43,ParenClose:44,Operator:45,Number:46,ScopeVar:47,Dot:48,Varname:49,CExpressionEnd:50,DQuote:51,While:52,ScopeVarParam:54,Function_params:56,OptScopeVar:57,DialogOption:58,OneToOne:59,GCodeLine:60,LineComment:64,NonGcodeLine:65,SimpleOperator:67}});var tk={};yy(tk,{errorLine:()=>LV,gcodeNamePartClassification:()=>CV,generalServerCommand:()=>bV,newlines:()=>MV,quotedString:()=>PV,quotedstring:()=>RV,serverParamTextNoDQuote:()=>EV,serverParamTextNoSQuote:()=>TV,serverParamTextNoSpace:()=>AV,specializeScope:()=>SV});function bV(t,e){let i=t[0]===";"?t.substring(1):t;return $I[i]?$I[i]:fe.GeneralServerCommand}function SV(t,e){return wV.includes(t)?fe.Scope:(t.startsWith("ext_")||t.startsWith("bed_"))&&ek.test(t.substr(4))?fe.Scope:t.startsWith("chamber_")&&ek.test(t.substr(8))?fe.Scope:-1}function CV(t,e){return t.length===1?t[0]==="G"||t[0]==="g"||t[0]==="M"||t[0]==="m"?fe.GCodeCodeLetter:fe.GCodeParam:fe.gCodeIdentifier}var fe,$I,wV,ek,MV,EV,TV,Bv,AV,PV,RV,LV,ik=_m(()=>{Ww();fe=Qi(JI()),$I={"@func":fe.StartFunction,"@deleteFunc":fe.SCCall1,"@listFunctions":fe.SCNoParam,"@callAndSave":fe.SCCallAndSave,"@endfunc":fe.EndFunction,"@while":fe.StartWhile,"@endwhile":fe.EndWhile,"@dialogStart":fe.StartDialog,"@dialogShow":fe.EndDialog,"@endif":fe.EndIf,"@set":fe.SCSet,"@unset":fe.SCUnset,"@call":fe.SCCall,"@execute":fe.SCCall,"@quickCommand":fe.SCCall1,"@wizardCommand":fe.SCCall1,"@runButtonCommand":fe.SCCall1,"@webAction":fe.SCCall,"@dialogInputInt":fe.SCDialogInput,"@dialogInputDouble":fe.SCDialogInput,"@dialogInputString":fe.SCDialogInput,"@dialogLabel":fe.SCDialogInput,"@dialogInputCheckbox":fe.SCDialogInput,"@dialogInputDropdown":fe.SCDialogInputDropdown,"@reportVariables":fe.SCReportVariables,"@if":fe.StartIf,"@ifTimerBelow":fe.StartIf,"@monitorCall":fe.SCMonitorCall,"@timedCall":fe.SCTimedCall,"@ifPaused":fe.StartIf,"@outOfFilament":fe.SC1Param,"@continue":fe.SCNoParam,"@continueReheat":fe.SCNoParam,"@stopPrint":fe.SCNoParam,"@powerloss":fe.SCNoParam,"@triggerRescue":fe.SCNoParam,"@updatePrinterState":fe.SCNoParam,"@isathome":fe.SCNoParam,"@kill":fe.SCNoParam,"@waitForAllTemperatures":fe.SC1Param,"@cancelWaitForTemperatures":fe.SCNoParam,"@event":fe.SC2Params,"@make_snapshot":fe.SC1Param,"@makeSnapshot":fe.SC1Param,"@getip":fe.SCNoParam,"@skip":fe.SC1Param,"@adderror":fe.SC1Param,"@addError":fe.SC1Param,"@autostart_next_job":fe.SCNoParam,"@autostartNextJob":fe.SCNoParam,"@startNextPrintInQueue":fe.SCNoParam,"@stop_next_autostart":fe.SCNoParam,"@stopNextAutostart":fe.SCNoParam,"@debugcon":fe.SCNoParam,"@explaincom":fe.SCNoParam,"@syncMotion":fe.SCNoParam,"@nosize":fe.SCNoParam,"@noSize":fe.SCNoParam,"@size":fe.SCNoParam,"@extruderColor":fe.SC2Params,"@dialogIcon":fe.SC1Param,"@dialogBlocking":fe.SCNoParam,"@dialogBlockingJob":fe.SCNoParam,"@dialogHide":fe.SC1Param,"@dialogHideAll":fe.SCNoParam,"@reportTimer":fe.SC1Param,"@setTimer":fe.SC1Param,"@reloadLua":fe.SCNoParam,"@resetStack":fe.SCNoParam,"@reportStack":fe.SCNoParam,"@debug":fe.SC1Param,"@return":fe.SC1Param,"@listMonitorCalls":fe.SCNoParam,"@deleteTimedCall":fe.SC1Param,"@callOnEvent":fe.SC2Params,"@removeCallOnEvent":fe.SC2Params,"@reportCallOnEvents":fe.SCNoParam,"@printModelById":fe.SC1Param,"@printModelByName":fe.SC1Param,"@addDefaultWizard":fe.SC2Params,"@listDefaultWizards":fe.SCNoParam};wV=["global","local","deeplocal","perm","func","job","config","transfer","state","const","form","gperm","sglobal"],ek=/^\d+$/;MV=new Kr((t,e)=>{if(t.next<0)t.acceptToken(fe.EndLine);else if(!(t.next!==10&&t.next!==13)){for(t.advance();t.next===10||t.next===13||t.next===32||t.next===9;)t.advance();t.acceptToken(fe.EndLine)}},{contextual:!0,fallback:!0}),EV=new Kr((t,e)=>{let i=0,r="",n="";if(String.fromCharCode(t.next)!=='"')for(;;){let o=String.fromCharCode(t.next);if(t.next<0){i&&t.acceptToken(fe.ServerParamTextNoDQuote);return}if(n+=o,o==='"'||o===`
`){i&&t.acceptToken(fe.ServerParamTextNoDQuote);return}if(o==="\\"){t.advance(2),i+=2,r="";continue}if(o==="{"&&r==="{"){i>1&&t.acceptToken(fe.ServerParamTextNoDQuote,-1);return}r=o,i++,t.advance()}},{contextual:!0,fallback:!0}),TV=new Kr((t,e)=>{let i=0,r="",n="";if(String.fromCharCode(t.next)!=="'")for(;;){let o=String.fromCharCode(t.next);if(n+=o,t.next<0){i&&t.acceptToken(fe.ServerParamTextNoSQuote);return}if(o==="'"||o===`
`){i&&t.acceptToken(fe.ServerParamTextNoSQuote);return}if(o==="\\"){t.advance(2),i+=2,r="";continue}if(o==="{"&&r==="{"){i>1&&t.acceptToken(fe.ServerParamTextNoSQuote,-1);return}r=o,i++,t.advance()}},{contextual:!0,fallback:!0}),Bv=/^(?:nan|-?(?:(?:\d+|\d*\.\d*)(?:[E|e][+|-]?\d+)?|-?inf))$/,AV=new Kr((t,e)=>{let i=0,r="",n="";if(!(String.fromCharCode(t.next)==='"'||String.fromCharCode(t.next)==="'"))for(;;){let o=String.fromCharCode(t.next);if(t.next<0){i&&(Bv.test(n)?t.acceptToken(fe.NumberParam):t.acceptToken(fe.ServerParamTextNoSpace));return}if(o===" "||o===`
`){i&&(Bv.test(n)?t.acceptToken(fe.NumberParam):t.acceptToken(fe.ServerParamTextNoSpace));return}if(n+=o,o==="\\"){t.advance(2),i+=2,r="";continue}if(o==="{"&&r==="{"){i>1&&(Bv.test(n.substr(0,n.length-2))?t.acceptToken(fe.NumberParam,-1):t.acceptToken(fe.ServerParamTextNoSpace,-1));return}if(o==="}"&&r==="}"){i>1&&(Bv.test(n.substr(0,n.length-2))?t.acceptToken(fe.NumberParam,-1):t.acceptToken(fe.ServerParamTextNoSpace,-1));return}r=o,i++,t.advance()}},{contextual:!0,fallback:!0}),PV=new Kr((t,e)=>{let i=-1;if(String.fromCharCode(t.next)==='"'||String.fromCharCode(t.next)==="'")i=t.next,t.advance();else return;for(;;){let r=String.fromCharCode(t.next);if(t.next<0)return;if(t.next===10){t.acceptToken(fe.String);return}if(t.next===i){t.advance(),t.acceptToken(fe.String);return}if(r==="\\"){t.advance(2);continue}t.advance()}},{contextual:!0,fallback:!0}),RV=new Kr((t,e)=>{let i=-1;if(String.fromCharCode(t.next)==='"'||String.fromCharCode(t.next)==="'")i=t.next,t.advance();else return;for(;;){let r=String.fromCharCode(t.next);if(t.next<0)return;if(t.next===10){t.acceptToken(fe.string);return}if(t.next===i){t.advance(),t.acceptToken(fe.string);return}if(r==="\\"){t.advance(2);continue}t.advance()}},{contextual:!0,fallback:!0}),LV=new Kr((t,e)=>{let i=!1;if(t.next===32)return-1;for(;;){let r=String.fromCharCode(t.next);if(t.next===10||t.next<0){i?t.acceptToken(fe.LineError):t.acceptToken(-1);return}r!==" "&&(i=!0),t.advance()}},{contextual:!0,fallback:!0})});var ak=ae(ok=>{var{LRParser:OV}=zw(),{newlines:DV,serverParamTextNoDQuote:IV,serverParamTextNoSQuote:kV,serverParamTextNoSpace:FV,quotedString:BV,quotedstring:NV,errorLine:UV,generalServerCommand:rk,gcodeNamePartClassification:nk,specializeScope:sk}=(ik(),fT(tk));ok.parser=OV.deserialize({version:14,states:"7dQVQ#tOOO!pQ'[O'#DPO!xQ#|O'#DbO#ZQ#}O'#DcO!xQ#|O'#DeOOQP'#DO'#DOO#bQ&rO'#DOO#bQ&rO'#DOO!pQ'[O'#DOO!pQ'[O'#DOO!pQ'[O'#DOO#iQ&jO'#DOO!xQ#|O'#DOO!xQ#|O'#DOO!xQ#|O'#DOO!xQ#|O'#DOO#nQ%XO'#DOO!xQ#|O'#DOO!xQ#|O'#DOO#ZQ#}O'#DOO#vQ#tO'#DkOOQP'#EZ'#EZO#{Q$UO'#EZO$WQ#uO'#DjOOQa'#Dp'#DpO$zQ&{O'#DoO%RQ#uO'#EPOOQO'#Dr'#DrQVQ#tOOOOQ#]'#DQ'#DQO#ZQ#}O,59kO%lQ-WO'#ESO%sQ#xO'#ERO&OQ#vO'#EXOOQ#]'#EY'#EYOOQ#]'#DS'#DSO&ZQ%XO,59|OOQX'#Ds'#DsO&cQ#}O'#DRO&jQ#uO,59}O&oQ%XO,5:PO&wQ7[O'#DdOOQ!k'#Dd'#DdO!xQ#|O,59jO&|Q%XO,59jO#ZQ#}O'#DfOOQP,59j,59jO#bQ&rO,59jO'UQ&rO,59jO'UQ&rO,59jO!xQ#|O,59jO!xQ#|O,59jOOQP,5:V,5:VOOQa'#D['#D[OOQP,5:u,5:uO'`Q#tO'#DlOOQP'#Dm'#DmOOQP'#E['#E[O'eQ$UO'#E[OOQP'#Dx'#DxO'pQ#uO,5:UOOQP,5:U,5:UOOQ#m'#D_'#D_OOQa'#Dy'#DyO(RQ&{O,5:ZOOQO,5:k,5:kOOQO-E7p-E7pO(YQ#uO1G/VO(_Q7[O'#D]OOQO'#EV'#EVO(dQ7[O,5:nOOQO'#EU'#EUO%WQ-WO'#ETOOQO'#ET'#ETO(lQ#tO'#DVOOQO'#DV'#DVOOQ#s,5:n,5:nOOQS'#Dt'#DtO(qQ#xO,5:mOOQ#],5:m,5:mOOQQ'#Dv'#DvO(|Q#vO,5:sOOQ#],5:s,5:sO)XQ#tO1G/hO)`Q#uO1G/hOOQX-E7q-E7qO)eQ#tO1G/iO)lQ#tO1G/kO)sQ#uO1G/kO)xQ&jO,5:OO)}Q%XO1G/UOOQP1G/U1G/UOOQP,5:Q,5:QO#ZQ#}O1G/UO*VQ7[O'#DgOOQy'#Dg'#DgO*[Q']O1G/UO!xQ#|O1G/UO!xQ#|O1G/UO!pQ'[O1G/UOOQP,5:W,5:WOOQP,5:v,5:vOOQP-E7v-E7vOOQP1G/p1G/pOOQa-E7w-E7wO*gQ#tO7+$qO)xQ&jO,59wO%WQ-WO,5:pOOQ#s1G0Y1G0YO*nQ7[O,5:oO*vQ-WO,59qOOQS-E7r-E7rOOQ#]1G0X1G0XOOQQ-E7t-E7tOOQ#]1G0_1G0_O+QQ%XO7+%SO+YQ#tO7+%SO+YQ#tO7+%SO+aQ&sO7+%TO+kQ#tO7+%TO+rQ%XO7+%VO+zQ#tO7+%VO+zQ#tO7+%VOOQ!k1G/j1G/jOOQP7+$p7+$pO)xQ&jO,5:RO,RQ#tO'#DhOOQq'#Dw'#DwO,WQ']O7+$pO,WQ']O7+$pO!pQ'[O7+$pO,cQ%XO7+$pOOQP<<H]<<H]O,kQ#tO<<H]OOQO1G/c1G/cOOQO1G0[1G0[OOQO1G0Z1G0ZO%WQ-WO'#DuO,rQ#tO1G/]O,zQ7[O1G/]OOQO1G/]1G/]OOQP<<Hn<<HnO-VQ%XO<<HnO-_Q#tO<<HnOOQP<<Ho<<HoO-fQ&sO<<HoOOQP<<Hq<<HqO-pQ%XO<<HqO-xQ#tO<<HqOOQy1G/m1G/mO.PQ$UO,5:SOOQq-E7u-E7uO.[Q']O<<H[O!pQ'[O<<H[OOQP<<H[<<H[OOQPAN=wAN=wO.gQ7[O,5:aOOQO-E7s-E7sOOQO7+$w7+$wO.rQ#tO7+$wOOQPAN>YAN>YO.zQ%XOAN>YOOQPAN>ZAN>ZOOQPAN>]AN>]O/SQ%XOAN>]O/[Q#tO1G/nO/aQ%XOAN=vOOQO<<Hc<<HcOOQPG23tG23tOOQPG23wG23wOOQq7+%Y7+%YOOQPG23bG23b",stateData:"/i~O!rOS~OWcOXPOZQO]RO_SOaUObVOcWOd[OeZOf]OgYOh^Oi_Oj`OkaOlbOmXOnfOodO!]jO!bjO!phO~O!omO!tmO~OSrOTrOwpOxoO!TqO~OPuP~P!xOpyO~P!xOp|O~OV!OOPrX~O!z!UO~OU!WOxoO!z!VO~On![Oo!XO!b!_O!p!YOP!^X~OU!aOxoO!e!aO!t!`O!z!VO~OP!cX~P$iOP!cO~OU!gOp!fOz!jO!omO!tmO!z!VO~O!S!nO~P%WOR!oOw!qOxoO~OQ!rOxoO!T!tO~OP!uOV!vO~OPuX~P!xOP!xO~OP!yOV!zO~O!Q!{O~OV!}OPra~Op#QO!t!`O~P!xO!z#WO~OU#XOxoO!z!VO~On![Oo!XO!b#ZO!p!YOP!^a~OP!ca~P$iOP#]O~O!Q#^O~O}#_O!S#`O~Oz#bO~OR!oOw#dOxoO~OQ!rOxoO!T#fO~O[#gO~PVOP#iO~O^#jO~PVO`#lO~PVOP#nO~O!t!`O~OV#pOPri~O!Q#qO~O!omO!tmOPri~OY#xO~PVO|#|O}#_O~O{#}O|$QO~P%WOV$ROP!Uq~O[$SO~PVOpyOP!Vq~P!xO^$VO~PVOV$WOP!Xq~O`$XO~PVOz$[O~O!omO!tmOPrq~OV$`OPrq~OY$aO~PVO{#}O|$dO~O{#}O|$dO}#_O~OV$fOP!Uy~O[$gO~PVOpyOP!Vy~P!xOV$iOP!Xy~O`$jO~PVOU$kOxoO!z!VO~O!omO!tmOPry~O}#_O{!ia|!ia~O{#}O|$mO~OV$nOP!U!R~OV$oOP!X!R~O|$pO~OV$qOPr!R~O",goto:"-h#PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP#Q#b#r$f$uPP&RPPPP&b&vP&}PP#b#b'`#b'o'r'xP#Q(O(`(`P#Q(dP(t)d)n)t*O*U*`*fPPPPP*lP*|+j,m,t,{P*|*|-S-dmjOl!u!x!y#]#h#i#k#m#n#y$T$YmTOl!u!x!y#]#h#i#k#m#n#y$T$YQnPQ|XQ}WQ!PYY!lo!j#_#b#}W#r#S#t#u$^Q#w#VQ$_#vR$l$_QwRQ!OcQ!enQ#O}R#p#PQtQ[uRcnv}#PQxSYzUV!P#j$VQ{bQ|aQ!Q[Q!R]Q!S^Q!T_Q!|{S#R!Q!RQ#U!SQ#V!TQ#u#TR#v#UQ!hoQ#a!jQ#{#_Q$P#bR$b#}Q!WfS!ai!bY!go!j#_#b#}Q#X![R$k$[Z!go!j#_#b#}S!ai!bS#R!Q!RQ#o!{Q#z#^R$Z#qQ{UQ|VQ#P!PQ$U#jR$h$VR!OWQ#S!QR#T!RX#s#S#t#u$^meOl!u!x!y#]#h#i#k#m#n#y$T$YT!Zg!^miOl!u!x!y#]#h#i#k#m#n#y$T$YQlO^!dl#h#k#m#y$T$YQ#h!uQ#k!xQ#m!yQ#y#]Q$T#iR$Y#nYvRcn}#PR!wvQ!ppR#c!pQ$O#bS$c$O$eR$e$PQ!sqR#e!sQ#t#SS$]#t$^R$^#uQ!^gR#Y!^Q!biR#[!bmkOl!u!x!y#]#h#i#k#m#n#y$T$Y!VsQRSUV[]^_abcnv{}!P!Q!R!S!T#P#T#U#j$V!UrQRSUV[]^_abcnv{}!P!Q!R!S!T#P#T#U#j$VQ!WfS!ai!bS!op!pS!rq!sQ#X![R$k$[Z!mo!j#_#b#}Z!ko!j#_#b#}Z!io!j#_#b#}mgOl!u!x!y#]#h#i#k#m#n#y$T$YT!]g!^",nodeNames:"\u26A0 EndLine ServerParamTextNoDQuote ServerParamTextNoSQuote ServerParamTextNoSpace NumberParam String LineError GeneralServerCommand StartFunction EndFunction StartWhile EndWhile StartDialog EndDialog StartIf EndIf SCSet SCUnset SCCall SCDialogInput SCReportVariables SCDialogInputDropdown SCCallAndSave SCMonitorCall SCTimedCall SCNoParam SC1Param SC2Params SCCall1 GCodeParam GCodeCodeLetter Scope Program ServerLine Function Function ServerParameterList ServerParameter SQuote CExpressionStart CExpression ParenOpen Comma ParenClose Operator Number ScopeVar Dot Varname CExpressionEnd DQuote While Dialog ScopeVarParam If Function_params OptScopeVar DialogOption OneToOne GCodeLine GCodeCode GCodeCode GCodeIdentifier LineComment NonGcodeLine NonGCodeFunction SimpleOperator",maxTerm:94,nodeProps:[["closedBy",9,"EndFunction",11,"EndWhile",13,"EndDialog",15,"EndIf",40,"CExpressionEnd",42,"ParenClose"],["openedBy",10,"StartFunction",12,"StartWhile",14,"StartDialog",16,"StartIf",44,"ParenOpen",50,"CExpressionStart"]],skippedNodes:[0],repeatNodeCount:8,tokenData:"+w~RqXY#Ypq#Yqr#ers#rst#wtu$`vw%Twx%]xy%byz%iz{%p{|%w|}'_}!O%w!O!P'd!P!Q%p!Q![&|!]!^'t!^!_*X!_!`#e!`!a*X!b!c(z!c!}*c!}#O+S#P#Q+S#R#S*c#T#o*c#o#p+X#p#q+d#q#r+l$g;'S$`;'S;=`$}<%lO$`~#_Q!r~XY#Ypq#YY#jP!eQ!_!`#mW#rO}W~#wO!T~~#|S!]~OY#wZ;'S#w;'S;=`$Y<%lO#w~$]P;=`<%l#wU$eW!tUtu$`!Q![$`!c!}$`#R#S$`#T#o$`$g;'S$`;'S;=`$}<%lO$`U%QP;=`<%l$`Y%YP!eQvw#m~%bOw~V%iOzT!eQ_%pO|]!eQY%wO}W!eQ_%|Q}W!O!P&S!Q![&|V&XR!zV!Q![&S!g!h&b#X#Y&bV&eR{|&n}!O&n!Q![&tV&qP!Q![&tV&yP!zV!Q![&tV'RS!zV!O!P&S!Q![&|!g!h&b#X#Y&b~'dO{~_'kR!QW!zV!Q![&S!g!h&b#X#Y&b~'wVOY(^YZ(uZ!b(^!b!c(z!c;'S(^;'S;=`(o<%lO(^~(cS!b~OY(^Z;'S(^;'S;=`(o<%lO(^~(rP;=`<%l(^~(zO!b~~(}Vtu)d!c!})d#R#S)d#T#o)d$g;'S)d;'S;=`*R<%lO)d~)iW#P~tu)d!Q![)d!c!})d#R#S)d#T#o)d$g;'S)d;'S;=`*R<%lO)d~*UP;=`<%l)dY*`P}W!eQ!_!`#mV*jW#QP!tUtu$`!Q![$`!c!}*c#R#S*c#T#o*c$g;'S$`;'S;=`$}<%lO$`Q+XO!eQ~+[P#o#p+_~+dOx~Y+iP!eQ#p#q#m~+oP#q#r+r~+wO!S~",tokenizers:[DV,IV,kV,FV,BV,NV,UV,0,1,2,3],topRules:{Program:[0,33]},specialized:[{term:93,get:(t,e)=>rk(t,e)<<1,external:rk},{term:94,get:(t,e)=>nk(t,e)<<1,external:nk},{term:82,get:(t,e)=>sk(t,e)<<1,external:sk}],tokenPrec:0})});var Pk=ae((r1e,Ak)=>{Ak.exports={EndLine:1,RemainingLine:2,Special:3,GCodeLine:4,Section:5,Comment:6,ConfigOption:7,EmptyLine:8,Program:9}});var Rk={};yy(Rk,{gcodeLine:()=>yj,newlines:()=>gj,remainingLine:()=>_j,special:()=>vj});var Fi,gj,vj,_j,yj,Lk=_m(()=>{Ww();Fi=Qi(Pk()),gj=new Kr((t,e)=>{if(t.next<0)t.acceptToken(Fi.EndLine);else if(!(t.next!==10&&t.next!==13)){for(t.advance();t.next===10||t.next===13;)t.advance();t.acceptToken(Fi.EndLine)}},{contextual:!0,fallback:!0}),vj=new Kr((t,e)=>{let i=!1;for(;;){let r=String.fromCharCode(t.next);if(t.next<0||"!^~".indexOf(r)===-1){i?t.acceptToken(Fi.Special):t.acceptToken(-1);return}i=!0,t.advance()}},{contextual:!0,fallback:!0}),_j=new Kr((t,e)=>{let i=!1;for(;;){let r=String.fromCharCode(t.next);if(t.next===10||t.next<0||"!^~#".indexOf(r)!==-1){i?t.acceptToken(Fi.RemainingLine):t.acceptToken(-1);return}i=!0,t.advance()}},{contextual:!0,fallback:!0}),yj=new Kr((t,e)=>{let i=!1,r=!1,n=Fi.EmptyLine,o=0;for(;;){let a=String.fromCharCode(t.next);if(t.next===10||t.next<0){t.acceptToken(o?n:-1);return}if(!i&&a==="["&&(n=Fi.Section),!i&&a==="#"&&(n=Fi.Comment),i&&(a===" "||t.next===9)&&(r=!0),!i&&a===":"&&(n=Fi.ConfigOption),i&&!r&&a===":"&&(n===Fi.EmptyLine||n===Fi.GCodeLine)){t.acceptToken(Fi.ConfigOption);return}if(i&&a==="#"){t.acceptToken(n);return}a!==" "&&t.next!==9&&(!i&&n===Fi.EmptyLine&&(n=Fi.GCodeLine),i=!0),t.advance(),o++}},{contextual:!0,fallback:!0})});var Dk=ae(Ok=>{var{LRParser:xj}=zw(),{newlines:bj,remainingLine:wj,special:Sj,gcodeLine:Cj}=(Lk(),fT(Rk));Ok.parser=xj.deserialize({version:14,states:"!|QQOWOOOcOPO'#CiOhOXO'#CiOpO_O'#CiOOOW'#Cf'#CfQQOWOOOOOW,59T,59TO!OOPO,59TOOO_'#Cg'#CgO!TO_O,59TOOOW-E6d-E6dOOOW1G.o1G.oOOO_-E6e-E6eO!cOPO1G.oOOOW7+$Z7+$Z",stateData:"!h~OSQOTQOUPOVROWPO~OPUO~OPUOUVO~OPUOQWORWOUVO~OPZO~OPZOQWORWOU]O~OP^O~O",goto:"o^PPPPPPPPPP_ePkQTORYTQXRR[XTSOT",nodeNames:"\u26A0 EndLine RemainingLine Special GCodeLine Section Comment ConfigOption EmptyLine Program",maxTerm:13,skippedNodes:[0],repeatNodeCount:2,tokenData:"RORO",tokenizers:[bj,wj,Sj,Cj],topRules:{Program:[0,9]},tokenPrec:0})});var h1=ae((G1e,qk)=>{"use strict";qk.exports=function(e,i){return function(){for(var n=new Array(arguments.length),o=0;o<n.length;o++)n[o]=arguments[o];return e.apply(i,n)}}});var pr=ae((z1e,Zk)=>{"use strict";var Yj=h1(),c1=Object.prototype.toString,f1=function(t){return function(e){var i=c1.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())}}(Object.create(null));function Xl(t){return t=t.toLowerCase(),function(i){return f1(i)===t}}function d1(t){return Array.isArray(t)}function h0(t){return typeof t=="undefined"}function Zj(t){return t!==null&&!h0(t)&&t.constructor!==null&&!h0(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}var Xk=Xl("ArrayBuffer");function Kj(t){var e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Xk(t.buffer),e}function Qj(t){return typeof t=="string"}function Jj(t){return typeof t=="number"}function Yk(t){return t!==null&&typeof t=="object"}function l0(t){if(f1(t)!=="object")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}var $j=Xl("Date"),e7=Xl("File"),t7=Xl("Blob"),i7=Xl("FileList");function p1(t){return c1.call(t)==="[object Function]"}function r7(t){return Yk(t)&&p1(t.pipe)}function n7(t){var e="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||c1.call(t)===e||p1(t.toString)&&t.toString()===e)}var s7=Xl("URLSearchParams");function o7(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function a7(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function m1(t,e){if(!(t===null||typeof t=="undefined"))if(typeof t!="object"&&(t=[t]),d1(t))for(var i=0,r=t.length;i<r;i++)e.call(null,t[i],i,t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.call(null,t[n],n,t)}function u1(){var t={};function e(n,o){l0(t[o])&&l0(n)?t[o]=u1(t[o],n):l0(n)?t[o]=u1({},n):d1(n)?t[o]=n.slice():t[o]=n}for(var i=0,r=arguments.length;i<r;i++)m1(arguments[i],e);return t}function l7(t,e,i){return m1(e,function(n,o){i&&typeof n=="function"?t[o]=Yj(n,i):t[o]=n}),t}function h7(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function u7(t,e,i,r){t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,i&&Object.assign(t.prototype,i)}function c7(t,e,i){var r,n,o,a={};e=e||{};do{for(r=Object.getOwnPropertyNames(t),n=r.length;n-- >0;)o=r[n],a[o]||(e[o]=t[o],a[o]=!0);t=Object.getPrototypeOf(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e}function f7(t,e,i){t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;var r=t.indexOf(e,i);return r!==-1&&r===i}function d7(t){if(!t)return null;var e=t.length;if(h0(e))return null;for(var i=new Array(e);e-- >0;)i[e]=t[e];return i}var p7=function(t){return function(e){return t&&e instanceof t}}(typeof Uint8Array!="undefined"&&Object.getPrototypeOf(Uint8Array));Zk.exports={isArray:d1,isArrayBuffer:Xk,isBuffer:Zj,isFormData:n7,isArrayBufferView:Kj,isString:Qj,isNumber:Jj,isObject:Yk,isPlainObject:l0,isUndefined:h0,isDate:$j,isFile:e7,isBlob:t7,isFunction:p1,isStream:r7,isURLSearchParams:s7,isStandardBrowserEnv:a7,forEach:m1,merge:u1,extend:l7,trim:o7,stripBOM:h7,inherits:u7,toFlatObject:c7,kindOf:f1,kindOfTest:Xl,endsWith:f7,toArray:d7,isTypedArray:p7,isFileList:i7}});var g1=ae((H1e,Qk)=>{"use strict";var Cu=pr();function Kk(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}Qk.exports=function(e,i,r){if(!i)return e;var n;if(r)n=r(i);else if(Cu.isURLSearchParams(i))n=i.toString();else{var o=[];Cu.forEach(i,function(h,u){h===null||typeof h=="undefined"||(Cu.isArray(h)?u=u+"[]":h=[h],Cu.forEach(h,function(f){Cu.isDate(f)?f=f.toISOString():Cu.isObject(f)&&(f=JSON.stringify(f)),o.push(Kk(u)+"="+Kk(f))}))}),n=o.join("&")}if(n){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+n}return e}});var $k=ae((W1e,Jk)=>{"use strict";var m7=pr();function u0(){this.handlers=[]}u0.prototype.use=function(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};u0.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};u0.prototype.forEach=function(e){m7.forEach(this.handlers,function(r){r!==null&&e(r)})};Jk.exports=u0});var t3=ae((V1e,e3)=>{"use strict";var g7=pr();e3.exports=function(e,i){g7.forEach(e,function(n,o){o!==i&&o.toUpperCase()===i.toUpperCase()&&(e[i]=n,delete e[o])})}});var Yl=ae((j1e,s3)=>{"use strict";var i3=pr();function Mu(t,e,i,r,n){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n)}i3.inherits(Mu,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var r3=Mu.prototype,n3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(t){n3[t]={value:t}});Object.defineProperties(Mu,n3);Object.defineProperty(r3,"isAxiosError",{value:!0});Mu.from=function(t,e,i,r,n,o){var a=Object.create(r3);return i3.toFlatObject(t,a,function(h){return h!==Error.prototype}),Mu.call(a,t.message,e,i,r,n),a.name=t.name,o&&Object.assign(a,o),a};s3.exports=Mu});var v1=ae((q1e,o3)=>{"use strict";o3.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}});var _1=ae((X1e,a3)=>{"use strict";var Is=pr();function v7(t,e){e=e||new FormData;var i=[];function r(o){return o===null?"":Is.isDate(o)?o.toISOString():Is.isArrayBuffer(o)||Is.isTypedArray(o)?typeof Blob=="function"?new Blob([o]):Buffer.from(o):o}function n(o,a){if(Is.isPlainObject(o)||Is.isArray(o)){if(i.indexOf(o)!==-1)throw Error("Circular reference detected in "+a);i.push(o),Is.forEach(o,function(h,u){if(!Is.isUndefined(h)){var c=a?a+"."+u:u,f;if(h&&!a&&typeof h=="object"){if(Is.endsWith(u,"{}"))h=JSON.stringify(h);else if(Is.endsWith(u,"[]")&&(f=Is.toArray(h))){f.forEach(function(d){!Is.isUndefined(d)&&e.append(c,r(d))});return}}n(h,c)}}),i.pop()}else e.append(a,r(o))}return n(t),e}a3.exports=v7});var h3=ae((Y1e,l3)=>{"use strict";var y1=Yl();l3.exports=function(e,i,r){var n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):i(new y1("Request failed with status code "+r.status,[y1.ERR_BAD_REQUEST,y1.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}});var c3=ae((Z1e,u3)=>{"use strict";var c0=pr();u3.exports=c0.isStandardBrowserEnv()?function(){return{write:function(i,r,n,o,a,l){var h=[];h.push(i+"="+encodeURIComponent(r)),c0.isNumber(n)&&h.push("expires="+new Date(n).toGMTString()),c0.isString(o)&&h.push("path="+o),c0.isString(a)&&h.push("domain="+a),l===!0&&h.push("secure"),document.cookie=h.join("; ")},read:function(i){var r=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()});var d3=ae((K1e,f3)=>{"use strict";f3.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}});var m3=ae((Q1e,p3)=>{"use strict";p3.exports=function(e,i){return i?e.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):e}});var x1=ae((J1e,g3)=>{"use strict";var _7=d3(),y7=m3();g3.exports=function(e,i){return e&&!_7(i)?y7(e,i):i}});var _3=ae(($1e,v3)=>{"use strict";var b1=pr(),x7=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];v3.exports=function(e){var i={},r,n,o;return e&&b1.forEach(e.split(`
`),function(l){if(o=l.indexOf(":"),r=b1.trim(l.substr(0,o)).toLowerCase(),n=b1.trim(l.substr(o+1)),r){if(i[r]&&x7.indexOf(r)>=0)return;r==="set-cookie"?i[r]=(i[r]?i[r]:[]).concat([n]):i[r]=i[r]?i[r]+", "+n:n}}),i}});var b3=ae((eSe,x3)=>{"use strict";var y3=pr();x3.exports=y3.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a"),r;function n(o){var a=o;return e&&(i.setAttribute("href",a),a=i.href),i.setAttribute("href",a),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return r=n(window.location.href),function(a){var l=y3.isString(a)?n(a):a;return l.protocol===r.protocol&&l.host===r.host}}():function(){return function(){return!0}}()});var Uf=ae((tSe,S3)=>{"use strict";var w1=Yl(),b7=pr();function w3(t){w1.call(this,t==null?"canceled":t,w1.ERR_CANCELED),this.name="CanceledError"}b7.inherits(w3,w1,{__CANCEL__:!0});S3.exports=w3});var M3=ae((iSe,C3)=>{"use strict";C3.exports=function(e){var i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return i&&i[1]||""}});var S1=ae((rSe,E3)=>{"use strict";var Gf=pr(),w7=h3(),S7=c3(),C7=g1(),M7=x1(),E7=_3(),T7=b3(),A7=v1(),ea=Yl(),P7=Uf(),R7=M3();E3.exports=function(e){return new Promise(function(r,n){var o=e.data,a=e.headers,l=e.responseType,h;function u(){e.cancelToken&&e.cancelToken.unsubscribe(h),e.signal&&e.signal.removeEventListener("abort",h)}Gf.isFormData(o)&&Gf.isStandardBrowserEnv()&&delete a["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",d=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.Authorization="Basic "+btoa(f+":"+d)}var m=M7(e.baseURL,e.url);c.open(e.method.toUpperCase(),C7(m,e.params,e.paramsSerializer),!0),c.timeout=e.timeout;function v(){if(c){var _="getAllResponseHeaders"in c?E7(c.getAllResponseHeaders()):null,x=!l||l==="text"||l==="json"?c.responseText:c.response,b={data:x,status:c.status,statusText:c.statusText,headers:_,config:e,request:c};w7(function(w){r(w),u()},function(w){n(w),u()},b),c=null}}if("onloadend"in c?c.onloadend=v:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(v)},c.onabort=function(){c&&(n(new ea("Request aborted",ea.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new ea("Network Error",ea.ERR_NETWORK,e,c,c)),c=null},c.ontimeout=function(){var x=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",b=e.transitional||A7;e.timeoutErrorMessage&&(x=e.timeoutErrorMessage),n(new ea(x,b.clarifyTimeoutError?ea.ETIMEDOUT:ea.ECONNABORTED,e,c)),c=null},Gf.isStandardBrowserEnv()){var g=(e.withCredentials||T7(m))&&e.xsrfCookieName?S7.read(e.xsrfCookieName):void 0;g&&(a[e.xsrfHeaderName]=g)}"setRequestHeader"in c&&Gf.forEach(a,function(x,b){typeof o=="undefined"&&b.toLowerCase()==="content-type"?delete a[b]:c.setRequestHeader(b,x)}),Gf.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),l&&l!=="json"&&(c.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&c.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(h=function(_){c&&(n(!_||_&&_.type?new P7:_),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(h),e.signal&&(e.signal.aborted?h():e.signal.addEventListener("abort",h))),o||(o=null);var p=R7(m);if(p&&["http","https","file"].indexOf(p)===-1){n(new ea("Unsupported protocol "+p+":",ea.ERR_BAD_REQUEST,e));return}c.send(o)})}});var A3=ae((nSe,T3)=>{T3.exports=null});var d0=ae((sSe,O3)=>{"use strict";var mr=pr(),P3=t3(),R3=Yl(),L7=v1(),O7=_1(),D7={"Content-Type":"application/x-www-form-urlencoded"};function L3(t,e){!mr.isUndefined(t)&&mr.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function I7(){var t;return typeof XMLHttpRequest!="undefined"?t=S1():typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]"&&(t=S1()),t}function k7(t,e,i){if(mr.isString(t))try{return(e||JSON.parse)(t),mr.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}var f0={transitional:L7,adapter:I7(),transformRequest:[function(e,i){if(P3(i,"Accept"),P3(i,"Content-Type"),mr.isFormData(e)||mr.isArrayBuffer(e)||mr.isBuffer(e)||mr.isStream(e)||mr.isFile(e)||mr.isBlob(e))return e;if(mr.isArrayBufferView(e))return e.buffer;if(mr.isURLSearchParams(e))return L3(i,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var r=mr.isObject(e),n=i&&i["Content-Type"],o;if((o=mr.isFileList(e))||r&&n==="multipart/form-data"){var a=this.env&&this.env.FormData;return O7(o?{"files[]":e}:e,a&&new a)}else if(r||n==="application/json")return L3(i,"application/json"),k7(e);return e}],transformResponse:[function(e){var i=this.transitional||f0.transitional,r=i&&i.silentJSONParsing,n=i&&i.forcedJSONParsing,o=!r&&this.responseType==="json";if(o||n&&mr.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?R3.from(a,R3.ERR_BAD_RESPONSE,this,null,this.response):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:A3()},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};mr.forEach(["delete","get","head"],function(e){f0.headers[e]={}});mr.forEach(["post","put","patch"],function(e){f0.headers[e]=mr.merge(D7)});O3.exports=f0});var I3=ae((oSe,D3)=>{"use strict";var F7=pr(),B7=d0();D3.exports=function(e,i,r){var n=this||B7;return F7.forEach(r,function(a){e=a.call(n,e,i)}),e}});var C1=ae((aSe,k3)=>{"use strict";k3.exports=function(e){return!!(e&&e.__CANCEL__)}});var N3=ae((lSe,B3)=>{"use strict";var F3=pr(),M1=I3(),N7=C1(),U7=d0(),G7=Uf();function E1(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new G7}B3.exports=function(e){E1(e),e.headers=e.headers||{},e.data=M1.call(e,e.data,e.headers,e.transformRequest),e.headers=F3.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),F3.forEach(["delete","get","head","post","put","patch","common"],function(n){delete e.headers[n]});var i=e.adapter||U7.adapter;return i(e).then(function(n){return E1(e),n.data=M1.call(e,n.data,n.headers,e.transformResponse),n},function(n){return N7(n)||(E1(e),n&&n.response&&(n.response.data=M1.call(e,n.response.data,n.response.headers,e.transformResponse))),Promise.reject(n)})}});var T1=ae((hSe,U3)=>{"use strict";var Dn=pr();U3.exports=function(e,i){i=i||{};var r={};function n(c,f){return Dn.isPlainObject(c)&&Dn.isPlainObject(f)?Dn.merge(c,f):Dn.isPlainObject(f)?Dn.merge({},f):Dn.isArray(f)?f.slice():f}function o(c){if(Dn.isUndefined(i[c])){if(!Dn.isUndefined(e[c]))return n(void 0,e[c])}else return n(e[c],i[c])}function a(c){if(!Dn.isUndefined(i[c]))return n(void 0,i[c])}function l(c){if(Dn.isUndefined(i[c])){if(!Dn.isUndefined(e[c]))return n(void 0,e[c])}else return n(void 0,i[c])}function h(c){if(c in i)return n(e[c],i[c]);if(c in e)return n(void 0,e[c])}var u={url:a,method:a,data:a,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:h};return Dn.forEach(Object.keys(e).concat(Object.keys(i)),function(f){var d=u[f]||o,m=d(f);Dn.isUndefined(m)&&d!==h||(r[f]=m)}),r}});var A1=ae((uSe,G3)=>{G3.exports={version:"0.27.2"}});var W3=ae((cSe,H3)=>{"use strict";var z7=A1().version,Ka=Yl(),P1={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){P1[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});var z3={};P1.transitional=function(e,i,r){function n(o,a){return"[Axios v"+z7+"] Transitional option '"+o+"'"+a+(r?". "+r:"")}return function(o,a,l){if(e===!1)throw new Ka(n(a," has been removed"+(i?" in "+i:"")),Ka.ERR_DEPRECATED);return i&&!z3[a]&&(z3[a]=!0,console.warn(n(a," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(o,a,l):!0}};function H7(t,e,i){if(typeof t!="object")throw new Ka("options must be an object",Ka.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(t),n=r.length;n-- >0;){var o=r[n],a=e[o];if(a){var l=t[o],h=l===void 0||a(l,o,t);if(h!==!0)throw new Ka("option "+o+" must be "+h,Ka.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Ka("Unknown option "+o,Ka.ERR_BAD_OPTION)}}H3.exports={assertOptions:H7,validators:P1}});var Z3=ae((fSe,Y3)=>{"use strict";var q3=pr(),W7=g1(),V3=$k(),j3=N3(),p0=T1(),V7=x1(),X3=W3(),Eu=X3.validators;function Tu(t){this.defaults=t,this.interceptors={request:new V3,response:new V3}}Tu.prototype.request=function(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=p0(this.defaults,i),i.method?i.method=i.method.toLowerCase():this.defaults.method?i.method=this.defaults.method.toLowerCase():i.method="get";var r=i.transitional;r!==void 0&&X3.assertOptions(r,{silentJSONParsing:Eu.transitional(Eu.boolean),forcedJSONParsing:Eu.transitional(Eu.boolean),clarifyTimeoutError:Eu.transitional(Eu.boolean)},!1);var n=[],o=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(o=o&&m.synchronous,n.unshift(m.fulfilled,m.rejected))});var a=[];this.interceptors.response.forEach(function(m){a.push(m.fulfilled,m.rejected)});var l;if(!o){var h=[j3,void 0];for(Array.prototype.unshift.apply(h,n),h=h.concat(a),l=Promise.resolve(i);h.length;)l=l.then(h.shift(),h.shift());return l}for(var u=i;n.length;){var c=n.shift(),f=n.shift();try{u=c(u)}catch(d){f(d);break}}try{l=j3(u)}catch(d){return Promise.reject(d)}for(;a.length;)l=l.then(a.shift(),a.shift());return l};Tu.prototype.getUri=function(e){e=p0(this.defaults,e);var i=V7(e.baseURL,e.url);return W7(i,e.params,e.paramsSerializer)};q3.forEach(["delete","get","head","options"],function(e){Tu.prototype[e]=function(i,r){return this.request(p0(r||{},{method:e,url:i,data:(r||{}).data}))}});q3.forEach(["post","put","patch"],function(e){function i(r){return function(o,a,l){return this.request(p0(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}Tu.prototype[e]=i(),Tu.prototype[e+"Form"]=i(!0)});Y3.exports=Tu});var Q3=ae((dSe,K3)=>{"use strict";var j7=Uf();function Au(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(n){e=n});var i=this;this.promise.then(function(r){if(i._listeners){var n,o=i._listeners.length;for(n=0;n<o;n++)i._listeners[n](r);i._listeners=null}}),this.promise.then=function(r){var n,o=new Promise(function(a){i.subscribe(a),n=a}).then(r);return o.cancel=function(){i.unsubscribe(n)},o},t(function(n){i.reason||(i.reason=new j7(n),e(i.reason))})}Au.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};Au.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]};Au.prototype.unsubscribe=function(e){if(this._listeners){var i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}};Au.source=function(){var e,i=new Au(function(n){e=n});return{token:i,cancel:e}};K3.exports=Au});var $3=ae((pSe,J3)=>{"use strict";J3.exports=function(e){return function(r){return e.apply(null,r)}}});var tF=ae((mSe,eF)=>{"use strict";var q7=pr();eF.exports=function(e){return q7.isObject(e)&&e.isAxiosError===!0}});var nF=ae((gSe,R1)=>{"use strict";var iF=pr(),X7=h1(),m0=Z3(),Y7=T1(),Z7=d0();function rF(t){var e=new m0(t),i=X7(m0.prototype.request,e);return iF.extend(i,m0.prototype,e),iF.extend(i,e),i.create=function(n){return rF(Y7(t,n))},i}var gn=rF(Z7);gn.Axios=m0;gn.CanceledError=Uf();gn.CancelToken=Q3();gn.isCancel=C1();gn.VERSION=A1().version;gn.toFormData=_1();gn.AxiosError=Yl();gn.Cancel=gn.CanceledError;gn.all=function(e){return Promise.all(e)};gn.spread=$3();gn.isAxiosError=tF();R1.exports=gn;R1.exports.default=gn});var ta=ae((vSe,sF)=>{sF.exports=nF()});var aF=ae((k1,oF)=>{oF.exports=I1(typeof Buffer!="undefined"&&Buffer)||I1(k1.Buffer)||I1(typeof window!="undefined"&&window.Buffer)||k1.Buffer;function I1(t){return t&&t.isBuffer&&t}});var v0=ae((MSe,lF)=>{var Q7={}.toString;lF.exports=Array.isArray||function(t){return Q7.call(t)=="[object Array]"}});var cF=ae((Ru,uF)=>{var Pu=In(),Ru=uF.exports=hF(0);Ru.alloc=hF;Ru.concat=Pu.concat;Ru.from=J7;function hF(t){return new Array(t)}function J7(t){if(!Pu.isBuffer(t)&&Pu.isView(t))t=Pu.Uint8Array.from(t);else if(Pu.isArrayBuffer(t))t=new Uint8Array(t);else{if(typeof t=="string")return Pu.from.call(Ru,t);if(typeof t=="number")throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(t)}});var pF=ae((Ou,dF)=>{var ia=In(),Lu=ia.global,Ou=dF.exports=ia.hasBuffer?fF(0):[];Ou.alloc=ia.hasBuffer&&Lu.alloc||fF;Ou.concat=ia.concat;Ou.from=$7;function fF(t){return new Lu(t)}function $7(t){if(!ia.isBuffer(t)&&ia.isView(t))t=ia.Uint8Array.from(t);else if(ia.isArrayBuffer(t))t=new Uint8Array(t);else{if(typeof t=="string")return ia.from.call(Ou,t);if(typeof t=="number")throw new TypeError('"value" argument must not be a number')}return Lu.from&&Lu.from.length!==1?Lu.from(t):new Lu(t)}});var vF=ae((Du,gF)=>{var _0=In(),Du=gF.exports=_0.hasArrayBuffer?mF(0):[];Du.alloc=mF;Du.concat=_0.concat;Du.from=eq;function mF(t){return new Uint8Array(t)}function eq(t){if(_0.isView(t)){var e=t.byteOffset,i=t.byteLength;t=t.buffer,t.byteLength!==i&&(t.slice?t=t.slice(e,e+i):(t=new Uint8Array(t),t.byteLength!==i&&(t=Array.prototype.slice.call(t,e,e+i))))}else{if(typeof t=="string")return _0.from.call(Du,t);if(typeof t=="number")throw new TypeError('"value" argument must not be a number')}return new Uint8Array(t)}});var _F=ae(y0=>{y0.copy=rq;y0.toString=iq;y0.write=tq;function tq(t,e){for(var i=this,r=e||(e|=0),n=t.length,o=0,a=0;a<n;)o=t.charCodeAt(a++),o<128?i[r++]=o:o<2048?(i[r++]=192|o>>>6,i[r++]=128|o&63):o<55296||o>57343?(i[r++]=224|o>>>12,i[r++]=128|o>>>6&63,i[r++]=128|o&63):(o=(o-55296<<10|t.charCodeAt(a++)-56320)+65536,i[r++]=240|o>>>18,i[r++]=128|o>>>12&63,i[r++]=128|o>>>6&63,i[r++]=128|o&63);return r-e}function iq(t,e,i){var r=this,n=e|0;i||(i=r.length);for(var o="",a=0;n<i;){if(a=r[n++],a<128){o+=String.fromCharCode(a);continue}(a&224)===192?a=(a&31)<<6|r[n++]&63:(a&240)===224?a=(a&15)<<12|(r[n++]&63)<<6|r[n++]&63:(a&248)===240&&(a=(a&7)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63),a>=65536?(a-=65536,o+=String.fromCharCode((a>>>10)+55296,(a&1023)+56320)):o+=String.fromCharCode(a)}return o}function rq(t,e,i,r){var n;i||(i=0),!r&&r!==0&&(r=this.length),e||(e=0);var o=r-i;if(t===this&&i<e&&e<r)for(n=o-1;n>=0;n--)t[n+e]=this[n+i];else for(n=0;n<o;n++)t[n+e]=this[n+i];return o}});var x0=ae(zf=>{var F1=_F();zf.copy=wF;zf.slice=SF;zf.toString=nq;zf.write=sq("write");var Qa=In(),yF=Qa.global,xF=Qa.hasBuffer&&"TYPED_ARRAY_SUPPORT"in yF,bF=xF&&!yF.TYPED_ARRAY_SUPPORT;function wF(t,e,i,r){var n=Qa.isBuffer(this),o=Qa.isBuffer(t);if(n&&o)return this.copy(t,e,i,r);if(!bF&&!n&&!o&&Qa.isView(this)&&Qa.isView(t)){var a=i||r!=null?SF.call(this,i,r):this;return t.set(a,e),a.length}else return F1.copy.call(this,t,e,i,r)}function SF(t,e){var i=this.slice||!bF&&this.subarray;if(i)return i.call(this,t,e);var r=Qa.alloc.call(this,e-t);return wF.call(this,r,0,t,e),r}function nq(t,e,i){var r=!xF&&Qa.isBuffer(this)?this.toString:F1.toString;return r.apply(this,arguments)}function sq(t){return e;function e(){var i=this[t]||F1[t];return i.apply(this,arguments)}}});var In=ae(Gr=>{var B1=Gr.global=aF(),TF=Gr.hasBuffer=B1&&!!B1.isBuffer,U1=Gr.hasArrayBuffer=typeof ArrayBuffer!="undefined",oq=Gr.isArray=v0();Gr.isArrayBuffer=U1?fq:z1;var aq=Gr.isBuffer=TF?B1.isBuffer:z1,lq=Gr.isView=U1?ArrayBuffer.isView||PF("ArrayBuffer","buffer"):z1;Gr.alloc=G1;Gr.concat=uq;Gr.from=hq;var CF=Gr.Array=cF(),MF=Gr.Buffer=pF(),EF=Gr.Uint8Array=vF(),N1=Gr.prototype=x0();function hq(t){return typeof t=="string"?dq.call(this,t):AF(this).from(t)}function G1(t){return AF(this).alloc(t)}function uq(t,e){e||(e=0,Array.prototype.forEach.call(t,o));var i=this!==Gr&&this||t[0],r=G1.call(i,e),n=0;return Array.prototype.forEach.call(t,a),r;function o(l){e+=l.length}function a(l){n+=N1.copy.call(l,r,n)}}var cq=PF("ArrayBuffer");function fq(t){return t instanceof ArrayBuffer||cq(t)}function dq(t){var e=t.length*3,i=G1.call(this,e),r=N1.write.call(i,t);return e!==r&&(i=N1.slice.call(i,0,r)),i}function AF(t){return aq(t)?MF:lq(t)?EF:oq(t)?CF:TF?MF:U1?EF:CF}function z1(){return!1}function PF(t,e){return t="[object "+t+"]",function(i){return i!=null&&{}.toString.call(e?i[e]:i)===t}}});var b0=ae(RF=>{RF.ExtBuffer=H1;var pq=In();function H1(t,e){if(!(this instanceof H1))return new H1(t,e);this.buffer=pq.from(t),this.type=e}});var OF=ae(LF=>{LF.setExtPackers=vq;var w0=In(),mq=w0.global,Fs=w0.Uint8Array.from,W1,gq={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function vq(t){t.addExtPacker(14,Error,[Zl,hs]),t.addExtPacker(1,EvalError,[Zl,hs]),t.addExtPacker(2,RangeError,[Zl,hs]),t.addExtPacker(3,ReferenceError,[Zl,hs]),t.addExtPacker(4,SyntaxError,[Zl,hs]),t.addExtPacker(5,TypeError,[Zl,hs]),t.addExtPacker(6,URIError,[Zl,hs]),t.addExtPacker(10,RegExp,[_q,hs]),t.addExtPacker(11,Boolean,[V1,hs]),t.addExtPacker(12,String,[V1,hs]),t.addExtPacker(13,Date,[Number,hs]),t.addExtPacker(15,Number,[V1,hs]),typeof Uint8Array!="undefined"&&(t.addExtPacker(17,Int8Array,Fs),t.addExtPacker(18,Uint8Array,Fs),t.addExtPacker(19,Int16Array,Fs),t.addExtPacker(20,Uint16Array,Fs),t.addExtPacker(21,Int32Array,Fs),t.addExtPacker(22,Uint32Array,Fs),t.addExtPacker(23,Float32Array,Fs),typeof Float64Array!="undefined"&&t.addExtPacker(24,Float64Array,Fs),typeof Uint8ClampedArray!="undefined"&&t.addExtPacker(25,Uint8ClampedArray,Fs),t.addExtPacker(26,ArrayBuffer,Fs),t.addExtPacker(29,DataView,Fs)),w0.hasBuffer&&t.addExtPacker(27,mq,w0.from)}function hs(t){return W1||(W1=j1().encode),W1(t)}function V1(t){return t.valueOf()}function _q(t){t=RegExp.prototype.toString.call(t).split("/"),t.shift();var e=[t.pop()];return e.unshift(t.join("/")),e}function Zl(t){var e={};for(var i in gq)e[i]=t[i];return e}});var S0=ae(Hf=>{var yq,xq,bq,wq;(function(t){var e="undefined",i=e!==typeof Buffer&&Buffer,r=e!==typeof Uint8Array&&Uint8Array,n=e!==typeof ArrayBuffer&&ArrayBuffer,o=[0,0,0,0,0,0,0,0],a=Array.isArray||w,l=4294967296,h=16777216,u;yq=c("Uint64BE",!0,!0),xq=c("Int64BE",!0,!1),bq=c("Uint64LE",!1,!0),wq=c("Int64LE",!1,!1);function c(S,R,E){var T=R?0:4,A=R?4:0,C=R?0:3,M=R?1:2,D=R?2:1,O=R?3:0,P=R?_:b,L=R?x:y,I=F.prototype,k="is"+S,B="_"+k;return I.buffer=void 0,I.offset=0,I[B]=!0,I.toNumber=ne,I.toString=ie,I.toJSON=ne,I.toArray=f,i&&(I.toBuffer=d),r&&(I.toArrayBuffer=m),F[k]=W,t[S]=F,F;function F(de,re,Y,U){return this instanceof F?V(this,de,re,Y,U):new F(de,re,Y,U)}function W(de){return!!(de&&de[B])}function V(de,re,Y,U,z){if(r&&n&&(re instanceof n&&(re=new r(re)),U instanceof n&&(U=new r(U))),!re&&!Y&&!U&&!u){de.buffer=p(o,0);return}if(!v(re,Y)){var te=u||Array;z=Y,U=re,Y=0,re=new te(8)}de.buffer=re,de.offset=Y|=0,e!==typeof U&&(typeof U=="string"?N(re,Y,U,z||10):v(U,z)?g(re,Y,U,z):typeof z=="number"?(Q(re,Y+T,U),Q(re,Y+A,z)):U>0?P(re,Y,U):U<0?L(re,Y,U):g(re,Y,o,0))}function N(de,re,Y,U){var z=0,te=Y.length,ge=0,Me=0;Y[0]==="-"&&z++;for(var ze=z;z<te;){var He=parseInt(Y[z++],U);if(!(He>=0))break;Me=Me*U+He,ge=ge*U+Math.floor(Me/l),Me%=l}ze&&(ge=~ge,Me?Me=l-Me:ge++),Q(de,re+T,ge),Q(de,re+A,Me)}function ne(){var de=this.buffer,re=this.offset,Y=K(de,re+T),U=K(de,re+A);return E||(Y|=0),Y?Y*l+U:U}function ie(de){var re=this.buffer,Y=this.offset,U=K(re,Y+T),z=K(re,Y+A),te="",ge=!E&&U&2147483648;for(ge&&(U=~U,z=l-z),de=de||10;;){var Me=U%de*l+z;if(U=Math.floor(U/de),z=Math.floor(Me/de),te=(Me%de).toString(de)+te,!U&&!z)break}return ge&&(te="-"+te),te}function Q(de,re,Y){de[re+O]=Y&255,Y=Y>>8,de[re+D]=Y&255,Y=Y>>8,de[re+M]=Y&255,Y=Y>>8,de[re+C]=Y&255}function K(de,re){return de[re+C]*h+(de[re+M]<<16)+(de[re+D]<<8)+de[re+O]}}function f(S){var R=this.buffer,E=this.offset;return u=null,S!==!1&&E===0&&R.length===8&&a(R)?R:p(R,E)}function d(S){var R=this.buffer,E=this.offset;if(u=i,S!==!1&&E===0&&R.length===8&&Buffer.isBuffer(R))return R;var T=new i(8);return g(T,0,R,E),T}function m(S){var R=this.buffer,E=this.offset,T=R.buffer;if(u=r,S!==!1&&E===0&&T instanceof n&&T.byteLength===8)return T;var A=new r(8);return g(A,0,R,E),A.buffer}function v(S,R){var E=S&&S.length;return R|=0,E&&R+8<=E&&typeof S[R]!="string"}function g(S,R,E,T){R|=0,T|=0;for(var A=0;A<8;A++)S[R++]=E[T++]&255}function p(S,R){return Array.prototype.slice.call(S,R,R+8)}function _(S,R,E){for(var T=R+8;T>R;)S[--T]=E&255,E/=256}function x(S,R,E){var T=R+8;for(E++;T>R;)S[--T]=-E&255^255,E/=256}function b(S,R,E){for(var T=R+8;R<T;)S[R++]=E&255,E/=256}function y(S,R,E){var T=R+8;for(E++;R<T;)S[R++]=-E&255^255,E/=256}function w(S){return!!S&&Object.prototype.toString.call(S)=="[object Array]"}})(typeof Hf=="object"&&typeof Hf.nodeName!="string"?Hf:Hf||{})});var X1=ae(q1=>{q1.read=function(t,e,i,r,n){var o,a,l=n*8-r-1,h=(1<<l)-1,u=h>>1,c=-7,f=i?n-1:0,d=i?-1:1,m=t[e+f];for(f+=d,o=m&(1<<-c)-1,m>>=-c,c+=l;c>0;o=o*256+t[e+f],f+=d,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=a*256+t[e+f],f+=d,c-=8);if(o===0)o=1-u;else{if(o===h)return a?NaN:(m?-1:1)*(1/0);a=a+Math.pow(2,r),o=o-u}return(m?-1:1)*a*Math.pow(2,o-r)};q1.write=function(t,e,i,r,n,o){var a,l,h,u=o*8-n-1,c=(1<<u)-1,f=c>>1,d=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:o-1,v=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-a))<1&&(a--,h*=2),a+f>=1?e+=d/h:e+=d*Math.pow(2,1-f),e*h>=2&&(a++,h/=2),a+f>=c?(l=0,a=c):a+f>=1?(l=(e*h-1)*Math.pow(2,n),a=a+f):(l=e*Math.pow(2,f-1)*Math.pow(2,n),a=0));n>=8;t[i+m]=l&255,m+=v,l/=256,n-=8);for(a=a<<n|l,u+=n;u>0;t[i+m]=a&255,m+=v,a/=256,u-=8);t[i+m-v]|=g*128}});var Y1=ae(DF=>{var Sq=DF.uint8=new Array(256);for(Wf=0;Wf<=255;Wf++)Sq[Wf]=Cq(Wf);var Wf;function Cq(t){return function(e){var i=e.reserve(1);e.buffer[i]=t}}});var VF=ae(WF=>{var kF=X1(),FF=S0(),Mq=FF.Uint64BE,Eq=FF.Int64BE,BF=Y1().uint8,C0=In(),ui=C0.global,Tq=C0.hasBuffer&&"TYPED_ARRAY_SUPPORT"in ui,Aq=Tq&&!ui.TYPED_ARRAY_SUPPORT,IF=C0.hasBuffer&&ui.prototype||{};WF.getWriteToken=Pq;function Pq(t){return t&&t.uint8array?Rq():Aq||C0.hasBuffer&&t&&t.safe?Lq():NF()}function Rq(){var t=NF();return t[202]=Yt(202,4,zF),t[203]=Yt(203,8,HF),t}function NF(){var t=BF.slice();return t[196]=Vf(196),t[197]=Kl(197),t[198]=Ql(198),t[199]=Vf(199),t[200]=Kl(200),t[201]=Ql(201),t[202]=Yt(202,4,IF.writeFloatBE||zF,!0),t[203]=Yt(203,8,IF.writeDoubleBE||HF,!0),t[204]=Vf(204),t[205]=Kl(205),t[206]=Ql(206),t[207]=Yt(207,8,UF),t[208]=Vf(208),t[209]=Kl(209),t[210]=Ql(210),t[211]=Yt(211,8,GF),t[217]=Vf(217),t[218]=Kl(218),t[219]=Ql(219),t[220]=Kl(220),t[221]=Ql(221),t[222]=Kl(222),t[223]=Ql(223),t}function Lq(){var t=BF.slice();return t[196]=Yt(196,1,ui.prototype.writeUInt8),t[197]=Yt(197,2,ui.prototype.writeUInt16BE),t[198]=Yt(198,4,ui.prototype.writeUInt32BE),t[199]=Yt(199,1,ui.prototype.writeUInt8),t[200]=Yt(200,2,ui.prototype.writeUInt16BE),t[201]=Yt(201,4,ui.prototype.writeUInt32BE),t[202]=Yt(202,4,ui.prototype.writeFloatBE),t[203]=Yt(203,8,ui.prototype.writeDoubleBE),t[204]=Yt(204,1,ui.prototype.writeUInt8),t[205]=Yt(205,2,ui.prototype.writeUInt16BE),t[206]=Yt(206,4,ui.prototype.writeUInt32BE),t[207]=Yt(207,8,UF),t[208]=Yt(208,1,ui.prototype.writeInt8),t[209]=Yt(209,2,ui.prototype.writeInt16BE),t[210]=Yt(210,4,ui.prototype.writeInt32BE),t[211]=Yt(211,8,GF),t[217]=Yt(217,1,ui.prototype.writeUInt8),t[218]=Yt(218,2,ui.prototype.writeUInt16BE),t[219]=Yt(219,4,ui.prototype.writeUInt32BE),t[220]=Yt(220,2,ui.prototype.writeUInt16BE),t[221]=Yt(221,4,ui.prototype.writeUInt32BE),t[222]=Yt(222,2,ui.prototype.writeUInt16BE),t[223]=Yt(223,4,ui.prototype.writeUInt32BE),t}function Vf(t){return function(e,i){var r=e.reserve(2),n=e.buffer;n[r++]=t,n[r]=i}}function Kl(t){return function(e,i){var r=e.reserve(3),n=e.buffer;n[r++]=t,n[r++]=i>>>8,n[r]=i}}function Ql(t){return function(e,i){var r=e.reserve(5),n=e.buffer;n[r++]=t,n[r++]=i>>>24,n[r++]=i>>>16,n[r++]=i>>>8,n[r]=i}}function Yt(t,e,i,r){return function(n,o){var a=n.reserve(e+1);n.buffer[a++]=t,i.call(n.buffer,o,a,r)}}function UF(t,e){new Mq(this,e,t)}function GF(t,e){new Eq(this,e,t)}function zF(t,e){kF.write(this,t,e,!1,23,4)}function HF(t,e){kF.write(this,t,e,!1,52,8)}});var ZF=ae(YF=>{var Oq=v0(),XF=S0(),Dq=XF.Uint64BE,Iq=XF.Int64BE,jF=In(),qF=x0(),kq=VF(),Fq=Y1().uint8,Bq=b0().ExtBuffer,Nq=typeof Uint8Array!="undefined",Uq=typeof Map!="undefined",Iu=[];Iu[1]=212;Iu[2]=213;Iu[4]=214;Iu[8]=215;Iu[16]=216;YF.getWriteType=Gq;function Gq(t){var e=kq.getWriteToken(t),i=t&&t.useraw,r=Nq&&t&&t.binarraybuffer,n=r?jF.isArrayBuffer:jF.isBuffer,o=r?w:y,a=Uq&&t&&t.usemap,l=a?E:R,h={boolean:u,function:x,number:c,object:i?_:p,string:g(i?v:m),symbol:x,undefined:x};return h;function u(A,C){var M=C?195:194;e[M](A,C)}function c(A,C){var M=C|0,D;if(C!==M){D=203,e[D](A,C);return}else-32<=M&&M<=127?D=M&255:0<=M?D=M<=255?204:M<=65535?205:206:D=-128<=M?208:-32768<=M?209:210;e[D](A,M)}function f(A,C){var M=207;e[M](A,C.toArray())}function d(A,C){var M=211;e[M](A,C.toArray())}function m(A){return A<32?1:A<=255?2:A<=65535?3:5}function v(A){return A<32?1:A<=65535?3:5}function g(A){return C;function C(M,D){var O=D.length,P=5+O*3;M.offset=M.reserve(P);var L=M.buffer,I=A(O),k=M.offset+I;O=qF.write.call(L,D,k);var B=A(O);if(I!==B){var F=k+B-I,W=k+O;qF.copy.call(L,L,F,k,W)}var V=B===1?160+O:B<=3?215+B:219;e[V](M,O),M.offset+=O}}function p(A,C){if(C===null)return x(A,C);if(n(C))return o(A,C);if(Oq(C))return b(A,C);if(Dq.isUint64BE(C))return f(A,C);if(Iq.isInt64BE(C))return d(A,C);var M=A.codec.getExtPacker(C);if(M&&(C=M(C)),C instanceof Bq)return S(A,C);l(A,C)}function _(A,C){if(n(C))return T(A,C);p(A,C)}function x(A,C){var M=192;e[M](A,C)}function b(A,C){var M=C.length,D=M<16?144+M:M<=65535?220:221;e[D](A,M);for(var O=A.codec.encode,P=0;P<M;P++)O(A,C[P])}function y(A,C){var M=C.length,D=M<255?196:M<=65535?197:198;e[D](A,M),A.send(C)}function w(A,C){y(A,new Uint8Array(C))}function S(A,C){var M=C.buffer,D=M.length,O=Iu[D]||(D<255?199:D<=65535?200:201);e[O](A,D),Fq[C.type](A),A.send(M)}function R(A,C){var M=Object.keys(C),D=M.length,O=D<16?128+D:D<=65535?222:223;e[O](A,D);var P=A.codec.encode;M.forEach(function(L){P(A,L),P(A,C[L])})}function E(A,C){if(!(C instanceof Map))return R(A,C);var M=C.size,D=M<16?128+M:M<=65535?222:223;e[D](A,M);var O=A.codec.encode;C.forEach(function(P,L,I){O(A,L),O(A,P)})}function T(A,C){var M=C.length,D=M<32?160+M:M<=65535?218:219;e[D](A,M),A.send(C)}}});var qf=ae(jf=>{var zq=v0();jf.createCodec=KF;jf.install=Wq;jf.filter=qq;var Hq=In();function ku(t){if(!(this instanceof ku))return new ku(t);this.options=t,this.init()}ku.prototype.init=function(){var t=this.options;return t&&t.uint8array&&(this.bufferish=Hq.Uint8Array),this};function Wq(t){for(var e in t)ku.prototype[e]=Vq(ku.prototype[e],t[e])}function Vq(t,e){return t&&e?i:t||e;function i(){return t.apply(this,arguments),e.apply(this,arguments)}}function jq(t){return t=t.slice(),function(i){return t.reduce(e,i)};function e(i,r){return r(i)}}function qq(t){return zq(t)?jq(t):t}function KF(t){return new ku(t)}jf.preset=KF({preset:!0})});var M0=ae(JF=>{var Xq=b0().ExtBuffer,Yq=OF(),Zq=ZF(),Z1=qf();Z1.install({addExtPacker:Qq,getExtPacker:Jq,init:QF});JF.preset=QF.call(Z1.preset);function Kq(t){var e=Zq.getWriteType(t);return i;function i(r,n){var o=e[typeof n];if(!o)throw new Error('Unsupported type "'+typeof n+'": '+n);o(r,n)}}function QF(){var t=this.options;return this.encode=Kq(t),t&&t.preset&&Yq.setExtPackers(this),this}function Qq(t,e,i){i=Z1.filter(i);var r=e.name;if(r&&r!=="Object"){var n=this.extPackers||(this.extPackers={});n[r]=a}else{var o=this.extEncoderList||(this.extEncoderList=[]);o.unshift([e,a])}function a(l){return i&&(l=i(l)),new Xq(l,t)}}function Jq(t){var e=this.extPackers||(this.extPackers={}),i=t.constructor,r=i&&i.name&&e[i.name];if(r)return r;for(var n=this.extEncoderList||(this.extEncoderList=[]),o=n.length,a=0;a<o;a++){var l=n[a];if(i===l[0])return l[1]}}});var Q1=ae(K1=>{K1.FlexDecoder=Fu;K1.FlexEncoder=Bu;var Xf=In(),$q=2048,eX=65536,$F="BUFFER_SHORTAGE";function Fu(){if(!(this instanceof Fu))return new Fu}function Bu(){if(!(this instanceof Bu))return new Bu}Fu.mixin=iB(tX());Fu.mixin(Fu.prototype);Bu.mixin=iB(iX());Bu.mixin(Bu.prototype);function tX(){return{bufferish:Xf,write:t,fetch:nX,flush:e,push:tB,pull:sX,read:eB,reserve:i,offset:0};function t(r){var n=this.offset?Xf.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=n?r?this.bufferish.concat([n,r]):n:r,this.offset=0}function e(){for(;this.offset<this.buffer.length;){var r=this.offset,n;try{n=this.fetch()}catch(o){if(o&&o.message!=$F)throw o;this.offset=r;break}this.push(n)}}function i(r){var n=this.offset,o=n+r;if(o>this.buffer.length)throw new Error($F);return this.offset=o,n}}function iX(){return{bufferish:Xf,write:rX,fetch:t,flush:e,push:tB,pull:i,read:eB,reserve:r,send:n,maxBufferSize:eX,minBufferSize:$q,offset:0,start:0};function t(){var o=this.start;if(o<this.offset){var a=this.start=this.offset;return Xf.prototype.slice.call(this.buffer,o,a)}}function e(){for(;this.start<this.offset;){var o=this.fetch();o&&this.push(o)}}function i(){var o=this.buffers||(this.buffers=[]),a=o.length>1?this.bufferish.concat(o):o[0];return o.length=0,a}function r(o){var a=o|0;if(this.buffer){var l=this.buffer.length,h=this.offset|0,u=h+a;if(u<l)return this.offset=u,h;this.flush(),o=Math.max(o,Math.min(l*2,this.maxBufferSize))}return o=Math.max(o,this.minBufferSize),this.buffer=this.bufferish.alloc(o),this.start=0,this.offset=a,0}function n(o){var a=o.length;if(a>this.minBufferSize)this.flush(),this.push(o);else{var l=this.reserve(a);Xf.prototype.copy.call(o,this.buffer,l)}}}function rX(){throw new Error("method not implemented: write()")}function nX(){throw new Error("method not implemented: fetch()")}function eB(){var t=this.buffers&&this.buffers.length;return t?(this.flush(),this.pull()):this.fetch()}function tB(t){var e=this.buffers||(this.buffers=[]);e.push(t)}function sX(){var t=this.buffers||(this.buffers=[]);return t.shift()}function iB(t){return e;function e(i){for(var r in t)i[r]=t[r];return i}}});var J1=ae(rB=>{rB.EncodeBuffer=Nu;var oX=M0().preset,aX=Q1().FlexEncoder;aX.mixin(Nu.prototype);function Nu(t){if(!(this instanceof Nu))return new Nu(t);if(t&&(this.options=t,t.codec)){var e=this.codec=t.codec;e.bufferish&&(this.bufferish=e.bufferish)}}Nu.prototype.codec=oX;Nu.prototype.write=function(t){this.codec.encode(this,t)}});var j1=ae(nB=>{nB.encode=hX;var lX=J1().EncodeBuffer;function hX(t,e){var i=new lX(e);return i.write(t),i.read()}});var aB=ae(oB=>{oB.setExtUnpackers=fX;var sB=In(),uX=sB.global,$1,cX={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function fX(t){t.addExtUnpacker(14,[us,Jl(Error)]),t.addExtUnpacker(1,[us,Jl(EvalError)]),t.addExtUnpacker(2,[us,Jl(RangeError)]),t.addExtUnpacker(3,[us,Jl(ReferenceError)]),t.addExtUnpacker(4,[us,Jl(SyntaxError)]),t.addExtUnpacker(5,[us,Jl(TypeError)]),t.addExtUnpacker(6,[us,Jl(URIError)]),t.addExtUnpacker(10,[us,dX]),t.addExtUnpacker(11,[us,Qr(Boolean)]),t.addExtUnpacker(12,[us,Qr(String)]),t.addExtUnpacker(13,[us,Qr(Date)]),t.addExtUnpacker(15,[us,Qr(Number)]),typeof Uint8Array!="undefined"&&(t.addExtUnpacker(17,Qr(Int8Array)),t.addExtUnpacker(18,Qr(Uint8Array)),t.addExtUnpacker(19,[Ja,Qr(Int16Array)]),t.addExtUnpacker(20,[Ja,Qr(Uint16Array)]),t.addExtUnpacker(21,[Ja,Qr(Int32Array)]),t.addExtUnpacker(22,[Ja,Qr(Uint32Array)]),t.addExtUnpacker(23,[Ja,Qr(Float32Array)]),typeof Float64Array!="undefined"&&t.addExtUnpacker(24,[Ja,Qr(Float64Array)]),typeof Uint8ClampedArray!="undefined"&&t.addExtUnpacker(25,Qr(Uint8ClampedArray)),t.addExtUnpacker(26,Ja),t.addExtUnpacker(29,[Ja,Qr(DataView)])),sB.hasBuffer&&t.addExtUnpacker(27,Qr(uX))}function us(t){return $1||($1=eS().decode),$1(t)}function dX(t){return RegExp.apply(null,t)}function Jl(t){return function(e){var i=new t;for(var r in cX)i[r]=e[r];return i}}function Qr(t){return function(e){return new t(e)}}function Ja(t){return new Uint8Array(t).buffer}});var rS=ae(iS=>{var lB=X1(),hB=S0(),uB=hB.Uint64BE,cB=hB.Int64BE;iS.getReadFormat=gX;iS.readUint8=fB;var tS=In(),T0=x0(),pX=typeof Map!="undefined",mX=!0;function gX(t){var e=tS.hasArrayBuffer&&t&&t.binarraybuffer,i=t&&t.int64,r=pX&&t&&t.usemap,n={map:r?_X:vX,array:yX,str:xX,bin:e?wX:bX,ext:SX,uint8:fB,uint16:MX,uint32:TX,uint64:E0(8,i?LX:PX),int8:CX,int16:EX,int32:AX,int64:E0(8,i?OX:RX),float32:E0(4,DX),float64:E0(8,IX)};return n}function vX(t,e){var i={},r,n=new Array(e),o=new Array(e),a=t.codec.decode;for(r=0;r<e;r++)n[r]=a(t),o[r]=a(t);for(r=0;r<e;r++)i[n[r]]=o[r];return i}function _X(t,e){var i=new Map,r,n=new Array(e),o=new Array(e),a=t.codec.decode;for(r=0;r<e;r++)n[r]=a(t),o[r]=a(t);for(r=0;r<e;r++)i.set(n[r],o[r]);return i}function yX(t,e){for(var i=new Array(e),r=t.codec.decode,n=0;n<e;n++)i[n]=r(t);return i}function xX(t,e){var i=t.reserve(e),r=i+e;return T0.toString.call(t.buffer,"utf-8",i,r)}function bX(t,e){var i=t.reserve(e),r=i+e,n=T0.slice.call(t.buffer,i,r);return tS.from(n)}function wX(t,e){var i=t.reserve(e),r=i+e,n=T0.slice.call(t.buffer,i,r);return tS.Uint8Array.from(n).buffer}function SX(t,e){var i=t.reserve(e+1),r=t.buffer[i++],n=i+e,o=t.codec.getExtUnpacker(r);if(!o)throw new Error("Invalid ext type: "+(r&&"0x"+r.toString(16)));var a=T0.slice.call(t.buffer,i,n);return o(a)}function fB(t){var e=t.reserve(1);return t.buffer[e]}function CX(t){var e=t.reserve(1),i=t.buffer[e];return i&128?i-256:i}function MX(t){var e=t.reserve(2),i=t.buffer;return i[e++]<<8|i[e]}function EX(t){var e=t.reserve(2),i=t.buffer,r=i[e++]<<8|i[e];return r&32768?r-65536:r}function TX(t){var e=t.reserve(4),i=t.buffer;return i[e++]*16777216+(i[e++]<<16)+(i[e++]<<8)+i[e]}function AX(t){var e=t.reserve(4),i=t.buffer;return i[e++]<<24|i[e++]<<16|i[e++]<<8|i[e]}function E0(t,e){return function(i){var r=i.reserve(t);return e.call(i.buffer,r,mX)}}function PX(t){return new uB(this,t).toNumber()}function RX(t){return new cB(this,t).toNumber()}function LX(t){return new uB(this,t)}function OX(t){return new cB(this,t)}function DX(t){return lB.read(this,t,!1,23,4)}function IX(t){return lB.read(this,t,!1,52,8)}});var mB=ae(pB=>{var kX=rS();pB.getReadToken=FX;function FX(t){var e=kX.getReadFormat(t);return t&&t.useraw?BX(e):dB(e)}function dB(t){var e,i=new Array(256);for(e=0;e<=127;e++)i[e]=Yf(e);for(e=128;e<=143;e++)i[e]=ra(e-128,t.map);for(e=144;e<=159;e++)i[e]=ra(e-144,t.array);for(e=160;e<=191;e++)i[e]=ra(e-160,t.str);for(i[192]=Yf(null),i[193]=null,i[194]=Yf(!1),i[195]=Yf(!0),i[196]=kn(t.uint8,t.bin),i[197]=kn(t.uint16,t.bin),i[198]=kn(t.uint32,t.bin),i[199]=kn(t.uint8,t.ext),i[200]=kn(t.uint16,t.ext),i[201]=kn(t.uint32,t.ext),i[202]=t.float32,i[203]=t.float64,i[204]=t.uint8,i[205]=t.uint16,i[206]=t.uint32,i[207]=t.uint64,i[208]=t.int8,i[209]=t.int16,i[210]=t.int32,i[211]=t.int64,i[212]=ra(1,t.ext),i[213]=ra(2,t.ext),i[214]=ra(4,t.ext),i[215]=ra(8,t.ext),i[216]=ra(16,t.ext),i[217]=kn(t.uint8,t.str),i[218]=kn(t.uint16,t.str),i[219]=kn(t.uint32,t.str),i[220]=kn(t.uint16,t.array),i[221]=kn(t.uint32,t.array),i[222]=kn(t.uint16,t.map),i[223]=kn(t.uint32,t.map),e=224;e<=255;e++)i[e]=Yf(e-256);return i}function BX(t){var e,i=dB(t).slice();for(i[217]=i[196],i[218]=i[197],i[219]=i[198],e=160;e<=191;e++)i[e]=ra(e-160,t.bin);return i}function Yf(t){return function(){return t}}function kn(t,e){return function(i){var r=t(i);return e(i,r)}}function ra(t,e){return function(i){return e(i,t)}}});var A0=ae(vB=>{var NX=b0().ExtBuffer,UX=aB(),GX=rS().readUint8,zX=mB(),nS=qf();nS.install({addExtUnpacker:WX,getExtUnpacker:VX,init:gB});vB.preset=gB.call(nS.preset);function HX(t){var e=zX.getReadToken(t);return i;function i(r){var n=GX(r),o=e[n];if(!o)throw new Error("Invalid type: "+(n&&"0x"+n.toString(16)));return o(r)}}function gB(){var t=this.options;return this.decode=HX(t),t&&t.preset&&UX.setExtUnpackers(this),this}function WX(t,e){var i=this.extUnpackers||(this.extUnpackers=[]);i[t]=nS.filter(e)}function VX(t){var e=this.extUnpackers||(this.extUnpackers=[]);return e[t]||i;function i(r){return new NX(r,t)}}});var sS=ae(_B=>{_B.DecodeBuffer=Uu;var jX=A0().preset,qX=Q1().FlexDecoder;qX.mixin(Uu.prototype);function Uu(t){if(!(this instanceof Uu))return new Uu(t);if(t&&(this.options=t,t.codec)){var e=this.codec=t.codec;e.bufferish&&(this.bufferish=e.bufferish)}}Uu.prototype.codec=jX;Uu.prototype.fetch=function(){return this.codec.decode(this)}});var eS=ae(yB=>{yB.decode=YX;var XX=sS().DecodeBuffer;function YX(t,e){var i=new XX(e);return i.write(t),i.read()}});var lS=ae((XSe,aS)=>{function oS(){if(!(this instanceof oS))return new oS}(function(t){typeof aS!="undefined"&&(aS.exports=t);var e="listeners",i={on:n,once:o,off:a,emit:l};r(t.prototype),t.mixin=r;function r(u){for(var c in i)u[c]=i[c];return u}function n(u,c){return h(this,u).push(c),this}function o(u,c){var f=this;return d.originalListener=c,h(f,u).push(d),f;function d(){a.call(f,u,d),c.apply(this,arguments)}}function a(u,c){var f=this,d;if(!arguments.length)delete f[e];else if(c){if(d=h(f,u,!0),d){if(d=d.filter(m),!d.length)return a.call(f,u);f[e][u]=d}}else if(d=f[e],d&&(delete d[u],!Object.keys(d).length))return a.call(f);return f;function m(v){return v!==c&&v.originalListener!==c}}function l(u,c){var f=this,d=h(f,u,!0);if(!d)return!1;var m=arguments.length;if(m===1)d.forEach(g);else if(m===2)d.forEach(p);else{var v=Array.prototype.slice.call(arguments,1);d.forEach(_)}return!!d.length;function g(x){x.call(f)}function p(x){x.call(f,c)}function _(x){x.apply(f,v)}}function h(u,c,f){if(!(f&&!u[e])){var d=u[e]||(u[e]={});return d[c]||(d[c]=[])}}})(oS)});var wB=ae(bB=>{bB.Encoder=$l;var ZX=lS(),xB=J1().EncodeBuffer;function $l(t){if(!(this instanceof $l))return new $l(t);xB.call(this,t)}$l.prototype=new xB;ZX.mixin($l.prototype);$l.prototype.encode=function(t){this.write(t),this.emit("data",this.read())};$l.prototype.end=function(t){arguments.length&&this.encode(t),this.flush(),this.emit("end")}});var MB=ae(CB=>{CB.Decoder=$a;var KX=lS(),SB=sS().DecodeBuffer;function $a(t){if(!(this instanceof $a))return new $a(t);SB.call(this,t)}$a.prototype=new SB;KX.mixin($a.prototype);$a.prototype.decode=function(t){arguments.length&&this.write(t),this.flush()};$a.prototype.push=function(t){this.emit("data",t)};$a.prototype.end=function(t){this.decode(t),this.emit("end")}});var TB=ae(EB=>{A0();M0();EB.createCodec=qf().createCodec});var PB=ae(AB=>{A0();M0();AB.codec={preset:qf().preset}});var RB=ae(eh=>{eh.encode=j1().encode;eh.decode=eS().decode;eh.Encoder=wB().Encoder;eh.Decoder=MB().Decoder;eh.createCodec=TB().createCodec;eh.codec=PB().codec});var GB=ae((D0,cS)=>{(function(t,e){if(typeof D0=="object"&&typeof cS=="object")cS.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var i=e();for(var r in i)(typeof D0=="object"?D0:t)[r]=i[r]}})(self,function(){return(()=>{"use strict";var t={4567:function(i,r,n){var o,a=this&&this.__extends||(o=function(g,p){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,x){_.__proto__=x}||function(_,x){for(var b in x)Object.prototype.hasOwnProperty.call(x,b)&&(_[b]=x[b])},o(g,p)},function(g,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function _(){this.constructor=g}o(g,p),g.prototype=p===null?Object.create(p):(_.prototype=p.prototype,new _)});Object.defineProperty(r,"__esModule",{value:!0}),r.AccessibilityManager=void 0;var l=n(9042),h=n(6114),u=n(9924),c=n(3656),f=n(844),d=n(5596),m=n(9631),v=function(g){function p(_,x){var b=g.call(this)||this;b._terminal=_,b._renderService=x,b._liveRegionLineCount=0,b._charsToConsume=[],b._charsToAnnounce="",b._accessibilityTreeRoot=document.createElement("div"),b._accessibilityTreeRoot.classList.add("xterm-accessibility"),b._accessibilityTreeRoot.tabIndex=0,b._rowContainer=document.createElement("div"),b._rowContainer.setAttribute("role","list"),b._rowContainer.classList.add("xterm-accessibility-tree"),b._rowElements=[];for(var y=0;y<b._terminal.rows;y++)b._rowElements[y]=b._createAccessibilityTreeNode(),b._rowContainer.appendChild(b._rowElements[y]);if(b._topBoundaryFocusListener=function(w){return b._onBoundaryFocus(w,0)},b._bottomBoundaryFocusListener=function(w){return b._onBoundaryFocus(w,1)},b._rowElements[0].addEventListener("focus",b._topBoundaryFocusListener),b._rowElements[b._rowElements.length-1].addEventListener("focus",b._bottomBoundaryFocusListener),b._refreshRowsDimensions(),b._accessibilityTreeRoot.appendChild(b._rowContainer),b._renderRowsDebouncer=new u.TimeBasedDebouncer(b._renderRows.bind(b)),b._refreshRows(),b._liveRegion=document.createElement("div"),b._liveRegion.classList.add("live-region"),b._liveRegion.setAttribute("aria-live","assertive"),b._accessibilityTreeRoot.appendChild(b._liveRegion),!b._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");return b._terminal.element.insertAdjacentElement("afterbegin",b._accessibilityTreeRoot),b.register(b._renderRowsDebouncer),b.register(b._terminal.onResize(function(w){return b._onResize(w.rows)})),b.register(b._terminal.onRender(function(w){return b._refreshRows(w.start,w.end)})),b.register(b._terminal.onScroll(function(){return b._refreshRows()})),b.register(b._terminal.onA11yChar(function(w){return b._onChar(w)})),b.register(b._terminal.onLineFeed(function(){return b._onChar(`
`)})),b.register(b._terminal.onA11yTab(function(w){return b._onTab(w)})),b.register(b._terminal.onKey(function(w){return b._onKey(w.key)})),b.register(b._terminal.onBlur(function(){return b._clearLiveRegion()})),b.register(b._renderService.onDimensionsChange(function(){return b._refreshRowsDimensions()})),b._screenDprMonitor=new d.ScreenDprMonitor,b.register(b._screenDprMonitor),b._screenDprMonitor.setListener(function(){return b._refreshRowsDimensions()}),b.register((0,c.addDisposableDomListener)(window,"resize",function(){return b._refreshRowsDimensions()})),b}return a(p,g),p.prototype.dispose=function(){g.prototype.dispose.call(this),(0,m.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0},p.prototype._onBoundaryFocus=function(_,x){var b=_.target,y=this._rowElements[x===0?1:this._rowElements.length-2];if(b.getAttribute("aria-posinset")!==(x===0?"1":""+this._terminal.buffer.lines.length)&&_.relatedTarget===y){var w,S;if(x===0?(w=b,S=this._rowElements.pop(),this._rowContainer.removeChild(S)):(w=this._rowElements.shift(),S=b,this._rowContainer.removeChild(w)),w.removeEventListener("focus",this._topBoundaryFocusListener),S.removeEventListener("focus",this._bottomBoundaryFocusListener),x===0){var R=this._createAccessibilityTreeNode();this._rowElements.unshift(R),this._rowContainer.insertAdjacentElement("afterbegin",R)}else R=this._createAccessibilityTreeNode(),this._rowElements.push(R),this._rowContainer.appendChild(R);this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(x===0?-1:1),this._rowElements[x===0?1:this._rowElements.length-2].focus(),_.preventDefault(),_.stopImmediatePropagation()}},p.prototype._onResize=function(_){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(var x=this._rowContainer.children.length;x<this._terminal.rows;x++)this._rowElements[x]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[x]);for(;this._rowElements.length>_;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()},p.prototype._createAccessibilityTreeNode=function(){var _=document.createElement("div");return _.setAttribute("role","listitem"),_.tabIndex=-1,this._refreshRowDimensions(_),_},p.prototype._onTab=function(_){for(var x=0;x<_;x++)this._onChar(" ")},p.prototype._onChar=function(_){var x=this;this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==_&&(this._charsToAnnounce+=_):this._charsToAnnounce+=_,_===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=l.tooMuchOutput)),h.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(function(){x._accessibilityTreeRoot.appendChild(x._liveRegion)},0))},p.prototype._clearLiveRegion=function(){this._liveRegion.textContent="",this._liveRegionLineCount=0,h.isMac&&(0,m.removeElementFromParent)(this._liveRegion)},p.prototype._onKey=function(_){this._clearLiveRegion(),this._charsToConsume.push(_)},p.prototype._refreshRows=function(_,x){this._renderRowsDebouncer.refresh(_,x,this._terminal.rows)},p.prototype._renderRows=function(_,x){for(var b=this._terminal.buffer,y=b.lines.length.toString(),w=_;w<=x;w++){var S=b.translateBufferLineToString(b.ydisp+w,!0),R=(b.ydisp+w+1).toString(),E=this._rowElements[w];E&&(S.length===0?E.innerText="\xA0":E.textContent=S,E.setAttribute("aria-posinset",R),E.setAttribute("aria-setsize",y))}this._announceCharacters()},p.prototype._refreshRowsDimensions=function(){if(this._renderService.dimensions.actualCellHeight){this._rowElements.length!==this._terminal.rows&&this._onResize(this._terminal.rows);for(var _=0;_<this._terminal.rows;_++)this._refreshRowDimensions(this._rowElements[_])}},p.prototype._refreshRowDimensions=function(_){_.style.height=this._renderService.dimensions.actualCellHeight+"px"},p.prototype._announceCharacters=function(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")},p}(f.Disposable);r.AccessibilityManager=v},3614:(i,r)=>{function n(h){return h.replace(/\r?\n/g,"\r")}function o(h,u){return u?"\x1B[200~"+h+"\x1B[201~":h}function a(h,u,c){h=o(h=n(h),c.decPrivateModes.bracketedPasteMode),c.triggerDataEvent(h,!0),u.value=""}function l(h,u,c){var f=c.getBoundingClientRect(),d=h.clientX-f.left-10,m=h.clientY-f.top-10;u.style.width="20px",u.style.height="20px",u.style.left=d+"px",u.style.top=m+"px",u.style.zIndex="1000",u.focus()}Object.defineProperty(r,"__esModule",{value:!0}),r.rightClickHandler=r.moveTextAreaUnderMouseCursor=r.paste=r.handlePasteEvent=r.copyHandler=r.bracketTextForPaste=r.prepareTextForTerminal=void 0,r.prepareTextForTerminal=n,r.bracketTextForPaste=o,r.copyHandler=function(h,u){h.clipboardData&&h.clipboardData.setData("text/plain",u.selectionText),h.preventDefault()},r.handlePasteEvent=function(h,u,c){h.stopPropagation(),h.clipboardData&&a(h.clipboardData.getData("text/plain"),u,c)},r.paste=a,r.moveTextAreaUnderMouseCursor=l,r.rightClickHandler=function(h,u,c,f,d){l(h,u,c),d&&f.rightClickSelect(h),u.value=f.selectionText,u.select()}},7239:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorContrastCache=void 0;var n=function(){function o(){this._color={},this._rgba={}}return o.prototype.clear=function(){this._color={},this._rgba={}},o.prototype.setCss=function(a,l,h){this._rgba[a]||(this._rgba[a]={}),this._rgba[a][l]=h},o.prototype.getCss=function(a,l){return this._rgba[a]?this._rgba[a][l]:void 0},o.prototype.setColor=function(a,l,h){this._color[a]||(this._color[a]={}),this._color[a][l]=h},o.prototype.getColor=function(a,l){return this._color[a]?this._color[a][l]:void 0},o}();r.ColorContrastCache=n},5680:function(i,r,n){var o=this&&this.__read||function(v,g){var p=typeof Symbol=="function"&&v[Symbol.iterator];if(!p)return v;var _,x,b=p.call(v),y=[];try{for(;(g===void 0||g-- >0)&&!(_=b.next()).done;)y.push(_.value)}catch(w){x={error:w}}finally{try{_&&!_.done&&(p=b.return)&&p.call(b)}finally{if(x)throw x.error}}return y};Object.defineProperty(r,"__esModule",{value:!0}),r.ColorManager=r.DEFAULT_ANSI_COLORS=void 0;var a=n(8055),l=n(7239),h=a.css.toColor("#ffffff"),u=a.css.toColor("#000000"),c=a.css.toColor("#ffffff"),f=a.css.toColor("#000000"),d={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};r.DEFAULT_ANSI_COLORS=Object.freeze(function(){for(var v=[a.css.toColor("#2e3436"),a.css.toColor("#cc0000"),a.css.toColor("#4e9a06"),a.css.toColor("#c4a000"),a.css.toColor("#3465a4"),a.css.toColor("#75507b"),a.css.toColor("#06989a"),a.css.toColor("#d3d7cf"),a.css.toColor("#555753"),a.css.toColor("#ef2929"),a.css.toColor("#8ae234"),a.css.toColor("#fce94f"),a.css.toColor("#729fcf"),a.css.toColor("#ad7fa8"),a.css.toColor("#34e2e2"),a.css.toColor("#eeeeec")],g=[0,95,135,175,215,255],p=0;p<216;p++){var _=g[p/36%6|0],x=g[p/6%6|0],b=g[p%6];v.push({css:a.channels.toCss(_,x,b),rgba:a.channels.toRgba(_,x,b)})}for(p=0;p<24;p++){var y=8+10*p;v.push({css:a.channels.toCss(y,y,y),rgba:a.channels.toRgba(y,y,y)})}return v}());var m=function(){function v(g,p){this.allowTransparency=p;var _=g.createElement("canvas");_.width=1,_.height=1;var x=_.getContext("2d");if(!x)throw new Error("Could not get rendering context");this._ctx=x,this._ctx.globalCompositeOperation="copy",this._litmusColor=this._ctx.createLinearGradient(0,0,1,1),this._contrastCache=new l.ColorContrastCache,this.colors={foreground:h,background:u,cursor:c,cursorAccent:f,selectionTransparent:d,selectionOpaque:a.color.blend(u,d),selectionForeground:void 0,ansi:r.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors()}return v.prototype.onOptionsChange=function(g){g==="minimumContrastRatio"&&this._contrastCache.clear()},v.prototype.setTheme=function(g){g===void 0&&(g={}),this.colors.foreground=this._parseColor(g.foreground,h),this.colors.background=this._parseColor(g.background,u),this.colors.cursor=this._parseColor(g.cursor,c,!0),this.colors.cursorAccent=this._parseColor(g.cursorAccent,f,!0),this.colors.selectionTransparent=this._parseColor(g.selection,d,!0),this.colors.selectionOpaque=a.color.blend(this.colors.background,this.colors.selectionTransparent);var p={css:"",rgba:0};this.colors.selectionForeground=g.selectionForeground?this._parseColor(g.selectionForeground,p):void 0,this.colors.selectionForeground===p&&(this.colors.selectionForeground=void 0),a.color.isOpaque(this.colors.selectionTransparent)&&(this.colors.selectionTransparent=a.color.opacity(this.colors.selectionTransparent,.3)),this.colors.ansi[0]=this._parseColor(g.black,r.DEFAULT_ANSI_COLORS[0]),this.colors.ansi[1]=this._parseColor(g.red,r.DEFAULT_ANSI_COLORS[1]),this.colors.ansi[2]=this._parseColor(g.green,r.DEFAULT_ANSI_COLORS[2]),this.colors.ansi[3]=this._parseColor(g.yellow,r.DEFAULT_ANSI_COLORS[3]),this.colors.ansi[4]=this._parseColor(g.blue,r.DEFAULT_ANSI_COLORS[4]),this.colors.ansi[5]=this._parseColor(g.magenta,r.DEFAULT_ANSI_COLORS[5]),this.colors.ansi[6]=this._parseColor(g.cyan,r.DEFAULT_ANSI_COLORS[6]),this.colors.ansi[7]=this._parseColor(g.white,r.DEFAULT_ANSI_COLORS[7]),this.colors.ansi[8]=this._parseColor(g.brightBlack,r.DEFAULT_ANSI_COLORS[8]),this.colors.ansi[9]=this._parseColor(g.brightRed,r.DEFAULT_ANSI_COLORS[9]),this.colors.ansi[10]=this._parseColor(g.brightGreen,r.DEFAULT_ANSI_COLORS[10]),this.colors.ansi[11]=this._parseColor(g.brightYellow,r.DEFAULT_ANSI_COLORS[11]),this.colors.ansi[12]=this._parseColor(g.brightBlue,r.DEFAULT_ANSI_COLORS[12]),this.colors.ansi[13]=this._parseColor(g.brightMagenta,r.DEFAULT_ANSI_COLORS[13]),this.colors.ansi[14]=this._parseColor(g.brightCyan,r.DEFAULT_ANSI_COLORS[14]),this.colors.ansi[15]=this._parseColor(g.brightWhite,r.DEFAULT_ANSI_COLORS[15]),this._contrastCache.clear(),this._updateRestoreColors()},v.prototype.restoreColor=function(g){if(g!==void 0)switch(g){case 256:this.colors.foreground=this._restoreColors.foreground;break;case 257:this.colors.background=this._restoreColors.background;break;case 258:this.colors.cursor=this._restoreColors.cursor;break;default:this.colors.ansi[g]=this._restoreColors.ansi[g]}else for(var p=0;p<this._restoreColors.ansi.length;++p)this.colors.ansi[p]=this._restoreColors.ansi[p]},v.prototype._updateRestoreColors=function(){this._restoreColors={foreground:this.colors.foreground,background:this.colors.background,cursor:this.colors.cursor,ansi:this.colors.ansi.slice()}},v.prototype._parseColor=function(g,p,_){if(_===void 0&&(_=this.allowTransparency),g===void 0)return p;if(this._ctx.fillStyle=this._litmusColor,this._ctx.fillStyle=g,typeof this._ctx.fillStyle!="string")return console.warn("Color: "+g+" is invalid using fallback "+p.css),p;this._ctx.fillRect(0,0,1,1);var x=this._ctx.getImageData(0,0,1,1).data;if(x[3]!==255){if(!_)return console.warn("Color: "+g+" is using transparency, but allowTransparency is false. Using fallback "+p.css+"."),p;var b=o(this._ctx.fillStyle.substring(5,this._ctx.fillStyle.length-1).split(",").map(function(T){return Number(T)}),4),y=b[0],w=b[1],S=b[2],R=b[3],E=Math.round(255*R);return{rgba:a.channels.toRgba(y,w,S,E),css:g}}return{css:this._ctx.fillStyle,rgba:a.channels.toRgba(x[0],x[1],x[2],x[3])}},v}();r.ColorManager=m},9631:function(i,r){var n=this&&this.__values||function(o){var a=typeof Symbol=="function"&&Symbol.iterator,l=a&&o[a],h=0;if(l)return l.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&h>=o.length&&(o=void 0),{value:o&&o[h++],done:!o}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.removeElementFromParent=void 0,r.removeElementFromParent=function(){for(var o,a,l,h=[],u=0;u<arguments.length;u++)h[u]=arguments[u];try{for(var c=n(h),f=c.next();!f.done;f=c.next()){var d=f.value;(l=d==null?void 0:d.parentElement)===null||l===void 0||l.removeChild(d)}}catch(m){o={error:m}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}}},3656:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.addDisposableDomListener=void 0,r.addDisposableDomListener=function(n,o,a,l){n.addEventListener(o,a,l);var h=!1;return{dispose:function(){h||(h=!0,n.removeEventListener(o,a,l))}}}},3551:function(i,r,n){var o=this&&this.__decorate||function(f,d,m,v){var g,p=arguments.length,_=p<3?d:v===null?v=Object.getOwnPropertyDescriptor(d,m):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(f,d,m,v);else for(var x=f.length-1;x>=0;x--)(g=f[x])&&(_=(p<3?g(_):p>3?g(d,m,_):g(d,m))||_);return p>3&&_&&Object.defineProperty(d,m,_),_},a=this&&this.__param||function(f,d){return function(m,v){d(m,v,f)}};Object.defineProperty(r,"__esModule",{value:!0}),r.MouseZone=r.Linkifier=void 0;var l=n(8460),h=n(2585),u=function(){function f(d,m,v){this._bufferService=d,this._logService=m,this._unicodeService=v,this._linkMatchers=[],this._nextLinkMatcherId=0,this._onShowLinkUnderline=new l.EventEmitter,this._onHideLinkUnderline=new l.EventEmitter,this._onLinkTooltip=new l.EventEmitter,this._rowsToLinkify={start:void 0,end:void 0}}return Object.defineProperty(f.prototype,"onShowLinkUnderline",{get:function(){return this._onShowLinkUnderline.event},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onHideLinkUnderline",{get:function(){return this._onHideLinkUnderline.event},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onLinkTooltip",{get:function(){return this._onLinkTooltip.event},enumerable:!1,configurable:!0}),f.prototype.attachToDom=function(d,m){this._element=d,this._mouseZoneManager=m},f.prototype.linkifyRows=function(d,m){var v=this;this._mouseZoneManager&&(this._rowsToLinkify.start===void 0||this._rowsToLinkify.end===void 0?(this._rowsToLinkify.start=d,this._rowsToLinkify.end=m):(this._rowsToLinkify.start=Math.min(this._rowsToLinkify.start,d),this._rowsToLinkify.end=Math.max(this._rowsToLinkify.end,m)),this._mouseZoneManager.clearAll(d,m),this._rowsTimeoutId&&clearTimeout(this._rowsTimeoutId),this._rowsTimeoutId=setTimeout(function(){return v._linkifyRows()},f._timeBeforeLatency))},f.prototype._linkifyRows=function(){this._rowsTimeoutId=void 0;var d=this._bufferService.buffer;if(this._rowsToLinkify.start!==void 0&&this._rowsToLinkify.end!==void 0){var m=d.ydisp+this._rowsToLinkify.start;if(!(m>=d.lines.length)){for(var v=d.ydisp+Math.min(this._rowsToLinkify.end,this._bufferService.rows)+1,g=Math.ceil(2e3/this._bufferService.cols),p=this._bufferService.buffer.iterator(!1,m,v,g,g);p.hasNext();)for(var _=p.next(),x=0;x<this._linkMatchers.length;x++)this._doLinkifyRow(_.range.first,_.content,this._linkMatchers[x]);this._rowsToLinkify.start=void 0,this._rowsToLinkify.end=void 0}}else this._logService.debug("_rowToLinkify was unset before _linkifyRows was called")},f.prototype.registerLinkMatcher=function(d,m,v){if(v===void 0&&(v={}),!m)throw new Error("handler must be defined");var g={id:this._nextLinkMatcherId++,regex:d,handler:m,matchIndex:v.matchIndex,validationCallback:v.validationCallback,hoverTooltipCallback:v.tooltipCallback,hoverLeaveCallback:v.leaveCallback,willLinkActivate:v.willLinkActivate,priority:v.priority||0};return this._addLinkMatcherToList(g),g.id},f.prototype._addLinkMatcherToList=function(d){if(this._linkMatchers.length!==0){for(var m=this._linkMatchers.length-1;m>=0;m--)if(d.priority<=this._linkMatchers[m].priority)return void this._linkMatchers.splice(m+1,0,d);this._linkMatchers.splice(0,0,d)}else this._linkMatchers.push(d)},f.prototype.deregisterLinkMatcher=function(d){for(var m=0;m<this._linkMatchers.length;m++)if(this._linkMatchers[m].id===d)return this._linkMatchers.splice(m,1),!0;return!1},f.prototype._doLinkifyRow=function(d,m,v){for(var g,p=this,_=new RegExp(v.regex.source,(v.regex.flags||"")+"g"),x=-1,b=function(){var w=g[typeof v.matchIndex!="number"?0:v.matchIndex];if(!w)return y._logService.debug("match found without corresponding matchIndex",g,v),"break";if(x=m.indexOf(w,x+1),_.lastIndex=x+w.length,x<0)return"break";var S=y._bufferService.buffer.stringIndexToBufferIndex(d,x);if(S[0]<0)return"break";var R=y._bufferService.buffer.lines.get(S[0]);if(!R)return"break";var E=R.getFg(S[1]),T=E?E>>9&511:void 0;v.validationCallback?v.validationCallback(w,function(A){p._rowsTimeoutId||A&&p._addLink(S[1],S[0]-p._bufferService.buffer.ydisp,w,v,T)}):y._addLink(S[1],S[0]-y._bufferService.buffer.ydisp,w,v,T)},y=this;(g=_.exec(m))!==null&&b()!=="break";);},f.prototype._addLink=function(d,m,v,g,p){var _=this;if(this._mouseZoneManager&&this._element){var x=this._unicodeService.getStringCellWidth(v),b=d%this._bufferService.cols,y=m+Math.floor(d/this._bufferService.cols),w=(b+x)%this._bufferService.cols,S=y+Math.floor((b+x)/this._bufferService.cols);w===0&&(w=this._bufferService.cols,S--),this._mouseZoneManager.add(new c(b+1,y+1,w+1,S+1,function(R){if(g.handler)return g.handler(R,v);var E=window.open();E?(E.opener=null,E.location.href=v):console.warn("Opening link blocked as opener could not be cleared")},function(){_._onShowLinkUnderline.fire(_._createLinkHoverEvent(b,y,w,S,p)),_._element.classList.add("xterm-cursor-pointer")},function(R){_._onLinkTooltip.fire(_._createLinkHoverEvent(b,y,w,S,p)),g.hoverTooltipCallback&&g.hoverTooltipCallback(R,v,{start:{x:b,y},end:{x:w,y:S}})},function(){_._onHideLinkUnderline.fire(_._createLinkHoverEvent(b,y,w,S,p)),_._element.classList.remove("xterm-cursor-pointer"),g.hoverLeaveCallback&&g.hoverLeaveCallback()},function(R){return!g.willLinkActivate||g.willLinkActivate(R,v)}))}},f.prototype._createLinkHoverEvent=function(d,m,v,g,p){return{x1:d,y1:m,x2:v,y2:g,cols:this._bufferService.cols,fg:p}},f._timeBeforeLatency=200,f=o([a(0,h.IBufferService),a(1,h.ILogService),a(2,h.IUnicodeService)],f)}();r.Linkifier=u;var c=function(f,d,m,v,g,p,_,x,b){this.x1=f,this.y1=d,this.x2=m,this.y2=v,this.clickCallback=g,this.hoverCallback=p,this.tooltipCallback=_,this.leaveCallback=x,this.willLinkActivate=b};r.MouseZone=c},6465:function(i,r,n){var o,a=this&&this.__extends||(o=function(p,_){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,b){x.__proto__=b}||function(x,b){for(var y in b)Object.prototype.hasOwnProperty.call(b,y)&&(x[y]=b[y])},o(p,_)},function(p,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function x(){this.constructor=p}o(p,_),p.prototype=_===null?Object.create(_):(x.prototype=_.prototype,new x)}),l=this&&this.__decorate||function(p,_,x,b){var y,w=arguments.length,S=w<3?_:b===null?b=Object.getOwnPropertyDescriptor(_,x):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(p,_,x,b);else for(var R=p.length-1;R>=0;R--)(y=p[R])&&(S=(w<3?y(S):w>3?y(_,x,S):y(_,x))||S);return w>3&&S&&Object.defineProperty(_,x,S),S},h=this&&this.__param||function(p,_){return function(x,b){_(x,b,p)}},u=this&&this.__values||function(p){var _=typeof Symbol=="function"&&Symbol.iterator,x=_&&p[_],b=0;if(x)return x.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&b>=p.length&&(p=void 0),{value:p&&p[b++],done:!p}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(p,_){var x=typeof Symbol=="function"&&p[Symbol.iterator];if(!x)return p;var b,y,w=x.call(p),S=[];try{for(;(_===void 0||_-- >0)&&!(b=w.next()).done;)S.push(b.value)}catch(R){y={error:R}}finally{try{b&&!b.done&&(x=w.return)&&x.call(w)}finally{if(y)throw y.error}}return S};Object.defineProperty(r,"__esModule",{value:!0}),r.Linkifier2=void 0;var f=n(2585),d=n(8460),m=n(844),v=n(3656),g=function(p){function _(x){var b=p.call(this)||this;return b._bufferService=x,b._linkProviders=[],b._linkCacheDisposables=[],b._isMouseOut=!0,b._activeLine=-1,b._onShowLinkUnderline=b.register(new d.EventEmitter),b._onHideLinkUnderline=b.register(new d.EventEmitter),b.register((0,m.getDisposeArrayDisposable)(b._linkCacheDisposables)),b}return a(_,p),Object.defineProperty(_.prototype,"currentLink",{get:function(){return this._currentLink},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onShowLinkUnderline",{get:function(){return this._onShowLinkUnderline.event},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onHideLinkUnderline",{get:function(){return this._onHideLinkUnderline.event},enumerable:!1,configurable:!0}),_.prototype.registerLinkProvider=function(x){var b=this;return this._linkProviders.push(x),{dispose:function(){var y=b._linkProviders.indexOf(x);y!==-1&&b._linkProviders.splice(y,1)}}},_.prototype.attachToDom=function(x,b,y){var w=this;this._element=x,this._mouseService=b,this._renderService=y,this.register((0,v.addDisposableDomListener)(this._element,"mouseleave",function(){w._isMouseOut=!0,w._clearCurrentLink()})),this.register((0,v.addDisposableDomListener)(this._element,"mousemove",this._onMouseMove.bind(this))),this.register((0,v.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,v.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))},_.prototype._onMouseMove=function(x){if(this._lastMouseEvent=x,this._element&&this._mouseService){var b=this._positionFromMouseEvent(x,this._element,this._mouseService);if(b){this._isMouseOut=!1;for(var y=x.composedPath(),w=0;w<y.length;w++){var S=y[w];if(S.classList.contains("xterm"))break;if(S.classList.contains("xterm-hover"))return}this._lastBufferCell&&b.x===this._lastBufferCell.x&&b.y===this._lastBufferCell.y||(this._onHover(b),this._lastBufferCell=b)}}},_.prototype._onHover=function(x){if(this._activeLine!==x.y)return this._clearCurrentLink(),void this._askForLink(x,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,x)||(this._clearCurrentLink(),this._askForLink(x,!0))},_.prototype._askForLink=function(x,b){var y,w,S,R,E=this;this._activeProviderReplies&&b||((S=this._activeProviderReplies)===null||S===void 0||S.forEach(function(P){P==null||P.forEach(function(L){L.link.dispose&&L.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=x.y);var T=!1,A=function(P,L){b?!((R=C._activeProviderReplies)===null||R===void 0)&&R.get(P)&&(T=C._checkLinkProviderResult(P,x,T)):L.provideLinks(x.y,function(I){var k,B;if(!E._isMouseOut){var F=I==null?void 0:I.map(function(W){return{link:W}});(k=E._activeProviderReplies)===null||k===void 0||k.set(P,F),T=E._checkLinkProviderResult(P,x,T),((B=E._activeProviderReplies)===null||B===void 0?void 0:B.size)===E._linkProviders.length&&E._removeIntersectingLinks(x.y,E._activeProviderReplies)}})},C=this;try{for(var M=u(this._linkProviders.entries()),D=M.next();!D.done;D=M.next()){var O=c(D.value,2);A(O[0],O[1])}}catch(P){y={error:P}}finally{try{D&&!D.done&&(w=M.return)&&w.call(M)}finally{if(y)throw y.error}}},_.prototype._removeIntersectingLinks=function(x,b){for(var y=new Set,w=0;w<b.size;w++){var S=b.get(w);if(S)for(var R=0;R<S.length;R++)for(var E=S[R],T=E.link.range.start.y<x?0:E.link.range.start.x,A=E.link.range.end.y>x?this._bufferService.cols:E.link.range.end.x,C=T;C<=A;C++){if(y.has(C)){S.splice(R--,1);break}y.add(C)}}},_.prototype._checkLinkProviderResult=function(x,b,y){var w,S=this;if(!this._activeProviderReplies)return y;for(var R=this._activeProviderReplies.get(x),E=!1,T=0;T<x;T++)this._activeProviderReplies.has(T)&&!this._activeProviderReplies.get(T)||(E=!0);if(!E&&R){var A=R.find(function(M){return S._linkAtPosition(M.link,b)});A&&(y=!0,this._handleNewLink(A))}if(this._activeProviderReplies.size===this._linkProviders.length&&!y)for(T=0;T<this._activeProviderReplies.size;T++){var C=(w=this._activeProviderReplies.get(T))===null||w===void 0?void 0:w.find(function(M){return S._linkAtPosition(M.link,b)});if(C){y=!0,this._handleNewLink(C);break}}return y},_.prototype._handleMouseDown=function(){this._mouseDownLink=this._currentLink},_.prototype._handleMouseUp=function(x){if(this._element&&this._mouseService&&this._currentLink){var b=this._positionFromMouseEvent(x,this._element,this._mouseService);b&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,b)&&this._currentLink.link.activate(x,this._currentLink.link.text)}},_.prototype._clearCurrentLink=function(x,b){this._element&&this._currentLink&&this._lastMouseEvent&&(!x||!b||this._currentLink.link.range.start.y>=x&&this._currentLink.link.range.end.y<=b)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,m.disposeArray)(this._linkCacheDisposables))},_.prototype._handleNewLink=function(x){var b=this;if(this._element&&this._lastMouseEvent&&this._mouseService){var y=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);y&&this._linkAtPosition(x.link,y)&&(this._currentLink=x,this._currentLink.state={decorations:{underline:x.link.decorations===void 0||x.link.decorations.underline,pointerCursor:x.link.decorations===void 0||x.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,x.link,this._lastMouseEvent),x.link.decorations={},Object.defineProperties(x.link.decorations,{pointerCursor:{get:function(){var w,S;return(S=(w=b._currentLink)===null||w===void 0?void 0:w.state)===null||S===void 0?void 0:S.decorations.pointerCursor},set:function(w){var S,R;!((S=b._currentLink)===null||S===void 0)&&S.state&&b._currentLink.state.decorations.pointerCursor!==w&&(b._currentLink.state.decorations.pointerCursor=w,b._currentLink.state.isHovered&&((R=b._element)===null||R===void 0||R.classList.toggle("xterm-cursor-pointer",w)))}},underline:{get:function(){var w,S;return(S=(w=b._currentLink)===null||w===void 0?void 0:w.state)===null||S===void 0?void 0:S.decorations.underline},set:function(w){var S,R,E;!((S=b._currentLink)===null||S===void 0)&&S.state&&((E=(R=b._currentLink)===null||R===void 0?void 0:R.state)===null||E===void 0?void 0:E.decorations.underline)!==w&&(b._currentLink.state.decorations.underline=w,b._currentLink.state.isHovered&&b._fireUnderlineEvent(x.link,w))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(function(w){var S=w.start===0?0:w.start+1+b._bufferService.buffer.ydisp;b._clearCurrentLink(S,w.end+1+b._bufferService.buffer.ydisp)})))}},_.prototype._linkHover=function(x,b,y){var w;!((w=this._currentLink)===null||w===void 0)&&w.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(b,!0),this._currentLink.state.decorations.pointerCursor&&x.classList.add("xterm-cursor-pointer")),b.hover&&b.hover(y,b.text)},_.prototype._fireUnderlineEvent=function(x,b){var y=x.range,w=this._bufferService.buffer.ydisp,S=this._createLinkUnderlineEvent(y.start.x-1,y.start.y-w-1,y.end.x,y.end.y-w-1,void 0);(b?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(S)},_.prototype._linkLeave=function(x,b,y){var w;!((w=this._currentLink)===null||w===void 0)&&w.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(b,!1),this._currentLink.state.decorations.pointerCursor&&x.classList.remove("xterm-cursor-pointer")),b.leave&&b.leave(y,b.text)},_.prototype._linkAtPosition=function(x,b){var y=x.range.start.y===x.range.end.y,w=x.range.start.y<b.y,S=x.range.end.y>b.y;return(y&&x.range.start.x<=b.x&&x.range.end.x>=b.x||w&&x.range.end.x>=b.x||S&&x.range.start.x<=b.x||w&&S)&&x.range.start.y<=b.y&&x.range.end.y>=b.y},_.prototype._positionFromMouseEvent=function(x,b,y){var w=y.getCoords(x,b,this._bufferService.cols,this._bufferService.rows);if(w)return{x:w[0],y:w[1]+this._bufferService.buffer.ydisp}},_.prototype._createLinkUnderlineEvent=function(x,b,y,w,S){return{x1:x,y1:b,x2:y,y2:w,cols:this._bufferService.cols,fg:S}},l([h(0,f.IBufferService)],_)}(m.Disposable);r.Linkifier2=g},9042:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.tooMuchOutput=r.promptLabel=void 0,r.promptLabel="Terminal input",r.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},6954:function(i,r,n){var o,a=this&&this.__extends||(o=function(v,g){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,_){p.__proto__=_}||function(p,_){for(var x in _)Object.prototype.hasOwnProperty.call(_,x)&&(p[x]=_[x])},o(v,g)},function(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function p(){this.constructor=v}o(v,g),v.prototype=g===null?Object.create(g):(p.prototype=g.prototype,new p)}),l=this&&this.__decorate||function(v,g,p,_){var x,b=arguments.length,y=b<3?g:_===null?_=Object.getOwnPropertyDescriptor(g,p):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(v,g,p,_);else for(var w=v.length-1;w>=0;w--)(x=v[w])&&(y=(b<3?x(y):b>3?x(g,p,y):x(g,p))||y);return b>3&&y&&Object.defineProperty(g,p,y),y},h=this&&this.__param||function(v,g){return function(p,_){g(p,_,v)}};Object.defineProperty(r,"__esModule",{value:!0}),r.MouseZoneManager=void 0;var u=n(844),c=n(3656),f=n(4725),d=n(2585),m=function(v){function g(p,_,x,b,y,w){var S=v.call(this)||this;return S._element=p,S._screenElement=_,S._bufferService=x,S._mouseService=b,S._selectionService=y,S._optionsService=w,S._zones=[],S._areZonesActive=!1,S._lastHoverCoords=[void 0,void 0],S._initialSelectionLength=0,S.register((0,c.addDisposableDomListener)(S._element,"mousedown",function(R){return S._onMouseDown(R)})),S._mouseMoveListener=function(R){return S._onMouseMove(R)},S._mouseLeaveListener=function(R){return S._onMouseLeave(R)},S._clickListener=function(R){return S._onClick(R)},S}return a(g,v),g.prototype.dispose=function(){v.prototype.dispose.call(this),this._deactivate()},g.prototype.add=function(p){this._zones.push(p),this._zones.length===1&&this._activate()},g.prototype.clearAll=function(p,_){if(this._zones.length!==0){p&&_||(p=0,_=this._bufferService.rows-1);for(var x=0;x<this._zones.length;x++){var b=this._zones[x];(b.y1>p&&b.y1<=_+1||b.y2>p&&b.y2<=_+1||b.y1<p&&b.y2>_+1)&&(this._currentZone&&this._currentZone===b&&(this._currentZone.leaveCallback(),this._currentZone=void 0),this._zones.splice(x--,1))}this._zones.length===0&&this._deactivate()}},g.prototype._activate=function(){this._areZonesActive||(this._areZonesActive=!0,this._element.addEventListener("mousemove",this._mouseMoveListener),this._element.addEventListener("mouseleave",this._mouseLeaveListener),this._element.addEventListener("click",this._clickListener))},g.prototype._deactivate=function(){this._areZonesActive&&(this._areZonesActive=!1,this._element.removeEventListener("mousemove",this._mouseMoveListener),this._element.removeEventListener("mouseleave",this._mouseLeaveListener),this._element.removeEventListener("click",this._clickListener))},g.prototype._onMouseMove=function(p){this._lastHoverCoords[0]===p.pageX&&this._lastHoverCoords[1]===p.pageY||(this._onHover(p),this._lastHoverCoords=[p.pageX,p.pageY])},g.prototype._onHover=function(p){var _=this,x=this._findZoneEventAt(p);x!==this._currentZone&&(this._currentZone&&(this._currentZone.leaveCallback(),this._currentZone=void 0,this._tooltipTimeout&&clearTimeout(this._tooltipTimeout)),x&&(this._currentZone=x,x.hoverCallback&&x.hoverCallback(p),this._tooltipTimeout=window.setTimeout(function(){return _._onTooltip(p)},this._optionsService.rawOptions.linkTooltipHoverDuration)))},g.prototype._onTooltip=function(p){this._tooltipTimeout=void 0;var _=this._findZoneEventAt(p);_==null||_.tooltipCallback(p)},g.prototype._onMouseDown=function(p){if(this._initialSelectionLength=this._getSelectionLength(),this._areZonesActive){var _=this._findZoneEventAt(p);_!=null&&_.willLinkActivate(p)&&(p.preventDefault(),p.stopImmediatePropagation())}},g.prototype._onMouseLeave=function(p){this._currentZone&&(this._currentZone.leaveCallback(),this._currentZone=void 0,this._tooltipTimeout&&clearTimeout(this._tooltipTimeout))},g.prototype._onClick=function(p){var _=this._findZoneEventAt(p),x=this._getSelectionLength();_&&x===this._initialSelectionLength&&(_.clickCallback(p),p.preventDefault(),p.stopImmediatePropagation())},g.prototype._getSelectionLength=function(){var p=this._selectionService.selectionText;return p?p.length:0},g.prototype._findZoneEventAt=function(p){var _=this._mouseService.getCoords(p,this._screenElement,this._bufferService.cols,this._bufferService.rows);if(_)for(var x=_[0],b=_[1],y=0;y<this._zones.length;y++){var w=this._zones[y];if(w.y1===w.y2){if(b===w.y1&&x>=w.x1&&x<w.x2)return w}else if(b===w.y1&&x>=w.x1||b===w.y2&&x<w.x2||b>w.y1&&b<w.y2)return w}},l([h(2,d.IBufferService),h(3,f.IMouseService),h(4,f.ISelectionService),h(5,d.IOptionsService)],g)}(u.Disposable);r.MouseZoneManager=m},6193:function(i,r){var n=this&&this.__values||function(a){var l=typeof Symbol=="function"&&Symbol.iterator,h=l&&a[l],u=0;if(h)return h.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&u>=a.length&&(a=void 0),{value:a&&a[u++],done:!a}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.RenderDebouncer=void 0;var o=function(){function a(l){this._renderCallback=l,this._refreshCallbacks=[]}return a.prototype.dispose=function(){this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},a.prototype.addRefreshCallback=function(l){var h=this;return this._refreshCallbacks.push(l),this._animationFrame||(this._animationFrame=window.requestAnimationFrame(function(){return h._innerRefresh()})),this._animationFrame},a.prototype.refresh=function(l,h,u){var c=this;this._rowCount=u,l=l!==void 0?l:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,l):l,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h,this._animationFrame||(this._animationFrame=window.requestAnimationFrame(function(){return c._innerRefresh()}))},a.prototype._innerRefresh=function(){if(this._animationFrame=void 0,this._rowStart!==void 0&&this._rowEnd!==void 0&&this._rowCount!==void 0){var l=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(l,h),this._runRefreshCallbacks()}else this._runRefreshCallbacks()},a.prototype._runRefreshCallbacks=function(){var l,h;try{for(var u=n(this._refreshCallbacks),c=u.next();!c.done;c=u.next())(0,c.value)(0)}catch(f){l={error:f}}finally{try{c&&!c.done&&(h=u.return)&&h.call(u)}finally{if(l)throw l.error}}this._refreshCallbacks=[]},a}();r.RenderDebouncer=o},5596:function(i,r,n){var o,a=this&&this.__extends||(o=function(h,u){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,f){c.__proto__=f}||function(c,f){for(var d in f)Object.prototype.hasOwnProperty.call(f,d)&&(c[d]=f[d])},o(h,u)},function(h,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function c(){this.constructor=h}o(h,u),h.prototype=u===null?Object.create(u):(c.prototype=u.prototype,new c)});Object.defineProperty(r,"__esModule",{value:!0}),r.ScreenDprMonitor=void 0;var l=function(h){function u(){var c=h!==null&&h.apply(this,arguments)||this;return c._currentDevicePixelRatio=window.devicePixelRatio,c}return a(u,h),u.prototype.setListener=function(c){var f=this;this._listener&&this.clearListener(),this._listener=c,this._outerListener=function(){f._listener&&(f._listener(window.devicePixelRatio,f._currentDevicePixelRatio),f._updateDpr())},this._updateDpr()},u.prototype.dispose=function(){h.prototype.dispose.call(this),this.clearListener()},u.prototype._updateDpr=function(){var c;this._outerListener&&((c=this._resolutionMediaMatchList)===null||c===void 0||c.removeListener(this._outerListener),this._currentDevicePixelRatio=window.devicePixelRatio,this._resolutionMediaMatchList=window.matchMedia("screen and (resolution: "+window.devicePixelRatio+"dppx)"),this._resolutionMediaMatchList.addListener(this._outerListener))},u.prototype.clearListener=function(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)},u}(n(844).Disposable);r.ScreenDprMonitor=l},3236:function(i,r,n){var o,a=this&&this.__extends||(o=function(re,Y){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(U,z){U.__proto__=z}||function(U,z){for(var te in z)Object.prototype.hasOwnProperty.call(z,te)&&(U[te]=z[te])},o(re,Y)},function(re,Y){if(typeof Y!="function"&&Y!==null)throw new TypeError("Class extends value "+String(Y)+" is not a constructor or null");function U(){this.constructor=re}o(re,Y),re.prototype=Y===null?Object.create(Y):(U.prototype=Y.prototype,new U)}),l=this&&this.__values||function(re){var Y=typeof Symbol=="function"&&Symbol.iterator,U=Y&&re[Y],z=0;if(U)return U.call(re);if(re&&typeof re.length=="number")return{next:function(){return re&&z>=re.length&&(re=void 0),{value:re&&re[z++],done:!re}}};throw new TypeError(Y?"Object is not iterable.":"Symbol.iterator is not defined.")},h=this&&this.__read||function(re,Y){var U=typeof Symbol=="function"&&re[Symbol.iterator];if(!U)return re;var z,te,ge=U.call(re),Me=[];try{for(;(Y===void 0||Y-- >0)&&!(z=ge.next()).done;)Me.push(z.value)}catch(ze){te={error:ze}}finally{try{z&&!z.done&&(U=ge.return)&&U.call(ge)}finally{if(te)throw te.error}}return Me},u=this&&this.__spreadArray||function(re,Y,U){if(U||arguments.length===2)for(var z,te=0,ge=Y.length;te<ge;te++)!z&&te in Y||(z||(z=Array.prototype.slice.call(Y,0,te)),z[te]=Y[te]);return re.concat(z||Array.prototype.slice.call(Y))};Object.defineProperty(r,"__esModule",{value:!0}),r.Terminal=void 0;var c=n(2950),f=n(1680),d=n(3614),m=n(2584),v=n(5435),g=n(3525),p=n(3551),_=n(9312),x=n(6114),b=n(3656),y=n(9042),w=n(357),S=n(6954),R=n(4567),E=n(1296),T=n(7399),A=n(8460),C=n(8437),M=n(5680),D=n(3230),O=n(4725),P=n(428),L=n(8934),I=n(6465),k=n(5114),B=n(8969),F=n(8055),W=n(4269),V=n(5941),N=n(3107),ne=n(5744),ie=n(9074),Q=n(2585),K=typeof window!="undefined"?window.document:null,de=function(re){function Y(U){U===void 0&&(U={});var z=re.call(this,U)||this;return z.browser=x,z._keyDownHandled=!1,z._keyDownSeen=!1,z._keyPressHandled=!1,z._unprocessedDeadKey=!1,z._onCursorMove=new A.EventEmitter,z._onKey=new A.EventEmitter,z._onRender=new A.EventEmitter,z._onSelectionChange=new A.EventEmitter,z._onTitleChange=new A.EventEmitter,z._onBell=new A.EventEmitter,z._onFocus=new A.EventEmitter,z._onBlur=new A.EventEmitter,z._onA11yCharEmitter=new A.EventEmitter,z._onA11yTabEmitter=new A.EventEmitter,z._setup(),z.linkifier=z._instantiationService.createInstance(p.Linkifier),z.linkifier2=z.register(z._instantiationService.createInstance(I.Linkifier2)),z._decorationService=z._instantiationService.createInstance(ie.DecorationService),z._instantiationService.setService(Q.IDecorationService,z._decorationService),z.register(z._inputHandler.onRequestBell(function(){return z.bell()})),z.register(z._inputHandler.onRequestRefreshRows(function(te,ge){return z.refresh(te,ge)})),z.register(z._inputHandler.onRequestSendFocus(function(){return z._reportFocus()})),z.register(z._inputHandler.onRequestReset(function(){return z.reset()})),z.register(z._inputHandler.onRequestWindowsOptionsReport(function(te){return z._reportWindowsOptions(te)})),z.register(z._inputHandler.onColor(function(te){return z._handleColorEvent(te)})),z.register((0,A.forwardEvent)(z._inputHandler.onCursorMove,z._onCursorMove)),z.register((0,A.forwardEvent)(z._inputHandler.onTitleChange,z._onTitleChange)),z.register((0,A.forwardEvent)(z._inputHandler.onA11yChar,z._onA11yCharEmitter)),z.register((0,A.forwardEvent)(z._inputHandler.onA11yTab,z._onA11yTabEmitter)),z.register(z._bufferService.onResize(function(te){return z._afterResize(te.cols,te.rows)})),z}return a(Y,re),Object.defineProperty(Y.prototype,"onCursorMove",{get:function(){return this._onCursorMove.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onKey",{get:function(){return this._onKey.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onSelectionChange",{get:function(){return this._onSelectionChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onTitleChange",{get:function(){return this._onTitleChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onBell",{get:function(){return this._onBell.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onFocus",{get:function(){return this._onFocus.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onBlur",{get:function(){return this._onBlur.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onA11yChar",{get:function(){return this._onA11yCharEmitter.event},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onA11yTab",{get:function(){return this._onA11yTabEmitter.event},enumerable:!1,configurable:!0}),Y.prototype._handleColorEvent=function(U){var z,te,ge,Me;if(this._colorManager){try{for(var ze=l(U),He=ze.next();!He.done;He=ze.next()){var Ne=He.value,Ye=void 0,Ae="";switch(Ne.index){case 256:Ye="foreground",Ae="10";break;case 257:Ye="background",Ae="11";break;case 258:Ye="cursor",Ae="12";break;default:Ye="ansi",Ae="4;"+Ne.index}if(Ye)switch(Ne.type){case 0:var Ft=F.color.toColorRGB(Ye==="ansi"?this._colorManager.colors.ansi[Ne.index]:this._colorManager.colors[Ye]);this.coreService.triggerDataEvent(m.C0.ESC+"]"+Ae+";"+(0,V.toRgbString)(Ft)+m.C1_ESCAPED.ST);break;case 1:Ye==="ansi"?this._colorManager.colors.ansi[Ne.index]=F.rgba.toColor.apply(F.rgba,u([],h(Ne.color),!1)):this._colorManager.colors[Ye]=F.rgba.toColor.apply(F.rgba,u([],h(Ne.color),!1));break;case 2:this._colorManager.restoreColor(Ne.index)}}}catch(Z){z={error:Z}}finally{try{He&&!He.done&&(te=ze.return)&&te.call(ze)}finally{if(z)throw z.error}}(ge=this._renderService)===null||ge===void 0||ge.setColors(this._colorManager.colors),(Me=this.viewport)===null||Me===void 0||Me.onThemeChange(this._colorManager.colors)}},Y.prototype.dispose=function(){var U,z,te;this._isDisposed||(re.prototype.dispose.call(this),(U=this._renderService)===null||U===void 0||U.dispose(),this._customKeyEventHandler=void 0,this.write=function(){},(te=(z=this.element)===null||z===void 0?void 0:z.parentNode)===null||te===void 0||te.removeChild(this.element))},Y.prototype._setup=function(){re.prototype._setup.call(this),this._customKeyEventHandler=void 0},Object.defineProperty(Y.prototype,"buffer",{get:function(){return this.buffers.active},enumerable:!1,configurable:!0}),Y.prototype.focus=function(){this.textarea&&this.textarea.focus({preventScroll:!0})},Y.prototype._updateOptions=function(U){var z,te,ge,Me;switch(re.prototype._updateOptions.call(this,U),U){case"fontFamily":case"fontSize":(z=this._renderService)===null||z===void 0||z.clear(),(te=this._charSizeService)===null||te===void 0||te.measure();break;case"cursorBlink":case"cursorStyle":this.refresh(this.buffer.y,this.buffer.y);break;case"customGlyphs":case"drawBoldTextInBrightColors":case"letterSpacing":case"lineHeight":case"fontWeight":case"fontWeightBold":case"minimumContrastRatio":this._renderService&&(this._renderService.clear(),this._renderService.onResize(this.cols,this.rows),this.refresh(0,this.rows-1));break;case"rendererType":this._renderService&&(this._renderService.setRenderer(this._createRenderer()),this._renderService.onResize(this.cols,this.rows));break;case"scrollback":(ge=this.viewport)===null||ge===void 0||ge.syncScrollArea();break;case"screenReaderMode":this.optionsService.rawOptions.screenReaderMode?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new R.AccessibilityManager(this,this._renderService)):((Me=this._accessibilityManager)===null||Me===void 0||Me.dispose(),this._accessibilityManager=void 0);break;case"tabStopWidth":this.buffers.setupTabStops();break;case"theme":this._setTheme(this.optionsService.rawOptions.theme)}},Y.prototype._onTextAreaFocus=function(U){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(m.C0.ESC+"[I"),this.updateCursorStyle(U),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()},Y.prototype.blur=function(){var U;return(U=this.textarea)===null||U===void 0?void 0:U.blur()},Y.prototype._onTextAreaBlur=function(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(m.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()},Y.prototype._syncTextArea=function(){if(this.textarea&&this.buffer.isCursorInViewport&&!this._compositionHelper.isComposing&&this._renderService){var U=this.buffer.ybase+this.buffer.y,z=this.buffer.lines.get(U);if(z){var te=Math.min(this.buffer.x,this.cols-1),ge=this._renderService.dimensions.actualCellHeight,Me=z.getWidth(te),ze=this._renderService.dimensions.actualCellWidth*Me,He=this.buffer.y*this._renderService.dimensions.actualCellHeight,Ne=te*this._renderService.dimensions.actualCellWidth;this.textarea.style.left=Ne+"px",this.textarea.style.top=He+"px",this.textarea.style.width=ze+"px",this.textarea.style.height=ge+"px",this.textarea.style.lineHeight=ge+"px",this.textarea.style.zIndex="-5"}}},Y.prototype._initGlobal=function(){var U=this;this._bindKeys(),this.register((0,b.addDisposableDomListener)(this.element,"copy",function(te){U.hasSelection()&&(0,d.copyHandler)(te,U._selectionService)}));var z=function(te){return(0,d.handlePasteEvent)(te,U.textarea,U.coreService)};this.register((0,b.addDisposableDomListener)(this.textarea,"paste",z)),this.register((0,b.addDisposableDomListener)(this.element,"paste",z)),x.isFirefox?this.register((0,b.addDisposableDomListener)(this.element,"mousedown",function(te){te.button===2&&(0,d.rightClickHandler)(te,U.textarea,U.screenElement,U._selectionService,U.options.rightClickSelectsWord)})):this.register((0,b.addDisposableDomListener)(this.element,"contextmenu",function(te){(0,d.rightClickHandler)(te,U.textarea,U.screenElement,U._selectionService,U.options.rightClickSelectsWord)})),x.isLinux&&this.register((0,b.addDisposableDomListener)(this.element,"auxclick",function(te){te.button===1&&(0,d.moveTextAreaUnderMouseCursor)(te,U.textarea,U.screenElement)}))},Y.prototype._bindKeys=function(){var U=this;this.register((0,b.addDisposableDomListener)(this.textarea,"keyup",function(z){return U._keyUp(z)},!0)),this.register((0,b.addDisposableDomListener)(this.textarea,"keydown",function(z){return U._keyDown(z)},!0)),this.register((0,b.addDisposableDomListener)(this.textarea,"keypress",function(z){return U._keyPress(z)},!0)),this.register((0,b.addDisposableDomListener)(this.textarea,"compositionstart",function(){return U._compositionHelper.compositionstart()})),this.register((0,b.addDisposableDomListener)(this.textarea,"compositionupdate",function(z){return U._compositionHelper.compositionupdate(z)})),this.register((0,b.addDisposableDomListener)(this.textarea,"compositionend",function(){return U._compositionHelper.compositionend()})),this.register((0,b.addDisposableDomListener)(this.textarea,"input",function(z){return U._inputEvent(z)},!0)),this.register(this.onRender(function(){return U._compositionHelper.updateCompositionElements()})),this.register(this.onRender(function(z){return U._queueLinkification(z.start,z.end)}))},Y.prototype.open=function(U){var z=this;if(!U)throw new Error("Terminal requires a parent element.");U.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=U.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),U.appendChild(this.element);var te=K.createDocumentFragment();this._viewportElement=K.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),te.appendChild(this._viewportElement),this._viewportScrollArea=K.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=K.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=K.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),te.appendChild(this.screenElement),this.textarea=K.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",y.promptLabel),this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this.register((0,b.addDisposableDomListener)(this.textarea,"focus",function(ze){return z._onTextAreaFocus(ze)})),this.register((0,b.addDisposableDomListener)(this.textarea,"blur",function(){return z._onTextAreaBlur()})),this._helperContainer.appendChild(this.textarea);var ge=this._instantiationService.createInstance(k.CoreBrowserService,this.textarea);this._instantiationService.setService(O.ICoreBrowserService,ge),this._charSizeService=this._instantiationService.createInstance(P.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(O.ICharSizeService,this._charSizeService),this._theme=this.options.theme||this._theme,this._colorManager=new M.ColorManager(K,this.options.allowTransparency),this.register(this.optionsService.onOptionChange(function(ze){return z._colorManager.onOptionsChange(ze)})),this._colorManager.setTheme(this._theme),this._characterJoinerService=this._instantiationService.createInstance(W.CharacterJoinerService),this._instantiationService.setService(O.ICharacterJoinerService,this._characterJoinerService);var Me=this._createRenderer();this._renderService=this.register(this._instantiationService.createInstance(D.RenderService,Me,this.rows,this.screenElement)),this._instantiationService.setService(O.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(function(ze){return z._onRender.fire(ze)})),this.onResize(function(ze){return z._renderService.resize(ze.cols,ze.rows)}),this._compositionView=K.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(c.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(te),this._soundService=this._instantiationService.createInstance(w.SoundService),this._instantiationService.setService(O.ISoundService,this._soundService),this._mouseService=this._instantiationService.createInstance(L.MouseService),this._instantiationService.setService(O.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(f.Viewport,function(ze){return z.scrollLines(ze,!0,1)},this._viewportElement,this._viewportScrollArea,this.element),this.viewport.onThemeChange(this._colorManager.colors),this.register(this._inputHandler.onRequestSyncScrollBar(function(){return z.viewport.syncScrollArea()})),this.register(this.viewport),this.register(this.onCursorMove(function(){z._renderService.onCursorMove(),z._syncTextArea()})),this.register(this.onResize(function(){return z._renderService.onResize(z.cols,z.rows)})),this.register(this.onBlur(function(){return z._renderService.onBlur()})),this.register(this.onFocus(function(){return z._renderService.onFocus()})),this.register(this._renderService.onDimensionsChange(function(){return z.viewport.syncScrollArea()})),this._selectionService=this.register(this._instantiationService.createInstance(_.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(O.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(function(ze){return z.scrollLines(ze.amount,ze.suppressScrollEvent)})),this.register(this._selectionService.onSelectionChange(function(){return z._onSelectionChange.fire()})),this.register(this._selectionService.onRequestRedraw(function(ze){return z._renderService.onSelectionChanged(ze.start,ze.end,ze.columnSelectMode)})),this.register(this._selectionService.onLinuxMouseSelection(function(ze){z.textarea.value=ze,z.textarea.focus(),z.textarea.select()})),this.register(this._onScroll.event(function(ze){z.viewport.syncScrollArea(),z._selectionService.refresh()})),this.register((0,b.addDisposableDomListener)(this._viewportElement,"scroll",function(){return z._selectionService.refresh()})),this._mouseZoneManager=this._instantiationService.createInstance(S.MouseZoneManager,this.element,this.screenElement),this.register(this._mouseZoneManager),this.register(this.onScroll(function(){return z._mouseZoneManager.clearAll()})),this.linkifier.attachToDom(this.element,this._mouseZoneManager),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(N.BufferDecorationRenderer,this.screenElement)),this.register((0,b.addDisposableDomListener)(this.element,"mousedown",function(ze){return z._selectionService.onMouseDown(ze)})),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new R.AccessibilityManager(this,this._renderService)),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this._instantiationService.createInstance(ne.OverviewRulerRenderer,this._viewportElement,this.screenElement)),this.optionsService.onOptionChange(function(){!z._overviewRulerRenderer&&z.options.overviewRulerWidth&&z._viewportElement&&z.screenElement&&(z._overviewRulerRenderer=z._instantiationService.createInstance(ne.OverviewRulerRenderer,z._viewportElement,z.screenElement))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()},Y.prototype._createRenderer=function(){switch(this.options.rendererType){case"canvas":return this._instantiationService.createInstance(g.Renderer,this._colorManager.colors,this.screenElement,this.linkifier,this.linkifier2);case"dom":return this._instantiationService.createInstance(E.DomRenderer,this._colorManager.colors,this.element,this.screenElement,this._viewportElement,this.linkifier,this.linkifier2);default:throw new Error('Unrecognized rendererType "'+this.options.rendererType+'"')}},Y.prototype._setTheme=function(U){var z,te,ge;this._theme=U,(z=this._colorManager)===null||z===void 0||z.setTheme(U),(te=this._renderService)===null||te===void 0||te.setColors(this._colorManager.colors),(ge=this.viewport)===null||ge===void 0||ge.onThemeChange(this._colorManager.colors)},Y.prototype.bindMouse=function(){var U=this,z=this,te=this.element;function ge(Ae){var Ft,Z,j=z._mouseService.getRawByteCoords(Ae,z.screenElement,z.cols,z.rows);if(!j)return!1;switch(Ae.overrideType||Ae.type){case"mousemove":Z=32,Ae.buttons===void 0?(Ft=3,Ae.button!==void 0&&(Ft=Ae.button<3?Ae.button:3)):Ft=1&Ae.buttons?0:4&Ae.buttons?1:2&Ae.buttons?2:3;break;case"mouseup":Z=0,Ft=Ae.button<3?Ae.button:3;break;case"mousedown":Z=1,Ft=Ae.button<3?Ae.button:3;break;case"wheel":if(z.viewport.getLinesScrolled(Ae)===0)return!1;Z=Ae.deltaY<0?0:1,Ft=4;break;default:return!1}return!(Z===void 0||Ft===void 0||Ft>4)&&z.coreMouseService.triggerMouseEvent({col:j.x-33,row:j.y-33,button:Ft,action:Z,ctrl:Ae.ctrlKey,alt:Ae.altKey,shift:Ae.shiftKey})}var Me={mouseup:null,wheel:null,mousedrag:null,mousemove:null},ze=function(Ae){return ge(Ae),Ae.buttons||(U._document.removeEventListener("mouseup",Me.mouseup),Me.mousedrag&&U._document.removeEventListener("mousemove",Me.mousedrag)),U.cancel(Ae)},He=function(Ae){return ge(Ae),U.cancel(Ae,!0)},Ne=function(Ae){Ae.buttons&&ge(Ae)},Ye=function(Ae){Ae.buttons||ge(Ae)};this.register(this.coreMouseService.onProtocolChange(function(Ae){Ae?(U.optionsService.rawOptions.logLevel==="debug"&&U._logService.debug("Binding to mouse events:",U.coreMouseService.explainEvents(Ae)),U.element.classList.add("enable-mouse-events"),U._selectionService.disable()):(U._logService.debug("Unbinding from mouse events."),U.element.classList.remove("enable-mouse-events"),U._selectionService.enable()),8&Ae?Me.mousemove||(te.addEventListener("mousemove",Ye),Me.mousemove=Ye):(te.removeEventListener("mousemove",Me.mousemove),Me.mousemove=null),16&Ae?Me.wheel||(te.addEventListener("wheel",He,{passive:!1}),Me.wheel=He):(te.removeEventListener("wheel",Me.wheel),Me.wheel=null),2&Ae?Me.mouseup||(Me.mouseup=ze):(U._document.removeEventListener("mouseup",Me.mouseup),Me.mouseup=null),4&Ae?Me.mousedrag||(Me.mousedrag=Ne):(U._document.removeEventListener("mousemove",Me.mousedrag),Me.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,b.addDisposableDomListener)(te,"mousedown",function(Ae){if(Ae.preventDefault(),U.focus(),U.coreMouseService.areMouseEventsActive&&!U._selectionService.shouldForceSelection(Ae))return ge(Ae),Me.mouseup&&U._document.addEventListener("mouseup",Me.mouseup),Me.mousedrag&&U._document.addEventListener("mousemove",Me.mousedrag),U.cancel(Ae)})),this.register((0,b.addDisposableDomListener)(te,"wheel",function(Ae){if(!Me.wheel){if(!U.buffer.hasScrollback){var Ft=U.viewport.getLinesScrolled(Ae);if(Ft===0)return;for(var Z=m.C0.ESC+(U.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Ae.deltaY<0?"A":"B"),j="",_e=0;_e<Math.abs(Ft);_e++)j+=Z;return U.coreService.triggerDataEvent(j,!0),U.cancel(Ae,!0)}return U.viewport.onWheel(Ae)?U.cancel(Ae):void 0}},{passive:!1})),this.register((0,b.addDisposableDomListener)(te,"touchstart",function(Ae){if(!U.coreMouseService.areMouseEventsActive)return U.viewport.onTouchStart(Ae),U.cancel(Ae)},{passive:!0})),this.register((0,b.addDisposableDomListener)(te,"touchmove",function(Ae){if(!U.coreMouseService.areMouseEventsActive)return U.viewport.onTouchMove(Ae)?void 0:U.cancel(Ae)},{passive:!1}))},Y.prototype.refresh=function(U,z){var te;(te=this._renderService)===null||te===void 0||te.refreshRows(U,z)},Y.prototype._queueLinkification=function(U,z){var te;(te=this.linkifier)===null||te===void 0||te.linkifyRows(U,z)},Y.prototype.updateCursorStyle=function(U){var z;!((z=this._selectionService)===null||z===void 0)&&z.shouldColumnSelect(U)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")},Y.prototype._showCursor=function(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))},Y.prototype.scrollLines=function(U,z,te){te===void 0&&(te=0),re.prototype.scrollLines.call(this,U,z,te),this.refresh(0,this.rows-1)},Y.prototype.paste=function(U){(0,d.paste)(U,this.textarea,this.coreService)},Y.prototype.attachCustomKeyEventHandler=function(U){this._customKeyEventHandler=U},Y.prototype.registerLinkMatcher=function(U,z,te){var ge=this.linkifier.registerLinkMatcher(U,z,te);return this.refresh(0,this.rows-1),ge},Y.prototype.deregisterLinkMatcher=function(U){this.linkifier.deregisterLinkMatcher(U)&&this.refresh(0,this.rows-1)},Y.prototype.registerLinkProvider=function(U){return this.linkifier2.registerLinkProvider(U)},Y.prototype.registerCharacterJoiner=function(U){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");var z=this._characterJoinerService.register(U);return this.refresh(0,this.rows-1),z},Y.prototype.deregisterCharacterJoiner=function(U){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(U)&&this.refresh(0,this.rows-1)},Object.defineProperty(Y.prototype,"markers",{get:function(){return this.buffer.markers},enumerable:!1,configurable:!0}),Y.prototype.addMarker=function(U){if(this.buffer===this.buffers.normal)return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+U)},Y.prototype.registerDecoration=function(U){return this._decorationService.registerDecoration(U)},Y.prototype.hasSelection=function(){return!!this._selectionService&&this._selectionService.hasSelection},Y.prototype.select=function(U,z,te){this._selectionService.setSelection(U,z,te)},Y.prototype.getSelection=function(){return this._selectionService?this._selectionService.selectionText:""},Y.prototype.getSelectionPosition=function(){if(this._selectionService&&this._selectionService.hasSelection)return{startColumn:this._selectionService.selectionStart[0],startRow:this._selectionService.selectionStart[1],endColumn:this._selectionService.selectionEnd[0],endRow:this._selectionService.selectionEnd[1]}},Y.prototype.clearSelection=function(){var U;(U=this._selectionService)===null||U===void 0||U.clearSelection()},Y.prototype.selectAll=function(){var U;(U=this._selectionService)===null||U===void 0||U.selectAll()},Y.prototype.selectLines=function(U,z){var te;(te=this._selectionService)===null||te===void 0||te.selectLines(U,z)},Y.prototype._keyDown=function(U){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(U)===!1)return!1;var z=this.browser.isMac&&this.options.macOptionIsMeta&&U.altKey;if(!z&&!this._compositionHelper.keydown(U))return this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;z||U.key!=="Dead"&&U.key!=="AltGraph"||(this._unprocessedDeadKey=!0);var te=(0,T.evaluateKeyboardEvent)(U,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(U),te.type===3||te.type===2){var ge=this.rows-1;return this.scrollLines(te.type===2?-ge:ge),this.cancel(U,!0)}return te.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,U)||(te.cancel&&this.cancel(U,!0),!te.key||!!(U.key&&!U.ctrlKey&&!U.altKey&&!U.metaKey&&U.key.length===1&&U.key.charCodeAt(0)>=65&&U.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(te.key!==m.C0.ETX&&te.key!==m.C0.CR||(this.textarea.value=""),this._onKey.fire({key:te.key,domEvent:U}),this._showCursor(),this.coreService.triggerDataEvent(te.key,!0),this.optionsService.rawOptions.screenReaderMode?void(this._keyDownHandled=!0):this.cancel(U,!0))))},Y.prototype._isThirdLevelShift=function(U,z){var te=U.isMac&&!this.options.macOptionIsMeta&&z.altKey&&!z.ctrlKey&&!z.metaKey||U.isWindows&&z.altKey&&z.ctrlKey&&!z.metaKey||U.isWindows&&z.getModifierState("AltGraph");return z.type==="keypress"?te:te&&(!z.keyCode||z.keyCode>47)},Y.prototype._keyUp=function(U){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(U)===!1||(function(z){return z.keyCode===16||z.keyCode===17||z.keyCode===18}(U)||this.focus(),this.updateCursorStyle(U),this._keyPressHandled=!1)},Y.prototype._keyPress=function(U){var z;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(U)===!1)return!1;if(this.cancel(U),U.charCode)z=U.charCode;else if(U.which===null||U.which===void 0)z=U.keyCode;else{if(U.which===0||U.charCode===0)return!1;z=U.which}return!(!z||(U.altKey||U.ctrlKey||U.metaKey)&&!this._isThirdLevelShift(this.browser,U)||(z=String.fromCharCode(z),this._onKey.fire({key:z,domEvent:U}),this._showCursor(),this.coreService.triggerDataEvent(z,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))},Y.prototype._inputEvent=function(U){if(U.data&&U.inputType==="insertText"&&(!U.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;var z=U.data;return this.coreService.triggerDataEvent(z,!0),this.cancel(U),!0}return!1},Y.prototype.bell=function(){var U;this._soundBell()&&((U=this._soundService)===null||U===void 0||U.playBellSound()),this._onBell.fire()},Y.prototype.resize=function(U,z){U!==this.cols||z!==this.rows?re.prototype.resize.call(this,U,z):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()},Y.prototype._afterResize=function(U,z){var te,ge;(te=this._charSizeService)===null||te===void 0||te.measure(),(ge=this.viewport)===null||ge===void 0||ge.syncScrollArea(!0)},Y.prototype.clear=function(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(var U=1;U<this.rows;U++)this.buffer.lines.push(this.buffer.getBlankLine(C.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}},Y.prototype.reset=function(){var U,z;this.options.rows=this.rows,this.options.cols=this.cols;var te=this._customKeyEventHandler;this._setup(),re.prototype.reset.call(this),(U=this._selectionService)===null||U===void 0||U.reset(),this._decorationService.reset(),this._customKeyEventHandler=te,this.refresh(0,this.rows-1),(z=this.viewport)===null||z===void 0||z.syncScrollArea()},Y.prototype.clearTextureAtlas=function(){var U;(U=this._renderService)===null||U===void 0||U.clearTextureAtlas()},Y.prototype._reportFocus=function(){var U;!((U=this.element)===null||U===void 0)&&U.classList.contains("focus")?this.coreService.triggerDataEvent(m.C0.ESC+"[I"):this.coreService.triggerDataEvent(m.C0.ESC+"[O")},Y.prototype._reportWindowsOptions=function(U){if(this._renderService)switch(U){case v.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:var z=this._renderService.dimensions.scaledCanvasWidth.toFixed(0),te=this._renderService.dimensions.scaledCanvasHeight.toFixed(0);this.coreService.triggerDataEvent(m.C0.ESC+"[4;"+te+";"+z+"t");break;case v.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:var ge=this._renderService.dimensions.scaledCellWidth.toFixed(0),Me=this._renderService.dimensions.scaledCellHeight.toFixed(0);this.coreService.triggerDataEvent(m.C0.ESC+"[6;"+Me+";"+ge+"t")}},Y.prototype.cancel=function(U,z){if(this.options.cancelEvents||z)return U.preventDefault(),U.stopPropagation(),!1},Y.prototype._visualBell=function(){return!1},Y.prototype._soundBell=function(){return this.options.bellStyle==="sound"},Y}(B.CoreTerminal);r.Terminal=de},9924:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TimeBasedDebouncer=void 0;var n=function(){function o(a,l){l===void 0&&(l=1e3),this._renderCallback=a,this._debounceThresholdMS=l,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}return o.prototype.dispose=function(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)},o.prototype.refresh=function(a,l,h){var u=this;this._rowCount=h,a=a!==void 0?a:0,l=l!==void 0?l:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,l):l;var c=Date.now();if(c-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=c,this._innerRefresh();else if(!this._additionalRefreshRequested){var f=c-this._lastRefreshMs,d=this._debounceThresholdMS-f;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(function(){u._lastRefreshMs=Date.now(),u._innerRefresh(),u._additionalRefreshRequested=!1,u._refreshTimeoutID=void 0},d)}},o.prototype._innerRefresh=function(){if(this._rowStart!==void 0&&this._rowEnd!==void 0&&this._rowCount!==void 0){var a=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,l)}},o}();r.TimeBasedDebouncer=n},1680:function(i,r,n){var o,a=this&&this.__extends||(o=function(v,g){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,_){p.__proto__=_}||function(p,_){for(var x in _)Object.prototype.hasOwnProperty.call(_,x)&&(p[x]=_[x])},o(v,g)},function(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function p(){this.constructor=v}o(v,g),v.prototype=g===null?Object.create(g):(p.prototype=g.prototype,new p)}),l=this&&this.__decorate||function(v,g,p,_){var x,b=arguments.length,y=b<3?g:_===null?_=Object.getOwnPropertyDescriptor(g,p):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(v,g,p,_);else for(var w=v.length-1;w>=0;w--)(x=v[w])&&(y=(b<3?x(y):b>3?x(g,p,y):x(g,p))||y);return b>3&&y&&Object.defineProperty(g,p,y),y},h=this&&this.__param||function(v,g){return function(p,_){g(p,_,v)}};Object.defineProperty(r,"__esModule",{value:!0}),r.Viewport=void 0;var u=n(844),c=n(3656),f=n(4725),d=n(2585),m=function(v){function g(p,_,x,b,y,w,S,R){var E=v.call(this)||this;return E._scrollLines=p,E._viewportElement=_,E._scrollArea=x,E._element=b,E._bufferService=y,E._optionsService=w,E._charSizeService=S,E._renderService=R,E.scrollBarWidth=0,E._currentRowHeight=0,E._currentScaledCellHeight=0,E._lastRecordedBufferLength=0,E._lastRecordedViewportHeight=0,E._lastRecordedBufferHeight=0,E._lastTouchY=0,E._lastScrollTop=0,E._wheelPartialScroll=0,E._refreshAnimationFrame=null,E._ignoreNextScrollEvent=!1,E.scrollBarWidth=E._viewportElement.offsetWidth-E._scrollArea.offsetWidth||15,E.register((0,c.addDisposableDomListener)(E._viewportElement,"scroll",E._onScroll.bind(E))),E._activeBuffer=E._bufferService.buffer,E.register(E._bufferService.buffers.onBufferActivate(function(T){return E._activeBuffer=T.activeBuffer})),E._renderDimensions=E._renderService.dimensions,E.register(E._renderService.onDimensionsChange(function(T){return E._renderDimensions=T})),setTimeout(function(){return E.syncScrollArea()},0),E}return a(g,v),g.prototype.onThemeChange=function(p){this._viewportElement.style.backgroundColor=p.background.css},g.prototype._refresh=function(p){var _=this;if(p)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=requestAnimationFrame(function(){return _._innerRefresh()}))},g.prototype._innerRefresh=function(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.scaledCellHeight/window.devicePixelRatio,this._currentScaledCellHeight=this._renderService.dimensions.scaledCellHeight,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;var p=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.canvasHeight);this._lastRecordedBufferHeight!==p&&(this._lastRecordedBufferHeight=p,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}var _=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==_&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=_),this._refreshAnimationFrame=null},g.prototype.syncScrollArea=function(p){if(p===void 0&&(p=!1),this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(p);this._lastRecordedViewportHeight===this._renderService.dimensions.canvasHeight&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.scaledCellHeight===this._currentScaledCellHeight||this._refresh(p)},g.prototype._onScroll=function(p){if(this._lastScrollTop=this._viewportElement.scrollTop,this._viewportElement.offsetParent){if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);var _=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(_)}},g.prototype._bubbleScroll=function(p,_){var x=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(_<0&&this._viewportElement.scrollTop!==0||_>0&&x<this._lastRecordedBufferHeight)||(p.cancelable&&p.preventDefault(),!1)},g.prototype.onWheel=function(p){var _=this._getPixelsScrolled(p);return _!==0&&(this._viewportElement.scrollTop+=_,this._bubbleScroll(p,_))},g.prototype._getPixelsScrolled=function(p){if(p.deltaY===0||p.shiftKey)return 0;var _=this._applyScrollModifier(p.deltaY,p);return p.deltaMode===WheelEvent.DOM_DELTA_LINE?_*=this._currentRowHeight:p.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(_*=this._currentRowHeight*this._bufferService.rows),_},g.prototype.getLinesScrolled=function(p){if(p.deltaY===0||p.shiftKey)return 0;var _=this._applyScrollModifier(p.deltaY,p);return p.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(_/=this._currentRowHeight+0,this._wheelPartialScroll+=_,_=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):p.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(_*=this._bufferService.rows),_},g.prototype._applyScrollModifier=function(p,_){var x=this._optionsService.rawOptions.fastScrollModifier;return x==="alt"&&_.altKey||x==="ctrl"&&_.ctrlKey||x==="shift"&&_.shiftKey?p*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:p*this._optionsService.rawOptions.scrollSensitivity},g.prototype.onTouchStart=function(p){this._lastTouchY=p.touches[0].pageY},g.prototype.onTouchMove=function(p){var _=this._lastTouchY-p.touches[0].pageY;return this._lastTouchY=p.touches[0].pageY,_!==0&&(this._viewportElement.scrollTop+=_,this._bubbleScroll(p,_))},l([h(4,d.IBufferService),h(5,d.IOptionsService),h(6,f.ICharSizeService),h(7,f.IRenderService)],g)}(u.Disposable);r.Viewport=m},3107:function(i,r,n){var o,a=this&&this.__extends||(o=function(g,p){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,x){_.__proto__=x}||function(_,x){for(var b in x)Object.prototype.hasOwnProperty.call(x,b)&&(_[b]=x[b])},o(g,p)},function(g,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function _(){this.constructor=g}o(g,p),g.prototype=p===null?Object.create(p):(_.prototype=p.prototype,new _)}),l=this&&this.__decorate||function(g,p,_,x){var b,y=arguments.length,w=y<3?p:x===null?x=Object.getOwnPropertyDescriptor(p,_):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,p,_,x);else for(var S=g.length-1;S>=0;S--)(b=g[S])&&(w=(y<3?b(w):y>3?b(p,_,w):b(p,_))||w);return y>3&&w&&Object.defineProperty(p,_,w),w},h=this&&this.__param||function(g,p){return function(_,x){p(_,x,g)}},u=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,_=p&&g[p],x=0;if(_)return _.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&x>=g.length&&(g=void 0),{value:g&&g[x++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferDecorationRenderer=void 0;var c=n(3656),f=n(4725),d=n(844),m=n(2585),v=function(g){function p(_,x,b,y){var w=g.call(this)||this;return w._screenElement=_,w._bufferService=x,w._decorationService=b,w._renderService=y,w._decorationElements=new Map,w._altBufferIsActive=!1,w._dimensionsChanged=!1,w._container=document.createElement("div"),w._container.classList.add("xterm-decoration-container"),w._screenElement.appendChild(w._container),w.register(w._renderService.onRenderedViewportChange(function(){return w._queueRefresh()})),w.register(w._renderService.onDimensionsChange(function(){w._dimensionsChanged=!0,w._queueRefresh()})),w.register((0,c.addDisposableDomListener)(window,"resize",function(){return w._queueRefresh()})),w.register(w._bufferService.buffers.onBufferActivate(function(){w._altBufferIsActive=w._bufferService.buffer===w._bufferService.buffers.alt})),w.register(w._decorationService.onDecorationRegistered(function(){return w._queueRefresh()})),w.register(w._decorationService.onDecorationRemoved(function(S){return w._removeDecoration(S)})),w}return a(p,g),p.prototype.dispose=function(){this._container.remove(),this._decorationElements.clear(),g.prototype.dispose.call(this)},p.prototype._queueRefresh=function(){var _=this;this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(function(){_.refreshDecorations(),_._animationFrame=void 0}))},p.prototype.refreshDecorations=function(){var _,x;try{for(var b=u(this._decorationService.decorations),y=b.next();!y.done;y=b.next()){var w=y.value;this._renderDecoration(w)}}catch(S){_={error:S}}finally{try{y&&!y.done&&(x=b.return)&&x.call(b)}finally{if(_)throw _.error}}this._dimensionsChanged=!1},p.prototype._renderDecoration=function(_){this._refreshStyle(_),this._dimensionsChanged&&this._refreshXPosition(_)},p.prototype._createElement=function(_){var x,b=document.createElement("div");b.classList.add("xterm-decoration"),b.style.width=Math.round((_.options.width||1)*this._renderService.dimensions.actualCellWidth)+"px",b.style.height=(_.options.height||1)*this._renderService.dimensions.actualCellHeight+"px",b.style.top=(_.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.actualCellHeight+"px",b.style.lineHeight=this._renderService.dimensions.actualCellHeight+"px";var y=(x=_.options.x)!==null&&x!==void 0?x:0;return y&&y>this._bufferService.cols&&(b.style.display="none"),this._refreshXPosition(_,b),b},p.prototype._refreshStyle=function(_){var x=this,b=_.marker.line-this._bufferService.buffers.active.ydisp;if(b<0||b>=this._bufferService.rows)_.element&&(_.element.style.display="none",_.onRenderEmitter.fire(_.element));else{var y=this._decorationElements.get(_);y||(_.onDispose(function(){return x._removeDecoration(_)}),y=this._createElement(_),_.element=y,this._decorationElements.set(_,y),this._container.appendChild(y)),y.style.top=b*this._renderService.dimensions.actualCellHeight+"px",y.style.display=this._altBufferIsActive?"none":"block",_.onRenderEmitter.fire(y)}},p.prototype._refreshXPosition=function(_,x){var b;if(x===void 0&&(x=_.element),x){var y=(b=_.options.x)!==null&&b!==void 0?b:0;(_.options.anchor||"left")==="right"?x.style.right=y?y*this._renderService.dimensions.actualCellWidth+"px":"":x.style.left=y?y*this._renderService.dimensions.actualCellWidth+"px":""}},p.prototype._removeDecoration=function(_){var x;(x=this._decorationElements.get(_))===null||x===void 0||x.remove(),this._decorationElements.delete(_)},l([h(1,m.IBufferService),h(2,m.IDecorationService),h(3,f.IRenderService)],p)}(d.Disposable);r.BufferDecorationRenderer=v},5871:function(i,r){var n=this&&this.__values||function(a){var l=typeof Symbol=="function"&&Symbol.iterator,h=l&&a[l],u=0;if(h)return h.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&u>=a.length&&(a=void 0),{value:a&&a[u++],done:!a}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.ColorZoneStore=void 0;var o=function(){function a(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}return Object.defineProperty(a.prototype,"zones",{get:function(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones},enumerable:!1,configurable:!0}),a.prototype.clear=function(){this._zones.length=0,this._zonePoolIndex=0},a.prototype.addDecoration=function(l){var h,u;if(l.options.overviewRulerOptions){try{for(var c=n(this._zones),f=c.next();!f.done;f=c.next()){var d=f.value;if(d.color===l.options.overviewRulerOptions.color&&d.position===l.options.overviewRulerOptions.position){if(this._lineIntersectsZone(d,l.marker.line))return;if(this._lineAdjacentToZone(d,l.marker.line,l.options.overviewRulerOptions.position))return void this._addLineToZone(d,l.marker.line)}}}catch(m){h={error:m}}finally{try{f&&!f.done&&(u=c.return)&&u.call(c)}finally{if(h)throw h.error}}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=l.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=l.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=l.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=l.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:l.options.overviewRulerOptions.color,position:l.options.overviewRulerOptions.position,startBufferLine:l.marker.line,endBufferLine:l.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}},a.prototype.setPadding=function(l){this._linePadding=l},a.prototype._lineIntersectsZone=function(l,h){return h>=l.startBufferLine&&h<=l.endBufferLine},a.prototype._lineAdjacentToZone=function(l,h,u){return h>=l.startBufferLine-this._linePadding[u||"full"]&&h<=l.endBufferLine+this._linePadding[u||"full"]},a.prototype._addLineToZone=function(l,h){l.startBufferLine=Math.min(l.startBufferLine,h),l.endBufferLine=Math.max(l.endBufferLine,h)},a}();r.ColorZoneStore=o},5744:function(i,r,n){var o,a=this&&this.__extends||(o=function(b,y){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,S){w.__proto__=S}||function(w,S){for(var R in S)Object.prototype.hasOwnProperty.call(S,R)&&(w[R]=S[R])},o(b,y)},function(b,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function w(){this.constructor=b}o(b,y),b.prototype=y===null?Object.create(y):(w.prototype=y.prototype,new w)}),l=this&&this.__decorate||function(b,y,w,S){var R,E=arguments.length,T=E<3?y:S===null?S=Object.getOwnPropertyDescriptor(y,w):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(b,y,w,S);else for(var A=b.length-1;A>=0;A--)(R=b[A])&&(T=(E<3?R(T):E>3?R(y,w,T):R(y,w))||T);return E>3&&T&&Object.defineProperty(y,w,T),T},h=this&&this.__param||function(b,y){return function(w,S){y(w,S,b)}},u=this&&this.__values||function(b){var y=typeof Symbol=="function"&&Symbol.iterator,w=y&&b[y],S=0;if(w)return w.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&S>=b.length&&(b=void 0),{value:b&&b[S++],done:!b}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.OverviewRulerRenderer=void 0;var c=n(5871),f=n(3656),d=n(4725),m=n(844),v=n(2585),g={full:0,left:0,center:0,right:0},p={full:0,left:0,center:0,right:0},_={full:0,left:0,center:0,right:0},x=function(b){function y(w,S,R,E,T,A){var C,M=b.call(this)||this;M._viewportElement=w,M._screenElement=S,M._bufferService=R,M._decorationService=E,M._renderService=T,M._optionsService=A,M._colorZoneStore=new c.ColorZoneStore,M._shouldUpdateDimensions=!0,M._shouldUpdateAnchor=!0,M._lastKnownBufferLength=0,M._canvas=document.createElement("canvas"),M._canvas.classList.add("xterm-decoration-overview-ruler"),M._refreshCanvasDimensions(),(C=M._viewportElement.parentElement)===null||C===void 0||C.insertBefore(M._canvas,M._viewportElement);var D=M._canvas.getContext("2d");if(!D)throw new Error("Ctx cannot be null");return M._ctx=D,M._registerDecorationListeners(),M._registerBufferChangeListeners(),M._registerDimensionChangeListeners(),M}return a(y,b),Object.defineProperty(y.prototype,"_width",{get:function(){return this._optionsService.options.overviewRulerWidth||0},enumerable:!1,configurable:!0}),y.prototype._registerDecorationListeners=function(){var w=this;this.register(this._decorationService.onDecorationRegistered(function(){return w._queueRefresh(void 0,!0)})),this.register(this._decorationService.onDecorationRemoved(function(){return w._queueRefresh(void 0,!0)}))},y.prototype._registerBufferChangeListeners=function(){var w=this;this.register(this._renderService.onRenderedViewportChange(function(){return w._queueRefresh()})),this.register(this._bufferService.buffers.onBufferActivate(function(){w._canvas.style.display=w._bufferService.buffer===w._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(function(){w._lastKnownBufferLength!==w._bufferService.buffers.normal.lines.length&&(w._refreshDrawHeightConstants(),w._refreshColorZonePadding())}))},y.prototype._registerDimensionChangeListeners=function(){var w=this;this.register(this._renderService.onRender(function(){w._containerHeight&&w._containerHeight===w._screenElement.clientHeight||(w._queueRefresh(!0),w._containerHeight=w._screenElement.clientHeight)})),this.register(this._optionsService.onOptionChange(function(S){S==="overviewRulerWidth"&&w._queueRefresh(!0)})),this.register((0,f.addDisposableDomListener)(window,"resize",function(){w._queueRefresh(!0)})),this._queueRefresh(!0)},y.prototype.dispose=function(){var w;(w=this._canvas)===null||w===void 0||w.remove(),b.prototype.dispose.call(this)},y.prototype._refreshDrawConstants=function(){var w=Math.floor(this._canvas.width/3),S=Math.ceil(this._canvas.width/3);p.full=this._canvas.width,p.left=w,p.center=S,p.right=w,this._refreshDrawHeightConstants(),_.full=0,_.left=0,_.center=p.left,_.right=p.left+p.center},y.prototype._refreshDrawHeightConstants=function(){g.full=Math.round(2*window.devicePixelRatio);var w=this._canvas.height/this._bufferService.buffer.lines.length,S=Math.round(Math.max(Math.min(w,12),6)*window.devicePixelRatio);g.left=S,g.center=S,g.right=S},y.prototype._refreshColorZonePadding=function(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*g.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*g.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*g.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*g.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length},y.prototype._refreshCanvasDimensions=function(){this._canvas.style.width=this._width+"px",this._canvas.width=Math.round(this._width*window.devicePixelRatio),this._canvas.style.height=this._screenElement.clientHeight+"px",this._canvas.height=Math.round(this._screenElement.clientHeight*window.devicePixelRatio),this._refreshDrawConstants(),this._refreshColorZonePadding()},y.prototype._refreshDecorations=function(){var w,S,R,E,T,A;this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();try{for(var C=u(this._decorationService.decorations),M=C.next();!M.done;M=C.next()){var D=M.value;this._colorZoneStore.addDecoration(D)}}catch(F){w={error:F}}finally{try{M&&!M.done&&(S=C.return)&&S.call(C)}finally{if(w)throw w.error}}this._ctx.lineWidth=1;var O=this._colorZoneStore.zones;try{for(var P=u(O),L=P.next();!L.done;L=P.next())(B=L.value).position!=="full"&&this._renderColorZone(B)}catch(F){R={error:F}}finally{try{L&&!L.done&&(E=P.return)&&E.call(P)}finally{if(R)throw R.error}}try{for(var I=u(O),k=I.next();!k.done;k=I.next()){var B;(B=k.value).position==="full"&&this._renderColorZone(B)}}catch(F){T={error:F}}finally{try{k&&!k.done&&(A=I.return)&&A.call(I)}finally{if(T)throw T.error}}this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1},y.prototype._renderColorZone=function(w){this._ctx.fillStyle=w.color,this._ctx.fillRect(_[w.position||"full"],Math.round((this._canvas.height-1)*(w.startBufferLine/this._bufferService.buffers.active.lines.length)-g[w.position||"full"]/2),p[w.position||"full"],Math.round((this._canvas.height-1)*((w.endBufferLine-w.startBufferLine)/this._bufferService.buffers.active.lines.length)+g[w.position||"full"]))},y.prototype._queueRefresh=function(w,S){var R=this;this._shouldUpdateDimensions=w||this._shouldUpdateDimensions,this._shouldUpdateAnchor=S||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=window.requestAnimationFrame(function(){R._refreshDecorations(),R._animationFrame=void 0}))},l([h(2,v.IBufferService),h(3,v.IDecorationService),h(4,d.IRenderService),h(5,v.IOptionsService)],y)}(m.Disposable);r.OverviewRulerRenderer=x},2950:function(i,r,n){var o=this&&this.__decorate||function(c,f,d,m){var v,g=arguments.length,p=g<3?f:m===null?m=Object.getOwnPropertyDescriptor(f,d):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(c,f,d,m);else for(var _=c.length-1;_>=0;_--)(v=c[_])&&(p=(g<3?v(p):g>3?v(f,d,p):v(f,d))||p);return g>3&&p&&Object.defineProperty(f,d,p),p},a=this&&this.__param||function(c,f){return function(d,m){f(d,m,c)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CompositionHelper=void 0;var l=n(4725),h=n(2585),u=function(){function c(f,d,m,v,g,p){this._textarea=f,this._compositionView=d,this._bufferService=m,this._optionsService=v,this._coreService=g,this._renderService=p,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}return Object.defineProperty(c.prototype,"isComposing",{get:function(){return this._isComposing},enumerable:!1,configurable:!0}),c.prototype.compositionstart=function(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")},c.prototype.compositionupdate=function(f){var d=this;this._compositionView.textContent=f.data,this.updateCompositionElements(),setTimeout(function(){d._compositionPosition.end=d._textarea.value.length},0)},c.prototype.compositionend=function(){this._finalizeComposition(!0)},c.prototype.keydown=function(f){if(this._isComposing||this._isSendingComposition){if(f.keyCode===229||f.keyCode===16||f.keyCode===17||f.keyCode===18)return!1;this._finalizeComposition(!1)}return f.keyCode!==229||(this._handleAnyTextareaChanges(),!1)},c.prototype._finalizeComposition=function(f){var d=this;if(this._compositionView.classList.remove("active"),this._isComposing=!1,f){var m={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(function(){if(d._isSendingComposition){d._isSendingComposition=!1;var g;m.start+=d._dataAlreadySent.length,(g=d._isComposing?d._textarea.value.substring(m.start,m.end):d._textarea.value.substring(m.start)).length>0&&d._coreService.triggerDataEvent(g,!0)}},0)}else{this._isSendingComposition=!1;var v=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(v,!0)}},c.prototype._handleAnyTextareaChanges=function(){var f=this,d=this._textarea.value;setTimeout(function(){if(!f._isComposing){var m=f._textarea.value.replace(d,"");m.length>0&&(f._dataAlreadySent=m,f._coreService.triggerDataEvent(m,!0))}},0)},c.prototype.updateCompositionElements=function(f){var d=this;if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){var m=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),v=this._renderService.dimensions.actualCellHeight,g=this._bufferService.buffer.y*this._renderService.dimensions.actualCellHeight,p=m*this._renderService.dimensions.actualCellWidth;this._compositionView.style.left=p+"px",this._compositionView.style.top=g+"px",this._compositionView.style.height=v+"px",this._compositionView.style.lineHeight=v+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";var _=this._compositionView.getBoundingClientRect();this._textarea.style.left=p+"px",this._textarea.style.top=g+"px",this._textarea.style.width=Math.max(_.width,1)+"px",this._textarea.style.height=Math.max(_.height,1)+"px",this._textarea.style.lineHeight=_.height+"px"}f||setTimeout(function(){return d.updateCompositionElements(!0)},0)}},o([a(2,h.IBufferService),a(3,h.IOptionsService),a(4,h.ICoreService),a(5,l.IRenderService)],c)}();r.CompositionHelper=u},9806:(i,r)=>{function n(o,a,l){var h=l.getBoundingClientRect(),u=o.getComputedStyle(l),c=parseInt(u.getPropertyValue("padding-left")),f=parseInt(u.getPropertyValue("padding-top"));return[a.clientX-h.left-c,a.clientY-h.top-f]}Object.defineProperty(r,"__esModule",{value:!0}),r.getRawByteCoords=r.getCoords=r.getCoordsRelativeToElement=void 0,r.getCoordsRelativeToElement=n,r.getCoords=function(o,a,l,h,u,c,f,d,m){if(c){var v=n(o,a,l);if(v)return v[0]=Math.ceil((v[0]+(m?f/2:0))/f),v[1]=Math.ceil(v[1]/d),v[0]=Math.min(Math.max(v[0],1),h+(m?1:0)),v[1]=Math.min(Math.max(v[1],1),u),v}},r.getRawByteCoords=function(o){if(o)return{x:o[0]+32,y:o[1]+32}}},9504:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.moveToCellSequence=void 0;var o=n(2584);function a(d,m,v,g){var p=d-l(v,d),_=m-l(v,m),x=Math.abs(p-_)-function(b,y,w){for(var S=0,R=b-l(w,b),E=y-l(w,y),T=0;T<Math.abs(R-E);T++){var A=h(b,y)==="A"?-1:1,C=w.buffer.lines.get(R+A*T);C!=null&&C.isWrapped&&S++}return S}(d,m,v);return f(x,c(h(d,m),g))}function l(d,m){for(var v=0,g=d.buffer.lines.get(m),p=g==null?void 0:g.isWrapped;p&&m>=0&&m<d.rows;)v++,p=(g=d.buffer.lines.get(--m))==null?void 0:g.isWrapped;return v}function h(d,m){return d>m?"A":"B"}function u(d,m,v,g,p,_){for(var x=d,b=m,y="";x!==v||b!==g;)x+=p?1:-1,p&&x>_.cols-1?(y+=_.buffer.translateBufferLineToString(b,!1,d,x),x=0,d=0,b++):!p&&x<0&&(y+=_.buffer.translateBufferLineToString(b,!1,0,d+1),d=x=_.cols-1,b--);return y+_.buffer.translateBufferLineToString(b,!1,d,x)}function c(d,m){var v=m?"O":"[";return o.C0.ESC+v+d}function f(d,m){d=Math.floor(d);for(var v="",g=0;g<d;g++)v+=m;return v}r.moveToCellSequence=function(d,m,v,g){var p,_=v.buffer.x,x=v.buffer.y;if(!v.buffer.hasScrollback)return function(y,w,S,R,E,T){return a(w,R,E,T).length===0?"":f(u(y,w,y,w-l(E,w),!1,E).length,c("D",T))}(_,x,0,m,v,g)+a(x,m,v,g)+function(y,w,S,R,E,T){var A;A=a(w,R,E,T).length>0?R-l(E,R):w;var C=R,M=function(D,O,P,L,I,k){var B;return B=a(P,L,I,k).length>0?L-l(I,L):O,D<P&&B<=L||D>=P&&B<L?"C":"D"}(y,w,S,R,E,T);return f(u(y,A,S,C,M==="C",E).length,c(M,T))}(_,x,d,m,v,g);if(x===m)return p=_>d?"D":"C",f(Math.abs(_-d),c(p,g));p=x>m?"D":"C";var b=Math.abs(x-m);return f(function(y,w){return w.cols-y}(x>m?d:_,v)+(b-1)*v.cols+1+((x>m?_:d)-1),c(p,g))}},4389:function(i,r,n){var o=this&&this.__assign||function(){return o=Object.assign||function(g){for(var p,_=1,x=arguments.length;_<x;_++)for(var b in p=arguments[_])Object.prototype.hasOwnProperty.call(p,b)&&(g[b]=p[b]);return g},o.apply(this,arguments)},a=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,_=p&&g[p],x=0;if(_)return _.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&x>=g.length&&(g=void 0),{value:g&&g[x++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.Terminal=void 0;var l=n(3236),h=n(9042),u=n(7975),c=n(7090),f=n(5741),d=n(8285),m=["cols","rows"],v=function(){function g(p){var _=this;this._core=new l.Terminal(p),this._addonManager=new f.AddonManager,this._publicOptions=o({},this._core.options);var x=function(S){return _._core.options[S]},b=function(S,R){_._checkReadonlyOptions(S),_._core.options[S]=R};for(var y in this._core.options){var w={get:x.bind(this,y),set:b.bind(this,y)};Object.defineProperty(this._publicOptions,y,w)}}return g.prototype._checkReadonlyOptions=function(p){if(m.includes(p))throw new Error('Option "'+p+'" can only be set in the constructor')},g.prototype._checkProposedApi=function(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")},Object.defineProperty(g.prototype,"onBell",{get:function(){return this._core.onBell},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onBinary",{get:function(){return this._core.onBinary},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onCursorMove",{get:function(){return this._core.onCursorMove},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onData",{get:function(){return this._core.onData},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onKey",{get:function(){return this._core.onKey},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onLineFeed",{get:function(){return this._core.onLineFeed},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onRender",{get:function(){return this._core.onRender},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onResize",{get:function(){return this._core.onResize},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onScroll",{get:function(){return this._core.onScroll},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onSelectionChange",{get:function(){return this._core.onSelectionChange},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onTitleChange",{get:function(){return this._core.onTitleChange},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onWriteParsed",{get:function(){return this._core.onWriteParsed},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"element",{get:function(){return this._core.element},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"parser",{get:function(){return this._checkProposedApi(),this._parser||(this._parser=new u.ParserApi(this._core)),this._parser},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"unicode",{get:function(){return this._checkProposedApi(),new c.UnicodeApi(this._core)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"textarea",{get:function(){return this._core.textarea},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"rows",{get:function(){return this._core.rows},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"cols",{get:function(){return this._core.cols},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"buffer",{get:function(){return this._checkProposedApi(),this._buffer||(this._buffer=new d.BufferNamespaceApi(this._core)),this._buffer},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"markers",{get:function(){return this._checkProposedApi(),this._core.markers},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"modes",{get:function(){var p=this._core.coreService.decPrivateModes,_="none";switch(this._core.coreMouseService.activeProtocol){case"X10":_="x10";break;case"VT200":_="vt200";break;case"DRAG":_="drag";break;case"ANY":_="any"}return{applicationCursorKeysMode:p.applicationCursorKeys,applicationKeypadMode:p.applicationKeypad,bracketedPasteMode:p.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:_,originMode:p.origin,reverseWraparoundMode:p.reverseWraparound,sendFocusMode:p.sendFocus,wraparoundMode:p.wraparound}},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"options",{get:function(){return this._publicOptions},set:function(p){for(var _ in p)this._publicOptions[_]=p[_]},enumerable:!1,configurable:!0}),g.prototype.blur=function(){this._core.blur()},g.prototype.focus=function(){this._core.focus()},g.prototype.resize=function(p,_){this._verifyIntegers(p,_),this._core.resize(p,_)},g.prototype.open=function(p){this._core.open(p)},g.prototype.attachCustomKeyEventHandler=function(p){this._core.attachCustomKeyEventHandler(p)},g.prototype.registerLinkMatcher=function(p,_,x){return this._checkProposedApi(),this._core.registerLinkMatcher(p,_,x)},g.prototype.deregisterLinkMatcher=function(p){this._checkProposedApi(),this._core.deregisterLinkMatcher(p)},g.prototype.registerLinkProvider=function(p){return this._checkProposedApi(),this._core.registerLinkProvider(p)},g.prototype.registerCharacterJoiner=function(p){return this._checkProposedApi(),this._core.registerCharacterJoiner(p)},g.prototype.deregisterCharacterJoiner=function(p){this._checkProposedApi(),this._core.deregisterCharacterJoiner(p)},g.prototype.registerMarker=function(p){return p===void 0&&(p=0),this._checkProposedApi(),this._verifyIntegers(p),this._core.addMarker(p)},g.prototype.registerDecoration=function(p){var _,x,b;return this._checkProposedApi(),this._verifyPositiveIntegers((_=p.x)!==null&&_!==void 0?_:0,(x=p.width)!==null&&x!==void 0?x:0,(b=p.height)!==null&&b!==void 0?b:0),this._core.registerDecoration(p)},g.prototype.addMarker=function(p){return this.registerMarker(p)},g.prototype.hasSelection=function(){return this._core.hasSelection()},g.prototype.select=function(p,_,x){this._verifyIntegers(p,_,x),this._core.select(p,_,x)},g.prototype.getSelection=function(){return this._core.getSelection()},g.prototype.getSelectionPosition=function(){return this._core.getSelectionPosition()},g.prototype.clearSelection=function(){this._core.clearSelection()},g.prototype.selectAll=function(){this._core.selectAll()},g.prototype.selectLines=function(p,_){this._verifyIntegers(p,_),this._core.selectLines(p,_)},g.prototype.dispose=function(){this._addonManager.dispose(),this._core.dispose()},g.prototype.scrollLines=function(p){this._verifyIntegers(p),this._core.scrollLines(p)},g.prototype.scrollPages=function(p){this._verifyIntegers(p),this._core.scrollPages(p)},g.prototype.scrollToTop=function(){this._core.scrollToTop()},g.prototype.scrollToBottom=function(){this._core.scrollToBottom()},g.prototype.scrollToLine=function(p){this._verifyIntegers(p),this._core.scrollToLine(p)},g.prototype.clear=function(){this._core.clear()},g.prototype.write=function(p,_){this._core.write(p,_)},g.prototype.writeUtf8=function(p,_){this._core.write(p,_)},g.prototype.writeln=function(p,_){this._core.write(p),this._core.write(`\r
`,_)},g.prototype.paste=function(p){this._core.paste(p)},g.prototype.getOption=function(p){return this._core.optionsService.getOption(p)},g.prototype.setOption=function(p,_){this._checkReadonlyOptions(p),this._core.optionsService.setOption(p,_)},g.prototype.refresh=function(p,_){this._verifyIntegers(p,_),this._core.refresh(p,_)},g.prototype.reset=function(){this._core.reset()},g.prototype.clearTextureAtlas=function(){this._core.clearTextureAtlas()},g.prototype.loadAddon=function(p){return this._addonManager.loadAddon(this,p)},Object.defineProperty(g,"strings",{get:function(){return h},enumerable:!1,configurable:!0}),g.prototype._verifyIntegers=function(){for(var p,_,x=[],b=0;b<arguments.length;b++)x[b]=arguments[b];try{for(var y=a(x),w=y.next();!w.done;w=y.next()){var S=w.value;if(S===1/0||isNaN(S)||S%1!=0)throw new Error("This API only accepts integers")}}catch(R){p={error:R}}finally{try{w&&!w.done&&(_=y.return)&&_.call(y)}finally{if(p)throw p.error}}},g.prototype._verifyPositiveIntegers=function(){for(var p,_,x=[],b=0;b<arguments.length;b++)x[b]=arguments[b];try{for(var y=a(x),w=y.next();!w.done;w=y.next()){var S=w.value;if(S&&(S===1/0||isNaN(S)||S%1!=0||S<0))throw new Error("This API only accepts positive integers")}}catch(R){p={error:R}}finally{try{w&&!w.done&&(_=y.return)&&_.call(y)}finally{if(p)throw p.error}}},g}();r.Terminal=v},1546:function(i,r,n){var o=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,_=p&&g[p],x=0;if(_)return _.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&x>=g.length&&(g=void 0),{value:g&&g[x++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.BaseRenderLayer=void 0;var a=n(643),l=n(8803),h=n(1420),u=n(3734),c=n(1752),f=n(8055),d=n(9631),m=n(8978),v=function(){function g(p,_,x,b,y,w,S,R,E){this._container=p,this._alpha=b,this._colors=y,this._rendererId=w,this._bufferService=S,this._optionsService=R,this._decorationService=E,this._scaledCharWidth=0,this._scaledCharHeight=0,this._scaledCellWidth=0,this._scaledCellHeight=0,this._scaledCharLeft=0,this._scaledCharTop=0,this._columnSelectMode=!1,this._currentGlyphIdentifier={chars:"",code:0,bg:0,fg:0,bold:!1,dim:!1,italic:!1},this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-"+_+"-layer"),this._canvas.style.zIndex=x.toString(),this._initCanvas(),this._container.appendChild(this._canvas)}return g.prototype.dispose=function(){var p;(0,d.removeElementFromParent)(this._canvas),(p=this._charAtlas)===null||p===void 0||p.dispose()},g.prototype._initCanvas=function(){this._ctx=(0,c.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()},g.prototype.onOptionsChanged=function(){},g.prototype.onBlur=function(){},g.prototype.onFocus=function(){},g.prototype.onCursorMove=function(){},g.prototype.onGridChanged=function(p,_){},g.prototype.onSelectionChanged=function(p,_,x){x===void 0&&(x=!1),this._selectionStart=p,this._selectionEnd=_,this._columnSelectMode=x},g.prototype.setColors=function(p){this._refreshCharAtlas(p)},g.prototype._setTransparency=function(p){if(p!==this._alpha){var _=this._canvas;this._alpha=p,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,_),this._refreshCharAtlas(this._colors),this.onGridChanged(0,this._bufferService.rows-1)}},g.prototype._refreshCharAtlas=function(p){this._scaledCharWidth<=0&&this._scaledCharHeight<=0||(this._charAtlas=(0,h.acquireCharAtlas)(this._optionsService.rawOptions,this._rendererId,p,this._scaledCharWidth,this._scaledCharHeight),this._charAtlas.warmUp())},g.prototype.resize=function(p){this._scaledCellWidth=p.scaledCellWidth,this._scaledCellHeight=p.scaledCellHeight,this._scaledCharWidth=p.scaledCharWidth,this._scaledCharHeight=p.scaledCharHeight,this._scaledCharLeft=p.scaledCharLeft,this._scaledCharTop=p.scaledCharTop,this._canvas.width=p.scaledCanvasWidth,this._canvas.height=p.scaledCanvasHeight,this._canvas.style.width=p.canvasWidth+"px",this._canvas.style.height=p.canvasHeight+"px",this._alpha||this._clearAll(),this._refreshCharAtlas(this._colors)},g.prototype.clearTextureAtlas=function(){var p;(p=this._charAtlas)===null||p===void 0||p.clear()},g.prototype._fillCells=function(p,_,x,b){this._ctx.fillRect(p*this._scaledCellWidth,_*this._scaledCellHeight,x*this._scaledCellWidth,b*this._scaledCellHeight)},g.prototype._fillMiddleLineAtCells=function(p,_,x){x===void 0&&(x=1);var b=Math.ceil(.5*this._scaledCellHeight);this._ctx.fillRect(p*this._scaledCellWidth,(_+1)*this._scaledCellHeight-b-window.devicePixelRatio,x*this._scaledCellWidth,window.devicePixelRatio)},g.prototype._fillBottomLineAtCells=function(p,_,x){x===void 0&&(x=1),this._ctx.fillRect(p*this._scaledCellWidth,(_+1)*this._scaledCellHeight-window.devicePixelRatio-1,x*this._scaledCellWidth,window.devicePixelRatio)},g.prototype._fillLeftLineAtCell=function(p,_,x){this._ctx.fillRect(p*this._scaledCellWidth,_*this._scaledCellHeight,window.devicePixelRatio*x,this._scaledCellHeight)},g.prototype._strokeRectAtCell=function(p,_,x,b){this._ctx.lineWidth=window.devicePixelRatio,this._ctx.strokeRect(p*this._scaledCellWidth+window.devicePixelRatio/2,_*this._scaledCellHeight+window.devicePixelRatio/2,x*this._scaledCellWidth-window.devicePixelRatio,b*this._scaledCellHeight-window.devicePixelRatio)},g.prototype._clearAll=function(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))},g.prototype._clearCells=function(p,_,x,b){this._alpha?this._ctx.clearRect(p*this._scaledCellWidth,_*this._scaledCellHeight,x*this._scaledCellWidth,b*this._scaledCellHeight):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(p*this._scaledCellWidth,_*this._scaledCellHeight,x*this._scaledCellWidth,b*this._scaledCellHeight))},g.prototype._fillCharTrueColor=function(p,_,x){this._ctx.font=this._getFont(!1,!1),this._ctx.textBaseline=l.TEXT_BASELINE,this._clipRow(x);var b=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(b=(0,m.tryDrawCustomChar)(this._ctx,p.getChars(),_*this._scaledCellWidth,x*this._scaledCellHeight,this._scaledCellWidth,this._scaledCellHeight)),b||this._ctx.fillText(p.getChars(),_*this._scaledCellWidth+this._scaledCharLeft,x*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight)},g.prototype._drawChars=function(p,_,x){var b,y,w,S=this._getContrastColor(p,_,x);if(S||p.isFgRGB()||p.isBgRGB())this._drawUncachedChars(p,_,x,S);else{var R,E;p.isInverse()?(R=p.isBgDefault()?l.INVERTED_DEFAULT_COLOR:p.getBgColor(),E=p.isFgDefault()?l.INVERTED_DEFAULT_COLOR:p.getFgColor()):(E=p.isBgDefault()?a.DEFAULT_COLOR:p.getBgColor(),R=p.isFgDefault()?a.DEFAULT_COLOR:p.getFgColor()),R+=this._optionsService.rawOptions.drawBoldTextInBrightColors&&p.isBold()&&R<8?8:0,this._currentGlyphIdentifier.chars=p.getChars()||a.WHITESPACE_CELL_CHAR,this._currentGlyphIdentifier.code=p.getCode()||a.WHITESPACE_CELL_CODE,this._currentGlyphIdentifier.bg=E,this._currentGlyphIdentifier.fg=R,this._currentGlyphIdentifier.bold=!!p.isBold(),this._currentGlyphIdentifier.dim=!!p.isDim(),this._currentGlyphIdentifier.italic=!!p.isItalic();var T=!1;try{for(var A=o(this._decorationService.getDecorationsAtCell(_,x)),C=A.next();!C.done;C=A.next()){var M=C.value;if(M.backgroundColorRGB||M.foregroundColorRGB){T=!0;break}}}catch(D){b={error:D}}finally{try{C&&!C.done&&(y=A.return)&&y.call(A)}finally{if(b)throw b.error}}!T&&(!((w=this._charAtlas)===null||w===void 0)&&w.draw(this._ctx,this._currentGlyphIdentifier,_*this._scaledCellWidth+this._scaledCharLeft,x*this._scaledCellHeight+this._scaledCharTop))||this._drawUncachedChars(p,_,x)}},g.prototype._drawUncachedChars=function(p,_,x,b){if(this._ctx.save(),this._ctx.font=this._getFont(!!p.isBold(),!!p.isItalic()),this._ctx.textBaseline=l.TEXT_BASELINE,p.isInverse())if(b)this._ctx.fillStyle=b.css;else if(p.isBgDefault())this._ctx.fillStyle=f.color.opaque(this._colors.background).css;else if(p.isBgRGB())this._ctx.fillStyle="rgb("+u.AttributeData.toColorRGB(p.getBgColor()).join(",")+")";else{var y=p.getBgColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&p.isBold()&&y<8&&(y+=8),this._ctx.fillStyle=this._colors.ansi[y].css}else if(b)this._ctx.fillStyle=b.css;else if(p.isFgDefault())this._ctx.fillStyle=this._colors.foreground.css;else if(p.isFgRGB())this._ctx.fillStyle="rgb("+u.AttributeData.toColorRGB(p.getFgColor()).join(",")+")";else{var w=p.getFgColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&p.isBold()&&w<8&&(w+=8),this._ctx.fillStyle=this._colors.ansi[w].css}this._clipRow(x),p.isDim()&&(this._ctx.globalAlpha=l.DIM_OPACITY);var S=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(S=(0,m.tryDrawCustomChar)(this._ctx,p.getChars(),_*this._scaledCellWidth,x*this._scaledCellHeight,this._scaledCellWidth,this._scaledCellHeight)),S||this._ctx.fillText(p.getChars(),_*this._scaledCellWidth+this._scaledCharLeft,x*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight),this._ctx.restore()},g.prototype._clipRow=function(p){this._ctx.beginPath(),this._ctx.rect(0,p*this._scaledCellHeight,this._bufferService.cols*this._scaledCellWidth,this._scaledCellHeight),this._ctx.clip()},g.prototype._getFont=function(p,_){return(_?"italic":"")+" "+(p?this._optionsService.rawOptions.fontWeightBold:this._optionsService.rawOptions.fontWeight)+" "+this._optionsService.rawOptions.fontSize*window.devicePixelRatio+"px "+this._optionsService.rawOptions.fontFamily},g.prototype._getContrastColor=function(p,_,x){var b,y,w,S,R=!1;try{for(var E=o(this._decorationService.getDecorationsAtCell(_,x)),T=E.next();!T.done;T=E.next()){var A=T.value;A.options.layer!=="top"&&R||(A.backgroundColorRGB&&(w=A.backgroundColorRGB.rgba),A.foregroundColorRGB&&(S=A.foregroundColorRGB.rgba),R=A.options.layer==="top")}}catch(ne){b={error:ne}}finally{try{T&&!T.done&&(y=E.return)&&y.call(E)}finally{if(b)throw b.error}}if(R||this._colors.selectionForeground&&this._isCellInSelection(_,x)&&(S=this._colors.selectionForeground.rgba),w||S||this._optionsService.rawOptions.minimumContrastRatio!==1&&!(0,c.excludeFromContrastRatioDemands)(p.getCode())){if(!w&&!S){var C=this._colors.contrastCache.getColor(p.bg,p.fg);if(C!==void 0)return C||void 0}var M=p.getFgColor(),D=p.getFgColorMode(),O=p.getBgColor(),P=p.getBgColorMode(),L=!!p.isInverse(),I=!!p.isInverse();if(L){var k=M;M=O,O=k;var B=D;D=P,P=B}var F=this._resolveBackgroundRgba(w!==void 0?50331648:P,w!=null?w:O,L),W=this._resolveForegroundRgba(D,M,L,I),V=f.rgba.ensureContrastRatio(w!=null?w:F,S!=null?S:W,this._optionsService.rawOptions.minimumContrastRatio);if(!V){if(!S)return void this._colors.contrastCache.setColor(p.bg,p.fg,null);V=S}var N={css:f.channels.toCss(V>>24&255,V>>16&255,V>>8&255),rgba:V};return w||S||this._colors.contrastCache.setColor(p.bg,p.fg,N),N}},g.prototype._resolveBackgroundRgba=function(p,_,x){switch(p){case 16777216:case 33554432:return this._colors.ansi[_].rgba;case 50331648:return _<<8;default:return x?this._colors.foreground.rgba:this._colors.background.rgba}},g.prototype._resolveForegroundRgba=function(p,_,x,b){switch(p){case 16777216:case 33554432:return this._optionsService.rawOptions.drawBoldTextInBrightColors&&b&&_<8&&(_+=8),this._colors.ansi[_].rgba;case 50331648:return _<<8;default:return x?this._colors.background.rgba:this._colors.foreground.rgba}},g.prototype._isCellInSelection=function(p,_){var x=this._selectionStart,b=this._selectionEnd;return!(!x||!b)&&(this._columnSelectMode?p>=x[0]&&_>=x[1]&&p<b[0]&&_<b[1]:_>x[1]&&_<b[1]||x[1]===b[1]&&_===x[1]&&p>=x[0]&&p<b[0]||x[1]<b[1]&&_===b[1]&&p<b[0]||x[1]<b[1]&&_===x[1]&&p>=x[0])},g}();r.BaseRenderLayer=v},2512:function(i,r,n){var o,a=this&&this.__extends||(o=function(p,_){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,b){x.__proto__=b}||function(x,b){for(var y in b)Object.prototype.hasOwnProperty.call(b,y)&&(x[y]=b[y])},o(p,_)},function(p,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function x(){this.constructor=p}o(p,_),p.prototype=_===null?Object.create(_):(x.prototype=_.prototype,new x)}),l=this&&this.__decorate||function(p,_,x,b){var y,w=arguments.length,S=w<3?_:b===null?b=Object.getOwnPropertyDescriptor(_,x):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(p,_,x,b);else for(var R=p.length-1;R>=0;R--)(y=p[R])&&(S=(w<3?y(S):w>3?y(_,x,S):y(_,x))||S);return w>3&&S&&Object.defineProperty(_,x,S),S},h=this&&this.__param||function(p,_){return function(x,b){_(x,b,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CursorRenderLayer=void 0;var u=n(1546),c=n(511),f=n(2585),d=n(4725),m=600,v=function(p){function _(x,b,y,w,S,R,E,T,A,C){var M=p.call(this,x,"cursor",b,!0,y,w,R,E,C)||this;return M._onRequestRedraw=S,M._coreService=T,M._coreBrowserService=A,M._cell=new c.CellData,M._state={x:0,y:0,isFocused:!1,style:"",width:0},M._cursorRenderers={bar:M._renderBarCursor.bind(M),block:M._renderBlockCursor.bind(M),underline:M._renderUnderlineCursor.bind(M)},M}return a(_,p),_.prototype.dispose=function(){this._cursorBlinkStateManager&&(this._cursorBlinkStateManager.dispose(),this._cursorBlinkStateManager=void 0),p.prototype.dispose.call(this)},_.prototype.resize=function(x){p.prototype.resize.call(this,x),this._state={x:0,y:0,isFocused:!1,style:"",width:0}},_.prototype.reset=function(){var x;this._clearCursor(),(x=this._cursorBlinkStateManager)===null||x===void 0||x.restartBlinkAnimation(),this.onOptionsChanged()},_.prototype.onBlur=function(){var x;(x=this._cursorBlinkStateManager)===null||x===void 0||x.pause(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},_.prototype.onFocus=function(){var x;(x=this._cursorBlinkStateManager)===null||x===void 0||x.resume(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},_.prototype.onOptionsChanged=function(){var x,b=this;this._optionsService.rawOptions.cursorBlink?this._cursorBlinkStateManager||(this._cursorBlinkStateManager=new g(this._coreBrowserService.isFocused,function(){b._render(!0)})):((x=this._cursorBlinkStateManager)===null||x===void 0||x.dispose(),this._cursorBlinkStateManager=void 0),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},_.prototype.onCursorMove=function(){var x;(x=this._cursorBlinkStateManager)===null||x===void 0||x.restartBlinkAnimation()},_.prototype.onGridChanged=function(x,b){!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isPaused?this._render(!1):this._cursorBlinkStateManager.restartBlinkAnimation()},_.prototype._render=function(x){if(this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden){var b=this._bufferService.buffer.ybase+this._bufferService.buffer.y,y=b-this._bufferService.buffer.ydisp;if(y<0||y>=this._bufferService.rows)this._clearCursor();else{var w=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1);if(this._bufferService.buffer.lines.get(b).loadCell(w,this._cell),this._cell.content!==void 0){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css;var S=this._optionsService.rawOptions.cursorStyle;return S&&S!=="block"?this._cursorRenderers[S](w,y,this._cell):this._renderBlurCursor(w,y,this._cell),this._ctx.restore(),this._state.x=w,this._state.y=y,this._state.isFocused=!1,this._state.style=S,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isCursorVisible){if(this._state){if(this._state.x===w&&this._state.y===y&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===this._optionsService.rawOptions.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[this._optionsService.rawOptions.cursorStyle||"block"](w,y,this._cell),this._ctx.restore(),this._state.x=w,this._state.y=y,this._state.isFocused=!1,this._state.style=this._optionsService.rawOptions.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}}else this._clearCursor()},_.prototype._clearCursor=function(){this._state&&(window.devicePixelRatio<1?this._clearAll():this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})},_.prototype._renderBarCursor=function(x,b,y){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillLeftLineAtCell(x,b,this._optionsService.rawOptions.cursorWidth),this._ctx.restore()},_.prototype._renderBlockCursor=function(x,b,y){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillCells(x,b,y.getWidth(),1),this._ctx.fillStyle=this._colors.cursorAccent.css,this._fillCharTrueColor(y,x,b),this._ctx.restore()},_.prototype._renderUnderlineCursor=function(x,b,y){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillBottomLineAtCells(x,b),this._ctx.restore()},_.prototype._renderBlurCursor=function(x,b,y){this._ctx.save(),this._ctx.strokeStyle=this._colors.cursor.css,this._strokeRectAtCell(x,b,y.getWidth(),1),this._ctx.restore()},l([h(5,f.IBufferService),h(6,f.IOptionsService),h(7,f.ICoreService),h(8,d.ICoreBrowserService),h(9,f.IDecorationService)],_)}(u.BaseRenderLayer);r.CursorRenderLayer=v;var g=function(){function p(_,x){this._renderCallback=x,this.isCursorVisible=!0,_&&this._restartInterval()}return Object.defineProperty(p.prototype,"isPaused",{get:function(){return!(this._blinkStartTimeout||this._blinkInterval)},enumerable:!1,configurable:!0}),p.prototype.dispose=function(){this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},p.prototype.restartBlinkAnimation=function(){var _=this;this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=window.requestAnimationFrame(function(){_._renderCallback(),_._animationFrame=void 0})))},p.prototype._restartInterval=function(_){var x=this;_===void 0&&(_=m),this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=window.setTimeout(function(){if(x._animationTimeRestarted){var b=m-(Date.now()-x._animationTimeRestarted);if(x._animationTimeRestarted=void 0,b>0)return void x._restartInterval(b)}x.isCursorVisible=!1,x._animationFrame=window.requestAnimationFrame(function(){x._renderCallback(),x._animationFrame=void 0}),x._blinkInterval=window.setInterval(function(){if(x._animationTimeRestarted){var y=m-(Date.now()-x._animationTimeRestarted);return x._animationTimeRestarted=void 0,void x._restartInterval(y)}x.isCursorVisible=!x.isCursorVisible,x._animationFrame=window.requestAnimationFrame(function(){x._renderCallback(),x._animationFrame=void 0})},m)},_)},p.prototype.pause=function(){this.isCursorVisible=!0,this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},p.prototype.resume=function(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()},p}()},8978:function(i,r,n){var o,a,l,h,u,c,f,d,m,v,g,p,_,x,b,y,w,S,R,E,T,A,C,M,D,O,P,L,I,k,B,F,W,V,N,ne,ie,Q,K,de,re,Y,U,z,te,ge,Me,ze,He,Ne,Ye,Ae,Ft,Z,j,_e,Ee,We,je,ct,ye,pt,yt,Ve,G,me,Se,Be,De,Ze,Te,ft,Et,bt,mi,sr,js,pl,qs,To,_s,Xs,Ao,le,nt,H,X,oe,J,se,xe,pe,Pe,Ie,ut,Xe,Ke,et,rt,st,Je,Vt,vt,we,he,be,Ce,ke,tt,mt,Ot,Mi,si,vc,iy,ry,ny,sy,oy,ay,ly,hy,uy,cy,fy,dy,py,my,rT=this&&this.__read||function(ue,ce){var Ki=typeof Symbol=="function"&&ue[Symbol.iterator];if(!Ki)return ue;var on,Ys,Sn=Ki.call(ue),Ui=[];try{for(;(ce===void 0||ce-- >0)&&!(on=Sn.next()).done;)Ui.push(on.value)}catch(Hn){Ys={error:Hn}}finally{try{on&&!on.done&&(Ki=Sn.return)&&Ki.call(Sn)}finally{if(Ys)throw Ys.error}}return Ui},gy=this&&this.__values||function(ue){var ce=typeof Symbol=="function"&&Symbol.iterator,Ki=ce&&ue[ce],on=0;if(Ki)return Ki.call(ue);if(ue&&typeof ue.length=="number")return{next:function(){return ue&&on>=ue.length&&(ue=void 0),{value:ue&&ue[on++],done:!ue}}};throw new TypeError(ce?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.tryDrawCustomChar=r.powerlineDefinitions=r.boxDrawingDefinitions=r.blockElementDefinitions=void 0;var nT=n(1752);r.blockElementDefinitions={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:9,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:0,y:0,w:4,h:8}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u{1FB70}":[{x:1,y:0,w:1,h:8}],"\u{1FB71}":[{x:2,y:0,w:1,h:8}],"\u{1FB72}":[{x:3,y:0,w:1,h:8}],"\u{1FB73}":[{x:4,y:0,w:1,h:8}],"\u{1FB74}":[{x:5,y:0,w:1,h:8}],"\u{1FB75}":[{x:6,y:0,w:1,h:8}],"\u{1FB76}":[{x:0,y:1,w:8,h:1}],"\u{1FB77}":[{x:0,y:2,w:8,h:1}],"\u{1FB78}":[{x:0,y:3,w:8,h:1}],"\u{1FB79}":[{x:0,y:4,w:8,h:1}],"\u{1FB7A}":[{x:0,y:5,w:8,h:1}],"\u{1FB7B}":[{x:0,y:6,w:8,h:1}],"\u{1FB7C}":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB7D}":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7E}":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7F}":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB80}":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB81}":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB82}":[{x:0,y:0,w:8,h:2}],"\u{1FB83}":[{x:0,y:0,w:8,h:3}],"\u{1FB84}":[{x:0,y:0,w:8,h:5}],"\u{1FB85}":[{x:0,y:0,w:8,h:6}],"\u{1FB86}":[{x:0,y:0,w:8,h:7}],"\u{1FB87}":[{x:6,y:0,w:2,h:8}],"\u{1FB88}":[{x:5,y:0,w:3,h:8}],"\u{1FB89}":[{x:3,y:0,w:5,h:8}],"\u{1FB8A}":[{x:2,y:0,w:6,h:8}],"\u{1FB8B}":[{x:1,y:0,w:7,h:8}],"\u{1FB95}":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\u{1FB96}":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\u{1FB97}":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};var mz={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]};r.boxDrawingDefinitions={"\u2500":(o={},o[1]="M0,.5 L1,.5",o),"\u2501":(a={},a[3]="M0,.5 L1,.5",a),"\u2502":(l={},l[1]="M.5,0 L.5,1",l),"\u2503":(h={},h[3]="M.5,0 L.5,1",h),"\u250C":(u={},u[1]="M0.5,1 L.5,.5 L1,.5",u),"\u250F":(c={},c[3]="M0.5,1 L.5,.5 L1,.5",c),"\u2510":(f={},f[1]="M0,.5 L.5,.5 L.5,1",f),"\u2513":(d={},d[3]="M0,.5 L.5,.5 L.5,1",d),"\u2514":(m={},m[1]="M.5,0 L.5,.5 L1,.5",m),"\u2517":(v={},v[3]="M.5,0 L.5,.5 L1,.5",v),"\u2518":(g={},g[1]="M.5,0 L.5,.5 L0,.5",g),"\u251B":(p={},p[3]="M.5,0 L.5,.5 L0,.5",p),"\u251C":(_={},_[1]="M.5,0 L.5,1 M.5,.5 L1,.5",_),"\u2523":(x={},x[3]="M.5,0 L.5,1 M.5,.5 L1,.5",x),"\u2524":(b={},b[1]="M.5,0 L.5,1 M.5,.5 L0,.5",b),"\u252B":(y={},y[3]="M.5,0 L.5,1 M.5,.5 L0,.5",y),"\u252C":(w={},w[1]="M0,.5 L1,.5 M.5,.5 L.5,1",w),"\u2533":(S={},S[3]="M0,.5 L1,.5 M.5,.5 L.5,1",S),"\u2534":(R={},R[1]="M0,.5 L1,.5 M.5,.5 L.5,0",R),"\u253B":(E={},E[3]="M0,.5 L1,.5 M.5,.5 L.5,0",E),"\u253C":(T={},T[1]="M0,.5 L1,.5 M.5,0 L.5,1",T),"\u254B":(A={},A[3]="M0,.5 L1,.5 M.5,0 L.5,1",A),"\u2574":(C={},C[1]="M.5,.5 L0,.5",C),"\u2578":(M={},M[3]="M.5,.5 L0,.5",M),"\u2575":(D={},D[1]="M.5,.5 L.5,0",D),"\u2579":(O={},O[3]="M.5,.5 L.5,0",O),"\u2576":(P={},P[1]="M.5,.5 L1,.5",P),"\u257A":(L={},L[3]="M.5,.5 L1,.5",L),"\u2577":(I={},I[1]="M.5,.5 L.5,1",I),"\u257B":(k={},k[3]="M.5,.5 L.5,1",k),"\u2550":(B={},B[1]=function(ue,ce){return"M0,"+(.5-ce)+" L1,"+(.5-ce)+" M0,"+(.5+ce)+" L1,"+(.5+ce)},B),"\u2551":(F={},F[1]=function(ue,ce){return"M"+(.5-ue)+",0 L"+(.5-ue)+",1 M"+(.5+ue)+",0 L"+(.5+ue)+",1"},F),"\u2552":(W={},W[1]=function(ue,ce){return"M.5,1 L.5,"+(.5-ce)+" L1,"+(.5-ce)+" M.5,"+(.5+ce)+" L1,"+(.5+ce)},W),"\u2553":(V={},V[1]=function(ue,ce){return"M"+(.5-ue)+",1 L"+(.5-ue)+",.5 L1,.5 M"+(.5+ue)+",.5 L"+(.5+ue)+",1"},V),"\u2554":(N={},N[1]=function(ue,ce){return"M1,"+(.5-ce)+" L"+(.5-ue)+","+(.5-ce)+" L"+(.5-ue)+",1 M1,"+(.5+ce)+" L"+(.5+ue)+","+(.5+ce)+" L"+(.5+ue)+",1"},N),"\u2555":(ne={},ne[1]=function(ue,ce){return"M0,"+(.5-ce)+" L.5,"+(.5-ce)+" L.5,1 M0,"+(.5+ce)+" L.5,"+(.5+ce)},ne),"\u2556":(ie={},ie[1]=function(ue,ce){return"M"+(.5+ue)+",1 L"+(.5+ue)+",.5 L0,.5 M"+(.5-ue)+",.5 L"+(.5-ue)+",1"},ie),"\u2557":(Q={},Q[1]=function(ue,ce){return"M0,"+(.5+ce)+" L"+(.5-ue)+","+(.5+ce)+" L"+(.5-ue)+",1 M0,"+(.5-ce)+" L"+(.5+ue)+","+(.5-ce)+" L"+(.5+ue)+",1"},Q),"\u2558":(K={},K[1]=function(ue,ce){return"M.5,0 L.5,"+(.5+ce)+" L1,"+(.5+ce)+" M.5,"+(.5-ce)+" L1,"+(.5-ce)},K),"\u2559":(de={},de[1]=function(ue,ce){return"M1,.5 L"+(.5-ue)+",.5 L"+(.5-ue)+",0 M"+(.5+ue)+",.5 L"+(.5+ue)+",0"},de),"\u255A":(re={},re[1]=function(ue,ce){return"M1,"+(.5-ce)+" L"+(.5+ue)+","+(.5-ce)+" L"+(.5+ue)+",0 M1,"+(.5+ce)+" L"+(.5-ue)+","+(.5+ce)+" L"+(.5-ue)+",0"},re),"\u255B":(Y={},Y[1]=function(ue,ce){return"M0,"+(.5+ce)+" L.5,"+(.5+ce)+" L.5,0 M0,"+(.5-ce)+" L.5,"+(.5-ce)},Y),"\u255C":(U={},U[1]=function(ue,ce){return"M0,.5 L"+(.5+ue)+",.5 L"+(.5+ue)+",0 M"+(.5-ue)+",.5 L"+(.5-ue)+",0"},U),"\u255D":(z={},z[1]=function(ue,ce){return"M0,"+(.5-ce)+" L"+(.5-ue)+","+(.5-ce)+" L"+(.5-ue)+",0 M0,"+(.5+ce)+" L"+(.5+ue)+","+(.5+ce)+" L"+(.5+ue)+",0"},z),"\u255E":(te={},te[1]=function(ue,ce){return"M.5,0 L.5,1 M.5,"+(.5-ce)+" L1,"+(.5-ce)+" M.5,"+(.5+ce)+" L1,"+(.5+ce)},te),"\u255F":(ge={},ge[1]=function(ue,ce){return"M"+(.5-ue)+",0 L"+(.5-ue)+",1 M"+(.5+ue)+",0 L"+(.5+ue)+",1 M"+(.5+ue)+",.5 L1,.5"},ge),"\u2560":(Me={},Me[1]=function(ue,ce){return"M"+(.5-ue)+",0 L"+(.5-ue)+",1 M1,"+(.5+ce)+" L"+(.5+ue)+","+(.5+ce)+" L"+(.5+ue)+",1 M1,"+(.5-ce)+" L"+(.5+ue)+","+(.5-ce)+" L"+(.5+ue)+",0"},Me),"\u2561":(ze={},ze[1]=function(ue,ce){return"M.5,0 L.5,1 M0,"+(.5-ce)+" L.5,"+(.5-ce)+" M0,"+(.5+ce)+" L.5,"+(.5+ce)},ze),"\u2562":(He={},He[1]=function(ue,ce){return"M0,.5 L"+(.5-ue)+",.5 M"+(.5-ue)+",0 L"+(.5-ue)+",1 M"+(.5+ue)+",0 L"+(.5+ue)+",1"},He),"\u2563":(Ne={},Ne[1]=function(ue,ce){return"M"+(.5+ue)+",0 L"+(.5+ue)+",1 M0,"+(.5+ce)+" L"+(.5-ue)+","+(.5+ce)+" L"+(.5-ue)+",1 M0,"+(.5-ce)+" L"+(.5-ue)+","+(.5-ce)+" L"+(.5-ue)+",0"},Ne),"\u2564":(Ye={},Ye[1]=function(ue,ce){return"M0,"+(.5-ce)+" L1,"+(.5-ce)+" M0,"+(.5+ce)+" L1,"+(.5+ce)+" M.5,"+(.5+ce)+" L.5,1"},Ye),"\u2565":(Ae={},Ae[1]=function(ue,ce){return"M0,.5 L1,.5 M"+(.5-ue)+",.5 L"+(.5-ue)+",1 M"+(.5+ue)+",.5 L"+(.5+ue)+",1"},Ae),"\u2566":(Ft={},Ft[1]=function(ue,ce){return"M0,"+(.5-ce)+" L1,"+(.5-ce)+" M0,"+(.5+ce)+" L"+(.5-ue)+","+(.5+ce)+" L"+(.5-ue)+",1 M1,"+(.5+ce)+" L"+(.5+ue)+","+(.5+ce)+" L"+(.5+ue)+",1"},Ft),"\u2567":(Z={},Z[1]=function(ue,ce){return"M.5,0 L.5,"+(.5-ce)+" M0,"+(.5-ce)+" L1,"+(.5-ce)+" M0,"+(.5+ce)+" L1,"+(.5+ce)},Z),"\u2568":(j={},j[1]=function(ue,ce){return"M0,.5 L1,.5 M"+(.5-ue)+",.5 L"+(.5-ue)+",0 M"+(.5+ue)+",.5 L"+(.5+ue)+",0"},j),"\u2569":(_e={},_e[1]=function(ue,ce){return"M0,"+(.5+ce)+" L1,"+(.5+ce)+" M0,"+(.5-ce)+" L"+(.5-ue)+","+(.5-ce)+" L"+(.5-ue)+",0 M1,"+(.5-ce)+" L"+(.5+ue)+","+(.5-ce)+" L"+(.5+ue)+",0"},_e),"\u256A":(Ee={},Ee[1]=function(ue,ce){return"M.5,0 L.5,1 M0,"+(.5-ce)+" L1,"+(.5-ce)+" M0,"+(.5+ce)+" L1,"+(.5+ce)},Ee),"\u256B":(We={},We[1]=function(ue,ce){return"M0,.5 L1,.5 M"+(.5-ue)+",0 L"+(.5-ue)+",1 M"+(.5+ue)+",0 L"+(.5+ue)+",1"},We),"\u256C":(je={},je[1]=function(ue,ce){return"M0,"+(.5+ce)+" L"+(.5-ue)+","+(.5+ce)+" L"+(.5-ue)+",1 M1,"+(.5+ce)+" L"+(.5+ue)+","+(.5+ce)+" L"+(.5+ue)+",1 M0,"+(.5-ce)+" L"+(.5-ue)+","+(.5-ce)+" L"+(.5-ue)+",0 M1,"+(.5-ce)+" L"+(.5+ue)+","+(.5-ce)+" L"+(.5+ue)+",0"},je),"\u2571":(ct={},ct[1]="M1,0 L0,1",ct),"\u2572":(ye={},ye[1]="M0,0 L1,1",ye),"\u2573":(pt={},pt[1]="M1,0 L0,1 M0,0 L1,1",pt),"\u257C":(yt={},yt[1]="M.5,.5 L0,.5",yt[3]="M.5,.5 L1,.5",yt),"\u257D":(Ve={},Ve[1]="M.5,.5 L.5,0",Ve[3]="M.5,.5 L.5,1",Ve),"\u257E":(G={},G[1]="M.5,.5 L1,.5",G[3]="M.5,.5 L0,.5",G),"\u257F":(me={},me[1]="M.5,.5 L.5,1",me[3]="M.5,.5 L.5,0",me),"\u250D":(Se={},Se[1]="M.5,.5 L.5,1",Se[3]="M.5,.5 L1,.5",Se),"\u250E":(Be={},Be[1]="M.5,.5 L1,.5",Be[3]="M.5,.5 L.5,1",Be),"\u2511":(De={},De[1]="M.5,.5 L.5,1",De[3]="M.5,.5 L0,.5",De),"\u2512":(Ze={},Ze[1]="M.5,.5 L0,.5",Ze[3]="M.5,.5 L.5,1",Ze),"\u2515":(Te={},Te[1]="M.5,.5 L.5,0",Te[3]="M.5,.5 L1,.5",Te),"\u2516":(ft={},ft[1]="M.5,.5 L1,.5",ft[3]="M.5,.5 L.5,0",ft),"\u2519":(Et={},Et[1]="M.5,.5 L.5,0",Et[3]="M.5,.5 L0,.5",Et),"\u251A":(bt={},bt[1]="M.5,.5 L0,.5",bt[3]="M.5,.5 L.5,0",bt),"\u251D":(mi={},mi[1]="M.5,0 L.5,1",mi[3]="M.5,.5 L1,.5",mi),"\u251E":(sr={},sr[1]="M0.5,1 L.5,.5 L1,.5",sr[3]="M.5,.5 L.5,0",sr),"\u251F":(js={},js[1]="M.5,0 L.5,.5 L1,.5",js[3]="M.5,.5 L.5,1",js),"\u2520":(pl={},pl[1]="M.5,.5 L1,.5",pl[3]="M.5,0 L.5,1",pl),"\u2521":(qs={},qs[1]="M.5,.5 L.5,1",qs[3]="M.5,0 L.5,.5 L1,.5",qs),"\u2522":(To={},To[1]="M.5,.5 L.5,0",To[3]="M0.5,1 L.5,.5 L1,.5",To),"\u2525":(_s={},_s[1]="M.5,0 L.5,1",_s[3]="M.5,.5 L0,.5",_s),"\u2526":(Xs={},Xs[1]="M0,.5 L.5,.5 L.5,1",Xs[3]="M.5,.5 L.5,0",Xs),"\u2527":(Ao={},Ao[1]="M.5,0 L.5,.5 L0,.5",Ao[3]="M.5,.5 L.5,1",Ao),"\u2528":(le={},le[1]="M.5,.5 L0,.5",le[3]="M.5,0 L.5,1",le),"\u2529":(nt={},nt[1]="M.5,.5 L.5,1",nt[3]="M.5,0 L.5,.5 L0,.5",nt),"\u252A":(H={},H[1]="M.5,.5 L.5,0",H[3]="M0,.5 L.5,.5 L.5,1",H),"\u252D":(X={},X[1]="M0.5,1 L.5,.5 L1,.5",X[3]="M.5,.5 L0,.5",X),"\u252E":(oe={},oe[1]="M0,.5 L.5,.5 L.5,1",oe[3]="M.5,.5 L1,.5",oe),"\u252F":(J={},J[1]="M.5,.5 L.5,1",J[3]="M0,.5 L1,.5",J),"\u2530":(se={},se[1]="M0,.5 L1,.5",se[3]="M.5,.5 L.5,1",se),"\u2531":(xe={},xe[1]="M.5,.5 L1,.5",xe[3]="M0,.5 L.5,.5 L.5,1",xe),"\u2532":(pe={},pe[1]="M.5,.5 L0,.5",pe[3]="M0.5,1 L.5,.5 L1,.5",pe),"\u2535":(Pe={},Pe[1]="M.5,0 L.5,.5 L1,.5",Pe[3]="M.5,.5 L0,.5",Pe),"\u2536":(Ie={},Ie[1]="M.5,0 L.5,.5 L0,.5",Ie[3]="M.5,.5 L1,.5",Ie),"\u2537":(ut={},ut[1]="M.5,.5 L.5,0",ut[3]="M0,.5 L1,.5",ut),"\u2538":(Xe={},Xe[1]="M0,.5 L1,.5",Xe[3]="M.5,.5 L.5,0",Xe),"\u2539":(Ke={},Ke[1]="M.5,.5 L1,.5",Ke[3]="M.5,0 L.5,.5 L0,.5",Ke),"\u253A":(et={},et[1]="M.5,.5 L0,.5",et[3]="M.5,0 L.5,.5 L1,.5",et),"\u253D":(rt={},rt[1]="M.5,0 L.5,1 M.5,.5 L1,.5",rt[3]="M.5,.5 L0,.5",rt),"\u253E":(st={},st[1]="M.5,0 L.5,1 M.5,.5 L0,.5",st[3]="M.5,.5 L1,.5",st),"\u253F":(Je={},Je[1]="M.5,0 L.5,1",Je[3]="M0,.5 L1,.5",Je),"\u2540":(Vt={},Vt[1]="M0,.5 L1,.5 M.5,.5 L.5,1",Vt[3]="M.5,.5 L.5,0",Vt),"\u2541":(vt={},vt[1]="M.5,.5 L.5,0 M0,.5 L1,.5",vt[3]="M.5,.5 L.5,1",vt),"\u2542":(we={},we[1]="M0,.5 L1,.5",we[3]="M.5,0 L.5,1",we),"\u2543":(he={},he[1]="M0.5,1 L.5,.5 L1,.5",he[3]="M.5,0 L.5,.5 L0,.5",he),"\u2544":(be={},be[1]="M0,.5 L.5,.5 L.5,1",be[3]="M.5,0 L.5,.5 L1,.5",be),"\u2545":(Ce={},Ce[1]="M.5,0 L.5,.5 L1,.5",Ce[3]="M0,.5 L.5,.5 L.5,1",Ce),"\u2546":(ke={},ke[1]="M.5,0 L.5,.5 L0,.5",ke[3]="M0.5,1 L.5,.5 L1,.5",ke),"\u2547":(tt={},tt[1]="M.5,.5 L.5,1",tt[3]="M.5,.5 L.5,0 M0,.5 L1,.5",tt),"\u2548":(mt={},mt[1]="M.5,.5 L.5,0",mt[3]="M0,.5 L1,.5 M.5,.5 L.5,1",mt),"\u2549":(Ot={},Ot[1]="M.5,.5 L1,.5",Ot[3]="M.5,0 L.5,1 M.5,.5 L0,.5",Ot),"\u254A":(Mi={},Mi[1]="M.5,.5 L0,.5",Mi[3]="M.5,0 L.5,1 M.5,.5 L1,.5",Mi),"\u254C":(si={},si[1]="M.1,.5 L.4,.5 M.6,.5 L.9,.5",si),"\u254D":(vc={},vc[3]="M.1,.5 L.4,.5 M.6,.5 L.9,.5",vc),"\u2504":(iy={},iy[1]="M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5",iy),"\u2505":(ry={},ry[3]="M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5",ry),"\u2508":(ny={},ny[1]="M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5",ny),"\u2509":(sy={},sy[3]="M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5",sy),"\u254E":(oy={},oy[1]="M.5,.1 L.5,.4 M.5,.6 L.5,.9",oy),"\u254F":(ay={},ay[3]="M.5,.1 L.5,.4 M.5,.6 L.5,.9",ay),"\u2506":(ly={},ly[1]="M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333",ly),"\u2507":(hy={},hy[3]="M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333",hy),"\u250A":(uy={},uy[1]="M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95",uy),"\u250B":(cy={},cy[3]="M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95",cy),"\u256D":(fy={},fy[1]="C.5,1,.5,.5,1,.5",fy),"\u256E":(dy={},dy[1]="C.5,1,.5,.5,0,.5",dy),"\u256F":(py={},py[1]="C.5,0,.5,.5,0,.5",py),"\u2570":(my={},my[1]="C.5,0,.5,.5,1,.5",my)},r.powerlineDefinitions={"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0},"\uE0B1":{d:"M0,0 L1,.5 L0,1",type:1,horizontalPadding:.5},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0},"\uE0B3":{d:"M1,0 L0,.5 L1,1",type:1,horizontalPadding:.5}},r.tryDrawCustomChar=function(ue,ce,Ki,on,Ys,Sn){var Ui=r.blockElementDefinitions[ce];if(Ui)return function(gi,an,ml,gl,da,pa){for(var Sr=0;Sr<an.length;Sr++){var Cr=an[Sr],$t=da/8,Mr=pa/8;gi.fillRect(ml+Cr.x*$t,gl+Cr.y*Mr,Cr.w*$t,Cr.h*Mr)}}(ue,Ui,Ki,on,Ys,Sn),!0;var Hn=mz[ce];if(Hn)return function(gi,an,ml,gl,da,pa){var Sr,Cr=sT.get(an);Cr||(Cr=new Map,sT.set(an,Cr));var $t=gi.fillStyle;if(typeof $t!="string")throw new Error('Unexpected fillStyle type "'+$t+'"');var Mr=Cr.get($t);if(!Mr){var Hr=an[0].length,Wn=an.length,Ks=document.createElement("canvas");Ks.width=Hr,Ks.height=Wn;var vl=(0,nT.throwIfFalsy)(Ks.getContext("2d")),ys=new ImageData(Hr,Wn),vh=void 0,ma=void 0,Po=void 0,_h=void 0;if($t.startsWith("#"))vh=parseInt($t.slice(1,3),16),ma=parseInt($t.slice(3,5),16),Po=parseInt($t.slice(5,7),16),_h=$t.length>7&&parseInt($t.slice(7,9),16)||1;else{if(!$t.startsWith("rgba"))throw new Error('Unexpected fillStyle color format "'+$t+'" when drawing pattern glyph');vh=(Sr=rT($t.substring(5,$t.length-1).split(",").map(function(yc){return parseFloat(yc)}),4))[0],ma=Sr[1],Po=Sr[2],_h=Sr[3]}for(var Qs=0;Qs<Wn;Qs++)for(var Js=0;Js<Hr;Js++)ys.data[4*(Qs*Hr+Js)]=vh,ys.data[4*(Qs*Hr+Js)+1]=ma,ys.data[4*(Qs*Hr+Js)+2]=Po,ys.data[4*(Qs*Hr+Js)+3]=an[Qs][Js]*(255*_h);vl.putImageData(ys,0,0),Mr=(0,nT.throwIfFalsy)(gi.createPattern(Ks,null)),Cr.set($t,Mr)}gi.fillStyle=Mr,gi.fillRect(ml,gl,da,pa)}(ue,Hn,Ki,on,Ys,Sn),!0;var Zs=r.boxDrawingDefinitions[ce];if(Zs)return function(gi,an,ml,gl,da,pa){var Sr,Cr,$t,Mr;gi.strokeStyle=gi.fillStyle;try{for(var Hr=gy(Object.entries(an)),Wn=Hr.next();!Wn.done;Wn=Hr.next()){var Ks=rT(Wn.value,2),vl=Ks[0],ys=Ks[1];gi.beginPath(),gi.lineWidth=window.devicePixelRatio*Number.parseInt(vl);var vh=void 0;vh=typeof ys=="function"?ys(.15,.15/pa*da):ys;try{for(var ma=($t=void 0,gy(vh.split(" "))),Po=ma.next();!Po.done;Po=ma.next()){var _h=Po.value,Qs=_h[0],Js=aT[Qs];if(Js){var yc=_h.substring(1).split(",");yc[0]&&yc[1]&&Js(gi,lT(yc,da,pa,ml,gl))}else console.error('Could not find drawing instructions for "'+Qs+'"')}}catch(vy){$t={error:vy}}finally{try{Po&&!Po.done&&(Mr=ma.return)&&Mr.call(ma)}finally{if($t)throw $t.error}}gi.stroke(),gi.closePath()}}catch(vy){Sr={error:vy}}finally{try{Wn&&!Wn.done&&(Cr=Hr.return)&&Cr.call(Hr)}finally{if(Sr)throw Sr.error}}}(ue,Zs,Ki,on,Ys,Sn),!0;var _c=r.powerlineDefinitions[ce];return!!_c&&(function(gi,an,ml,gl,da,pa){var Sr,Cr;gi.beginPath(),gi.lineWidth=window.devicePixelRatio;try{for(var $t=gy(an.d.split(" ")),Mr=$t.next();!Mr.done;Mr=$t.next()){var Hr=Mr.value,Wn=Hr[0],Ks=aT[Wn];if(Ks){var vl=Hr.substring(1).split(",");vl[0]&&vl[1]&&Ks(gi,lT(vl,da,pa,ml,gl,an.horizontalPadding))}else console.error('Could not find drawing instructions for "'+Wn+'"')}}catch(ys){Sr={error:ys}}finally{try{Mr&&!Mr.done&&(Cr=$t.return)&&Cr.call($t)}finally{if(Sr)throw Sr.error}}an.type===1?(gi.strokeStyle=gi.fillStyle,gi.stroke()):gi.fill(),gi.closePath()}(ue,_c,Ki,on,Ys,Sn),!0)};var sT=new Map;function oT(ue,ce,Ki){return Ki===void 0&&(Ki=0),Math.max(Math.min(ue,ce),Ki)}var aT={C:function(ue,ce){return ue.bezierCurveTo(ce[0],ce[1],ce[2],ce[3],ce[4],ce[5])},L:function(ue,ce){return ue.lineTo(ce[0],ce[1])},M:function(ue,ce){return ue.moveTo(ce[0],ce[1])}};function lT(ue,ce,Ki,on,Ys,Sn){Sn===void 0&&(Sn=0);var Ui=ue.map(function(_c){return parseFloat(_c)||parseInt(_c)});if(Ui.length<2)throw new Error("Too few arguments for instruction");for(var Hn=0;Hn<Ui.length;Hn+=2)Ui[Hn]*=ce-2*Sn*window.devicePixelRatio,Ui[Hn]!==0&&(Ui[Hn]=oT(Math.round(Ui[Hn]+.5)-.5,ce,0)),Ui[Hn]+=on+Sn*window.devicePixelRatio;for(var Zs=1;Zs<Ui.length;Zs+=2)Ui[Zs]*=Ki,Ui[Zs]!==0&&(Ui[Zs]=oT(Math.round(Ui[Zs]+.5)-.5,Ki,0)),Ui[Zs]+=Ys;return Ui}},3700:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.GridCache=void 0;var n=function(){function o(){this.cache=[]}return o.prototype.resize=function(a,l){for(var h=0;h<a;h++){this.cache.length<=h&&this.cache.push([]);for(var u=this.cache[h].length;u<l;u++)this.cache[h].push(void 0);this.cache[h].length=l}this.cache.length=a},o.prototype.clear=function(){for(var a=0;a<this.cache.length;a++)for(var l=0;l<this.cache[a].length;l++)this.cache[a][l]=void 0},o}();r.GridCache=n},5098:function(i,r,n){var o,a=this&&this.__extends||(o=function(v,g){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,_){p.__proto__=_}||function(p,_){for(var x in _)Object.prototype.hasOwnProperty.call(_,x)&&(p[x]=_[x])},o(v,g)},function(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function p(){this.constructor=v}o(v,g),v.prototype=g===null?Object.create(g):(p.prototype=g.prototype,new p)}),l=this&&this.__decorate||function(v,g,p,_){var x,b=arguments.length,y=b<3?g:_===null?_=Object.getOwnPropertyDescriptor(g,p):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(v,g,p,_);else for(var w=v.length-1;w>=0;w--)(x=v[w])&&(y=(b<3?x(y):b>3?x(g,p,y):x(g,p))||y);return b>3&&y&&Object.defineProperty(g,p,y),y},h=this&&this.__param||function(v,g){return function(p,_){g(p,_,v)}};Object.defineProperty(r,"__esModule",{value:!0}),r.LinkRenderLayer=void 0;var u=n(1546),c=n(8803),f=n(2040),d=n(2585),m=function(v){function g(p,_,x,b,y,w,S,R,E){var T=v.call(this,p,"link",_,!0,x,b,S,R,E)||this;return y.onShowLinkUnderline(function(A){return T._onShowLinkUnderline(A)}),y.onHideLinkUnderline(function(A){return T._onHideLinkUnderline(A)}),w.onShowLinkUnderline(function(A){return T._onShowLinkUnderline(A)}),w.onHideLinkUnderline(function(A){return T._onHideLinkUnderline(A)}),T}return a(g,v),g.prototype.resize=function(p){v.prototype.resize.call(this,p),this._state=void 0},g.prototype.reset=function(){this._clearCurrentLink()},g.prototype._clearCurrentLink=function(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);var p=this._state.y2-this._state.y1-1;p>0&&this._clearCells(0,this._state.y1+1,this._state.cols,p),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}},g.prototype._onShowLinkUnderline=function(p){if(p.fg===c.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._colors.background.css:p.fg&&(0,f.is256Color)(p.fg)?this._ctx.fillStyle=this._colors.ansi[p.fg].css:this._ctx.fillStyle=this._colors.foreground.css,p.y1===p.y2)this._fillBottomLineAtCells(p.x1,p.y1,p.x2-p.x1);else{this._fillBottomLineAtCells(p.x1,p.y1,p.cols-p.x1);for(var _=p.y1+1;_<p.y2;_++)this._fillBottomLineAtCells(0,_,p.cols);this._fillBottomLineAtCells(0,p.y2,p.x2)}this._state=p},g.prototype._onHideLinkUnderline=function(p){this._clearCurrentLink()},l([h(6,d.IBufferService),h(7,d.IOptionsService),h(8,d.IDecorationService)],g)}(u.BaseRenderLayer);r.LinkRenderLayer=m},3525:function(i,r,n){var o,a=this&&this.__extends||(o=function(w,S){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,E){R.__proto__=E}||function(R,E){for(var T in E)Object.prototype.hasOwnProperty.call(E,T)&&(R[T]=E[T])},o(w,S)},function(w,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function R(){this.constructor=w}o(w,S),w.prototype=S===null?Object.create(S):(R.prototype=S.prototype,new R)}),l=this&&this.__decorate||function(w,S,R,E){var T,A=arguments.length,C=A<3?S:E===null?E=Object.getOwnPropertyDescriptor(S,R):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(w,S,R,E);else for(var M=w.length-1;M>=0;M--)(T=w[M])&&(C=(A<3?T(C):A>3?T(S,R,C):T(S,R))||C);return A>3&&C&&Object.defineProperty(S,R,C),C},h=this&&this.__param||function(w,S){return function(R,E){S(R,E,w)}},u=this&&this.__values||function(w){var S=typeof Symbol=="function"&&Symbol.iterator,R=S&&w[S],E=0;if(R)return R.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&E>=w.length&&(w=void 0),{value:w&&w[E++],done:!w}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.Renderer=void 0;var c=n(9596),f=n(4149),d=n(2512),m=n(5098),v=n(844),g=n(4725),p=n(2585),_=n(1420),x=n(8460),b=1,y=function(w){function S(R,E,T,A,C,M,D,O){var P=w.call(this)||this;P._colors=R,P._screenElement=E,P._bufferService=M,P._charSizeService=D,P._optionsService=O,P._id=b++,P._onRequestRedraw=new x.EventEmitter;var L=P._optionsService.rawOptions.allowTransparency;return P._renderLayers=[C.createInstance(c.TextRenderLayer,P._screenElement,0,P._colors,L,P._id),C.createInstance(f.SelectionRenderLayer,P._screenElement,1,P._colors,P._id),C.createInstance(m.LinkRenderLayer,P._screenElement,2,P._colors,P._id,T,A),C.createInstance(d.CursorRenderLayer,P._screenElement,3,P._colors,P._id,P._onRequestRedraw)],P.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},P._devicePixelRatio=window.devicePixelRatio,P._updateDimensions(),P.onOptionsChanged(),P}return a(S,w),Object.defineProperty(S.prototype,"onRequestRedraw",{get:function(){return this._onRequestRedraw.event},enumerable:!1,configurable:!0}),S.prototype.dispose=function(){var R,E;try{for(var T=u(this._renderLayers),A=T.next();!A.done;A=T.next())A.value.dispose()}catch(C){R={error:C}}finally{try{A&&!A.done&&(E=T.return)&&E.call(T)}finally{if(R)throw R.error}}w.prototype.dispose.call(this),(0,_.removeTerminalFromCache)(this._id)},S.prototype.onDevicePixelRatioChange=function(){this._devicePixelRatio!==window.devicePixelRatio&&(this._devicePixelRatio=window.devicePixelRatio,this.onResize(this._bufferService.cols,this._bufferService.rows))},S.prototype.setColors=function(R){var E,T;this._colors=R;try{for(var A=u(this._renderLayers),C=A.next();!C.done;C=A.next()){var M=C.value;M.setColors(this._colors),M.reset()}}catch(D){E={error:D}}finally{try{C&&!C.done&&(T=A.return)&&T.call(A)}finally{if(E)throw E.error}}},S.prototype.onResize=function(R,E){var T,A;this._updateDimensions();try{for(var C=u(this._renderLayers),M=C.next();!M.done;M=C.next())M.value.resize(this.dimensions)}catch(D){T={error:D}}finally{try{M&&!M.done&&(A=C.return)&&A.call(C)}finally{if(T)throw T.error}}this._screenElement.style.width=this.dimensions.canvasWidth+"px",this._screenElement.style.height=this.dimensions.canvasHeight+"px"},S.prototype.onCharSizeChanged=function(){this.onResize(this._bufferService.cols,this._bufferService.rows)},S.prototype.onBlur=function(){this._runOperation(function(R){return R.onBlur()})},S.prototype.onFocus=function(){this._runOperation(function(R){return R.onFocus()})},S.prototype.onSelectionChanged=function(R,E,T){T===void 0&&(T=!1),this._runOperation(function(A){return A.onSelectionChanged(R,E,T)}),this._colors.selectionForeground&&this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})},S.prototype.onCursorMove=function(){this._runOperation(function(R){return R.onCursorMove()})},S.prototype.onOptionsChanged=function(){this._runOperation(function(R){return R.onOptionsChanged()})},S.prototype.clear=function(){this._runOperation(function(R){return R.reset()})},S.prototype._runOperation=function(R){var E,T;try{for(var A=u(this._renderLayers),C=A.next();!C.done;C=A.next())R(C.value)}catch(M){E={error:M}}finally{try{C&&!C.done&&(T=A.return)&&T.call(A)}finally{if(E)throw E.error}}},S.prototype.renderRows=function(R,E){var T,A;try{for(var C=u(this._renderLayers),M=C.next();!M.done;M=C.next())M.value.onGridChanged(R,E)}catch(D){T={error:D}}finally{try{M&&!M.done&&(A=C.return)&&A.call(C)}finally{if(T)throw T.error}}},S.prototype.clearTextureAtlas=function(){var R,E;try{for(var T=u(this._renderLayers),A=T.next();!A.done;A=T.next())A.value.clearTextureAtlas()}catch(C){R={error:C}}finally{try{A&&!A.done&&(E=T.return)&&E.call(T)}finally{if(R)throw R.error}}},S.prototype._updateDimensions=function(){this._charSizeService.hasValidSize&&(this.dimensions.scaledCharWidth=Math.floor(this._charSizeService.width*window.devicePixelRatio),this.dimensions.scaledCharHeight=Math.ceil(this._charSizeService.height*window.devicePixelRatio),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._optionsService.rawOptions.lineHeight),this.dimensions.scaledCharTop=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.scaledCellHeight-this.dimensions.scaledCharHeight)/2),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.scaledCharLeft=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.scaledCanvasHeight=this._bufferService.rows*this.dimensions.scaledCellHeight,this.dimensions.scaledCanvasWidth=this._bufferService.cols*this.dimensions.scaledCellWidth,this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/window.devicePixelRatio),this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/window.devicePixelRatio),this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._bufferService.rows,this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._bufferService.cols)},l([h(4,p.IInstantiationService),h(5,p.IBufferService),h(6,g.ICharSizeService),h(7,p.IOptionsService)],S)}(v.Disposable);r.Renderer=y},1752:(i,r)=>{function n(o){return 57508<=o&&o<=57558}Object.defineProperty(r,"__esModule",{value:!0}),r.excludeFromContrastRatioDemands=r.isPowerlineGlyph=r.throwIfFalsy=void 0,r.throwIfFalsy=function(o){if(!o)throw new Error("value must not be falsy");return o},r.isPowerlineGlyph=n,r.excludeFromContrastRatioDemands=function(o){return n(o)||function(a){return 9472<=a&&a<=9631}(o)}},4149:function(i,r,n){var o,a=this&&this.__extends||(o=function(d,m){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,g){v.__proto__=g}||function(v,g){for(var p in g)Object.prototype.hasOwnProperty.call(g,p)&&(v[p]=g[p])},o(d,m)},function(d,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function v(){this.constructor=d}o(d,m),d.prototype=m===null?Object.create(m):(v.prototype=m.prototype,new v)}),l=this&&this.__decorate||function(d,m,v,g){var p,_=arguments.length,x=_<3?m:g===null?g=Object.getOwnPropertyDescriptor(m,v):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(d,m,v,g);else for(var b=d.length-1;b>=0;b--)(p=d[b])&&(x=(_<3?p(x):_>3?p(m,v,x):p(m,v))||x);return _>3&&x&&Object.defineProperty(m,v,x),x},h=this&&this.__param||function(d,m){return function(v,g){m(v,g,d)}};Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionRenderLayer=void 0;var u=n(1546),c=n(2585),f=function(d){function m(v,g,p,_,x,b,y){var w=d.call(this,v,"selection",g,!0,p,_,x,b,y)||this;return w._clearState(),w}return a(m,d),m.prototype._clearState=function(){this._state={start:void 0,end:void 0,columnSelectMode:void 0,ydisp:void 0}},m.prototype.resize=function(v){d.prototype.resize.call(this,v),this._clearState()},m.prototype.reset=function(){this._state.start&&this._state.end&&(this._clearState(),this._clearAll())},m.prototype.onSelectionChanged=function(v,g,p){if(d.prototype.onSelectionChanged.call(this,v,g,p),this._didStateChange(v,g,p,this._bufferService.buffer.ydisp))if(this._clearAll(),v&&g){var _=v[1]-this._bufferService.buffer.ydisp,x=g[1]-this._bufferService.buffer.ydisp,b=Math.max(_,0),y=Math.min(x,this._bufferService.rows-1);if(b>=this._bufferService.rows||y<0)this._state.ydisp=this._bufferService.buffer.ydisp;else{if(this._ctx.fillStyle=this._colors.selectionTransparent.css,p){var w=v[0],S=g[0]-w,R=y-b+1;this._fillCells(w,b,S,R)}else{w=_===b?v[0]:0;var E=b===x?g[0]:this._bufferService.cols;this._fillCells(w,b,E-w,1);var T=Math.max(y-b-1,0);if(this._fillCells(0,b+1,this._bufferService.cols,T),b!==y){var A=x===y?g[0]:this._bufferService.cols;this._fillCells(0,y,A,1)}}this._state.start=[v[0],v[1]],this._state.end=[g[0],g[1]],this._state.columnSelectMode=p,this._state.ydisp=this._bufferService.buffer.ydisp}}else this._clearState()},m.prototype._didStateChange=function(v,g,p,_){return!this._areCoordinatesEqual(v,this._state.start)||!this._areCoordinatesEqual(g,this._state.end)||p!==this._state.columnSelectMode||_!==this._state.ydisp},m.prototype._areCoordinatesEqual=function(v,g){return!(!v||!g)&&v[0]===g[0]&&v[1]===g[1]},l([h(4,c.IBufferService),h(5,c.IOptionsService),h(6,c.IDecorationService)],m)}(u.BaseRenderLayer);r.SelectionRenderLayer=f},9596:function(i,r,n){var o,a=this&&this.__extends||(o=function(b,y){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,S){w.__proto__=S}||function(w,S){for(var R in S)Object.prototype.hasOwnProperty.call(S,R)&&(w[R]=S[R])},o(b,y)},function(b,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function w(){this.constructor=b}o(b,y),b.prototype=y===null?Object.create(y):(w.prototype=y.prototype,new w)}),l=this&&this.__decorate||function(b,y,w,S){var R,E=arguments.length,T=E<3?y:S===null?S=Object.getOwnPropertyDescriptor(y,w):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(b,y,w,S);else for(var A=b.length-1;A>=0;A--)(R=b[A])&&(T=(E<3?R(T):E>3?R(y,w,T):R(y,w))||T);return E>3&&T&&Object.defineProperty(y,w,T),T},h=this&&this.__param||function(b,y){return function(w,S){y(w,S,b)}},u=this&&this.__values||function(b){var y=typeof Symbol=="function"&&Symbol.iterator,w=y&&b[y],S=0;if(w)return w.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&S>=b.length&&(b=void 0),{value:b&&b[S++],done:!b}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.TextRenderLayer=void 0;var c=n(3700),f=n(1546),d=n(3734),m=n(643),v=n(511),g=n(2585),p=n(4725),_=n(4269),x=function(b){function y(w,S,R,E,T,A,C,M,D){var O=b.call(this,w,"text",S,E,R,T,A,C,D)||this;return O._characterJoinerService=M,O._characterWidth=0,O._characterFont="",O._characterOverlapCache={},O._workCell=new v.CellData,O._state=new c.GridCache,O}return a(y,b),y.prototype.resize=function(w){b.prototype.resize.call(this,w);var S=this._getFont(!1,!1);this._characterWidth===w.scaledCharWidth&&this._characterFont===S||(this._characterWidth=w.scaledCharWidth,this._characterFont=S,this._characterOverlapCache={}),this._state.clear(),this._state.resize(this._bufferService.cols,this._bufferService.rows)},y.prototype.reset=function(){this._state.clear(),this._clearAll()},y.prototype._forEachCell=function(w,S,R){for(var E=w;E<=S;E++)for(var T=E+this._bufferService.buffer.ydisp,A=this._bufferService.buffer.lines.get(T),C=this._characterJoinerService.getJoinedCharacters(T),M=0;M<this._bufferService.cols;M++){A.loadCell(M,this._workCell);var D=this._workCell,O=!1,P=M;if(D.getWidth()!==0){if(C.length>0&&M===C[0][0]){O=!0;var L=C.shift();D=new _.JoinedCellData(this._workCell,A.translateToString(!0,L[0],L[1]),L[1]-L[0]),P=L[1]-1}!O&&this._isOverlapping(D)&&P<A.length-1&&A.getCodePoint(P+1)===m.NULL_CELL_CODE&&(D.content&=-12582913,D.content|=2<<22),R(D,M,E),M=P}}},y.prototype._drawBackground=function(w,S){var R=this,E=this._ctx,T=this._bufferService.cols,A=0,C=0,M=null;E.save(),this._forEachCell(w,S,function(D,O,P){var L,I,k=null;D.isInverse()?k=D.isFgDefault()?R._colors.foreground.css:D.isFgRGB()?"rgb("+d.AttributeData.toColorRGB(D.getFgColor()).join(",")+")":R._colors.ansi[D.getFgColor()].css:D.isBgRGB()?k="rgb("+d.AttributeData.toColorRGB(D.getBgColor()).join(",")+")":D.isBgPalette()&&(k=R._colors.ansi[D.getBgColor()].css);var B=!1;try{for(var F=u(R._decorationService.getDecorationsAtCell(O,R._bufferService.buffer.ydisp+P)),W=F.next();!W.done;W=F.next()){var V=W.value;V.options.layer!=="top"&&B||(V.backgroundColorRGB&&(k=V.backgroundColorRGB.css),B=V.options.layer==="top")}}catch(N){L={error:N}}finally{try{W&&!W.done&&(I=F.return)&&I.call(F)}finally{if(L)throw L.error}}M===null&&(A=O,C=P),P!==C?(E.fillStyle=M||"",R._fillCells(A,C,T-A,1),A=O,C=P):M!==k&&(E.fillStyle=M||"",R._fillCells(A,C,O-A,1),A=O,C=P),M=k}),M!==null&&(E.fillStyle=M,this._fillCells(A,C,T-A,1)),E.restore()},y.prototype._drawForeground=function(w,S){var R=this;this._forEachCell(w,S,function(E,T,A){if(!E.isInvisible()&&(R._drawChars(E,T,A),E.isUnderline()||E.isStrikethrough())){if(R._ctx.save(),E.isInverse())if(E.isBgDefault())R._ctx.fillStyle=R._colors.background.css;else if(E.isBgRGB())R._ctx.fillStyle="rgb("+d.AttributeData.toColorRGB(E.getBgColor()).join(",")+")";else{var C=E.getBgColor();R._optionsService.rawOptions.drawBoldTextInBrightColors&&E.isBold()&&C<8&&(C+=8),R._ctx.fillStyle=R._colors.ansi[C].css}else if(E.isFgDefault())R._ctx.fillStyle=R._colors.foreground.css;else if(E.isFgRGB())R._ctx.fillStyle="rgb("+d.AttributeData.toColorRGB(E.getFgColor()).join(",")+")";else{var M=E.getFgColor();R._optionsService.rawOptions.drawBoldTextInBrightColors&&E.isBold()&&M<8&&(M+=8),R._ctx.fillStyle=R._colors.ansi[M].css}E.isStrikethrough()&&R._fillMiddleLineAtCells(T,A,E.getWidth()),E.isUnderline()&&R._fillBottomLineAtCells(T,A,E.getWidth()),R._ctx.restore()}})},y.prototype.onGridChanged=function(w,S){this._state.cache.length!==0&&(this._charAtlas&&this._charAtlas.beginFrame(),this._clearCells(0,w,this._bufferService.cols,S-w+1),this._drawBackground(w,S),this._drawForeground(w,S))},y.prototype.onOptionsChanged=function(){this._setTransparency(this._optionsService.rawOptions.allowTransparency)},y.prototype._isOverlapping=function(w){if(w.getWidth()!==1||w.getCode()<256)return!1;var S=w.getChars();if(this._characterOverlapCache.hasOwnProperty(S))return this._characterOverlapCache[S];this._ctx.save(),this._ctx.font=this._characterFont;var R=Math.floor(this._ctx.measureText(S).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[S]=R,R},l([h(5,g.IBufferService),h(6,g.IOptionsService),h(7,p.ICharacterJoinerService),h(8,g.IDecorationService)],y)}(f.BaseRenderLayer);r.TextRenderLayer=x},9616:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BaseCharAtlas=void 0;var n=function(){function o(){this._didWarmUp=!1}return o.prototype.dispose=function(){},o.prototype.warmUp=function(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)},o.prototype._doWarmUp=function(){},o.prototype.clear=function(){},o.prototype.beginFrame=function(){},o}();r.BaseCharAtlas=n},1420:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.removeTerminalFromCache=r.acquireCharAtlas=void 0;var o=n(2040),a=n(1906),l=[];r.acquireCharAtlas=function(h,u,c,f,d){for(var m=(0,o.generateConfig)(f,d,h,c),v=0;v<l.length;v++){var g=(p=l[v]).ownedBy.indexOf(u);if(g>=0){if((0,o.configEquals)(p.config,m))return p.atlas;p.ownedBy.length===1?(p.atlas.dispose(),l.splice(v,1)):p.ownedBy.splice(g,1);break}}for(v=0;v<l.length;v++){var p=l[v];if((0,o.configEquals)(p.config,m))return p.ownedBy.push(u),p.atlas}var _={atlas:new a.DynamicCharAtlas(document,m),config:m,ownedBy:[u]};return l.push(_),_.atlas},r.removeTerminalFromCache=function(h){for(var u=0;u<l.length;u++){var c=l[u].ownedBy.indexOf(h);if(c!==-1){l[u].ownedBy.length===1?(l[u].atlas.dispose(),l.splice(u,1)):l[u].ownedBy.splice(c,1);break}}}},2040:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.is256Color=r.configEquals=r.generateConfig=void 0;var o=n(643);r.generateConfig=function(a,l,h,u){var c={foreground:u.foreground,background:u.background,cursor:void 0,cursorAccent:void 0,selection:void 0,ansi:u.ansi.slice()};return{devicePixelRatio:window.devicePixelRatio,scaledCharWidth:a,scaledCharHeight:l,fontFamily:h.fontFamily,fontSize:h.fontSize,fontWeight:h.fontWeight,fontWeightBold:h.fontWeightBold,allowTransparency:h.allowTransparency,colors:c}},r.configEquals=function(a,l){for(var h=0;h<a.colors.ansi.length;h++)if(a.colors.ansi[h].rgba!==l.colors.ansi[h].rgba)return!1;return a.devicePixelRatio===l.devicePixelRatio&&a.fontFamily===l.fontFamily&&a.fontSize===l.fontSize&&a.fontWeight===l.fontWeight&&a.fontWeightBold===l.fontWeightBold&&a.allowTransparency===l.allowTransparency&&a.scaledCharWidth===l.scaledCharWidth&&a.scaledCharHeight===l.scaledCharHeight&&a.colors.foreground===l.colors.foreground&&a.colors.background===l.colors.background},r.is256Color=function(a){return a<o.DEFAULT_COLOR}},8803:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CHAR_ATLAS_CELL_SPACING=r.TEXT_BASELINE=r.DIM_OPACITY=r.INVERTED_DEFAULT_COLOR=void 0;var o=n(6114);r.INVERTED_DEFAULT_COLOR=257,r.DIM_OPACITY=.5,r.TEXT_BASELINE=o.isFirefox||o.isLegacyEdge?"bottom":"ideographic",r.CHAR_ATLAS_CELL_SPACING=1},1906:function(i,r,n){var o,a=this&&this.__extends||(o=function(w,S){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,E){R.__proto__=E}||function(R,E){for(var T in E)Object.prototype.hasOwnProperty.call(E,T)&&(R[T]=E[T])},o(w,S)},function(w,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function R(){this.constructor=w}o(w,S),w.prototype=S===null?Object.create(S):(R.prototype=S.prototype,new R)});Object.defineProperty(r,"__esModule",{value:!0}),r.NoneCharAtlas=r.DynamicCharAtlas=r.getGlyphCacheKey=void 0;var l=n(8803),h=n(9616),u=n(5680),c=n(7001),f=n(6114),d=n(1752),m=n(8055),v=1024,g=1024,p={css:"rgba(0, 0, 0, 0)",rgba:0};function _(w){return w.code<<21|w.bg<<12|w.fg<<3|(w.bold?0:4)+(w.dim?0:2)+(w.italic?0:1)}r.getGlyphCacheKey=_;var x=function(w){function S(R,E){var T=w.call(this)||this;T._config=E,T._drawToCacheCount=0,T._glyphsWaitingOnBitmap=[],T._bitmapCommitTimeout=null,T._bitmap=null,T._cacheCanvas=R.createElement("canvas"),T._cacheCanvas.width=v,T._cacheCanvas.height=g,T._cacheCtx=(0,d.throwIfFalsy)(T._cacheCanvas.getContext("2d",{alpha:!0}));var A=R.createElement("canvas");A.width=T._config.scaledCharWidth,A.height=T._config.scaledCharHeight,T._tmpCtx=(0,d.throwIfFalsy)(A.getContext("2d",{alpha:T._config.allowTransparency})),T._width=Math.floor(v/T._config.scaledCharWidth),T._height=Math.floor(g/T._config.scaledCharHeight);var C=T._width*T._height;return T._cacheMap=new c.LRUMap(C),T._cacheMap.prealloc(C),T}return a(S,w),S.prototype.dispose=function(){this._bitmapCommitTimeout!==null&&(window.clearTimeout(this._bitmapCommitTimeout),this._bitmapCommitTimeout=null)},S.prototype.beginFrame=function(){this._drawToCacheCount=0},S.prototype.clear=function(){if(this._cacheMap.size>0){var R=this._width*this._height;this._cacheMap=new c.LRUMap(R),this._cacheMap.prealloc(R)}this._cacheCtx.clearRect(0,0,v,g),this._tmpCtx.clearRect(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight)},S.prototype.draw=function(R,E,T,A){if(E.code===32)return!0;if(!this._canCache(E))return!1;var C=_(E),M=this._cacheMap.get(C);if(M!=null)return this._drawFromCache(R,M,T,A),!0;if(this._drawToCacheCount<100){var D;D=this._cacheMap.size<this._cacheMap.capacity?this._cacheMap.size:this._cacheMap.peek().index;var O=this._drawToCache(E,D);return this._cacheMap.set(C,O),this._drawFromCache(R,O,T,A),!0}return!1},S.prototype._canCache=function(R){return R.code<256},S.prototype._toCoordinateX=function(R){return R%this._width*this._config.scaledCharWidth},S.prototype._toCoordinateY=function(R){return Math.floor(R/this._width)*this._config.scaledCharHeight},S.prototype._drawFromCache=function(R,E,T,A){if(!E.isEmpty){var C=this._toCoordinateX(E.index),M=this._toCoordinateY(E.index);R.drawImage(E.inBitmap?this._bitmap:this._cacheCanvas,C,M,this._config.scaledCharWidth,this._config.scaledCharHeight,T,A,this._config.scaledCharWidth,this._config.scaledCharHeight)}},S.prototype._getColorFromAnsiIndex=function(R){return R<this._config.colors.ansi.length?this._config.colors.ansi[R]:u.DEFAULT_ANSI_COLORS[R]},S.prototype._getBackgroundColor=function(R){return this._config.allowTransparency?p:R.bg===l.INVERTED_DEFAULT_COLOR?this._config.colors.foreground:R.bg<256?this._getColorFromAnsiIndex(R.bg):this._config.colors.background},S.prototype._getForegroundColor=function(R){return R.fg===l.INVERTED_DEFAULT_COLOR?m.color.opaque(this._config.colors.background):R.fg<256?this._getColorFromAnsiIndex(R.fg):this._config.colors.foreground},S.prototype._drawToCache=function(R,E){this._drawToCacheCount++,this._tmpCtx.save();var T=this._getBackgroundColor(R);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=T.css,this._tmpCtx.fillRect(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),this._tmpCtx.globalCompositeOperation="source-over";var A=R.bold?this._config.fontWeightBold:this._config.fontWeight,C=R.italic?"italic":"";this._tmpCtx.font=C+" "+A+" "+this._config.fontSize*this._config.devicePixelRatio+"px "+this._config.fontFamily,this._tmpCtx.textBaseline=l.TEXT_BASELINE,this._tmpCtx.fillStyle=this._getForegroundColor(R).css,R.dim&&(this._tmpCtx.globalAlpha=l.DIM_OPACITY),this._tmpCtx.fillText(R.chars,0,this._config.scaledCharHeight);var M=this._tmpCtx.getImageData(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),D=!1;if(this._config.allowTransparency||(D=y(M,T)),D&&R.chars==="_"&&!this._config.allowTransparency)for(var O=1;O<=5&&(this._tmpCtx.fillText(R.chars,0,this._config.scaledCharHeight-O),D=y(M=this._tmpCtx.getImageData(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),T));O++);this._tmpCtx.restore();var P=this._toCoordinateX(E),L=this._toCoordinateY(E);this._cacheCtx.putImageData(M,P,L);var I={index:E,isEmpty:D,inBitmap:!1};return this._addGlyphToBitmap(I),I},S.prototype._addGlyphToBitmap=function(R){var E=this;!("createImageBitmap"in window)||f.isFirefox||f.isSafari||(this._glyphsWaitingOnBitmap.push(R),this._bitmapCommitTimeout===null&&(this._bitmapCommitTimeout=window.setTimeout(function(){return E._generateBitmap()},100)))},S.prototype._generateBitmap=function(){var R=this,E=this._glyphsWaitingOnBitmap;this._glyphsWaitingOnBitmap=[],window.createImageBitmap(this._cacheCanvas).then(function(T){R._bitmap=T;for(var A=0;A<E.length;A++)E[A].inBitmap=!0}),this._bitmapCommitTimeout=null},S}(h.BaseCharAtlas);r.DynamicCharAtlas=x;var b=function(w){function S(R,E){return w.call(this)||this}return a(S,w),S.prototype.draw=function(R,E,T,A){return!1},S}(h.BaseCharAtlas);function y(w,S){for(var R=!0,E=S.rgba>>>24,T=S.rgba>>>16&255,A=S.rgba>>>8&255,C=0;C<w.data.length;C+=4)w.data[C]===E&&w.data[C+1]===T&&w.data[C+2]===A?w.data[C+3]=0:R=!1;return R}r.NoneCharAtlas=b},7001:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.LRUMap=void 0;var n=function(){function o(a){this.capacity=a,this._map={},this._head=null,this._tail=null,this._nodePool=[],this.size=0}return o.prototype._unlinkNode=function(a){var l=a.prev,h=a.next;a===this._head&&(this._head=h),a===this._tail&&(this._tail=l),l!==null&&(l.next=h),h!==null&&(h.prev=l)},o.prototype._appendNode=function(a){var l=this._tail;l!==null&&(l.next=a),a.prev=l,a.next=null,this._tail=a,this._head===null&&(this._head=a)},o.prototype.prealloc=function(a){for(var l=this._nodePool,h=0;h<a;h++)l.push({prev:null,next:null,key:null,value:null})},o.prototype.get=function(a){var l=this._map[a];return l!==void 0?(this._unlinkNode(l),this._appendNode(l),l.value):null},o.prototype.peekValue=function(a){var l=this._map[a];return l!==void 0?l.value:null},o.prototype.peek=function(){var a=this._head;return a===null?null:a.value},o.prototype.set=function(a,l){var h=this._map[a];if(h!==void 0)h=this._map[a],this._unlinkNode(h),h.value=l;else if(this.size>=this.capacity)h=this._head,this._unlinkNode(h),delete this._map[h.key],h.key=a,h.value=l,this._map[a]=h;else{var u=this._nodePool;u.length>0?((h=u.pop()).key=a,h.value=l):h={prev:null,next:null,key:a,value:l},this._map[a]=h,this.size++}this._appendNode(h)},o}();r.LRUMap=n},1296:function(i,r,n){var o,a=this&&this.__extends||(o=function(E,T){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,C){A.__proto__=C}||function(A,C){for(var M in C)Object.prototype.hasOwnProperty.call(C,M)&&(A[M]=C[M])},o(E,T)},function(E,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function A(){this.constructor=E}o(E,T),E.prototype=T===null?Object.create(T):(A.prototype=T.prototype,new A)}),l=this&&this.__decorate||function(E,T,A,C){var M,D=arguments.length,O=D<3?T:C===null?C=Object.getOwnPropertyDescriptor(T,A):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")O=Reflect.decorate(E,T,A,C);else for(var P=E.length-1;P>=0;P--)(M=E[P])&&(O=(D<3?M(O):D>3?M(T,A,O):M(T,A))||O);return D>3&&O&&Object.defineProperty(T,A,O),O},h=this&&this.__param||function(E,T){return function(A,C){T(A,C,E)}},u=this&&this.__values||function(E){var T=typeof Symbol=="function"&&Symbol.iterator,A=T&&E[T],C=0;if(A)return A.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&C>=E.length&&(E=void 0),{value:E&&E[C++],done:!E}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRenderer=void 0;var c=n(3787),f=n(8803),d=n(844),m=n(4725),v=n(2585),g=n(8460),p=n(8055),_=n(9631),x="xterm-dom-renderer-owner-",b="xterm-fg-",y="xterm-bg-",w="xterm-focus",S=1,R=function(E){function T(A,C,M,D,O,P,L,I,k,B){var F=E.call(this)||this;return F._colors=A,F._element=C,F._screenElement=M,F._viewportElement=D,F._linkifier=O,F._linkifier2=P,F._charSizeService=I,F._optionsService=k,F._bufferService=B,F._terminalClass=S++,F._rowElements=[],F._rowContainer=document.createElement("div"),F._rowContainer.classList.add("xterm-rows"),F._rowContainer.style.lineHeight="normal",F._rowContainer.setAttribute("aria-hidden","true"),F._refreshRowElements(F._bufferService.cols,F._bufferService.rows),F._selectionContainer=document.createElement("div"),F._selectionContainer.classList.add("xterm-selection"),F._selectionContainer.setAttribute("aria-hidden","true"),F.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},F._updateDimensions(),F._injectCss(),F._rowFactory=L.createInstance(c.DomRendererRowFactory,document,F._colors),F._element.classList.add(x+F._terminalClass),F._screenElement.appendChild(F._rowContainer),F._screenElement.appendChild(F._selectionContainer),F.register(F._linkifier.onShowLinkUnderline(function(W){return F._onLinkHover(W)})),F.register(F._linkifier.onHideLinkUnderline(function(W){return F._onLinkLeave(W)})),F.register(F._linkifier2.onShowLinkUnderline(function(W){return F._onLinkHover(W)})),F.register(F._linkifier2.onHideLinkUnderline(function(W){return F._onLinkLeave(W)})),F}return a(T,E),Object.defineProperty(T.prototype,"onRequestRedraw",{get:function(){return new g.EventEmitter().event},enumerable:!1,configurable:!0}),T.prototype.dispose=function(){this._element.classList.remove(x+this._terminalClass),(0,_.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement),E.prototype.dispose.call(this)},T.prototype._updateDimensions=function(){var A,C;this.dimensions.scaledCharWidth=this._charSizeService.width*window.devicePixelRatio,this.dimensions.scaledCharHeight=Math.ceil(this._charSizeService.height*window.devicePixelRatio),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._optionsService.rawOptions.lineHeight),this.dimensions.scaledCharLeft=0,this.dimensions.scaledCharTop=0,this.dimensions.scaledCanvasWidth=this.dimensions.scaledCellWidth*this._bufferService.cols,this.dimensions.scaledCanvasHeight=this.dimensions.scaledCellHeight*this._bufferService.rows,this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/window.devicePixelRatio),this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/window.devicePixelRatio),this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._bufferService.cols,this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._bufferService.rows;try{for(var M=u(this._rowElements),D=M.next();!D.done;D=M.next()){var O=D.value;O.style.width=this.dimensions.canvasWidth+"px",O.style.height=this.dimensions.actualCellHeight+"px",O.style.lineHeight=this.dimensions.actualCellHeight+"px",O.style.overflow="hidden"}}catch(L){A={error:L}}finally{try{D&&!D.done&&(C=M.return)&&C.call(M)}finally{if(A)throw A.error}}this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));var P=this._terminalSelector+" .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: "+this.dimensions.actualCellWidth+"px}";this._dimensionsStyleElement.textContent=P,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=this.dimensions.canvasWidth+"px",this._screenElement.style.height=this.dimensions.canvasHeight+"px"},T.prototype.setColors=function(A){this._colors=A,this._injectCss()},T.prototype._injectCss=function(){var A=this;this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));var C=this._terminalSelector+" .xterm-rows { color: "+this._colors.foreground.css+"; font-family: "+this._optionsService.rawOptions.fontFamily+"; font-size: "+this._optionsService.rawOptions.fontSize+"px;}";C+=this._terminalSelector+" span:not(."+c.BOLD_CLASS+") { font-weight: "+this._optionsService.rawOptions.fontWeight+";}"+this._terminalSelector+" span."+c.BOLD_CLASS+" { font-weight: "+this._optionsService.rawOptions.fontWeightBold+";}"+this._terminalSelector+" span."+c.ITALIC_CLASS+" { font-style: italic;}",C+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",C+="@keyframes blink_block_"+this._terminalClass+" { 0% {  background-color: "+this._colors.cursor.css+";  color: "+this._colors.cursorAccent.css+"; } 50% {  background-color: "+this._colors.cursorAccent.css+";  color: "+this._colors.cursor.css+"; }}",C+=this._terminalSelector+" .xterm-rows:not(.xterm-focus) ."+c.CURSOR_CLASS+"."+c.CURSOR_STYLE_BLOCK_CLASS+" { outline: 1px solid "+this._colors.cursor.css+"; outline-offset: -1px;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+c.CURSOR_CLASS+"."+c.CURSOR_BLINK_CLASS+":not(."+c.CURSOR_STYLE_BLOCK_CLASS+") { animation: blink_box_shadow_"+this._terminalClass+" 1s step-end infinite;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+c.CURSOR_CLASS+"."+c.CURSOR_BLINK_CLASS+"."+c.CURSOR_STYLE_BLOCK_CLASS+" { animation: blink_block_"+this._terminalClass+" 1s step-end infinite;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+c.CURSOR_CLASS+"."+c.CURSOR_STYLE_BLOCK_CLASS+" { background-color: "+this._colors.cursor.css+"; color: "+this._colors.cursorAccent.css+";}"+this._terminalSelector+" .xterm-rows ."+c.CURSOR_CLASS+"."+c.CURSOR_STYLE_BAR_CLASS+" { box-shadow: "+this._optionsService.rawOptions.cursorWidth+"px 0 0 "+this._colors.cursor.css+" inset;}"+this._terminalSelector+" .xterm-rows ."+c.CURSOR_CLASS+"."+c.CURSOR_STYLE_UNDERLINE_CLASS+" { box-shadow: 0 -1px 0 "+this._colors.cursor.css+" inset;}",C+=this._terminalSelector+" .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}"+this._terminalSelector+" .xterm-selection div { position: absolute; background-color: "+this._colors.selectionOpaque.css+";}",this._colors.ansi.forEach(function(M,D){C+=A._terminalSelector+" ."+b+D+" { color: "+M.css+"; }"+A._terminalSelector+" ."+y+D+" { background-color: "+M.css+"; }"}),C+=this._terminalSelector+" ."+b+f.INVERTED_DEFAULT_COLOR+" { color: "+p.color.opaque(this._colors.background).css+"; }"+this._terminalSelector+" ."+y+f.INVERTED_DEFAULT_COLOR+" { background-color: "+this._colors.foreground.css+"; }",this._themeStyleElement.textContent=C},T.prototype.onDevicePixelRatioChange=function(){this._updateDimensions()},T.prototype._refreshRowElements=function(A,C){for(var M=this._rowElements.length;M<=C;M++){var D=document.createElement("div");this._rowContainer.appendChild(D),this._rowElements.push(D)}for(;this._rowElements.length>C;)this._rowContainer.removeChild(this._rowElements.pop())},T.prototype.onResize=function(A,C){this._refreshRowElements(A,C),this._updateDimensions()},T.prototype.onCharSizeChanged=function(){this._updateDimensions()},T.prototype.onBlur=function(){this._rowContainer.classList.remove(w)},T.prototype.onFocus=function(){this._rowContainer.classList.add(w)},T.prototype.onSelectionChanged=function(A,C,M){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.onSelectionChanged(A,C,M),this.renderRows(0,this._bufferService.rows-1),A&&C){var D=A[1]-this._bufferService.buffer.ydisp,O=C[1]-this._bufferService.buffer.ydisp,P=Math.max(D,0),L=Math.min(O,this._bufferService.rows-1);if(!(P>=this._bufferService.rows||L<0)){var I=document.createDocumentFragment();if(M){var k=A[0]>C[0];I.appendChild(this._createSelectionElement(P,k?C[0]:A[0],k?A[0]:C[0],L-P+1))}else{var B=D===P?A[0]:0,F=P===O?C[0]:this._bufferService.cols;I.appendChild(this._createSelectionElement(P,B,F));var W=L-P-1;if(I.appendChild(this._createSelectionElement(P+1,0,this._bufferService.cols,W)),P!==L){var V=O===L?C[0]:this._bufferService.cols;I.appendChild(this._createSelectionElement(L,0,V))}}this._selectionContainer.appendChild(I)}}},T.prototype._createSelectionElement=function(A,C,M,D){D===void 0&&(D=1);var O=document.createElement("div");return O.style.height=D*this.dimensions.actualCellHeight+"px",O.style.top=A*this.dimensions.actualCellHeight+"px",O.style.left=C*this.dimensions.actualCellWidth+"px",O.style.width=this.dimensions.actualCellWidth*(M-C)+"px",O},T.prototype.onCursorMove=function(){},T.prototype.onOptionsChanged=function(){this._updateDimensions(),this._injectCss()},T.prototype.clear=function(){var A,C;try{for(var M=u(this._rowElements),D=M.next();!D.done;D=M.next())D.value.innerText=""}catch(O){A={error:O}}finally{try{D&&!D.done&&(C=M.return)&&C.call(M)}finally{if(A)throw A.error}}},T.prototype.renderRows=function(A,C){for(var M=this._bufferService.buffer.ybase+this._bufferService.buffer.y,D=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),O=this._optionsService.rawOptions.cursorBlink,P=A;P<=C;P++){var L=this._rowElements[P];L.innerText="";var I=P+this._bufferService.buffer.ydisp,k=this._bufferService.buffer.lines.get(I),B=this._optionsService.rawOptions.cursorStyle;L.appendChild(this._rowFactory.createRow(k,I,I===M,B,D,O,this.dimensions.actualCellWidth,this._bufferService.cols))}},Object.defineProperty(T.prototype,"_terminalSelector",{get:function(){return"."+x+this._terminalClass},enumerable:!1,configurable:!0}),T.prototype._onLinkHover=function(A){this._setCellUnderline(A.x1,A.x2,A.y1,A.y2,A.cols,!0)},T.prototype._onLinkLeave=function(A){this._setCellUnderline(A.x1,A.x2,A.y1,A.y2,A.cols,!1)},T.prototype._setCellUnderline=function(A,C,M,D,O,P){for(;A!==C||M!==D;){var L=this._rowElements[M];if(!L)return;var I=L.children[A];I&&(I.style.textDecoration=P?"underline":"none"),++A>=O&&(A=0,M++)}},l([h(6,v.IInstantiationService),h(7,m.ICharSizeService),h(8,v.IOptionsService),h(9,v.IBufferService)],T)}(d.Disposable);r.DomRenderer=R},3787:function(i,r,n){var o=this&&this.__decorate||function(x,b,y,w){var S,R=arguments.length,E=R<3?b:w===null?w=Object.getOwnPropertyDescriptor(b,y):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(x,b,y,w);else for(var T=x.length-1;T>=0;T--)(S=x[T])&&(E=(R<3?S(E):R>3?S(b,y,E):S(b,y))||E);return R>3&&E&&Object.defineProperty(b,y,E),E},a=this&&this.__param||function(x,b){return function(y,w){b(y,w,x)}},l=this&&this.__values||function(x){var b=typeof Symbol=="function"&&Symbol.iterator,y=b&&x[b],w=0;if(y)return y.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&w>=x.length&&(x=void 0),{value:x&&x[w++],done:!x}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.DomRendererRowFactory=r.CURSOR_STYLE_UNDERLINE_CLASS=r.CURSOR_STYLE_BAR_CLASS=r.CURSOR_STYLE_BLOCK_CLASS=r.CURSOR_BLINK_CLASS=r.CURSOR_CLASS=r.STRIKETHROUGH_CLASS=r.UNDERLINE_CLASS=r.ITALIC_CLASS=r.DIM_CLASS=r.BOLD_CLASS=void 0;var h=n(8803),u=n(643),c=n(511),f=n(2585),d=n(8055),m=n(4725),v=n(4269),g=n(1752);r.BOLD_CLASS="xterm-bold",r.DIM_CLASS="xterm-dim",r.ITALIC_CLASS="xterm-italic",r.UNDERLINE_CLASS="xterm-underline",r.STRIKETHROUGH_CLASS="xterm-strikethrough",r.CURSOR_CLASS="xterm-cursor",r.CURSOR_BLINK_CLASS="xterm-cursor-blink",r.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",r.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",r.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";var p=function(){function x(b,y,w,S,R,E){this._document=b,this._colors=y,this._characterJoinerService=w,this._optionsService=S,this._coreService=R,this._decorationService=E,this._workCell=new c.CellData,this._columnSelectMode=!1}return x.prototype.setColors=function(b){this._colors=b},x.prototype.onSelectionChanged=function(b,y,w){this._selectionStart=b,this._selectionEnd=y,this._columnSelectMode=w},x.prototype.createRow=function(b,y,w,S,R,E,T,A){for(var C,M,D=this._document.createDocumentFragment(),O=this._characterJoinerService.getJoinedCharacters(y),P=0,L=Math.min(b.length,A)-1;L>=0;L--)if(b.loadCell(L,this._workCell).getCode()!==u.NULL_CELL_CODE||w&&L===R){P=L+1;break}for(L=0;L<P;L++){b.loadCell(L,this._workCell);var I=this._workCell.getWidth();if(I!==0){var k=!1,B=L,F=this._workCell;if(O.length>0&&L===O[0][0]){k=!0;var W=O.shift();F=new v.JoinedCellData(this._workCell,b.translateToString(!0,W[0],W[1]),W[1]-W[0]),B=W[1]-1,I=F.getWidth()}var V=this._document.createElement("span");if(I>1&&(V.style.width=T*I+"px"),k&&(V.style.display="inline",R>=L&&R<=B&&(R=L)),!this._coreService.isCursorHidden&&w&&L===R)switch(V.classList.add(r.CURSOR_CLASS),E&&V.classList.add(r.CURSOR_BLINK_CLASS),S){case"bar":V.classList.add(r.CURSOR_STYLE_BAR_CLASS);break;case"underline":V.classList.add(r.CURSOR_STYLE_UNDERLINE_CLASS);break;default:V.classList.add(r.CURSOR_STYLE_BLOCK_CLASS)}F.isBold()&&V.classList.add(r.BOLD_CLASS),F.isItalic()&&V.classList.add(r.ITALIC_CLASS),F.isDim()&&V.classList.add(r.DIM_CLASS),F.isUnderline()&&V.classList.add(r.UNDERLINE_CLASS),F.isInvisible()?V.textContent=u.WHITESPACE_CELL_CHAR:V.textContent=F.getChars()||u.WHITESPACE_CELL_CHAR,F.isStrikethrough()&&V.classList.add(r.STRIKETHROUGH_CLASS);var N=F.getFgColor(),ne=F.getFgColorMode(),ie=F.getBgColor(),Q=F.getBgColorMode(),K=!!F.isInverse();if(K){var de=N;N=ie,ie=de;var re=ne;ne=Q,Q=re}var Y=void 0,U=void 0,z=!1;try{for(var te=(C=void 0,l(this._decorationService.getDecorationsAtCell(L,y))),ge=te.next();!ge.done;ge=te.next()){var Me=ge.value;Me.options.layer!=="top"&&z||(Me.backgroundColorRGB&&(Q=50331648,ie=Me.backgroundColorRGB.rgba>>8&16777215,Y=Me.backgroundColorRGB),Me.foregroundColorRGB&&(ne=50331648,N=Me.foregroundColorRGB.rgba>>8&16777215,U=Me.foregroundColorRGB),z=Me.options.layer==="top")}}catch(Ye){C={error:Ye}}finally{try{ge&&!ge.done&&(M=te.return)&&M.call(te)}finally{if(C)throw C.error}}var ze=this._isCellInSelection(L,y);z||this._colors.selectionForeground&&ze&&(ne=50331648,N=this._colors.selectionForeground.rgba>>8&16777215,U=this._colors.selectionForeground),ze&&(Y=this._colors.selectionOpaque,z=!0),z&&V.classList.add("xterm-decoration-top");var He=void 0;switch(Q){case 16777216:case 33554432:He=this._colors.ansi[ie],V.classList.add("xterm-bg-"+ie);break;case 50331648:He=d.rgba.toColor(ie>>16,ie>>8&255,255&ie),this._addStyle(V,"background-color:#"+_((ie>>>0).toString(16),"0",6));break;default:K?(He=this._colors.foreground,V.classList.add("xterm-bg-"+h.INVERTED_DEFAULT_COLOR)):He=this._colors.background}switch(ne){case 16777216:case 33554432:F.isBold()&&N<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(N+=8),this._applyMinimumContrast(V,He,this._colors.ansi[N],F,Y,void 0)||V.classList.add("xterm-fg-"+N);break;case 50331648:var Ne=d.rgba.toColor(N>>16&255,N>>8&255,255&N);this._applyMinimumContrast(V,He,Ne,F,Y,U)||this._addStyle(V,"color:#"+_(N.toString(16),"0",6));break;default:this._applyMinimumContrast(V,He,this._colors.foreground,F,Y,void 0)||K&&V.classList.add("xterm-fg-"+h.INVERTED_DEFAULT_COLOR)}D.appendChild(V),L=B}}return D},x.prototype._applyMinimumContrast=function(b,y,w,S,R,E){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,g.excludeFromContrastRatioDemands)(S.getCode()))return!1;var T=void 0;return R||E||(T=this._colors.contrastCache.getColor(y.rgba,w.rgba)),T===void 0&&(T=d.color.ensureContrastRatio(R||y,E||w,this._optionsService.rawOptions.minimumContrastRatio),this._colors.contrastCache.setColor((R||y).rgba,(E||w).rgba,T!=null?T:null)),!!T&&(this._addStyle(b,"color:"+T.css),!0)},x.prototype._addStyle=function(b,y){b.setAttribute("style",""+(b.getAttribute("style")||"")+y+";")},x.prototype._isCellInSelection=function(b,y){var w=this._selectionStart,S=this._selectionEnd;return!(!w||!S)&&(this._columnSelectMode?w[0]<=S[0]?b>=w[0]&&y>=w[1]&&b<S[0]&&y<=S[1]:b<w[0]&&y>=w[1]&&b>=S[0]&&y<=S[1]:y>w[1]&&y<S[1]||w[1]===S[1]&&y===w[1]&&b>=w[0]&&b<S[0]||w[1]<S[1]&&y===S[1]&&b<S[0]||w[1]<S[1]&&y===w[1]&&b>=w[0])},o([a(2,m.ICharacterJoinerService),a(3,f.IOptionsService),a(4,f.ICoreService),a(5,f.IDecorationService)],x)}();function _(x,b,y){for(;x.length<y;)x=b+x;return x}r.DomRendererRowFactory=p},456:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionModel=void 0;var n=function(){function o(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}return o.prototype.clearSelection=function(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0},Object.defineProperty(o.prototype,"finalSelectionStart",{get:function(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"finalSelectionEnd",{get:function(){return this.isSelectAllActive?[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1]:this.selectionStart?!this.selectionEnd||this.areSelectionValuesReversed()?(a=this.selectionStart[0]+this.selectionStartLength)>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]:this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]?(a=this.selectionStart[0]+this.selectionStartLength)>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]:this.selectionEnd:void 0;var a},enumerable:!1,configurable:!0}),o.prototype.areSelectionValuesReversed=function(){var a=this.selectionStart,l=this.selectionEnd;return!(!a||!l)&&(a[1]>l[1]||a[1]===l[1]&&a[0]>l[0])},o.prototype.onTrim=function(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)},o}();r.SelectionModel=n},428:function(i,r,n){var o=this&&this.__decorate||function(f,d,m,v){var g,p=arguments.length,_=p<3?d:v===null?v=Object.getOwnPropertyDescriptor(d,m):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(f,d,m,v);else for(var x=f.length-1;x>=0;x--)(g=f[x])&&(_=(p<3?g(_):p>3?g(d,m,_):g(d,m))||_);return p>3&&_&&Object.defineProperty(d,m,_),_},a=this&&this.__param||function(f,d){return function(m,v){d(m,v,f)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharSizeService=void 0;var l=n(2585),h=n(8460),u=function(){function f(d,m,v){this._optionsService=v,this.width=0,this.height=0,this._onCharSizeChange=new h.EventEmitter,this._measureStrategy=new c(d,m,this._optionsService)}return Object.defineProperty(f.prototype,"hasValidSize",{get:function(){return this.width>0&&this.height>0},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onCharSizeChange",{get:function(){return this._onCharSizeChange.event},enumerable:!1,configurable:!0}),f.prototype.measure=function(){var d=this._measureStrategy.measure();d.width===this.width&&d.height===this.height||(this.width=d.width,this.height=d.height,this._onCharSizeChange.fire())},o([a(2,l.IOptionsService)],f)}();r.CharSizeService=u;var c=function(){function f(d,m,v){this._document=d,this._parentElement=m,this._optionsService=v,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}return f.prototype.measure=function(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=this._optionsService.rawOptions.fontSize+"px";var d=this._measureElement.getBoundingClientRect();return d.width!==0&&d.height!==0&&(this._result.width=d.width,this._result.height=Math.ceil(d.height)),this._result},f}()},4269:function(i,r,n){var o,a=this&&this.__extends||(o=function(g,p){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,x){_.__proto__=x}||function(_,x){for(var b in x)Object.prototype.hasOwnProperty.call(x,b)&&(_[b]=x[b])},o(g,p)},function(g,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function _(){this.constructor=g}o(g,p),g.prototype=p===null?Object.create(p):(_.prototype=p.prototype,new _)}),l=this&&this.__decorate||function(g,p,_,x){var b,y=arguments.length,w=y<3?p:x===null?x=Object.getOwnPropertyDescriptor(p,_):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,p,_,x);else for(var S=g.length-1;S>=0;S--)(b=g[S])&&(w=(y<3?b(w):y>3?b(p,_,w):b(p,_))||w);return y>3&&w&&Object.defineProperty(p,_,w),w},h=this&&this.__param||function(g,p){return function(_,x){p(_,x,g)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CharacterJoinerService=r.JoinedCellData=void 0;var u=n(3734),c=n(643),f=n(511),d=n(2585),m=function(g){function p(_,x,b){var y=g.call(this)||this;return y.content=0,y.combinedData="",y.fg=_.fg,y.bg=_.bg,y.combinedData=x,y._width=b,y}return a(p,g),p.prototype.isCombined=function(){return 2097152},p.prototype.getWidth=function(){return this._width},p.prototype.getChars=function(){return this.combinedData},p.prototype.getCode=function(){return 2097151},p.prototype.setFromCharData=function(_){throw new Error("not implemented")},p.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},p}(u.AttributeData);r.JoinedCellData=m;var v=function(){function g(p){this._bufferService=p,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new f.CellData}return g.prototype.register=function(p){var _={id:this._nextCharacterJoinerId++,handler:p};return this._characterJoiners.push(_),_.id},g.prototype.deregister=function(p){for(var _=0;_<this._characterJoiners.length;_++)if(this._characterJoiners[_].id===p)return this._characterJoiners.splice(_,1),!0;return!1},g.prototype.getJoinedCharacters=function(p){if(this._characterJoiners.length===0)return[];var _=this._bufferService.buffer.lines.get(p);if(!_||_.length===0)return[];for(var x=[],b=_.translateToString(!0),y=0,w=0,S=0,R=_.getFg(0),E=_.getBg(0),T=0;T<_.getTrimmedLength();T++)if(_.loadCell(T,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==R||this._workCell.bg!==E){if(T-y>1)for(var A=this._getJoinedRanges(b,S,w,_,y),C=0;C<A.length;C++)x.push(A[C]);y=T,S=w,R=this._workCell.fg,E=this._workCell.bg}w+=this._workCell.getChars().length||c.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-y>1)for(A=this._getJoinedRanges(b,S,w,_,y),C=0;C<A.length;C++)x.push(A[C]);return x},g.prototype._getJoinedRanges=function(p,_,x,b,y){var w=p.substring(_,x),S=[];try{S=this._characterJoiners[0].handler(w)}catch(A){console.error(A)}for(var R=1;R<this._characterJoiners.length;R++)try{for(var E=this._characterJoiners[R].handler(w),T=0;T<E.length;T++)g._mergeRanges(S,E[T])}catch(A){console.error(A)}return this._stringRangesToCellRanges(S,b,y),S},g.prototype._stringRangesToCellRanges=function(p,_,x){var b=0,y=!1,w=0,S=p[b];if(S){for(var R=x;R<this._bufferService.cols;R++){var E=_.getWidth(R),T=_.getString(R).length||c.WHITESPACE_CELL_CHAR.length;if(E!==0){if(!y&&S[0]<=w&&(S[0]=R,y=!0),S[1]<=w){if(S[1]=R,!(S=p[++b]))break;S[0]<=w?(S[0]=R,y=!0):y=!1}w+=T}}S&&(S[1]=this._bufferService.cols)}},g._mergeRanges=function(p,_){for(var x=!1,b=0;b<p.length;b++){var y=p[b];if(x){if(_[1]<=y[0])return p[b-1][1]=_[1],p;if(_[1]<=y[1])return p[b-1][1]=Math.max(_[1],y[1]),p.splice(b,1),p;p.splice(b,1),b--}else{if(_[1]<=y[0])return p.splice(b,0,_),p;if(_[1]<=y[1])return y[0]=Math.min(_[0],y[0]),p;_[0]<y[1]&&(y[0]=Math.min(_[0],y[0]),x=!0)}}return x?p[p.length-1][1]=_[1]:p.push(_),p},g=l([h(0,d.IBufferService)],g)}();r.CharacterJoinerService=v},5114:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CoreBrowserService=void 0;var n=function(){function o(a){this._textarea=a}return Object.defineProperty(o.prototype,"isFocused",{get:function(){return(this._textarea.getRootNode?this._textarea.getRootNode():document).activeElement===this._textarea&&document.hasFocus()},enumerable:!1,configurable:!0}),o}();r.CoreBrowserService=n},8934:function(i,r,n){var o=this&&this.__decorate||function(c,f,d,m){var v,g=arguments.length,p=g<3?f:m===null?m=Object.getOwnPropertyDescriptor(f,d):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(c,f,d,m);else for(var _=c.length-1;_>=0;_--)(v=c[_])&&(p=(g<3?v(p):g>3?v(f,d,p):v(f,d))||p);return g>3&&p&&Object.defineProperty(f,d,p),p},a=this&&this.__param||function(c,f){return function(d,m){f(d,m,c)}};Object.defineProperty(r,"__esModule",{value:!0}),r.MouseService=void 0;var l=n(4725),h=n(9806),u=function(){function c(f,d){this._renderService=f,this._charSizeService=d}return c.prototype.getCoords=function(f,d,m,v,g){return(0,h.getCoords)(window,f,d,m,v,this._charSizeService.hasValidSize,this._renderService.dimensions.actualCellWidth,this._renderService.dimensions.actualCellHeight,g)},c.prototype.getRawByteCoords=function(f,d,m,v){var g=this.getCoords(f,d,m,v);return(0,h.getRawByteCoords)(g)},o([a(0,l.IRenderService),a(1,l.ICharSizeService)],c)}();r.MouseService=u},3230:function(i,r,n){var o,a=this&&this.__extends||(o=function(_,x){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,y){b.__proto__=y}||function(b,y){for(var w in y)Object.prototype.hasOwnProperty.call(y,w)&&(b[w]=y[w])},o(_,x)},function(_,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function b(){this.constructor=_}o(_,x),_.prototype=x===null?Object.create(x):(b.prototype=x.prototype,new b)}),l=this&&this.__decorate||function(_,x,b,y){var w,S=arguments.length,R=S<3?x:y===null?y=Object.getOwnPropertyDescriptor(x,b):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(_,x,b,y);else for(var E=_.length-1;E>=0;E--)(w=_[E])&&(R=(S<3?w(R):S>3?w(x,b,R):w(x,b))||R);return S>3&&R&&Object.defineProperty(x,b,R),R},h=this&&this.__param||function(_,x){return function(b,y){x(b,y,_)}};Object.defineProperty(r,"__esModule",{value:!0}),r.RenderService=void 0;var u=n(6193),c=n(8460),f=n(844),d=n(5596),m=n(3656),v=n(2585),g=n(4725),p=function(_){function x(b,y,w,S,R,E,T){var A=_.call(this)||this;if(A._renderer=b,A._rowCount=y,A._charSizeService=R,A._isPaused=!1,A._needsFullRefresh=!1,A._isNextRenderRedrawOnly=!0,A._needsSelectionRefresh=!1,A._canvasWidth=0,A._canvasHeight=0,A._selectionState={start:void 0,end:void 0,columnSelectMode:!1},A._onDimensionsChange=new c.EventEmitter,A._onRenderedViewportChange=new c.EventEmitter,A._onRender=new c.EventEmitter,A._onRefreshRequest=new c.EventEmitter,A.register({dispose:function(){return A._renderer.dispose()}}),A._renderDebouncer=new u.RenderDebouncer(function(M,D){return A._renderRows(M,D)}),A.register(A._renderDebouncer),A._screenDprMonitor=new d.ScreenDprMonitor,A._screenDprMonitor.setListener(function(){return A.onDevicePixelRatioChange()}),A.register(A._screenDprMonitor),A.register(T.onResize(function(){return A._fullRefresh()})),A.register(T.buffers.onBufferActivate(function(){var M;return(M=A._renderer)===null||M===void 0?void 0:M.clear()})),A.register(S.onOptionChange(function(){return A._handleOptionsChanged()})),A.register(A._charSizeService.onCharSizeChange(function(){return A.onCharSizeChanged()})),A.register(E.onDecorationRegistered(function(){return A._fullRefresh()})),A.register(E.onDecorationRemoved(function(){return A._fullRefresh()})),A._renderer.onRequestRedraw(function(M){return A.refreshRows(M.start,M.end,!0)}),A.register((0,m.addDisposableDomListener)(window,"resize",function(){return A.onDevicePixelRatioChange()})),"IntersectionObserver"in window){var C=new IntersectionObserver(function(M){return A._onIntersectionChange(M[M.length-1])},{threshold:0});C.observe(w),A.register({dispose:function(){return C.disconnect()}})}return A}return a(x,_),Object.defineProperty(x.prototype,"onDimensionsChange",{get:function(){return this._onDimensionsChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"onRenderedViewportChange",{get:function(){return this._onRenderedViewportChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"onRefreshRequest",{get:function(){return this._onRefreshRequest.event},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"dimensions",{get:function(){return this._renderer.dimensions},enumerable:!1,configurable:!0}),x.prototype._onIntersectionChange=function(b){this._isPaused=b.isIntersecting===void 0?b.intersectionRatio===0:!b.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)},x.prototype.refreshRows=function(b,y,w){w===void 0&&(w=!1),this._isPaused?this._needsFullRefresh=!0:(w||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(b,y,this._rowCount))},x.prototype._renderRows=function(b,y){this._renderer.renderRows(b,y),this._needsSelectionRefresh&&(this._renderer.onSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:b,end:y}),this._onRender.fire({start:b,end:y}),this._isNextRenderRedrawOnly=!0},x.prototype.resize=function(b,y){this._rowCount=y,this._fireOnCanvasResize()},x.prototype._handleOptionsChanged=function(){this._renderer.onOptionsChanged(),this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize()},x.prototype._fireOnCanvasResize=function(){this._renderer.dimensions.canvasWidth===this._canvasWidth&&this._renderer.dimensions.canvasHeight===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions)},x.prototype.dispose=function(){_.prototype.dispose.call(this)},x.prototype.setRenderer=function(b){var y=this;this._renderer.dispose(),this._renderer=b,this._renderer.onRequestRedraw(function(w){return y.refreshRows(w.start,w.end,!0)}),this._needsSelectionRefresh=!0,this._fullRefresh()},x.prototype.addRefreshCallback=function(b){return this._renderDebouncer.addRefreshCallback(b)},x.prototype._fullRefresh=function(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)},x.prototype.clearTextureAtlas=function(){var b,y;(y=(b=this._renderer)===null||b===void 0?void 0:b.clearTextureAtlas)===null||y===void 0||y.call(b),this._fullRefresh()},x.prototype.setColors=function(b){this._renderer.setColors(b),this._fullRefresh()},x.prototype.onDevicePixelRatioChange=function(){this._charSizeService.measure(),this._renderer.onDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1)},x.prototype.onResize=function(b,y){this._renderer.onResize(b,y),this._fullRefresh()},x.prototype.onCharSizeChanged=function(){this._renderer.onCharSizeChanged()},x.prototype.onBlur=function(){this._renderer.onBlur()},x.prototype.onFocus=function(){this._renderer.onFocus()},x.prototype.onSelectionChanged=function(b,y,w){this._selectionState.start=b,this._selectionState.end=y,this._selectionState.columnSelectMode=w,this._renderer.onSelectionChanged(b,y,w)},x.prototype.onCursorMove=function(){this._renderer.onCursorMove()},x.prototype.clear=function(){this._renderer.clear()},l([h(3,v.IOptionsService),h(4,g.ICharSizeService),h(5,v.IDecorationService),h(6,v.IBufferService)],x)}(f.Disposable);r.RenderService=p},9312:function(i,r,n){var o,a=this&&this.__extends||(o=function(S,R){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,T){E.__proto__=T}||function(E,T){for(var A in T)Object.prototype.hasOwnProperty.call(T,A)&&(E[A]=T[A])},o(S,R)},function(S,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function E(){this.constructor=S}o(S,R),S.prototype=R===null?Object.create(R):(E.prototype=R.prototype,new E)}),l=this&&this.__decorate||function(S,R,E,T){var A,C=arguments.length,M=C<3?R:T===null?T=Object.getOwnPropertyDescriptor(R,E):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(S,R,E,T);else for(var D=S.length-1;D>=0;D--)(A=S[D])&&(M=(C<3?A(M):C>3?A(R,E,M):A(R,E))||M);return C>3&&M&&Object.defineProperty(R,E,M),M},h=this&&this.__param||function(S,R){return function(E,T){R(E,T,S)}};Object.defineProperty(r,"__esModule",{value:!0}),r.SelectionService=void 0;var u=n(6114),c=n(456),f=n(511),d=n(8460),m=n(4725),v=n(2585),g=n(9806),p=n(9504),_=n(844),x=n(4841),b=String.fromCharCode(160),y=new RegExp(b,"g"),w=function(S){function R(E,T,A,C,M,D,O,P){var L=S.call(this)||this;return L._element=E,L._screenElement=T,L._linkifier=A,L._bufferService=C,L._coreService=M,L._mouseService=D,L._optionsService=O,L._renderService=P,L._dragScrollAmount=0,L._enabled=!0,L._workCell=new f.CellData,L._mouseDownTimeStamp=0,L._oldHasSelection=!1,L._oldSelectionStart=void 0,L._oldSelectionEnd=void 0,L._onLinuxMouseSelection=L.register(new d.EventEmitter),L._onRedrawRequest=L.register(new d.EventEmitter),L._onSelectionChange=L.register(new d.EventEmitter),L._onRequestScrollLines=L.register(new d.EventEmitter),L._mouseMoveListener=function(I){return L._onMouseMove(I)},L._mouseUpListener=function(I){return L._onMouseUp(I)},L._coreService.onUserInput(function(){L.hasSelection&&L.clearSelection()}),L._trimListener=L._bufferService.buffer.lines.onTrim(function(I){return L._onTrim(I)}),L.register(L._bufferService.buffers.onBufferActivate(function(I){return L._onBufferActivate(I)})),L.enable(),L._model=new c.SelectionModel(L._bufferService),L._activeSelectionMode=0,L}return a(R,S),Object.defineProperty(R.prototype,"onLinuxMouseSelection",{get:function(){return this._onLinuxMouseSelection.event},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onRequestRedraw",{get:function(){return this._onRedrawRequest.event},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onSelectionChange",{get:function(){return this._onSelectionChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"onRequestScrollLines",{get:function(){return this._onRequestScrollLines.event},enumerable:!1,configurable:!0}),R.prototype.dispose=function(){this._removeMouseDownListeners()},R.prototype.reset=function(){this.clearSelection()},R.prototype.disable=function(){this.clearSelection(),this._enabled=!1},R.prototype.enable=function(){this._enabled=!0},Object.defineProperty(R.prototype,"selectionStart",{get:function(){return this._model.finalSelectionStart},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"selectionEnd",{get:function(){return this._model.finalSelectionEnd},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"hasSelection",{get:function(){var E=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!(!E||!T||E[0]===T[0]&&E[1]===T[1])},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"selectionText",{get:function(){var E=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;if(!E||!T)return"";var A=this._bufferService.buffer,C=[];if(this._activeSelectionMode===3){if(E[0]===T[0])return"";for(var M=E[0]<T[0]?E[0]:T[0],D=E[0]<T[0]?T[0]:E[0],O=E[1];O<=T[1];O++){var P=A.translateBufferLineToString(O,!0,M,D);C.push(P)}}else{var L=E[1]===T[1]?T[0]:void 0;for(C.push(A.translateBufferLineToString(E[1],!0,E[0],L)),O=E[1]+1;O<=T[1]-1;O++){var I=A.lines.get(O);P=A.translateBufferLineToString(O,!0),I!=null&&I.isWrapped?C[C.length-1]+=P:C.push(P)}E[1]!==T[1]&&(I=A.lines.get(T[1]),P=A.translateBufferLineToString(T[1],!0,0,T[0]),I&&I.isWrapped?C[C.length-1]+=P:C.push(P))}return C.map(function(k){return k.replace(y," ")}).join(u.isWindows?`\r
`:`
`)},enumerable:!1,configurable:!0}),R.prototype.clearSelection=function(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()},R.prototype.refresh=function(E){var T=this;this._refreshAnimationFrame||(this._refreshAnimationFrame=window.requestAnimationFrame(function(){return T._refresh()})),u.isLinux&&E&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)},R.prototype._refresh=function(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})},R.prototype._isClickInSelection=function(E){var T=this._getMouseBufferCoords(E),A=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;return!!(A&&C&&T)&&this._areCoordsInSelection(T,A,C)},R.prototype.isCellInSelection=function(E,T){var A=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;return!(!A||!C)&&this._areCoordsInSelection([E,T],A,C)},R.prototype._areCoordsInSelection=function(E,T,A){return E[1]>T[1]&&E[1]<A[1]||T[1]===A[1]&&E[1]===T[1]&&E[0]>=T[0]&&E[0]<A[0]||T[1]<A[1]&&E[1]===A[1]&&E[0]<A[0]||T[1]<A[1]&&E[1]===T[1]&&E[0]>=T[0]},R.prototype._selectWordAtCursor=function(E,T){var A,C,M=(C=(A=this._linkifier.currentLink)===null||A===void 0?void 0:A.link)===null||C===void 0?void 0:C.range;if(M)return this._model.selectionStart=[M.start.x-1,M.start.y-1],this._model.selectionStartLength=(0,x.getRangeLength)(M,this._bufferService.cols),this._model.selectionEnd=void 0,!0;var D=this._getMouseBufferCoords(E);return!!D&&(this._selectWordAt(D,T),this._model.selectionEnd=void 0,!0)},R.prototype.selectAll=function(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()},R.prototype.selectLines=function(E,T){this._model.clearSelection(),E=Math.max(E,0),T=Math.min(T,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,E],this._model.selectionEnd=[this._bufferService.cols,T],this.refresh(),this._onSelectionChange.fire()},R.prototype._onTrim=function(E){this._model.onTrim(E)&&this.refresh()},R.prototype._getMouseBufferCoords=function(E){var T=this._mouseService.getCoords(E,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(T)return T[0]--,T[1]--,T[1]+=this._bufferService.buffer.ydisp,T},R.prototype._getMouseEventScrollAmount=function(E){var T=(0,g.getCoordsRelativeToElement)(window,E,this._screenElement)[1],A=this._renderService.dimensions.canvasHeight;return T>=0&&T<=A?0:(T>A&&(T-=A),T=Math.min(Math.max(T,-50),50),(T/=50)/Math.abs(T)+Math.round(14*T))},R.prototype.shouldForceSelection=function(E){return u.isMac?E.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:E.shiftKey},R.prototype.onMouseDown=function(E){if(this._mouseDownTimeStamp=E.timeStamp,(E.button!==2||!this.hasSelection)&&E.button===0){if(!this._enabled){if(!this.shouldForceSelection(E))return;E.stopPropagation()}E.preventDefault(),this._dragScrollAmount=0,this._enabled&&E.shiftKey?this._onIncrementalClick(E):E.detail===1?this._onSingleClick(E):E.detail===2?this._onDoubleClick(E):E.detail===3&&this._onTripleClick(E),this._addMouseDownListeners(),this.refresh(!0)}},R.prototype._addMouseDownListeners=function(){var E=this;this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=window.setInterval(function(){return E._dragScroll()},50)},R.prototype._removeMouseDownListeners=function(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0},R.prototype._onIncrementalClick=function(E){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(E))},R.prototype._onSingleClick=function(E){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(E)?3:0,this._model.selectionStart=this._getMouseBufferCoords(E),this._model.selectionStart){this._model.selectionEnd=void 0;var T=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);T&&T.length!==this._model.selectionStart[0]&&T.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}},R.prototype._onDoubleClick=function(E){this._selectWordAtCursor(E,!0)&&(this._activeSelectionMode=1)},R.prototype._onTripleClick=function(E){var T=this._getMouseBufferCoords(E);T&&(this._activeSelectionMode=2,this._selectLineAt(T[1]))},R.prototype.shouldColumnSelect=function(E){return E.altKey&&!(u.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)},R.prototype._onMouseMove=function(E){if(E.stopImmediatePropagation(),this._model.selectionStart){var T=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(E),this._model.selectionEnd){this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(E),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));var A=this._bufferService.buffer;if(this._model.selectionEnd[1]<A.lines.length){var C=A.lines.get(this._model.selectionEnd[1]);C&&C.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}T&&T[0]===this._model.selectionEnd[0]&&T[1]===this._model.selectionEnd[1]||this.refresh(!0)}else this.refresh(!0)}},R.prototype._dragScroll=function(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});var E=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(E.ydisp+this._bufferService.rows,E.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=E.ydisp),this.refresh()}},R.prototype._onMouseUp=function(E){var T=E.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&T<500&&E.altKey&&this._optionsService.getOption("altClickMovesCursor")){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){var A=this._mouseService.getCoords(E,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(A&&A[0]!==void 0&&A[1]!==void 0){var C=(0,p.moveToCellSequence)(A[0]-1,A[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(C,!0)}}}else this._fireEventIfSelectionChanged()},R.prototype._fireEventIfSelectionChanged=function(){var E=this._model.finalSelectionStart,T=this._model.finalSelectionEnd,A=!(!E||!T||E[0]===T[0]&&E[1]===T[1]);A?E&&T&&(this._oldSelectionStart&&this._oldSelectionEnd&&E[0]===this._oldSelectionStart[0]&&E[1]===this._oldSelectionStart[1]&&T[0]===this._oldSelectionEnd[0]&&T[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(E,T,A)):this._oldHasSelection&&this._fireOnSelectionChange(E,T,A)},R.prototype._fireOnSelectionChange=function(E,T,A){this._oldSelectionStart=E,this._oldSelectionEnd=T,this._oldHasSelection=A,this._onSelectionChange.fire()},R.prototype._onBufferActivate=function(E){var T=this;this.clearSelection(),this._trimListener.dispose(),this._trimListener=E.activeBuffer.lines.onTrim(function(A){return T._onTrim(A)})},R.prototype._convertViewportColToCharacterIndex=function(E,T){for(var A=T[0],C=0;T[0]>=C;C++){var M=E.loadCell(C,this._workCell).getChars().length;this._workCell.getWidth()===0?A--:M>1&&T[0]!==C&&(A+=M-1)}return A},R.prototype.setSelection=function(E,T,A){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[E,T],this._model.selectionStartLength=A,this.refresh(),this._fireEventIfSelectionChanged()},R.prototype.rightClickSelect=function(E){this._isClickInSelection(E)||(this._selectWordAtCursor(E,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())},R.prototype._getWordAt=function(E,T,A,C){if(A===void 0&&(A=!0),C===void 0&&(C=!0),!(E[0]>=this._bufferService.cols)){var M=this._bufferService.buffer,D=M.lines.get(E[1]);if(D){var O=M.translateBufferLineToString(E[1],!1),P=this._convertViewportColToCharacterIndex(D,E),L=P,I=E[0]-P,k=0,B=0,F=0,W=0;if(O.charAt(P)===" "){for(;P>0&&O.charAt(P-1)===" ";)P--;for(;L<O.length&&O.charAt(L+1)===" ";)L++}else{var V=E[0],N=E[0];D.getWidth(V)===0&&(k++,V--),D.getWidth(N)===2&&(B++,N++);var ne=D.getString(N).length;for(ne>1&&(W+=ne-1,L+=ne-1);V>0&&P>0&&!this._isCharWordSeparator(D.loadCell(V-1,this._workCell));){D.loadCell(V-1,this._workCell);var ie=this._workCell.getChars().length;this._workCell.getWidth()===0?(k++,V--):ie>1&&(F+=ie-1,P-=ie-1),P--,V--}for(;N<D.length&&L+1<O.length&&!this._isCharWordSeparator(D.loadCell(N+1,this._workCell));){D.loadCell(N+1,this._workCell);var Q=this._workCell.getChars().length;this._workCell.getWidth()===2?(B++,N++):Q>1&&(W+=Q-1,L+=Q-1),L++,N++}}L++;var K=P+I-k+F,de=Math.min(this._bufferService.cols,L-P+k+B-F-W);if(T||O.slice(P,L).trim()!==""){if(A&&K===0&&D.getCodePoint(0)!==32){var re=M.lines.get(E[1]-1);if(re&&D.isWrapped&&re.getCodePoint(this._bufferService.cols-1)!==32){var Y=this._getWordAt([this._bufferService.cols-1,E[1]-1],!1,!0,!1);if(Y){var U=this._bufferService.cols-Y.start;K-=U,de+=U}}}if(C&&K+de===this._bufferService.cols&&D.getCodePoint(this._bufferService.cols-1)!==32){var z=M.lines.get(E[1]+1);if(z!=null&&z.isWrapped&&z.getCodePoint(0)!==32){var te=this._getWordAt([0,E[1]+1],!1,!1,!0);te&&(de+=te.length)}}return{start:K,length:de}}}}},R.prototype._selectWordAt=function(E,T){var A=this._getWordAt(E,T);if(A){for(;A.start<0;)A.start+=this._bufferService.cols,E[1]--;this._model.selectionStart=[A.start,E[1]],this._model.selectionStartLength=A.length}},R.prototype._selectToWordAt=function(E){var T=this._getWordAt(E,!0);if(T){for(var A=E[1];T.start<0;)T.start+=this._bufferService.cols,A--;if(!this._model.areSelectionValuesReversed())for(;T.start+T.length>this._bufferService.cols;)T.length-=this._bufferService.cols,A++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?T.start:T.start+T.length,A]}},R.prototype._isCharWordSeparator=function(E){return E.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(E.getChars())>=0},R.prototype._selectLineAt=function(E){var T=this._bufferService.buffer.getWrappedRangeForLine(E),A={start:{x:0,y:T.first},end:{x:this._bufferService.cols-1,y:T.last}};this._model.selectionStart=[0,T.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,x.getRangeLength)(A,this._bufferService.cols)},l([h(3,v.IBufferService),h(4,v.ICoreService),h(5,m.IMouseService),h(6,v.IOptionsService),h(7,m.IRenderService)],R)}(_.Disposable);r.SelectionService=w},4725:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ICharacterJoinerService=r.ISoundService=r.ISelectionService=r.IRenderService=r.IMouseService=r.ICoreBrowserService=r.ICharSizeService=void 0;var o=n(8343);r.ICharSizeService=(0,o.createDecorator)("CharSizeService"),r.ICoreBrowserService=(0,o.createDecorator)("CoreBrowserService"),r.IMouseService=(0,o.createDecorator)("MouseService"),r.IRenderService=(0,o.createDecorator)("RenderService"),r.ISelectionService=(0,o.createDecorator)("SelectionService"),r.ISoundService=(0,o.createDecorator)("SoundService"),r.ICharacterJoinerService=(0,o.createDecorator)("CharacterJoinerService")},357:function(i,r,n){var o=this&&this.__decorate||function(u,c,f,d){var m,v=arguments.length,g=v<3?c:d===null?d=Object.getOwnPropertyDescriptor(c,f):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(u,c,f,d);else for(var p=u.length-1;p>=0;p--)(m=u[p])&&(g=(v<3?m(g):v>3?m(c,f,g):m(c,f))||g);return v>3&&g&&Object.defineProperty(c,f,g),g},a=this&&this.__param||function(u,c){return function(f,d){c(f,d,u)}};Object.defineProperty(r,"__esModule",{value:!0}),r.SoundService=void 0;var l=n(2585),h=function(){function u(c){this._optionsService=c}return Object.defineProperty(u,"audioContext",{get:function(){if(!u._audioContext){var c=window.AudioContext||window.webkitAudioContext;if(!c)return console.warn("Web Audio API is not supported by this browser. Consider upgrading to the latest version"),null;u._audioContext=new c}return u._audioContext},enumerable:!1,configurable:!0}),u.prototype.playBellSound=function(){var c=u.audioContext;if(c){var f=c.createBufferSource();c.decodeAudioData(this._base64ToArrayBuffer(this._removeMimeType(this._optionsService.rawOptions.bellSound)),function(d){f.buffer=d,f.connect(c.destination),f.start(0)})}},u.prototype._base64ToArrayBuffer=function(c){for(var f=window.atob(c),d=f.length,m=new Uint8Array(d),v=0;v<d;v++)m[v]=f.charCodeAt(v);return m.buffer},u.prototype._removeMimeType=function(c){return c.split(",")[1]},u=o([a(0,l.IOptionsService)],u)}();r.SoundService=h},6349:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CircularList=void 0;var o=n(8460),a=function(){function l(h){this._maxLength=h,this.onDeleteEmitter=new o.EventEmitter,this.onInsertEmitter=new o.EventEmitter,this.onTrimEmitter=new o.EventEmitter,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}return Object.defineProperty(l.prototype,"onDelete",{get:function(){return this.onDeleteEmitter.event},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onInsert",{get:function(){return this.onInsertEmitter.event},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onTrim",{get:function(){return this.onTrimEmitter.event},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"maxLength",{get:function(){return this._maxLength},set:function(h){if(this._maxLength!==h){for(var u=new Array(h),c=0;c<Math.min(h,this.length);c++)u[c]=this._array[this._getCyclicIndex(c)];this._array=u,this._maxLength=h,this._startIndex=0}},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"length",{get:function(){return this._length},set:function(h){if(h>this._length)for(var u=this._length;u<h;u++)this._array[u]=void 0;this._length=h},enumerable:!1,configurable:!0}),l.prototype.get=function(h){return this._array[this._getCyclicIndex(h)]},l.prototype.set=function(h,u){this._array[this._getCyclicIndex(h)]=u},l.prototype.push=function(h){this._array[this._getCyclicIndex(this._length)]=h,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++},l.prototype.recycle=function(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]},Object.defineProperty(l.prototype,"isFull",{get:function(){return this._length===this._maxLength},enumerable:!1,configurable:!0}),l.prototype.pop=function(){return this._array[this._getCyclicIndex(this._length---1)]},l.prototype.splice=function(h,u){for(var c=[],f=2;f<arguments.length;f++)c[f-2]=arguments[f];if(u){for(var d=h;d<this._length-u;d++)this._array[this._getCyclicIndex(d)]=this._array[this._getCyclicIndex(d+u)];this._length-=u,this.onDeleteEmitter.fire({index:h,amount:u})}for(d=this._length-1;d>=h;d--)this._array[this._getCyclicIndex(d+c.length)]=this._array[this._getCyclicIndex(d)];for(d=0;d<c.length;d++)this._array[this._getCyclicIndex(h+d)]=c[d];if(c.length&&this.onInsertEmitter.fire({index:h,amount:c.length}),this._length+c.length>this._maxLength){var m=this._length+c.length-this._maxLength;this._startIndex+=m,this._length=this._maxLength,this.onTrimEmitter.fire(m)}else this._length+=c.length},l.prototype.trimStart=function(h){h>this._length&&(h=this._length),this._startIndex+=h,this._length-=h,this.onTrimEmitter.fire(h)},l.prototype.shiftElements=function(h,u,c){if(!(u<=0)){if(h<0||h>=this._length)throw new Error("start argument out of range");if(h+c<0)throw new Error("Cannot shift elements in list beyond index 0");if(c>0){for(var f=u-1;f>=0;f--)this.set(h+f+c,this.get(h+f));var d=h+u+c-this._length;if(d>0)for(this._length+=d;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(f=0;f<u;f++)this.set(h+f+c,this.get(h+f))}},l.prototype._getCyclicIndex=function(h){return(this._startIndex+h)%this._maxLength},l}();r.CircularList=a},1439:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function n(o,a){if(a===void 0&&(a=5),typeof o!="object")return o;var l=Array.isArray(o)?[]:{};for(var h in o)l[h]=a<=1?o[h]:o[h]&&n(o[h],a-1);return l}},8055:function(i,r){var n,o,a,l,h=this&&this.__read||function(f,d){var m=typeof Symbol=="function"&&f[Symbol.iterator];if(!m)return f;var v,g,p=m.call(f),_=[];try{for(;(d===void 0||d-- >0)&&!(v=p.next()).done;)_.push(v.value)}catch(x){g={error:x}}finally{try{v&&!v.done&&(m=p.return)&&m.call(p)}finally{if(g)throw g.error}}return _};function u(f){var d=f.toString(16);return d.length<2?"0"+d:d}function c(f,d){return f<d?(d+.05)/(f+.05):(f+.05)/(d+.05)}Object.defineProperty(r,"__esModule",{value:!0}),r.contrastRatio=r.toPaddedHex=r.rgba=r.rgb=r.css=r.color=r.channels=void 0,function(f){f.toCss=function(d,m,v,g){return g!==void 0?"#"+u(d)+u(m)+u(v)+u(g):"#"+u(d)+u(m)+u(v)},f.toRgba=function(d,m,v,g){return g===void 0&&(g=255),(d<<24|m<<16|v<<8|g)>>>0}}(n=r.channels||(r.channels={})),(o=r.color||(r.color={})).blend=function(f,d){var m=(255&d.rgba)/255;if(m===1)return{css:d.css,rgba:d.rgba};var v=d.rgba>>24&255,g=d.rgba>>16&255,p=d.rgba>>8&255,_=f.rgba>>24&255,x=f.rgba>>16&255,b=f.rgba>>8&255,y=_+Math.round((v-_)*m),w=x+Math.round((g-x)*m),S=b+Math.round((p-b)*m);return{css:n.toCss(y,w,S),rgba:n.toRgba(y,w,S)}},o.isOpaque=function(f){return(255&f.rgba)==255},o.ensureContrastRatio=function(f,d,m){var v=l.ensureContrastRatio(f.rgba,d.rgba,m);if(v)return l.toColor(v>>24&255,v>>16&255,v>>8&255)},o.opaque=function(f){var d=(255|f.rgba)>>>0,m=h(l.toChannels(d),3),v=m[0],g=m[1],p=m[2];return{css:n.toCss(v,g,p),rgba:d}},o.opacity=function(f,d){var m=Math.round(255*d),v=h(l.toChannels(f.rgba),3),g=v[0],p=v[1],_=v[2];return{css:n.toCss(g,p,_,m),rgba:n.toRgba(g,p,_,m)}},o.toColorRGB=function(f){return[f.rgba>>24&255,f.rgba>>16&255,f.rgba>>8&255]},(r.css||(r.css={})).toColor=function(f){if(f.match(/#[0-9a-f]{3,8}/i))switch(f.length){case 4:var d=parseInt(f.slice(1,2).repeat(2),16),m=parseInt(f.slice(2,3).repeat(2),16),v=parseInt(f.slice(3,4).repeat(2),16);return l.toColor(d,m,v);case 5:d=parseInt(f.slice(1,2).repeat(2),16),m=parseInt(f.slice(2,3).repeat(2),16),v=parseInt(f.slice(3,4).repeat(2),16);var g=parseInt(f.slice(4,5).repeat(2),16);return l.toColor(d,m,v,g);case 7:return{css:f,rgba:(parseInt(f.slice(1),16)<<8|255)>>>0};case 9:return{css:f,rgba:parseInt(f.slice(1),16)>>>0}}var p=f.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(p)return d=parseInt(p[1]),m=parseInt(p[2]),v=parseInt(p[3]),g=Math.round(255*(p[5]===void 0?1:parseFloat(p[5]))),l.toColor(d,m,v,g);throw new Error("css.toColor: Unsupported css format")},function(f){function d(m,v,g){var p=m/255,_=v/255,x=g/255;return .2126*(p<=.03928?p/12.92:Math.pow((p+.055)/1.055,2.4))+.7152*(_<=.03928?_/12.92:Math.pow((_+.055)/1.055,2.4))+.0722*(x<=.03928?x/12.92:Math.pow((x+.055)/1.055,2.4))}f.relativeLuminance=function(m){return d(m>>16&255,m>>8&255,255&m)},f.relativeLuminance2=d}(a=r.rgb||(r.rgb={})),function(f){function d(v,g,p){for(var _=v>>24&255,x=v>>16&255,b=v>>8&255,y=g>>24&255,w=g>>16&255,S=g>>8&255,R=c(a.relativeLuminance2(y,w,S),a.relativeLuminance2(_,x,b));R<p&&(y>0||w>0||S>0);)y-=Math.max(0,Math.ceil(.1*y)),w-=Math.max(0,Math.ceil(.1*w)),S-=Math.max(0,Math.ceil(.1*S)),R=c(a.relativeLuminance2(y,w,S),a.relativeLuminance2(_,x,b));return(y<<24|w<<16|S<<8|255)>>>0}function m(v,g,p){for(var _=v>>24&255,x=v>>16&255,b=v>>8&255,y=g>>24&255,w=g>>16&255,S=g>>8&255,R=c(a.relativeLuminance2(y,w,S),a.relativeLuminance2(_,x,b));R<p&&(y<255||w<255||S<255);)y=Math.min(255,y+Math.ceil(.1*(255-y))),w=Math.min(255,w+Math.ceil(.1*(255-w))),S=Math.min(255,S+Math.ceil(.1*(255-S))),R=c(a.relativeLuminance2(y,w,S),a.relativeLuminance2(_,x,b));return(y<<24|w<<16|S<<8|255)>>>0}f.ensureContrastRatio=function(v,g,p){var _=a.relativeLuminance(v>>8),x=a.relativeLuminance(g>>8);if(c(_,x)<p){if(x<_){var b=d(v,g,p),y=c(_,a.relativeLuminance(b>>8));if(y<p){var w=m(v,v,p);return y>c(_,a.relativeLuminance(w>>8))?b:w}return b}var S=m(v,g,p),R=c(_,a.relativeLuminance(S>>8));return R<p?(w=d(v,v,p),R>c(_,a.relativeLuminance(w>>8))?S:w):S}},f.reduceLuminance=d,f.increaseLuminance=m,f.toChannels=function(v){return[v>>24&255,v>>16&255,v>>8&255,255&v]},f.toColor=function(v,g,p,_){return{css:n.toCss(v,g,p,_),rgba:n.toRgba(v,g,p,_)}}}(l=r.rgba||(r.rgba={})),r.toPaddedHex=u,r.contrastRatio=c},8969:function(i,r,n){var o,a=this&&this.__extends||(o=function(T,A){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,M){C.__proto__=M}||function(C,M){for(var D in M)Object.prototype.hasOwnProperty.call(M,D)&&(C[D]=M[D])},o(T,A)},function(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function C(){this.constructor=T}o(T,A),T.prototype=A===null?Object.create(A):(C.prototype=A.prototype,new C)}),l=this&&this.__values||function(T){var A=typeof Symbol=="function"&&Symbol.iterator,C=A&&T[A],M=0;if(C)return C.call(T);if(T&&typeof T.length=="number")return{next:function(){return T&&M>=T.length&&(T=void 0),{value:T&&T[M++],done:!T}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreTerminal=void 0;var h=n(844),u=n(2585),c=n(4348),f=n(7866),d=n(744),m=n(7302),v=n(6975),g=n(8460),p=n(1753),_=n(3730),x=n(1480),b=n(7994),y=n(9282),w=n(5435),S=n(5981),R=!1,E=function(T){function A(C){var M=T.call(this)||this;return M._onBinary=new g.EventEmitter,M._onData=new g.EventEmitter,M._onLineFeed=new g.EventEmitter,M._onResize=new g.EventEmitter,M._onScroll=new g.EventEmitter,M._onWriteParsed=new g.EventEmitter,M._instantiationService=new c.InstantiationService,M.optionsService=new m.OptionsService(C),M._instantiationService.setService(u.IOptionsService,M.optionsService),M._bufferService=M.register(M._instantiationService.createInstance(d.BufferService)),M._instantiationService.setService(u.IBufferService,M._bufferService),M._logService=M._instantiationService.createInstance(f.LogService),M._instantiationService.setService(u.ILogService,M._logService),M.coreService=M.register(M._instantiationService.createInstance(v.CoreService,function(){return M.scrollToBottom()})),M._instantiationService.setService(u.ICoreService,M.coreService),M.coreMouseService=M._instantiationService.createInstance(p.CoreMouseService),M._instantiationService.setService(u.ICoreMouseService,M.coreMouseService),M._dirtyRowService=M._instantiationService.createInstance(_.DirtyRowService),M._instantiationService.setService(u.IDirtyRowService,M._dirtyRowService),M.unicodeService=M._instantiationService.createInstance(x.UnicodeService),M._instantiationService.setService(u.IUnicodeService,M.unicodeService),M._charsetService=M._instantiationService.createInstance(b.CharsetService),M._instantiationService.setService(u.ICharsetService,M._charsetService),M._inputHandler=new w.InputHandler(M._bufferService,M._charsetService,M.coreService,M._dirtyRowService,M._logService,M.optionsService,M.coreMouseService,M.unicodeService),M.register((0,g.forwardEvent)(M._inputHandler.onLineFeed,M._onLineFeed)),M.register(M._inputHandler),M.register((0,g.forwardEvent)(M._bufferService.onResize,M._onResize)),M.register((0,g.forwardEvent)(M.coreService.onData,M._onData)),M.register((0,g.forwardEvent)(M.coreService.onBinary,M._onBinary)),M.register(M.optionsService.onOptionChange(function(D){return M._updateOptions(D)})),M.register(M._bufferService.onScroll(function(D){M._onScroll.fire({position:M._bufferService.buffer.ydisp,source:0}),M._dirtyRowService.markRangeDirty(M._bufferService.buffer.scrollTop,M._bufferService.buffer.scrollBottom)})),M.register(M._inputHandler.onScroll(function(D){M._onScroll.fire({position:M._bufferService.buffer.ydisp,source:0}),M._dirtyRowService.markRangeDirty(M._bufferService.buffer.scrollTop,M._bufferService.buffer.scrollBottom)})),M._writeBuffer=new S.WriteBuffer(function(D,O){return M._inputHandler.parse(D,O)}),M.register((0,g.forwardEvent)(M._writeBuffer.onWriteParsed,M._onWriteParsed)),M}return a(A,T),Object.defineProperty(A.prototype,"onBinary",{get:function(){return this._onBinary.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onData",{get:function(){return this._onData.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onLineFeed",{get:function(){return this._onLineFeed.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onResize",{get:function(){return this._onResize.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onWriteParsed",{get:function(){return this._onWriteParsed.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onScroll",{get:function(){var C=this;return this._onScrollApi||(this._onScrollApi=new g.EventEmitter,this.register(this._onScroll.event(function(M){var D;(D=C._onScrollApi)===null||D===void 0||D.fire(M.position)}))),this._onScrollApi.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"cols",{get:function(){return this._bufferService.cols},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"rows",{get:function(){return this._bufferService.rows},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"buffers",{get:function(){return this._bufferService.buffers},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"options",{get:function(){return this.optionsService.options},set:function(C){for(var M in C)this.optionsService.options[M]=C[M]},enumerable:!1,configurable:!0}),A.prototype.dispose=function(){var C;this._isDisposed||(T.prototype.dispose.call(this),(C=this._windowsMode)===null||C===void 0||C.dispose(),this._windowsMode=void 0)},A.prototype.write=function(C,M){this._writeBuffer.write(C,M)},A.prototype.writeSync=function(C,M){this._logService.logLevel<=u.LogLevelEnum.WARN&&!R&&(this._logService.warn("writeSync is unreliable and will be removed soon."),R=!0),this._writeBuffer.writeSync(C,M)},A.prototype.resize=function(C,M){isNaN(C)||isNaN(M)||(C=Math.max(C,d.MINIMUM_COLS),M=Math.max(M,d.MINIMUM_ROWS),this._bufferService.resize(C,M))},A.prototype.scroll=function(C,M){M===void 0&&(M=!1),this._bufferService.scroll(C,M)},A.prototype.scrollLines=function(C,M,D){this._bufferService.scrollLines(C,M,D)},A.prototype.scrollPages=function(C){this._bufferService.scrollPages(C)},A.prototype.scrollToTop=function(){this._bufferService.scrollToTop()},A.prototype.scrollToBottom=function(){this._bufferService.scrollToBottom()},A.prototype.scrollToLine=function(C){this._bufferService.scrollToLine(C)},A.prototype.registerEscHandler=function(C,M){return this._inputHandler.registerEscHandler(C,M)},A.prototype.registerDcsHandler=function(C,M){return this._inputHandler.registerDcsHandler(C,M)},A.prototype.registerCsiHandler=function(C,M){return this._inputHandler.registerCsiHandler(C,M)},A.prototype.registerOscHandler=function(C,M){return this._inputHandler.registerOscHandler(C,M)},A.prototype._setup=function(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()},A.prototype.reset=function(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()},A.prototype._updateOptions=function(C){var M;switch(C){case"scrollback":this.buffers.resize(this.cols,this.rows);break;case"windowsMode":this.optionsService.rawOptions.windowsMode?this._enableWindowsMode():((M=this._windowsMode)===null||M===void 0||M.dispose(),this._windowsMode=void 0)}},A.prototype._enableWindowsMode=function(){var C=this;if(!this._windowsMode){var M=[];M.push(this.onLineFeed(y.updateWindowsModeWrappedState.bind(null,this._bufferService))),M.push(this.registerCsiHandler({final:"H"},function(){return(0,y.updateWindowsModeWrappedState)(C._bufferService),!1})),this._windowsMode={dispose:function(){var D,O;try{for(var P=l(M),L=P.next();!L.done;L=P.next())L.value.dispose()}catch(I){D={error:I}}finally{try{L&&!L.done&&(O=P.return)&&O.call(P)}finally{if(D)throw D.error}}}}}},A}(h.Disposable);r.CoreTerminal=E},8460:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.forwardEvent=r.EventEmitter=void 0;var n=function(){function o(){this._listeners=[],this._disposed=!1}return Object.defineProperty(o.prototype,"event",{get:function(){var a=this;return this._event||(this._event=function(l){return a._listeners.push(l),{dispose:function(){if(!a._disposed){for(var h=0;h<a._listeners.length;h++)if(a._listeners[h]===l)return void a._listeners.splice(h,1)}}}}),this._event},enumerable:!1,configurable:!0}),o.prototype.fire=function(a,l){for(var h=[],u=0;u<this._listeners.length;u++)h.push(this._listeners[u]);for(u=0;u<h.length;u++)h[u].call(void 0,a,l)},o.prototype.dispose=function(){this._listeners&&(this._listeners.length=0),this._disposed=!0},o}();r.EventEmitter=n,r.forwardEvent=function(o,a){return o(function(l){return a.fire(l)})}},5435:function(i,r,n){var o,a=this&&this.__extends||(o=function(M,D){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,P){O.__proto__=P}||function(O,P){for(var L in P)Object.prototype.hasOwnProperty.call(P,L)&&(O[L]=P[L])},o(M,D)},function(M,D){if(typeof D!="function"&&D!==null)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function O(){this.constructor=M}o(M,D),M.prototype=D===null?Object.create(D):(O.prototype=D.prototype,new O)});Object.defineProperty(r,"__esModule",{value:!0}),r.InputHandler=r.WindowsOptionsReportType=void 0;var l,h=n(2584),u=n(7116),c=n(2015),f=n(844),d=n(8273),m=n(482),v=n(8437),g=n(8460),p=n(643),_=n(511),x=n(3734),b=n(2585),y=n(6242),w=n(6351),S=n(5941),R={"(":0,")":1,"*":2,"+":3,"-":1,".":2},E=131072;function T(M,D){if(M>24)return D.setWinLines||!1;switch(M){case 1:return!!D.restoreWin;case 2:return!!D.minimizeWin;case 3:return!!D.setWinPosition;case 4:return!!D.setWinSizePixels;case 5:return!!D.raiseWin;case 6:return!!D.lowerWin;case 7:return!!D.refreshWin;case 8:return!!D.setWinSizeChars;case 9:return!!D.maximizeWin;case 10:return!!D.fullscreenWin;case 11:return!!D.getWinState;case 13:return!!D.getWinPosition;case 14:return!!D.getWinSizePixels;case 15:return!!D.getScreenSizePixels;case 16:return!!D.getCellSizePixels;case 18:return!!D.getWinSizeChars;case 19:return!!D.getScreenSizeChars;case 20:return!!D.getIconTitle;case 21:return!!D.getWinTitle;case 22:return!!D.pushTitle;case 23:return!!D.popTitle;case 24:return!!D.setWinLines}return!1}(function(M){M[M.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",M[M.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(l=r.WindowsOptionsReportType||(r.WindowsOptionsReportType={}));var A=function(){function M(D,O,P,L){this._bufferService=D,this._coreService=O,this._logService=P,this._optionsService=L,this._data=new Uint32Array(0)}return M.prototype.hook=function(D){this._data=new Uint32Array(0)},M.prototype.put=function(D,O,P){this._data=(0,d.concat)(this._data,D.subarray(O,P))},M.prototype.unhook=function(D){if(!D)return this._data=new Uint32Array(0),!0;var O=(0,m.utf32ToString)(this._data);switch(this._data=new Uint32Array(0),O){case'"q':this._coreService.triggerDataEvent(h.C0.ESC+'P1$r0"q'+h.C0.ESC+"\\");break;case'"p':this._coreService.triggerDataEvent(h.C0.ESC+'P1$r61;1"p'+h.C0.ESC+"\\");break;case"r":var P=this._bufferService.buffer.scrollTop+1+";"+(this._bufferService.buffer.scrollBottom+1)+"r";this._coreService.triggerDataEvent(h.C0.ESC+"P1$r"+P+h.C0.ESC+"\\");break;case"m":this._coreService.triggerDataEvent(h.C0.ESC+"P1$r0m"+h.C0.ESC+"\\");break;case" q":var L={block:2,underline:4,bar:6}[this._optionsService.rawOptions.cursorStyle];L-=this._optionsService.rawOptions.cursorBlink?1:0,this._coreService.triggerDataEvent(h.C0.ESC+"P1$r"+L+" q"+h.C0.ESC+"\\");break;default:this._logService.debug("Unknown DCS $q %s",O),this._coreService.triggerDataEvent(h.C0.ESC+"P0$r"+h.C0.ESC+"\\")}return!0},M}(),C=function(M){function D(O,P,L,I,k,B,F,W,V){V===void 0&&(V=new c.EscapeSequenceParser);var N=M.call(this)||this;N._bufferService=O,N._charsetService=P,N._coreService=L,N._dirtyRowService=I,N._logService=k,N._optionsService=B,N._coreMouseService=F,N._unicodeService=W,N._parser=V,N._parseBuffer=new Uint32Array(4096),N._stringDecoder=new m.StringToUtf32,N._utf8Decoder=new m.Utf8ToUtf32,N._workCell=new _.CellData,N._windowTitle="",N._iconName="",N._windowTitleStack=[],N._iconNameStack=[],N._curAttrData=v.DEFAULT_ATTR_DATA.clone(),N._eraseAttrDataInternal=v.DEFAULT_ATTR_DATA.clone(),N._onRequestBell=new g.EventEmitter,N._onRequestRefreshRows=new g.EventEmitter,N._onRequestReset=new g.EventEmitter,N._onRequestSendFocus=new g.EventEmitter,N._onRequestSyncScrollBar=new g.EventEmitter,N._onRequestWindowsOptionsReport=new g.EventEmitter,N._onA11yChar=new g.EventEmitter,N._onA11yTab=new g.EventEmitter,N._onCursorMove=new g.EventEmitter,N._onLineFeed=new g.EventEmitter,N._onScroll=new g.EventEmitter,N._onTitleChange=new g.EventEmitter,N._onColor=new g.EventEmitter,N._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},N._specialColors=[256,257,258],N.register(N._parser),N._activeBuffer=N._bufferService.buffer,N.register(N._bufferService.buffers.onBufferActivate(function(K){return N._activeBuffer=K.activeBuffer})),N._parser.setCsiHandlerFallback(function(K,de){N._logService.debug("Unknown CSI code: ",{identifier:N._parser.identToString(K),params:de.toArray()})}),N._parser.setEscHandlerFallback(function(K){N._logService.debug("Unknown ESC code: ",{identifier:N._parser.identToString(K)})}),N._parser.setExecuteHandlerFallback(function(K){N._logService.debug("Unknown EXECUTE code: ",{code:K})}),N._parser.setOscHandlerFallback(function(K,de,re){N._logService.debug("Unknown OSC code: ",{identifier:K,action:de,data:re})}),N._parser.setDcsHandlerFallback(function(K,de,re){de==="HOOK"&&(re=re.toArray()),N._logService.debug("Unknown DCS code: ",{identifier:N._parser.identToString(K),action:de,payload:re})}),N._parser.setPrintHandler(function(K,de,re){return N.print(K,de,re)}),N._parser.registerCsiHandler({final:"@"},function(K){return N.insertChars(K)}),N._parser.registerCsiHandler({intermediates:" ",final:"@"},function(K){return N.scrollLeft(K)}),N._parser.registerCsiHandler({final:"A"},function(K){return N.cursorUp(K)}),N._parser.registerCsiHandler({intermediates:" ",final:"A"},function(K){return N.scrollRight(K)}),N._parser.registerCsiHandler({final:"B"},function(K){return N.cursorDown(K)}),N._parser.registerCsiHandler({final:"C"},function(K){return N.cursorForward(K)}),N._parser.registerCsiHandler({final:"D"},function(K){return N.cursorBackward(K)}),N._parser.registerCsiHandler({final:"E"},function(K){return N.cursorNextLine(K)}),N._parser.registerCsiHandler({final:"F"},function(K){return N.cursorPrecedingLine(K)}),N._parser.registerCsiHandler({final:"G"},function(K){return N.cursorCharAbsolute(K)}),N._parser.registerCsiHandler({final:"H"},function(K){return N.cursorPosition(K)}),N._parser.registerCsiHandler({final:"I"},function(K){return N.cursorForwardTab(K)}),N._parser.registerCsiHandler({final:"J"},function(K){return N.eraseInDisplay(K)}),N._parser.registerCsiHandler({prefix:"?",final:"J"},function(K){return N.eraseInDisplay(K)}),N._parser.registerCsiHandler({final:"K"},function(K){return N.eraseInLine(K)}),N._parser.registerCsiHandler({prefix:"?",final:"K"},function(K){return N.eraseInLine(K)}),N._parser.registerCsiHandler({final:"L"},function(K){return N.insertLines(K)}),N._parser.registerCsiHandler({final:"M"},function(K){return N.deleteLines(K)}),N._parser.registerCsiHandler({final:"P"},function(K){return N.deleteChars(K)}),N._parser.registerCsiHandler({final:"S"},function(K){return N.scrollUp(K)}),N._parser.registerCsiHandler({final:"T"},function(K){return N.scrollDown(K)}),N._parser.registerCsiHandler({final:"X"},function(K){return N.eraseChars(K)}),N._parser.registerCsiHandler({final:"Z"},function(K){return N.cursorBackwardTab(K)}),N._parser.registerCsiHandler({final:"`"},function(K){return N.charPosAbsolute(K)}),N._parser.registerCsiHandler({final:"a"},function(K){return N.hPositionRelative(K)}),N._parser.registerCsiHandler({final:"b"},function(K){return N.repeatPrecedingCharacter(K)}),N._parser.registerCsiHandler({final:"c"},function(K){return N.sendDeviceAttributesPrimary(K)}),N._parser.registerCsiHandler({prefix:">",final:"c"},function(K){return N.sendDeviceAttributesSecondary(K)}),N._parser.registerCsiHandler({final:"d"},function(K){return N.linePosAbsolute(K)}),N._parser.registerCsiHandler({final:"e"},function(K){return N.vPositionRelative(K)}),N._parser.registerCsiHandler({final:"f"},function(K){return N.hVPosition(K)}),N._parser.registerCsiHandler({final:"g"},function(K){return N.tabClear(K)}),N._parser.registerCsiHandler({final:"h"},function(K){return N.setMode(K)}),N._parser.registerCsiHandler({prefix:"?",final:"h"},function(K){return N.setModePrivate(K)}),N._parser.registerCsiHandler({final:"l"},function(K){return N.resetMode(K)}),N._parser.registerCsiHandler({prefix:"?",final:"l"},function(K){return N.resetModePrivate(K)}),N._parser.registerCsiHandler({final:"m"},function(K){return N.charAttributes(K)}),N._parser.registerCsiHandler({final:"n"},function(K){return N.deviceStatus(K)}),N._parser.registerCsiHandler({prefix:"?",final:"n"},function(K){return N.deviceStatusPrivate(K)}),N._parser.registerCsiHandler({intermediates:"!",final:"p"},function(K){return N.softReset(K)}),N._parser.registerCsiHandler({intermediates:" ",final:"q"},function(K){return N.setCursorStyle(K)}),N._parser.registerCsiHandler({final:"r"},function(K){return N.setScrollRegion(K)}),N._parser.registerCsiHandler({final:"s"},function(K){return N.saveCursor(K)}),N._parser.registerCsiHandler({final:"t"},function(K){return N.windowOptions(K)}),N._parser.registerCsiHandler({final:"u"},function(K){return N.restoreCursor(K)}),N._parser.registerCsiHandler({intermediates:"'",final:"}"},function(K){return N.insertColumns(K)}),N._parser.registerCsiHandler({intermediates:"'",final:"~"},function(K){return N.deleteColumns(K)}),N._parser.setExecuteHandler(h.C0.BEL,function(){return N.bell()}),N._parser.setExecuteHandler(h.C0.LF,function(){return N.lineFeed()}),N._parser.setExecuteHandler(h.C0.VT,function(){return N.lineFeed()}),N._parser.setExecuteHandler(h.C0.FF,function(){return N.lineFeed()}),N._parser.setExecuteHandler(h.C0.CR,function(){return N.carriageReturn()}),N._parser.setExecuteHandler(h.C0.BS,function(){return N.backspace()}),N._parser.setExecuteHandler(h.C0.HT,function(){return N.tab()}),N._parser.setExecuteHandler(h.C0.SO,function(){return N.shiftOut()}),N._parser.setExecuteHandler(h.C0.SI,function(){return N.shiftIn()}),N._parser.setExecuteHandler(h.C1.IND,function(){return N.index()}),N._parser.setExecuteHandler(h.C1.NEL,function(){return N.nextLine()}),N._parser.setExecuteHandler(h.C1.HTS,function(){return N.tabSet()}),N._parser.registerOscHandler(0,new y.OscHandler(function(K){return N.setTitle(K),N.setIconName(K),!0})),N._parser.registerOscHandler(1,new y.OscHandler(function(K){return N.setIconName(K)})),N._parser.registerOscHandler(2,new y.OscHandler(function(K){return N.setTitle(K)})),N._parser.registerOscHandler(4,new y.OscHandler(function(K){return N.setOrReportIndexedColor(K)})),N._parser.registerOscHandler(10,new y.OscHandler(function(K){return N.setOrReportFgColor(K)})),N._parser.registerOscHandler(11,new y.OscHandler(function(K){return N.setOrReportBgColor(K)})),N._parser.registerOscHandler(12,new y.OscHandler(function(K){return N.setOrReportCursorColor(K)})),N._parser.registerOscHandler(104,new y.OscHandler(function(K){return N.restoreIndexedColor(K)})),N._parser.registerOscHandler(110,new y.OscHandler(function(K){return N.restoreFgColor(K)})),N._parser.registerOscHandler(111,new y.OscHandler(function(K){return N.restoreBgColor(K)})),N._parser.registerOscHandler(112,new y.OscHandler(function(K){return N.restoreCursorColor(K)})),N._parser.registerEscHandler({final:"7"},function(){return N.saveCursor()}),N._parser.registerEscHandler({final:"8"},function(){return N.restoreCursor()}),N._parser.registerEscHandler({final:"D"},function(){return N.index()}),N._parser.registerEscHandler({final:"E"},function(){return N.nextLine()}),N._parser.registerEscHandler({final:"H"},function(){return N.tabSet()}),N._parser.registerEscHandler({final:"M"},function(){return N.reverseIndex()}),N._parser.registerEscHandler({final:"="},function(){return N.keypadApplicationMode()}),N._parser.registerEscHandler({final:">"},function(){return N.keypadNumericMode()}),N._parser.registerEscHandler({final:"c"},function(){return N.fullReset()}),N._parser.registerEscHandler({final:"n"},function(){return N.setgLevel(2)}),N._parser.registerEscHandler({final:"o"},function(){return N.setgLevel(3)}),N._parser.registerEscHandler({final:"|"},function(){return N.setgLevel(3)}),N._parser.registerEscHandler({final:"}"},function(){return N.setgLevel(2)}),N._parser.registerEscHandler({final:"~"},function(){return N.setgLevel(1)}),N._parser.registerEscHandler({intermediates:"%",final:"@"},function(){return N.selectDefaultCharset()}),N._parser.registerEscHandler({intermediates:"%",final:"G"},function(){return N.selectDefaultCharset()});var ne=function(K){ie._parser.registerEscHandler({intermediates:"(",final:K},function(){return N.selectCharset("("+K)}),ie._parser.registerEscHandler({intermediates:")",final:K},function(){return N.selectCharset(")"+K)}),ie._parser.registerEscHandler({intermediates:"*",final:K},function(){return N.selectCharset("*"+K)}),ie._parser.registerEscHandler({intermediates:"+",final:K},function(){return N.selectCharset("+"+K)}),ie._parser.registerEscHandler({intermediates:"-",final:K},function(){return N.selectCharset("-"+K)}),ie._parser.registerEscHandler({intermediates:".",final:K},function(){return N.selectCharset("."+K)}),ie._parser.registerEscHandler({intermediates:"/",final:K},function(){return N.selectCharset("/"+K)})},ie=this;for(var Q in u.CHARSETS)ne(Q);return N._parser.registerEscHandler({intermediates:"#",final:"8"},function(){return N.screenAlignmentPattern()}),N._parser.setErrorHandler(function(K){return N._logService.error("Parsing error: ",K),K}),N._parser.registerDcsHandler({intermediates:"$",final:"q"},new A(N._bufferService,N._coreService,N._logService,N._optionsService)),N}return a(D,M),Object.defineProperty(D.prototype,"onRequestBell",{get:function(){return this._onRequestBell.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onRequestRefreshRows",{get:function(){return this._onRequestRefreshRows.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onRequestReset",{get:function(){return this._onRequestReset.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onRequestSendFocus",{get:function(){return this._onRequestSendFocus.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onRequestSyncScrollBar",{get:function(){return this._onRequestSyncScrollBar.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onRequestWindowsOptionsReport",{get:function(){return this._onRequestWindowsOptionsReport.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onA11yChar",{get:function(){return this._onA11yChar.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onA11yTab",{get:function(){return this._onA11yTab.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onCursorMove",{get:function(){return this._onCursorMove.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onLineFeed",{get:function(){return this._onLineFeed.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onScroll",{get:function(){return this._onScroll.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onTitleChange",{get:function(){return this._onTitleChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"onColor",{get:function(){return this._onColor.event},enumerable:!1,configurable:!0}),D.prototype.dispose=function(){M.prototype.dispose.call(this)},D.prototype._preserveStack=function(O,P,L,I){this._parseStack.paused=!0,this._parseStack.cursorStartX=O,this._parseStack.cursorStartY=P,this._parseStack.decodedLength=L,this._parseStack.position=I},D.prototype._logSlowResolvingAsync=function(O){this._logService.logLevel<=b.LogLevelEnum.WARN&&Promise.race([O,new Promise(function(P,L){return setTimeout(function(){return L("#SLOW_TIMEOUT")},5e3)})]).catch(function(P){if(P!=="#SLOW_TIMEOUT")throw P;console.warn("async parser handler taking longer than 5000 ms")})},D.prototype.parse=function(O,P){var L,I=this._activeBuffer.x,k=this._activeBuffer.y,B=0,F=this._parseStack.paused;if(F){if(L=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,P))return this._logSlowResolvingAsync(L),L;I=this._parseStack.cursorStartX,k=this._parseStack.cursorStartY,this._parseStack.paused=!1,O.length>E&&(B=this._parseStack.position+E)}if(this._logService.logLevel<=b.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof O=="string"?' "'+O+'"':' "'+Array.prototype.map.call(O,function(ne){return String.fromCharCode(ne)}).join("")+'"'),typeof O=="string"?O.split("").map(function(ne){return ne.charCodeAt(0)}):O),this._parseBuffer.length<O.length&&this._parseBuffer.length<E&&(this._parseBuffer=new Uint32Array(Math.min(O.length,E))),F||this._dirtyRowService.clearRange(),O.length>E)for(var W=B;W<O.length;W+=E){var V=W+E<O.length?W+E:O.length,N=typeof O=="string"?this._stringDecoder.decode(O.substring(W,V),this._parseBuffer):this._utf8Decoder.decode(O.subarray(W,V),this._parseBuffer);if(L=this._parser.parse(this._parseBuffer,N))return this._preserveStack(I,k,N,W),this._logSlowResolvingAsync(L),L}else if(!F&&(N=typeof O=="string"?this._stringDecoder.decode(O,this._parseBuffer):this._utf8Decoder.decode(O,this._parseBuffer),L=this._parser.parse(this._parseBuffer,N)))return this._preserveStack(I,k,N,0),this._logSlowResolvingAsync(L),L;this._activeBuffer.x===I&&this._activeBuffer.y===k||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowService.start,this._dirtyRowService.end)},D.prototype.print=function(O,P,L){var I,k,B=this._charsetService.charset,F=this._optionsService.rawOptions.screenReaderMode,W=this._bufferService.cols,V=this._coreService.decPrivateModes.wraparound,N=this._coreService.modes.insertMode,ne=this._curAttrData,ie=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowService.markDirty(this._activeBuffer.y),this._activeBuffer.x&&L-P>0&&ie.getWidth(this._activeBuffer.x-1)===2&&ie.setCellFromCodePoint(this._activeBuffer.x-1,0,1,ne.fg,ne.bg,ne.extended);for(var Q=P;Q<L;++Q){if(I=O[Q],k=this._unicodeService.wcwidth(I),I<127&&B){var K=B[String.fromCharCode(I)];K&&(I=K.charCodeAt(0))}if(F&&this._onA11yChar.fire((0,m.stringFromCodePoint)(I)),k||!this._activeBuffer.x){if(this._activeBuffer.x+k-1>=W){if(V){for(;this._activeBuffer.x<W;)ie.setCellFromCodePoint(this._activeBuffer.x++,0,1,ne.fg,ne.bg,ne.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),ie=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=W-1,k===2)continue}if(N&&(ie.insertCells(this._activeBuffer.x,k,this._activeBuffer.getNullCell(ne),ne),ie.getWidth(W-1)===2&&ie.setCellFromCodePoint(W-1,p.NULL_CELL_CODE,p.NULL_CELL_WIDTH,ne.fg,ne.bg,ne.extended)),ie.setCellFromCodePoint(this._activeBuffer.x++,I,k,ne.fg,ne.bg,ne.extended),k>0)for(;--k;)ie.setCellFromCodePoint(this._activeBuffer.x++,0,0,ne.fg,ne.bg,ne.extended)}else ie.getWidth(this._activeBuffer.x-1)?ie.addCodepointToCell(this._activeBuffer.x-1,I):ie.addCodepointToCell(this._activeBuffer.x-2,I)}L-P>0&&(ie.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<W&&L-P>0&&ie.getWidth(this._activeBuffer.x)===0&&!ie.hasContent(this._activeBuffer.x)&&ie.setCellFromCodePoint(this._activeBuffer.x,0,1,ne.fg,ne.bg,ne.extended),this._dirtyRowService.markDirty(this._activeBuffer.y)},D.prototype.registerCsiHandler=function(O,P){var L=this;return O.final!=="t"||O.prefix||O.intermediates?this._parser.registerCsiHandler(O,P):this._parser.registerCsiHandler(O,function(I){return!T(I.params[0],L._optionsService.rawOptions.windowOptions)||P(I)})},D.prototype.registerDcsHandler=function(O,P){return this._parser.registerDcsHandler(O,new w.DcsHandler(P))},D.prototype.registerEscHandler=function(O,P){return this._parser.registerEscHandler(O,P)},D.prototype.registerOscHandler=function(O,P){return this._parser.registerOscHandler(O,new y.OscHandler(P))},D.prototype.bell=function(){return this._onRequestBell.fire(),!0},D.prototype.lineFeed=function(){return this._dirtyRowService.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowService.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0},D.prototype.carriageReturn=function(){return this._activeBuffer.x=0,!0},D.prototype.backspace=function(){var O;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||O===void 0)&&O.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;var P=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);P.hasWidth(this._activeBuffer.x)&&!P.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0},D.prototype.tab=function(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;var O=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-O),!0},D.prototype.shiftOut=function(){return this._charsetService.setgLevel(1),!0},D.prototype.shiftIn=function(){return this._charsetService.setgLevel(0),!0},D.prototype._restrictCursor=function(O){O===void 0&&(O=this._bufferService.cols-1),this._activeBuffer.x=Math.min(O,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowService.markDirty(this._activeBuffer.y)},D.prototype._setCursor=function(O,P){this._dirtyRowService.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=O,this._activeBuffer.y=this._activeBuffer.scrollTop+P):(this._activeBuffer.x=O,this._activeBuffer.y=P),this._restrictCursor(),this._dirtyRowService.markDirty(this._activeBuffer.y)},D.prototype._moveCursor=function(O,P){this._restrictCursor(),this._setCursor(this._activeBuffer.x+O,this._activeBuffer.y+P)},D.prototype.cursorUp=function(O){var P=this._activeBuffer.y-this._activeBuffer.scrollTop;return P>=0?this._moveCursor(0,-Math.min(P,O.params[0]||1)):this._moveCursor(0,-(O.params[0]||1)),!0},D.prototype.cursorDown=function(O){var P=this._activeBuffer.scrollBottom-this._activeBuffer.y;return P>=0?this._moveCursor(0,Math.min(P,O.params[0]||1)):this._moveCursor(0,O.params[0]||1),!0},D.prototype.cursorForward=function(O){return this._moveCursor(O.params[0]||1,0),!0},D.prototype.cursorBackward=function(O){return this._moveCursor(-(O.params[0]||1),0),!0},D.prototype.cursorNextLine=function(O){return this.cursorDown(O),this._activeBuffer.x=0,!0},D.prototype.cursorPrecedingLine=function(O){return this.cursorUp(O),this._activeBuffer.x=0,!0},D.prototype.cursorCharAbsolute=function(O){return this._setCursor((O.params[0]||1)-1,this._activeBuffer.y),!0},D.prototype.cursorPosition=function(O){return this._setCursor(O.length>=2?(O.params[1]||1)-1:0,(O.params[0]||1)-1),!0},D.prototype.charPosAbsolute=function(O){return this._setCursor((O.params[0]||1)-1,this._activeBuffer.y),!0},D.prototype.hPositionRelative=function(O){return this._moveCursor(O.params[0]||1,0),!0},D.prototype.linePosAbsolute=function(O){return this._setCursor(this._activeBuffer.x,(O.params[0]||1)-1),!0},D.prototype.vPositionRelative=function(O){return this._moveCursor(0,O.params[0]||1),!0},D.prototype.hVPosition=function(O){return this.cursorPosition(O),!0},D.prototype.tabClear=function(O){var P=O.params[0];return P===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:P===3&&(this._activeBuffer.tabs={}),!0},D.prototype.cursorForwardTab=function(O){if(this._activeBuffer.x>=this._bufferService.cols)return!0;for(var P=O.params[0]||1;P--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0},D.prototype.cursorBackwardTab=function(O){if(this._activeBuffer.x>=this._bufferService.cols)return!0;for(var P=O.params[0]||1;P--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0},D.prototype._eraseInBufferLine=function(O,P,L,I){I===void 0&&(I=!1);var k=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);k.replaceCells(P,L,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),I&&(k.isWrapped=!1)},D.prototype._resetBufferLine=function(O){var P=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);P.fill(this._activeBuffer.getNullCell(this._eraseAttrData())),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+O),P.isWrapped=!1},D.prototype.eraseInDisplay=function(O){var P;switch(this._restrictCursor(this._bufferService.cols),O.params[0]){case 0:for(P=this._activeBuffer.y,this._dirtyRowService.markDirty(P),this._eraseInBufferLine(P++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0);P<this._bufferService.rows;P++)this._resetBufferLine(P);this._dirtyRowService.markDirty(P);break;case 1:for(P=this._activeBuffer.y,this._dirtyRowService.markDirty(P),this._eraseInBufferLine(P,0,this._activeBuffer.x+1,!0),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(P+1).isWrapped=!1);P--;)this._resetBufferLine(P);this._dirtyRowService.markDirty(0);break;case 2:for(P=this._bufferService.rows,this._dirtyRowService.markDirty(P-1);P--;)this._resetBufferLine(P);this._dirtyRowService.markDirty(0);break;case 3:var L=this._activeBuffer.lines.length-this._bufferService.rows;L>0&&(this._activeBuffer.lines.trimStart(L),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-L,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-L,0),this._onScroll.fire(0))}return!0},D.prototype.eraseInLine=function(O){switch(this._restrictCursor(this._bufferService.cols),O.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0)}return this._dirtyRowService.markDirty(this._activeBuffer.y),!0},D.prototype.insertLines=function(O){this._restrictCursor();var P=O.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var L=this._activeBuffer.ybase+this._activeBuffer.y,I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,k=this._bufferService.rows-1+this._activeBuffer.ybase-I+1;P--;)this._activeBuffer.lines.splice(k-1,1),this._activeBuffer.lines.splice(L,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0},D.prototype.deleteLines=function(O){this._restrictCursor();var P=O.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;var L,I=this._activeBuffer.ybase+this._activeBuffer.y;for(L=this._bufferService.rows-1-this._activeBuffer.scrollBottom,L=this._bufferService.rows-1+this._activeBuffer.ybase-L;P--;)this._activeBuffer.lines.splice(I,1),this._activeBuffer.lines.splice(L,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0},D.prototype.insertChars=function(O){this._restrictCursor();var P=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return P&&(P.insertCells(this._activeBuffer.x,O.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0},D.prototype.deleteChars=function(O){this._restrictCursor();var P=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return P&&(P.deleteCells(this._activeBuffer.x,O.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0},D.prototype.scrollUp=function(O){for(var P=O.params[0]||1;P--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},D.prototype.scrollDown=function(O){for(var P=O.params[0]||1;P--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(v.DEFAULT_ATTR_DATA));return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},D.prototype.scrollLeft=function(O){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var P=O.params[0]||1,L=this._activeBuffer.scrollTop;L<=this._activeBuffer.scrollBottom;++L){var I=this._activeBuffer.lines.get(this._activeBuffer.ybase+L);I.deleteCells(0,P,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),I.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},D.prototype.scrollRight=function(O){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var P=O.params[0]||1,L=this._activeBuffer.scrollTop;L<=this._activeBuffer.scrollBottom;++L){var I=this._activeBuffer.lines.get(this._activeBuffer.ybase+L);I.insertCells(0,P,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),I.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},D.prototype.insertColumns=function(O){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var P=O.params[0]||1,L=this._activeBuffer.scrollTop;L<=this._activeBuffer.scrollBottom;++L){var I=this._activeBuffer.lines.get(this._activeBuffer.ybase+L);I.insertCells(this._activeBuffer.x,P,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),I.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},D.prototype.deleteColumns=function(O){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var P=O.params[0]||1,L=this._activeBuffer.scrollTop;L<=this._activeBuffer.scrollBottom;++L){var I=this._activeBuffer.lines.get(this._activeBuffer.ybase+L);I.deleteCells(this._activeBuffer.x,P,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),I.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},D.prototype.eraseChars=function(O){this._restrictCursor();var P=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return P&&(P.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(O.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0},D.prototype.repeatPrecedingCharacter=function(O){if(!this._parser.precedingCodepoint)return!0;for(var P=O.params[0]||1,L=new Uint32Array(P),I=0;I<P;++I)L[I]=this._parser.precedingCodepoint;return this.print(L,0,L.length),!0},D.prototype.sendDeviceAttributesPrimary=function(O){return O.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(h.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(h.C0.ESC+"[?6c")),!0},D.prototype.sendDeviceAttributesSecondary=function(O){return O.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(h.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(h.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(O.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(h.C0.ESC+"[>83;40003;0c")),!0},D.prototype._is=function(O){return(this._optionsService.rawOptions.termName+"").indexOf(O)===0},D.prototype.setMode=function(O){for(var P=0;P<O.length;P++)O.params[P]===4&&(this._coreService.modes.insertMode=!0);return!0},D.prototype.setModePrivate=function(O){for(var P=0;P<O.length;P++)switch(O.params[P]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,u.DEFAULT_CHARSET),this._charsetService.setgCharset(1,u.DEFAULT_CHARSET),this._charsetService.setgCharset(2,u.DEFAULT_CHARSET),this._charsetService.setgCharset(3,u.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0},D.prototype.resetMode=function(O){for(var P=0;P<O.length;P++)O.params[P]===4&&(this._coreService.modes.insertMode=!1);return!0},D.prototype.resetModePrivate=function(O){for(var P=0;P<O.length;P++)switch(O.params[P]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),O.params[P]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0},D.prototype._updateAttrColor=function(O,P,L,I,k){return P===2?(O|=50331648,O&=-16777216,O|=x.AttributeData.fromColorRGB([L,I,k])):P===5&&(O&=-50331904,O|=33554432|255&L),O},D.prototype._extractColor=function(O,P,L){var I=[0,0,-1,0,0,0],k=0,B=0;do{if(I[B+k]=O.params[P+B],O.hasSubParams(P+B)){var F=O.getSubParams(P+B),W=0;do I[1]===5&&(k=1),I[B+W+1+k]=F[W];while(++W<F.length&&W+B+1+k<I.length);break}if(I[1]===5&&B+k>=2||I[1]===2&&B+k>=5)break;I[1]&&(k=1)}while(++B+P<O.length&&B+k<I.length);for(W=2;W<I.length;++W)I[W]===-1&&(I[W]=0);switch(I[0]){case 38:L.fg=this._updateAttrColor(L.fg,I[1],I[3],I[4],I[5]);break;case 48:L.bg=this._updateAttrColor(L.bg,I[1],I[3],I[4],I[5]);break;case 58:L.extended=L.extended.clone(),L.extended.underlineColor=this._updateAttrColor(L.extended.underlineColor,I[1],I[3],I[4],I[5])}return B},D.prototype._processUnderline=function(O,P){P.extended=P.extended.clone(),(!~O||O>5)&&(O=1),P.extended.underlineStyle=O,P.fg|=268435456,O===0&&(P.fg&=-268435457),P.updateExtended()},D.prototype.charAttributes=function(O){if(O.length===1&&O.params[0]===0)return this._curAttrData.fg=v.DEFAULT_ATTR_DATA.fg,this._curAttrData.bg=v.DEFAULT_ATTR_DATA.bg,!0;for(var P,L=O.length,I=this._curAttrData,k=0;k<L;k++)(P=O.params[k])>=30&&P<=37?(I.fg&=-50331904,I.fg|=16777216|P-30):P>=40&&P<=47?(I.bg&=-50331904,I.bg|=16777216|P-40):P>=90&&P<=97?(I.fg&=-50331904,I.fg|=16777224|P-90):P>=100&&P<=107?(I.bg&=-50331904,I.bg|=16777224|P-100):P===0?(I.fg=v.DEFAULT_ATTR_DATA.fg,I.bg=v.DEFAULT_ATTR_DATA.bg):P===1?I.fg|=134217728:P===3?I.bg|=67108864:P===4?(I.fg|=268435456,this._processUnderline(O.hasSubParams(k)?O.getSubParams(k)[0]:1,I)):P===5?I.fg|=536870912:P===7?I.fg|=67108864:P===8?I.fg|=1073741824:P===9?I.fg|=2147483648:P===2?I.bg|=134217728:P===21?this._processUnderline(2,I):P===22?(I.fg&=-134217729,I.bg&=-134217729):P===23?I.bg&=-67108865:P===24?I.fg&=-268435457:P===25?I.fg&=-536870913:P===27?I.fg&=-67108865:P===28?I.fg&=-1073741825:P===29?I.fg&=2147483647:P===39?(I.fg&=-67108864,I.fg|=16777215&v.DEFAULT_ATTR_DATA.fg):P===49?(I.bg&=-67108864,I.bg|=16777215&v.DEFAULT_ATTR_DATA.bg):P===38||P===48||P===58?k+=this._extractColor(O,k,I):P===59?(I.extended=I.extended.clone(),I.extended.underlineColor=-1,I.updateExtended()):P===100?(I.fg&=-67108864,I.fg|=16777215&v.DEFAULT_ATTR_DATA.fg,I.bg&=-67108864,I.bg|=16777215&v.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",P);return!0},D.prototype.deviceStatus=function(O){switch(O.params[0]){case 5:this._coreService.triggerDataEvent(h.C0.ESC+"[0n");break;case 6:var P=this._activeBuffer.y+1,L=this._activeBuffer.x+1;this._coreService.triggerDataEvent(h.C0.ESC+"["+P+";"+L+"R")}return!0},D.prototype.deviceStatusPrivate=function(O){if(O.params[0]===6){var P=this._activeBuffer.y+1,L=this._activeBuffer.x+1;this._coreService.triggerDataEvent(h.C0.ESC+"[?"+P+";"+L+"R")}return!0},D.prototype.softReset=function(O){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=v.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0},D.prototype.setCursorStyle=function(O){var P=O.params[0]||1;switch(P){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}var L=P%2==1;return this._optionsService.options.cursorBlink=L,!0},D.prototype.setScrollRegion=function(O){var P,L=O.params[0]||1;return(O.length<2||(P=O.params[1])>this._bufferService.rows||P===0)&&(P=this._bufferService.rows),P>L&&(this._activeBuffer.scrollTop=L-1,this._activeBuffer.scrollBottom=P-1,this._setCursor(0,0)),!0},D.prototype.windowOptions=function(O){if(!T(O.params[0],this._optionsService.rawOptions.windowOptions))return!0;var P=O.length>1?O.params[1]:0;switch(O.params[0]){case 14:P!==2&&this._onRequestWindowsOptionsReport.fire(l.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(l.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(h.C0.ESC+"[8;"+this._bufferService.rows+";"+this._bufferService.cols+"t");break;case 22:P!==0&&P!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),P!==0&&P!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:P!==0&&P!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),P!==0&&P!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0},D.prototype.saveCursor=function(O){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0},D.prototype.restoreCursor=function(O){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0},D.prototype.setTitle=function(O){return this._windowTitle=O,this._onTitleChange.fire(O),!0},D.prototype.setIconName=function(O){return this._iconName=O,!0},D.prototype.setOrReportIndexedColor=function(O){for(var P=[],L=O.split(";");L.length>1;){var I=L.shift(),k=L.shift();if(/^\d+$/.exec(I)){var B=parseInt(I);if(0<=B&&B<256)if(k==="?")P.push({type:0,index:B});else{var F=(0,S.parseColor)(k);F&&P.push({type:1,index:B,color:F})}}}return P.length&&this._onColor.fire(P),!0},D.prototype._setOrReportSpecialColor=function(O,P){for(var L=O.split(";"),I=0;I<L.length&&!(P>=this._specialColors.length);++I,++P)if(L[I]==="?")this._onColor.fire([{type:0,index:this._specialColors[P]}]);else{var k=(0,S.parseColor)(L[I]);k&&this._onColor.fire([{type:1,index:this._specialColors[P],color:k}])}return!0},D.prototype.setOrReportFgColor=function(O){return this._setOrReportSpecialColor(O,0)},D.prototype.setOrReportBgColor=function(O){return this._setOrReportSpecialColor(O,1)},D.prototype.setOrReportCursorColor=function(O){return this._setOrReportSpecialColor(O,2)},D.prototype.restoreIndexedColor=function(O){if(!O)return this._onColor.fire([{type:2}]),!0;for(var P=[],L=O.split(";"),I=0;I<L.length;++I)if(/^\d+$/.exec(L[I])){var k=parseInt(L[I]);0<=k&&k<256&&P.push({type:2,index:k})}return P.length&&this._onColor.fire(P),!0},D.prototype.restoreFgColor=function(O){return this._onColor.fire([{type:2,index:256}]),!0},D.prototype.restoreBgColor=function(O){return this._onColor.fire([{type:2,index:257}]),!0},D.prototype.restoreCursorColor=function(O){return this._onColor.fire([{type:2,index:258}]),!0},D.prototype.nextLine=function(){return this._activeBuffer.x=0,this.index(),!0},D.prototype.keypadApplicationMode=function(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0},D.prototype.keypadNumericMode=function(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0},D.prototype.selectDefaultCharset=function(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,u.DEFAULT_CHARSET),!0},D.prototype.selectCharset=function(O){return O.length!==2?(this.selectDefaultCharset(),!0):(O[0]==="/"||this._charsetService.setgCharset(R[O[0]],u.CHARSETS[O[1]]||u.DEFAULT_CHARSET),!0)},D.prototype.index=function(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0},D.prototype.tabSet=function(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0},D.prototype.reverseIndex=function(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){var O=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,O,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0},D.prototype.fullReset=function(){return this._parser.reset(),this._onRequestReset.fire(),!0},D.prototype.reset=function(){this._curAttrData=v.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=v.DEFAULT_ATTR_DATA.clone()},D.prototype._eraseAttrData=function(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal},D.prototype.setgLevel=function(O){return this._charsetService.setgLevel(O),!0},D.prototype.screenAlignmentPattern=function(){var O=new _.CellData;O.content=1<<22|"E".charCodeAt(0),O.fg=this._curAttrData.fg,O.bg=this._curAttrData.bg,this._setCursor(0,0);for(var P=0;P<this._bufferService.rows;++P){var L=this._activeBuffer.ybase+this._activeBuffer.y+P,I=this._activeBuffer.lines.get(L);I&&(I.fill(O),I.isWrapped=!1)}return this._dirtyRowService.markAllDirty(),this._setCursor(0,0),!0},D}(f.Disposable);r.InputHandler=C},844:function(i,r){var n=this&&this.__values||function(l){var h=typeof Symbol=="function"&&Symbol.iterator,u=h&&l[h],c=0;if(u)return u.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&c>=l.length&&(l=void 0),{value:l&&l[c++],done:!l}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.getDisposeArrayDisposable=r.disposeArray=r.Disposable=void 0;var o=function(){function l(){this._disposables=[],this._isDisposed=!1}return l.prototype.dispose=function(){var h,u;this._isDisposed=!0;try{for(var c=n(this._disposables),f=c.next();!f.done;f=c.next())f.value.dispose()}catch(d){h={error:d}}finally{try{f&&!f.done&&(u=c.return)&&u.call(c)}finally{if(h)throw h.error}}this._disposables.length=0},l.prototype.register=function(h){return this._disposables.push(h),h},l.prototype.unregister=function(h){var u=this._disposables.indexOf(h);u!==-1&&this._disposables.splice(u,1)},l}();function a(l){var h,u;try{for(var c=n(l),f=c.next();!f.done;f=c.next())f.value.dispose()}catch(d){h={error:d}}finally{try{f&&!f.done&&(u=c.return)&&u.call(c)}finally{if(h)throw h.error}}l.length=0}r.Disposable=o,r.disposeArray=a,r.getDisposeArrayDisposable=function(l){return{dispose:function(){return a(l)}}}},6114:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isLinux=r.isWindows=r.isIphone=r.isIpad=r.isMac=r.isSafari=r.isLegacyEdge=r.isFirefox=void 0;var n=typeof navigator=="undefined",o=n?"node":navigator.userAgent,a=n?"node":navigator.platform;r.isFirefox=o.includes("Firefox"),r.isLegacyEdge=o.includes("Edge"),r.isSafari=/^((?!chrome|android).)*safari/i.test(o),r.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(a),r.isIpad=a==="iPad",r.isIphone=a==="iPhone",r.isWindows=["Windows","Win16","Win32","WinCE"].includes(a),r.isLinux=a.indexOf("Linux")>=0},6106:function(i,r){var n=this&&this.__generator||function(a,l){var h,u,c,f,d={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return f={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function m(v){return function(g){return function(p){if(h)throw new TypeError("Generator is already executing.");for(;d;)try{if(h=1,u&&(c=2&p[0]?u.return:p[0]?u.throw||((c=u.return)&&c.call(u),0):u.next)&&!(c=c.call(u,p[1])).done)return c;switch(u=0,c&&(p=[2&p[0],c.value]),p[0]){case 0:case 1:c=p;break;case 4:return d.label++,{value:p[1],done:!1};case 5:d.label++,u=p[1],p=[0];continue;case 7:p=d.ops.pop(),d.trys.pop();continue;default:if(!((c=(c=d.trys).length>0&&c[c.length-1])||p[0]!==6&&p[0]!==2)){d=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){d.label=p[1];break}if(p[0]===6&&d.label<c[1]){d.label=c[1],c=p;break}if(c&&d.label<c[2]){d.label=c[2],d.ops.push(p);break}c[2]&&d.ops.pop(),d.trys.pop();continue}p=l.call(a,d)}catch(_){p=[6,_],u=0}finally{h=c=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([v,g])}}};Object.defineProperty(r,"__esModule",{value:!0}),r.SortedList=void 0;var o=function(){function a(l){this._getKey=l,this._array=[]}return a.prototype.clear=function(){this._array.length=0},a.prototype.insert=function(l){if(this._array.length!==0){var h=this._search(this._getKey(l),0,this._array.length-1);this._array.splice(h,0,l)}else this._array.push(l)},a.prototype.delete=function(l){if(this._array.length===0)return!1;var h=this._getKey(l),u=this._search(h,0,this._array.length-1);if(this._getKey(this._array[u])!==h)return!1;do if(this._array[u]===l)return this._array.splice(u,1),!0;while(++u<this._array.length&&this._getKey(this._array[u])===h);return!1},a.prototype.getKeyIterator=function(l){var h;return n(this,function(u){switch(u.label){case 0:if(this._array.length===0)return[2];if((h=this._search(l,0,this._array.length-1))<0||h>=this._array.length)return[2];if(this._getKey(this._array[h])!==l)return[2];u.label=1;case 1:return[4,this._array[h]];case 2:u.sent(),u.label=3;case 3:if(++h<this._array.length&&this._getKey(this._array[h])===l)return[3,1];u.label=4;case 4:return[2]}})},a.prototype.values=function(){return this._array.values()},a.prototype._search=function(l,h,u){if(u<h)return h;var c=Math.floor((h+u)/2);if(this._getKey(this._array[c])>l)return this._search(l,h,c-1);if(this._getKey(this._array[c])<l)return this._search(l,c+1,u);for(;c>0&&this._getKey(this._array[c-1])===l;)c--;return c},a}();r.SortedList=o},8273:(i,r)=>{function n(o,a,l,h){if(l===void 0&&(l=0),h===void 0&&(h=o.length),l>=o.length)return o;l=(o.length+l)%o.length,h=h>=o.length?o.length:(o.length+h)%o.length;for(var u=l;u<h;++u)o[u]=a;return o}Object.defineProperty(r,"__esModule",{value:!0}),r.concat=r.fillFallback=r.fill=void 0,r.fill=function(o,a,l,h){return o.fill?o.fill(a,l,h):n(o,a,l,h)},r.fillFallback=n,r.concat=function(o,a){var l=new o.constructor(o.length+a.length);return l.set(o),l.set(a,o.length),l}},9282:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.updateWindowsModeWrappedState=void 0;var o=n(643);r.updateWindowsModeWrappedState=function(a){var l=a.buffer.lines.get(a.buffer.ybase+a.buffer.y-1),h=l==null?void 0:l.get(a.cols-1),u=a.buffer.lines.get(a.buffer.ybase+a.buffer.y);u&&h&&(u.isWrapped=h[o.CHAR_DATA_CODE_INDEX]!==o.NULL_CELL_CODE&&h[o.CHAR_DATA_CODE_INDEX]!==o.WHITESPACE_CELL_CODE)}},3734:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ExtendedAttrs=r.AttributeData=void 0;var n=function(){function a(){this.fg=0,this.bg=0,this.extended=new o}return a.toColorRGB=function(l){return[l>>>16&255,l>>>8&255,255&l]},a.fromColorRGB=function(l){return(255&l[0])<<16|(255&l[1])<<8|255&l[2]},a.prototype.clone=function(){var l=new a;return l.fg=this.fg,l.bg=this.bg,l.extended=this.extended.clone(),l},a.prototype.isInverse=function(){return 67108864&this.fg},a.prototype.isBold=function(){return 134217728&this.fg},a.prototype.isUnderline=function(){return 268435456&this.fg},a.prototype.isBlink=function(){return 536870912&this.fg},a.prototype.isInvisible=function(){return 1073741824&this.fg},a.prototype.isItalic=function(){return 67108864&this.bg},a.prototype.isDim=function(){return 134217728&this.bg},a.prototype.isStrikethrough=function(){return 2147483648&this.fg},a.prototype.getFgColorMode=function(){return 50331648&this.fg},a.prototype.getBgColorMode=function(){return 50331648&this.bg},a.prototype.isFgRGB=function(){return(50331648&this.fg)==50331648},a.prototype.isBgRGB=function(){return(50331648&this.bg)==50331648},a.prototype.isFgPalette=function(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432},a.prototype.isBgPalette=function(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432},a.prototype.isFgDefault=function(){return(50331648&this.fg)==0},a.prototype.isBgDefault=function(){return(50331648&this.bg)==0},a.prototype.isAttributeDefault=function(){return this.fg===0&&this.bg===0},a.prototype.getFgColor=function(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}},a.prototype.getBgColor=function(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}},a.prototype.hasExtendedAttrs=function(){return 268435456&this.bg},a.prototype.updateExtended=function(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456},a.prototype.getUnderlineColor=function(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()},a.prototype.getUnderlineColorMode=function(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()},a.prototype.isUnderlineColorRGB=function(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()},a.prototype.isUnderlineColorPalette=function(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()},a.prototype.isUnderlineColorDefault=function(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()},a.prototype.getUnderlineStyle=function(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0},a}();r.AttributeData=n;var o=function(){function a(l,h){l===void 0&&(l=0),h===void 0&&(h=-1),this.underlineStyle=l,this.underlineColor=h}return a.prototype.clone=function(){return new a(this.underlineStyle,this.underlineColor)},a.prototype.isEmpty=function(){return this.underlineStyle===0},a}();r.ExtendedAttrs=o},9092:function(i,r,n){var o=this&&this.__read||function(_,x){var b=typeof Symbol=="function"&&_[Symbol.iterator];if(!b)return _;var y,w,S=b.call(_),R=[];try{for(;(x===void 0||x-- >0)&&!(y=S.next()).done;)R.push(y.value)}catch(E){w={error:E}}finally{try{y&&!y.done&&(b=S.return)&&b.call(S)}finally{if(w)throw w.error}}return R},a=this&&this.__spreadArray||function(_,x,b){if(b||arguments.length===2)for(var y,w=0,S=x.length;w<S;w++)!y&&w in x||(y||(y=Array.prototype.slice.call(x,0,w)),y[w]=x[w]);return _.concat(y||Array.prototype.slice.call(x))};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferStringIterator=r.Buffer=r.MAX_BUFFER_SIZE=void 0;var l=n(6349),h=n(8437),u=n(511),c=n(643),f=n(4634),d=n(4863),m=n(7116),v=n(3734);r.MAX_BUFFER_SIZE=4294967295;var g=function(){function _(x,b,y){this._hasScrollback=x,this._optionsService=b,this._bufferService=y,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.savedY=0,this.savedX=0,this.savedCurAttrData=h.DEFAULT_ATTR_DATA.clone(),this.savedCharset=m.DEFAULT_CHARSET,this.markers=[],this._nullCell=u.CellData.fromCharData([0,c.NULL_CELL_CHAR,c.NULL_CELL_WIDTH,c.NULL_CELL_CODE]),this._whitespaceCell=u.CellData.fromCharData([0,c.WHITESPACE_CELL_CHAR,c.WHITESPACE_CELL_WIDTH,c.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}return _.prototype.getNullCell=function(x){return x?(this._nullCell.fg=x.fg,this._nullCell.bg=x.bg,this._nullCell.extended=x.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new v.ExtendedAttrs),this._nullCell},_.prototype.getWhitespaceCell=function(x){return x?(this._whitespaceCell.fg=x.fg,this._whitespaceCell.bg=x.bg,this._whitespaceCell.extended=x.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new v.ExtendedAttrs),this._whitespaceCell},_.prototype.getBlankLine=function(x,b){return new h.BufferLine(this._bufferService.cols,this.getNullCell(x),b)},Object.defineProperty(_.prototype,"hasScrollback",{get:function(){return this._hasScrollback&&this.lines.maxLength>this._rows},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"isCursorInViewport",{get:function(){var x=this.ybase+this.y-this.ydisp;return x>=0&&x<this._rows},enumerable:!1,configurable:!0}),_.prototype._getCorrectBufferLength=function(x){if(!this._hasScrollback)return x;var b=x+this._optionsService.rawOptions.scrollback;return b>r.MAX_BUFFER_SIZE?r.MAX_BUFFER_SIZE:b},_.prototype.fillViewportRows=function(x){if(this.lines.length===0){x===void 0&&(x=h.DEFAULT_ATTR_DATA);for(var b=this._rows;b--;)this.lines.push(this.getBlankLine(x))}},_.prototype.clear=function(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()},_.prototype.resize=function(x,b){var y=this.getNullCell(h.DEFAULT_ATTR_DATA),w=this._getCorrectBufferLength(b);if(w>this.lines.maxLength&&(this.lines.maxLength=w),this.lines.length>0){if(this._cols<x)for(var S=0;S<this.lines.length;S++)this.lines.get(S).resize(x,y);var R=0;if(this._rows<b)for(var E=this._rows;E<b;E++)this.lines.length<b+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new h.BufferLine(x,y)):this.ybase>0&&this.lines.length<=this.ybase+this.y+R+1?(this.ybase--,R++,this.ydisp>0&&this.ydisp--):this.lines.push(new h.BufferLine(x,y)));else for(E=this._rows;E>b;E--)this.lines.length>b+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(w<this.lines.maxLength){var T=this.lines.length-w;T>0&&(this.lines.trimStart(T),this.ybase=Math.max(this.ybase-T,0),this.ydisp=Math.max(this.ydisp-T,0),this.savedY=Math.max(this.savedY-T,0)),this.lines.maxLength=w}this.x=Math.min(this.x,x-1),this.y=Math.min(this.y,b-1),R&&(this.y+=R),this.savedX=Math.min(this.savedX,x-1),this.scrollTop=0}if(this.scrollBottom=b-1,this._isReflowEnabled&&(this._reflow(x,b),this._cols>x))for(S=0;S<this.lines.length;S++)this.lines.get(S).resize(x,y);this._cols=x,this._rows=b},Object.defineProperty(_.prototype,"_isReflowEnabled",{get:function(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode},enumerable:!1,configurable:!0}),_.prototype._reflow=function(x,b){this._cols!==x&&(x>this._cols?this._reflowLarger(x,b):this._reflowSmaller(x,b))},_.prototype._reflowLarger=function(x,b){var y=(0,f.reflowLargerGetLinesToRemove)(this.lines,this._cols,x,this.ybase+this.y,this.getNullCell(h.DEFAULT_ATTR_DATA));if(y.length>0){var w=(0,f.reflowLargerCreateNewLayout)(this.lines,y);(0,f.reflowLargerApplyNewLayout)(this.lines,w.layout),this._reflowLargerAdjustViewport(x,b,w.countRemoved)}},_.prototype._reflowLargerAdjustViewport=function(x,b,y){for(var w=this.getNullCell(h.DEFAULT_ATTR_DATA),S=y;S-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<b&&this.lines.push(new h.BufferLine(x,w))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-y,0)},_.prototype._reflowSmaller=function(x,b){for(var y=this.getNullCell(h.DEFAULT_ATTR_DATA),w=[],S=0,R=this.lines.length-1;R>=0;R--){var E=this.lines.get(R);if(!(!E||!E.isWrapped&&E.getTrimmedLength()<=x)){for(var T=[E];E.isWrapped&&R>0;)E=this.lines.get(--R),T.unshift(E);var A=this.ybase+this.y;if(!(A>=R&&A<R+T.length)){var C,M=T[T.length-1].getTrimmedLength(),D=(0,f.reflowSmallerGetNewLineLengths)(T,this._cols,x),O=D.length-T.length;C=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+O):Math.max(0,this.lines.length-this.lines.maxLength+O);for(var P=[],L=0;L<O;L++){var I=this.getBlankLine(h.DEFAULT_ATTR_DATA,!0);P.push(I)}P.length>0&&(w.push({start:R+T.length+S,newLines:P}),S+=P.length),T.push.apply(T,a([],o(P),!1));var k=D.length-1,B=D[k];B===0&&(B=D[--k]);for(var F=T.length-O-1,W=M;F>=0;){var V=Math.min(W,B);if(T[k]===void 0)break;if(T[k].copyCellsFrom(T[F],W-V,B-V,V,!0),(B-=V)==0&&(B=D[--k]),(W-=V)==0){F--;var N=Math.max(F,0);W=(0,f.getWrappedLineTrimmedLength)(T,N,this._cols)}}for(L=0;L<T.length;L++)D[L]<x&&T[L].setCell(D[L],y);for(var ne=O-C;ne-- >0;)this.ybase===0?this.y<b-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+S)-b&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+O,this.ybase+b-1)}}}if(w.length>0){var ie=[],Q=[];for(L=0;L<this.lines.length;L++)Q.push(this.lines.get(L));var K=this.lines.length,de=K-1,re=0,Y=w[re];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+S);var U=0;for(L=Math.min(this.lines.maxLength-1,K+S-1);L>=0;L--)if(Y&&Y.start>de+U){for(var z=Y.newLines.length-1;z>=0;z--)this.lines.set(L--,Y.newLines[z]);L++,ie.push({index:de+1,amount:Y.newLines.length}),U+=Y.newLines.length,Y=w[++re]}else this.lines.set(L,Q[de--]);var te=0;for(L=ie.length-1;L>=0;L--)ie[L].index+=te,this.lines.onInsertEmitter.fire(ie[L]),te+=ie[L].amount;var ge=Math.max(0,K+S-this.lines.maxLength);ge>0&&this.lines.onTrimEmitter.fire(ge)}},_.prototype.stringIndexToBufferIndex=function(x,b,y){for(y===void 0&&(y=!1);b;){var w=this.lines.get(x);if(!w)return[-1,-1];for(var S=y?w.getTrimmedLength():w.length,R=0;R<S;++R)if(w.get(R)[c.CHAR_DATA_WIDTH_INDEX]&&(b-=w.get(R)[c.CHAR_DATA_CHAR_INDEX].length||1),b<0)return[x,R];x++}return[x,0]},_.prototype.translateBufferLineToString=function(x,b,y,w){y===void 0&&(y=0);var S=this.lines.get(x);return S?S.translateToString(b,y,w):""},_.prototype.getWrappedRangeForLine=function(x){for(var b=x,y=x;b>0&&this.lines.get(b).isWrapped;)b--;for(;y+1<this.lines.length&&this.lines.get(y+1).isWrapped;)y++;return{first:b,last:y}},_.prototype.setupTabStops=function(x){for(x!=null?this.tabs[x]||(x=this.prevStop(x)):(this.tabs={},x=0);x<this._cols;x+=this._optionsService.rawOptions.tabStopWidth)this.tabs[x]=!0},_.prototype.prevStop=function(x){for(x==null&&(x=this.x);!this.tabs[--x]&&x>0;);return x>=this._cols?this._cols-1:x<0?0:x},_.prototype.nextStop=function(x){for(x==null&&(x=this.x);!this.tabs[++x]&&x<this._cols;);return x>=this._cols?this._cols-1:x<0?0:x},_.prototype.clearMarkers=function(x){this._isClearing=!0;for(var b=0;b<this.markers.length;b++)this.markers[b].line===x&&(this.markers[b].dispose(),this.markers.splice(b--,1));this._isClearing=!1},_.prototype.clearAllMarkers=function(){this._isClearing=!0;for(var x=0;x<this.markers.length;x++)this.markers[x].dispose(),this.markers.splice(x--,1);this._isClearing=!1},_.prototype.addMarker=function(x){var b=this,y=new d.Marker(x);return this.markers.push(y),y.register(this.lines.onTrim(function(w){y.line-=w,y.line<0&&y.dispose()})),y.register(this.lines.onInsert(function(w){y.line>=w.index&&(y.line+=w.amount)})),y.register(this.lines.onDelete(function(w){y.line>=w.index&&y.line<w.index+w.amount&&y.dispose(),y.line>w.index&&(y.line-=w.amount)})),y.register(y.onDispose(function(){return b._removeMarker(y)})),y},_.prototype._removeMarker=function(x){this._isClearing||this.markers.splice(this.markers.indexOf(x),1)},_.prototype.iterator=function(x,b,y,w,S){return new p(this,x,b,y,w,S)},_}();r.Buffer=g;var p=function(){function _(x,b,y,w,S,R){y===void 0&&(y=0),w===void 0&&(w=x.lines.length),S===void 0&&(S=0),R===void 0&&(R=0),this._buffer=x,this._trimRight=b,this._startIndex=y,this._endIndex=w,this._startOverscan=S,this._endOverscan=R,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}return _.prototype.hasNext=function(){return this._current<this._endIndex},_.prototype.next=function(){var x=this._buffer.getWrappedRangeForLine(this._current);x.first<this._startIndex-this._startOverscan&&(x.first=this._startIndex-this._startOverscan),x.last>this._endIndex+this._endOverscan&&(x.last=this._endIndex+this._endOverscan),x.first=Math.max(x.first,0),x.last=Math.min(x.last,this._buffer.lines.length);for(var b="",y=x.first;y<=x.last;++y)b+=this._buffer.translateBufferLineToString(y,this._trimRight);return this._current=x.last+1,{range:x,content:b}},_}();r.BufferStringIterator=p},8437:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLine=r.DEFAULT_ATTR_DATA=void 0;var o=n(482),a=n(643),l=n(511),h=n(3734);r.DEFAULT_ATTR_DATA=Object.freeze(new h.AttributeData);var u=function(){function c(f,d,m){m===void 0&&(m=!1),this.isWrapped=m,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*f);for(var v=d||l.CellData.fromCharData([0,a.NULL_CELL_CHAR,a.NULL_CELL_WIDTH,a.NULL_CELL_CODE]),g=0;g<f;++g)this.setCell(g,v);this.length=f}return c.prototype.get=function(f){var d=this._data[3*f+0],m=2097151&d;return[this._data[3*f+1],2097152&d?this._combined[f]:m?(0,o.stringFromCodePoint)(m):"",d>>22,2097152&d?this._combined[f].charCodeAt(this._combined[f].length-1):m]},c.prototype.set=function(f,d){this._data[3*f+1]=d[a.CHAR_DATA_ATTR_INDEX],d[a.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[f]=d[1],this._data[3*f+0]=2097152|f|d[a.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*f+0]=d[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|d[a.CHAR_DATA_WIDTH_INDEX]<<22},c.prototype.getWidth=function(f){return this._data[3*f+0]>>22},c.prototype.hasWidth=function(f){return 12582912&this._data[3*f+0]},c.prototype.getFg=function(f){return this._data[3*f+1]},c.prototype.getBg=function(f){return this._data[3*f+2]},c.prototype.hasContent=function(f){return 4194303&this._data[3*f+0]},c.prototype.getCodePoint=function(f){var d=this._data[3*f+0];return 2097152&d?this._combined[f].charCodeAt(this._combined[f].length-1):2097151&d},c.prototype.isCombined=function(f){return 2097152&this._data[3*f+0]},c.prototype.getString=function(f){var d=this._data[3*f+0];return 2097152&d?this._combined[f]:2097151&d?(0,o.stringFromCodePoint)(2097151&d):""},c.prototype.loadCell=function(f,d){var m=3*f;return d.content=this._data[m+0],d.fg=this._data[m+1],d.bg=this._data[m+2],2097152&d.content&&(d.combinedData=this._combined[f]),268435456&d.bg&&(d.extended=this._extendedAttrs[f]),d},c.prototype.setCell=function(f,d){2097152&d.content&&(this._combined[f]=d.combinedData),268435456&d.bg&&(this._extendedAttrs[f]=d.extended),this._data[3*f+0]=d.content,this._data[3*f+1]=d.fg,this._data[3*f+2]=d.bg},c.prototype.setCellFromCodePoint=function(f,d,m,v,g,p){268435456&g&&(this._extendedAttrs[f]=p),this._data[3*f+0]=d|m<<22,this._data[3*f+1]=v,this._data[3*f+2]=g},c.prototype.addCodepointToCell=function(f,d){var m=this._data[3*f+0];2097152&m?this._combined[f]+=(0,o.stringFromCodePoint)(d):(2097151&m?(this._combined[f]=(0,o.stringFromCodePoint)(2097151&m)+(0,o.stringFromCodePoint)(d),m&=-2097152,m|=2097152):m=d|1<<22,this._data[3*f+0]=m)},c.prototype.insertCells=function(f,d,m,v){if((f%=this.length)&&this.getWidth(f-1)===2&&this.setCellFromCodePoint(f-1,0,1,(v==null?void 0:v.fg)||0,(v==null?void 0:v.bg)||0,(v==null?void 0:v.extended)||new h.ExtendedAttrs),d<this.length-f){for(var g=new l.CellData,p=this.length-f-d-1;p>=0;--p)this.setCell(f+d+p,this.loadCell(f+p,g));for(p=0;p<d;++p)this.setCell(f+p,m)}else for(p=f;p<this.length;++p)this.setCell(p,m);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,(v==null?void 0:v.fg)||0,(v==null?void 0:v.bg)||0,(v==null?void 0:v.extended)||new h.ExtendedAttrs)},c.prototype.deleteCells=function(f,d,m,v){if(f%=this.length,d<this.length-f){for(var g=new l.CellData,p=0;p<this.length-f-d;++p)this.setCell(f+p,this.loadCell(f+d+p,g));for(p=this.length-d;p<this.length;++p)this.setCell(p,m)}else for(p=f;p<this.length;++p)this.setCell(p,m);f&&this.getWidth(f-1)===2&&this.setCellFromCodePoint(f-1,0,1,(v==null?void 0:v.fg)||0,(v==null?void 0:v.bg)||0,(v==null?void 0:v.extended)||new h.ExtendedAttrs),this.getWidth(f)!==0||this.hasContent(f)||this.setCellFromCodePoint(f,0,1,(v==null?void 0:v.fg)||0,(v==null?void 0:v.bg)||0,(v==null?void 0:v.extended)||new h.ExtendedAttrs)},c.prototype.replaceCells=function(f,d,m,v){for(f&&this.getWidth(f-1)===2&&this.setCellFromCodePoint(f-1,0,1,(v==null?void 0:v.fg)||0,(v==null?void 0:v.bg)||0,(v==null?void 0:v.extended)||new h.ExtendedAttrs),d<this.length&&this.getWidth(d-1)===2&&this.setCellFromCodePoint(d,0,1,(v==null?void 0:v.fg)||0,(v==null?void 0:v.bg)||0,(v==null?void 0:v.extended)||new h.ExtendedAttrs);f<d&&f<this.length;)this.setCell(f++,m)},c.prototype.resize=function(f,d){if(f!==this.length){if(f>this.length){var m=new Uint32Array(3*f);this.length&&(3*f<this._data.length?m.set(this._data.subarray(0,3*f)):m.set(this._data)),this._data=m;for(var v=this.length;v<f;++v)this.setCell(v,d)}else if(f){(m=new Uint32Array(3*f)).set(this._data.subarray(0,3*f)),this._data=m;var g=Object.keys(this._combined);for(v=0;v<g.length;v++){var p=parseInt(g[v],10);p>=f&&delete this._combined[p]}}else this._data=new Uint32Array(0),this._combined={};this.length=f}},c.prototype.fill=function(f){this._combined={},this._extendedAttrs={};for(var d=0;d<this.length;++d)this.setCell(d,f)},c.prototype.copyFrom=function(f){for(var d in this.length!==f.length?this._data=new Uint32Array(f._data):this._data.set(f._data),this.length=f.length,this._combined={},f._combined)this._combined[d]=f._combined[d];for(var d in this._extendedAttrs={},f._extendedAttrs)this._extendedAttrs[d]=f._extendedAttrs[d];this.isWrapped=f.isWrapped},c.prototype.clone=function(){var f=new c(0);for(var d in f._data=new Uint32Array(this._data),f.length=this.length,this._combined)f._combined[d]=this._combined[d];for(var d in this._extendedAttrs)f._extendedAttrs[d]=this._extendedAttrs[d];return f.isWrapped=this.isWrapped,f},c.prototype.getTrimmedLength=function(){for(var f=this.length-1;f>=0;--f)if(4194303&this._data[3*f+0])return f+(this._data[3*f+0]>>22);return 0},c.prototype.copyCellsFrom=function(f,d,m,v,g){var p=f._data;if(g)for(var _=v-1;_>=0;_--)for(var x=0;x<3;x++)this._data[3*(m+_)+x]=p[3*(d+_)+x];else for(_=0;_<v;_++)for(x=0;x<3;x++)this._data[3*(m+_)+x]=p[3*(d+_)+x];var b=Object.keys(f._combined);for(x=0;x<b.length;x++){var y=parseInt(b[x],10);y>=d&&(this._combined[y-d+m]=f._combined[y])}},c.prototype.translateToString=function(f,d,m){f===void 0&&(f=!1),d===void 0&&(d=0),m===void 0&&(m=this.length),f&&(m=Math.min(m,this.getTrimmedLength()));for(var v="";d<m;){var g=this._data[3*d+0],p=2097151&g;v+=2097152&g?this._combined[d]:p?(0,o.stringFromCodePoint)(p):a.WHITESPACE_CELL_CHAR,d+=g>>22||1}return v},c}();r.BufferLine=u},4841:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getRangeLength=void 0,r.getRangeLength=function(n,o){if(n.start.y>n.end.y)throw new Error("Buffer range end ("+n.end.x+", "+n.end.y+") cannot be before start ("+n.start.x+", "+n.start.y+")");return o*(n.end.y-n.start.y)+(n.end.x-n.start.x+1)}},4634:(i,r)=>{function n(o,a,l){if(a===o.length-1)return o[a].getTrimmedLength();var h=!o[a].hasContent(l-1)&&o[a].getWidth(l-1)===1,u=o[a+1].getWidth(0)===2;return h&&u?l-1:l}Object.defineProperty(r,"__esModule",{value:!0}),r.getWrappedLineTrimmedLength=r.reflowSmallerGetNewLineLengths=r.reflowLargerApplyNewLayout=r.reflowLargerCreateNewLayout=r.reflowLargerGetLinesToRemove=void 0,r.reflowLargerGetLinesToRemove=function(o,a,l,h,u){for(var c=[],f=0;f<o.length-1;f++){var d=f,m=o.get(++d);if(m.isWrapped){for(var v=[o.get(f)];d<o.length&&m.isWrapped;)v.push(m),m=o.get(++d);if(h>=f&&h<d)f+=v.length-1;else{for(var g=0,p=n(v,g,a),_=1,x=0;_<v.length;){var b=n(v,_,a),y=b-x,w=l-p,S=Math.min(y,w);v[g].copyCellsFrom(v[_],x,p,S,!1),(p+=S)===l&&(g++,p=0),(x+=S)===b&&(_++,x=0),p===0&&g!==0&&v[g-1].getWidth(l-1)===2&&(v[g].copyCellsFrom(v[g-1],l-1,p++,1,!1),v[g-1].setCell(l-1,u))}v[g].replaceCells(p,l,u);for(var R=0,E=v.length-1;E>0&&(E>g||v[E].getTrimmedLength()===0);E--)R++;R>0&&(c.push(f+v.length-R),c.push(R)),f+=v.length-1}}}return c},r.reflowLargerCreateNewLayout=function(o,a){for(var l=[],h=0,u=a[h],c=0,f=0;f<o.length;f++)if(u===f){var d=a[++h];o.onDeleteEmitter.fire({index:f-c,amount:d}),f+=d-1,c+=d,u=a[++h]}else l.push(f);return{layout:l,countRemoved:c}},r.reflowLargerApplyNewLayout=function(o,a){for(var l=[],h=0;h<a.length;h++)l.push(o.get(a[h]));for(h=0;h<l.length;h++)o.set(h,l[h]);o.length=a.length},r.reflowSmallerGetNewLineLengths=function(o,a,l){for(var h=[],u=o.map(function(p,_){return n(o,_,a)}).reduce(function(p,_){return p+_}),c=0,f=0,d=0;d<u;){if(u-d<l){h.push(u-d);break}c+=l;var m=n(o,f,a);c>m&&(c-=m,f++);var v=o[f].getWidth(c-1)===2;v&&c--;var g=v?l-1:l;h.push(g),d+=g}return h},r.getWrappedLineTrimmedLength=n},5295:function(i,r,n){var o,a=this&&this.__extends||(o=function(c,f){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,m){d.__proto__=m}||function(d,m){for(var v in m)Object.prototype.hasOwnProperty.call(m,v)&&(d[v]=m[v])},o(c,f)},function(c,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function d(){this.constructor=c}o(c,f),c.prototype=f===null?Object.create(f):(d.prototype=f.prototype,new d)});Object.defineProperty(r,"__esModule",{value:!0}),r.BufferSet=void 0;var l=n(9092),h=n(8460),u=function(c){function f(d,m){var v=c.call(this)||this;return v._optionsService=d,v._bufferService=m,v._onBufferActivate=v.register(new h.EventEmitter),v.reset(),v}return a(f,c),Object.defineProperty(f.prototype,"onBufferActivate",{get:function(){return this._onBufferActivate.event},enumerable:!1,configurable:!0}),f.prototype.reset=function(){this._normal=new l.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new l.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()},Object.defineProperty(f.prototype,"alt",{get:function(){return this._alt},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"active",{get:function(){return this._activeBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"normal",{get:function(){return this._normal},enumerable:!1,configurable:!0}),f.prototype.activateNormalBuffer=function(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))},f.prototype.activateAltBuffer=function(d){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(d),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))},f.prototype.resize=function(d,m){this._normal.resize(d,m),this._alt.resize(d,m)},f.prototype.setupTabStops=function(d){this._normal.setupTabStops(d),this._alt.setupTabStops(d)},f}(n(844).Disposable);r.BufferSet=u},511:function(i,r,n){var o,a=this&&this.__extends||(o=function(f,d){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,v){m.__proto__=v}||function(m,v){for(var g in v)Object.prototype.hasOwnProperty.call(v,g)&&(m[g]=v[g])},o(f,d)},function(f,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function m(){this.constructor=f}o(f,d),f.prototype=d===null?Object.create(d):(m.prototype=d.prototype,new m)});Object.defineProperty(r,"__esModule",{value:!0}),r.CellData=void 0;var l=n(482),h=n(643),u=n(3734),c=function(f){function d(){var m=f!==null&&f.apply(this,arguments)||this;return m.content=0,m.fg=0,m.bg=0,m.extended=new u.ExtendedAttrs,m.combinedData="",m}return a(d,f),d.fromCharData=function(m){var v=new d;return v.setFromCharData(m),v},d.prototype.isCombined=function(){return 2097152&this.content},d.prototype.getWidth=function(){return this.content>>22},d.prototype.getChars=function(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,l.stringFromCodePoint)(2097151&this.content):""},d.prototype.getCode=function(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content},d.prototype.setFromCharData=function(m){this.fg=m[h.CHAR_DATA_ATTR_INDEX],this.bg=0;var v=!1;if(m[h.CHAR_DATA_CHAR_INDEX].length>2)v=!0;else if(m[h.CHAR_DATA_CHAR_INDEX].length===2){var g=m[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=g&&g<=56319){var p=m[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=p&&p<=57343?this.content=1024*(g-55296)+p-56320+65536|m[h.CHAR_DATA_WIDTH_INDEX]<<22:v=!0}else v=!0}else this.content=m[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|m[h.CHAR_DATA_WIDTH_INDEX]<<22;v&&(this.combinedData=m[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|m[h.CHAR_DATA_WIDTH_INDEX]<<22)},d.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},d}(u.AttributeData);r.CellData=c},643:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WHITESPACE_CELL_CODE=r.WHITESPACE_CELL_WIDTH=r.WHITESPACE_CELL_CHAR=r.NULL_CELL_CODE=r.NULL_CELL_WIDTH=r.NULL_CELL_CHAR=r.CHAR_DATA_CODE_INDEX=r.CHAR_DATA_WIDTH_INDEX=r.CHAR_DATA_CHAR_INDEX=r.CHAR_DATA_ATTR_INDEX=r.DEFAULT_ATTR=r.DEFAULT_COLOR=void 0,r.DEFAULT_COLOR=256,r.DEFAULT_ATTR=256|r.DEFAULT_COLOR<<9,r.CHAR_DATA_ATTR_INDEX=0,r.CHAR_DATA_CHAR_INDEX=1,r.CHAR_DATA_WIDTH_INDEX=2,r.CHAR_DATA_CODE_INDEX=3,r.NULL_CELL_CHAR="",r.NULL_CELL_WIDTH=1,r.NULL_CELL_CODE=0,r.WHITESPACE_CELL_CHAR=" ",r.WHITESPACE_CELL_WIDTH=1,r.WHITESPACE_CELL_CODE=32},4863:function(i,r,n){var o,a=this&&this.__extends||(o=function(u,c){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,d){f.__proto__=d}||function(f,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(f[m]=d[m])},o(u,c)},function(u,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function f(){this.constructor=u}o(u,c),u.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)});Object.defineProperty(r,"__esModule",{value:!0}),r.Marker=void 0;var l=n(8460),h=function(u){function c(f){var d=u.call(this)||this;return d.line=f,d._id=c._nextId++,d.isDisposed=!1,d._onDispose=new l.EventEmitter,d}return a(c,u),Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onDispose",{get:function(){return this._onDispose.event},enumerable:!1,configurable:!0}),c.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),u.prototype.dispose.call(this))},c._nextId=1,c}(n(844).Disposable);r.Marker=h},7116:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_CHARSET=r.CHARSETS=void 0,r.CHARSETS={},r.DEFAULT_CHARSET=r.CHARSETS.B,r.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},r.CHARSETS.A={"#":"\xA3"},r.CHARSETS.B=void 0,r.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},r.CHARSETS.C=r.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},r.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},r.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},r.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},r.CHARSETS.E=r.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},r.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},r.CHARSETS.H=r.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},r.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(i,r)=>{var n,o;Object.defineProperty(r,"__esModule",{value:!0}),r.C1_ESCAPED=r.C1=r.C0=void 0,function(a){a.NUL="\0",a.SOH="",a.STX="",a.ETX="",a.EOT="",a.ENQ="",a.ACK="",a.BEL="\x07",a.BS="\b",a.HT="	",a.LF=`
`,a.VT="\v",a.FF="\f",a.CR="\r",a.SO="",a.SI="",a.DLE="",a.DC1="",a.DC2="",a.DC3="",a.DC4="",a.NAK="",a.SYN="",a.ETB="",a.CAN="",a.EM="",a.SUB="",a.ESC="\x1B",a.FS="",a.GS="",a.RS="",a.US="",a.SP=" ",a.DEL="\x7F"}(n=r.C0||(r.C0={})),(o=r.C1||(r.C1={})).PAD="\x80",o.HOP="\x81",o.BPH="\x82",o.NBH="\x83",o.IND="\x84",o.NEL="\x85",o.SSA="\x86",o.ESA="\x87",o.HTS="\x88",o.HTJ="\x89",o.VTS="\x8A",o.PLD="\x8B",o.PLU="\x8C",o.RI="\x8D",o.SS2="\x8E",o.SS3="\x8F",o.DCS="\x90",o.PU1="\x91",o.PU2="\x92",o.STS="\x93",o.CCH="\x94",o.MW="\x95",o.SPA="\x96",o.EPA="\x97",o.SOS="\x98",o.SGCI="\x99",o.SCI="\x9A",o.CSI="\x9B",o.ST="\x9C",o.OSC="\x9D",o.PM="\x9E",o.APC="\x9F",(r.C1_ESCAPED||(r.C1_ESCAPED={})).ST=n.ESC+"\\"},7399:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.evaluateKeyboardEvent=void 0;var o=n(2584),a={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};r.evaluateKeyboardEvent=function(l,h,u,c){var f={type:0,cancel:!1,key:void 0},d=(l.shiftKey?1:0)|(l.altKey?2:0)|(l.ctrlKey?4:0)|(l.metaKey?8:0);switch(l.keyCode){case 0:l.key==="UIKeyInputUpArrow"?f.key=h?o.C0.ESC+"OA":o.C0.ESC+"[A":l.key==="UIKeyInputLeftArrow"?f.key=h?o.C0.ESC+"OD":o.C0.ESC+"[D":l.key==="UIKeyInputRightArrow"?f.key=h?o.C0.ESC+"OC":o.C0.ESC+"[C":l.key==="UIKeyInputDownArrow"&&(f.key=h?o.C0.ESC+"OB":o.C0.ESC+"[B");break;case 8:if(l.shiftKey){f.key=o.C0.BS;break}if(l.altKey){f.key=o.C0.ESC+o.C0.DEL;break}f.key=o.C0.DEL;break;case 9:if(l.shiftKey){f.key=o.C0.ESC+"[Z";break}f.key=o.C0.HT,f.cancel=!0;break;case 13:f.key=l.altKey?o.C0.ESC+o.C0.CR:o.C0.CR,f.cancel=!0;break;case 27:f.key=o.C0.ESC,l.altKey&&(f.key=o.C0.ESC+o.C0.ESC),f.cancel=!0;break;case 37:if(l.metaKey)break;d?(f.key=o.C0.ESC+"[1;"+(d+1)+"D",f.key===o.C0.ESC+"[1;3D"&&(f.key=o.C0.ESC+(u?"b":"[1;5D"))):f.key=h?o.C0.ESC+"OD":o.C0.ESC+"[D";break;case 39:if(l.metaKey)break;d?(f.key=o.C0.ESC+"[1;"+(d+1)+"C",f.key===o.C0.ESC+"[1;3C"&&(f.key=o.C0.ESC+(u?"f":"[1;5C"))):f.key=h?o.C0.ESC+"OC":o.C0.ESC+"[C";break;case 38:if(l.metaKey)break;d?(f.key=o.C0.ESC+"[1;"+(d+1)+"A",u||f.key!==o.C0.ESC+"[1;3A"||(f.key=o.C0.ESC+"[1;5A")):f.key=h?o.C0.ESC+"OA":o.C0.ESC+"[A";break;case 40:if(l.metaKey)break;d?(f.key=o.C0.ESC+"[1;"+(d+1)+"B",u||f.key!==o.C0.ESC+"[1;3B"||(f.key=o.C0.ESC+"[1;5B")):f.key=h?o.C0.ESC+"OB":o.C0.ESC+"[B";break;case 45:l.shiftKey||l.ctrlKey||(f.key=o.C0.ESC+"[2~");break;case 46:f.key=d?o.C0.ESC+"[3;"+(d+1)+"~":o.C0.ESC+"[3~";break;case 36:f.key=d?o.C0.ESC+"[1;"+(d+1)+"H":h?o.C0.ESC+"OH":o.C0.ESC+"[H";break;case 35:f.key=d?o.C0.ESC+"[1;"+(d+1)+"F":h?o.C0.ESC+"OF":o.C0.ESC+"[F";break;case 33:l.shiftKey?f.type=2:l.ctrlKey?f.key=o.C0.ESC+"[5;"+(d+1)+"~":f.key=o.C0.ESC+"[5~";break;case 34:l.shiftKey?f.type=3:l.ctrlKey?f.key=o.C0.ESC+"[6;"+(d+1)+"~":f.key=o.C0.ESC+"[6~";break;case 112:f.key=d?o.C0.ESC+"[1;"+(d+1)+"P":o.C0.ESC+"OP";break;case 113:f.key=d?o.C0.ESC+"[1;"+(d+1)+"Q":o.C0.ESC+"OQ";break;case 114:f.key=d?o.C0.ESC+"[1;"+(d+1)+"R":o.C0.ESC+"OR";break;case 115:f.key=d?o.C0.ESC+"[1;"+(d+1)+"S":o.C0.ESC+"OS";break;case 116:f.key=d?o.C0.ESC+"[15;"+(d+1)+"~":o.C0.ESC+"[15~";break;case 117:f.key=d?o.C0.ESC+"[17;"+(d+1)+"~":o.C0.ESC+"[17~";break;case 118:f.key=d?o.C0.ESC+"[18;"+(d+1)+"~":o.C0.ESC+"[18~";break;case 119:f.key=d?o.C0.ESC+"[19;"+(d+1)+"~":o.C0.ESC+"[19~";break;case 120:f.key=d?o.C0.ESC+"[20;"+(d+1)+"~":o.C0.ESC+"[20~";break;case 121:f.key=d?o.C0.ESC+"[21;"+(d+1)+"~":o.C0.ESC+"[21~";break;case 122:f.key=d?o.C0.ESC+"[23;"+(d+1)+"~":o.C0.ESC+"[23~";break;case 123:f.key=d?o.C0.ESC+"[24;"+(d+1)+"~":o.C0.ESC+"[24~";break;default:if(!l.ctrlKey||l.shiftKey||l.altKey||l.metaKey)if(u&&!c||!l.altKey||l.metaKey)!u||l.altKey||l.ctrlKey||l.shiftKey||!l.metaKey?l.key&&!l.ctrlKey&&!l.altKey&&!l.metaKey&&l.keyCode>=48&&l.key.length===1?f.key=l.key:l.key&&l.ctrlKey&&(l.key==="_"&&(f.key=o.C0.US),l.key==="@"&&(f.key=o.C0.NUL)):l.keyCode===65&&(f.type=1);else{var m=a[l.keyCode],v=m==null?void 0:m[l.shiftKey?1:0];if(v)f.key=o.C0.ESC+v;else if(l.keyCode>=65&&l.keyCode<=90){var g=l.ctrlKey?l.keyCode-64:l.keyCode+32,p=String.fromCharCode(g);l.shiftKey&&(p=p.toUpperCase()),f.key=o.C0.ESC+p}else l.key==="Dead"&&l.code.startsWith("Key")&&(p=l.code.slice(3,4),l.shiftKey||(p=p.toLowerCase()),f.key=o.C0.ESC+p,f.cancel=!0)}else l.keyCode>=65&&l.keyCode<=90?f.key=String.fromCharCode(l.keyCode-64):l.keyCode===32?f.key=o.C0.NUL:l.keyCode>=51&&l.keyCode<=55?f.key=String.fromCharCode(l.keyCode-51+27):l.keyCode===56?f.key=o.C0.DEL:l.keyCode===219?f.key=o.C0.ESC:l.keyCode===220?f.key=o.C0.FS:l.keyCode===221&&(f.key=o.C0.GS)}return f}},482:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Utf8ToUtf32=r.StringToUtf32=r.utf32ToString=r.stringFromCodePoint=void 0,r.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},r.utf32ToString=function(a,l,h){l===void 0&&(l=0),h===void 0&&(h=a.length);for(var u="",c=l;c<h;++c){var f=a[c];f>65535?(f-=65536,u+=String.fromCharCode(55296+(f>>10))+String.fromCharCode(f%1024+56320)):u+=String.fromCharCode(f)}return u};var n=function(){function a(){this._interim=0}return a.prototype.clear=function(){this._interim=0},a.prototype.decode=function(l,h){var u=l.length;if(!u)return 0;var c=0,f=0;this._interim&&(56320<=(v=l.charCodeAt(f++))&&v<=57343?h[c++]=1024*(this._interim-55296)+v-56320+65536:(h[c++]=this._interim,h[c++]=v),this._interim=0);for(var d=f;d<u;++d){var m=l.charCodeAt(d);if(55296<=m&&m<=56319){if(++d>=u)return this._interim=m,c;var v;56320<=(v=l.charCodeAt(d))&&v<=57343?h[c++]=1024*(m-55296)+v-56320+65536:(h[c++]=m,h[c++]=v)}else m!==65279&&(h[c++]=m)}return c},a}();r.StringToUtf32=n;var o=function(){function a(){this.interim=new Uint8Array(3)}return a.prototype.clear=function(){this.interim.fill(0)},a.prototype.decode=function(l,h){var u=l.length;if(!u)return 0;var c,f,d,m,v=0,g=0,p=0;if(this.interim[0]){var _=!1,x=this.interim[0];x&=(224&x)==192?31:(240&x)==224?15:7;for(var b=0,y=void 0;(y=63&this.interim[++b])&&b<4;)x<<=6,x|=y;for(var w=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,S=w-b;p<S;){if(p>=u)return 0;if((192&(y=l[p++]))!=128){p--,_=!0;break}this.interim[b++]=y,x<<=6,x|=63&y}_||(w===2?x<128?p--:h[v++]=x:w===3?x<2048||x>=55296&&x<=57343||x===65279||(h[v++]=x):x<65536||x>1114111||(h[v++]=x)),this.interim.fill(0)}for(var R=u-4,E=p;E<u;){for(;!(!(E<R)||128&(c=l[E])||128&(f=l[E+1])||128&(d=l[E+2])||128&(m=l[E+3]));)h[v++]=c,h[v++]=f,h[v++]=d,h[v++]=m,E+=4;if((c=l[E++])<128)h[v++]=c;else if((224&c)==192){if(E>=u)return this.interim[0]=c,v;if((192&(f=l[E++]))!=128){E--;continue}if((g=(31&c)<<6|63&f)<128){E--;continue}h[v++]=g}else if((240&c)==224){if(E>=u)return this.interim[0]=c,v;if((192&(f=l[E++]))!=128){E--;continue}if(E>=u)return this.interim[0]=c,this.interim[1]=f,v;if((192&(d=l[E++]))!=128){E--;continue}if((g=(15&c)<<12|(63&f)<<6|63&d)<2048||g>=55296&&g<=57343||g===65279)continue;h[v++]=g}else if((248&c)==240){if(E>=u)return this.interim[0]=c,v;if((192&(f=l[E++]))!=128){E--;continue}if(E>=u)return this.interim[0]=c,this.interim[1]=f,v;if((192&(d=l[E++]))!=128){E--;continue}if(E>=u)return this.interim[0]=c,this.interim[1]=f,this.interim[2]=d,v;if((192&(m=l[E++]))!=128){E--;continue}if((g=(7&c)<<18|(63&f)<<12|(63&d)<<6|63&m)<65536||g>1114111)continue;h[v++]=g}}return v},a}();r.Utf8ToUtf32=o},225:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeV6=void 0;var o,a=n(8273),l=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],h=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],u=function(){function c(){if(this.version="6",!o){o=new Uint8Array(65536),(0,a.fill)(o,1),o[0]=0,(0,a.fill)(o,0,1,32),(0,a.fill)(o,0,127,160),(0,a.fill)(o,2,4352,4448),o[9001]=2,o[9002]=2,(0,a.fill)(o,2,11904,42192),o[12351]=1,(0,a.fill)(o,2,44032,55204),(0,a.fill)(o,2,63744,64256),(0,a.fill)(o,2,65040,65050),(0,a.fill)(o,2,65072,65136),(0,a.fill)(o,2,65280,65377),(0,a.fill)(o,2,65504,65511);for(var f=0;f<l.length;++f)(0,a.fill)(o,0,l[f][0],l[f][1]+1)}}return c.prototype.wcwidth=function(f){return f<32?0:f<127?1:f<65536?o[f]:function(d,m){var v,g=0,p=m.length-1;if(d<m[0][0]||d>m[p][1])return!1;for(;p>=g;)if(d>m[v=g+p>>1][1])g=v+1;else{if(!(d<m[v][0]))return!0;p=v-1}return!1}(f,h)?0:f>=131072&&f<=196605||f>=196608&&f<=262141?2:1},c}();r.UnicodeV6=u},5981:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WriteBuffer=void 0;var o=n(8460),a=typeof queueMicrotask=="undefined"?function(h){Promise.resolve().then(h)}:queueMicrotask,l=function(){function h(u){this._action=u,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._onWriteParsed=new o.EventEmitter}return Object.defineProperty(h.prototype,"onWriteParsed",{get:function(){return this._onWriteParsed.event},enumerable:!1,configurable:!0}),h.prototype.writeSync=function(u,c){if(c!==void 0&&this._syncCalls>c)this._syncCalls=0;else if(this._pendingData+=u.length,this._writeBuffer.push(u),this._callbacks.push(void 0),this._syncCalls++,!this._isSyncWriting){var f;for(this._isSyncWriting=!0;f=this._writeBuffer.shift();){this._action(f);var d=this._callbacks.shift();d&&d()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}},h.prototype.write=function(u,c){var f=this;if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");this._writeBuffer.length||(this._bufferOffset=0,setTimeout(function(){return f._innerWrite()})),this._pendingData+=u.length,this._writeBuffer.push(u),this._callbacks.push(c)},h.prototype._innerWrite=function(u,c){var f=this;u===void 0&&(u=0),c===void 0&&(c=!0);for(var d=u||Date.now();this._writeBuffer.length>this._bufferOffset;){var m=this._writeBuffer[this._bufferOffset],v=this._action(m,c);if(v)return void v.catch(function(p){return a(function(){throw p}),Promise.resolve(!1)}).then(function(p){return Date.now()-d>=12?setTimeout(function(){return f._innerWrite(0,p)}):f._innerWrite(d,p)});var g=this._callbacks[this._bufferOffset];if(g&&g(),this._bufferOffset++,this._pendingData-=m.length,Date.now()-d>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(function(){return f._innerWrite()})):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()},h}();r.WriteBuffer=l},5941:function(i,r){var n=this&&this.__read||function(h,u){var c=typeof Symbol=="function"&&h[Symbol.iterator];if(!c)return h;var f,d,m=c.call(h),v=[];try{for(;(u===void 0||u-- >0)&&!(f=m.next()).done;)v.push(f.value)}catch(g){d={error:g}}finally{try{f&&!f.done&&(c=m.return)&&c.call(m)}finally{if(d)throw d.error}}return v};Object.defineProperty(r,"__esModule",{value:!0}),r.toRgbString=r.parseColor=void 0;var o=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,a=/^[\da-f]+$/;function l(h,u){var c=h.toString(16),f=c.length<2?"0"+c:c;switch(u){case 4:return c[0];case 8:return f;case 12:return(f+f).slice(0,3);default:return f+f}}r.parseColor=function(h){if(h){var u=h.toLowerCase();if(u.indexOf("rgb:")===0){u=u.slice(4);var c=o.exec(u);if(c){var f=c[1]?15:c[4]?255:c[7]?4095:65535;return[Math.round(parseInt(c[1]||c[4]||c[7]||c[10],16)/f*255),Math.round(parseInt(c[2]||c[5]||c[8]||c[11],16)/f*255),Math.round(parseInt(c[3]||c[6]||c[9]||c[12],16)/f*255)]}}else if(u.indexOf("#")===0&&(u=u.slice(1),a.exec(u)&&[3,6,9,12].includes(u.length))){for(var d=u.length/3,m=[0,0,0],v=0;v<3;++v){var g=parseInt(u.slice(d*v,d*v+d),16);m[v]=d===1?g<<4:d===2?g:d===3?g>>4:g>>8}return m}}},r.toRgbString=function(h,u){u===void 0&&(u=16);var c=n(h,3),f=c[0],d=c[1],m=c[2];return"rgb:"+l(f,u)+"/"+l(d,u)+"/"+l(m,u)}},5770:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PAYLOAD_LIMIT=void 0,r.PAYLOAD_LIMIT=1e7},6351:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DcsHandler=r.DcsParser=void 0;var o=n(482),a=n(8742),l=n(5770),h=[],u=function(){function d(){this._handlers=Object.create(null),this._active=h,this._ident=0,this._handlerFb=function(){},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}return d.prototype.dispose=function(){this._handlers=Object.create(null),this._handlerFb=function(){},this._active=h},d.prototype.registerHandler=function(m,v){this._handlers[m]===void 0&&(this._handlers[m]=[]);var g=this._handlers[m];return g.push(v),{dispose:function(){var p=g.indexOf(v);p!==-1&&g.splice(p,1)}}},d.prototype.clearHandler=function(m){this._handlers[m]&&delete this._handlers[m]},d.prototype.setHandlerFallback=function(m){this._handlerFb=m},d.prototype.reset=function(){if(this._active.length)for(var m=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;m>=0;--m)this._active[m].unhook(!1);this._stack.paused=!1,this._active=h,this._ident=0},d.prototype.hook=function(m,v){if(this.reset(),this._ident=m,this._active=this._handlers[m]||h,this._active.length)for(var g=this._active.length-1;g>=0;g--)this._active[g].hook(v);else this._handlerFb(this._ident,"HOOK",v)},d.prototype.put=function(m,v,g){if(this._active.length)for(var p=this._active.length-1;p>=0;p--)this._active[p].put(m,v,g);else this._handlerFb(this._ident,"PUT",(0,o.utf32ToString)(m,v,g))},d.prototype.unhook=function(m,v){if(v===void 0&&(v=!0),this._active.length){var g=!1,p=this._active.length-1,_=!1;if(this._stack.paused&&(p=this._stack.loopPosition-1,g=v,_=this._stack.fallThrough,this._stack.paused=!1),!_&&g===!1){for(;p>=0&&(g=this._active[p].unhook(m))!==!0;p--)if(g instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=p,this._stack.fallThrough=!1,g;p--}for(;p>=0;p--)if((g=this._active[p].unhook(!1))instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=p,this._stack.fallThrough=!0,g}else this._handlerFb(this._ident,"UNHOOK",m);this._active=h,this._ident=0},d}();r.DcsParser=u;var c=new a.Params;c.addParam(0);var f=function(){function d(m){this._handler=m,this._data="",this._params=c,this._hitLimit=!1}return d.prototype.hook=function(m){this._params=m.length>1||m.params[0]?m.clone():c,this._data="",this._hitLimit=!1},d.prototype.put=function(m,v,g){this._hitLimit||(this._data+=(0,o.utf32ToString)(m,v,g),this._data.length>l.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))},d.prototype.unhook=function(m){var v=this,g=!1;if(this._hitLimit)g=!1;else if(m&&(g=this._handler(this._data,this._params))instanceof Promise)return g.then(function(p){return v._params=c,v._data="",v._hitLimit=!1,p});return this._params=c,this._data="",this._hitLimit=!1,g},d}();r.DcsHandler=f},2015:function(i,r,n){var o,a=this&&this.__extends||(o=function(g,p){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,x){_.__proto__=x}||function(_,x){for(var b in x)Object.prototype.hasOwnProperty.call(x,b)&&(_[b]=x[b])},o(g,p)},function(g,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function _(){this.constructor=g}o(g,p),g.prototype=p===null?Object.create(p):(_.prototype=p.prototype,new _)});Object.defineProperty(r,"__esModule",{value:!0}),r.EscapeSequenceParser=r.VT500_TRANSITION_TABLE=r.TransitionTable=void 0;var l=n(844),h=n(8273),u=n(8742),c=n(6242),f=n(6351),d=function(){function g(p){this.table=new Uint8Array(p)}return g.prototype.setDefault=function(p,_){(0,h.fill)(this.table,p<<4|_)},g.prototype.add=function(p,_,x,b){this.table[_<<8|p]=x<<4|b},g.prototype.addMany=function(p,_,x,b){for(var y=0;y<p.length;y++)this.table[_<<8|p[y]]=x<<4|b},g}();r.TransitionTable=d;var m=160;r.VT500_TRANSITION_TABLE=function(){var g=new d(4095),p=Array.apply(null,Array(256)).map(function(S,R){return R}),_=function(S,R){return p.slice(S,R)},x=_(32,127),b=_(0,24);b.push(25),b.push.apply(b,_(28,32));var y,w=_(0,14);for(y in g.setDefault(1,0),g.addMany(x,0,2,0),w)g.addMany([24,26,153,154],y,3,0),g.addMany(_(128,144),y,3,0),g.addMany(_(144,152),y,3,0),g.add(156,y,0,0),g.add(27,y,11,1),g.add(157,y,4,8),g.addMany([152,158,159],y,0,7),g.add(155,y,11,3),g.add(144,y,11,9);return g.addMany(b,0,3,0),g.addMany(b,1,3,1),g.add(127,1,0,1),g.addMany(b,8,0,8),g.addMany(b,3,3,3),g.add(127,3,0,3),g.addMany(b,4,3,4),g.add(127,4,0,4),g.addMany(b,6,3,6),g.addMany(b,5,3,5),g.add(127,5,0,5),g.addMany(b,2,3,2),g.add(127,2,0,2),g.add(93,1,4,8),g.addMany(x,8,5,8),g.add(127,8,5,8),g.addMany([156,27,24,26,7],8,6,0),g.addMany(_(28,32),8,0,8),g.addMany([88,94,95],1,0,7),g.addMany(x,7,0,7),g.addMany(b,7,0,7),g.add(156,7,0,0),g.add(127,7,0,7),g.add(91,1,11,3),g.addMany(_(64,127),3,7,0),g.addMany(_(48,60),3,8,4),g.addMany([60,61,62,63],3,9,4),g.addMany(_(48,60),4,8,4),g.addMany(_(64,127),4,7,0),g.addMany([60,61,62,63],4,0,6),g.addMany(_(32,64),6,0,6),g.add(127,6,0,6),g.addMany(_(64,127),6,0,0),g.addMany(_(32,48),3,9,5),g.addMany(_(32,48),5,9,5),g.addMany(_(48,64),5,0,6),g.addMany(_(64,127),5,7,0),g.addMany(_(32,48),4,9,5),g.addMany(_(32,48),1,9,2),g.addMany(_(32,48),2,9,2),g.addMany(_(48,127),2,10,0),g.addMany(_(48,80),1,10,0),g.addMany(_(81,88),1,10,0),g.addMany([89,90,92],1,10,0),g.addMany(_(96,127),1,10,0),g.add(80,1,11,9),g.addMany(b,9,0,9),g.add(127,9,0,9),g.addMany(_(28,32),9,0,9),g.addMany(_(32,48),9,9,12),g.addMany(_(48,60),9,8,10),g.addMany([60,61,62,63],9,9,10),g.addMany(b,11,0,11),g.addMany(_(32,128),11,0,11),g.addMany(_(28,32),11,0,11),g.addMany(b,10,0,10),g.add(127,10,0,10),g.addMany(_(28,32),10,0,10),g.addMany(_(48,60),10,8,10),g.addMany([60,61,62,63],10,0,11),g.addMany(_(32,48),10,9,12),g.addMany(b,12,0,12),g.add(127,12,0,12),g.addMany(_(28,32),12,0,12),g.addMany(_(32,48),12,9,12),g.addMany(_(48,64),12,0,11),g.addMany(_(64,127),12,12,13),g.addMany(_(64,127),10,12,13),g.addMany(_(64,127),9,12,13),g.addMany(b,13,13,13),g.addMany(x,13,13,13),g.add(127,13,0,13),g.addMany([27,156,24,26],13,14,0),g.add(m,0,2,0),g.add(m,8,5,8),g.add(m,6,0,6),g.add(m,11,0,11),g.add(m,13,13,13),g}();var v=function(g){function p(_){_===void 0&&(_=r.VT500_TRANSITION_TABLE);var x=g.call(this)||this;return x._transitions=_,x._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},x.initialState=0,x.currentState=x.initialState,x._params=new u.Params,x._params.addParam(0),x._collect=0,x.precedingCodepoint=0,x._printHandlerFb=function(b,y,w){},x._executeHandlerFb=function(b){},x._csiHandlerFb=function(b,y){},x._escHandlerFb=function(b){},x._errorHandlerFb=function(b){return b},x._printHandler=x._printHandlerFb,x._executeHandlers=Object.create(null),x._csiHandlers=Object.create(null),x._escHandlers=Object.create(null),x._oscParser=new c.OscParser,x._dcsParser=new f.DcsParser,x._errorHandler=x._errorHandlerFb,x.registerEscHandler({final:"\\"},function(){return!0}),x}return a(p,g),p.prototype._identifier=function(_,x){x===void 0&&(x=[64,126]);var b=0;if(_.prefix){if(_.prefix.length>1)throw new Error("only one byte as prefix supported");if((b=_.prefix.charCodeAt(0))&&60>b||b>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(_.intermediates){if(_.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(var y=0;y<_.intermediates.length;++y){var w=_.intermediates.charCodeAt(y);if(32>w||w>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");b<<=8,b|=w}}if(_.final.length!==1)throw new Error("final must be a single byte");var S=_.final.charCodeAt(0);if(x[0]>S||S>x[1])throw new Error("final must be in range "+x[0]+" .. "+x[1]);return(b<<=8)|S},p.prototype.identToString=function(_){for(var x=[];_;)x.push(String.fromCharCode(255&_)),_>>=8;return x.reverse().join("")},p.prototype.dispose=function(){this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null),this._oscParser.dispose(),this._dcsParser.dispose()},p.prototype.setPrintHandler=function(_){this._printHandler=_},p.prototype.clearPrintHandler=function(){this._printHandler=this._printHandlerFb},p.prototype.registerEscHandler=function(_,x){var b=this._identifier(_,[48,126]);this._escHandlers[b]===void 0&&(this._escHandlers[b]=[]);var y=this._escHandlers[b];return y.push(x),{dispose:function(){var w=y.indexOf(x);w!==-1&&y.splice(w,1)}}},p.prototype.clearEscHandler=function(_){this._escHandlers[this._identifier(_,[48,126])]&&delete this._escHandlers[this._identifier(_,[48,126])]},p.prototype.setEscHandlerFallback=function(_){this._escHandlerFb=_},p.prototype.setExecuteHandler=function(_,x){this._executeHandlers[_.charCodeAt(0)]=x},p.prototype.clearExecuteHandler=function(_){this._executeHandlers[_.charCodeAt(0)]&&delete this._executeHandlers[_.charCodeAt(0)]},p.prototype.setExecuteHandlerFallback=function(_){this._executeHandlerFb=_},p.prototype.registerCsiHandler=function(_,x){var b=this._identifier(_);this._csiHandlers[b]===void 0&&(this._csiHandlers[b]=[]);var y=this._csiHandlers[b];return y.push(x),{dispose:function(){var w=y.indexOf(x);w!==-1&&y.splice(w,1)}}},p.prototype.clearCsiHandler=function(_){this._csiHandlers[this._identifier(_)]&&delete this._csiHandlers[this._identifier(_)]},p.prototype.setCsiHandlerFallback=function(_){this._csiHandlerFb=_},p.prototype.registerDcsHandler=function(_,x){return this._dcsParser.registerHandler(this._identifier(_),x)},p.prototype.clearDcsHandler=function(_){this._dcsParser.clearHandler(this._identifier(_))},p.prototype.setDcsHandlerFallback=function(_){this._dcsParser.setHandlerFallback(_)},p.prototype.registerOscHandler=function(_,x){return this._oscParser.registerHandler(_,x)},p.prototype.clearOscHandler=function(_){this._oscParser.clearHandler(_)},p.prototype.setOscHandlerFallback=function(_){this._oscParser.setHandlerFallback(_)},p.prototype.setErrorHandler=function(_){this._errorHandler=_},p.prototype.clearErrorHandler=function(){this._errorHandler=this._errorHandlerFb},p.prototype.reset=function(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])},p.prototype._preserveStack=function(_,x,b,y,w){this._parseStack.state=_,this._parseStack.handlers=x,this._parseStack.handlerPos=b,this._parseStack.transition=y,this._parseStack.chunkPos=w},p.prototype.parse=function(_,x,b){var y,w=0,S=0,R=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,R=this._parseStack.chunkPos+1;else{if(b===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");var E=this._parseStack.handlers,T=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(b===!1&&T>-1){for(;T>=0&&(y=E[T](this._params))!==!0;T--)if(y instanceof Promise)return this._parseStack.handlerPos=T,y}this._parseStack.handlers=[];break;case 4:if(b===!1&&T>-1){for(;T>=0&&(y=E[T]())!==!0;T--)if(y instanceof Promise)return this._parseStack.handlerPos=T,y}this._parseStack.handlers=[];break;case 6:if(w=_[this._parseStack.chunkPos],y=this._dcsParser.unhook(w!==24&&w!==26,b))return y;w===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(w=_[this._parseStack.chunkPos],y=this._oscParser.end(w!==24&&w!==26,b))return y;w===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,R=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(var A=R;A<x;++A){switch(w=_[A],(S=this._transitions.table[this.currentState<<8|(w<160?w:m)])>>4){case 2:for(var C=A+1;;++C){if(C>=x||(w=_[C])<32||w>126&&w<m){this._printHandler(_,A,C),A=C-1;break}if(++C>=x||(w=_[C])<32||w>126&&w<m){this._printHandler(_,A,C),A=C-1;break}if(++C>=x||(w=_[C])<32||w>126&&w<m){this._printHandler(_,A,C),A=C-1;break}if(++C>=x||(w=_[C])<32||w>126&&w<m){this._printHandler(_,A,C),A=C-1;break}}break;case 3:this._executeHandlers[w]?this._executeHandlers[w]():this._executeHandlerFb(w),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:A,code:w,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:for(var M=(E=this._csiHandlers[this._collect<<8|w])?E.length-1:-1;M>=0&&(y=E[M](this._params))!==!0;M--)if(y instanceof Promise)return this._preserveStack(3,E,M,S,A),y;M<0&&this._csiHandlerFb(this._collect<<8|w,this._params),this.precedingCodepoint=0;break;case 8:do switch(w){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(w-48)}while(++A<x&&(w=_[A])>47&&w<60);A--;break;case 9:this._collect<<=8,this._collect|=w;break;case 10:for(var D=this._escHandlers[this._collect<<8|w],O=D?D.length-1:-1;O>=0&&(y=D[O]())!==!0;O--)if(y instanceof Promise)return this._preserveStack(4,D,O,S,A),y;O<0&&this._escHandlerFb(this._collect<<8|w),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|w,this._params);break;case 13:for(var P=A+1;;++P)if(P>=x||(w=_[P])===24||w===26||w===27||w>127&&w<m){this._dcsParser.put(_,A,P),A=P-1;break}break;case 14:if(y=this._dcsParser.unhook(w!==24&&w!==26))return this._preserveStack(6,[],0,S,A),y;w===27&&(S|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(var L=A+1;;L++)if(L>=x||(w=_[L])<32||w>127&&w<m){this._oscParser.put(_,A,L),A=L-1;break}break;case 6:if(y=this._oscParser.end(w!==24&&w!==26))return this._preserveStack(5,[],0,S,A),y;w===27&&(S|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&S}},p}(l.Disposable);r.EscapeSequenceParser=v},6242:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OscHandler=r.OscParser=void 0;var o=n(5770),a=n(482),l=[],h=function(){function c(){this._state=0,this._active=l,this._id=-1,this._handlers=Object.create(null),this._handlerFb=function(){},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}return c.prototype.registerHandler=function(f,d){this._handlers[f]===void 0&&(this._handlers[f]=[]);var m=this._handlers[f];return m.push(d),{dispose:function(){var v=m.indexOf(d);v!==-1&&m.splice(v,1)}}},c.prototype.clearHandler=function(f){this._handlers[f]&&delete this._handlers[f]},c.prototype.setHandlerFallback=function(f){this._handlerFb=f},c.prototype.dispose=function(){this._handlers=Object.create(null),this._handlerFb=function(){},this._active=l},c.prototype.reset=function(){if(this._state===2)for(var f=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;f>=0;--f)this._active[f].end(!1);this._stack.paused=!1,this._active=l,this._id=-1,this._state=0},c.prototype._start=function(){if(this._active=this._handlers[this._id]||l,this._active.length)for(var f=this._active.length-1;f>=0;f--)this._active[f].start();else this._handlerFb(this._id,"START")},c.prototype._put=function(f,d,m){if(this._active.length)for(var v=this._active.length-1;v>=0;v--)this._active[v].put(f,d,m);else this._handlerFb(this._id,"PUT",(0,a.utf32ToString)(f,d,m))},c.prototype.start=function(){this.reset(),this._state=1},c.prototype.put=function(f,d,m){if(this._state!==3){if(this._state===1)for(;d<m;){var v=f[d++];if(v===59){this._state=2,this._start();break}if(v<48||57<v)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+v-48}this._state===2&&m-d>0&&this._put(f,d,m)}},c.prototype.end=function(f,d){if(d===void 0&&(d=!0),this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){var m=!1,v=this._active.length-1,g=!1;if(this._stack.paused&&(v=this._stack.loopPosition-1,m=d,g=this._stack.fallThrough,this._stack.paused=!1),!g&&m===!1){for(;v>=0&&(m=this._active[v].end(f))!==!0;v--)if(m instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!1,m;v--}for(;v>=0;v--)if((m=this._active[v].end(!1))instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!0,m}else this._handlerFb(this._id,"END",f);this._active=l,this._id=-1,this._state=0}},c}();r.OscParser=h;var u=function(){function c(f){this._handler=f,this._data="",this._hitLimit=!1}return c.prototype.start=function(){this._data="",this._hitLimit=!1},c.prototype.put=function(f,d,m){this._hitLimit||(this._data+=(0,a.utf32ToString)(f,d,m),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))},c.prototype.end=function(f){var d=this,m=!1;if(this._hitLimit)m=!1;else if(f&&(m=this._handler(this._data))instanceof Promise)return m.then(function(v){return d._data="",d._hitLimit=!1,v});return this._data="",this._hitLimit=!1,m},c}();r.OscHandler=u},8742:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Params=void 0;var n=2147483647,o=function(){function a(l,h){if(l===void 0&&(l=32),h===void 0&&(h=32),this.maxLength=l,this.maxSubParamsLength=h,h>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(l),this.length=0,this._subParams=new Int32Array(h),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(l),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}return a.fromArray=function(l){var h=new a;if(!l.length)return h;for(var u=Array.isArray(l[0])?1:0;u<l.length;++u){var c=l[u];if(Array.isArray(c))for(var f=0;f<c.length;++f)h.addSubParam(c[f]);else h.addParam(c)}return h},a.prototype.clone=function(){var l=new a(this.maxLength,this.maxSubParamsLength);return l.params.set(this.params),l.length=this.length,l._subParams.set(this._subParams),l._subParamsLength=this._subParamsLength,l._subParamsIdx.set(this._subParamsIdx),l._rejectDigits=this._rejectDigits,l._rejectSubDigits=this._rejectSubDigits,l._digitIsSub=this._digitIsSub,l},a.prototype.toArray=function(){for(var l=[],h=0;h<this.length;++h){l.push(this.params[h]);var u=this._subParamsIdx[h]>>8,c=255&this._subParamsIdx[h];c-u>0&&l.push(Array.prototype.slice.call(this._subParams,u,c))}return l},a.prototype.reset=function(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1},a.prototype.addParam=function(l){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(l<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=l>n?n:l}},a.prototype.addSubParam=function(l){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(l<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=l>n?n:l,this._subParamsIdx[this.length-1]++}},a.prototype.hasSubParams=function(l){return(255&this._subParamsIdx[l])-(this._subParamsIdx[l]>>8)>0},a.prototype.getSubParams=function(l){var h=this._subParamsIdx[l]>>8,u=255&this._subParamsIdx[l];return u-h>0?this._subParams.subarray(h,u):null},a.prototype.getSubParamsAll=function(){for(var l={},h=0;h<this.length;++h){var u=this._subParamsIdx[h]>>8,c=255&this._subParamsIdx[h];c-u>0&&(l[h]=this._subParams.slice(u,c))}return l},a.prototype.addDigit=function(l){var h;if(!(this._rejectDigits||!(h=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)){var u=this._digitIsSub?this._subParams:this.params,c=u[h-1];u[h-1]=~c?Math.min(10*c+l,n):l}},a}();r.Params=o},5741:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AddonManager=void 0;var n=function(){function o(){this._addons=[]}return o.prototype.dispose=function(){for(var a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()},o.prototype.loadAddon=function(a,l){var h=this,u={instance:l,dispose:l.dispose,isDisposed:!1};this._addons.push(u),l.dispose=function(){return h._wrappedAddonDispose(u)},l.activate(a)},o.prototype._wrappedAddonDispose=function(a){if(!a.isDisposed){for(var l=-1,h=0;h<this._addons.length;h++)if(this._addons[h]===a){l=h;break}if(l===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(l,1)}},o}();r.AddonManager=n},8771:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferApiView=void 0;var o=n(3785),a=n(511),l=function(){function h(u,c){this._buffer=u,this.type=c}return h.prototype.init=function(u){return this._buffer=u,this},Object.defineProperty(h.prototype,"cursorY",{get:function(){return this._buffer.y},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"cursorX",{get:function(){return this._buffer.x},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"viewportY",{get:function(){return this._buffer.ydisp},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"baseY",{get:function(){return this._buffer.ybase},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"length",{get:function(){return this._buffer.lines.length},enumerable:!1,configurable:!0}),h.prototype.getLine=function(u){var c=this._buffer.lines.get(u);if(c)return new o.BufferLineApiView(c)},h.prototype.getNullCell=function(){return new a.CellData},h}();r.BufferApiView=l},3785:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferLineApiView=void 0;var o=n(511),a=function(){function l(h){this._line=h}return Object.defineProperty(l.prototype,"isWrapped",{get:function(){return this._line.isWrapped},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"length",{get:function(){return this._line.length},enumerable:!1,configurable:!0}),l.prototype.getCell=function(h,u){if(!(h<0||h>=this._line.length))return u?(this._line.loadCell(h,u),u):this._line.loadCell(h,new o.CellData)},l.prototype.translateToString=function(h,u,c){return this._line.translateToString(h,u,c)},l}();r.BufferLineApiView=a},8285:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BufferNamespaceApi=void 0;var o=n(8771),a=n(8460),l=function(){function h(u){var c=this;this._core=u,this._onBufferChange=new a.EventEmitter,this._normal=new o.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new o.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(function(){return c._onBufferChange.fire(c.active)})}return Object.defineProperty(h.prototype,"onBufferChange",{get:function(){return this._onBufferChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"active",{get:function(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"normal",{get:function(){return this._normal.init(this._core.buffers.normal)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"alternate",{get:function(){return this._alternate.init(this._core.buffers.alt)},enumerable:!1,configurable:!0}),h}();r.BufferNamespaceApi=l},7975:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ParserApi=void 0;var n=function(){function o(a){this._core=a}return o.prototype.registerCsiHandler=function(a,l){return this._core.registerCsiHandler(a,function(h){return l(h.toArray())})},o.prototype.addCsiHandler=function(a,l){return this.registerCsiHandler(a,l)},o.prototype.registerDcsHandler=function(a,l){return this._core.registerDcsHandler(a,function(h,u){return l(h,u.toArray())})},o.prototype.addDcsHandler=function(a,l){return this.registerDcsHandler(a,l)},o.prototype.registerEscHandler=function(a,l){return this._core.registerEscHandler(a,l)},o.prototype.addEscHandler=function(a,l){return this.registerEscHandler(a,l)},o.prototype.registerOscHandler=function(a,l){return this._core.registerOscHandler(a,l)},o.prototype.addOscHandler=function(a,l){return this.registerOscHandler(a,l)},o}();r.ParserApi=n},7090:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeApi=void 0;var n=function(){function o(a){this._core=a}return o.prototype.register=function(a){this._core.unicodeService.register(a)},Object.defineProperty(o.prototype,"versions",{get:function(){return this._core.unicodeService.versions},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"activeVersion",{get:function(){return this._core.unicodeService.activeVersion},set:function(a){this._core.unicodeService.activeVersion=a},enumerable:!1,configurable:!0}),o}();r.UnicodeApi=n},744:function(i,r,n){var o,a=this&&this.__extends||(o=function(v,g){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,_){p.__proto__=_}||function(p,_){for(var x in _)Object.prototype.hasOwnProperty.call(_,x)&&(p[x]=_[x])},o(v,g)},function(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function p(){this.constructor=v}o(v,g),v.prototype=g===null?Object.create(g):(p.prototype=g.prototype,new p)}),l=this&&this.__decorate||function(v,g,p,_){var x,b=arguments.length,y=b<3?g:_===null?_=Object.getOwnPropertyDescriptor(g,p):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(v,g,p,_);else for(var w=v.length-1;w>=0;w--)(x=v[w])&&(y=(b<3?x(y):b>3?x(g,p,y):x(g,p))||y);return b>3&&y&&Object.defineProperty(g,p,y),y},h=this&&this.__param||function(v,g){return function(p,_){g(p,_,v)}};Object.defineProperty(r,"__esModule",{value:!0}),r.BufferService=r.MINIMUM_ROWS=r.MINIMUM_COLS=void 0;var u=n(2585),c=n(5295),f=n(8460),d=n(844);r.MINIMUM_COLS=2,r.MINIMUM_ROWS=1;var m=function(v){function g(p){var _=v.call(this)||this;return _._optionsService=p,_.isUserScrolling=!1,_._onResize=new f.EventEmitter,_._onScroll=new f.EventEmitter,_.cols=Math.max(p.rawOptions.cols||0,r.MINIMUM_COLS),_.rows=Math.max(p.rawOptions.rows||0,r.MINIMUM_ROWS),_.buffers=new c.BufferSet(p,_),_}return a(g,v),Object.defineProperty(g.prototype,"onResize",{get:function(){return this._onResize.event},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"onScroll",{get:function(){return this._onScroll.event},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"buffer",{get:function(){return this.buffers.active},enumerable:!1,configurable:!0}),g.prototype.dispose=function(){v.prototype.dispose.call(this),this.buffers.dispose()},g.prototype.resize=function(p,_){this.cols=p,this.rows=_,this.buffers.resize(p,_),this.buffers.setupTabStops(this.cols),this._onResize.fire({cols:p,rows:_})},g.prototype.reset=function(){this.buffers.reset(),this.isUserScrolling=!1},g.prototype.scroll=function(p,_){_===void 0&&(_=!1);var x,b=this.buffer;(x=this._cachedBlankLine)&&x.length===this.cols&&x.getFg(0)===p.fg&&x.getBg(0)===p.bg||(x=b.getBlankLine(p,_),this._cachedBlankLine=x),x.isWrapped=_;var y=b.ybase+b.scrollTop,w=b.ybase+b.scrollBottom;if(b.scrollTop===0){var S=b.lines.isFull;w===b.lines.length-1?S?b.lines.recycle().copyFrom(x):b.lines.push(x.clone()):b.lines.splice(w+1,0,x.clone()),S?this.isUserScrolling&&(b.ydisp=Math.max(b.ydisp-1,0)):(b.ybase++,this.isUserScrolling||b.ydisp++)}else{var R=w-y+1;b.lines.shiftElements(y+1,R-1,-1),b.lines.set(w,x.clone())}this.isUserScrolling||(b.ydisp=b.ybase),this._onScroll.fire(b.ydisp)},g.prototype.scrollLines=function(p,_,x){var b=this.buffer;if(p<0){if(b.ydisp===0)return;this.isUserScrolling=!0}else p+b.ydisp>=b.ybase&&(this.isUserScrolling=!1);var y=b.ydisp;b.ydisp=Math.max(Math.min(b.ydisp+p,b.ybase),0),y!==b.ydisp&&(_||this._onScroll.fire(b.ydisp))},g.prototype.scrollPages=function(p){this.scrollLines(p*(this.rows-1))},g.prototype.scrollToTop=function(){this.scrollLines(-this.buffer.ydisp)},g.prototype.scrollToBottom=function(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)},g.prototype.scrollToLine=function(p){var _=p-this.buffer.ydisp;_!==0&&this.scrollLines(_)},l([h(0,u.IOptionsService)],g)}(d.Disposable);r.BufferService=m},7994:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CharsetService=void 0;var n=function(){function o(){this.glevel=0,this._charsets=[]}return o.prototype.reset=function(){this.charset=void 0,this._charsets=[],this.glevel=0},o.prototype.setgLevel=function(a){this.glevel=a,this.charset=this._charsets[a]},o.prototype.setgCharset=function(a,l){this._charsets[a]=l,this.glevel===a&&(this.charset=l)},o}();r.CharsetService=n},1753:function(i,r,n){var o=this&&this.__decorate||function(g,p,_,x){var b,y=arguments.length,w=y<3?p:x===null?x=Object.getOwnPropertyDescriptor(p,_):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,p,_,x);else for(var S=g.length-1;S>=0;S--)(b=g[S])&&(w=(y<3?b(w):y>3?b(p,_,w):b(p,_))||w);return y>3&&w&&Object.defineProperty(p,_,w),w},a=this&&this.__param||function(g,p){return function(_,x){p(_,x,g)}},l=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,_=p&&g[p],x=0;if(_)return _.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&x>=g.length&&(g=void 0),{value:g&&g[x++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreMouseService=void 0;var h=n(2585),u=n(8460),c={NONE:{events:0,restrict:function(){return!1}},X10:{events:1,restrict:function(g){return g.button!==4&&g.action===1&&(g.ctrl=!1,g.alt=!1,g.shift=!1,!0)}},VT200:{events:19,restrict:function(g){return g.action!==32}},DRAG:{events:23,restrict:function(g){return g.action!==32||g.button!==3}},ANY:{events:31,restrict:function(g){return!0}}};function f(g,p){var _=(g.ctrl?16:0)|(g.shift?4:0)|(g.alt?8:0);return g.button===4?(_|=64,_|=g.action):(_|=3&g.button,4&g.button&&(_|=64),8&g.button&&(_|=128),g.action===32?_|=32:g.action!==0||p||(_|=3)),_}var d=String.fromCharCode,m={DEFAULT:function(g){var p=[f(g,!1)+32,g.col+32,g.row+32];return p[0]>255||p[1]>255||p[2]>255?"":"\x1B[M"+d(p[0])+d(p[1])+d(p[2])},SGR:function(g){var p=g.action===0&&g.button!==4?"m":"M";return"\x1B[<"+f(g,!0)+";"+g.col+";"+g.row+p}},v=function(){function g(p,_){var x,b,y,w;this._bufferService=p,this._coreService=_,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._onProtocolChange=new u.EventEmitter,this._lastEvent=null;try{for(var S=l(Object.keys(c)),R=S.next();!R.done;R=S.next()){var E=R.value;this.addProtocol(E,c[E])}}catch(M){x={error:M}}finally{try{R&&!R.done&&(b=S.return)&&b.call(S)}finally{if(x)throw x.error}}try{for(var T=l(Object.keys(m)),A=T.next();!A.done;A=T.next()){var C=A.value;this.addEncoding(C,m[C])}}catch(M){y={error:M}}finally{try{A&&!A.done&&(w=T.return)&&w.call(T)}finally{if(y)throw y.error}}this.reset()}return g.prototype.addProtocol=function(p,_){this._protocols[p]=_},g.prototype.addEncoding=function(p,_){this._encodings[p]=_},Object.defineProperty(g.prototype,"activeProtocol",{get:function(){return this._activeProtocol},set:function(p){if(!this._protocols[p])throw new Error('unknown protocol "'+p+'"');this._activeProtocol=p,this._onProtocolChange.fire(this._protocols[p].events)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"areMouseEventsActive",{get:function(){return this._protocols[this._activeProtocol].events!==0},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"activeEncoding",{get:function(){return this._activeEncoding},set:function(p){if(!this._encodings[p])throw new Error('unknown encoding "'+p+'"');this._activeEncoding=p},enumerable:!1,configurable:!0}),g.prototype.reset=function(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null},Object.defineProperty(g.prototype,"onProtocolChange",{get:function(){return this._onProtocolChange.event},enumerable:!1,configurable:!0}),g.prototype.triggerMouseEvent=function(p){if(p.col<0||p.col>=this._bufferService.cols||p.row<0||p.row>=this._bufferService.rows||p.button===4&&p.action===32||p.button===3&&p.action!==32||p.button!==4&&(p.action===2||p.action===3)||(p.col++,p.row++,p.action===32&&this._lastEvent&&this._compareEvents(this._lastEvent,p))||!this._protocols[this._activeProtocol].restrict(p))return!1;var _=this._encodings[this._activeEncoding](p);return _&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(_):this._coreService.triggerDataEvent(_,!0)),this._lastEvent=p,!0},g.prototype.explainEvents=function(p){return{down:!!(1&p),up:!!(2&p),drag:!!(4&p),move:!!(8&p),wheel:!!(16&p)}},g.prototype._compareEvents=function(p,_){return p.col===_.col&&p.row===_.row&&p.button===_.button&&p.action===_.action&&p.ctrl===_.ctrl&&p.alt===_.alt&&p.shift===_.shift},o([a(0,h.IBufferService),a(1,h.ICoreService)],g)}();r.CoreMouseService=v},6975:function(i,r,n){var o,a=this&&this.__extends||(o=function(p,_){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,b){x.__proto__=b}||function(x,b){for(var y in b)Object.prototype.hasOwnProperty.call(b,y)&&(x[y]=b[y])},o(p,_)},function(p,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function x(){this.constructor=p}o(p,_),p.prototype=_===null?Object.create(_):(x.prototype=_.prototype,new x)}),l=this&&this.__decorate||function(p,_,x,b){var y,w=arguments.length,S=w<3?_:b===null?b=Object.getOwnPropertyDescriptor(_,x):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(p,_,x,b);else for(var R=p.length-1;R>=0;R--)(y=p[R])&&(S=(w<3?y(S):w>3?y(_,x,S):y(_,x))||S);return w>3&&S&&Object.defineProperty(_,x,S),S},h=this&&this.__param||function(p,_){return function(x,b){_(x,b,p)}};Object.defineProperty(r,"__esModule",{value:!0}),r.CoreService=void 0;var u=n(2585),c=n(8460),f=n(1439),d=n(844),m=Object.freeze({insertMode:!1}),v=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),g=function(p){function _(x,b,y,w){var S=p.call(this)||this;return S._bufferService=b,S._logService=y,S._optionsService=w,S.isCursorInitialized=!1,S.isCursorHidden=!1,S._onData=S.register(new c.EventEmitter),S._onUserInput=S.register(new c.EventEmitter),S._onBinary=S.register(new c.EventEmitter),S._scrollToBottom=x,S.register({dispose:function(){return S._scrollToBottom=void 0}}),S.modes=(0,f.clone)(m),S.decPrivateModes=(0,f.clone)(v),S}return a(_,p),Object.defineProperty(_.prototype,"onData",{get:function(){return this._onData.event},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onUserInput",{get:function(){return this._onUserInput.event},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onBinary",{get:function(){return this._onBinary.event},enumerable:!1,configurable:!0}),_.prototype.reset=function(){this.modes=(0,f.clone)(m),this.decPrivateModes=(0,f.clone)(v)},_.prototype.triggerDataEvent=function(x,b){if(b===void 0&&(b=!1),!this._optionsService.rawOptions.disableStdin){var y=this._bufferService.buffer;y.ybase!==y.ydisp&&this._scrollToBottom(),b&&this._onUserInput.fire(),this._logService.debug('sending data "'+x+'"',function(){return x.split("").map(function(w){return w.charCodeAt(0)})}),this._onData.fire(x)}},_.prototype.triggerBinaryEvent=function(x){this._optionsService.rawOptions.disableStdin||(this._logService.debug('sending binary "'+x+'"',function(){return x.split("").map(function(b){return b.charCodeAt(0)})}),this._onBinary.fire(x))},l([h(1,u.IBufferService),h(2,u.ILogService),h(3,u.IOptionsService)],_)}(d.Disposable);r.CoreService=g},9074:function(i,r,n){var o,a=this&&this.__extends||(o=function(g,p){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,x){_.__proto__=x}||function(_,x){for(var b in x)Object.prototype.hasOwnProperty.call(x,b)&&(_[b]=x[b])},o(g,p)},function(g,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function _(){this.constructor=g}o(g,p),g.prototype=p===null?Object.create(p):(_.prototype=p.prototype,new _)}),l=this&&this.__generator||function(g,p){var _,x,b,y,w={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return y={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function S(R){return function(E){return function(T){if(_)throw new TypeError("Generator is already executing.");for(;w;)try{if(_=1,x&&(b=2&T[0]?x.return:T[0]?x.throw||((b=x.return)&&b.call(x),0):x.next)&&!(b=b.call(x,T[1])).done)return b;switch(x=0,b&&(T=[2&T[0],b.value]),T[0]){case 0:case 1:b=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,x=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!((b=(b=w.trys).length>0&&b[b.length-1])||T[0]!==6&&T[0]!==2)){w=0;continue}if(T[0]===3&&(!b||T[1]>b[0]&&T[1]<b[3])){w.label=T[1];break}if(T[0]===6&&w.label<b[1]){w.label=b[1],b=T;break}if(b&&w.label<b[2]){w.label=b[2],w.ops.push(T);break}b[2]&&w.ops.pop(),w.trys.pop();continue}T=p.call(g,w)}catch(A){T=[6,A],x=0}finally{_=b=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([R,E])}}},h=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,_=p&&g[p],x=0;if(_)return _.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&x>=g.length&&(g=void 0),{value:g&&g[x++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(r,"__esModule",{value:!0}),r.DecorationService=void 0;var u=n(8055),c=n(8460),f=n(844),d=n(6106),m=function(g){function p(){var _=g.call(this)||this;return _._decorations=new d.SortedList(function(x){return x.marker.line}),_._onDecorationRegistered=_.register(new c.EventEmitter),_._onDecorationRemoved=_.register(new c.EventEmitter),_}return a(p,g),Object.defineProperty(p.prototype,"onDecorationRegistered",{get:function(){return this._onDecorationRegistered.event},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onDecorationRemoved",{get:function(){return this._onDecorationRemoved.event},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"decorations",{get:function(){return this._decorations.values()},enumerable:!1,configurable:!0}),p.prototype.registerDecoration=function(_){var x=this;if(!_.marker.isDisposed){var b=new v(_);if(b){var y=b.marker.onDispose(function(){return b.dispose()});b.onDispose(function(){b&&(x._decorations.delete(b)&&x._onDecorationRemoved.fire(b),y.dispose())}),this._decorations.insert(b),this._onDecorationRegistered.fire(b)}return b}},p.prototype.reset=function(){var _,x;try{for(var b=h(this._decorations.values()),y=b.next();!y.done;y=b.next())y.value.dispose()}catch(w){_={error:w}}finally{try{y&&!y.done&&(x=b.return)&&x.call(b)}finally{if(_)throw _.error}}this._decorations.clear()},p.prototype.getDecorationsAtLine=function(_){return l(this,function(x){return[2,this._decorations.getKeyIterator(_)]})},p.prototype.getDecorationsAtCell=function(_,x,b){var y,w,S,R,E,T,A,C,M,D,O;return l(this,function(P){switch(P.label){case 0:y=0,w=0,P.label=1;case 1:P.trys.push([1,6,7,8]),S=h(this._decorations.getKeyIterator(x)),R=S.next(),P.label=2;case 2:return R.done?[3,5]:(E=R.value,y=(M=E.options.x)!==null&&M!==void 0?M:0,w=y+((D=E.options.width)!==null&&D!==void 0?D:1),!(_>=y&&_<w)||b&&((O=E.options.layer)!==null&&O!==void 0?O:"bottom")!==b?[3,4]:[4,E]);case 3:P.sent(),P.label=4;case 4:return R=S.next(),[3,2];case 5:return[3,8];case 6:return T=P.sent(),A={error:T},[3,8];case 7:try{R&&!R.done&&(C=S.return)&&C.call(S)}finally{if(A)throw A.error}return[7];case 8:return[2]}})},p.prototype.dispose=function(){var _,x;try{for(var b=h(this._decorations.values()),y=b.next();!y.done;y=b.next()){var w=y.value;this._onDecorationRemoved.fire(w)}}catch(S){_={error:S}}finally{try{y&&!y.done&&(x=b.return)&&x.call(b)}finally{if(_)throw _.error}}this.reset()},p}(f.Disposable);r.DecorationService=m;var v=function(g){function p(_){var x=g.call(this)||this;return x.options=_,x.isDisposed=!1,x.onRenderEmitter=x.register(new c.EventEmitter),x.onRender=x.onRenderEmitter.event,x._onDispose=x.register(new c.EventEmitter),x.onDispose=x._onDispose.event,x._cachedBg=null,x._cachedFg=null,x.marker=_.marker,x.options.overviewRulerOptions&&!x.options.overviewRulerOptions.position&&(x.options.overviewRulerOptions.position="full"),x}return a(p,g),Object.defineProperty(p.prototype,"backgroundColorRGB",{get:function(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=u.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"foregroundColorRGB",{get:function(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=u.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg},enumerable:!1,configurable:!0}),p.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._onDispose.fire(),g.prototype.dispose.call(this))},p}(f.Disposable)},3730:function(i,r,n){var o=this&&this.__decorate||function(u,c,f,d){var m,v=arguments.length,g=v<3?c:d===null?d=Object.getOwnPropertyDescriptor(c,f):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(u,c,f,d);else for(var p=u.length-1;p>=0;p--)(m=u[p])&&(g=(v<3?m(g):v>3?m(c,f,g):m(c,f))||g);return v>3&&g&&Object.defineProperty(c,f,g),g},a=this&&this.__param||function(u,c){return function(f,d){c(f,d,u)}};Object.defineProperty(r,"__esModule",{value:!0}),r.DirtyRowService=void 0;var l=n(2585),h=function(){function u(c){this._bufferService=c,this.clearRange()}return Object.defineProperty(u.prototype,"start",{get:function(){return this._start},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"end",{get:function(){return this._end},enumerable:!1,configurable:!0}),u.prototype.clearRange=function(){this._start=this._bufferService.buffer.y,this._end=this._bufferService.buffer.y},u.prototype.markDirty=function(c){c<this._start?this._start=c:c>this._end&&(this._end=c)},u.prototype.markRangeDirty=function(c,f){if(c>f){var d=c;c=f,f=d}c<this._start&&(this._start=c),f>this._end&&(this._end=f)},u.prototype.markAllDirty=function(){this.markRangeDirty(0,this._bufferService.rows-1)},o([a(0,l.IBufferService)],u)}();r.DirtyRowService=h},4348:function(i,r,n){var o=this&&this.__values||function(d){var m=typeof Symbol=="function"&&Symbol.iterator,v=m&&d[m],g=0;if(v)return v.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&g>=d.length&&(d=void 0),{value:d&&d[g++],done:!d}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(d,m){var v=typeof Symbol=="function"&&d[Symbol.iterator];if(!v)return d;var g,p,_=v.call(d),x=[];try{for(;(m===void 0||m-- >0)&&!(g=_.next()).done;)x.push(g.value)}catch(b){p={error:b}}finally{try{g&&!g.done&&(v=_.return)&&v.call(_)}finally{if(p)throw p.error}}return x},l=this&&this.__spreadArray||function(d,m,v){if(v||arguments.length===2)for(var g,p=0,_=m.length;p<_;p++)!g&&p in m||(g||(g=Array.prototype.slice.call(m,0,p)),g[p]=m[p]);return d.concat(g||Array.prototype.slice.call(m))};Object.defineProperty(r,"__esModule",{value:!0}),r.InstantiationService=r.ServiceCollection=void 0;var h=n(2585),u=n(8343),c=function(){function d(){for(var m,v,g=[],p=0;p<arguments.length;p++)g[p]=arguments[p];this._entries=new Map;try{for(var _=o(g),x=_.next();!x.done;x=_.next()){var b=a(x.value,2),y=b[0],w=b[1];this.set(y,w)}}catch(S){m={error:S}}finally{try{x&&!x.done&&(v=_.return)&&v.call(_)}finally{if(m)throw m.error}}}return d.prototype.set=function(m,v){var g=this._entries.get(m);return this._entries.set(m,v),g},d.prototype.forEach=function(m){this._entries.forEach(function(v,g){return m(g,v)})},d.prototype.has=function(m){return this._entries.has(m)},d.prototype.get=function(m){return this._entries.get(m)},d}();r.ServiceCollection=c;var f=function(){function d(){this._services=new c,this._services.set(h.IInstantiationService,this)}return d.prototype.setService=function(m,v){this._services.set(m,v)},d.prototype.getService=function(m){return this._services.get(m)},d.prototype.createInstance=function(m){for(var v,g,p=[],_=1;_<arguments.length;_++)p[_-1]=arguments[_];var x=(0,u.getServiceDependencies)(m).sort(function(T,A){return T.index-A.index}),b=[];try{for(var y=o(x),w=y.next();!w.done;w=y.next()){var S=w.value,R=this._services.get(S.id);if(!R)throw new Error("[createInstance] "+m.name+" depends on UNKNOWN service "+S.id+".");b.push(R)}}catch(T){v={error:T}}finally{try{w&&!w.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}var E=x.length>0?x[0].index:p.length;if(p.length!==E)throw new Error("[createInstance] First service dependency of "+m.name+" at position "+(E+1)+" conflicts with "+p.length+" static arguments");return new(m.bind.apply(m,l([void 0],a(l(l([],a(p),!1),a(b),!1)),!1)))},d}();r.InstantiationService=f},7866:function(i,r,n){var o=this&&this.__decorate||function(d,m,v,g){var p,_=arguments.length,x=_<3?m:g===null?g=Object.getOwnPropertyDescriptor(m,v):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(d,m,v,g);else for(var b=d.length-1;b>=0;b--)(p=d[b])&&(x=(_<3?p(x):_>3?p(m,v,x):p(m,v))||x);return _>3&&x&&Object.defineProperty(m,v,x),x},a=this&&this.__param||function(d,m){return function(v,g){m(v,g,d)}},l=this&&this.__read||function(d,m){var v=typeof Symbol=="function"&&d[Symbol.iterator];if(!v)return d;var g,p,_=v.call(d),x=[];try{for(;(m===void 0||m-- >0)&&!(g=_.next()).done;)x.push(g.value)}catch(b){p={error:b}}finally{try{g&&!g.done&&(v=_.return)&&v.call(_)}finally{if(p)throw p.error}}return x},h=this&&this.__spreadArray||function(d,m,v){if(v||arguments.length===2)for(var g,p=0,_=m.length;p<_;p++)!g&&p in m||(g||(g=Array.prototype.slice.call(m,0,p)),g[p]=m[p]);return d.concat(g||Array.prototype.slice.call(m))};Object.defineProperty(r,"__esModule",{value:!0}),r.LogService=void 0;var u=n(2585),c={debug:u.LogLevelEnum.DEBUG,info:u.LogLevelEnum.INFO,warn:u.LogLevelEnum.WARN,error:u.LogLevelEnum.ERROR,off:u.LogLevelEnum.OFF},f=function(){function d(m){var v=this;this._optionsService=m,this.logLevel=u.LogLevelEnum.OFF,this._updateLogLevel(),this._optionsService.onOptionChange(function(g){g==="logLevel"&&v._updateLogLevel()})}return d.prototype._updateLogLevel=function(){this.logLevel=c[this._optionsService.rawOptions.logLevel]},d.prototype._evalLazyOptionalParams=function(m){for(var v=0;v<m.length;v++)typeof m[v]=="function"&&(m[v]=m[v]())},d.prototype._log=function(m,v,g){this._evalLazyOptionalParams(g),m.call.apply(m,h([console,"xterm.js: "+v],l(g),!1))},d.prototype.debug=function(m){for(var v=[],g=1;g<arguments.length;g++)v[g-1]=arguments[g];this.logLevel<=u.LogLevelEnum.DEBUG&&this._log(console.log,m,v)},d.prototype.info=function(m){for(var v=[],g=1;g<arguments.length;g++)v[g-1]=arguments[g];this.logLevel<=u.LogLevelEnum.INFO&&this._log(console.info,m,v)},d.prototype.warn=function(m){for(var v=[],g=1;g<arguments.length;g++)v[g-1]=arguments[g];this.logLevel<=u.LogLevelEnum.WARN&&this._log(console.warn,m,v)},d.prototype.error=function(m){for(var v=[],g=1;g<arguments.length;g++)v[g-1]=arguments[g];this.logLevel<=u.LogLevelEnum.ERROR&&this._log(console.error,m,v)},o([a(0,u.IOptionsService)],d)}();r.LogService=f},7302:function(i,r,n){var o=this&&this.__assign||function(){return o=Object.assign||function(c){for(var f,d=1,m=arguments.length;d<m;d++)for(var v in f=arguments[d])Object.prototype.hasOwnProperty.call(f,v)&&(c[v]=f[v]);return c},o.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.OptionsService=r.DEFAULT_OPTIONS=r.DEFAULT_BELL_SOUND=void 0;var a=n(8460),l=n(6114);r.DEFAULT_BELL_SOUND="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjMyLjEwNAAAAAAAAAAAAAAA//tQxAADB8AhSmxhIIEVCSiJrDCQBTcu3UrAIwUdkRgQbFAZC1CQEwTJ9mjRvBA4UOLD8nKVOWfh+UlK3z/177OXrfOdKl7pyn3Xf//WreyTRUoAWgBgkOAGbZHBgG1OF6zM82DWbZaUmMBptgQhGjsyYqc9ae9XFz280948NMBWInljyzsNRFLPWdnZGWrddDsjK1unuSrVN9jJsK8KuQtQCtMBjCEtImISdNKJOopIpBFpNSMbIHCSRpRR5iakjTiyzLhchUUBwCgyKiweBv/7UsQbg8isVNoMPMjAAAA0gAAABEVFGmgqK////9bP/6XCykxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",r.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,bellSound:r.DEFAULT_BELL_SOUND,bellStyle:"none",drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,linkTooltipHoverDuration:500,letterSpacing:0,logLevel:"info",scrollback:1e3,scrollSensitivity:1,screenReaderMode:!1,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!0,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:l.isMac,rendererType:"canvas",windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:void 0};var h=["normal","bold","100","200","300","400","500","600","700","800","900"],u=function(){function c(f){this._onOptionChange=new a.EventEmitter;var d=o({},r.DEFAULT_OPTIONS);for(var m in f)if(m in d)try{var v=f[m];d[m]=this._sanitizeAndValidateOption(m,v)}catch(g){console.error(g)}this.rawOptions=d,this.options=o({},d),this._setupOptions()}return Object.defineProperty(c.prototype,"onOptionChange",{get:function(){return this._onOptionChange.event},enumerable:!1,configurable:!0}),c.prototype._setupOptions=function(){var f=this,d=function(p){if(!(p in r.DEFAULT_OPTIONS))throw new Error('No option with key "'+p+'"');return f.rawOptions[p]},m=function(p,_){if(!(p in r.DEFAULT_OPTIONS))throw new Error('No option with key "'+p+'"');_=f._sanitizeAndValidateOption(p,_),f.rawOptions[p]!==_&&(f.rawOptions[p]=_,f._onOptionChange.fire(p))};for(var v in this.rawOptions){var g={get:d.bind(this,v),set:m.bind(this,v)};Object.defineProperty(this.options,v,g)}},c.prototype.setOption=function(f,d){this.options[f]=d},c.prototype._sanitizeAndValidateOption=function(f,d){switch(f){case"bellStyle":case"cursorStyle":case"rendererType":case"wordSeparator":d||(d=r.DEFAULT_OPTIONS[f]);break;case"fontWeight":case"fontWeightBold":if(typeof d=="number"&&1<=d&&d<=1e3)break;d=h.includes(d)?d:r.DEFAULT_OPTIONS[f];break;case"cursorWidth":d=Math.floor(d);case"lineHeight":case"tabStopWidth":if(d<1)throw new Error(f+" cannot be less than 1, value: "+d);break;case"minimumContrastRatio":d=Math.max(1,Math.min(21,Math.round(10*d)/10));break;case"scrollback":if((d=Math.min(d,4294967295))<0)throw new Error(f+" cannot be less than 0, value: "+d);break;case"fastScrollSensitivity":case"scrollSensitivity":if(d<=0)throw new Error(f+" cannot be less than or equal to 0, value: "+d);case"rows":case"cols":if(!d&&d!==0)throw new Error(f+" must be numeric, value: "+d)}return d},c.prototype.getOption=function(f){return this.options[f]},c}();r.OptionsService=u},8343:(i,r)=>{function n(o,a,l){a.di$target===a?a.di$dependencies.push({id:o,index:l}):(a.di$dependencies=[{id:o,index:l}],a.di$target=a)}Object.defineProperty(r,"__esModule",{value:!0}),r.createDecorator=r.getServiceDependencies=r.serviceRegistry=void 0,r.serviceRegistry=new Map,r.getServiceDependencies=function(o){return o.di$dependencies||[]},r.createDecorator=function(o){if(r.serviceRegistry.has(o))return r.serviceRegistry.get(o);var a=function(l,h,u){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");n(a,l,u)};return a.toString=function(){return o},r.serviceRegistry.set(o,a),a}},2585:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.IDecorationService=r.IUnicodeService=r.IOptionsService=r.ILogService=r.LogLevelEnum=r.IInstantiationService=r.IDirtyRowService=r.ICharsetService=r.ICoreService=r.ICoreMouseService=r.IBufferService=void 0;var o,a=n(8343);r.IBufferService=(0,a.createDecorator)("BufferService"),r.ICoreMouseService=(0,a.createDecorator)("CoreMouseService"),r.ICoreService=(0,a.createDecorator)("CoreService"),r.ICharsetService=(0,a.createDecorator)("CharsetService"),r.IDirtyRowService=(0,a.createDecorator)("DirtyRowService"),r.IInstantiationService=(0,a.createDecorator)("InstantiationService"),(o=r.LogLevelEnum||(r.LogLevelEnum={}))[o.DEBUG=0]="DEBUG",o[o.INFO=1]="INFO",o[o.WARN=2]="WARN",o[o.ERROR=3]="ERROR",o[o.OFF=4]="OFF",r.ILogService=(0,a.createDecorator)("LogService"),r.IOptionsService=(0,a.createDecorator)("OptionsService"),r.IUnicodeService=(0,a.createDecorator)("UnicodeService"),r.IDecorationService=(0,a.createDecorator)("DecorationService")},1480:(i,r,n)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.UnicodeService=void 0;var o=n(8460),a=n(225),l=function(){function h(){this._providers=Object.create(null),this._active="",this._onChange=new o.EventEmitter;var u=new a.UnicodeV6;this.register(u),this._active=u.version,this._activeProvider=u}return Object.defineProperty(h.prototype,"onChange",{get:function(){return this._onChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"versions",{get:function(){return Object.keys(this._providers)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"activeVersion",{get:function(){return this._active},set:function(u){if(!this._providers[u])throw new Error('unknown Unicode version "'+u+'"');this._active=u,this._activeProvider=this._providers[u],this._onChange.fire(u)},enumerable:!1,configurable:!0}),h.prototype.register=function(u){this._providers[u.version]=u},h.prototype.wcwidth=function(u){return this._activeProvider.wcwidth(u)},h.prototype.getStringCellWidth=function(u){for(var c=0,f=u.length,d=0;d<f;++d){var m=u.charCodeAt(d);if(55296<=m&&m<=56319){if(++d>=f)return c+this.wcwidth(m);var v=u.charCodeAt(d);56320<=v&&v<=57343?m=1024*(m-55296)+v-56320+65536:c+=this.wcwidth(v)}c+=this.wcwidth(m)}return c},h}();r.UnicodeService=l}},e={};return function i(r){var n=e[r];if(n!==void 0)return n.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,i),o.exports}(4389)})()})});var zB=ae((I0,fS)=>{(function(t,e){typeof I0=="object"&&typeof fS=="object"?fS.exports=e():typeof define=="function"&&define.amd?define([],e):typeof I0=="object"?I0.FitAddon=e():t.FitAddon=e()})(self,function(){return(()=>{"use strict";var t={775:(i,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FitAddon=void 0;var n=function(){function o(){}return o.prototype.activate=function(a){this._terminal=a},o.prototype.dispose=function(){},o.prototype.fit=function(){var a=this.proposeDimensions();if(a&&this._terminal){var l=this._terminal._core;this._terminal.rows===a.rows&&this._terminal.cols===a.cols||(l._renderService.clear(),this._terminal.resize(a.cols,a.rows))}},o.prototype.proposeDimensions=function(){if(this._terminal&&this._terminal.element&&this._terminal.element.parentElement){var a=this._terminal._core;if(a._renderService.dimensions.actualCellWidth!==0&&a._renderService.dimensions.actualCellHeight!==0){var l=window.getComputedStyle(this._terminal.element.parentElement),h=parseInt(l.getPropertyValue("height")),u=Math.max(0,parseInt(l.getPropertyValue("width"))),c=window.getComputedStyle(this._terminal.element),f=h-(parseInt(c.getPropertyValue("padding-top"))+parseInt(c.getPropertyValue("padding-bottom"))),d=u-(parseInt(c.getPropertyValue("padding-right"))+parseInt(c.getPropertyValue("padding-left")))-a.viewport.scrollBarWidth;return{cols:Math.max(2,Math.floor(d/a._renderService.dimensions.actualCellWidth)),rows:Math.max(1,Math.floor(f/a._renderService.dimensions.actualCellHeight))}}}},o}();r.FitAddon=n}},e={};return function i(r){if(e[r])return e[r].exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}(775)})()})});var HB=ae((k0,dS)=>{(function(t,e){typeof k0=="object"&&typeof dS=="object"?dS.exports=e():typeof define=="function"&&define.amd?define([],e):typeof k0=="object"?k0.WebLinksAddon=e():t.WebLinksAddon=e()})(self,function(){return(()=>{"use strict";var t={6:(n,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LinkComputer=o.WebLinkProvider=void 0;var a=function(){function h(u,c,f,d){d===void 0&&(d={}),this._terminal=u,this._regex=c,this._handler=f,this._options=d}return h.prototype.provideLinks=function(u,c){var f=l.computeLink(u,this._regex,this._terminal,this._handler);c(this._addCallbacks(f))},h.prototype._addCallbacks=function(u){var c=this;return u.map(function(f){return f.leave=c._options.leave,f.hover=function(d,m){if(c._options.hover){var v=f.range;c._options.hover(d,m,v)}},f})},h}();o.WebLinkProvider=a;var l=function(){function h(){}return h.computeLink=function(u,c,f,d){for(var m,v=new RegExp(c.source,(c.flags||"")+"g"),g=h._translateBufferLineToStringWithWrap(u-1,!1,f),p=g[0],_=g[1],x=-1,b=[];(m=v.exec(p))!==null;){var y=m[1];if(!y){console.log("match found without corresponding matchIndex");break}if(x=p.indexOf(y,x+1),v.lastIndex=x+y.length,x<0)break;for(var w=x+y.length,S=_+1;w>f.cols;)w-=f.cols,S++;var R={start:{x:x+1,y:_+1},end:{x:w,y:S}};b.push({range:R,text:y,activate:d})}return b},h._translateBufferLineToStringWithWrap=function(u,c,f){var d,m,v="";do{if(!(p=f.buffer.active.getLine(u)))break;p.isWrapped&&u--,m=p.isWrapped}while(m);var g=u;do{var p,_=f.buffer.active.getLine(u+1);if(d=!!_&&_.isWrapped,!(p=f.buffer.active.getLine(u)))break;v+=p.translateToString(!d&&c).substring(0,f.cols),u++}while(d);return[v,g]},h}();o.LinkComputer=l}},e={};function i(n){var o=e[n];if(o!==void 0)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,i),a.exports}var r={};return(()=>{var n=r;Object.defineProperty(n,"__esModule",{value:!0}),n.WebLinksAddon=void 0;var o=i(6),a=new RegExp(`(?:^|[^\\da-z\\.-]+)((https?:\\/\\/)((([\\da-z\\.-]+)\\.([a-z\\.]{2,18}))|((\\d{1,3}\\.){3}\\d{1,3})|(localhost))(:\\d{1,5})?((\\/[\\/\\w\\.\\-%~:+@]*)*([^:"'\\s]))?(\\?[0-9\\w\\[\\]\\(\\)\\/\\?\\!#@$%&'*+,:;~\\=\\.\\-]*)?(#[0-9\\w\\[\\]\\(\\)\\/\\?\\!#@$%&'*+,:;~\\=\\.\\-]*)?)($|[^\\/\\w\\.\\-%]+)`);function l(u,c){var f=window.open();if(f){try{f.opener=null}catch(d){}f.location.href=c}else console.warn("Opening link blocked as opener could not be cleared")}var h=function(){function u(c,f,d){c===void 0&&(c=l),f===void 0&&(f={}),d===void 0&&(d=!1),this._handler=c,this._options=f,this._useLinkProvider=d}return u.prototype.activate=function(c){if(this._terminal=c,this._useLinkProvider&&"registerLinkProvider"in this._terminal){var f=(d=this._options).urlRegex||a;this._linkProvider=this._terminal.registerLinkProvider(new o.WebLinkProvider(this._terminal,f,this._handler,d))}else{var d;(d=this._options).matchIndex=1,this._linkMatcherId=this._terminal.registerLinkMatcher(a,this._handler,d)}},u.prototype.dispose=function(){var c;this._linkMatcherId!==void 0&&this._terminal!==void 0&&this._terminal.deregisterLinkMatcher(this._linkMatcherId),(c=this._linkProvider)===null||c===void 0||c.dispose()},u}();n.WebLinksAddon=h})(),r})()})});var e5=ae((gMe,$B)=>{"use strict";var JB=Object.getOwnPropertySymbols,SY=Object.prototype.hasOwnProperty,CY=Object.prototype.propertyIsEnumerable;function MY(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function EY(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;var r=Object.getOwnPropertyNames(e).map(function(o){return e[o]});if(r.join("")!=="0123456789")return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(o){n[o]=o}),Object.keys(Object.assign({},n)).join("")==="abcdefghijklmnopqrst"}catch(o){return!1}}$B.exports=EY()?Object.assign:function(t,e){for(var i,r=MY(t),n,o=1;o<arguments.length;o++){i=Object(arguments[o]);for(var a in i)SY.call(i,a)&&(r[a]=i[a]);if(JB){n=JB(i);for(var l=0;l<n.length;l++)CY.call(i,n[l])&&(r[n[l]]=i[n[l]])}}return r}});var v5=ae((bMe,yS)=>{"use strict";var DY=Object.prototype.hasOwnProperty,tn="~";function Jf(){}Object.create&&(Jf.prototype=Object.create(null),new Jf().__proto__||(tn=!1));function IY(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function g5(t,e,i,r,n){if(typeof i!="function")throw new TypeError("The listener must be a function");var o=new IY(i,r||t,n),a=tn?tn+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],o]:t._events[a].push(o):(t._events[a]=o,t._eventsCount++),t}function U0(t,e){--t._eventsCount===0?t._events=new Jf:delete t._events[e]}function zr(){this._events=new Jf,this._eventsCount=0}zr.prototype.eventNames=function(){var e=[],i,r;if(this._eventsCount===0)return e;for(r in i=this._events)DY.call(i,r)&&e.push(tn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(i)):e};zr.prototype.listeners=function(e){var i=tn?tn+e:e,r=this._events[i];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,a=new Array(o);n<o;n++)a[n]=r[n].fn;return a};zr.prototype.listenerCount=function(e){var i=tn?tn+e:e,r=this._events[i];return r?r.fn?1:r.length:0};zr.prototype.emit=function(e,i,r,n,o,a){var l=tn?tn+e:e;if(!this._events[l])return!1;var h=this._events[l],u=arguments.length,c,f;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,i),!0;case 3:return h.fn.call(h.context,i,r),!0;case 4:return h.fn.call(h.context,i,r,n),!0;case 5:return h.fn.call(h.context,i,r,n,o),!0;case 6:return h.fn.call(h.context,i,r,n,o,a),!0}for(f=1,c=new Array(u-1);f<u;f++)c[f-1]=arguments[f];h.fn.apply(h.context,c)}else{var d=h.length,m;for(f=0;f<d;f++)switch(h[f].once&&this.removeListener(e,h[f].fn,void 0,!0),u){case 1:h[f].fn.call(h[f].context);break;case 2:h[f].fn.call(h[f].context,i);break;case 3:h[f].fn.call(h[f].context,i,r);break;case 4:h[f].fn.call(h[f].context,i,r,n);break;default:if(!c)for(m=1,c=new Array(u-1);m<u;m++)c[m-1]=arguments[m];h[f].fn.apply(h[f].context,c)}}return!0};zr.prototype.on=function(e,i,r){return g5(this,e,i,r,!1)};zr.prototype.once=function(e,i,r){return g5(this,e,i,r,!0)};zr.prototype.removeListener=function(e,i,r,n){var o=tn?tn+e:e;if(!this._events[o])return this;if(!i)return U0(this,o),this;var a=this._events[o];if(a.fn)a.fn===i&&(!n||a.once)&&(!r||a.context===r)&&U0(this,o);else{for(var l=0,h=[],u=a.length;l<u;l++)(a[l].fn!==i||n&&!a[l].once||r&&a[l].context!==r)&&h.push(a[l]);h.length?this._events[o]=h.length===1?h[0]:h:U0(this,o)}return this};zr.prototype.removeAllListeners=function(e){var i;return e?(i=tn?tn+e:e,this._events[i]&&U0(this,i)):(this._events=new Jf,this._eventsCount=0),this};zr.prototype.off=zr.prototype.removeListener;zr.prototype.addListener=zr.prototype.on;zr.prefixed=tn;zr.EventEmitter=zr;typeof yS!="undefined"&&(yS.exports=zr)});var w5=ae((wMe,SS)=>{"use strict";SS.exports=H0;SS.exports.default=H0;function H0(t,e,i){i=i||2;var r=e&&e.length,n=r?e[0]*i:t.length,o=y5(t,0,n,i,!0),a=[];if(!o||o.next===o.prev)return a;var l,h,u,c,f,d,m;if(r&&(o=UY(t,e,o,i)),t.length>80*i){l=u=t[0],h=c=t[1];for(var v=i;v<n;v+=i)f=t[v],d=t[v+1],f<l&&(l=f),d<h&&(h=d),f>u&&(u=f),d>c&&(c=d);m=Math.max(u-l,c-h),m=m!==0?32767/m:0}return $f(o,a,i,l,h,m,0),a}function y5(t,e,i,r,n){var o,a;if(n===wS(t,e,i,r)>0)for(o=e;o<i;o+=r)a=_5(o,t[o],t[o+1],a);else for(o=i-r;o>=e;o-=r)a=_5(o,t[o],t[o+1],a);return a&&W0(a,a.next)&&(td(a),a=a.next),a}function th(t,e){if(!t)return t;e||(e=t);var i=t,r;do if(r=!1,!i.steiner&&(W0(i,i.next)||Si(i.prev,i,i.next)===0)){if(td(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function $f(t,e,i,r,n,o,a){if(t){!a&&o&&VY(t,r,n,o);for(var l=t,h,u;t.prev!==t.next;){if(h=t.prev,u=t.next,o?FY(t,r,n,o):kY(t)){e.push(h.i/i|0),e.push(t.i/i|0),e.push(u.i/i|0),td(t),t=u.next,l=u.next;continue}if(t=u,t===l){a?a===1?(t=BY(th(t),e,i),$f(t,e,i,r,n,o,2)):a===2&&NY(t,e,i,r,n,o):$f(th(t),e,i,r,n,o,1);break}}}}function kY(t){var e=t.prev,i=t,r=t.next;if(Si(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,a=r.x,l=e.y,h=i.y,u=r.y,c=n<o?n<a?n:a:o<a?o:a,f=l<h?l<u?l:u:h<u?h:u,d=n>o?n>a?n:a:o>a?o:a,m=l>h?l>u?l:u:h>u?h:u,v=r.next;v!==e;){if(v.x>=c&&v.x<=d&&v.y>=f&&v.y<=m&&ju(n,l,o,h,a,u,v.x,v.y)&&Si(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function FY(t,e,i,r){var n=t.prev,o=t,a=t.next;if(Si(n,o,a)>=0)return!1;for(var l=n.x,h=o.x,u=a.x,c=n.y,f=o.y,d=a.y,m=l<h?l<u?l:u:h<u?h:u,v=c<f?c<d?c:d:f<d?f:d,g=l>h?l>u?l:u:h>u?h:u,p=c>f?c>d?c:d:f>d?f:d,_=xS(m,v,e,i,r),x=xS(g,p,e,i,r),b=t.prevZ,y=t.nextZ;b&&b.z>=_&&y&&y.z<=x;){if(b.x>=m&&b.x<=g&&b.y>=v&&b.y<=p&&b!==n&&b!==a&&ju(l,c,h,f,u,d,b.x,b.y)&&Si(b.prev,b,b.next)>=0||(b=b.prevZ,y.x>=m&&y.x<=g&&y.y>=v&&y.y<=p&&y!==n&&y!==a&&ju(l,c,h,f,u,d,y.x,y.y)&&Si(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;b&&b.z>=_;){if(b.x>=m&&b.x<=g&&b.y>=v&&b.y<=p&&b!==n&&b!==a&&ju(l,c,h,f,u,d,b.x,b.y)&&Si(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;y&&y.z<=x;){if(y.x>=m&&y.x<=g&&y.y>=v&&y.y<=p&&y!==n&&y!==a&&ju(l,c,h,f,u,d,y.x,y.y)&&Si(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function BY(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!W0(n,o)&&x5(n,r,r.next,o)&&ed(n,o)&&ed(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),td(r),td(r.next),r=t=o),r=r.next}while(r!==t);return th(r)}function NY(t,e,i,r,n,o){var a=t;do{for(var l=a.next.next;l!==a.prev;){if(a.i!==l.i&&XY(a,l)){var h=b5(a,l);a=th(a,a.next),h=th(h,h.next),$f(a,e,i,r,n,o,0),$f(h,e,i,r,n,o,0);return}l=l.next}a=a.next}while(a!==t)}function UY(t,e,i,r){var n=[],o,a,l,h,u;for(o=0,a=e.length;o<a;o++)l=e[o]*r,h=o<a-1?e[o+1]*r:t.length,u=y5(t,l,h,r,!1),u===u.next&&(u.steiner=!0),n.push(qY(u));for(n.sort(GY),o=0;o<n.length;o++)i=zY(n[o],i);return i}function GY(t,e){return t.x-e.x}function zY(t,e){var i=HY(t,e);if(!i)return e;var r=b5(i,t);return th(r,r.next),th(i,i.next)}function HY(t,e){var i=e,r=t.x,n=t.y,o=-1/0,a;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var l=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(l<=r&&l>o&&(o=l,a=i.x<i.next.x?i:i.next,l===r))return a}i=i.next}while(i!==e);if(!a)return null;var h=a,u=a.x,c=a.y,f=1/0,d;i=a;do r>=i.x&&i.x>=u&&r!==i.x&&ju(n<c?r:o,n,u,c,n<c?o:r,n,i.x,i.y)&&(d=Math.abs(n-i.y)/(r-i.x),ed(i,t)&&(d<f||d===f&&(i.x>a.x||i.x===a.x&&WY(a,i)))&&(a=i,f=d)),i=i.next;while(i!==h);return a}function WY(t,e){return Si(t.prev,t,e.prev)<0&&Si(e.next,t,t.next)<0}function VY(t,e,i,r){var n=t;do n.z===0&&(n.z=xS(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,jY(n)}function jY(t){var e,i,r,n,o,a,l,h,u=1;do{for(i=t,t=null,o=null,a=0;i;){for(a++,r=i,l=0,e=0;e<u&&(l++,r=r.nextZ,!!r);e++);for(h=u;l>0||h>0&&r;)l!==0&&(h===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,l--):(n=r,r=r.nextZ,h--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(a>1);return t}function xS(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function qY(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function ju(t,e,i,r,n,o,a,l){return(n-a)*(e-l)>=(t-a)*(o-l)&&(t-a)*(r-l)>=(i-a)*(e-l)&&(i-a)*(o-l)>=(n-a)*(r-l)}function XY(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!YY(t,e)&&(ed(t,e)&&ed(e,t)&&ZY(t,e)&&(Si(t.prev,t,e.prev)||Si(t,e.prev,e))||W0(t,e)&&Si(t.prev,t,t.next)>0&&Si(e.prev,e,e.next)>0)}function Si(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function W0(t,e){return t.x===e.x&&t.y===e.y}function x5(t,e,i,r){var n=z0(Si(t,e,i)),o=z0(Si(t,e,r)),a=z0(Si(i,r,t)),l=z0(Si(i,r,e));return!!(n!==o&&a!==l||n===0&&G0(t,i,e)||o===0&&G0(t,r,e)||a===0&&G0(i,t,r)||l===0&&G0(i,e,r))}function G0(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function z0(t){return t>0?1:t<0?-1:0}function YY(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&x5(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function ed(t,e){return Si(t.prev,t,t.next)<0?Si(t,e,t.next)>=0&&Si(t,t.prev,e)>=0:Si(t,e,t.prev)<0||Si(t,t.next,e)<0}function ZY(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function b5(t,e){var i=new bS(t.i,t.x,t.y),r=new bS(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function _5(t,e,i,r){var n=new bS(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function td(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bS(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}H0.deviation=function(t,e,i,r){var n=e&&e.length,o=n?e[0]*i:t.length,a=Math.abs(wS(t,0,o,i));if(n)for(var l=0,h=e.length;l<h;l++){var u=e[l]*i,c=l<h-1?e[l+1]*i:t.length;a-=Math.abs(wS(t,u,c,i))}var f=0;for(l=0;l<r.length;l+=3){var d=r[l]*i,m=r[l+1]*i,v=r[l+2]*i;f+=Math.abs((t[d]-t[v])*(t[m+1]-t[d+1])-(t[d]-t[m])*(t[v+1]-t[d+1]))}return a===0&&f===0?0:Math.abs((f-a)/a)};function wS(t,e,i,r){for(var n=0,o=e,a=i-r;o<i;o+=r)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}H0.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[n][o][a]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i}});var S5=ae((qu,Xu)=>{(function(t){var e=typeof qu=="object"&&qu&&!qu.nodeType&&qu,i=typeof Xu=="object"&&Xu&&!Xu.nodeType&&Xu,r=typeof global=="object"&&global;(r.global===r||r.window===r||r.self===r)&&(t=r);var n,o=2147483647,a=36,l=1,h=26,u=38,c=700,f=72,d=128,m="-",v=/^xn--/,g=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=a-l,b=Math.floor,y=String.fromCharCode,w;function S(k){throw RangeError(_[k])}function R(k,B){for(var F=k.length,W=[];F--;)W[F]=B(k[F]);return W}function E(k,B){var F=k.split("@"),W="";F.length>1&&(W=F[0]+"@",k=F[1]),k=k.replace(p,".");var V=k.split("."),N=R(V,B).join(".");return W+N}function T(k){for(var B=[],F=0,W=k.length,V,N;F<W;)V=k.charCodeAt(F++),V>=55296&&V<=56319&&F<W?(N=k.charCodeAt(F++),(N&64512)==56320?B.push(((V&1023)<<10)+(N&1023)+65536):(B.push(V),F--)):B.push(V);return B}function A(k){return R(k,function(B){var F="";return B>65535&&(B-=65536,F+=y(B>>>10&1023|55296),B=56320|B&1023),F+=y(B),F}).join("")}function C(k){return k-48<10?k-22:k-65<26?k-65:k-97<26?k-97:a}function M(k,B){return k+22+75*(k<26)-((B!=0)<<5)}function D(k,B,F){var W=0;for(k=F?b(k/c):k>>1,k+=b(k/B);k>x*h>>1;W+=a)k=b(k/x);return b(W+(x+1)*k/(k+u))}function O(k){var B=[],F=k.length,W,V=0,N=d,ne=f,ie,Q,K,de,re,Y,U,z,te;for(ie=k.lastIndexOf(m),ie<0&&(ie=0),Q=0;Q<ie;++Q)k.charCodeAt(Q)>=128&&S("not-basic"),B.push(k.charCodeAt(Q));for(K=ie>0?ie+1:0;K<F;){for(de=V,re=1,Y=a;K>=F&&S("invalid-input"),U=C(k.charCodeAt(K++)),(U>=a||U>b((o-V)/re))&&S("overflow"),V+=U*re,z=Y<=ne?l:Y>=ne+h?h:Y-ne,!(U<z);Y+=a)te=a-z,re>b(o/te)&&S("overflow"),re*=te;W=B.length+1,ne=D(V-de,W,de==0),b(V/W)>o-N&&S("overflow"),N+=b(V/W),V%=W,B.splice(V++,0,N)}return A(B)}function P(k){var B,F,W,V,N,ne,ie,Q,K,de,re,Y=[],U,z,te,ge;for(k=T(k),U=k.length,B=d,F=0,N=f,ne=0;ne<U;++ne)re=k[ne],re<128&&Y.push(y(re));for(W=V=Y.length,V&&Y.push(m);W<U;){for(ie=o,ne=0;ne<U;++ne)re=k[ne],re>=B&&re<ie&&(ie=re);for(z=W+1,ie-B>b((o-F)/z)&&S("overflow"),F+=(ie-B)*z,B=ie,ne=0;ne<U;++ne)if(re=k[ne],re<B&&++F>o&&S("overflow"),re==B){for(Q=F,K=a;de=K<=N?l:K>=N+h?h:K-N,!(Q<de);K+=a)ge=Q-de,te=a-de,Y.push(y(M(de+ge%te,0))),Q=b(ge/te);Y.push(y(M(Q,0))),N=D(F,z,W==V),F=0,++W}++F,++B}return Y.join("")}function L(k){return E(k,function(B){return v.test(B)?O(B.slice(4).toLowerCase()):B})}function I(k){return E(k,function(B){return g.test(B)?"xn--"+P(B):B})}if(n={version:"1.3.2",ucs2:{decode:T,encode:A},decode:O,encode:P,toASCII:I,toUnicode:L},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return n});else if(e&&i)if(Xu.exports==e)i.exports=n;else for(w in n)n.hasOwnProperty(w)&&(e[w]=n[w]);else t.punycode=n})(qu)});var M5=ae((SMe,C5)=>{"use strict";C5.exports={isString:function(t){return typeof t=="string"},isObject:function(t){return typeof t=="object"&&t!==null},isNull:function(t){return t===null},isNullOrUndefined:function(t){return t==null}}});var T5=ae((CMe,E5)=>{"use strict";function KY(t,e){return Object.prototype.hasOwnProperty.call(t,e)}E5.exports=function(t,e,i,r){e=e||"&",i=i||"=";var n={};if(typeof t!="string"||t.length===0)return n;var o=/\+/g;t=t.split(e);var a=1e3;r&&typeof r.maxKeys=="number"&&(a=r.maxKeys);var l=t.length;a>0&&l>a&&(l=a);for(var h=0;h<l;++h){var u=t[h].replace(o,"%20"),c=u.indexOf(i),f,d,m,v;c>=0?(f=u.substr(0,c),d=u.substr(c+1)):(f=u,d=""),m=decodeURIComponent(f),v=decodeURIComponent(d),KY(n,m)?Array.isArray(n[m])?n[m].push(v):n[m]=[n[m],v]:n[m]=v}return n}});var P5=ae((MMe,A5)=>{"use strict";var id=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};A5.exports=function(t,e,i,r){return e=e||"&",i=i||"=",t===null&&(t=void 0),typeof t=="object"?Object.keys(t).map(function(n){var o=encodeURIComponent(id(n))+i;return Array.isArray(t[n])?t[n].map(function(a){return o+encodeURIComponent(id(a))}).join(e):o+encodeURIComponent(id(t[n]))}).join(e):r?encodeURIComponent(id(r))+i+encodeURIComponent(id(t)):""}});var R5=ae(rd=>{"use strict";rd.decode=rd.parse=T5();rd.encode=rd.stringify=P5()});var I5=ae(Zu=>{"use strict";var QY=S5(),So=M5();Zu.parse=nd;Zu.resolve=aZ;Zu.resolveObject=lZ;Zu.format=oZ;Zu.Url=fs;function fs(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var JY=/^([a-z0-9.+-]+:)/i,$Y=/:[0-9]*$/,eZ=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,tZ=["<",">",'"',"`"," ","\r",`
`,"	"],iZ=["{","}","|","\\","^","`"].concat(tZ),CS=["'"].concat(iZ),L5=["%","/","?",";","#"].concat(CS),O5=["/","?","#"],rZ=255,D5=/^[+a-z0-9A-Z_-]{0,63}$/,nZ=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,sZ={javascript:!0,"javascript:":!0},MS={javascript:!0,"javascript:":!0},Yu={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},ES=R5();function nd(t,e,i){if(t&&So.isObject(t)&&t instanceof fs)return t;var r=new fs;return r.parse(t,e,i),r}fs.prototype.parse=function(t,e,i){if(!So.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),n=r!==-1&&r<t.indexOf("#")?"?":"#",o=t.split(n),a=/\\/g;o[0]=o[0].replace(a,"/"),t=o.join(n);var l=t;if(l=l.trim(),!i&&t.split("#").length===1){var h=eZ.exec(l);if(h)return this.path=l,this.href=l,this.pathname=h[1],h[2]?(this.search=h[2],e?this.query=ES.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var u=JY.exec(l);if(u){u=u[0];var c=u.toLowerCase();this.protocol=c,l=l.substr(u.length)}if(i||u||l.match(/^\/\/[^@\/]+@[^@\/]+/)){var f=l.substr(0,2)==="//";f&&!(u&&MS[u])&&(l=l.substr(2),this.slashes=!0)}if(!MS[u]&&(f||u&&!Yu[u])){for(var d=-1,m=0;m<O5.length;m++){var v=l.indexOf(O5[m]);v!==-1&&(d===-1||v<d)&&(d=v)}var g,p;d===-1?p=l.lastIndexOf("@"):p=l.lastIndexOf("@",d),p!==-1&&(g=l.slice(0,p),l=l.slice(p+1),this.auth=decodeURIComponent(g)),d=-1;for(var m=0;m<L5.length;m++){var v=l.indexOf(L5[m]);v!==-1&&(d===-1||v<d)&&(d=v)}d===-1&&(d=l.length),this.host=l.slice(0,d),l=l.slice(d),this.parseHost(),this.hostname=this.hostname||"";var _=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!_)for(var x=this.hostname.split(/\./),m=0,b=x.length;m<b;m++){var y=x[m];if(y&&!y.match(D5)){for(var w="",S=0,R=y.length;S<R;S++)y.charCodeAt(S)>127?w+="x":w+=y[S];if(!w.match(D5)){var E=x.slice(0,m),T=x.slice(m+1),A=y.match(nZ);A&&(E.push(A[1]),T.unshift(A[2])),T.length&&(l="/"+T.join(".")+l),this.hostname=E.join(".");break}}}this.hostname.length>rZ?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=QY.toASCII(this.hostname));var C=this.port?":"+this.port:"",M=this.hostname||"";this.host=M+C,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),l[0]!=="/"&&(l="/"+l))}if(!sZ[c])for(var m=0,b=CS.length;m<b;m++){var D=CS[m];if(l.indexOf(D)!==-1){var O=encodeURIComponent(D);O===D&&(O=escape(D)),l=l.split(D).join(O)}}var P=l.indexOf("#");P!==-1&&(this.hash=l.substr(P),l=l.slice(0,P));var L=l.indexOf("?");if(L!==-1?(this.search=l.substr(L),this.query=l.substr(L+1),e&&(this.query=ES.parse(this.query)),l=l.slice(0,L)):e&&(this.search="",this.query={}),l&&(this.pathname=l),Yu[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var C=this.pathname||"",I=this.search||"";this.path=C+I}return this.href=this.format(),this};function oZ(t){return So.isString(t)&&(t=nd(t)),t instanceof fs?t.format():fs.prototype.format.call(t)}fs.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&So.isObject(this.query)&&Object.keys(this.query).length&&(o=ES.stringify(this.query));var a=this.search||o&&"?"+o||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Yu[e])&&n!==!1?(n="//"+(n||""),i&&i.charAt(0)!=="/"&&(i="/"+i)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),a&&a.charAt(0)!=="?"&&(a="?"+a),i=i.replace(/[?#]/g,function(l){return encodeURIComponent(l)}),a=a.replace("#","%23"),e+n+i+a+r};function aZ(t,e){return nd(t,!1,!0).resolve(e)}fs.prototype.resolve=function(t){return this.resolveObject(nd(t,!1,!0)).format()};function lZ(t,e){return t?nd(t,!1,!0).resolveObject(e):e}fs.prototype.resolveObject=function(t){if(So.isString(t)){var e=new fs;e.parse(t,!1,!0),t=e}for(var i=new fs,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];i[o]=this[o]}if(i.hash=t.hash,t.href==="")return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),l=0;l<a.length;l++){var h=a[l];h!=="protocol"&&(i[h]=t[h])}return Yu[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!Yu[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var f=u[c];i[f]=t[f]}return i.href=i.format(),i}if(i.protocol=t.protocol,!t.host&&!MS[t.protocol]){for(var b=(t.pathname||"").split("/");b.length&&!(t.host=b.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),b[0]!==""&&b.unshift(""),b.length<2&&b.unshift(""),i.pathname=b.join("/")}else i.pathname=t.pathname;if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var d=i.pathname||"",m=i.search||"";i.path=d+m}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var v=i.pathname&&i.pathname.charAt(0)==="/",g=t.host||t.pathname&&t.pathname.charAt(0)==="/",p=g||v||i.host&&t.pathname,_=p,x=i.pathname&&i.pathname.split("/")||[],b=t.pathname&&t.pathname.split("/")||[],y=i.protocol&&!Yu[i.protocol];if(y&&(i.hostname="",i.port=null,i.host&&(x[0]===""?x[0]=i.host:x.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(b[0]===""?b[0]=t.host:b.unshift(t.host)),t.host=null),p=p&&(b[0]===""||x[0]==="")),g)i.host=t.host||t.host===""?t.host:i.host,i.hostname=t.hostname||t.hostname===""?t.hostname:i.hostname,i.search=t.search,i.query=t.query,x=b;else if(b.length)x||(x=[]),x.pop(),x=x.concat(b),i.search=t.search,i.query=t.query;else if(!So.isNullOrUndefined(t.search)){if(y){i.hostname=i.host=x.shift();var w=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;w&&(i.auth=w.shift(),i.host=i.hostname=w.shift())}return i.search=t.search,i.query=t.query,(!So.isNull(i.pathname)||!So.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!x.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var S=x.slice(-1)[0],R=(i.host||t.host||x.length>1)&&(S==="."||S==="..")||S==="",E=0,T=x.length;T>=0;T--)S=x[T],S==="."?x.splice(T,1):S===".."?(x.splice(T,1),E++):E&&(x.splice(T,1),E--);if(!p&&!_)for(;E--;E)x.unshift("..");p&&x[0]!==""&&(!x[0]||x[0].charAt(0)!=="/")&&x.unshift(""),R&&x.join("/").substr(-1)!=="/"&&x.push("");var A=x[0]===""||x[0]&&x[0].charAt(0)==="/";if(y){i.hostname=i.host=A?"":x.length?x.shift():"";var w=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;w&&(i.auth=w.shift(),i.host=i.hostname=w.shift())}return p=p||i.host&&x.length,p&&!A&&x.unshift(""),x.length?i.pathname=x.join("/"):(i.pathname=null,i.path=null),(!So.isNull(i.pathname)||!So.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i};fs.prototype.parseHost=function(){var t=this.host,e=$Y.exec(t);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}});var Re=ae((Cd,qC)=>{"use strict";Object.defineProperty(Cd,"__esModule",{value:!0});Cd.default=Vte;function L_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?L_=function(i){return typeof i}:L_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},L_(t)}function Vte(t){var e=typeof t=="string"||t instanceof String;if(!e){var i=L_(t);throw t===null?i="null":i==="object"&&(i=t.constructor.name),new TypeError("Expected a string but received a ".concat(i))}}qC.exports=Cd.default;qC.exports.default=Cd.default});var O_=ae((Md,XC)=>{"use strict";Object.defineProperty(Md,"__esModule",{value:!0});Md.default=Xte;var jte=qte(Re());function qte(t){return t&&t.__esModule?t:{default:t}}function Xte(t){return(0,jte.default)(t),t=Date.parse(t),isNaN(t)?null:new Date(t)}XC.exports=Md.default;XC.exports.default=Md.default});var cc=ae(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.commaDecimal=vr.dotDecimal=vr.farsiLocales=vr.arabicLocales=vr.englishLocales=vr.decimal=vr.alphanumeric=vr.alpha=void 0;var Un={"en-US":/^[A-Z]+$/i,"az-AZ":/^[A-VXYZÇƏĞİıÖŞÜ]+$/i,"bg-BG":/^[А-Я]+$/i,"cs-CZ":/^[A-ZÁČĎÉĚÍŇÓŘŠŤÚŮÝŽ]+$/i,"da-DK":/^[A-ZÆØÅ]+$/i,"de-DE":/^[A-ZÄÖÜß]+$/i,"el-GR":/^[Α-ώ]+$/i,"es-ES":/^[A-ZÁÉÍÑÓÚÜ]+$/i,"fa-IR":/^[ابپتثجچحخدذرزژسشصضطظعغفقکگلمنوهی]+$/i,"fi-FI":/^[A-ZÅÄÖ]+$/i,"fr-FR":/^[A-ZÀÂÆÇÉÈÊËÏÎÔŒÙÛÜŸ]+$/i,"it-IT":/^[A-ZÀÉÈÌÎÓÒÙ]+$/i,"nb-NO":/^[A-ZÆØÅ]+$/i,"nl-NL":/^[A-ZÁÉËÏÓÖÜÚ]+$/i,"nn-NO":/^[A-ZÆØÅ]+$/i,"hu-HU":/^[A-ZÁÉÍÓÖŐÚÜŰ]+$/i,"pl-PL":/^[A-ZĄĆĘŚŁŃÓŻŹ]+$/i,"pt-PT":/^[A-ZÃÁÀÂÄÇÉÊËÍÏÕÓÔÖÚÜ]+$/i,"ru-RU":/^[А-ЯЁ]+$/i,"sl-SI":/^[A-ZČĆĐŠŽ]+$/i,"sk-SK":/^[A-ZÁČĎÉÍŇÓŠŤÚÝŽĹŔĽÄÔ]+$/i,"sr-RS@latin":/^[A-ZČĆŽŠĐ]+$/i,"sr-RS":/^[А-ЯЂЈЉЊЋЏ]+$/i,"sv-SE":/^[A-ZÅÄÖ]+$/i,"th-TH":/^[ก-๐\s]+$/i,"tr-TR":/^[A-ZÇĞİıÖŞÜ]+$/i,"uk-UA":/^[А-ЩЬЮЯЄIЇҐі]+$/i,"vi-VN":/^[A-ZÀÁẠẢÃÂẦẤẬẨẪĂẰẮẶẲẴĐÈÉẸẺẼÊỀẾỆỂỄÌÍỊỈĨÒÓỌỎÕÔỒỐỘỔỖƠỜỚỢỞỠÙÚỤỦŨƯỪỨỰỬỮỲÝỴỶỸ]+$/i,"ku-IQ":/^[ئابپتجچحخدرڕزژسشعغفڤقکگلڵمنوۆھەیێيطؤثآإأكضصةظذ]+$/i,ar:/^[ءآأؤإئابةتثجحخدذرزسشصضطظعغفقكلمنهوىيًٌٍَُِّْٰ]+$/,he:/^[א-ת]+$/,fa:/^['آاءأؤئبپتثجچحخدذرزژسشصضطظعغفقکگلمنوهةی']+$/i,"hi-IN":/^[\u0900-\u0961]+[\u0972-\u097F]*$/i};vr.alpha=Un;var Gn={"en-US":/^[0-9A-Z]+$/i,"az-AZ":/^[0-9A-VXYZÇƏĞİıÖŞÜ]+$/i,"bg-BG":/^[0-9А-Я]+$/i,"cs-CZ":/^[0-9A-ZÁČĎÉĚÍŇÓŘŠŤÚŮÝŽ]+$/i,"da-DK":/^[0-9A-ZÆØÅ]+$/i,"de-DE":/^[0-9A-ZÄÖÜß]+$/i,"el-GR":/^[0-9Α-ω]+$/i,"es-ES":/^[0-9A-ZÁÉÍÑÓÚÜ]+$/i,"fi-FI":/^[0-9A-ZÅÄÖ]+$/i,"fr-FR":/^[0-9A-ZÀÂÆÇÉÈÊËÏÎÔŒÙÛÜŸ]+$/i,"it-IT":/^[0-9A-ZÀÉÈÌÎÓÒÙ]+$/i,"hu-HU":/^[0-9A-ZÁÉÍÓÖŐÚÜŰ]+$/i,"nb-NO":/^[0-9A-ZÆØÅ]+$/i,"nl-NL":/^[0-9A-ZÁÉËÏÓÖÜÚ]+$/i,"nn-NO":/^[0-9A-ZÆØÅ]+$/i,"pl-PL":/^[0-9A-ZĄĆĘŚŁŃÓŻŹ]+$/i,"pt-PT":/^[0-9A-ZÃÁÀÂÄÇÉÊËÍÏÕÓÔÖÚÜ]+$/i,"ru-RU":/^[0-9А-ЯЁ]+$/i,"sl-SI":/^[0-9A-ZČĆĐŠŽ]+$/i,"sk-SK":/^[0-9A-ZÁČĎÉÍŇÓŠŤÚÝŽĹŔĽÄÔ]+$/i,"sr-RS@latin":/^[0-9A-ZČĆŽŠĐ]+$/i,"sr-RS":/^[0-9А-ЯЂЈЉЊЋЏ]+$/i,"sv-SE":/^[0-9A-ZÅÄÖ]+$/i,"th-TH":/^[ก-๙\s]+$/i,"tr-TR":/^[0-9A-ZÇĞİıÖŞÜ]+$/i,"uk-UA":/^[0-9А-ЩЬЮЯЄIЇҐі]+$/i,"ku-IQ":/^[٠١٢٣٤٥٦٧٨٩0-9ئابپتجچحخدرڕزژسشعغفڤقکگلڵمنوۆھەیێيطؤثآإأكضصةظذ]+$/i,"vi-VN":/^[0-9A-ZÀÁẠẢÃÂẦẤẬẨẪĂẰẮẶẲẴĐÈÉẸẺẼÊỀẾỆỂỄÌÍỊỈĨÒÓỌỎÕÔỒỐỘỔỖƠỜỚỢỞỠÙÚỤỦŨƯỪỨỰỬỮỲÝỴỶỸ]+$/i,ar:/^[٠١٢٣٤٥٦٧٨٩0-9ءآأؤإئابةتثجحخدذرزسشصضطظعغفقكلمنهوىيًٌٍَُِّْٰ]+$/,he:/^[0-9א-ת]+$/,fa:/^['0-9آاءأؤئبپتثجچحخدذرزژسشصضطظعغفقکگلمنوهةی۱۲۳۴۵۶۷۸۹۰']+$/i,"hi-IN":/^[\u0900-\u0963]+[\u0966-\u097F]*$/i};vr.alphanumeric=Gn;var bn={"en-US":".",ar:"\u066B"};vr.decimal=bn;var YC=["AU","GB","HK","IN","NZ","ZA","ZM"];vr.englishLocales=YC;for(D_=0;D_<YC.length;D_++)Ed="en-".concat(YC[D_]),Un[Ed]=Un["en-US"],Gn[Ed]=Gn["en-US"],bn[Ed]=bn["en-US"];var Ed,D_,ZC=["AE","BH","DZ","EG","IQ","JO","KW","LB","LY","MA","QM","QA","SA","SD","SY","TN","YE"];vr.arabicLocales=ZC;for(I_=0;I_<ZC.length;I_++)Td="ar-".concat(ZC[I_]),Un[Td]=Un.ar,Gn[Td]=Gn.ar,bn[Td]=bn.ar;var Td,I_,KC=["IR","AF"];vr.farsiLocales=KC;for(F_=0;F_<KC.length;F_++)k_="fa-".concat(KC[F_]),Gn[k_]=Gn.fa,bn[k_]=bn.ar;var k_,F_,QC=["ar-EG","ar-LB","ar-LY"];vr.dotDecimal=QC;var JC=["bg-BG","cs-CZ","da-DK","de-DE","el-GR","en-ZM","es-ES","fr-CA","fr-FR","id-ID","it-IT","ku-IQ","hi-IN","hu-HU","nb-NO","nn-NO","nl-NL","pl-PL","pt-PT","ru-RU","sl-SI","sr-RS@latin","sr-RS","sv-SE","tr-TR","uk-UA","vi-VN"];vr.commaDecimal=JC;for(B_=0;B_<QC.length;B_++)bn[QC[B_]]=bn["en-US"];var B_;for(N_=0;N_<JC.length;N_++)bn[JC[N_]]=",";var N_;Un["fr-CA"]=Un["fr-FR"];Gn["fr-CA"]=Gn["fr-FR"];Un["pt-BR"]=Un["pt-PT"];Gn["pt-BR"]=Gn["pt-PT"];bn["pt-BR"]=bn["pt-PT"];Un["pl-Pl"]=Un["pl-PL"];Gn["pl-Pl"]=Gn["pl-PL"];bn["pl-Pl"]=bn["pl-PL"];Un["fa-AF"]=Un.fa});var $C=ae(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});Ad.default=Kte;Ad.locales=void 0;var Yte=Zte(Re()),kU=cc();function Zte(t){return t&&t.__esModule?t:{default:t}}function Kte(t,e){(0,Yte.default)(t),e=e||{};var i=new RegExp("^(?:[-+])?(?:[0-9]+)?(?:\\".concat(e.locale?kU.decimal[e.locale]:".","[0-9]*)?(?:[eE][\\+\\-]?(?:[0-9]+))?$"));if(t===""||t==="."||t==="-"||t==="+")return!1;var r=parseFloat(t.replace(",","."));return i.test(t)&&(!e.hasOwnProperty("min")||r>=e.min)&&(!e.hasOwnProperty("max")||r<=e.max)&&(!e.hasOwnProperty("lt")||r<e.lt)&&(!e.hasOwnProperty("gt")||r>e.gt)}var Qte=Object.keys(kU.decimal);Ad.locales=Qte});var tM=ae((Pd,eM)=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});Pd.default=eie;var Jte=$te($C());function $te(t){return t&&t.__esModule?t:{default:t}}function eie(t){return(0,Jte.default)(t)?parseFloat(t):NaN}eM.exports=Pd.default;eM.exports.default=Pd.default});var FU=ae((Rd,iM)=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});Rd.default=rie;var tie=iie(Re());function iie(t){return t&&t.__esModule?t:{default:t}}function rie(t,e){return(0,tie.default)(t),parseInt(t,e||10)}iM.exports=Rd.default;iM.exports.default=Rd.default});var BU=ae((Ld,rM)=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});Ld.default=oie;var nie=sie(Re());function sie(t){return t&&t.__esModule?t:{default:t}}function oie(t,e){return(0,nie.default)(t),e?t==="1"||/^true$/i.test(t):t!=="0"&&!/^false$/i.test(t)&&t!==""}rM.exports=Ld.default;rM.exports.default=Ld.default});var NU=ae((Od,nM)=>{"use strict";Object.defineProperty(Od,"__esModule",{value:!0});Od.default=hie;var aie=lie(Re());function lie(t){return t&&t.__esModule?t:{default:t}}function hie(t,e){return(0,aie.default)(t),t===e}nM.exports=Od.default;nM.exports.default=Od.default});var oM=ae((Dd,sM)=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});Dd.default=uie;function U_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?U_=function(i){return typeof i}:U_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},U_(t)}function uie(t){return U_(t)==="object"&&t!==null?typeof t.toString=="function"?t=t.toString():t="[object Object]":(t===null||typeof t=="undefined"||isNaN(t)&&!t.length)&&(t=""),String(t)}sM.exports=Dd.default;sM.exports.default=Dd.default});var wn=ae((Id,aM)=>{"use strict";Object.defineProperty(Id,"__esModule",{value:!0});Id.default=cie;function cie(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;for(var i in e)typeof t[i]=="undefined"&&(t[i]=e[i]);return t}aM.exports=Id.default;aM.exports.default=Id.default});var GU=ae((kd,hM)=>{"use strict";Object.defineProperty(kd,"__esModule",{value:!0});kd.default=mie;var fie=lM(Re()),UU=lM(oM()),die=lM(wn());function lM(t){return t&&t.__esModule?t:{default:t}}var pie={ignoreCase:!1,minOccurrences:1};function mie(t,e,i){return(0,fie.default)(t),i=(0,die.default)(i,pie),i.ignoreCase?t.toLowerCase().split((0,UU.default)(e).toLowerCase()).length>i.minOccurrences:t.split((0,UU.default)(e)).length>i.minOccurrences}hM.exports=kd.default;hM.exports.default=kd.default});var zU=ae((Fd,uM)=>{"use strict";Object.defineProperty(Fd,"__esModule",{value:!0});Fd.default=_ie;var gie=vie(Re());function vie(t){return t&&t.__esModule?t:{default:t}}function _ie(t,e,i){return(0,gie.default)(t),Object.prototype.toString.call(e)!=="[object RegExp]"&&(e=new RegExp(e,i)),e.test(t)}uM.exports=Fd.default;uM.exports.default=Fd.default});var fM=ae((Bd,cM)=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});Bd.default=bie;var yie=xie(Re());function xie(t){return t&&t.__esModule?t:{default:t}}function G_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?G_=function(i){return typeof i}:G_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},G_(t)}function bie(t,e){(0,yie.default)(t);var i,r;G_(e)==="object"?(i=e.min||0,r=e.max):(i=arguments[1],r=arguments[2]);var n=encodeURI(t).split(/%..|./).length-1;return n>=i&&(typeof r=="undefined"||n<=r)}cM.exports=Bd.default;cM.exports.default=Bd.default});var z_=ae((Nd,dM)=>{"use strict";Object.defineProperty(Nd,"__esModule",{value:!0});Nd.default=Mie;var wie=HU(Re()),Sie=HU(wn());function HU(t){return t&&t.__esModule?t:{default:t}}var Cie={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1};function Mie(t,e){(0,wie.default)(t),e=(0,Sie.default)(e,Cie),e.allow_trailing_dot&&t[t.length-1]==="."&&(t=t.substring(0,t.length-1)),e.allow_wildcard===!0&&t.indexOf("*.")===0&&(t=t.substring(2));var i=t.split("."),r=i[i.length-1];return e.require_tld&&(i.length<2||!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(r)||/\s/.test(r))||!e.allow_numeric_tld&&/^\d+$/.test(r)?!1:i.every(function(n){return!(n.length>63||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(n)||/[\uff01-\uff5e]/.test(n)||/^-|-$/.test(n)||!e.allow_underscores&&/_/.test(n))})}dM.exports=Nd.default;dM.exports.default=Nd.default});var Gd=ae((Ud,mM)=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});Ud.default=pM;var Eie=Tie(Re());function Tie(t){return t&&t.__esModule?t:{default:t}}var WU="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",ul="(".concat(WU,"[.]){3}").concat(WU),Aie=new RegExp("^".concat(ul,"$")),Zi="(?:[0-9a-fA-F]{1,4})",Pie=new RegExp("^("+"(?:".concat(Zi,":){7}(?:").concat(Zi,"|:)|")+"(?:".concat(Zi,":){6}(?:").concat(ul,"|:").concat(Zi,"|:)|")+"(?:".concat(Zi,":){5}(?::").concat(ul,"|(:").concat(Zi,"){1,2}|:)|")+"(?:".concat(Zi,":){4}(?:(:").concat(Zi,"){0,1}:").concat(ul,"|(:").concat(Zi,"){1,3}|:)|")+"(?:".concat(Zi,":){3}(?:(:").concat(Zi,"){0,2}:").concat(ul,"|(:").concat(Zi,"){1,4}|:)|")+"(?:".concat(Zi,":){2}(?:(:").concat(Zi,"){0,3}:").concat(ul,"|(:").concat(Zi,"){1,5}|:)|")+"(?:".concat(Zi,":){1}(?:(:").concat(Zi,"){0,4}:").concat(ul,"|(:").concat(Zi,"){1,6}|:)|")+"(?::((?::".concat(Zi,"){0,5}:").concat(ul,"|(?::").concat(Zi,"){1,7}|:))")+")(%[0-9a-zA-Z-.:]{1,})?$");function pM(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Eie.default)(t),e=String(e),!e)return pM(t,4)||pM(t,6);if(e==="4"){if(!Aie.test(t))return!1;var i=t.split(".").sort(function(r,n){return r-n});return i[3]<=255}return e==="6"?!!Pie.test(t):!1}mM.exports=Ud.default;mM.exports.default=Ud.default});var jU=ae((Hd,vM)=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});Hd.default=Hie;var Rie=zd(Re()),Lie=zd(wn()),gM=zd(fM()),Oie=zd(z_()),VU=zd(Gd());function zd(t){return t&&t.__esModule?t:{default:t}}var Die={allow_display_name:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[]},Iie=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,kie=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,Fie=/^[a-z\d]+$/,Bie=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,Nie=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,Uie=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i,Gie=254;function zie(t){var e=t.replace(/^"(.+)"$/,"$1");if(!e.trim())return!1;var i=/[\.";<>]/.test(e);if(i){if(e===t)return!1;var r=e.split('"').length===e.split('\\"').length;if(!r)return!1}return!0}function Hie(t,e){if((0,Rie.default)(t),e=(0,Lie.default)(e,Die),e.require_display_name||e.allow_display_name){var i=t.match(Iie);if(i){var r=i[1];if(t=t.replace(r,"").replace(/(^<|>$)/g,""),r.endsWith(" ")&&(r=r.substr(0,r.length-1)),!zie(r))return!1}else if(e.require_display_name)return!1}if(!e.ignore_max_length&&t.length>Gie)return!1;var n=t.split("@"),o=n.pop(),a=o.toLowerCase();if(e.host_blacklist.includes(a))return!1;var l=n.join("@");if(e.domain_specific_validation&&(a==="gmail.com"||a==="googlemail.com")){l=l.toLowerCase();var h=l.split("+")[0];if(!(0,gM.default)(h.replace(/\./g,""),{min:6,max:30}))return!1;for(var u=h.split("."),c=0;c<u.length;c++)if(!Fie.test(u[c]))return!1}if(e.ignore_max_length===!1&&(!(0,gM.default)(l,{max:64})||!(0,gM.default)(o,{max:254})))return!1;if(!(0,Oie.default)(o,{require_tld:e.require_tld})){if(!e.allow_ip_domain)return!1;if(!(0,VU.default)(o)){if(!o.startsWith("[")||!o.endsWith("]"))return!1;var f=o.substr(1,o.length-2);if(f.length===0||!(0,VU.default)(f))return!1}}if(l[0]==='"')return l=l.slice(1,l.length-1),e.allow_utf8_local_part?Uie.test(l):Bie.test(l);for(var d=e.allow_utf8_local_part?Nie:kie,m=l.split("."),v=0;v<m.length;v++)if(!d.test(m[v]))return!1;return!(e.blacklisted_chars&&l.search(new RegExp("[".concat(e.blacklisted_chars,"]+"),"g"))!==-1)}vM.exports=Hd.default;vM.exports.default=Hd.default});var ZU=ae((Wd,_M)=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});Wd.default=ere;var Wie=H_(Re()),Vie=H_(z_()),qU=H_(Gd()),jie=H_(wn());function H_(t){return t&&t.__esModule?t:{default:t}}function qie(t,e){return Kie(t)||Zie(t,e)||Yie(t,e)||Xie()}function Xie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yie(t,e){if(t){if(typeof t=="string")return XU(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return XU(t,e)}}function XU(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function Zie(t,e){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(t)))){var i=[],r=!0,n=!1,o=void 0;try{for(var a=t[Symbol.iterator](),l;!(r=(l=a.next()).done)&&(i.push(l.value),!(e&&i.length===e));r=!0);}catch(h){n=!0,o=h}finally{try{!r&&a.return!=null&&a.return()}finally{if(n)throw o}}return i}}function Kie(t){if(Array.isArray(t))return t}var Qie={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,allow_fragments:!0,allow_query_components:!0,validate_length:!0},Jie=/^\[([^\]]+)\](?::([0-9]+))?$/;function $ie(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function YU(t,e){for(var i=0;i<e.length;i++){var r=e[i];if(t===r||$ie(r)&&r.test(t))return!0}return!1}function ere(t,e){if((0,Wie.default)(t),!t||/[\s<>]/.test(t)||t.indexOf("mailto:")===0||(e=(0,jie.default)(e,Qie),e.validate_length&&t.length>=2083)||!e.allow_fragments&&t.includes("#")||!e.allow_query_components&&(t.includes("?")||t.includes("&")))return!1;var i,r,n,o,a,l,h,u;if(h=t.split("#"),t=h.shift(),h=t.split("?"),t=h.shift(),h=t.split("://"),h.length>1){if(i=h.shift().toLowerCase(),e.require_valid_protocol&&e.protocols.indexOf(i)===-1)return!1}else{if(e.require_protocol)return!1;if(t.substr(0,2)==="//"){if(!e.allow_protocol_relative_urls)return!1;h[0]=t.substr(2)}}if(t=h.join("://"),t==="")return!1;if(h=t.split("/"),t=h.shift(),t===""&&!e.require_host)return!0;if(h=t.split("@"),h.length>1){if(e.disallow_auth||h[0]===""||(r=h.shift(),r.indexOf(":")>=0&&r.split(":").length>2))return!1;var c=r.split(":"),f=qie(c,2),d=f[0],m=f[1];if(d===""&&m==="")return!1}o=h.join("@"),l=null,u=null;var v=o.match(Jie);if(v?(n="",u=v[1],l=v[2]||null):(h=o.split(":"),n=h.shift(),h.length&&(l=h.join(":"))),l!==null&&l.length>0){if(a=parseInt(l,10),!/^[0-9]+$/.test(l)||a<=0||a>65535)return!1}else if(e.require_port)return!1;return e.host_whitelist?YU(n,e.host_whitelist):!(!(0,qU.default)(n)&&!(0,Vie.default)(n,e)&&(!u||!(0,qU.default)(u,6))||(n=n||u,e.host_blacklist&&YU(n,e.host_blacklist)))}_M.exports=Wd.default;_M.exports.default=Wd.default});var KU=ae((Vd,yM)=>{"use strict";Object.defineProperty(Vd,"__esModule",{value:!0});Vd.default=ore;var tre=ire(Re());function ire(t){return t&&t.__esModule?t:{default:t}}var rre=/^(?:[0-9a-fA-F]{2}([-:\s]))([0-9a-fA-F]{2}\1){4}([0-9a-fA-F]{2})$/,nre=/^([0-9a-fA-F]){12}$/,sre=/^([0-9a-fA-F]{4}\.){2}([0-9a-fA-F]{4})$/;function ore(t,e){return(0,tre.default)(t),e&&(e.no_colons||e.no_separators)?nre.test(t):rre.test(t)||sre.test(t)}yM.exports=Vd.default;yM.exports.default=Vd.default});var t4=ae((jd,xM)=>{"use strict";Object.defineProperty(jd,"__esModule",{value:!0});jd.default=hre;var are=e4(Re()),QU=e4(Gd());function e4(t){return t&&t.__esModule?t:{default:t}}var lre=/^\d{1,3}$/,JU=32,$U=128;function hre(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";(0,are.default)(t);var i=t.split("/");if(i.length!==2||!lre.test(i[1])||i[1].length>1&&i[1].startsWith("0"))return!1;var r=(0,QU.default)(i[0],e);if(!r)return!1;var n=null;switch(String(e)){case"4":n=JU;break;case"6":n=$U;break;default:n=(0,QU.default)(i[0],"6")?$U:JU}return i[1]<=n&&i[1]>=0}xM.exports=jd.default;xM.exports.default=jd.default});var wM=ae((qd,bM)=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.default=_re;var i4=ure(wn());function ure(t){return t&&t.__esModule?t:{default:t}}function cre(t,e){return pre(t)||dre(t,e)||s4(t,e)||fre()}function fre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dre(t,e){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(t)))){var i=[],r=!0,n=!1,o=void 0;try{for(var a=t[Symbol.iterator](),l;!(r=(l=a.next()).done)&&(i.push(l.value),!(e&&i.length===e));r=!0);}catch(h){n=!0,o=h}finally{try{!r&&a.return!=null&&a.return()}finally{if(n)throw o}}return i}}function pre(t){if(Array.isArray(t))return t}function mre(t,e){var i;if(typeof Symbol=="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(i=s4(t))||e&&t&&typeof t.length=="number"){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){i=t[Symbol.iterator]()},n:function(){var u=i.next();return o=u.done,u},e:function(u){a=!0,l=u},f:function(){try{!o&&i.return!=null&&i.return()}finally{if(a)throw l}}}}function s4(t,e){if(t){if(typeof t=="string")return r4(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r4(t,e)}}function r4(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var n4={format:"YYYY/MM/DD",delimiters:["/","-"],strictMode:!1};function gre(t){return/(^(y{4}|y{2})[.\/-](m{1,2})[.\/-](d{1,2})$)|(^(m{1,2})[.\/-](d{1,2})[.\/-]((y{4}|y{2})$))|(^(d{1,2})[.\/-](m{1,2})[.\/-]((y{4}|y{2})$))/gi.test(t)}function vre(t,e){for(var i=[],r=Math.min(t.length,e.length),n=0;n<r;n++)i.push([t[n],e[n]]);return i}function _re(t,e){if(typeof e=="string"?e=(0,i4.default)({format:e},n4):e=(0,i4.default)(e,n4),typeof t=="string"&&gre(e.format)){var i=e.delimiters.find(function(f){return e.format.indexOf(f)!==-1}),r=e.strictMode?i:e.delimiters.find(function(f){return t.indexOf(f)!==-1}),n=vre(t.split(r),e.format.toLowerCase().split(i)),o={},a=mre(n),l;try{for(a.s();!(l=a.n()).done;){var h=cre(l.value,2),u=h[0],c=h[1];if(u.length!==c.length)return!1;o[c.charAt(0)]=u}}catch(f){a.e(f)}finally{a.f()}return new Date("".concat(o.m,"/").concat(o.d,"/").concat(o.y)).getDate()===+o.d}return e.strictMode?!1:Object.prototype.toString.call(t)==="[object Date]"&&isFinite(t)}bM.exports=qd.default;bM.exports.default=qd.default});var a4=ae((Xd,SM)=>{"use strict";Object.defineProperty(Xd,"__esModule",{value:!0});Xd.default=Sre;var yre=xre(Re());function xre(t){return t&&t.__esModule?t:{default:t}}var bre={loose:!1},o4=["true","false","1","0"],wre=[].concat(o4,["yes","no"]);function Sre(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bre;return(0,yre.default)(t),e.loose?wre.includes(t.toLowerCase()):o4.includes(t)}SM.exports=Xd.default;SM.exports.default=Xd.default});var l4=ae((Yd,CM)=>{"use strict";Object.defineProperty(Yd,"__esModule",{value:!0});Yd.default=Tre;var Cre=Mre(Re());function Mre(t){return t&&t.__esModule?t:{default:t}}var Ere=/^[A-Za-z]{2,4}([_-]([A-Za-z]{4}|[\d]{3}))?([_-]([A-Za-z]{2}|[\d]{3}))?$/;function Tre(t){return(0,Cre.default)(t),t==="en_US_POSIX"||t==="ca_ES_VALENCIA"?!0:Ere.test(t)}CM.exports=Yd.default;CM.exports.default=Yd.default});var h4=ae(Zd=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});Zd.default=Rre;Zd.locales=void 0;var Are=Pre(Re()),MM=cc();function Pre(t){return t&&t.__esModule?t:{default:t}}function Rre(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US",i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(0,Are.default)(t);var r=t,n=i.ignore;if(n)if(n instanceof RegExp)r=r.replace(n,"");else if(typeof n=="string")r=r.replace(new RegExp("[".concat(n.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&"),"]"),"g"),"");else throw new Error("ignore should be instance of a String or RegExp");if(e in MM.alpha)return MM.alpha[e].test(r);throw new Error("Invalid locale '".concat(e,"'"))}var Lre=Object.keys(MM.alpha);Zd.locales=Lre});var u4=ae(Kd=>{"use strict";Object.defineProperty(Kd,"__esModule",{value:!0});Kd.default=Ire;Kd.locales=void 0;var Ore=Dre(Re()),EM=cc();function Dre(t){return t&&t.__esModule?t:{default:t}}function Ire(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US",i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(0,Ore.default)(t);var r=t,n=i.ignore;if(n)if(n instanceof RegExp)r=r.replace(n,"");else if(typeof n=="string")r=r.replace(new RegExp("[".concat(n.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&"),"]"),"g"),"");else throw new Error("ignore should be instance of a String or RegExp");if(e in EM.alphanumeric)return EM.alphanumeric[e].test(r);throw new Error("Invalid locale '".concat(e,"'"))}var kre=Object.keys(EM.alphanumeric);Kd.locales=kre});var c4=ae((Qd,TM)=>{"use strict";Object.defineProperty(Qd,"__esModule",{value:!0});Qd.default=Gre;var Fre=Nre(Re()),Bre=cc();function Nre(t){return t&&t.__esModule?t:{default:t}}var Ure=/^[0-9]+$/;function Gre(t,e){return(0,Fre.default)(t),e&&e.no_symbols?Ure.test(t):new RegExp("^[+-]?([0-9]*[".concat((e||{}).locale?Bre.decimal[e.locale]:".","])?[0-9]+$")).test(t)}TM.exports=Qd.default;TM.exports.default=Qd.default});var d4=ae((Jd,AM)=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});Jd.default=Wre;var zre=Hre(Re());function Hre(t){return t&&t.__esModule?t:{default:t}}var f4={AM:/^[A-Z]{2}\d{7}$/,AR:/^[A-Z]{3}\d{6}$/,AT:/^[A-Z]\d{7}$/,AU:/^[A-Z]\d{7}$/,BE:/^[A-Z]{2}\d{6}$/,BG:/^\d{9}$/,BR:/^[A-Z]{2}\d{6}$/,BY:/^[A-Z]{2}\d{7}$/,CA:/^[A-Z]{2}\d{6}$/,CH:/^[A-Z]\d{7}$/,CN:/^G\d{8}$|^E(?![IO])[A-Z0-9]\d{7}$/,CY:/^[A-Z](\d{6}|\d{8})$/,CZ:/^\d{8}$/,DE:/^[CFGHJKLMNPRTVWXYZ0-9]{9}$/,DK:/^\d{9}$/,DZ:/^\d{9}$/,EE:/^([A-Z]\d{7}|[A-Z]{2}\d{7})$/,ES:/^[A-Z0-9]{2}([A-Z0-9]?)\d{6}$/,FI:/^[A-Z]{2}\d{7}$/,FR:/^\d{2}[A-Z]{2}\d{5}$/,GB:/^\d{9}$/,GR:/^[A-Z]{2}\d{7}$/,HR:/^\d{9}$/,HU:/^[A-Z]{2}(\d{6}|\d{7})$/,IE:/^[A-Z0-9]{2}\d{7}$/,IN:/^[A-Z]{1}-?\d{7}$/,ID:/^[A-C]\d{7}$/,IR:/^[A-Z]\d{8}$/,IS:/^(A)\d{7}$/,IT:/^[A-Z0-9]{2}\d{7}$/,JP:/^[A-Z]{2}\d{7}$/,KR:/^[MS]\d{8}$/,LT:/^[A-Z0-9]{8}$/,LU:/^[A-Z0-9]{8}$/,LV:/^[A-Z0-9]{2}\d{7}$/,LY:/^[A-Z0-9]{8}$/,MT:/^\d{7}$/,MZ:/^([A-Z]{2}\d{7})|(\d{2}[A-Z]{2}\d{5})$/,MY:/^[AHK]\d{8}$/,NL:/^[A-Z]{2}[A-Z0-9]{6}\d$/,PL:/^[A-Z]{2}\d{7}$/,PT:/^[A-Z]\d{6}$/,RO:/^\d{8,9}$/,RU:/^\d{9}$/,SE:/^\d{8}$/,SL:/^(P)[A-Z]\d{7}$/,SK:/^[0-9A-Z]\d{7}$/,TR:/^[A-Z]\d{8}$/,UA:/^[A-Z]{2}\d{6}$/,US:/^\d{9}$/};function Wre(t,e){(0,zre.default)(t);var i=t.replace(/\s/g,"").toUpperCase();return e.toUpperCase()in f4&&f4[e].test(i)}AM.exports=Jd.default;AM.exports.default=Jd.default});var W_=ae(($d,PM)=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});$d.default=Yre;var Vre=jre(Re());function jre(t){return t&&t.__esModule?t:{default:t}}var qre=/^(?:[-+]?(?:0|[1-9][0-9]*))$/,Xre=/^[-+]?[0-9]+$/;function Yre(t,e){(0,Vre.default)(t),e=e||{};var i=e.hasOwnProperty("allow_leading_zeroes")&&!e.allow_leading_zeroes?qre:Xre,r=!e.hasOwnProperty("min")||t>=e.min,n=!e.hasOwnProperty("max")||t<=e.max,o=!e.hasOwnProperty("lt")||t<e.lt,a=!e.hasOwnProperty("gt")||t>e.gt;return i.test(t)&&r&&n&&o&&a}PM.exports=$d.default;PM.exports.default=$d.default});var p4=ae((ep,RM)=>{"use strict";Object.defineProperty(ep,"__esModule",{value:!0});ep.default=Qre;var Zre=Kre(W_());function Kre(t){return t&&t.__esModule?t:{default:t}}function Qre(t){return(0,Zre.default)(t,{min:0,max:65535})}RM.exports=ep.default;RM.exports.default=ep.default});var m4=ae((tp,LM)=>{"use strict";Object.defineProperty(tp,"__esModule",{value:!0});tp.default=ene;var Jre=$re(Re());function $re(t){return t&&t.__esModule?t:{default:t}}function ene(t){return(0,Jre.default)(t),t===t.toLowerCase()}LM.exports=tp.default;LM.exports.default=tp.default});var g4=ae((ip,OM)=>{"use strict";Object.defineProperty(ip,"__esModule",{value:!0});ip.default=rne;var tne=ine(Re());function ine(t){return t&&t.__esModule?t:{default:t}}function rne(t){return(0,tne.default)(t),t===t.toUpperCase()}OM.exports=ip.default;OM.exports.default=ip.default});var v4=ae((rp,DM)=>{"use strict";Object.defineProperty(rp,"__esModule",{value:!0});rp.default=lne;var nne=sne(Re());function sne(t){return t&&t.__esModule?t:{default:t}}var one=/^[0-9]{15}$/,ane=/^\d{2}-\d{6}-\d{6}-\d{1}$/;function lne(t,e){(0,nne.default)(t),e=e||{};var i=one;if(e.allow_hyphens&&(i=ane),!i.test(t))return!1;t=t.replace(/-/g,"");for(var r=0,n=2,o=14,a=0;a<o;a++){var l=t.substring(o-a-1,o-a),h=parseInt(l,10)*n;h>=10?r+=h%10+1:r+=h,n===1?n+=1:n-=1}var u=(10-r%10)%10;return u===parseInt(t.substring(14,15),10)}DM.exports=rp.default;DM.exports.default=rp.default});var _4=ae((np,IM)=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});np.default=fne;var hne=une(Re());function une(t){return t&&t.__esModule?t:{default:t}}var cne=/^[\x00-\x7F]+$/;function fne(t){return(0,hne.default)(t),cne.test(t)}IM.exports=np.default;IM.exports.default=np.default});var kM=ae(sp=>{"use strict";Object.defineProperty(sp,"__esModule",{value:!0});sp.default=mne;sp.fullWidth=void 0;var dne=pne(Re());function pne(t){return t&&t.__esModule?t:{default:t}}var y4=/[^\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/;sp.fullWidth=y4;function mne(t){return(0,dne.default)(t),y4.test(t)}});var FM=ae(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});op.default=_ne;op.halfWidth=void 0;var gne=vne(Re());function vne(t){return t&&t.__esModule?t:{default:t}}var x4=/[\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/;op.halfWidth=x4;function _ne(t){return(0,gne.default)(t),x4.test(t)}});var b4=ae((ap,BM)=>{"use strict";Object.defineProperty(ap,"__esModule",{value:!0});ap.default=Sne;var yne=wne(Re()),xne=kM(),bne=FM();function wne(t){return t&&t.__esModule?t:{default:t}}function Sne(t){return(0,yne.default)(t),xne.fullWidth.test(t)&&bne.halfWidth.test(t)}BM.exports=ap.default;BM.exports.default=ap.default});var w4=ae((lp,NM)=>{"use strict";Object.defineProperty(lp,"__esModule",{value:!0});lp.default=Tne;var Cne=Mne(Re());function Mne(t){return t&&t.__esModule?t:{default:t}}var Ene=/[^\x00-\x7F]/;function Tne(t){return(0,Cne.default)(t),Ene.test(t)}NM.exports=lp.default;NM.exports.default=lp.default});var S4=ae((hp,UM)=>{"use strict";Object.defineProperty(hp,"__esModule",{value:!0});hp.default=Ane;function Ane(t,e){var i=t.join("");return new RegExp(i,e)}UM.exports=hp.default;UM.exports.default=hp.default});var M4=ae((up,GM)=>{"use strict";Object.defineProperty(up,"__esModule",{value:!0});up.default=One;var Pne=C4(Re()),Rne=C4(S4());function C4(t){return t&&t.__esModule?t:{default:t}}var Lne=(0,Rne.default)(["^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)","(?:-((?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*))*))","?(?:\\+([0-9a-z-]+(?:\\.[0-9a-z-]+)*))?$"],"i");function One(t){return(0,Pne.default)(t),Lne.test(t)}GM.exports=up.default;GM.exports.default=up.default});var E4=ae((cp,zM)=>{"use strict";Object.defineProperty(cp,"__esModule",{value:!0});cp.default=Fne;var Dne=Ine(Re());function Ine(t){return t&&t.__esModule?t:{default:t}}var kne=/[\uD800-\uDBFF][\uDC00-\uDFFF]/;function Fne(t){return(0,Dne.default)(t),kne.test(t)}zM.exports=cp.default;zM.exports.default=cp.default});var T4=ae((fc,HM)=>{"use strict";Object.defineProperty(fc,"__esModule",{value:!0});fc.default=void 0;var Bne=function(e,i){return e.some(function(r){return i===r})},Nne=Bne;fc.default=Nne;HM.exports=fc.default;HM.exports.default=fc.default});var P4=ae((fp,VM)=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});fp.default=jne;var Une=WM(wn()),Gne=WM(Re()),zne=WM(T4()),A4=cc();function WM(t){return t&&t.__esModule?t:{default:t}}function Hne(t){var e=new RegExp("^[-+]?([0-9]+)?(\\".concat(A4.decimal[t.locale],"[0-9]{").concat(t.decimal_digits,"})").concat(t.force_decimal?"":"?","$"));return e}var Wne={force_decimal:!1,decimal_digits:"1,",locale:"en-US"},Vne=["","-","+"];function jne(t,e){if((0,Gne.default)(t),e=(0,Une.default)(e,Wne),e.locale in A4.decimal)return!(0,zne.default)(Vne,t.replace(/ /g,""))&&Hne(e).test(t);throw new Error("Invalid locale '".concat(e.locale,"'"))}VM.exports=fp.default;VM.exports.default=fp.default});var qM=ae((dp,jM)=>{"use strict";Object.defineProperty(dp,"__esModule",{value:!0});dp.default=Zne;var qne=Xne(Re());function Xne(t){return t&&t.__esModule?t:{default:t}}var Yne=/^(0x|0h)?[0-9A-F]+$/i;function Zne(t){return(0,qne.default)(t),Yne.test(t)}jM.exports=dp.default;jM.exports.default=dp.default});var R4=ae((pp,XM)=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});pp.default=$ne;var Kne=Qne(Re());function Qne(t){return t&&t.__esModule?t:{default:t}}var Jne=/^(0o)?[0-7]+$/i;function $ne(t){return(0,Kne.default)(t),Jne.test(t)}XM.exports=pp.default;XM.exports.default=pp.default});var O4=ae((mp,YM)=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});mp.default=ise;var ese=L4(Re()),tse=L4(tM());function L4(t){return t&&t.__esModule?t:{default:t}}function ise(t,e){return(0,ese.default)(t),(0,tse.default)(t)%parseInt(e,10)===0}YM.exports=mp.default;YM.exports.default=mp.default});var D4=ae((gp,ZM)=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0});gp.default=ose;var rse=nse(Re());function nse(t){return t&&t.__esModule?t:{default:t}}var sse=/^#?([0-9A-F]{3}|[0-9A-F]{4}|[0-9A-F]{6}|[0-9A-F]{8})$/i;function ose(t){return(0,rse.default)(t),sse.test(t)}ZM.exports=gp.default;ZM.exports.default=gp.default});var F4=ae((vp,KM)=>{"use strict";Object.defineProperty(vp,"__esModule",{value:!0});vp.default=cse;var ase=lse(Re());function lse(t){return t&&t.__esModule?t:{default:t}}var I4=/^rgb\((([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),){2}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\)$/,k4=/^rgba\((([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),){3}(0?\.\d|1(\.0)?|0(\.0)?)\)$/,hse=/^rgb\((([0-9]%|[1-9][0-9]%|100%),){2}([0-9]%|[1-9][0-9]%|100%)\)/,use=/^rgba\((([0-9]%|[1-9][0-9]%|100%),){3}(0?\.\d|1(\.0)?|0(\.0)?)\)/;function cse(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(0,ase.default)(t),e?I4.test(t)||k4.test(t)||hse.test(t)||use.test(t):I4.test(t)||k4.test(t)}KM.exports=vp.default;KM.exports.default=vp.default});var B4=ae((_p,QM)=>{"use strict";Object.defineProperty(_p,"__esModule",{value:!0});_p.default=gse;var fse=dse(Re());function dse(t){return t&&t.__esModule?t:{default:t}}var pse=/^hsla?\(((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?))(deg|grad|rad|turn)?(,(\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%){2}(,((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%?))?\)$/i,mse=/^hsla?\(((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?))(deg|grad|rad|turn)?(\s(\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%){2}\s?(\/\s((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%?)\s?)?\)$/i;function gse(t){(0,fse.default)(t);var e=t.replace(/\s+/g," ").replace(/\s?(hsla?\(|\)|,)\s?/ig,"$1");return e.indexOf(",")!==-1?pse.test(e):mse.test(e)}QM.exports=_p.default;QM.exports.default=_p.default});var N4=ae((yp,JM)=>{"use strict";Object.defineProperty(yp,"__esModule",{value:!0});yp.default=xse;var vse=_se(Re());function _se(t){return t&&t.__esModule?t:{default:t}}var yse=/^[A-Z]{2}[0-9A-Z]{3}\d{2}\d{5}$/;function xse(t){return(0,vse.default)(t),yse.test(t)}JM.exports=yp.default;JM.exports.default=yp.default});var U4=ae(xp=>{"use strict";Object.defineProperty(xp,"__esModule",{value:!0});xp.default=Mse;xp.locales=void 0;var bse=wse(Re());function wse(t){return t&&t.__esModule?t:{default:t}}var $M={AD:/^(AD[0-9]{2})\d{8}[A-Z0-9]{12}$/,AE:/^(AE[0-9]{2})\d{3}\d{16}$/,AL:/^(AL[0-9]{2})\d{8}[A-Z0-9]{16}$/,AT:/^(AT[0-9]{2})\d{16}$/,AZ:/^(AZ[0-9]{2})[A-Z0-9]{4}\d{20}$/,BA:/^(BA[0-9]{2})\d{16}$/,BE:/^(BE[0-9]{2})\d{12}$/,BG:/^(BG[0-9]{2})[A-Z]{4}\d{6}[A-Z0-9]{8}$/,BH:/^(BH[0-9]{2})[A-Z]{4}[A-Z0-9]{14}$/,BR:/^(BR[0-9]{2})\d{23}[A-Z]{1}[A-Z0-9]{1}$/,BY:/^(BY[0-9]{2})[A-Z0-9]{4}\d{20}$/,CH:/^(CH[0-9]{2})\d{5}[A-Z0-9]{12}$/,CR:/^(CR[0-9]{2})\d{18}$/,CY:/^(CY[0-9]{2})\d{8}[A-Z0-9]{16}$/,CZ:/^(CZ[0-9]{2})\d{20}$/,DE:/^(DE[0-9]{2})\d{18}$/,DK:/^(DK[0-9]{2})\d{14}$/,DO:/^(DO[0-9]{2})[A-Z]{4}\d{20}$/,EE:/^(EE[0-9]{2})\d{16}$/,EG:/^(EG[0-9]{2})\d{25}$/,ES:/^(ES[0-9]{2})\d{20}$/,FI:/^(FI[0-9]{2})\d{14}$/,FO:/^(FO[0-9]{2})\d{14}$/,FR:/^(FR[0-9]{2})\d{10}[A-Z0-9]{11}\d{2}$/,GB:/^(GB[0-9]{2})[A-Z]{4}\d{14}$/,GE:/^(GE[0-9]{2})[A-Z0-9]{2}\d{16}$/,GI:/^(GI[0-9]{2})[A-Z]{4}[A-Z0-9]{15}$/,GL:/^(GL[0-9]{2})\d{14}$/,GR:/^(GR[0-9]{2})\d{7}[A-Z0-9]{16}$/,GT:/^(GT[0-9]{2})[A-Z0-9]{4}[A-Z0-9]{20}$/,HR:/^(HR[0-9]{2})\d{17}$/,HU:/^(HU[0-9]{2})\d{24}$/,IE:/^(IE[0-9]{2})[A-Z0-9]{4}\d{14}$/,IL:/^(IL[0-9]{2})\d{19}$/,IQ:/^(IQ[0-9]{2})[A-Z]{4}\d{15}$/,IR:/^(IR[0-9]{2})0\d{2}0\d{18}$/,IS:/^(IS[0-9]{2})\d{22}$/,IT:/^(IT[0-9]{2})[A-Z]{1}\d{10}[A-Z0-9]{12}$/,JO:/^(JO[0-9]{2})[A-Z]{4}\d{22}$/,KW:/^(KW[0-9]{2})[A-Z]{4}[A-Z0-9]{22}$/,KZ:/^(KZ[0-9]{2})\d{3}[A-Z0-9]{13}$/,LB:/^(LB[0-9]{2})\d{4}[A-Z0-9]{20}$/,LC:/^(LC[0-9]{2})[A-Z]{4}[A-Z0-9]{24}$/,LI:/^(LI[0-9]{2})\d{5}[A-Z0-9]{12}$/,LT:/^(LT[0-9]{2})\d{16}$/,LU:/^(LU[0-9]{2})\d{3}[A-Z0-9]{13}$/,LV:/^(LV[0-9]{2})[A-Z]{4}[A-Z0-9]{13}$/,MC:/^(MC[0-9]{2})\d{10}[A-Z0-9]{11}\d{2}$/,MD:/^(MD[0-9]{2})[A-Z0-9]{20}$/,ME:/^(ME[0-9]{2})\d{18}$/,MK:/^(MK[0-9]{2})\d{3}[A-Z0-9]{10}\d{2}$/,MR:/^(MR[0-9]{2})\d{23}$/,MT:/^(MT[0-9]{2})[A-Z]{4}\d{5}[A-Z0-9]{18}$/,MU:/^(MU[0-9]{2})[A-Z]{4}\d{19}[A-Z]{3}$/,MZ:/^(MZ[0-9]{2})\d{21}$/,NL:/^(NL[0-9]{2})[A-Z]{4}\d{10}$/,NO:/^(NO[0-9]{2})\d{11}$/,PK:/^(PK[0-9]{2})[A-Z0-9]{4}\d{16}$/,PL:/^(PL[0-9]{2})\d{24}$/,PS:/^(PS[0-9]{2})[A-Z0-9]{4}\d{21}$/,PT:/^(PT[0-9]{2})\d{21}$/,QA:/^(QA[0-9]{2})[A-Z]{4}[A-Z0-9]{21}$/,RO:/^(RO[0-9]{2})[A-Z]{4}[A-Z0-9]{16}$/,RS:/^(RS[0-9]{2})\d{18}$/,SA:/^(SA[0-9]{2})\d{2}[A-Z0-9]{18}$/,SC:/^(SC[0-9]{2})[A-Z]{4}\d{20}[A-Z]{3}$/,SE:/^(SE[0-9]{2})\d{20}$/,SI:/^(SI[0-9]{2})\d{15}$/,SK:/^(SK[0-9]{2})\d{20}$/,SM:/^(SM[0-9]{2})[A-Z]{1}\d{10}[A-Z0-9]{12}$/,SV:/^(SV[0-9]{2})[A-Z0-9]{4}\d{20}$/,TL:/^(TL[0-9]{2})\d{19}$/,TN:/^(TN[0-9]{2})\d{20}$/,TR:/^(TR[0-9]{2})\d{5}[A-Z0-9]{17}$/,UA:/^(UA[0-9]{2})\d{6}[A-Z0-9]{19}$/,VA:/^(VA[0-9]{2})\d{18}$/,VG:/^(VG[0-9]{2})[A-Z0-9]{4}\d{16}$/,XK:/^(XK[0-9]{2})\d{16}$/};function Sse(t){var e=t.replace(/[\s\-]+/gi,"").toUpperCase(),i=e.slice(0,2).toUpperCase();return i in $M&&$M[i].test(e)}function Cse(t){var e=t.replace(/[^A-Z0-9]+/gi,"").toUpperCase(),i=e.slice(4)+e.slice(0,4),r=i.replace(/[A-Z]/g,function(o){return o.charCodeAt(0)-55}),n=r.match(/\d{1,7}/g).reduce(function(o,a){return Number(o+a)%97},"");return n===1}function Mse(t){return(0,bse.default)(t),Sse(t)&&Cse(t)}var Ese=Object.keys($M);xp.locales=Ese});var eE=ae(bp=>{"use strict";Object.defineProperty(bp,"__esModule",{value:!0});bp.default=Pse;bp.CountryCodes=void 0;var Tse=Ase(Re());function Ase(t){return t&&t.__esModule?t:{default:t}}var G4=new Set(["AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AS","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BL","BM","BN","BO","BQ","BR","BS","BT","BV","BW","BY","BZ","CA","CC","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CU","CV","CW","CX","CY","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","EG","EH","ER","ES","ET","FI","FJ","FK","FM","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HM","HN","HR","HT","HU","ID","IE","IL","IM","IN","IO","IQ","IR","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MH","MK","ML","MM","MN","MO","MP","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PW","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","UM","US","UY","UZ","VA","VC","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZA","ZM","ZW"]);function Pse(t){return(0,Tse.default)(t),G4.has(t.toUpperCase())}var Rse=G4;bp.CountryCodes=Rse});var z4=ae((wp,tE)=>{"use strict";Object.defineProperty(wp,"__esModule",{value:!0});wp.default=kse;var Lse=Dse(Re()),Ose=eE();function Dse(t){return t&&t.__esModule?t:{default:t}}var Ise=/^[A-Za-z]{6}[A-Za-z0-9]{2}([A-Za-z0-9]{3})?$/;function kse(t){return(0,Lse.default)(t),Ose.CountryCodes.has(t.slice(4,6).toUpperCase())?Ise.test(t):!1}tE.exports=wp.default;tE.exports.default=wp.default});var H4=ae((Sp,iE)=>{"use strict";Object.defineProperty(Sp,"__esModule",{value:!0});Sp.default=Use;var Fse=Bse(Re());function Bse(t){return t&&t.__esModule?t:{default:t}}var Nse=/^[a-f0-9]{32}$/;function Use(t){return(0,Fse.default)(t),Nse.test(t)}iE.exports=Sp.default;iE.exports.default=Sp.default});var W4=ae((Cp,rE)=>{"use strict";Object.defineProperty(Cp,"__esModule",{value:!0});Cp.default=Wse;var Gse=zse(Re());function zse(t){return t&&t.__esModule?t:{default:t}}var Hse={md5:32,md4:32,sha1:40,sha256:64,sha384:96,sha512:128,ripemd128:32,ripemd160:40,tiger128:32,tiger160:40,tiger192:48,crc32:8,crc32b:8};function Wse(t,e){(0,Gse.default)(t);var i=new RegExp("^[a-fA-F0-9]{".concat(Hse[e],"}$"));return i.test(t)}rE.exports=Cp.default;rE.exports.default=Cp.default});var sE=ae((Mp,nE)=>{"use strict";Object.defineProperty(Mp,"__esModule",{value:!0});Mp.default=Zse;var Vse=V4(Re()),jse=V4(wn());function V4(t){return t&&t.__esModule?t:{default:t}}var qse=/[^A-Z0-9+\/=]/i,Xse=/^[A-Z0-9_\-]*$/i,Yse={urlSafe:!1};function Zse(t,e){(0,Vse.default)(t),e=(0,jse.default)(e,Yse);var i=t.length;if(e.urlSafe)return Xse.test(t);if(i%4!==0||qse.test(t))return!1;var r=t.indexOf("=");return r===-1||r===i-1||r===i-2&&t[i-1]==="="}nE.exports=Mp.default;nE.exports.default=Mp.default});var q4=ae((Ep,oE)=>{"use strict";Object.defineProperty(Ep,"__esModule",{value:!0});Ep.default=Jse;var Kse=j4(Re()),Qse=j4(sE());function j4(t){return t&&t.__esModule?t:{default:t}}function Jse(t){(0,Kse.default)(t);var e=t.split("."),i=e.length;return i>3||i<2?!1:e.reduce(function(r,n){return r&&(0,Qse.default)(n,{urlSafe:!0})},!0)}oE.exports=Ep.default;oE.exports.default=Ep.default});var Y4=ae((Tp,aE)=>{"use strict";Object.defineProperty(Tp,"__esModule",{value:!0});Tp.default=ioe;var $se=X4(Re()),eoe=X4(wn());function X4(t){return t&&t.__esModule?t:{default:t}}function V_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?V_=function(i){return typeof i}:V_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},V_(t)}var toe={allow_primitives:!1};function ioe(t,e){(0,$se.default)(t);try{e=(0,eoe.default)(e,toe);var i=[];e.allow_primitives&&(i=[null,!1,!0]);var r=JSON.parse(t);return i.includes(r)||!!r&&V_(r)==="object"}catch(n){}return!1}aE.exports=Tp.default;aE.exports.default=Tp.default});var K4=ae((Ap,lE)=>{"use strict";Object.defineProperty(Ap,"__esModule",{value:!0});Ap.default=ooe;var roe=Z4(Re()),noe=Z4(wn());function Z4(t){return t&&t.__esModule?t:{default:t}}var soe={ignore_whitespace:!1};function ooe(t,e){return(0,roe.default)(t),e=(0,noe.default)(e,soe),(e.ignore_whitespace?t.trim().length:t.length)===0}lE.exports=Ap.default;lE.exports.default=Ap.default});var Q4=ae((Pp,hE)=>{"use strict";Object.defineProperty(Pp,"__esModule",{value:!0});Pp.default=hoe;var aoe=loe(Re());function loe(t){return t&&t.__esModule?t:{default:t}}function j_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?j_=function(i){return typeof i}:j_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},j_(t)}function hoe(t,e){(0,aoe.default)(t);var i,r;j_(e)==="object"?(i=e.min||0,r=e.max):(i=arguments[1]||0,r=arguments[2]);var n=t.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g)||[],o=t.length-n.length;return o>=i&&(typeof r=="undefined"||o<=r)}hE.exports=Pp.default;hE.exports.default=Pp.default});var J4=ae((Rp,uE)=>{"use strict";Object.defineProperty(Rp,"__esModule",{value:!0});Rp.default=doe;var uoe=coe(Re());function coe(t){return t&&t.__esModule?t:{default:t}}var foe={1:/^[0-9A-F]{8}-[0-9A-F]{4}-1[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,2:/^[0-9A-F]{8}-[0-9A-F]{4}-2[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function doe(t,e){(0,uoe.default)(t);var i=foe[[void 0,null].includes(e)?"all":e];return!!i&&i.test(t)}uE.exports=Rp.default;uE.exports.default=Rp.default});var eG=ae((Lp,cE)=>{"use strict";Object.defineProperty(Lp,"__esModule",{value:!0});Lp.default=goe;var poe=$4(Re()),moe=$4(qM());function $4(t){return t&&t.__esModule?t:{default:t}}function goe(t){return(0,poe.default)(t),(0,moe.default)(t)&&t.length===24}cE.exports=Lp.default;cE.exports.default=Lp.default});var rG=ae((Op,fE)=>{"use strict";Object.defineProperty(Op,"__esModule",{value:!0});Op.default=_oe;var voe=iG(Re()),tG=iG(O_());function iG(t){return t&&t.__esModule?t:{default:t}}function _oe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:String(new Date);(0,voe.default)(t);var i=(0,tG.default)(e),r=(0,tG.default)(t);return!!(r&&i&&r>i)}fE.exports=Op.default;fE.exports.default=Op.default});var oG=ae((Dp,dE)=>{"use strict";Object.defineProperty(Dp,"__esModule",{value:!0});Dp.default=xoe;var yoe=sG(Re()),nG=sG(O_());function sG(t){return t&&t.__esModule?t:{default:t}}function xoe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:String(new Date);(0,yoe.default)(t);var i=(0,nG.default)(e),r=(0,nG.default)(t);return!!(r&&i&&r<i)}dE.exports=Dp.default;dE.exports.default=Dp.default});var lG=ae((Ip,pE)=>{"use strict";Object.defineProperty(Ip,"__esModule",{value:!0});Ip.default=Soe;var boe=aG(Re()),woe=aG(oM());function aG(t){return t&&t.__esModule?t:{default:t}}function q_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?q_=function(i){return typeof i}:q_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},q_(t)}function Soe(t,e){(0,boe.default)(t);var i;if(Object.prototype.toString.call(e)==="[object Array]"){var r=[];for(i in e)({}).hasOwnProperty.call(e,i)&&(r[i]=(0,woe.default)(e[i]));return r.indexOf(t)>=0}else{if(q_(e)==="object")return e.hasOwnProperty(t);if(e&&typeof e.indexOf=="function")return e.indexOf(t)>=0}return!1}pE.exports=Ip.default;pE.exports.default=Ip.default});var hG=ae((kp,mE)=>{"use strict";Object.defineProperty(kp,"__esModule",{value:!0});kp.default=Toe;var Coe=Moe(Re());function Moe(t){return t&&t.__esModule?t:{default:t}}var Eoe=/^(?:4[0-9]{12}(?:[0-9]{3,6})?|5[1-5][0-9]{14}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}|6(?:011|5[0-9][0-9])[0-9]{12,15}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11}|6[27][0-9]{14}|^(81[0-9]{14,17}))$/;function Toe(t){(0,Coe.default)(t);var e=t.replace(/[- ]+/g,"");if(!Eoe.test(e))return!1;for(var i=0,r,n,o,a=e.length-1;a>=0;a--)r=e.substring(a,a+1),n=parseInt(r,10),o?(n*=2,n>=10?i+=n%10+1:i+=n):i+=n,o=!o;return!!(i%10===0&&e)}mE.exports=kp.default;mE.exports.default=kp.default});var cG=ae((Bp,gE)=>{"use strict";Object.defineProperty(Bp,"__esModule",{value:!0});Bp.default=Poe;var X_=uG(Re()),Aoe=uG(W_());function uG(t){return t&&t.__esModule?t:{default:t}}var Fp={PL:function(e){(0,X_.default)(e);var i={1:1,2:3,3:7,4:9,5:1,6:3,7:7,8:9,9:1,10:3,11:0};if(e!=null&&e.length===11&&(0,Aoe.default)(e,{allow_leading_zeroes:!0})){var r=e.split("").slice(0,-1),n=r.reduce(function(l,h,u){return l+Number(h)*i[u+1]},0),o=n%10,a=Number(e.charAt(e.length-1));if(o===0&&a===0||a===10-o)return!0}return!1},ES:function(e){(0,X_.default)(e);var i=/^[0-9X-Z][0-9]{7}[TRWAGMYFPDXBNJZSQVHLCKE]$/,r={X:0,Y:1,Z:2},n=["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"],o=e.trim().toUpperCase();if(!i.test(o))return!1;var a=o.slice(0,-1).replace(/[X,Y,Z]/g,function(l){return r[l]});return o.endsWith(n[a%23])},FI:function(e){if((0,X_.default)(e),e.length!==11||!e.match(/^\d{6}[\-A\+]\d{3}[0-9ABCDEFHJKLMNPRSTUVWXY]{1}$/))return!1;var i="0123456789ABCDEFHJKLMNPRSTUVWXY",r=parseInt(e.slice(0,6),10)*1e3+parseInt(e.slice(7,10),10),n=r%31,o=i[n];return o===e.slice(10,11)},IN:function(e){var i=/^[1-9]\d{3}\s?\d{4}\s?\d{4}$/,r=[[0,1,2,3,4,5,6,7,8,9],[1,2,3,4,0,6,7,8,9,5],[2,3,4,0,1,7,8,9,5,6],[3,4,0,1,2,8,9,5,6,7],[4,0,1,2,3,9,5,6,7,8],[5,9,8,7,6,0,4,3,2,1],[6,5,9,8,7,1,0,4,3,2],[7,6,5,9,8,2,1,0,4,3],[8,7,6,5,9,3,2,1,0,4],[9,8,7,6,5,4,3,2,1,0]],n=[[0,1,2,3,4,5,6,7,8,9],[1,5,7,6,2,8,3,0,9,4],[5,8,0,3,7,9,6,1,4,2],[8,9,1,6,0,4,3,5,2,7],[9,4,5,3,1,2,6,8,7,0],[4,2,8,6,5,7,3,9,0,1],[2,7,9,3,8,0,6,4,1,5],[7,0,4,6,9,1,3,2,5,8]],o=e.trim();if(!i.test(o))return!1;var a=0,l=o.replace(/\s/g,"").split("").map(Number).reverse();return l.forEach(function(h,u){a=r[a][n[u%8][h]]}),a===0},IR:function(e){if(!e.match(/^\d{10}$/)||(e="0000".concat(e).substr(e.length-6),parseInt(e.substr(3,6),10)===0))return!1;for(var i=parseInt(e.substr(9,1),10),r=0,n=0;n<9;n++)r+=parseInt(e.substr(n,1),10)*(10-n);return r%=11,r<2&&i===r||r>=2&&i===11-r},IT:function(e){return e.length!==9||e==="CA00000AA"?!1:e.search(/C[A-Z][0-9]{5}[A-Z]{2}/i)>-1},NO:function(e){var i=e.trim();if(isNaN(Number(i))||i.length!==11||i==="00000000000")return!1;var r=i.split("").map(Number),n=(11-(3*r[0]+7*r[1]+6*r[2]+1*r[3]+8*r[4]+9*r[5]+4*r[6]+5*r[7]+2*r[8])%11)%11,o=(11-(5*r[0]+4*r[1]+3*r[2]+2*r[3]+7*r[4]+6*r[5]+5*r[6]+4*r[7]+3*r[8]+2*n)%11)%11;return!(n!==r[9]||o!==r[10])},TH:function(e){if(!e.match(/^[1-8]\d{12}$/))return!1;for(var i=0,r=0;r<12;r++)i+=parseInt(e[r],10)*(13-r);return e[12]===((11-i%11)%10).toString()},LK:function(e){var i=/^[1-9]\d{8}[vx]$/i,r=/^[1-9]\d{11}$/i;return e.length===10&&i.test(e)?!0:!!(e.length===12&&r.test(e))},"he-IL":function(e){var i=/^\d{9}$/,r=e.trim();if(!i.test(r))return!1;for(var n=r,o=0,a,l=0;l<n.length;l++)a=Number(n[l])*(l%2+1),o+=a>9?a-9:a;return o%10===0},"ar-LY":function(e){var i=/^(1|2)\d{11}$/,r=e.trim();return!!i.test(r)},"ar-TN":function(e){var i=/^\d{8}$/,r=e.trim();return!!i.test(r)},"zh-CN":function(e){var i=["11","12","13","14","15","21","22","23","31","32","33","34","35","36","37","41","42","43","44","45","46","50","51","52","53","54","61","62","63","64","65","71","81","82","91"],r=["7","9","10","5","8","4","2","1","6","3","7","9","10","5","8","4","2"],n=["1","0","X","9","8","7","6","5","4","3","2"],o=function(m){return i.includes(m)},a=function(m){var v=parseInt(m.substring(0,4),10),g=parseInt(m.substring(4,6),10),p=parseInt(m.substring(6),10),_=new Date(v,g-1,p);return _>new Date?!1:_.getFullYear()===v&&_.getMonth()===g-1&&_.getDate()===p},l=function(m){for(var v=m.substring(0,17),g=0,p=0;p<17;p++)g+=parseInt(v.charAt(p),10)*parseInt(r[p],10);var _=g%11;return n[_]},h=function(m){return l(m)===m.charAt(17).toUpperCase()},u=function(m){var v=/^[1-9]\d{7}((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))\d{3}$/.test(m);if(!v)return!1;var g=m.substring(0,2);if(v=o(g),!v)return!1;var p="19".concat(m.substring(6,12));return v=a(p),!!v},c=function(m){var v=/^[1-9]\d{5}[1-9]\d{3}((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))\d{3}(\d|x|X)$/.test(m);if(!v)return!1;var g=m.substring(0,2);if(v=o(g),!v)return!1;var p=m.substring(6,14);return v=a(p),v?h(m):!1},f=function(m){var v=/^\d{15}|(\d{17}(\d|x|X))$/.test(m);return v?m.length===15?u(m):c(m):!1};return f(e)},"zh-TW":function(e){var i={A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:34,J:18,K:19,L:20,M:21,N:22,O:35,P:23,Q:24,R:25,S:26,T:27,U:28,V:29,W:32,X:30,Y:31,Z:33},r=e.trim().toUpperCase();return/^[A-Z][0-9]{9}$/.test(r)?Array.from(r).reduce(function(n,o,a){if(a===0){var l=i[o];return l%10*9+Math.floor(l/10)}return a===9?(10-n%10-Number(o))%10===0:n+Number(o)*(9-a)},0):!1}};function Poe(t,e){if((0,X_.default)(t),e in Fp)return Fp[e](t);if(e==="any"){for(var i in Fp)if(Fp.hasOwnProperty(i)){var r=Fp[i];if(r(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}gE.exports=Bp.default;gE.exports.default=Bp.default});var fG=ae((Np,vE)=>{"use strict";Object.defineProperty(Np,"__esModule",{value:!0});Np.default=Boe;var Roe=Loe(Re());function Loe(t){return t&&t.__esModule?t:{default:t}}var Ooe=8,Doe=14,Ioe=/^(\d{8}|\d{13}|\d{14})$/;function koe(t,e){return t===Ooe||t===Doe?e%2===0?3:1:e%2===0?1:3}function Foe(t){var e=t.slice(0,-1).split("").map(function(r,n){return Number(r)*koe(t.length,n)}).reduce(function(r,n){return r+n},0),i=10-e%10;return i<10?i:0}function Boe(t){(0,Roe.default)(t);var e=Number(t.slice(-1));return Ioe.test(t)&&e===Foe(t)}vE.exports=Np.default;vE.exports.default=Np.default});var dG=ae((Up,_E)=>{"use strict";Object.defineProperty(Up,"__esModule",{value:!0});Up.default=zoe;var Noe=Uoe(Re());function Uoe(t){return t&&t.__esModule?t:{default:t}}var Goe=/^[A-Z]{2}[0-9A-Z]{9}[0-9]$/;function zoe(t){if((0,Noe.default)(t),!Goe.test(t))return!1;for(var e=!0,i=0,r=t.length-2;r>=0;r--)if(t[r]>="A"&&t[r]<="Z")for(var n=t[r].charCodeAt(0)-55,o=n%10,a=Math.trunc(n/10),l=0,h=[o,a];l<h.length;l++){var u=h[l];e?u>=5?i+=1+(u-5)*2:i+=u*2:i+=u,e=!e}else{var c=t[r].charCodeAt(0)-"0".charCodeAt(0);e?c>=5?i+=1+(c-5)*2:i+=c*2:i+=c,e=!e}var f=Math.trunc((i+9)/10)*10-i;return+t[t.length-1]===f}_E.exports=Up.default;_E.exports.default=Up.default});var pG=ae((Gp,xE)=>{"use strict";Object.defineProperty(Gp,"__esModule",{value:!0});Gp.default=yE;var Hoe=Woe(Re());function Woe(t){return t&&t.__esModule?t:{default:t}}var Voe=/^(?:[0-9]{9}X|[0-9]{10})$/,joe=/^(?:[0-9]{13})$/,qoe=[1,3];function yE(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Hoe.default)(t),e=String(e),!e)return yE(t,10)||yE(t,13);var i=t.replace(/[\s-]+/g,""),r=0,n;if(e==="10"){if(!Voe.test(i))return!1;for(n=0;n<9;n++)r+=(n+1)*i.charAt(n);if(i.charAt(9)==="X"?r+=10*10:r+=10*i.charAt(9),r%11===0)return!!i}else if(e==="13"){if(!joe.test(i))return!1;for(n=0;n<12;n++)r+=qoe[n%2]*i.charAt(n);if(i.charAt(12)-(10-r%10)%10===0)return!!i}return!1}xE.exports=Gp.default;xE.exports.default=Gp.default});var mG=ae((zp,bE)=>{"use strict";Object.defineProperty(zp,"__esModule",{value:!0});zp.default=Koe;var Xoe=Yoe(Re());function Yoe(t){return t&&t.__esModule?t:{default:t}}var Zoe="^\\d{4}-?\\d{3}[\\dX]$";function Koe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,Xoe.default)(t);var i=Zoe;if(i=e.require_hyphen?i.replace("?",""):i,i=e.case_sensitive?new RegExp(i):new RegExp(i,"i"),!i.test(t))return!1;for(var r=t.replace("-","").toUpperCase(),n=0,o=0;o<r.length;o++){var a=r[o];n+=(a==="X"?10:+a)*(8-o)}return n%11===0}bE.exports=zp.default;bE.exports.default=zp.default});var gG=ae(dc=>{"use strict";Object.defineProperty(dc,"__esModule",{value:!0});dc.iso7064Check=Qoe;dc.luhnCheck=Joe;dc.reverseMultiplyAndSum=$oe;dc.verhoeffCheck=eae;function Qoe(t){for(var e=10,i=0;i<t.length-1;i++)e=(parseInt(t[i],10)+e)%10===0?10*2%11:(parseInt(t[i],10)+e)%10*2%11;return e=e===1?0:11-e,e===parseInt(t[10],10)}function Joe(t){for(var e=0,i=!1,r=t.length-1;r>=0;r--){if(i){var n=parseInt(t[r],10)*2;n>9?e+=n.toString().split("").map(function(o){return parseInt(o,10)}).reduce(function(o,a){return o+a},0):e+=n}else e+=parseInt(t[r],10);i=!i}return e%10===0}function $oe(t,e){for(var i=0,r=0;r<t.length;r++)i+=t[r]*(e-r);return i}function eae(t){for(var e=[[0,1,2,3,4,5,6,7,8,9],[1,2,3,4,0,6,7,8,9,5],[2,3,4,0,1,7,8,9,5,6],[3,4,0,1,2,8,9,5,6,7],[4,0,1,2,3,9,5,6,7,8],[5,9,8,7,6,0,4,3,2,1],[6,5,9,8,7,1,0,4,3,2],[7,6,5,9,8,2,1,0,4,3],[8,7,6,5,9,3,2,1,0,4],[9,8,7,6,5,4,3,2,1,0]],i=[[0,1,2,3,4,5,6,7,8,9],[1,5,7,6,2,8,3,0,9,4],[5,8,0,3,7,9,6,1,4,2],[8,9,1,6,0,4,3,5,2,7],[9,4,5,3,1,2,6,8,7,0],[4,2,8,6,5,7,3,9,0,1],[2,7,9,3,8,0,6,4,1,5],[7,0,4,6,9,1,3,2,5,8]],r=t.split("").reverse().join(""),n=0,o=0;o<r.length;o++)n=e[n][i[o%8][parseInt(r[o],10)]];return n===0}});var bG=ae((Hp,CE)=>{"use strict";function Y_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Y_=function(i){return typeof i}:Y_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Y_(t)}Object.defineProperty(Hp,"__esModule",{value:!0});Hp.default=Bae;var tae=xG(Re()),Eo=iae(gG()),nn=xG(wM());function yG(){if(typeof WeakMap!="function")return null;var t=new WeakMap;return yG=function(){return t},t}function iae(t){if(t&&t.__esModule)return t;if(t===null||Y_(t)!=="object"&&typeof t!="function")return{default:t};var e=yG();if(e&&e.has(t))return e.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=r?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}return i.default=t,e&&e.set(t,i),i}function xG(t){return t&&t.__esModule?t:{default:t}}function rae(t){return aae(t)||oae(t)||sae(t)||nae()}function nae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sae(t,e){if(t){if(typeof t=="string")return SE(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return SE(t,e)}}function oae(t){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(t))return Array.from(t)}function aae(t){if(Array.isArray(t))return SE(t)}function SE(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function lae(t){var e=t.slice(0,2),i=parseInt(t.slice(2,4),10);i>40?(i-=40,e="20".concat(e)):i>20?(i-=20,e="18".concat(e)):e="19".concat(e),i<10&&(i="0".concat(i));var r="".concat(e,"/").concat(i,"/").concat(t.slice(4,6));if(!(0,nn.default)(r,"YYYY/MM/DD"))return!1;for(var n=t.split("").map(function(h){return parseInt(h,10)}),o=[2,4,8,5,10,9,7,3,6],a=0,l=0;l<o.length;l++)a+=n[l]*o[l];return a=a%11===10?0:a%11,a===n[9]}function hae(t){t=t.replace(/\W/,"");var e=parseInt(t.slice(0,2),10);if(t.length===10)e<54?e="20".concat(e):e="19".concat(e);else{if(t.slice(6)==="000")return!1;if(e<54)e="19".concat(e);else return!1}e.length===3&&(e=[e.slice(0,2),"0",e.slice(2)].join(""));var i=parseInt(t.slice(2,4),10);if(i>50&&(i-=50),i>20){if(parseInt(e,10)<2004)return!1;i-=20}i<10&&(i="0".concat(i));var r="".concat(e,"/").concat(i,"/").concat(t.slice(4,6));if(!(0,nn.default)(r,"YYYY/MM/DD"))return!1;if(t.length===10&&parseInt(t,10)%11!==0){var n=parseInt(t.slice(0,9),10)%11;if(parseInt(e,10)<1986&&n===10){if(parseInt(t.slice(9),10)!==0)return!1}else return!1}return!0}function uae(t){return Eo.luhnCheck(t)}function cae(t){for(var e=t.split("").map(function(h){return parseInt(h,10)}),i=[],r=0;r<e.length-1;r++){i.push("");for(var n=0;n<e.length-1;n++)e[r]===e[n]&&(i[r]+=n)}if(i=i.filter(function(h){return h.length>1}),i.length!==2&&i.length!==3)return!1;if(i[0].length===3){for(var o=i[0].split("").map(function(h){return parseInt(h,10)}),a=0,l=0;l<o.length-1;l++)o[l]+1===o[l+1]&&(a+=1);if(a===2)return!1}return Eo.iso7064Check(t)}function fae(t){t=t.replace(/\W/,"");var e=parseInt(t.slice(4,6),10),i=t.slice(6,7);switch(i){case"0":case"1":case"2":case"3":e="19".concat(e);break;case"4":case"9":e<37?e="20".concat(e):e="19".concat(e);break;default:if(e<37)e="20".concat(e);else if(e>58)e="18".concat(e);else return!1;break}e.length===3&&(e=[e.slice(0,2),"0",e.slice(2)].join(""));var r="".concat(e,"/").concat(t.slice(2,4),"/").concat(t.slice(0,2));if(!(0,nn.default)(r,"YYYY/MM/DD"))return!1;for(var n=t.split("").map(function(h){return parseInt(h,10)}),o=0,a=4,l=0;l<9;l++)o+=n[l]*a,a-=1,a===1&&(a=7);return o%=11,o===1?!1:o===0?n[9]===0:n[9]===11-o}function dae(t){for(var e=t.slice(0,8).split("").map(function(o){return parseInt(o,10)}),i=0,r=1;r<e.length;r+=2)i+=e[r];for(var n=0;n<e.length;n+=2)e[n]<2?i+=1-e[n]:(i+=2*(e[n]-2)+5,e[n]>4&&(i+=2));return String.fromCharCode(i%26+65)===t.charAt(8)}function pae(t){for(var e=t.split("").map(function(n){return parseInt(n,10)}),i=0,r=0;r<8;r++)i+=e[r]*Math.pow(2,8-r);return i%11%10===e[8]}function mae(t){var e=Eo.reverseMultiplyAndSum(t.split("").slice(0,7).map(function(i){return parseInt(i,10)}),8);return t.length===9&&t[8]!=="W"&&(e+=(t[8].charCodeAt(0)-64)*9),e%=23,e===0?t[7].toUpperCase()==="W":t[7].toUpperCase()===String.fromCharCode(64+e)}var wE={andover:["10","12"],atlanta:["60","67"],austin:["50","53"],brookhaven:["01","02","03","04","05","06","11","13","14","16","21","22","23","25","34","51","52","54","55","56","57","58","59","65"],cincinnati:["30","32","35","36","37","38","61"],fresno:["15","24"],internet:["20","26","27","45","46","47"],kansas:["40","44"],memphis:["94","95"],ogden:["80","90"],philadelphia:["33","39","41","42","43","46","48","62","63","64","66","68","71","72","73","74","75","76","77","81","82","83","84","85","86","87","88","91","92","93","98","99"],sba:["31"]};function gae(){var t=[];for(var e in wE)wE.hasOwnProperty(e)&&t.push.apply(t,rae(wE[e]));return t}function vae(t){return gae().indexOf(t.substr(0,2))!==-1}function _ae(t){var e=t.toUpperCase().split("");if(isNaN(parseInt(e[0],10))&&e.length>1){var i=0;switch(e[0]){case"Y":i=1;break;case"Z":i=2;break;default:}e.splice(0,1,i)}else for(;e.length<9;)e.unshift(0);var r=["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"];e=e.join("");var n=parseInt(e.slice(0,8),10)%23;return e[8]===r[n]}function yae(t){var e=t.slice(1,3),i=t.slice(0,1);switch(i){case"1":case"2":e="18".concat(e);break;case"3":case"4":e="19".concat(e);break;default:e="20".concat(e);break}var r="".concat(e,"/").concat(t.slice(3,5),"/").concat(t.slice(5,7));if(!(0,nn.default)(r,"YYYY/MM/DD"))return!1;for(var n=t.split("").map(function(u){return parseInt(u,10)}),o=0,a=1,l=0;l<10;l++)o+=n[l]*a,a+=1,a===10&&(a=1);if(o%11===10){o=0,a=3;for(var h=0;h<10;h++)o+=n[h]*a,a+=1,a===10&&(a=1);if(o%11===10)return n[10]===0}return o%11===n[10]}function xae(t){var e=t.slice(4,6),i=t.slice(6,7);switch(i){case"+":e="18".concat(e);break;case"-":e="19".concat(e);break;default:e="20".concat(e);break}var r="".concat(e,"/").concat(t.slice(2,4),"/").concat(t.slice(0,2));if(!(0,nn.default)(r,"YYYY/MM/DD"))return!1;var n=parseInt(t.slice(0,6)+t.slice(7,10),10)%31;if(n<10)return n===parseInt(t.slice(10),10);n-=10;var o=["A","B","C","D","E","F","H","J","K","L","M","N","P","R","S","T","U","V","W","X","Y"];return o[n]===t.slice(10)}function bae(t){if(t.slice(2,4)!=="00"||t.slice(4,6)!=="00"){var e="".concat(t.slice(0,2),"/").concat(t.slice(2,4),"/").concat(t.slice(4,6));if(!(0,nn.default)(e,"YY/MM/DD"))return!1}var i=97-parseInt(t.slice(0,9),10)%97,r=parseInt(t.slice(9,11),10);return!(i!==r&&(i=97-parseInt("2".concat(t.slice(0,9)),10)%97,i!==r))}function wae(t){t=t.replace(/\s/g,"");var e=parseInt(t.slice(0,10),10)%511,i=parseInt(t.slice(10,13),10);return e===i}function Sae(t){var e="".concat(t.slice(0,4),"/").concat(t.slice(4,6),"/").concat(t.slice(6,8));return!(0,nn.default)(e,"YYYY/MM/DD")||!Eo.luhnCheck(t.slice(0,12))?!1:Eo.verhoeffCheck("".concat(t.slice(0,11)).concat(t[12]))}function Cae(t){return Eo.iso7064Check(t)}function Mae(t){for(var e=t.split("").map(function(n){return parseInt(n,10)}),i=8,r=1;r<9;r++)i+=e[r]*(r+1);return i%11===e[9]}function vG(t){for(var e=!1,i=!1,r=0;r<3;r++)if(!e&&/[AEIOU]/.test(t[r]))e=!0;else if(!i&&e&&t[r]==="X")i=!0;else if(r>0&&(e&&!i&&!/[AEIOU]/.test(t[r])||i&&!/X/.test(t[r])))return!1;return!0}function Eae(t){var e=t.toUpperCase().split("");if(!vG(e.slice(0,3))||!vG(e.slice(3,6)))return!1;for(var i=[6,7,9,10,12,13,14],r={L:"0",M:"1",N:"2",P:"3",Q:"4",R:"5",S:"6",T:"7",U:"8",V:"9"},n=0,o=i;n<o.length;n++){var a=o[n];e[a]in r&&e.splice(a,1,r[e[a]])}var l={A:"01",B:"02",C:"03",D:"04",E:"05",H:"06",L:"07",M:"08",P:"09",R:"10",S:"11",T:"12"},h=l[e[8]],u=parseInt(e[9]+e[10],10);u>40&&(u-=40),u<10&&(u="0".concat(u));var c="".concat(e[6]).concat(e[7],"/").concat(h,"/").concat(u);if(!(0,nn.default)(c,"YY/MM/DD"))return!1;for(var f=0,d=1;d<e.length-1;d+=2){var m=parseInt(e[d],10);isNaN(m)&&(m=e[d].charCodeAt(0)-65),f+=m}for(var v={A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23,0:1,1:0},g=0;g<e.length-1;g+=2){var p=0;if(e[g]in v)p=v[e[g]];else{var _=parseInt(e[g],10);p=2*_+1,_>4&&(p+=2)}f+=p}return String.fromCharCode(65+f%26)===e[15]}function Tae(t){t=t.replace(/\W/,"");var e=t.slice(0,2);if(e!=="32"){var i=t.slice(2,4);if(i!=="00"){var r=t.slice(4,6);switch(t[6]){case"0":r="18".concat(r);break;case"1":r="19".concat(r);break;default:r="20".concat(r);break}var n="".concat(r,"/").concat(t.slice(2,4),"/").concat(e);if(!(0,nn.default)(n,"YYYY/MM/DD"))return!1}for(var o=1101,a=[1,6,3,7,9,10,5,8,4,2],l=0;l<t.length-1;l++)o-=parseInt(t[l],10)*a[l];return parseInt(t[10],10)===o%11}return!0}function Aae(t){if(t.length!==9){for(var e=t.toUpperCase().split("");e.length<8;)e.unshift(0);switch(t[7]){case"A":case"P":if(parseInt(e[6],10)===0)return!1;break;default:{var i=parseInt(e.join("").slice(0,5),10);if(i>32e3)return!1;var r=parseInt(e.join("").slice(5,7),10);if(i===r)return!1}}}return!0}function Pae(t){return Eo.reverseMultiplyAndSum(t.split("").slice(0,8).map(function(e){return parseInt(e,10)}),9)%11===parseInt(t[8],10)}function Rae(t){if(t.length===10){for(var e=[6,5,7,2,3,4,5,6,7],i=0,r=0;r<e.length;r++)i+=parseInt(t[r],10)*e[r];return i%=11,i===10?!1:i===parseInt(t[9],10)}var n=t.slice(0,2),o=parseInt(t.slice(2,4),10);o>80?(n="18".concat(n),o-=80):o>60?(n="22".concat(n),o-=60):o>40?(n="21".concat(n),o-=40):o>20?(n="20".concat(n),o-=20):n="19".concat(n),o<10&&(o="0".concat(o));var a="".concat(n,"/").concat(o,"/").concat(t.slice(4,6));if(!(0,nn.default)(a,"YYYY/MM/DD"))return!1;for(var l=0,h=1,u=0;u<t.length-1;u++)l+=parseInt(t[u],10)*h%10,h+=2,h>10?h=1:h===5&&(h+=2);return l=10-l%10,l===parseInt(t[10],10)}function Lae(t){if(t.length===11){var e,i;if(e=0,t==="11111111111"||t==="22222222222"||t==="33333333333"||t==="44444444444"||t==="55555555555"||t==="66666666666"||t==="77777777777"||t==="88888888888"||t==="99999999999"||t==="00000000000")return!1;for(var r=1;r<=9;r++)e+=parseInt(t.substring(r-1,r),10)*(11-r);if(i=e*10%11,i===10&&(i=0),i!==parseInt(t.substring(9,10),10))return!1;e=0;for(var n=1;n<=10;n++)e+=parseInt(t.substring(n-1,n),10)*(12-n);return i=e*10%11,i===10&&(i=0),i===parseInt(t.substring(10,11),10)}if(t==="00000000000000"||t==="11111111111111"||t==="22222222222222"||t==="33333333333333"||t==="44444444444444"||t==="55555555555555"||t==="66666666666666"||t==="77777777777777"||t==="88888888888888"||t==="99999999999999")return!1;for(var o=t.length-2,a=t.substring(0,o),l=t.substring(o),h=0,u=o-7,c=o;c>=1;c--)h+=a.charAt(o-c)*u,u-=1,u<2&&(u=9);var f=h%11<2?0:11-h%11;if(f!==parseInt(l.charAt(0),10))return!1;o+=1,a=t.substring(0,o),h=0,u=o-7;for(var d=o;d>=1;d--)h+=a.charAt(o-d)*u,u-=1,u<2&&(u=9);return f=h%11<2?0:11-h%11,f===parseInt(l.charAt(1),10)}function Oae(t){var e=11-Eo.reverseMultiplyAndSum(t.split("").slice(0,8).map(function(i){return parseInt(i,10)}),9)%11;return e>9?parseInt(t[8],10)===0:e===parseInt(t[8],10)}function Dae(t){if(t.slice(0,4)!=="9000"){var e=t.slice(1,3);switch(t[0]){case"1":case"2":e="19".concat(e);break;case"3":case"4":e="18".concat(e);break;case"5":case"6":e="20".concat(e);break;default:}var i="".concat(e,"/").concat(t.slice(3,5),"/").concat(t.slice(5,7));if(i.length===8){if(!(0,nn.default)(i,"YY/MM/DD"))return!1}else if(!(0,nn.default)(i,"YYYY/MM/DD"))return!1;for(var r=t.split("").map(function(l){return parseInt(l,10)}),n=[2,7,9,1,4,6,3,5,8,2,7,9],o=0,a=0;a<n.length;a++)o+=r[a]*n[a];return o%11===10?r[12]===1:r[12]===o%11}return!0}function Iae(t){if(t.length===9){if(t=t.replace(/\W/,""),t.slice(6)==="000")return!1;var e=parseInt(t.slice(0,2),10);if(e>53)return!1;e<10?e="190".concat(e):e="19".concat(e);var i=parseInt(t.slice(2,4),10);i>50&&(i-=50),i<10&&(i="0".concat(i));var r="".concat(e,"/").concat(i,"/").concat(t.slice(4,6));if(!(0,nn.default)(r,"YYYY/MM/DD"))return!1}return!0}function kae(t){var e=11-Eo.reverseMultiplyAndSum(t.split("").slice(0,7).map(function(i){return parseInt(i,10)}),8)%11;return e===10?parseInt(t[7],10)===0:e===parseInt(t[7],10)}function Fae(t){var e=t.slice(0);t.length>11&&(e=e.slice(2));var i="",r=e.slice(2,4),n=parseInt(e.slice(4,6),10);if(t.length>11)i=t.slice(0,4);else if(i=t.slice(0,2),t.length===11&&n<60){var o=new Date().getFullYear().toString(),a=parseInt(o.slice(0,2),10);if(o=parseInt(o,10),t[6]==="-")parseInt("".concat(a).concat(i),10)>o?i="".concat(a-1).concat(i):i="".concat(a).concat(i);else if(i="".concat(a-1).concat(i),o-parseInt(i,10)<100)return!1}n>60&&(n-=60),n<10&&(n="0".concat(n));var l="".concat(i,"/").concat(r,"/").concat(n);if(l.length===8){if(!(0,nn.default)(l,"YY/MM/DD"))return!1}else if(!(0,nn.default)(l,"YYYY/MM/DD"))return!1;return Eo.luhnCheck(t.replace(/\W/,""))}var cl={"bg-BG":/^\d{10}$/,"cs-CZ":/^\d{6}\/{0,1}\d{3,4}$/,"de-AT":/^\d{9}$/,"de-DE":/^[1-9]\d{10}$/,"dk-DK":/^\d{6}-{0,1}\d{4}$/,"el-CY":/^[09]\d{7}[A-Z]$/,"el-GR":/^([0-4]|[7-9])\d{8}$/,"en-GB":/^\d{10}$|^(?!GB|NK|TN|ZZ)(?![DFIQUV])[A-Z](?![DFIQUVO])[A-Z]\d{6}[ABCD ]$/i,"en-IE":/^\d{7}[A-W][A-IW]{0,1}$/i,"en-US":/^\d{2}[- ]{0,1}\d{7}$/,"es-ES":/^(\d{0,8}|[XYZKLM]\d{7})[A-HJ-NP-TV-Z]$/i,"et-EE":/^[1-6]\d{6}(00[1-9]|0[1-9][0-9]|[1-6][0-9]{2}|70[0-9]|710)\d$/,"fi-FI":/^\d{6}[-+A]\d{3}[0-9A-FHJ-NPR-Y]$/i,"fr-BE":/^\d{11}$/,"fr-FR":/^[0-3]\d{12}$|^[0-3]\d\s\d{2}(\s\d{3}){3}$/,"fr-LU":/^\d{13}$/,"hr-HR":/^\d{11}$/,"hu-HU":/^8\d{9}$/,"it-IT":/^[A-Z]{6}[L-NP-V0-9]{2}[A-EHLMPRST][L-NP-V0-9]{2}[A-ILMZ][L-NP-V0-9]{3}[A-Z]$/i,"lv-LV":/^\d{6}-{0,1}\d{5}$/,"mt-MT":/^\d{3,7}[APMGLHBZ]$|^([1-8])\1\d{7}$/i,"nl-NL":/^\d{9}$/,"pl-PL":/^\d{10,11}$/,"pt-BR":/(?:^\d{11}$)|(?:^\d{14}$)/,"pt-PT":/^\d{9}$/,"ro-RO":/^\d{13}$/,"sk-SK":/^\d{6}\/{0,1}\d{3,4}$/,"sl-SI":/^[1-9]\d{7}$/,"sv-SE":/^(\d{6}[-+]{0,1}\d{4}|(18|19|20)\d{6}[-+]{0,1}\d{4})$/};cl["lb-LU"]=cl["fr-LU"];cl["lt-LT"]=cl["et-EE"];cl["nl-BE"]=cl["fr-BE"];var fl={"bg-BG":lae,"cs-CZ":hae,"de-AT":uae,"de-DE":cae,"dk-DK":fae,"el-CY":dae,"el-GR":pae,"en-IE":mae,"en-US":vae,"es-ES":_ae,"et-EE":yae,"fi-FI":xae,"fr-BE":bae,"fr-FR":wae,"fr-LU":Sae,"hr-HR":Cae,"hu-HU":Mae,"it-IT":Eae,"lv-LV":Tae,"mt-MT":Aae,"nl-NL":Pae,"pl-PL":Rae,"pt-BR":Lae,"pt-PT":Oae,"ro-RO":Dae,"sk-SK":Iae,"sl-SI":kae,"sv-SE":Fae};fl["lb-LU"]=fl["fr-LU"];fl["lt-LT"]=fl["et-EE"];fl["nl-BE"]=fl["fr-BE"];var _G=/[-\\\/!@#$%\^&\*\(\)\+\=\[\]]+/g,Z_={"de-AT":_G,"de-DE":/[\/\\]/g,"fr-BE":_G};Z_["nl-BE"]=Z_["fr-BE"];function Bae(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US";(0,tae.default)(t);var i=t.slice(0);if(e in cl)return e in Z_&&(i=i.replace(Z_[e],"")),cl[e].test(i)?e in fl?fl[e](i):!0:!1;throw new Error("Invalid locale '".concat(e,"'"))}CE.exports=Hp.default;CE.exports.default=Hp.default});var wG=ae(Wp=>{"use strict";Object.defineProperty(Wp,"__esModule",{value:!0});Wp.default=Gae;Wp.locales=void 0;var Nae=Uae(Re());function Uae(t){return t&&t.__esModule?t:{default:t}}var pi={"am-AM":/^(\+?374|0)((10|[9|7][0-9])\d{6}$|[2-4]\d{7}$)/,"ar-AE":/^((\+?971)|0)?5[024568]\d{7}$/,"ar-BH":/^(\+?973)?(3|6)\d{7}$/,"ar-DZ":/^(\+?213|0)(5|6|7)\d{8}$/,"ar-LB":/^(\+?961)?((3|81)\d{6}|7\d{7})$/,"ar-EG":/^((\+?20)|0)?1[0125]\d{8}$/,"ar-IQ":/^(\+?964|0)?7[0-9]\d{8}$/,"ar-JO":/^(\+?962|0)?7[789]\d{7}$/,"ar-KW":/^(\+?965)[569]\d{7}$/,"ar-LY":/^((\+?218)|0)?(9[1-6]\d{7}|[1-8]\d{7,9})$/,"ar-MA":/^(?:(?:\+|00)212|0)[5-7]\d{8}$/,"ar-OM":/^((\+|00)968)?(9[1-9])\d{6}$/,"ar-PS":/^(\+?970|0)5[6|9](\d{7})$/,"ar-SA":/^(!?(\+?966)|0)?5\d{8}$/,"ar-SY":/^(!?(\+?963)|0)?9\d{8}$/,"ar-TN":/^(\+?216)?[2459]\d{7}$/,"az-AZ":/^(\+994|0)(5[015]|7[07]|99)\d{7}$/,"bs-BA":/^((((\+|00)3876)|06))((([0-3]|[5-6])\d{6})|(4\d{7}))$/,"be-BY":/^(\+?375)?(24|25|29|33|44)\d{7}$/,"bg-BG":/^(\+?359|0)?8[789]\d{7}$/,"bn-BD":/^(\+?880|0)1[13456789][0-9]{8}$/,"ca-AD":/^(\+376)?[346]\d{5}$/,"cs-CZ":/^(\+?420)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$/,"da-DK":/^(\+?45)?\s?\d{2}\s?\d{2}\s?\d{2}\s?\d{2}$/,"de-DE":/^((\+49|0)[1|3])([0|5][0-45-9]\d|6([23]|0\d?)|7([0-57-9]|6\d))\d{7,9}$/,"de-AT":/^(\+43|0)\d{1,4}\d{3,12}$/,"de-CH":/^(\+41|0)([1-9])\d{1,9}$/,"de-LU":/^(\+352)?((6\d1)\d{6})$/,"dv-MV":/^(\+?960)?(7[2-9]|91|9[3-9])\d{7}$/,"el-GR":/^(\+?30|0)?(69\d{8})$/,"en-AU":/^(\+?61|0)4\d{8}$/,"en-BM":/^(\+?1)?441(((3|7)\d{6}$)|(5[0-3][0-9]\d{4}$)|(59\d{5}))/,"en-GB":/^(\+?44|0)7\d{9}$/,"en-GG":/^(\+?44|0)1481\d{6}$/,"en-GH":/^(\+233|0)(20|50|24|54|27|57|26|56|23|28|55|59)\d{7}$/,"en-GY":/^(\+592|0)6\d{6}$/,"en-HK":/^(\+?852[-\s]?)?[456789]\d{3}[-\s]?\d{4}$/,"en-MO":/^(\+?853[-\s]?)?[6]\d{3}[-\s]?\d{4}$/,"en-IE":/^(\+?353|0)8[356789]\d{7}$/,"en-IN":/^(\+?91|0)?[6789]\d{9}$/,"en-KE":/^(\+?254|0)(7|1)\d{8}$/,"en-KI":/^((\+686|686)?)?( )?((6|7)(2|3|8)[0-9]{6})$/,"en-MT":/^(\+?356|0)?(99|79|77|21|27|22|25)[0-9]{6}$/,"en-MU":/^(\+?230|0)?\d{8}$/,"en-NA":/^(\+?264|0)(6|8)\d{7}$/,"en-NG":/^(\+?234|0)?[789]\d{9}$/,"en-NZ":/^(\+?64|0)[28]\d{7,9}$/,"en-PK":/^((00|\+)?92|0)3[0-6]\d{8}$/,"en-PH":/^(09|\+639)\d{9}$/,"en-RW":/^(\+?250|0)?[7]\d{8}$/,"en-SG":/^(\+65)?[3689]\d{7}$/,"en-SL":/^(\+?232|0)\d{8}$/,"en-TZ":/^(\+?255|0)?[67]\d{8}$/,"en-UG":/^(\+?256|0)?[7]\d{8}$/,"en-US":/^((\+1|1)?( |-)?)?(\([2-9][0-9]{2}\)|[2-9][0-9]{2})( |-)?([2-9][0-9]{2}( |-)?[0-9]{4})$/,"en-ZA":/^(\+?27|0)\d{9}$/,"en-ZM":/^(\+?26)?09[567]\d{7}$/,"en-ZW":/^(\+263)[0-9]{9}$/,"en-BW":/^(\+?267)?(7[1-8]{1})\d{6}$/,"es-AR":/^\+?549(11|[2368]\d)\d{8}$/,"es-BO":/^(\+?591)?(6|7)\d{7}$/,"es-CO":/^(\+?57)?3(0(0|1|2|4|5)|1\d|2[0-4]|5(0|1))\d{7}$/,"es-CL":/^(\+?56|0)[2-9]\d{1}\d{7}$/,"es-CR":/^(\+506)?[2-8]\d{7}$/,"es-CU":/^(\+53|0053)?5\d{7}/,"es-DO":/^(\+?1)?8[024]9\d{7}$/,"es-HN":/^(\+?504)?[9|8]\d{7}$/,"es-EC":/^(\+?593|0)([2-7]|9[2-9])\d{7}$/,"es-ES":/^(\+?34)?[6|7]\d{8}$/,"es-PE":/^(\+?51)?9\d{8}$/,"es-MX":/^(\+?52)?(1|01)?\d{10,11}$/,"es-PA":/^(\+?507)\d{7,8}$/,"es-PY":/^(\+?595|0)9[9876]\d{7}$/,"es-SV":/^(\+?503)?[67]\d{7}$/,"es-UY":/^(\+598|0)9[1-9][\d]{6}$/,"es-VE":/^(\+?58)?(2|4)\d{9}$/,"et-EE":/^(\+?372)?\s?(5|8[1-4])\s?([0-9]\s?){6,7}$/,"fa-IR":/^(\+?98[\-\s]?|0)9[0-39]\d[\-\s]?\d{3}[\-\s]?\d{4}$/,"fi-FI":/^(\+?358|0)\s?(4(0|1|2|4|5|6)?|50)\s?(\d\s?){4,8}\d$/,"fj-FJ":/^(\+?679)?\s?\d{3}\s?\d{4}$/,"fo-FO":/^(\+?298)?\s?\d{2}\s?\d{2}\s?\d{2}$/,"fr-BF":/^(\+226|0)[67]\d{7}$/,"fr-CM":/^(\+?237)6[0-9]{8}$/,"fr-FR":/^(\+?33|0)[67]\d{8}$/,"fr-GF":/^(\+?594|0|00594)[67]\d{8}$/,"fr-GP":/^(\+?590|0|00590)[67]\d{8}$/,"fr-MQ":/^(\+?596|0|00596)[67]\d{8}$/,"fr-PF":/^(\+?689)?8[789]\d{6}$/,"fr-RE":/^(\+?262|0|00262)[67]\d{8}$/,"he-IL":/^(\+972|0)([23489]|5[012345689]|77)[1-9]\d{6}$/,"hu-HU":/^(\+?36|06)(20|30|31|50|70)\d{7}$/,"id-ID":/^(\+?62|0)8(1[123456789]|2[1238]|3[1238]|5[12356789]|7[78]|9[56789]|8[123456789])([\s?|\d]{5,11})$/,"it-IT":/^(\+?39)?\s?3\d{2} ?\d{6,7}$/,"it-SM":/^((\+378)|(0549)|(\+390549)|(\+3780549))?6\d{5,9}$/,"ja-JP":/^(\+81[ \-]?(\(0\))?|0)[6789]0[ \-]?\d{4}[ \-]?\d{4}$/,"ka-GE":/^(\+?995)?(5|79)\d{7}$/,"kk-KZ":/^(\+?7|8)?7\d{9}$/,"kl-GL":/^(\+?299)?\s?\d{2}\s?\d{2}\s?\d{2}$/,"ko-KR":/^((\+?82)[ \-]?)?0?1([0|1|6|7|8|9]{1})[ \-]?\d{3,4}[ \-]?\d{4}$/,"lt-LT":/^(\+370|8)\d{8}$/,"lv-LV":/^(\+?371)2\d{7}$/,"ms-MY":/^(\+?6?01){1}(([0145]{1}(\-|\s)?\d{7,8})|([236789]{1}(\s|\-)?\d{7}))$/,"mz-MZ":/^(\+?258)?8[234567]\d{7}$/,"nb-NO":/^(\+?47)?[49]\d{7}$/,"ne-NP":/^(\+?977)?9[78]\d{8}$/,"nl-BE":/^(\+?32|0)4\d{8}$/,"nl-NL":/^(((\+|00)?31\(0\))|((\+|00)?31)|0)6{1}\d{8}$/,"nn-NO":/^(\+?47)?[49]\d{7}$/,"pl-PL":/^(\+?48)? ?[5-8]\d ?\d{3} ?\d{2} ?\d{2}$/,"pt-BR":/^((\+?55\ ?[1-9]{2}\ ?)|(\+?55\ ?\([1-9]{2}\)\ ?)|(0[1-9]{2}\ ?)|(\([1-9]{2}\)\ ?)|([1-9]{2}\ ?))((\d{4}\-?\d{4})|(9[2-9]{1}\d{3}\-?\d{4}))$/,"pt-PT":/^(\+?351)?9[1236]\d{7}$/,"pt-AO":/^(\+244)\d{9}$/,"ro-RO":/^(\+?4?0)\s?7\d{2}(\/|\s|\.|\-)?\d{3}(\s|\.|\-)?\d{3}$/,"ru-RU":/^(\+?7|8)?9\d{9}$/,"si-LK":/^(?:0|94|\+94)?(7(0|1|2|4|5|6|7|8)( |-)?)\d{7}$/,"sl-SI":/^(\+386\s?|0)(\d{1}\s?\d{3}\s?\d{2}\s?\d{2}|\d{2}\s?\d{3}\s?\d{3})$/,"sk-SK":/^(\+?421)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$/,"sq-AL":/^(\+355|0)6[789]\d{6}$/,"sr-RS":/^(\+3816|06)[- \d]{5,9}$/,"sv-SE":/^(\+?46|0)[\s\-]?7[\s\-]?[02369]([\s\-]?\d){7}$/,"tg-TJ":/^(\+?992)?[5][5]\d{7}$/,"th-TH":/^(\+66|66|0)\d{9}$/,"tr-TR":/^(\+?90|0)?5\d{9}$/,"tk-TM":/^(\+993|993|8)\d{8}$/,"uk-UA":/^(\+?38|8)?0\d{9}$/,"uz-UZ":/^(\+?998)?(6[125-79]|7[1-69]|88|9\d)\d{7}$/,"vi-VN":/^((\+?84)|0)((3([2-9]))|(5([25689]))|(7([0|6-9]))|(8([1-9]))|(9([0-9])))([0-9]{7})$/,"zh-CN":/^((\+|00)86)?(1[3-9]|9[28])\d{9}$/,"zh-TW":/^(\+?886\-?|0)?9\d{8}$/,"dz-BT":/^(\+?975|0)?(17|16|77|02)\d{6}$/};pi["en-CA"]=pi["en-US"];pi["fr-CA"]=pi["en-CA"];pi["fr-BE"]=pi["nl-BE"];pi["zh-HK"]=pi["en-HK"];pi["zh-MO"]=pi["en-MO"];pi["ga-IE"]=pi["en-IE"];pi["fr-CH"]=pi["de-CH"];pi["it-CH"]=pi["fr-CH"];function Gae(t,e,i){if((0,Nae.default)(t),i&&i.strictMode&&!t.startsWith("+"))return!1;if(Array.isArray(e))return e.some(function(o){if(pi.hasOwnProperty(o)){var a=pi[o];if(a.test(t))return!0}return!1});if(e in pi)return pi[e].test(t);if(!e||e==="any"){for(var r in pi)if(pi.hasOwnProperty(r)){var n=pi[r];if(n.test(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}var zae=Object.keys(pi);Wp.locales=zae});var SG=ae((Vp,ME)=>{"use strict";Object.defineProperty(Vp,"__esModule",{value:!0});Vp.default=jae;var Hae=Wae(Re());function Wae(t){return t&&t.__esModule?t:{default:t}}var Vae=/^(0x)[0-9a-f]{40}$/i;function jae(t){return(0,Hae.default)(t),Vae.test(t)}ME.exports=Vp.default;ME.exports.default=Vp.default});var MG=ae((jp,EE)=>{"use strict";Object.defineProperty(jp,"__esModule",{value:!0});jp.default=Kae;var qae=CG(wn()),Xae=CG(Re());function CG(t){return t&&t.__esModule?t:{default:t}}function Yae(t){var e="\\d{".concat(t.digits_after_decimal[0],"}");t.digits_after_decimal.forEach(function(c,f){f!==0&&(e="".concat(e,"|\\d{").concat(c,"}"))});var i="(".concat(t.symbol.replace(/\W/,function(c){return"\\".concat(c)}),")").concat(t.require_symbol?"":"?"),r="-?",n="[1-9]\\d*",o="[1-9]\\d{0,2}(\\".concat(t.thousands_separator,"\\d{3})*"),a=["0",n,o],l="(".concat(a.join("|"),")?"),h="(\\".concat(t.decimal_separator,"(").concat(e,"))").concat(t.require_decimal?"":"?"),u=l+(t.allow_decimal||t.require_decimal?h:"");return t.allow_negatives&&!t.parens_for_negatives&&(t.negative_sign_after_digits?u+=r:t.negative_sign_before_digits&&(u=r+u)),t.allow_negative_sign_placeholder?u="( (?!\\-))?".concat(u):t.allow_space_after_symbol?u=" ?".concat(u):t.allow_space_after_digits&&(u+="( (?!$))?"),t.symbol_after_digits?u+=i:u=i+u,t.allow_negatives&&(t.parens_for_negatives?u="(\\(".concat(u,"\\)|").concat(u,")"):t.negative_sign_before_digits||t.negative_sign_after_digits||(u=r+u)),new RegExp("^(?!-? )(?=.*\\d)".concat(u,"$"))}var Zae={symbol:"$",require_symbol:!1,allow_space_after_symbol:!1,symbol_after_digits:!1,allow_negatives:!0,parens_for_negatives:!1,negative_sign_before_digits:!1,negative_sign_after_digits:!1,allow_negative_sign_placeholder:!1,thousands_separator:",",decimal_separator:".",allow_decimal:!0,require_decimal:!1,digits_after_decimal:[2],allow_space_after_digits:!1};function Kae(t,e){return(0,Xae.default)(t),e=(0,qae.default)(e,Zae),Yae(e).test(t)}EE.exports=jp.default;EE.exports.default=jp.default});var EG=ae((qp,TE)=>{"use strict";Object.defineProperty(qp,"__esModule",{value:!0});qp.default=tle;var Qae=Jae(Re());function Jae(t){return t&&t.__esModule?t:{default:t}}var $ae=/^(bc1)[a-z0-9]{25,39}$/,ele=/^(1|3)[A-HJ-NP-Za-km-z1-9]{25,39}$/;function tle(t){return(0,Qae.default)(t),t.startsWith("bc1")?$ae.test(t):ele.test(t)}TE.exports=qp.default;TE.exports.default=qp.default});var TG=ae((Xp,AE)=>{"use strict";Object.defineProperty(Xp,"__esModule",{value:!0});Xp.default=ale;var ile=rle(Re());function rle(t){return t&&t.__esModule?t:{default:t}}var nle=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,sle=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,ole=function(e){var i=e.match(/^(\d{4})-?(\d{3})([ T]{1}\.*|$)/);if(i){var r=Number(i[1]),n=Number(i[2]);return r%4===0&&r%100!==0||r%400===0?n<=366:n<=365}var o=e.match(/(\d{4})-?(\d{0,2})-?(\d*)/).map(Number),a=o[1],l=o[2],h=o[3],u=l&&"0".concat(l).slice(-2),c=h&&"0".concat(h).slice(-2),f=new Date("".concat(a,"-").concat(u||"01","-").concat(c||"01"));return l&&h?f.getUTCFullYear()===a&&f.getUTCMonth()+1===l&&f.getUTCDate()===h:!0};function ale(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,ile.default)(t);var i=e.strictSeparator?sle.test(t):nle.test(t);return i&&e.strict?ole(t):i}AE.exports=Xp.default;AE.exports.default=Xp.default});var RG=ae((Yp,PE)=>{"use strict";Object.defineProperty(Yp,"__esModule",{value:!0});Yp.default=ble;var lle=hle(Re());function hle(t){return t&&t.__esModule?t:{default:t}}var ule=/[0-9]{4}/,cle=/(0[1-9]|1[0-2])/,fle=/([12]\d|0[1-9]|3[01])/,AG=/([01][0-9]|2[0-3])/,PG=/[0-5][0-9]/,dle=/([0-5][0-9]|60)/,ple=/(\.[0-9]+)?/,mle=new RegExp("[-+]".concat(AG.source,":").concat(PG.source)),gle=new RegExp("([zZ]|".concat(mle.source,")")),vle=new RegExp("".concat(AG.source,":").concat(PG.source,":").concat(dle.source).concat(ple.source)),_le=new RegExp("".concat(ule.source,"-").concat(cle.source,"-").concat(fle.source)),yle=new RegExp("".concat(vle.source).concat(gle.source)),xle=new RegExp("^".concat(_le.source,"[ tT]").concat(yle.source,"$"));function ble(t){return(0,lle.default)(t),xle.test(t)}PE.exports=Yp.default;PE.exports.default=Yp.default});var LG=ae((Zp,RE)=>{"use strict";Object.defineProperty(Zp,"__esModule",{value:!0});Zp.default=Mle;var wle=Sle(Re());function Sle(t){return t&&t.__esModule?t:{default:t}}var Cle=new Set(["AFG","ALA","ALB","DZA","ASM","AND","AGO","AIA","ATA","ATG","ARG","ARM","ABW","AUS","AUT","AZE","BHS","BHR","BGD","BRB","BLR","BEL","BLZ","BEN","BMU","BTN","BOL","BES","BIH","BWA","BVT","BRA","IOT","BRN","BGR","BFA","BDI","KHM","CMR","CAN","CPV","CYM","CAF","TCD","CHL","CHN","CXR","CCK","COL","COM","COG","COD","COK","CRI","CIV","HRV","CUB","CUW","CYP","CZE","DNK","DJI","DMA","DOM","ECU","EGY","SLV","GNQ","ERI","EST","ETH","FLK","FRO","FJI","FIN","FRA","GUF","PYF","ATF","GAB","GMB","GEO","DEU","GHA","GIB","GRC","GRL","GRD","GLP","GUM","GTM","GGY","GIN","GNB","GUY","HTI","HMD","VAT","HND","HKG","HUN","ISL","IND","IDN","IRN","IRQ","IRL","IMN","ISR","ITA","JAM","JPN","JEY","JOR","KAZ","KEN","KIR","PRK","KOR","KWT","KGZ","LAO","LVA","LBN","LSO","LBR","LBY","LIE","LTU","LUX","MAC","MKD","MDG","MWI","MYS","MDV","MLI","MLT","MHL","MTQ","MRT","MUS","MYT","MEX","FSM","MDA","MCO","MNG","MNE","MSR","MAR","MOZ","MMR","NAM","NRU","NPL","NLD","NCL","NZL","NIC","NER","NGA","NIU","NFK","MNP","NOR","OMN","PAK","PLW","PSE","PAN","PNG","PRY","PER","PHL","PCN","POL","PRT","PRI","QAT","REU","ROU","RUS","RWA","BLM","SHN","KNA","LCA","MAF","SPM","VCT","WSM","SMR","STP","SAU","SEN","SRB","SYC","SLE","SGP","SXM","SVK","SVN","SLB","SOM","ZAF","SGS","SSD","ESP","LKA","SDN","SUR","SJM","SWZ","SWE","CHE","SYR","TWN","TJK","TZA","THA","TLS","TGO","TKL","TON","TTO","TUN","TUR","TKM","TCA","TUV","UGA","UKR","ARE","GBR","USA","UMI","URY","UZB","VUT","VEN","VNM","VGB","VIR","WLF","ESH","YEM","ZMB","ZWE"]);function Mle(t){return(0,wle.default)(t),Cle.has(t.toUpperCase())}RE.exports=Zp.default;RE.exports.default=Zp.default});var DG=ae(Kp=>{"use strict";Object.defineProperty(Kp,"__esModule",{value:!0});Kp.default=Ale;Kp.CurrencyCodes=void 0;var Ele=Tle(Re());function Tle(t){return t&&t.__esModule?t:{default:t}}var OG=new Set(["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BOV","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHE","CHF","CHW","CLF","CLP","CNY","COP","COU","CRC","CUC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MXV","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","USN","UYI","UYU","UYW","UZS","VES","VND","VUV","WST","XAF","XAG","XAU","XBA","XBB","XBC","XBD","XCD","XDR","XOF","XPD","XPF","XPT","XSU","XTS","XUA","XXX","YER","ZAR","ZMW","ZWL"]);function Ale(t){return(0,Ele.default)(t),OG.has(t.toUpperCase())}var Ple=OG;Kp.CurrencyCodes=Ple});var IG=ae((Qp,LE)=>{"use strict";Object.defineProperty(Qp,"__esModule",{value:!0});Qp.default=Dle;var Rle=Lle(Re());function Lle(t){return t&&t.__esModule?t:{default:t}}var Ole=/^[A-Z2-7]+=*$/;function Dle(t){(0,Rle.default)(t);var e=t.length;return!!(e%8===0&&Ole.test(t))}LE.exports=Qp.default;LE.exports.default=Qp.default});var kG=ae((Jp,OE)=>{"use strict";Object.defineProperty(Jp,"__esModule",{value:!0});Jp.default=Ble;var Ile=kle(Re());function kle(t){return t&&t.__esModule?t:{default:t}}var Fle=/^[A-HJ-NP-Za-km-z1-9]*$/;function Ble(t){return(0,Ile.default)(t),!!Fle.test(t)}OE.exports=Jp.default;OE.exports.default=Jp.default});var FG=ae(($p,DE)=>{"use strict";Object.defineProperty($p,"__esModule",{value:!0});$p.default=Wle;var Nle=Ule(Re());function Ule(t){return t&&t.__esModule?t:{default:t}}var Gle=/^[a-z]+\/[a-z0-9\-\+]+$/i,zle=/^[a-z\-]+=[a-z0-9\-]+$/i,Hle=/^[a-z0-9!\$&'\(\)\*\+,;=\-\._~:@\/\?%\s]*$/i;function Wle(t){(0,Nle.default)(t);var e=t.split(",");if(e.length<2)return!1;var i=e.shift().trim().split(";"),r=i.shift();if(r.substr(0,5)!=="data:")return!1;var n=r.substr(5);if(n!==""&&!Gle.test(n))return!1;for(var o=0;o<i.length;o++)if(!(o===i.length-1&&i[o].toLowerCase()==="base64")&&!zle.test(i[o]))return!1;for(var a=0;a<e.length;a++)if(!Hle.test(e[a]))return!1;return!0}DE.exports=$p.default;DE.exports.default=$p.default});var BG=ae((em,IE)=>{"use strict";Object.defineProperty(em,"__esModule",{value:!0});em.default=Xle;var Vle=jle(Re());function jle(t){return t&&t.__esModule?t:{default:t}}var qle=/^magnet:\?xt(?:\.1)?=urn:(?:aich|bitprint|btih|ed2k|ed2khash|kzhash|md5|sha1|tree:tiger):[a-z0-9]{32}(?:[a-z0-9]{8})?($|&)/i;function Xle(t){return(0,Vle.default)(t),qle.test(t.trim())}IE.exports=em.default;IE.exports.default=em.default});var NG=ae((tm,kE)=>{"use strict";Object.defineProperty(tm,"__esModule",{value:!0});tm.default=$le;var Yle=Zle(Re());function Zle(t){return t&&t.__esModule?t:{default:t}}var Kle=/^(application|audio|font|image|message|model|multipart|text|video)\/[a-zA-Z0-9\.\-\+]{1,100}$/i,Qle=/^text\/[a-zA-Z0-9\.\-\+]{1,100};\s?charset=("[a-zA-Z0-9\.\-\+\s]{0,70}"|[a-zA-Z0-9\.\-\+]{0,70})(\s?\([a-zA-Z0-9\.\-\+\s]{1,20}\))?$/i,Jle=/^multipart\/[a-zA-Z0-9\.\-\+]{1,100}(;\s?(boundary|charset)=("[a-zA-Z0-9\.\-\+\s]{0,70}"|[a-zA-Z0-9\.\-\+]{0,70})(\s?\([a-zA-Z0-9\.\-\+\s]{1,20}\))?){0,2}$/i;function $le(t){return(0,Yle.default)(t),Kle.test(t)||Qle.test(t)||Jle.test(t)}kE.exports=tm.default;kE.exports.default=tm.default});var GG=ae((im,FE)=>{"use strict";Object.defineProperty(im,"__esModule",{value:!0});im.default=ahe;var ehe=UG(Re()),the=UG(wn());function UG(t){return t&&t.__esModule?t:{default:t}}var ihe=/^\(?[+-]?(90(\.0+)?|[1-8]?\d(\.\d+)?)$/,rhe=/^\s?[+-]?(180(\.0+)?|1[0-7]\d(\.\d+)?|\d{1,2}(\.\d+)?)\)?$/,nhe=/^(([1-8]?\d)\D+([1-5]?\d|60)\D+([1-5]?\d|60)(\.\d+)?|90\D+0\D+0)\D+[NSns]?$/i,she=/^\s*([1-7]?\d{1,2}\D+([1-5]?\d|60)\D+([1-5]?\d|60)(\.\d+)?|180\D+0\D+0)\D+[EWew]?$/i,ohe={checkDMS:!1};function ahe(t,e){if((0,ehe.default)(t),e=(0,the.default)(e,ohe),!t.includes(","))return!1;var i=t.split(",");return i[0].startsWith("(")&&!i[1].endsWith(")")||i[1].endsWith(")")&&!i[0].startsWith("(")?!1:e.checkDMS?nhe.test(i[0])&&she.test(i[1]):ihe.test(i[0])&&rhe.test(i[1])}FE.exports=im.default;FE.exports.default=im.default});var zG=ae(rm=>{"use strict";Object.defineProperty(rm,"__esModule",{value:!0});rm.default=fhe;rm.locales=void 0;var lhe=hhe(Re());function hhe(t){return t&&t.__esModule?t:{default:t}}var uhe=/^\d{3}$/,zn=/^\d{4}$/,sn=/^\d{5}$/,BE=/^\d{6}$/,pc={AD:/^AD\d{3}$/,AT:zn,AU:zn,AZ:/^AZ\d{4}$/,BE:zn,BG:zn,BR:/^\d{5}-\d{3}$/,BY:/2[1-4]{1}\d{4}$/,CA:/^[ABCEGHJKLMNPRSTVXY]\d[ABCEGHJ-NPRSTV-Z][\s\-]?\d[ABCEGHJ-NPRSTV-Z]\d$/i,CH:zn,CN:/^(0[1-7]|1[012356]|2[0-7]|3[0-6]|4[0-7]|5[1-7]|6[1-7]|7[1-5]|8[1345]|9[09])\d{4}$/,CZ:/^\d{3}\s?\d{2}$/,DE:sn,DK:zn,DO:sn,DZ:sn,EE:sn,ES:/^(5[0-2]{1}|[0-4]{1}\d{1})\d{3}$/,FI:sn,FR:/^\d{2}\s?\d{3}$/,GB:/^(gir\s?0aa|[a-z]{1,2}\d[\da-z]?\s?(\d[a-z]{2})?)$/i,GR:/^\d{3}\s?\d{2}$/,HR:/^([1-5]\d{4}$)/,HT:/^HT\d{4}$/,HU:zn,ID:sn,IE:/^(?!.*(?:o))[A-Za-z]\d[\dw]\s\w{4}$/i,IL:/^(\d{5}|\d{7})$/,IN:/^((?!10|29|35|54|55|65|66|86|87|88|89)[1-9][0-9]{5})$/,IR:/\b(?!(\d)\1{3})[13-9]{4}[1346-9][013-9]{5}\b/,IS:uhe,IT:sn,JP:/^\d{3}\-\d{4}$/,KE:sn,KR:/^(\d{5}|\d{6})$/,LI:/^(948[5-9]|949[0-7])$/,LT:/^LT\-\d{5}$/,LU:zn,LV:/^LV\-\d{4}$/,LK:sn,MX:sn,MT:/^[A-Za-z]{3}\s{0,1}\d{4}$/,MY:sn,NL:/^\d{4}\s?[a-z]{2}$/i,NO:zn,NP:/^(10|21|22|32|33|34|44|45|56|57)\d{3}$|^(977)$/i,NZ:zn,PL:/^\d{2}\-\d{3}$/,PR:/^00[679]\d{2}([ -]\d{4})?$/,PT:/^\d{4}\-\d{3}?$/,RO:BE,RU:BE,SA:sn,SE:/^[1-9]\d{2}\s?\d{2}$/,SG:BE,SI:zn,SK:/^\d{3}\s?\d{2}$/,TH:sn,TN:zn,TW:/^\d{3}(\d{2})?$/,UA:sn,US:/^\d{5}(-\d{4})?$/,ZA:zn,ZM:sn},che=Object.keys(pc);rm.locales=che;function fhe(t,e){if((0,lhe.default)(t),e in pc)return pc[e].test(t);if(e==="any"){for(var i in pc)if(pc.hasOwnProperty(i)){var r=pc[i];if(r.test(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}});var UE=ae((nm,NE)=>{"use strict";Object.defineProperty(nm,"__esModule",{value:!0});nm.default=mhe;var dhe=phe(Re());function phe(t){return t&&t.__esModule?t:{default:t}}function mhe(t,e){(0,dhe.default)(t);var i=e?new RegExp("^[".concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]+"),"g"):/^\s+/g;return t.replace(i,"")}NE.exports=nm.default;NE.exports.default=nm.default});var zE=ae((sm,GE)=>{"use strict";Object.defineProperty(sm,"__esModule",{value:!0});sm.default=_he;var ghe=vhe(Re());function vhe(t){return t&&t.__esModule?t:{default:t}}function _he(t,e){if((0,ghe.default)(t),e){var i=new RegExp("[".concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]+$"),"g");return t.replace(i,"")}for(var r=t.length-1;/\s/.test(t.charAt(r));)r-=1;return t.slice(0,r+1)}GE.exports=sm.default;GE.exports.default=sm.default});var WG=ae((om,HE)=>{"use strict";Object.defineProperty(om,"__esModule",{value:!0});om.default=bhe;var yhe=HG(zE()),xhe=HG(UE());function HG(t){return t&&t.__esModule?t:{default:t}}function bhe(t,e){return(0,yhe.default)((0,xhe.default)(t,e),e)}HE.exports=om.default;HE.exports.default=om.default});var VG=ae((am,WE)=>{"use strict";Object.defineProperty(am,"__esModule",{value:!0});am.default=Che;var whe=She(Re());function She(t){return t&&t.__esModule?t:{default:t}}function Che(t){return(0,whe.default)(t),t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2F;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#96;")}WE.exports=am.default;WE.exports.default=am.default});var jG=ae((lm,VE)=>{"use strict";Object.defineProperty(lm,"__esModule",{value:!0});lm.default=The;var Mhe=Ehe(Re());function Ehe(t){return t&&t.__esModule?t:{default:t}}function The(t){return(0,Mhe.default)(t),t.replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#x2F;/g,"/").replace(/&#x5C;/g,"\\").replace(/&#96;/g,"`").replace(/&amp;/g,"&")}VE.exports=lm.default;VE.exports.default=lm.default});var qE=ae((hm,jE)=>{"use strict";Object.defineProperty(hm,"__esModule",{value:!0});hm.default=Rhe;var Ahe=Phe(Re());function Phe(t){return t&&t.__esModule?t:{default:t}}function Rhe(t,e){return(0,Ahe.default)(t),t.replace(new RegExp("[".concat(e,"]+"),"g"),"")}jE.exports=hm.default;jE.exports.default=hm.default});var XG=ae((um,XE)=>{"use strict";Object.defineProperty(um,"__esModule",{value:!0});um.default=Dhe;var Lhe=qG(Re()),Ohe=qG(qE());function qG(t){return t&&t.__esModule?t:{default:t}}function Dhe(t,e){(0,Lhe.default)(t);var i=e?"\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F":"\\x00-\\x1F\\x7F";return(0,Ohe.default)(t,i)}XE.exports=um.default;XE.exports.default=um.default});var YG=ae((cm,YE)=>{"use strict";Object.defineProperty(cm,"__esModule",{value:!0});cm.default=Fhe;var Ihe=khe(Re());function khe(t){return t&&t.__esModule?t:{default:t}}function Fhe(t,e){return(0,Ihe.default)(t),t.replace(new RegExp("[^".concat(e,"]+"),"g"),"")}YE.exports=cm.default;YE.exports.default=cm.default});var ZG=ae((fm,ZE)=>{"use strict";Object.defineProperty(fm,"__esModule",{value:!0});fm.default=Uhe;var Bhe=Nhe(Re());function Nhe(t){return t&&t.__esModule?t:{default:t}}function Uhe(t,e){(0,Bhe.default)(t);for(var i=t.length-1;i>=0;i--)if(e.indexOf(t[i])===-1)return!1;return!0}ZE.exports=fm.default;ZE.exports.default=fm.default});var KG=ae((dm,KE)=>{"use strict";Object.defineProperty(dm,"__esModule",{value:!0});dm.default=Yhe;var Ghe=zhe(wn());function zhe(t){return t&&t.__esModule?t:{default:t}}var Hhe={all_lowercase:!0,gmail_lowercase:!0,gmail_remove_dots:!0,gmail_remove_subaddress:!0,gmail_convert_googlemaildotcom:!0,outlookdotcom_lowercase:!0,outlookdotcom_remove_subaddress:!0,yahoo_lowercase:!0,yahoo_remove_subaddress:!0,yandex_lowercase:!0,icloud_lowercase:!0,icloud_remove_subaddress:!0},Whe=["icloud.com","me.com"],Vhe=["hotmail.at","hotmail.be","hotmail.ca","hotmail.cl","hotmail.co.il","hotmail.co.nz","hotmail.co.th","hotmail.co.uk","hotmail.com","hotmail.com.ar","hotmail.com.au","hotmail.com.br","hotmail.com.gr","hotmail.com.mx","hotmail.com.pe","hotmail.com.tr","hotmail.com.vn","hotmail.cz","hotmail.de","hotmail.dk","hotmail.es","hotmail.fr","hotmail.hu","hotmail.id","hotmail.ie","hotmail.in","hotmail.it","hotmail.jp","hotmail.kr","hotmail.lv","hotmail.my","hotmail.ph","hotmail.pt","hotmail.sa","hotmail.sg","hotmail.sk","live.be","live.co.uk","live.com","live.com.ar","live.com.mx","live.de","live.es","live.eu","live.fr","live.it","live.nl","msn.com","outlook.at","outlook.be","outlook.cl","outlook.co.il","outlook.co.nz","outlook.co.th","outlook.com","outlook.com.ar","outlook.com.au","outlook.com.br","outlook.com.gr","outlook.com.pe","outlook.com.tr","outlook.com.vn","outlook.cz","outlook.de","outlook.dk","outlook.es","outlook.fr","outlook.hu","outlook.id","outlook.ie","outlook.in","outlook.it","outlook.jp","outlook.kr","outlook.lv","outlook.my","outlook.ph","outlook.pt","outlook.sa","outlook.sg","outlook.sk","passport.com"],jhe=["rocketmail.com","yahoo.ca","yahoo.co.uk","yahoo.com","yahoo.de","yahoo.fr","yahoo.in","yahoo.it","ymail.com"],qhe=["yandex.ru","yandex.ua","yandex.kz","yandex.com","yandex.by","ya.ru"];function Xhe(t){return t.length>1?t:""}function Yhe(t,e){e=(0,Ghe.default)(e,Hhe);var i=t.split("@"),r=i.pop(),n=i.join("@"),o=[n,r];if(o[1]=o[1].toLowerCase(),o[1]==="gmail.com"||o[1]==="googlemail.com"){if(e.gmail_remove_subaddress&&(o[0]=o[0].split("+")[0]),e.gmail_remove_dots&&(o[0]=o[0].replace(/\.+/g,Xhe)),!o[0].length)return!1;(e.all_lowercase||e.gmail_lowercase)&&(o[0]=o[0].toLowerCase()),o[1]=e.gmail_convert_googlemaildotcom?"gmail.com":o[1]}else if(Whe.indexOf(o[1])>=0){if(e.icloud_remove_subaddress&&(o[0]=o[0].split("+")[0]),!o[0].length)return!1;(e.all_lowercase||e.icloud_lowercase)&&(o[0]=o[0].toLowerCase())}else if(Vhe.indexOf(o[1])>=0){if(e.outlookdotcom_remove_subaddress&&(o[0]=o[0].split("+")[0]),!o[0].length)return!1;(e.all_lowercase||e.outlookdotcom_lowercase)&&(o[0]=o[0].toLowerCase())}else if(jhe.indexOf(o[1])>=0){if(e.yahoo_remove_subaddress){var a=o[0].split("-");o[0]=a.length>1?a.slice(0,-1).join("-"):a[0]}if(!o[0].length)return!1;(e.all_lowercase||e.yahoo_lowercase)&&(o[0]=o[0].toLowerCase())}else qhe.indexOf(o[1])>=0?((e.all_lowercase||e.yandex_lowercase)&&(o[0]=o[0].toLowerCase()),o[1]="yandex.ru"):e.all_lowercase&&(o[0]=o[0].toLowerCase());return o.join("@")}KE.exports=dm.default;KE.exports.default=dm.default});var QG=ae((pm,QE)=>{"use strict";Object.defineProperty(pm,"__esModule",{value:!0});pm.default=Jhe;var Zhe=Khe(Re());function Khe(t){return t&&t.__esModule?t:{default:t}}var Qhe=/^[^\s-_](?!.*?[-_]{2,})[a-z0-9-\\][^\s]*[^-_\s]$/;function Jhe(t){return(0,Zhe.default)(t),Qhe.test(t)}QE.exports=pm.default;QE.exports.default=pm.default});var JG=ae((mm,JE)=>{"use strict";Object.defineProperty(mm,"__esModule",{value:!0});mm.default=tue;var $he=eue(Re());function eue(t){return t&&t.__esModule?t:{default:t}}var K_={"cs-CZ":function(e){return/^(([ABCDEFHKIJKLMNPRSTUVXYZ]|[0-9])-?){5,8}$/.test(e)},"de-DE":function(e){return/^((AW|UL|AK|GA|AÖ|LF|AZ|AM|AS|ZE|AN|AB|A|KG|KH|BA|EW|BZ|HY|KM|BT|HP|B|BC|BI|BO|FN|TT|ÜB|BN|AH|BS|FR|HB|ZZ|BB|BK|BÖ|OC|OK|CW|CE|C|CO|LH|CB|KW|LC|LN|DA|DI|DE|DH|SY|NÖ|DO|DD|DU|DN|D|EI|EA|EE|FI|EM|EL|EN|PF|ED|EF|ER|AU|ZP|E|ES|NT|EU|FL|FO|FT|FF|F|FS|FD|FÜ|GE|G|GI|GF|GS|ZR|GG|GP|GR|NY|ZI|GÖ|GZ|GT|HA|HH|HM|HU|WL|HZ|WR|RN|HK|HD|HN|HS|GK|HE|HF|RZ|HI|HG|HO|HX|IK|IL|IN|J|JL|KL|KA|KS|KF|KE|KI|KT|KO|KN|KR|KC|KU|K|LD|LL|LA|L|OP|LM|LI|LB|LU|LÖ|HL|LG|MD|GN|MZ|MA|ML|MR|MY|AT|DM|MC|NZ|RM|RG|MM|ME|MB|MI|FG|DL|HC|MW|RL|MK|MG|MÜ|WS|MH|M|MS|NU|NB|ND|NM|NK|NW|NR|NI|NF|DZ|EB|OZ|TG|TO|N|OA|GM|OB|CA|EH|FW|OF|OL|OE|OG|BH|LR|OS|AA|GD|OH|KY|NP|WK|PB|PA|PE|PI|PS|P|PM|PR|RA|RV|RE|R|H|SB|WN|RS|RD|RT|BM|NE|GV|RP|SU|GL|RO|GÜ|RH|EG|RW|PN|SK|MQ|RU|SZ|RI|SL|SM|SC|HR|FZ|VS|SW|SN|CR|SE|SI|SO|LP|SG|NH|SP|IZ|ST|BF|TE|HV|OD|SR|S|AC|DW|ZW|TF|TS|TR|TÜ|UM|PZ|TP|UE|UN|UH|MN|KK|VB|V|AE|PL|RC|VG|GW|PW|VR|VK|KB|WA|WT|BE|WM|WE|AP|MO|WW|FB|WZ|WI|WB|JE|WF|WO|W|WÜ|BL|Z|GC)[- ]?[A-Z]{1,2}[- ]?\d{1,4}|(AIC|FDB|ABG|SLN|SAW|KLZ|BUL|ESB|NAB|SUL|WST|ABI|AZE|BTF|KÖT|DKB|FEU|ROT|ALZ|SMÜ|WER|AUR|NOR|DÜW|BRK|HAB|TÖL|WOR|BAD|BAR|BER|BIW|EBS|KEM|MÜB|PEG|BGL|BGD|REI|WIL|BKS|BIR|WAT|BOR|BOH|BOT|BRB|BLK|HHM|NEB|NMB|WSF|LEO|HDL|WMS|WZL|BÜS|CHA|KÖZ|ROD|WÜM|CLP|NEC|COC|ZEL|COE|CUX|DAH|LDS|DEG|DEL|RSL|DLG|DGF|LAN|HEI|MED|DON|KIB|ROK|JÜL|MON|SLE|EBE|EIC|HIG|WBS|BIT|PRÜ|LIB|EMD|WIT|ERH|HÖS|ERZ|ANA|ASZ|MAB|MEK|STL|SZB|FDS|HCH|HOR|WOL|FRG|GRA|WOS|FRI|FFB|GAP|GER|BRL|CLZ|GTH|NOH|HGW|GRZ|LÖB|NOL|WSW|DUD|HMÜ|OHA|KRU|HAL|HAM|HBS|QLB|HVL|NAU|HAS|EBN|GEO|HOH|HDH|ERK|HER|WAN|HEF|ROF|HBN|ALF|HSK|USI|NAI|REH|SAN|KÜN|ÖHR|HOL|WAR|ARN|BRG|GNT|HOG|WOH|KEH|MAI|PAR|RID|ROL|KLE|GEL|KUS|KYF|ART|SDH|LDK|DIL|MAL|VIB|LER|BNA|GHA|GRM|MTL|WUR|LEV|LIF|STE|WEL|LIP|VAI|LUP|HGN|LBZ|LWL|PCH|STB|DAN|MKK|SLÜ|MSP|TBB|MGH|MTK|BIN|MSH|EIL|HET|SGH|BID|MYK|MSE|MST|MÜR|WRN|MEI|GRH|RIE|MZG|MIL|OBB|BED|FLÖ|MOL|FRW|SEE|SRB|AIB|MOS|BCH|ILL|SOB|NMS|NEA|SEF|UFF|NEW|VOH|NDH|TDO|NWM|GDB|GVM|WIS|NOM|EIN|GAN|LAU|HEB|OHV|OSL|SFB|ERB|LOS|BSK|KEL|BSB|MEL|WTL|OAL|FÜS|MOD|OHZ|OPR|BÜR|PAF|PLÖ|CAS|GLA|REG|VIT|ECK|SIM|GOA|EMS|DIZ|GOH|RÜD|SWA|NES|KÖN|MET|LRO|BÜZ|DBR|ROS|TET|HRO|ROW|BRV|HIP|PAN|GRI|SHK|EIS|SRO|SOK|LBS|SCZ|MER|QFT|SLF|SLS|HOM|SLK|ASL|BBG|SBK|SFT|SHG|MGN|MEG|ZIG|SAD|NEN|OVI|SHA|BLB|SIG|SON|SPN|FOR|GUB|SPB|IGB|WND|STD|STA|SDL|OBG|HST|BOG|SHL|PIR|FTL|SEB|SÖM|SÜW|TIR|SAB|TUT|ANG|SDT|LÜN|LSZ|MHL|VEC|VER|VIE|OVL|ANK|OVP|SBG|UEM|UER|WLG|GMN|NVP|RDG|RÜG|DAU|FKB|WAF|WAK|SLZ|WEN|SOG|APD|WUG|GUN|ESW|WIZ|WES|DIN|BRA|BÜD|WHV|HWI|GHC|WTM|WOB|WUN|MAK|SEL|OCH|HOT|WDA)[- ]?(([A-Z][- ]?\d{1,4})|([A-Z]{2}[- ]?\d{1,3})))[- ]?(E|H)?$/.test(e)},"de-LI":function(e){return/^FL[- ]?\d{1,5}[UZ]?$/.test(e)},"fi-FI":function(e){return/^(?=.{4,7})(([A-Z]{1,3}|[0-9]{1,3})[\s-]?([A-Z]{1,3}|[0-9]{1,5}))$/.test(e)},"pt-PT":function(e){return/^([A-Z]{2}|[0-9]{2})[ -·]?([A-Z]{2}|[0-9]{2})[ -·]?([A-Z]{2}|[0-9]{2})$/.test(e)},"sq-AL":function(e){return/^[A-Z]{2}[- ]?((\d{3}[- ]?(([A-Z]{2})|T))|(R[- ]?\d{3}))$/.test(e)},"pt-BR":function(e){return/^[A-Z]{3}[ -]?[0-9][A-Z][0-9]{2}|[A-Z]{3}[ -]?[0-9]{4}$/.test(e)}};function tue(t,e){if((0,$he.default)(t),e in K_)return K_[e](t);if(e==="any"){for(var i in K_){var r=K_[i];if(r(t))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}JE.exports=mm.default;JE.exports.default=mm.default});var ez=ae((gm,$E)=>{"use strict";Object.defineProperty(gm,"__esModule",{value:!0});gm.default=fue;var iue=$G(wn()),rue=$G(Re());function $G(t){return t&&t.__esModule?t:{default:t}}var nue=/^[A-Z]$/,sue=/^[a-z]$/,oue=/^[0-9]$/,aue=/^[-#!$@%^&*()_+|~=`{}\[\]:";'<>?,.\/ ]$/,lue={minLength:8,minLowercase:1,minUppercase:1,minNumbers:1,minSymbols:1,returnScore:!1,pointsPerUnique:1,pointsPerRepeat:.5,pointsForContainingLower:10,pointsForContainingUpper:10,pointsForContainingNumber:10,pointsForContainingSymbol:10};function hue(t){var e={};return Array.from(t).forEach(function(i){var r=e[i];r?e[i]+=1:e[i]=1}),e}function uue(t){var e=hue(t),i={length:t.length,uniqueChars:Object.keys(e).length,uppercaseCount:0,lowercaseCount:0,numberCount:0,symbolCount:0};return Object.keys(e).forEach(function(r){nue.test(r)?i.uppercaseCount+=e[r]:sue.test(r)?i.lowercaseCount+=e[r]:oue.test(r)?i.numberCount+=e[r]:aue.test(r)&&(i.symbolCount+=e[r])}),i}function cue(t,e){var i=0;return i+=t.uniqueChars*e.pointsPerUnique,i+=(t.length-t.uniqueChars)*e.pointsPerRepeat,t.lowercaseCount>0&&(i+=e.pointsForContainingLower),t.uppercaseCount>0&&(i+=e.pointsForContainingUpper),t.numberCount>0&&(i+=e.pointsForContainingNumber),t.symbolCount>0&&(i+=e.pointsForContainingSymbol),i}function fue(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;(0,rue.default)(t);var i=uue(t);return e=(0,iue.default)(e||{},lue),e.returnScore?cue(i,e):i.length>=e.minLength&&i.lowercaseCount>=e.minLowercase&&i.uppercaseCount>=e.minUppercase&&i.numberCount>=e.minNumbers&&i.symbolCount>=e.minSymbols}$E.exports=gm.default;$E.exports.default=gm.default});var iz=ae(vm=>{"use strict";Object.defineProperty(vm,"__esModule",{value:!0});vm.default=pue;vm.vatMatchers=void 0;var tz=due(Re());function due(t){return t&&t.__esModule?t:{default:t}}var eT={GB:/^GB((\d{3} \d{4} ([0-8][0-9]|9[0-6]))|(\d{9} \d{3})|(((GD[0-4])|(HA[5-9]))[0-9]{2}))$/,IT:/^(IT)?[0-9]{11}$/,NL:/^(NL)?[0-9]{9}B[0-9]{2}$/};vm.vatMatchers=eT;function pue(t,e){if((0,tz.default)(t),(0,tz.default)(e),e in eT)return eT[e].test(t);throw new Error("Invalid country code: '".concat(e,"'"))}});var uz=ae((gc,tT)=>{"use strict";function Q_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Q_=function(i){return typeof i}:Q_=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Q_(t)}Object.defineProperty(gc,"__esModule",{value:!0});gc.default=void 0;var mue=Le(O_()),gue=Le(tM()),vue=Le(FU()),_ue=Le(BU()),yue=Le(NU()),xue=Le(GU()),bue=Le(zU()),wue=Le(jU()),Sue=Le(ZU()),Cue=Le(KU()),Mue=Le(Gd()),Eue=Le(t4()),Tue=Le(z_()),Aue=Le(wM()),Pue=Le(a4()),Rue=Le(l4()),rz=mc(h4()),nz=mc(u4()),Lue=Le(c4()),Oue=Le(d4()),Due=Le(p4()),Iue=Le(m4()),kue=Le(g4()),Fue=Le(v4()),Bue=Le(_4()),Nue=Le(kM()),Uue=Le(FM()),Gue=Le(b4()),zue=Le(w4()),Hue=Le(M4()),Wue=Le(E4()),Vue=Le(W_()),sz=mc($C()),jue=Le(P4()),que=Le(qM()),Xue=Le(R4()),Yue=Le(O4()),Zue=Le(D4()),Kue=Le(F4()),Que=Le(B4()),Jue=Le(N4()),oz=mc(U4()),$ue=Le(z4()),ece=Le(H4()),tce=Le(W4()),ice=Le(q4()),rce=Le(Y4()),nce=Le(K4()),sce=Le(Q4()),oce=Le(fM()),ace=Le(J4()),lce=Le(eG()),hce=Le(rG()),uce=Le(oG()),cce=Le(lG()),fce=Le(hG()),dce=Le(cG()),pce=Le(fG()),mce=Le(dG()),gce=Le(pG()),vce=Le(mG()),_ce=Le(bG()),az=mc(wG()),yce=Le(SG()),xce=Le(MG()),bce=Le(EG()),wce=Le(TG()),Sce=Le(RG()),Cce=Le(eE()),Mce=Le(LG()),Ece=Le(DG()),Tce=Le(IG()),Ace=Le(kG()),Pce=Le(sE()),Rce=Le(FG()),Lce=Le(BG()),Oce=Le(NG()),Dce=Le(GG()),lz=mc(zG()),Ice=Le(UE()),kce=Le(zE()),Fce=Le(WG()),Bce=Le(VG()),Nce=Le(jG()),Uce=Le(XG()),Gce=Le(YG()),zce=Le(qE()),Hce=Le(ZG()),Wce=Le(KG()),Vce=Le(QG()),jce=Le(JG()),qce=Le(ez()),Xce=Le(iz());function hz(){if(typeof WeakMap!="function")return null;var t=new WeakMap;return hz=function(){return t},t}function mc(t){if(t&&t.__esModule)return t;if(t===null||Q_(t)!=="object"&&typeof t!="function")return{default:t};var e=hz();if(e&&e.has(t))return e.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=r?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}return i.default=t,e&&e.set(t,i),i}function Le(t){return t&&t.__esModule?t:{default:t}}var Yce="13.7.0",Zce={version:Yce,toDate:mue.default,toFloat:gue.default,toInt:vue.default,toBoolean:_ue.default,equals:yue.default,contains:xue.default,matches:bue.default,isEmail:wue.default,isURL:Sue.default,isMACAddress:Cue.default,isIP:Mue.default,isIPRange:Eue.default,isFQDN:Tue.default,isBoolean:Pue.default,isIBAN:oz.default,isBIC:$ue.default,isAlpha:rz.default,isAlphaLocales:rz.locales,isAlphanumeric:nz.default,isAlphanumericLocales:nz.locales,isNumeric:Lue.default,isPassportNumber:Oue.default,isPort:Due.default,isLowercase:Iue.default,isUppercase:kue.default,isAscii:Bue.default,isFullWidth:Nue.default,isHalfWidth:Uue.default,isVariableWidth:Gue.default,isMultibyte:zue.default,isSemVer:Hue.default,isSurrogatePair:Wue.default,isInt:Vue.default,isIMEI:Fue.default,isFloat:sz.default,isFloatLocales:sz.locales,isDecimal:jue.default,isHexadecimal:que.default,isOctal:Xue.default,isDivisibleBy:Yue.default,isHexColor:Zue.default,isRgbColor:Kue.default,isHSL:Que.default,isISRC:Jue.default,isMD5:ece.default,isHash:tce.default,isJWT:ice.default,isJSON:rce.default,isEmpty:nce.default,isLength:sce.default,isLocale:Rue.default,isByteLength:oce.default,isUUID:ace.default,isMongoId:lce.default,isAfter:hce.default,isBefore:uce.default,isIn:cce.default,isCreditCard:fce.default,isIdentityCard:dce.default,isEAN:pce.default,isISIN:mce.default,isISBN:gce.default,isISSN:vce.default,isMobilePhone:az.default,isMobilePhoneLocales:az.locales,isPostalCode:lz.default,isPostalCodeLocales:lz.locales,isEthereumAddress:yce.default,isCurrency:xce.default,isBtcAddress:bce.default,isISO8601:wce.default,isRFC3339:Sce.default,isISO31661Alpha2:Cce.default,isISO31661Alpha3:Mce.default,isISO4217:Ece.default,isBase32:Tce.default,isBase58:Ace.default,isBase64:Pce.default,isDataURI:Rce.default,isMagnetURI:Lce.default,isMimeType:Oce.default,isLatLong:Dce.default,ltrim:Ice.default,rtrim:kce.default,trim:Fce.default,escape:Bce.default,unescape:Nce.default,stripLow:Uce.default,whitelist:Gce.default,blacklist:zce.default,isWhitelisted:Hce.default,normalizeEmail:Wce.default,toString,isSlug:Vce.default,isStrongPassword:qce.default,isTaxID:_ce.default,isDate:Aue.default,isLicensePlate:jce.default,isVAT:Xce.default,ibanLocales:oz.locales},Kce=Zce;gc.default=Kce;tT.exports=gc.default;tT.exports.default=gc.default});var bc="139",Lo={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Oo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},dT=0,xy=1,pT=2;var ym=1,xm=2,_l=3,Ei=0,Gi=1,qt=2,mT=1;var Vn=0,Do=1,by=2,wy=3,Sy=4,gT=5,ga=100,vT=101,_T=102,Cy=103,My=104,yT=200,xT=201,bT=202,wT=203,bm=204,wm=205,ST=206,CT=207,MT=208,ET=209,TT=210,AT=0,$s=1,PT=2,wc=3,RT=4,LT=5,OT=6,DT=7,va=0,IT=1,kT=2,ln=0,FT=1,BT=2,NT=3,UT=4,GT=5,Ey=300,bs=301,eo=302,Sc=303,Cc=304,_a=306,Mc=1e3,Wr=1001,Ec=1002,Ji=1003,Ty=1004;var Ay=1005;var $i=1006,zT=1007;var ya=1008,HT=1008,jn=1009,WT=1010,VT=1011,Io=1012,jT=1013,yh=1014,ws=1015,to=1016,qT=1017,XT=1018,io=1020,YT=1021,ZT=1022,or=1023,KT=1024,QT=1025,Ss=1026,ro=1027,JT=1028,$T=1029,eA=1030,tA=1031,iA=1033,Sm=33776,Cm=33777,Mm=33778,Em=33779,Py=35840,Ry=35841,Ly=35842,Oy=35843,rA=36196,Dy=37492,Iy=37496,ky=37808,Fy=37809,By=37810,Ny=37811,Uy=37812,Gy=37813,zy=37814,Hy=37815,Wy=37816,Vy=37817,jy=37818,qy=37819,Xy=37820,Yy=37821,Zy=36492;var Vr=3e3,Qt=3001,nA=3200,sA=3201,xh=0,oA=1;var Cs="srgb",ko="srgb-linear";var Tm=7680;var aA=519,Ky=35044;var Qy="300 es",Tc=1035;var Er=class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});let r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;let r=this._listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;let n=this._listeners[e];if(n!==void 0){let o=n.indexOf(i);o!==-1&&n.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let r=this._listeners[e.type];if(r!==void 0){e.target=this;let n=r.slice(0);for(let o=0,a=n.length;o<a;o++)n[o].call(this,e);e.target=null}}};var _r=[];for(let t=0;t<256;t++)_r[t]=(t<16?"0":"")+t.toString(16);var Am=Math.PI/180,Jy=180/Math.PI;function no(){let t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(_r[t&255]+_r[t>>8&255]+_r[t>>16&255]+_r[t>>24&255]+"-"+_r[e&255]+_r[e>>8&255]+"-"+_r[e>>16&15|64]+_r[e>>24&255]+"-"+_r[i&63|128]+_r[i>>8&255]+"-"+_r[i>>16&255]+_r[i>>24&255]+_r[r&255]+_r[r>>8&255]+_r[r>>16&255]+_r[r>>24&255]).toLowerCase()}function er(t,e,i){return Math.max(e,Math.min(i,t))}function lA(t,e){return(t%e+e)%e}function Pm(t,e,i){return(1-i)*t+i*e}function $y(t){return(t&t-1)===0&&t!==0}function Ac(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var ot=class{constructor(e=0,i=0){this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,i){return i!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,i)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e,i){return i!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,i)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let i=this.x,r=this.y,n=e.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){let r=Math.cos(i),n=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*r-a*n+e.x,this.y=o*n+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};ot.prototype.isVector2=!0;var zi=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,i,r,n,o,a,l,h,u){let c=this.elements;return c[0]=e,c[1]=n,c[2]=l,c[3]=i,c[4]=o,c[5]=h,c[6]=r,c[7]=a,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let r=e.elements,n=i.elements,o=this.elements,a=r[0],l=r[3],h=r[6],u=r[1],c=r[4],f=r[7],d=r[2],m=r[5],v=r[8],g=n[0],p=n[3],_=n[6],x=n[1],b=n[4],y=n[7],w=n[2],S=n[5],R=n[8];return o[0]=a*g+l*x+h*w,o[3]=a*p+l*b+h*S,o[6]=a*_+l*y+h*R,o[1]=u*g+c*x+f*w,o[4]=u*p+c*b+f*S,o[7]=u*_+c*y+f*R,o[2]=d*g+m*x+v*w,o[5]=d*p+m*b+v*S,o[8]=d*_+m*y+v*R,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){let e=this.elements,i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8];return i*a*c-i*l*u-r*o*c+r*l*h+n*o*u-n*a*h}invert(){let e=this.elements,i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],f=c*a-l*u,d=l*h-c*o,m=u*o-a*h,v=i*f+r*d+n*m;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/v;return e[0]=f*g,e[1]=(n*u-c*r)*g,e[2]=(l*r-n*a)*g,e[3]=d*g,e[4]=(c*i-n*h)*g,e[5]=(n*o-l*i)*g,e[6]=m*g,e[7]=(r*h-u*i)*g,e[8]=(a*i-r*o)*g,this}transpose(){let e,i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,n,o,a,l){let h=Math.cos(o),u=Math.sin(o);return this.set(r*h,r*u,-r*(h*a+u*l)+a+e,-n*u,n*h,-n*(-u*a+h*l)+l+i,0,0,1),this}scale(e,i){let r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=i,r[4]*=i,r[7]*=i,this}rotate(e){let i=Math.cos(e),r=Math.sin(e),n=this.elements,o=n[0],a=n[3],l=n[6],h=n[1],u=n[4],c=n[7];return n[0]=i*o+r*h,n[3]=i*a+r*u,n[6]=i*l+r*c,n[1]=-r*o+i*h,n[4]=-r*a+i*u,n[7]=-r*l+i*c,this}translate(e,i){let r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=i*r[2],r[4]+=i*r[5],r[7]+=i*r[8],this}equals(e){let i=this.elements,r=e.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){let r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}};zi.prototype.isMatrix3=!0;function Rm(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}function Pc(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Fo(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Rc(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}var ex={[Cs]:{[ko]:Fo},[ko]:{[Cs]:Rc}},qn={legacyMode:!0,get workingColorSpace(){return ko},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(ex[e]&&ex[e][i]!==void 0){let r=ex[e][i];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}};var hA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},tr={r:0,g:0,b:0},Ms={h:0,s:0,l:0},Lm={h:0,s:0,l:0};function tx(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function Om(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var $e=class{constructor(e,i,r){return i===void 0&&r===void 0?this.set(e):this.setRGB(e,i,r)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Cs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,qn.toWorkingColorSpace(this,i),this}setRGB(e,i,r,n=ko){return this.r=e,this.g=i,this.b=r,qn.toWorkingColorSpace(this,n),this}setHSL(e,i,r,n=ko){if(e=lA(e,1),i=er(i,0,1),r=er(r,0,1),i===0)this.r=this.g=this.b=r;else{let o=r<=.5?r*(1+i):r+i-r*i,a=2*r-o;this.r=tx(a,o,e+1/3),this.g=tx(a,o,e),this.b=tx(a,o,e-1/3)}return qn.toWorkingColorSpace(this,n),this}setStyle(e,i=Cs){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o,a=n[1],l=n[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,qn.toWorkingColorSpace(this,i),r(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,qn.toWorkingColorSpace(this,i),r(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){let h=parseFloat(o[1])/360,u=parseInt(o[2],10)/100,c=parseInt(o[3],10)/100;return r(o[4]),this.setHSL(h,u,c,i)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let o=n[1],a=o.length;if(a===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,qn.toWorkingColorSpace(this,i),this;if(a===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,qn.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i=Cs){let r=hA[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Fo(e.r),this.g=Fo(e.g),this.b=Fo(e.b),this}copyLinearToSRGB(e){return this.r=Rc(e.r),this.g=Rc(e.g),this.b=Rc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Cs){return qn.fromWorkingColorSpace(Om(this,tr),e),er(tr.r*255,0,255)<<16^er(tr.g*255,0,255)<<8^er(tr.b*255,0,255)<<0}getHexString(e=Cs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=ko){qn.fromWorkingColorSpace(Om(this,tr),i);let r=tr.r,n=tr.g,o=tr.b,a=Math.max(r,n,o),l=Math.min(r,n,o),h,u,c=(l+a)/2;if(l===a)h=0,u=0;else{let f=a-l;switch(u=c<=.5?f/(a+l):f/(2-a-l),a){case r:h=(n-o)/f+(n<o?6:0);break;case n:h=(o-r)/f+2;break;case o:h=(r-n)/f+4;break}h/=6}return e.h=h,e.s=u,e.l=c,e}getRGB(e,i=ko){return qn.fromWorkingColorSpace(Om(this,tr),i),e.r=tr.r,e.g=tr.g,e.b=tr.b,e}getStyle(e=Cs){return qn.fromWorkingColorSpace(Om(this,tr),e),e!==Cs?`color(${e} ${tr.r} ${tr.g} ${tr.b})`:`rgb(${tr.r*255|0},${tr.g*255|0},${tr.b*255|0})`}offsetHSL(e,i,r){return this.getHSL(Ms),Ms.h+=e,Ms.s+=i,Ms.l+=r,this.setHSL(Ms.h,Ms.s,Ms.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(Ms),e.getHSL(Lm);let r=Pm(Ms.h,Lm.h,i),n=Pm(Ms.s,Lm.s,i),o=Pm(Ms.l,Lm.l,i);return this.setHSL(r,n,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};$e.NAMES=hA;$e.prototype.isColor=!0;$e.prototype.r=1;$e.prototype.g=1;$e.prototype.b=1;var bh,wh=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{bh===void 0&&(bh=Pc("canvas")),bh.width=e.width,bh.height=e.height;let r=bh.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=bh}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){let i=Pc("canvas");i.width=e.width,i.height=e.height;let r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);let n=r.getImageData(0,0,e.width,e.height),o=n.data;for(let a=0;a<o.length;a++)o[a]=Fo(o[a]/255)*255;return r.putImageData(n,0,0),i}else if(e.data){let i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(Fo(i[r]/255)*255):i[r]=Fo(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}};var Lc=class{constructor(e=null){this.uuid=no(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let o;if(Array.isArray(n)){o=[];for(let a=0,l=n.length;a<l;a++)n[a].isDataTexture?o.push(ix(n[a].image)):o.push(ix(n[a]))}else o=ix(n);r.url=o}return i||(e.images[this.uuid]=r),r}};function ix(t){return typeof HTMLImageElement!="undefined"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap?wh.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Lc.prototype.isSource=!0;var Sz=0,vi=class extends Er{constructor(e=vi.DEFAULT_IMAGE,i=vi.DEFAULT_MAPPING,r=Wr,n=Wr,o=$i,a=ya,l=or,h=jn,u=1,c=Vr){super(),Object.defineProperty(this,"id",{value:Sz++}),this.uuid=no(),this.name="",this.source=new Lc(e),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=n,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=h,this.offset=new ot(0,0),this.repeat=new ot(1,1),this.center=new ot(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Ey)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Mc:e.x=e.x-Math.floor(e.x);break;case Wr:e.x=e.x<0?0:1;break;case Ec:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Mc:e.y=e.y-Math.floor(e.y);break;case Wr:e.y=e.y<0?0:1;break;case Ec:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};vi.DEFAULT_IMAGE=null;vi.DEFAULT_MAPPING=Ey;vi.prototype.isTexture=!0;var jt=class{constructor(e=0,i=0,r=0,n=1){this.x=e,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,n){return this.x=e,this.y=i,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,i){return i!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,i)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e,i){return i!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,i)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let i=this.x,r=this.y,n=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*o,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*o,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*o,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,n,o,h=e.elements,u=h[0],c=h[4],f=h[8],d=h[1],m=h[5],v=h[9],g=h[2],p=h[6],_=h[10];if(Math.abs(c-d)<.01&&Math.abs(f-g)<.01&&Math.abs(v-p)<.01){if(Math.abs(c+d)<.1&&Math.abs(f+g)<.1&&Math.abs(v+p)<.1&&Math.abs(u+m+_-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;let b=(u+1)/2,y=(m+1)/2,w=(_+1)/2,S=(c+d)/4,R=(f+g)/4,E=(v+p)/4;return b>y&&b>w?b<.01?(r=0,n=.707106781,o=.707106781):(r=Math.sqrt(b),n=S/r,o=R/r):y>w?y<.01?(r=.707106781,n=0,o=.707106781):(n=Math.sqrt(y),r=S/n,o=E/n):w<.01?(r=.707106781,n=.707106781,o=0):(o=Math.sqrt(w),r=R/o,n=E/o),this.set(r,n,o,i),this}let x=Math.sqrt((p-v)*(p-v)+(f-g)*(f-g)+(d-c)*(d-c));return Math.abs(x)<.001&&(x=1),this.x=(p-v)/x,this.y=(f-g)/x,this.z=(d-c)/x,this.w=Math.acos((u+m+_-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};jt.prototype.isVector4=!0;var Tr=class extends Er{constructor(e,i,r={}){super(),this.width=e,this.height=i,this.depth=1,this.scissor=new jt(0,0,e,i),this.scissorTest=!1,this.viewport=new jt(0,0,e,i);let n={width:e,height:i,depth:1};this.texture=new vi(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:$i,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(e,i,r=1){(this.width!==e||this.height!==i||this.depth!==r)&&(this.width=e,this.height=i,this.depth=r,this.texture.image.width=e,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}};Tr.prototype.isWebGLRenderTarget=!0;var yl=class extends vi{constructor(e=null,i=1,r=1,n=1){super(null),this.image={data:e,width:i,height:r,depth:n},this.magFilter=Ji,this.minFilter=Ji,this.wrapR=Wr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};yl.prototype.isDataArrayTexture=!0;var Oc=class extends vi{constructor(e=null,i=1,r=1,n=1){super(null),this.image={data:e,width:i,height:r,depth:n},this.magFilter=Ji,this.minFilter=Ji,this.wrapR=Wr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};Oc.prototype.isData3DTexture=!0;var Ar=class{constructor(e=0,i=0,r=0,n=1){this._x=e,this._y=i,this._z=r,this._w=n}static slerp(e,i,r,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,i,n)}static slerpFlat(e,i,r,n,o,a,l){let h=r[n+0],u=r[n+1],c=r[n+2],f=r[n+3],d=o[a+0],m=o[a+1],v=o[a+2],g=o[a+3];if(l===0){e[i+0]=h,e[i+1]=u,e[i+2]=c,e[i+3]=f;return}if(l===1){e[i+0]=d,e[i+1]=m,e[i+2]=v,e[i+3]=g;return}if(f!==g||h!==d||u!==m||c!==v){let p=1-l,_=h*d+u*m+c*v+f*g,x=_>=0?1:-1,b=1-_*_;if(b>Number.EPSILON){let w=Math.sqrt(b),S=Math.atan2(w,_*x);p=Math.sin(p*S)/w,l=Math.sin(l*S)/w}let y=l*x;if(h=h*p+d*y,u=u*p+m*y,c=c*p+v*y,f=f*p+g*y,p===1-l){let w=1/Math.sqrt(h*h+u*u+c*c+f*f);h*=w,u*=w,c*=w,f*=w}}e[i]=h,e[i+1]=u,e[i+2]=c,e[i+3]=f}static multiplyQuaternionsFlat(e,i,r,n,o,a){let l=r[n],h=r[n+1],u=r[n+2],c=r[n+3],f=o[a],d=o[a+1],m=o[a+2],v=o[a+3];return e[i]=l*v+c*f+h*m-u*d,e[i+1]=h*v+c*d+u*f-l*m,e[i+2]=u*v+c*m+l*d-h*f,e[i+3]=c*v-l*f-h*d-u*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,n){return this._x=e,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let r=e._x,n=e._y,o=e._z,a=e._order,l=Math.cos,h=Math.sin,u=l(r/2),c=l(n/2),f=l(o/2),d=h(r/2),m=h(n/2),v=h(o/2);switch(a){case"XYZ":this._x=d*c*f+u*m*v,this._y=u*m*f-d*c*v,this._z=u*c*v+d*m*f,this._w=u*c*f-d*m*v;break;case"YXZ":this._x=d*c*f+u*m*v,this._y=u*m*f-d*c*v,this._z=u*c*v-d*m*f,this._w=u*c*f+d*m*v;break;case"ZXY":this._x=d*c*f-u*m*v,this._y=u*m*f+d*c*v,this._z=u*c*v+d*m*f,this._w=u*c*f-d*m*v;break;case"ZYX":this._x=d*c*f-u*m*v,this._y=u*m*f+d*c*v,this._z=u*c*v-d*m*f,this._w=u*c*f+d*m*v;break;case"YZX":this._x=d*c*f+u*m*v,this._y=u*m*f+d*c*v,this._z=u*c*v-d*m*f,this._w=u*c*f-d*m*v;break;case"XZY":this._x=d*c*f-u*m*v,this._y=u*m*f-d*c*v,this._z=u*c*v+d*m*f,this._w=u*c*f+d*m*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,i){let r=i/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){let i=e.elements,r=i[0],n=i[4],o=i[8],a=i[1],l=i[5],h=i[9],u=i[2],c=i[6],f=i[10],d=r+l+f;if(d>0){let m=.5/Math.sqrt(d+1);this._w=.25/m,this._x=(c-h)*m,this._y=(o-u)*m,this._z=(a-n)*m}else if(r>l&&r>f){let m=2*Math.sqrt(1+r-l-f);this._w=(c-h)/m,this._x=.25*m,this._y=(n+a)/m,this._z=(o+u)/m}else if(l>f){let m=2*Math.sqrt(1+l-r-f);this._w=(o-u)/m,this._x=(n+a)/m,this._y=.25*m,this._z=(h+c)/m}else{let m=2*Math.sqrt(1+f-r-l);this._w=(a-n)/m,this._x=(o+u)/m,this._y=(h+c)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(er(this.dot(e),-1,1)))}rotateTowards(e,i){let r=this.angleTo(e);if(r===0)return this;let n=Math.min(1,i/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,i){return i!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,i)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){let r=e._x,n=e._y,o=e._z,a=e._w,l=i._x,h=i._y,u=i._z,c=i._w;return this._x=r*c+a*l+n*u-o*h,this._y=n*c+a*h+o*l-r*u,this._z=o*c+a*u+r*h-n*l,this._w=a*c-r*l-n*h-o*u,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);let r=this._x,n=this._y,o=this._z,a=this._w,l=a*e._w+r*e._x+n*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=r,this._y=n,this._z=o,this;let h=1-l*l;if(h<=Number.EPSILON){let m=1-i;return this._w=m*a+i*this._w,this._x=m*r+i*this._x,this._y=m*n+i*this._y,this._z=m*o+i*this._z,this.normalize(),this._onChangeCallback(),this}let u=Math.sqrt(h),c=Math.atan2(u,l),f=Math.sin((1-i)*c)/u,d=Math.sin(i*c)/u;return this._w=a*f+this._w*d,this._x=r*f+this._x*d,this._y=n*f+this._y*d,this._z=o*f+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){let e=Math.random(),i=Math.sqrt(1-e),r=Math.sqrt(e),n=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(i*Math.cos(n),r*Math.sin(o),r*Math.cos(o),i*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};Ar.prototype.isQuaternion=!0;var q=class{constructor(e=0,i=0,r=0){this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,i){return i!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,i)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e,i){return i!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,i)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e,i){return i!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,i)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(uA.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(uA.setFromAxisAngle(e,i))}applyMatrix3(e){let i=this.x,r=this.y,n=this.z,o=e.elements;return this.x=o[0]*i+o[3]*r+o[6]*n,this.y=o[1]*i+o[4]*r+o[7]*n,this.z=o[2]*i+o[5]*r+o[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let i=this.x,r=this.y,n=this.z,o=e.elements,a=1/(o[3]*i+o[7]*r+o[11]*n+o[15]);return this.x=(o[0]*i+o[4]*r+o[8]*n+o[12])*a,this.y=(o[1]*i+o[5]*r+o[9]*n+o[13])*a,this.z=(o[2]*i+o[6]*r+o[10]*n+o[14])*a,this}applyQuaternion(e){let i=this.x,r=this.y,n=this.z,o=e.x,a=e.y,l=e.z,h=e.w,u=h*i+a*n-l*r,c=h*r+l*i-o*n,f=h*n+o*r-a*i,d=-o*i-a*r-l*n;return this.x=u*h+d*-o+c*-l-f*-a,this.y=c*h+d*-a+f*-o-u*-l,this.z=f*h+d*-l+u*-a-c*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let i=this.x,r=this.y,n=this.z,o=e.elements;return this.x=o[0]*i+o[4]*r+o[8]*n,this.y=o[1]*i+o[5]*r+o[9]*n,this.z=o[2]*i+o[6]*r+o[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e,i){return i!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,i)):this.crossVectors(this,e)}crossVectors(e,i){let r=e.x,n=e.y,o=e.z,a=i.x,l=i.y,h=i.z;return this.x=n*h-o*l,this.y=o*a-r*h,this.z=r*l-n*a,this}projectOnVector(e){let i=e.lengthSq();if(i===0)return this.set(0,0,0);let r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return rx.copy(this).projectOnVector(e),this.sub(rx)}reflect(e){return this.sub(rx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;let r=this.dot(e)/i;return Math.acos(er(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let i=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return i*i+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){let n=Math.sin(i)*e;return this.x=n*Math.sin(r),this.y=Math.cos(i)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){let i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){let i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};q.prototype.isVector3=!0;var rx=new q,uA=new Ar;var Li=class{constructor(e=new q(1/0,1/0,1/0),i=new q(-1/0,-1/0,-1/0)){this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){let i=1/0,r=1/0,n=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=0,u=e.length;h<u;h+=3){let c=e[h],f=e[h+1],d=e[h+2];c<i&&(i=c),f<r&&(r=f),d<n&&(n=d),c>o&&(o=c),f>a&&(a=f),d>l&&(l=d)}return this.min.set(i,r,n),this.max.set(o,a,l),this}setFromBufferAttribute(e){let i=1/0,r=1/0,n=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=0,u=e.count;h<u;h++){let c=e.getX(h),f=e.getY(h),d=e.getZ(h);c<i&&(i=c),f<r&&(r=f),d<n&&(n=d),c>o&&(o=c),f>a&&(a=f),d>l&&(l=d)}return this.min.set(i,r,n),this.max.set(o,a,l),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){let r=xl.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);let r=e.geometry;if(r!==void 0)if(i&&r.attributes!=null&&r.attributes.position!==void 0){let o=r.attributes.position;for(let a=0,l=o.count;a<l;a++)xl.fromBufferAttribute(o,a).applyMatrix4(e.matrixWorld),this.expandByPoint(xl)}else r.boundingBox===null&&r.computeBoundingBox(),nx.copy(r.boundingBox),nx.applyMatrix4(e.matrixWorld),this.union(nx);let n=e.children;for(let o=0,a=n.length;o<a;o++)this.expandByObject(n[o],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,xl),xl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Dc),Dm.subVectors(this.max,Dc),Sh.subVectors(e.a,Dc),Ch.subVectors(e.b,Dc),Mh.subVectors(e.c,Dc),xa.subVectors(Ch,Sh),ba.subVectors(Mh,Ch),bl.subVectors(Sh,Mh);let i=[0,-xa.z,xa.y,0,-ba.z,ba.y,0,-bl.z,bl.y,xa.z,0,-xa.x,ba.z,0,-ba.x,bl.z,0,-bl.x,-xa.y,xa.x,0,-ba.y,ba.x,0,-bl.y,bl.x,0];return!sx(i,Sh,Ch,Mh,Dm)||(i=[1,0,0,0,1,0,0,0,1],!sx(i,Sh,Ch,Mh,Dm))?!1:(Im.crossVectors(xa,ba),i=[Im.x,Im.y,Im.z],sx(i,Sh,Ch,Mh,Dm))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return xl.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(xl).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Bo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Bo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Bo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Bo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Bo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Bo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Bo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Bo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Bo),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Li.prototype.isBox3=!0;var Bo=[new q,new q,new q,new q,new q,new q,new q,new q],xl=new q,nx=new Li,Sh=new q,Ch=new q,Mh=new q,xa=new q,ba=new q,bl=new q,Dc=new q,Dm=new q,Im=new q,wl=new q;function sx(t,e,i,r,n){for(let o=0,a=t.length-3;o<=a;o+=3){wl.fromArray(t,o);let l=n.x*Math.abs(wl.x)+n.y*Math.abs(wl.y)+n.z*Math.abs(wl.z),h=e.dot(wl),u=i.dot(wl),c=r.dot(wl);if(Math.max(-Math.max(h,u,c),Math.min(h,u,c))>l)return!1}return!0}var Cz=new Li,cA=new q,km=new q,ox=new q,hn=class{constructor(e=new q,i=-1){this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){let r=this.center;i!==void 0?r.copy(i):Cz.setFromPoints(e).getCenter(r);let n=0;for(let o=0,a=e.length;o<a;o++)n=Math.max(n,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){let r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){ox.subVectors(e,this.center);let i=ox.lengthSq();if(i>this.radius*this.radius){let r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.add(ox.multiplyScalar(n/r)),this.radius+=n}return this}union(e){return this.center.equals(e.center)===!0?km.set(0,0,1).multiplyScalar(e.radius):km.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(cA.copy(e.center).add(km)),this.expandByPoint(cA.copy(e.center).sub(km)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};var ax=new q,Mz=new q,Ez=new zi,Xn=class{constructor(e=new q(1,0,0),i=0){this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,n){return this.normal.set(e,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){let n=ax.subVectors(r,i).cross(Mz.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,i){let r=e.delta(ax),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;let o=-(e.start.dot(this.normal)+this.constant)/n;return o<0||o>1?null:i.copy(r).multiplyScalar(o).add(e.start)}intersectsLine(e){let i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){let r=i||Ez.getNormalMatrix(e),n=this.coplanarPoint(ax).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};Xn.prototype.isPlane=!0;var Eh=new hn,Fm=new q,wa=class{constructor(e=new Xn,i=new Xn,r=new Xn,n=new Xn,o=new Xn,a=new Xn){this.planes=[e,i,r,n,o,a]}set(e,i,r,n,o,a){let l=this.planes;return l[0].copy(e),l[1].copy(i),l[2].copy(r),l[3].copy(n),l[4].copy(o),l[5].copy(a),this}copy(e){let i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){let i=this.planes,r=e.elements,n=r[0],o=r[1],a=r[2],l=r[3],h=r[4],u=r[5],c=r[6],f=r[7],d=r[8],m=r[9],v=r[10],g=r[11],p=r[12],_=r[13],x=r[14],b=r[15];return i[0].setComponents(l-n,f-h,g-d,b-p).normalize(),i[1].setComponents(l+n,f+h,g+d,b+p).normalize(),i[2].setComponents(l+o,f+u,g+m,b+_).normalize(),i[3].setComponents(l-o,f-u,g-m,b-_).normalize(),i[4].setComponents(l-a,f-c,g-v,b-x).normalize(),i[5].setComponents(l+a,f+c,g+v,b+x).normalize(),this}intersectsObject(e){let i=e.geometry;return i.boundingSphere===null&&i.computeBoundingSphere(),Eh.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Eh)}intersectsSprite(e){return Eh.center.set(0,0,0),Eh.radius=.7071067811865476,Eh.applyMatrix4(e.matrixWorld),this.intersectsSphere(Eh)}intersectsSphere(e){let i=this.planes,r=e.center,n=-e.radius;for(let o=0;o<6;o++)if(i[o].distanceToPoint(r)<n)return!1;return!0}intersectsBox(e){let i=this.planes;for(let r=0;r<6;r++){let n=i[r];if(Fm.x=n.normal.x>0?e.max.x:e.min.x,Fm.y=n.normal.y>0?e.max.y:e.min.y,Fm.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Fm)<0)return!1}return!0}containsPoint(e){let i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};var gt=class{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p){let _=this.elements;return _[0]=e,_[4]=i,_[8]=r,_[12]=n,_[1]=o,_[5]=a,_[9]=l,_[13]=h,_[2]=u,_[6]=c,_[10]=f,_[14]=d,_[3]=m,_[7]=v,_[11]=g,_[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new gt().fromArray(this.elements)}copy(e){let i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){let i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){let i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){let i=this.elements,r=e.elements,n=1/Th.setFromMatrixColumn(e,0).length(),o=1/Th.setFromMatrixColumn(e,1).length(),a=1/Th.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let i=this.elements,r=e.x,n=e.y,o=e.z,a=Math.cos(r),l=Math.sin(r),h=Math.cos(n),u=Math.sin(n),c=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){let d=a*c,m=a*f,v=l*c,g=l*f;i[0]=h*c,i[4]=-h*f,i[8]=u,i[1]=m+v*u,i[5]=d-g*u,i[9]=-l*h,i[2]=g-d*u,i[6]=v+m*u,i[10]=a*h}else if(e.order==="YXZ"){let d=h*c,m=h*f,v=u*c,g=u*f;i[0]=d+g*l,i[4]=v*l-m,i[8]=a*u,i[1]=a*f,i[5]=a*c,i[9]=-l,i[2]=m*l-v,i[6]=g+d*l,i[10]=a*h}else if(e.order==="ZXY"){let d=h*c,m=h*f,v=u*c,g=u*f;i[0]=d-g*l,i[4]=-a*f,i[8]=v+m*l,i[1]=m+v*l,i[5]=a*c,i[9]=g-d*l,i[2]=-a*u,i[6]=l,i[10]=a*h}else if(e.order==="ZYX"){let d=a*c,m=a*f,v=l*c,g=l*f;i[0]=h*c,i[4]=v*u-m,i[8]=d*u+g,i[1]=h*f,i[5]=g*u+d,i[9]=m*u-v,i[2]=-u,i[6]=l*h,i[10]=a*h}else if(e.order==="YZX"){let d=a*h,m=a*u,v=l*h,g=l*u;i[0]=h*c,i[4]=g-d*f,i[8]=v*f+m,i[1]=f,i[5]=a*c,i[9]=-l*c,i[2]=-u*c,i[6]=m*f+v,i[10]=d-g*f}else if(e.order==="XZY"){let d=a*h,m=a*u,v=l*h,g=l*u;i[0]=h*c,i[4]=-f,i[8]=u*c,i[1]=d*f+g,i[5]=a*c,i[9]=m*f-v,i[2]=v*f-m,i[6]=l*c,i[10]=g*f+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Tz,e,Az)}lookAt(e,i,r){let n=this.elements;return Cn.subVectors(e,i),Cn.lengthSq()===0&&(Cn.z=1),Cn.normalize(),Sa.crossVectors(r,Cn),Sa.lengthSq()===0&&(Math.abs(r.z)===1?Cn.x+=1e-4:Cn.z+=1e-4,Cn.normalize(),Sa.crossVectors(r,Cn)),Sa.normalize(),Bm.crossVectors(Cn,Sa),n[0]=Sa.x,n[4]=Bm.x,n[8]=Cn.x,n[1]=Sa.y,n[5]=Bm.y,n[9]=Cn.y,n[2]=Sa.z,n[6]=Bm.z,n[10]=Cn.z,this}multiply(e,i){return i!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,i)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let r=e.elements,n=i.elements,o=this.elements,a=r[0],l=r[4],h=r[8],u=r[12],c=r[1],f=r[5],d=r[9],m=r[13],v=r[2],g=r[6],p=r[10],_=r[14],x=r[3],b=r[7],y=r[11],w=r[15],S=n[0],R=n[4],E=n[8],T=n[12],A=n[1],C=n[5],M=n[9],D=n[13],O=n[2],P=n[6],L=n[10],I=n[14],k=n[3],B=n[7],F=n[11],W=n[15];return o[0]=a*S+l*A+h*O+u*k,o[4]=a*R+l*C+h*P+u*B,o[8]=a*E+l*M+h*L+u*F,o[12]=a*T+l*D+h*I+u*W,o[1]=c*S+f*A+d*O+m*k,o[5]=c*R+f*C+d*P+m*B,o[9]=c*E+f*M+d*L+m*F,o[13]=c*T+f*D+d*I+m*W,o[2]=v*S+g*A+p*O+_*k,o[6]=v*R+g*C+p*P+_*B,o[10]=v*E+g*M+p*L+_*F,o[14]=v*T+g*D+p*I+_*W,o[3]=x*S+b*A+y*O+w*k,o[7]=x*R+b*C+y*P+w*B,o[11]=x*E+b*M+y*L+w*F,o[15]=x*T+b*D+y*I+w*W,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){let e=this.elements,i=e[0],r=e[4],n=e[8],o=e[12],a=e[1],l=e[5],h=e[9],u=e[13],c=e[2],f=e[6],d=e[10],m=e[14],v=e[3],g=e[7],p=e[11],_=e[15];return v*(+o*h*f-n*u*f-o*l*d+r*u*d+n*l*m-r*h*m)+g*(+i*h*m-i*u*d+o*a*d-n*a*m+n*u*c-o*h*c)+p*(+i*u*f-i*l*m-o*a*f+r*a*m+o*l*c-r*u*c)+_*(-n*l*c-i*h*f+i*l*d+n*a*f-r*a*d+r*h*c)}transpose(){let e=this.elements,i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=i,n[14]=r),this}invert(){let e=this.elements,i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],f=e[9],d=e[10],m=e[11],v=e[12],g=e[13],p=e[14],_=e[15],x=f*p*u-g*d*u+g*h*m-l*p*m-f*h*_+l*d*_,b=v*d*u-c*p*u-v*h*m+a*p*m+c*h*_-a*d*_,y=c*g*u-v*f*u+v*l*m-a*g*m-c*l*_+a*f*_,w=v*f*h-c*g*h-v*l*d+a*g*d+c*l*p-a*f*p,S=i*x+r*b+n*y+o*w;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let R=1/S;return e[0]=x*R,e[1]=(g*d*o-f*p*o-g*n*m+r*p*m+f*n*_-r*d*_)*R,e[2]=(l*p*o-g*h*o+g*n*u-r*p*u-l*n*_+r*h*_)*R,e[3]=(f*h*o-l*d*o-f*n*u+r*d*u+l*n*m-r*h*m)*R,e[4]=b*R,e[5]=(c*p*o-v*d*o+v*n*m-i*p*m-c*n*_+i*d*_)*R,e[6]=(v*h*o-a*p*o-v*n*u+i*p*u+a*n*_-i*h*_)*R,e[7]=(a*d*o-c*h*o+c*n*u-i*d*u-a*n*m+i*h*m)*R,e[8]=y*R,e[9]=(v*f*o-c*g*o-v*r*m+i*g*m+c*r*_-i*f*_)*R,e[10]=(a*g*o-v*l*o+v*r*u-i*g*u-a*r*_+i*l*_)*R,e[11]=(c*l*o-a*f*o-c*r*u+i*f*u+a*r*m-i*l*m)*R,e[12]=w*R,e[13]=(c*g*n-v*f*n+v*r*d-i*g*d-c*r*p+i*f*p)*R,e[14]=(v*l*n-a*g*n-v*r*h+i*g*h+a*r*p-i*l*p)*R,e[15]=(a*f*n-c*l*n+c*r*h-i*f*h-a*r*d+i*l*d)*R,this}scale(e){let i=this.elements,r=e.x,n=e.y,o=e.z;return i[0]*=r,i[4]*=n,i[8]*=o,i[1]*=r,i[5]*=n,i[9]*=o,i[2]*=r,i[6]*=n,i[10]*=o,i[3]*=r,i[7]*=n,i[11]*=o,this}getMaxScaleOnAxis(){let e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(e,i,r){return this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){let i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){let r=Math.cos(i),n=Math.sin(i),o=1-r,a=e.x,l=e.y,h=e.z,u=o*a,c=o*l;return this.set(u*a+r,u*l-n*h,u*h+n*l,0,u*l+n*h,c*l+r,c*h-n*a,0,u*h-n*l,c*h+n*a,o*h*h+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,n,o,a){return this.set(1,r,o,0,e,1,a,0,i,n,1,0,0,0,0,1),this}compose(e,i,r){let n=this.elements,o=i._x,a=i._y,l=i._z,h=i._w,u=o+o,c=a+a,f=l+l,d=o*u,m=o*c,v=o*f,g=a*c,p=a*f,_=l*f,x=h*u,b=h*c,y=h*f,w=r.x,S=r.y,R=r.z;return n[0]=(1-(g+_))*w,n[1]=(m+y)*w,n[2]=(v-b)*w,n[3]=0,n[4]=(m-y)*S,n[5]=(1-(d+_))*S,n[6]=(p+x)*S,n[7]=0,n[8]=(v+b)*R,n[9]=(p-x)*R,n[10]=(1-(d+g))*R,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,i,r){let n=this.elements,o=Th.set(n[0],n[1],n[2]).length(),a=Th.set(n[4],n[5],n[6]).length(),l=Th.set(n[8],n[9],n[10]).length();this.determinant()<0&&(o=-o),e.x=n[12],e.y=n[13],e.z=n[14],Es.copy(this);let u=1/o,c=1/a,f=1/l;return Es.elements[0]*=u,Es.elements[1]*=u,Es.elements[2]*=u,Es.elements[4]*=c,Es.elements[5]*=c,Es.elements[6]*=c,Es.elements[8]*=f,Es.elements[9]*=f,Es.elements[10]*=f,i.setFromRotationMatrix(Es),r.x=o,r.y=a,r.z=l,this}makePerspective(e,i,r,n,o,a){a===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let l=this.elements,h=2*o/(i-e),u=2*o/(r-n),c=(i+e)/(i-e),f=(r+n)/(r-n),d=-(a+o)/(a-o),m=-2*a*o/(a-o);return l[0]=h,l[4]=0,l[8]=c,l[12]=0,l[1]=0,l[5]=u,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=d,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,i,r,n,o,a){let l=this.elements,h=1/(i-e),u=1/(r-n),c=1/(a-o),f=(i+e)*h,d=(r+n)*u,m=(a+o)*c;return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-d,l[2]=0,l[6]=0,l[10]=-2*c,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){let i=this.elements,r=e.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){let r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}};gt.prototype.isMatrix4=!0;var Th=new q,Es=new gt,Tz=new q(0,0,0),Az=new q(1,1,1),Sa=new q,Bm=new q,Cn=new q;function Nm(){let t=null,e=!1,i=null,r=null;function n(o,a){i(o,a),r=t.requestAnimationFrame(n)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){i=o},setContext:function(o){t=o}}}function fA(t,e){let i=e.isWebGL2,r=new WeakMap;function n(u,c){let f=u.array,d=u.usage,m=t.createBuffer();t.bindBuffer(c,m),t.bufferData(c,f,d),u.onUploadCallback();let v;if(f instanceof Float32Array)v=t.FLOAT;else if(f instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(i)v=t.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=t.UNSIGNED_SHORT;else if(f instanceof Int16Array)v=t.SHORT;else if(f instanceof Uint32Array)v=t.UNSIGNED_INT;else if(f instanceof Int32Array)v=t.INT;else if(f instanceof Int8Array)v=t.BYTE;else if(f instanceof Uint8Array)v=t.UNSIGNED_BYTE;else if(f instanceof Uint8ClampedArray)v=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);return{buffer:m,type:v,bytesPerElement:f.BYTES_PER_ELEMENT,version:u.version}}function o(u,c,f){let d=c.array,m=c.updateRange;t.bindBuffer(f,u),m.count===-1?t.bufferSubData(f,0,d):(i?t.bufferSubData(f,m.offset*d.BYTES_PER_ELEMENT,d,m.offset,m.count):t.bufferSubData(f,m.offset*d.BYTES_PER_ELEMENT,d.subarray(m.offset,m.offset+m.count)),m.count=-1)}function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),r.get(u)}function l(u){u.isInterleavedBufferAttribute&&(u=u.data);let c=r.get(u);c&&(t.deleteBuffer(c.buffer),r.delete(u))}function h(u,c){if(u.isGLBufferAttribute){let d=r.get(u);(!d||d.version<u.version)&&r.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);let f=r.get(u);f===void 0?r.set(u,n(u,c)):f.version<u.version&&(o(f.buffer,u,c),f.version=u.version)}return{get:a,remove:l,update:h}}var Hi=new q,Um=new ot,wt=class{constructor(e,i,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r===!0,this.usage=Ky,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let n=0,o=this.itemSize;n<o;n++)this.array[e+n]=i.array[r+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let i=this.array,r=0;for(let n=0,o=e.length;n<o;n++){let a=e[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new $e),i[r++]=a.r,i[r++]=a.g,i[r++]=a.b}return this}copyVector2sArray(e){let i=this.array,r=0;for(let n=0,o=e.length;n<o;n++){let a=e[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new ot),i[r++]=a.x,i[r++]=a.y}return this}copyVector3sArray(e){let i=this.array,r=0;for(let n=0,o=e.length;n<o;n++){let a=e[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new q),i[r++]=a.x,i[r++]=a.y,i[r++]=a.z}return this}copyVector4sArray(e){let i=this.array,r=0;for(let n=0,o=e.length;n<o;n++){let a=e[n];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new jt),i[r++]=a.x,i[r++]=a.y,i[r++]=a.z,i[r++]=a.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)Um.fromBufferAttribute(this,i),Um.applyMatrix3(e),this.setXY(i,Um.x,Um.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)Hi.fromBufferAttribute(this,i),Hi.applyMatrix3(e),this.setXYZ(i,Hi.x,Hi.y,Hi.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)Hi.fromBufferAttribute(this,i),Hi.applyMatrix4(e),this.setXYZ(i,Hi.x,Hi.y,Hi.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Hi.fromBufferAttribute(this,i),Hi.applyNormalMatrix(e),this.setXYZ(i,Hi.x,Hi.y,Hi.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Hi.fromBufferAttribute(this,i),Hi.transformDirection(e),this.setXYZ(i,Hi.x,Hi.y,Hi.z);return this}set(e,i=0){return this.array.set(e,i),this}getX(e){return this.array[e*this.itemSize]}setX(e,i){return this.array[e*this.itemSize]=i,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,i){return this.array[e*this.itemSize+1]=i,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,i){return this.array[e*this.itemSize+2]=i,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,i){return this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,n){return e*=this.itemSize,this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,i,r,n,o){return e*=this.itemSize,this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Ky&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};wt.prototype.isBufferAttribute=!0;var Ah=class extends wt{constructor(e,i,r){super(new Uint16Array(e),i,r)}};var Ph=class extends wt{constructor(e,i,r){super(new Uint32Array(e),i,r)}},lx=class extends wt{constructor(e,i,r){super(new Uint16Array(e),i,r)}};lx.prototype.isFloat16BufferAttribute=!0;var Bt=class extends wt{constructor(e,i,r){super(new Float32Array(e),i,r)}};var dA=new gt,pA=new Ar,No=class{constructor(e=0,i=0,r=0,n=No.DefaultOrder){this._x=e,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,n=this._order){return this._x=e,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){let n=e.elements,o=n[0],a=n[4],l=n[8],h=n[1],u=n[5],c=n[9],f=n[2],d=n[6],m=n[10];switch(i){case"XYZ":this._y=Math.asin(er(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-er(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(l,m),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(er(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(h,o));break;case"ZYX":this._y=Math.asin(-er(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,m),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(er(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(l,m));break;case"XZY":this._z=Math.asin(-er(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-c,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return dA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(dA,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return pA.setFromEuler(this),this.setFromQuaternion(pA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};No.prototype.isEuler=!0;No.DefaultOrder="XYZ";No.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Ca=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}};var Pz=0,mA=new q,Rh=new Ar,Uo=new gt,Gm=new q,Ic=new q,Rz=new q,Lz=new Ar,gA=new q(1,0,0),vA=new q(0,1,0),_A=new q(0,0,1),Oz={type:"added"},yA={type:"removed"},Xt=class extends Er{constructor(){super(),Object.defineProperty(this,"id",{value:Pz++}),this.uuid=no(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xt.DefaultUp.clone();let e=new q,i=new No,r=new Ar,n=new q(1,1,1);function o(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(o),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new gt},normalMatrix:{value:new zi}}),this.matrix=new gt,this.matrixWorld=new gt,this.matrixAutoUpdate=Xt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ca,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Rh.setFromAxisAngle(e,i),this.quaternion.multiply(Rh),this}rotateOnWorldAxis(e,i){return Rh.setFromAxisAngle(e,i),this.quaternion.premultiply(Rh),this}rotateX(e){return this.rotateOnAxis(gA,e)}rotateY(e){return this.rotateOnAxis(vA,e)}rotateZ(e){return this.rotateOnAxis(_A,e)}translateOnAxis(e,i){return mA.copy(e).applyQuaternion(this.quaternion),this.position.add(mA.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(gA,e)}translateY(e){return this.translateOnAxis(vA,e)}translateZ(e){return this.translateOnAxis(_A,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Uo.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?Gm.copy(e):Gm.set(e,i,r);let n=this.parent;this.updateWorldMatrix(!0,!1),Ic.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Uo.lookAt(Ic,Gm,this.up):Uo.lookAt(Gm,Ic,this.up),this.quaternion.setFromRotationMatrix(Uo),n&&(Uo.extractRotation(n.matrixWorld),Rh.setFromRotationMatrix(Uo),this.quaternion.premultiply(Rh.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Oz)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}let i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(yA)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let i=this.children[e];i.parent=null,i.dispatchEvent(yA)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Uo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Uo.multiply(e.parent.matrixWorld)),e.applyMatrix4(Uo),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,n=this.children.length;r<n;r++){let a=this.children[r].getObjectByProperty(e,i);if(a!==void 0)return a}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ic,e,Rz),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ic,Lz,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);let i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(e)}traverseAncestors(e){let i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].updateMatrixWorld(e)}updateWorldMatrix(e,i){let r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){let n=this.children;for(let o=0,a=n.length;o<a;o++)n[o].updateWorldMatrix(!1,!0)}}toJSON(e){let i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function o(l,h){return l[h.uuid]===void 0&&(l[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=o(e.geometries,this.geometry);let l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){let h=l.shapes;if(Array.isArray(h))for(let u=0,c=h.length;u<c;u++){let f=h[u];o(e.shapes,f)}else o(e.shapes,h)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let l=[];for(let h=0,u=this.material.length;h<u;h++)l.push(o(e.materials,this.material[h]));n.material=l}else n.material=o(e.materials,this.material);if(this.children.length>0){n.children=[];for(let l=0;l<this.children.length;l++)n.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let l=0;l<this.animations.length;l++){let h=this.animations[l];n.animations.push(o(e.animations,h))}}if(i){let l=a(e.geometries),h=a(e.materials),u=a(e.textures),c=a(e.images),f=a(e.shapes),d=a(e.skeletons),m=a(e.animations),v=a(e.nodes);l.length>0&&(r.geometries=l),h.length>0&&(r.materials=h),u.length>0&&(r.textures=u),c.length>0&&(r.images=c),f.length>0&&(r.shapes=f),d.length>0&&(r.skeletons=d),m.length>0&&(r.animations=m),v.length>0&&(r.nodes=v)}return r.object=n,r;function a(l){let h=[];for(let u in l){let c=l[u];delete c.metadata,h.push(c)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){let n=e.children[r];this.add(n.clone())}return this}};Xt.DefaultUp=new q(0,1,0);Xt.DefaultMatrixAutoUpdate=!0;Xt.prototype.isObject3D=!0;var Dz=0,Yn=new gt,hx=new Xt,Lh=new q,Mn=new Li,kc=new Li,ar=new q,_t=class extends Er{constructor(){super(),Object.defineProperty(this,"id",{value:Dz++}),this.uuid=no(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Rm(e)?Ph:Ah)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){let i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);let r=this.attributes.normal;if(r!==void 0){let o=new zi().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}let n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Yn.makeRotationFromQuaternion(e),this.applyMatrix4(Yn),this}rotateX(e){return Yn.makeRotationX(e),this.applyMatrix4(Yn),this}rotateY(e){return Yn.makeRotationY(e),this.applyMatrix4(Yn),this}rotateZ(e){return Yn.makeRotationZ(e),this.applyMatrix4(Yn),this}translate(e,i,r){return Yn.makeTranslation(e,i,r),this.applyMatrix4(Yn),this}scale(e,i,r){return Yn.makeScale(e,i,r),this.applyMatrix4(Yn),this}lookAt(e){return hx.lookAt(e),hx.updateMatrix(),this.applyMatrix4(hx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Lh).negate(),this.translate(Lh.x,Lh.y,Lh.z),this}setFromPoints(e){let i=[];for(let r=0,n=e.length;r<n;r++){let o=e[r];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Bt(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Li);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new q(-1/0,-1/0,-1/0),new q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,n=i.length;r<n;r++){let o=i[r];Mn.setFromBufferAttribute(o),this.morphTargetsRelative?(ar.addVectors(this.boundingBox.min,Mn.min),this.boundingBox.expandByPoint(ar),ar.addVectors(this.boundingBox.max,Mn.max),this.boundingBox.expandByPoint(ar)):(this.boundingBox.expandByPoint(Mn.min),this.boundingBox.expandByPoint(Mn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new hn);let e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new q,1/0);return}if(e){let r=this.boundingSphere.center;if(Mn.setFromBufferAttribute(e),i)for(let o=0,a=i.length;o<a;o++){let l=i[o];kc.setFromBufferAttribute(l),this.morphTargetsRelative?(ar.addVectors(Mn.min,kc.min),Mn.expandByPoint(ar),ar.addVectors(Mn.max,kc.max),Mn.expandByPoint(ar)):(Mn.expandByPoint(kc.min),Mn.expandByPoint(kc.max))}Mn.getCenter(r);let n=0;for(let o=0,a=e.count;o<a;o++)ar.fromBufferAttribute(e,o),n=Math.max(n,r.distanceToSquared(ar));if(i)for(let o=0,a=i.length;o<a;o++){let l=i[o],h=this.morphTargetsRelative;for(let u=0,c=l.count;u<c;u++)ar.fromBufferAttribute(l,u),h&&(Lh.fromBufferAttribute(e,u),ar.add(Lh)),n=Math.max(n,r.distanceToSquared(ar))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let r=e.array,n=i.position.array,o=i.normal.array,a=i.uv.array,l=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new wt(new Float32Array(4*l),4));let h=this.getAttribute("tangent").array,u=[],c=[];for(let A=0;A<l;A++)u[A]=new q,c[A]=new q;let f=new q,d=new q,m=new q,v=new ot,g=new ot,p=new ot,_=new q,x=new q;function b(A,C,M){f.fromArray(n,A*3),d.fromArray(n,C*3),m.fromArray(n,M*3),v.fromArray(a,A*2),g.fromArray(a,C*2),p.fromArray(a,M*2),d.sub(f),m.sub(f),g.sub(v),p.sub(v);let D=1/(g.x*p.y-p.x*g.y);isFinite(D)&&(_.copy(d).multiplyScalar(p.y).addScaledVector(m,-g.y).multiplyScalar(D),x.copy(m).multiplyScalar(g.x).addScaledVector(d,-p.x).multiplyScalar(D),u[A].add(_),u[C].add(_),u[M].add(_),c[A].add(x),c[C].add(x),c[M].add(x))}let y=this.groups;y.length===0&&(y=[{start:0,count:r.length}]);for(let A=0,C=y.length;A<C;++A){let M=y[A],D=M.start,O=M.count;for(let P=D,L=D+O;P<L;P+=3)b(r[P+0],r[P+1],r[P+2])}let w=new q,S=new q,R=new q,E=new q;function T(A){R.fromArray(o,A*3),E.copy(R);let C=u[A];w.copy(C),w.sub(R.multiplyScalar(R.dot(C))).normalize(),S.crossVectors(E,C);let D=S.dot(c[A])<0?-1:1;h[A*4]=w.x,h[A*4+1]=w.y,h[A*4+2]=w.z,h[A*4+3]=D}for(let A=0,C=y.length;A<C;++A){let M=y[A],D=M.start,O=M.count;for(let P=D,L=D+O;P<L;P+=3)T(r[P+0]),T(r[P+1]),T(r[P+2])}}computeVertexNormals(){let e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new wt(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,m=r.count;d<m;d++)r.setXYZ(d,0,0,0);let n=new q,o=new q,a=new q,l=new q,h=new q,u=new q,c=new q,f=new q;if(e)for(let d=0,m=e.count;d<m;d+=3){let v=e.getX(d+0),g=e.getX(d+1),p=e.getX(d+2);n.fromBufferAttribute(i,v),o.fromBufferAttribute(i,g),a.fromBufferAttribute(i,p),c.subVectors(a,o),f.subVectors(n,o),c.cross(f),l.fromBufferAttribute(r,v),h.fromBufferAttribute(r,g),u.fromBufferAttribute(r,p),l.add(c),h.add(c),u.add(c),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(g,h.x,h.y,h.z),r.setXYZ(p,u.x,u.y,u.z)}else for(let d=0,m=i.count;d<m;d+=3)n.fromBufferAttribute(i,d+0),o.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),c.subVectors(a,o),f.subVectors(n,o),c.cross(f),r.setXYZ(d+0,c.x,c.y,c.z),r.setXYZ(d+1,c.x,c.y,c.z),r.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(e,i){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}i===void 0&&(i=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let r=this.attributes;for(let n in r){if(e.attributes[n]===void 0)continue;let a=r[n].array,l=e.attributes[n],h=l.array,u=l.itemSize*i,c=Math.min(h.length,a.length-u);for(let f=0,d=u;f<c;f++,d++)a[d]=h[f]}return this}normalizeNormals(){let e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)ar.fromBufferAttribute(e,i),ar.normalize(),e.setXYZ(i,ar.x,ar.y,ar.z)}toNonIndexed(){function e(l,h){let u=l.array,c=l.itemSize,f=l.normalized,d=new u.constructor(h.length*c),m=0,v=0;for(let g=0,p=h.length;g<p;g++){l.isInterleavedBufferAttribute?m=h[g]*l.data.stride+l.offset:m=h[g]*c;for(let _=0;_<c;_++)d[v++]=u[m++]}return new wt(d,c,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let i=new _t,r=this.index.array,n=this.attributes;for(let l in n){let h=n[l],u=e(h,r);i.setAttribute(l,u)}let o=this.morphAttributes;for(let l in o){let h=[],u=o[l];for(let c=0,f=u.length;c<f;c++){let d=u[c],m=e(d,r);h.push(m)}i.morphAttributes[l]=h}i.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let l=0,h=a.length;l<h;l++){let u=a[l];i.addGroup(u.start,u.count,u.materialIndex)}return i}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let h=this.parameters;for(let u in h)h[u]!==void 0&&(e[u]=h[u]);return e}e.data={attributes:{}};let i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});let r=this.attributes;for(let h in r){let u=r[h];e.data.attributes[h]=u.toJSON(e.data)}let n={},o=!1;for(let h in this.morphAttributes){let u=this.morphAttributes[h],c=[];for(let f=0,d=u.length;f<d;f++){let m=u[f];c.push(m.toJSON(e.data))}c.length>0&&(n[h]=c,o=!0)}o&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let i={};this.name=e.name;let r=e.index;r!==null&&this.setIndex(r.clone(i));let n=e.attributes;for(let u in n){let c=n[u];this.setAttribute(u,c.clone(i))}let o=e.morphAttributes;for(let u in o){let c=[],f=o[u];for(let d=0,m=f.length;d<m;d++)c.push(f[d].clone(i));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let u=0,c=a.length;u<c;u++){let f=a[u];this.addGroup(f.start,f.count,f.materialIndex)}let l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());let h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}};_t.prototype.isBufferGeometry=!0;var En=class extends _t{constructor(e=1,i=1,r=1,n=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:n,heightSegments:o,depthSegments:a};let l=this;n=Math.floor(n),o=Math.floor(o),a=Math.floor(a);let h=[],u=[],c=[],f=[],d=0,m=0;v("z","y","x",-1,-1,r,i,e,a,o,0),v("z","y","x",1,-1,r,i,-e,a,o,1),v("x","z","y",1,1,e,r,i,n,a,2),v("x","z","y",1,-1,e,r,-i,n,a,3),v("x","y","z",1,-1,e,i,r,n,o,4),v("x","y","z",-1,-1,e,i,-r,n,o,5),this.setIndex(h),this.setAttribute("position",new Bt(u,3)),this.setAttribute("normal",new Bt(c,3)),this.setAttribute("uv",new Bt(f,2));function v(g,p,_,x,b,y,w,S,R,E,T){let A=y/R,C=w/E,M=y/2,D=w/2,O=S/2,P=R+1,L=E+1,I=0,k=0,B=new q;for(let F=0;F<L;F++){let W=F*C-D;for(let V=0;V<P;V++){let N=V*A-M;B[g]=N*x,B[p]=W*b,B[_]=O,u.push(B.x,B.y,B.z),B[g]=0,B[p]=0,B[_]=S>0?1:-1,c.push(B.x,B.y,B.z),f.push(V/R),f.push(1-F/E),I+=1}}for(let F=0;F<E;F++)for(let W=0;W<R;W++){let V=d+W+P*F,N=d+W+P*(F+1),ne=d+(W+1)+P*(F+1),ie=d+(W+1)+P*F;h.push(V,N,ie),h.push(N,ne,ie),k+=6}l.addGroup(m,k,T),m+=k,d+=I}}static fromJSON(e){return new En(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};var yr=class extends _t{constructor(e=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:n};let o=e/2,a=i/2,l=Math.floor(r),h=Math.floor(n),u=l+1,c=h+1,f=e/l,d=i/h,m=[],v=[],g=[],p=[];for(let _=0;_<c;_++){let x=_*d-a;for(let b=0;b<u;b++){let y=b*f-o;v.push(y,-x,0),g.push(0,0,1),p.push(b/l),p.push(1-_/h)}}for(let _=0;_<h;_++)for(let x=0;x<l;x++){let b=x+u*_,y=x+u*(_+1),w=x+1+u*(_+1),S=x+1+u*_;m.push(b,y,S),m.push(y,w,S)}this.setIndex(m),this.setAttribute("position",new Bt(v,3)),this.setAttribute("normal",new Bt(g,3)),this.setAttribute("uv",new Bt(p,2))}static fromJSON(e){return new yr(e.width,e.height,e.widthSegments,e.heightSegments)}};var Iz=0,Pr=class extends Er{constructor(){super(),Object.defineProperty(this,"id",{value:Iz++}),this.uuid=no(),this.name="",this.type="Material",this.fog=!0,this.blending=Do,this.side=Ei,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=bm,this.blendDst=wm,this.blendEquation=ga,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=wc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=aA,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Tm,this.stencilZFail=Tm,this.stencilZPass=Tm,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let i in e){let r=e[i];if(r===void 0){console.warn("THREE.Material: '"+i+"' parameter is undefined.");continue}if(i==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===mT;continue}let n=this[i];if(n===void 0){console.warn("THREE."+this.type+": '"+i+"' is not a property of this material.");continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(e){let i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});let r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Do&&(r.blending=this.blending),this.side!==Ei&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData);function n(o){let a=[];for(let l in o){let h=o[l];delete h.metadata,a.push(h)}return a}if(i){let o=n(e.textures),a=n(e.images);o.length>0&&(r.textures=o),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let i=e.clippingPlanes,r=null;if(i!==null){let n=i.length;r=new Array(n);for(let o=0;o!==n;++o)r[o]=i[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};Pr.prototype.isMaterial=!0;Pr.fromType=function(){return null};function Go(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function xr(t){let e={};for(let i=0;i<t.length;i++){let r=Go(t[i]);for(let n in r)e[n]=r[n]}return e}var Fc={clone:Go,merge:xr};var xA=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`;var bA=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;var un=class extends Pr{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=xA,this.fragmentShader=bA,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Go(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(let n in this.uniforms){let a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;let r={};for(let n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}};un.prototype.isShaderMaterial=!0;var zo=new q,ux=new q,zm=new q,Ma=new q,cx=new q,Hm=new q,fx=new q,Ea=class{constructor(e=new q,i=new q(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,zo)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);let r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let i=zo.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(zo.copy(this.direction).multiplyScalar(i).add(this.origin),zo.distanceToSquared(e))}distanceSqToSegment(e,i,r,n){ux.copy(e).add(i).multiplyScalar(.5),zm.copy(i).sub(e).normalize(),Ma.copy(this.origin).sub(ux);let o=e.distanceTo(i)*.5,a=-this.direction.dot(zm),l=Ma.dot(this.direction),h=-Ma.dot(zm),u=Ma.lengthSq(),c=Math.abs(1-a*a),f,d,m,v;if(c>0)if(f=a*h-l,d=a*l-h,v=o*c,f>=0)if(d>=-v)if(d<=v){let g=1/c;f*=g,d*=g,m=f*(f+a*d+2*l)+d*(a*f+d+2*h)+u}else d=o,f=Math.max(0,-(a*d+l)),m=-f*f+d*(d+2*h)+u;else d=-o,f=Math.max(0,-(a*d+l)),m=-f*f+d*(d+2*h)+u;else d<=-v?(f=Math.max(0,-(-a*o+l)),d=f>0?-o:Math.min(Math.max(-o,-h),o),m=-f*f+d*(d+2*h)+u):d<=v?(f=0,d=Math.min(Math.max(-o,-h),o),m=d*(d+2*h)+u):(f=Math.max(0,-(a*o+l)),d=f>0?o:Math.min(Math.max(-o,-h),o),m=-f*f+d*(d+2*h)+u);else d=a>0?-o:o,f=Math.max(0,-(a*d+l)),m=-f*f+d*(d+2*h)+u;return r&&r.copy(this.direction).multiplyScalar(f).add(this.origin),n&&n.copy(zm).multiplyScalar(d).add(ux),m}intersectSphere(e,i){zo.subVectors(e.center,this.origin);let r=zo.dot(this.direction),n=zo.dot(zo)-r*r,o=e.radius*e.radius;if(n>o)return null;let a=Math.sqrt(o-n),l=r-a,h=r+a;return l<0&&h<0?null:l<0?this.at(h,i):this.at(l,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;let r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){let r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){let i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,n,o,a,l,h,u=1/this.direction.x,c=1/this.direction.y,f=1/this.direction.z,d=this.origin;return u>=0?(r=(e.min.x-d.x)*u,n=(e.max.x-d.x)*u):(r=(e.max.x-d.x)*u,n=(e.min.x-d.x)*u),c>=0?(o=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(o=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),r>a||o>n||((o>r||r!==r)&&(r=o),(a<n||n!==n)&&(n=a),f>=0?(l=(e.min.z-d.z)*f,h=(e.max.z-d.z)*f):(l=(e.max.z-d.z)*f,h=(e.min.z-d.z)*f),r>h||l>n)||((l>r||r!==r)&&(r=l),(h<n||n!==n)&&(n=h),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(e){return this.intersectBox(e,zo)!==null}intersectTriangle(e,i,r,n,o){cx.subVectors(i,e),Hm.subVectors(r,e),fx.crossVectors(cx,Hm);let a=this.direction.dot(fx),l;if(a>0){if(n)return null;l=1}else if(a<0)l=-1,a=-a;else return null;Ma.subVectors(this.origin,e);let h=l*this.direction.dot(Hm.crossVectors(Ma,Hm));if(h<0)return null;let u=l*this.direction.dot(cx.cross(Ma));if(u<0||h+u>a)return null;let c=-l*Ma.dot(fx);return c<0?null:this.at(c/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};var Ts=new q,Ho=new q,dx=new q,Wo=new q,Oh=new q,Dh=new q,wA=new q,px=new q,mx=new q,gx=new q,Zn=class{constructor(e=new q,i=new q,r=new q){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,n){n.subVectors(r,i),Ts.subVectors(e,i),n.cross(Ts);let o=n.lengthSq();return o>0?n.multiplyScalar(1/Math.sqrt(o)):n.set(0,0,0)}static getBarycoord(e,i,r,n,o){Ts.subVectors(n,i),Ho.subVectors(r,i),dx.subVectors(e,i);let a=Ts.dot(Ts),l=Ts.dot(Ho),h=Ts.dot(dx),u=Ho.dot(Ho),c=Ho.dot(dx),f=a*u-l*l;if(f===0)return o.set(-2,-1,-1);let d=1/f,m=(u*h-l*c)*d,v=(a*c-l*h)*d;return o.set(1-m-v,v,m)}static containsPoint(e,i,r,n){return this.getBarycoord(e,i,r,n,Wo),Wo.x>=0&&Wo.y>=0&&Wo.x+Wo.y<=1}static getUV(e,i,r,n,o,a,l,h){return this.getBarycoord(e,i,r,n,Wo),h.set(0,0),h.addScaledVector(o,Wo.x),h.addScaledVector(a,Wo.y),h.addScaledVector(l,Wo.z),h}static isFrontFacing(e,i,r,n){return Ts.subVectors(r,i),Ho.subVectors(e,i),Ts.cross(Ho).dot(n)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,n){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,i,r,n){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ts.subVectors(this.c,this.b),Ho.subVectors(this.a,this.b),Ts.cross(Ho).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Zn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Zn.getBarycoord(e,this.a,this.b,this.c,i)}getUV(e,i,r,n,o){return Zn.getUV(e,this.a,this.b,this.c,i,r,n,o)}containsPoint(e){return Zn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Zn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){let r=this.a,n=this.b,o=this.c,a,l;Oh.subVectors(n,r),Dh.subVectors(o,r),px.subVectors(e,r);let h=Oh.dot(px),u=Dh.dot(px);if(h<=0&&u<=0)return i.copy(r);mx.subVectors(e,n);let c=Oh.dot(mx),f=Dh.dot(mx);if(c>=0&&f<=c)return i.copy(n);let d=h*f-c*u;if(d<=0&&h>=0&&c<=0)return a=h/(h-c),i.copy(r).addScaledVector(Oh,a);gx.subVectors(e,o);let m=Oh.dot(gx),v=Dh.dot(gx);if(v>=0&&m<=v)return i.copy(o);let g=m*u-h*v;if(g<=0&&u>=0&&v<=0)return l=u/(u-v),i.copy(r).addScaledVector(Dh,l);let p=c*v-m*f;if(p<=0&&f-c>=0&&m-v>=0)return wA.subVectors(o,n),l=(f-c)/(f-c+(m-v)),i.copy(n).addScaledVector(wA,l);let _=1/(p+g+d);return a=g*_,l=d*_,i.copy(r).addScaledVector(Oh,a).addScaledVector(Dh,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};var Wi=class extends Pr{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=va,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};Wi.prototype.isMeshBasicMaterial=!0;var SA=new gt,Ih=new Ea,vx=new hn,Ta=new q,Aa=new q,Pa=new q,_x=new q,yx=new q,xx=new q,Wm=new q,Vm=new q,jm=new q,qm=new ot,Xm=new ot,Ym=new ot,bx=new q,Zm=new q,St=class extends Xt{constructor(e=new _t,i=new Wi){super(),this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let i=e.morphAttributes,r=Object.keys(i);if(r.length>0){let n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=n.length;o<a;o++){let l=n[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=o}}}}else{let i=e.morphTargets;i!==void 0&&i.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,i){let r=this.geometry,n=this.material,o=this.matrixWorld;if(n===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),vx.copy(r.boundingSphere),vx.applyMatrix4(o),e.ray.intersectsSphere(vx)===!1)||(SA.copy(o).invert(),Ih.copy(e.ray).applyMatrix4(SA),r.boundingBox!==null&&Ih.intersectsBox(r.boundingBox)===!1))return;let a;if(r.isBufferGeometry){let l=r.index,h=r.attributes.position,u=r.morphAttributes.position,c=r.morphTargetsRelative,f=r.attributes.uv,d=r.attributes.uv2,m=r.groups,v=r.drawRange;if(l!==null)if(Array.isArray(n))for(let g=0,p=m.length;g<p;g++){let _=m[g],x=n[_.materialIndex],b=Math.max(_.start,v.start),y=Math.min(l.count,Math.min(_.start+_.count,v.start+v.count));for(let w=b,S=y;w<S;w+=3){let R=l.getX(w),E=l.getX(w+1),T=l.getX(w+2);a=Km(this,x,e,Ih,h,u,c,f,d,R,E,T),a&&(a.faceIndex=Math.floor(w/3),a.face.materialIndex=_.materialIndex,i.push(a))}}else{let g=Math.max(0,v.start),p=Math.min(l.count,v.start+v.count);for(let _=g,x=p;_<x;_+=3){let b=l.getX(_),y=l.getX(_+1),w=l.getX(_+2);a=Km(this,n,e,Ih,h,u,c,f,d,b,y,w),a&&(a.faceIndex=Math.floor(_/3),i.push(a))}}else if(h!==void 0)if(Array.isArray(n))for(let g=0,p=m.length;g<p;g++){let _=m[g],x=n[_.materialIndex],b=Math.max(_.start,v.start),y=Math.min(h.count,Math.min(_.start+_.count,v.start+v.count));for(let w=b,S=y;w<S;w+=3){let R=w,E=w+1,T=w+2;a=Km(this,x,e,Ih,h,u,c,f,d,R,E,T),a&&(a.faceIndex=Math.floor(w/3),a.face.materialIndex=_.materialIndex,i.push(a))}}else{let g=Math.max(0,v.start),p=Math.min(h.count,v.start+v.count);for(let _=g,x=p;_<x;_+=3){let b=_,y=_+1,w=_+2;a=Km(this,n,e,Ih,h,u,c,f,d,b,y,w),a&&(a.faceIndex=Math.floor(_/3),i.push(a))}}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};St.prototype.isMesh=!0;function kz(t,e,i,r,n,o,a,l){let h;if(e.side===Gi?h=r.intersectTriangle(a,o,n,!0,l):h=r.intersectTriangle(n,o,a,e.side!==qt,l),h===null)return null;Zm.copy(l),Zm.applyMatrix4(t.matrixWorld);let u=i.ray.origin.distanceTo(Zm);return u<i.near||u>i.far?null:{distance:u,point:Zm.clone(),object:t}}function Km(t,e,i,r,n,o,a,l,h,u,c,f){Ta.fromBufferAttribute(n,u),Aa.fromBufferAttribute(n,c),Pa.fromBufferAttribute(n,f);let d=t.morphTargetInfluences;if(o&&d){Wm.set(0,0,0),Vm.set(0,0,0),jm.set(0,0,0);for(let v=0,g=o.length;v<g;v++){let p=d[v],_=o[v];p!==0&&(_x.fromBufferAttribute(_,u),yx.fromBufferAttribute(_,c),xx.fromBufferAttribute(_,f),a?(Wm.addScaledVector(_x,p),Vm.addScaledVector(yx,p),jm.addScaledVector(xx,p)):(Wm.addScaledVector(_x.sub(Ta),p),Vm.addScaledVector(yx.sub(Aa),p),jm.addScaledVector(xx.sub(Pa),p)))}Ta.add(Wm),Aa.add(Vm),Pa.add(jm)}t.isSkinnedMesh&&(t.boneTransform(u,Ta),t.boneTransform(c,Aa),t.boneTransform(f,Pa));let m=kz(t,e,i,r,Ta,Aa,Pa,bx);if(m){l&&(qm.fromBufferAttribute(l,u),Xm.fromBufferAttribute(l,c),Ym.fromBufferAttribute(l,f),m.uv=Zn.getUV(bx,Ta,Aa,Pa,qm,Xm,Ym,new ot)),h&&(qm.fromBufferAttribute(h,u),Xm.fromBufferAttribute(h,c),Ym.fromBufferAttribute(h,f),m.uv2=Zn.getUV(bx,Ta,Aa,Pa,qm,Xm,Ym,new ot));let v={a:u,b:c,c:f,normal:new q,materialIndex:0};Zn.getNormal(Ta,Aa,Pa,v.normal),m.face=v}return m}var CA=`
#ifdef USE_ALPHAMAP

	diffuseColor.a *= texture2D( alphaMap, vUv ).g;

#endif
`;var MA=`
#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`;var EA=`
#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

#endif
`;var TA=`
#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif
`;var AA=`
#ifdef USE_AOMAP

	// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;

	reflectedLight.indirectDiffuse *= ambientOcclusion;

	#if defined( USE_ENVMAP ) && defined( STANDARD )

		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );

		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );

	#endif

#endif
`;var PA=`
#ifdef USE_AOMAP

	uniform sampler2D aoMap;
	uniform float aoMapIntensity;

#endif
`;var RA=`
vec3 transformed = vec3( position );
`;var LA=`
vec3 objectNormal = vec3( normal );

#ifdef USE_TANGENT

	vec3 objectTangent = vec3( tangent.xyz );

#endif
`;var OA=`

vec3 BRDF_Lambert( const in vec3 diffuseColor ) {

	return RECIPROCAL_PI * diffuseColor;

} // validated

vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {

	// Original approximation by Christophe Schlick '94
	// float fresnel = pow( 1.0 - dotVH, 5.0 );

	// Optimized variant (presented by Epic at SIGGRAPH '13)
	// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );

	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );

} // validated

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {

	float a2 = pow2( alpha );

	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );

	return 0.5 / max( gv + gl, EPSILON );

}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX( const in float alpha, const in float dotNH ) {

	float a2 = pow2( alpha );

	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1

	return RECIPROCAL_PI * a2 / pow2( denom );

}

// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {

	float alpha = pow2( roughness ); // UE4's roughness

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );

	vec3 F = F_Schlick( f0, f90, dotVH );

	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );

	float D = D_GGX( alpha, dotNH );

	return F * ( V * D );

}

// Rect Area Light

// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines
// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt
// code: https://github.com/selfshadow/ltc_code/

vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {

	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;

	float dotNV = saturate( dot( N, V ) );

	// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );

	uv = uv * LUT_SCALE + LUT_BIAS;

	return uv;

}

float LTC_ClippedSphereFormFactor( const in vec3 f ) {

	// Real-Time Area Lighting: a Journey from Research to Production (p.102)
	// An approximation of the form factor of a horizon-clipped rectangle.

	float l = length( f );

	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );

}

vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {

	float x = dot( v1, v2 );

	float y = abs( x );

	// rational polynomial approximation to theta / sin( theta ) / 2PI
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;

	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;

	return cross( v1, v2 ) * theta_sintheta;

}

vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {

	// bail if point is on back side of plane of light
	// assumes ccw winding order of light vertices
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );

	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );

	// construct orthonormal basis around N
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system

	// compute transform
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );

	// transform rect
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );

	// project rect onto sphere
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );

	// calculate vector form factor
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );

	// adjust for horizon clipping
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );

/*
	// alternate method of adjusting for horizon clipping (see referece)
	// refactoring required
	float len = length( vectorFormFactor );
	float z = vectorFormFactor.z / len;

	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;

	// tabulated horizon-clipped sphere, apparently...
	vec2 uv = vec2( z * 0.5 + 0.5, len );
	uv = uv * LUT_SCALE + LUT_BIAS;

	float scale = texture2D( ltc_2, uv ).w;

	float result = len * scale;
*/

	return vec3( result );

}

// End Rect Area Light


float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {

	// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)
	return 0.25;

}

float D_BlinnPhong( const in float shininess, const in float dotNH ) {

	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );

}

vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );

	vec3 F = F_Schlick( specularColor, 1.0, dotVH );

	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );

	float D = D_BlinnPhong( shininess, dotNH );

	return F * ( G * D );

} // validated

#if defined( USE_SHEEN )

// https://github.com/google/filament/blob/master/shaders/src/brdf.fs
float D_Charlie( float roughness, float dotNH ) {

	float alpha = pow2( roughness );

	// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16

	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );

}

// https://github.com/google/filament/blob/master/shaders/src/brdf.fs
float V_Neubelt( float dotNV, float dotNL ) {

	// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );

}

vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {

	vec3 halfDir = normalize( lightDir + viewDir );

	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );

	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );

	return sheenColor * ( D * V );

}

#endif
`;var DA=`
#ifdef USE_BUMPMAP

	uniform sampler2D bumpMap;
	uniform float bumpScale;

	// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
	// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

	vec2 dHdxy_fwd() {

		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );

		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;

		return vec2( dBx, dBy );

	}

	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

		// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;		// normalized

		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );

		float fDet = dot( vSigmaX, R1 ) * faceDirection;

		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );

	}

#endif
`;var IA=`
#if NUM_CLIPPING_PLANES > 0

	vec4 plane;

	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {

		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;

	}
	#pragma unroll_loop_end

	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES

		bool clipped = true;

		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {

			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;

		}
		#pragma unroll_loop_end

		if ( clipped ) discard;

	#endif

#endif
`;var kA=`
#if NUM_CLIPPING_PLANES > 0

	varying vec3 vClipPosition;

	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];

#endif
`;var FA=`
#if NUM_CLIPPING_PLANES > 0

	varying vec3 vClipPosition;

#endif
`;var BA=`
#if NUM_CLIPPING_PLANES > 0

	vClipPosition = - mvPosition.xyz;

#endif
`;var NA=`
#if defined( USE_COLOR_ALPHA )

	diffuseColor *= vColor;

#elif defined( USE_COLOR )

	diffuseColor.rgb *= vColor;

#endif
`;var UA=`
#if defined( USE_COLOR_ALPHA )

	varying vec4 vColor;

#elif defined( USE_COLOR )

	varying vec3 vColor;

#endif
`;var GA=`
#if defined( USE_COLOR_ALPHA )

	varying vec4 vColor;

#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )

	varying vec3 vColor;

#endif
`;var zA=`
#if defined( USE_COLOR_ALPHA )

	vColor = vec4( 1.0 );

#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )

	vColor = vec3( 1.0 );

#endif

#ifdef USE_COLOR

	vColor *= color;

#endif

#ifdef USE_INSTANCING_COLOR

	vColor.xyz *= instanceColor.xyz;

#endif
`;var HA=`
#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6

#ifndef saturate
// <tonemapping_pars_fragment> may have defined saturate() already
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )

float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }

// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.
// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand( const in vec2 uv ) {

	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );

	return fract( sin( sn ) * c );

}

#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif

struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};

struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};

struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};

vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

}

vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {

	// dir can be either a direction vector or a normal vector
	// upper-left 3x3 of matrix is assumed to be orthogonal

	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );

}

mat3 transposeMat3( const in mat3 m ) {

	mat3 tmp;

	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );

	return tmp;

}

// https://en.wikipedia.org/wiki/Relative_luminance
float linearToRelativeLuminance( const in vec3 color ) {

	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );

	return dot( weights, color.rgb );

}

bool isPerspectiveMatrix( mat4 m ) {

	return m[ 2 ][ 3 ] == - 1.0;

}

vec2 equirectUv( in vec3 dir ) {

	// dir is assumed to be unit length

	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;

	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;

	return vec2( u, v );

}
`;var WA=`
#ifdef ENVMAP_TYPE_CUBE_UV

	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0

	// These shader functions convert between the UV coordinates of a single face of
	// a cubemap, the 0-5 integer index of a cube face, and the direction vector for
	// sampling a textureCube (not generally normalized ).

	float getFace( vec3 direction ) {

		vec3 absDirection = abs( direction );

		float face = - 1.0;

		if ( absDirection.x > absDirection.z ) {

			if ( absDirection.x > absDirection.y )

				face = direction.x > 0.0 ? 0.0 : 3.0;

			else

				face = direction.y > 0.0 ? 1.0 : 4.0;

		} else {

			if ( absDirection.z > absDirection.y )

				face = direction.z > 0.0 ? 2.0 : 5.0;

			else

				face = direction.y > 0.0 ? 1.0 : 4.0;

		}

		return face;

	}

	// RH coordinate system; PMREM face-indexing convention
	vec2 getUV( vec3 direction, float face ) {

		vec2 uv;

		if ( face == 0.0 ) {

			uv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x

		} else if ( face == 1.0 ) {

			uv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y

		} else if ( face == 2.0 ) {

			uv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z

		} else if ( face == 3.0 ) {

			uv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x

		} else if ( face == 4.0 ) {

			uv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y

		} else {

			uv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z

		}

		return 0.5 * ( uv + 1.0 );

	}

	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {

		float face = getFace( direction );

		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );

		mipInt = max( mipInt, cubeUV_minMipLevel );

		float faceSize = exp2( mipInt );

		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;

		if ( face > 2.0 ) {

			uv.y += faceSize;

			face -= 3.0;

		}

		uv.x += face * faceSize;

		uv.x += filterInt * 3.0 * cubeUV_minTileSize;

		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );

		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;

		#ifdef texture2DGradEXT

			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb; // disable anisotropic filtering

		#else

			return texture2D( envMap, uv ).rgb;

		#endif

	}

	// These defines must match with PMREMGenerator

	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0

	float roughnessToMip( float roughness ) {

		float mip = 0.0;

		if ( roughness >= r1 ) {

			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;

		} else if ( roughness >= r4 ) {

			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;

		} else if ( roughness >= r5 ) {

			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;

		} else if ( roughness >= r6 ) {

			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;

		} else {

			mip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25
		}

		return mip;

	}

	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {

		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );

		float mipF = fract( mip );

		float mipInt = floor( mip );

		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );

		if ( mipF == 0.0 ) {

			return vec4( color0, 1.0 );

		} else {

			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );

			return vec4( mix( color0, color1, mipF ), 1.0 );

		}

	}

#endif
`;var VA=`
vec3 transformedNormal = objectNormal;

#ifdef USE_INSTANCING

	// this is in lieu of a per-instance normal-matrix
	// shear transforms in the instance matrix are not supported

	mat3 m = mat3( instanceMatrix );

	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );

	transformedNormal = m * transformedNormal;

#endif

transformedNormal = normalMatrix * transformedNormal;

#ifdef FLIP_SIDED

	transformedNormal = - transformedNormal;

#endif

#ifdef USE_TANGENT

	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;

	#ifdef FLIP_SIDED

		transformedTangent = - transformedTangent;

	#endif

#endif
`;var jA=`
#ifdef USE_DISPLACEMENTMAP

	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;

#endif
`;var qA=`
#ifdef USE_DISPLACEMENTMAP

	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );

#endif
`;var XA=`
#ifdef USE_EMISSIVEMAP

	vec4 emissiveColor = texture2D( emissiveMap, vUv );

	totalEmissiveRadiance *= emissiveColor.rgb;

#endif
`;var YA=`
#ifdef USE_EMISSIVEMAP

	uniform sampler2D emissiveMap;

#endif
`;var ZA=`
gl_FragColor = linearToOutputTexel( gl_FragColor );
`;var KA=`

vec4 LinearToLinear( in vec4 value ) {
	return value;
}

vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}

`;var QA=`
#ifdef USE_ENVMAP

	#ifdef ENV_WORLDPOS

		vec3 cameraToFrag;

		if ( isOrthographic ) {

			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );

		} else {

			cameraToFrag = normalize( vWorldPosition - cameraPosition );

		}

		// Transforming Normal Vectors with the Inverse Transformation
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

		#ifdef ENVMAP_MODE_REFLECTION

			vec3 reflectVec = reflect( cameraToFrag, worldNormal );

		#else

			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );

		#endif

	#else

		vec3 reflectVec = vReflect;

	#endif

	#ifdef ENVMAP_TYPE_CUBE

		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );

	#elif defined( ENVMAP_TYPE_CUBE_UV )

		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );

	#else

		vec4 envColor = vec4( 0.0 );

	#endif

	#ifdef ENVMAP_BLENDING_MULTIPLY

		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );

	#elif defined( ENVMAP_BLENDING_MIX )

		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );

	#elif defined( ENVMAP_BLENDING_ADD )

		outgoingLight += envColor.xyz * specularStrength * reflectivity;

	#endif

#endif
`;var JA=`
#ifdef USE_ENVMAP

	uniform float envMapIntensity;
	uniform float flipEnvMap;

	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif
`;var $A=`
#ifdef USE_ENVMAP

	uniform float reflectivity;

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )

		#define ENV_WORLDPOS

	#endif

	#ifdef ENV_WORLDPOS

		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif

#endif
`;var eP=`
#ifdef USE_ENVMAP

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )

		#define ENV_WORLDPOS

	#endif

	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;

	#else

		varying vec3 vReflect;
		uniform float refractionRatio;

	#endif

#endif
`;var tP=`
#ifdef USE_ENVMAP

	#ifdef ENV_WORLDPOS

		vWorldPosition = worldPosition.xyz;

	#else

		vec3 cameraToVertex;

		if ( isOrthographic ) {

			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );

		} else {

			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );

		}

		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );

		#ifdef ENVMAP_MODE_REFLECTION

			vReflect = reflect( cameraToVertex, worldNormal );

		#else

			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );

		#endif

	#endif

#endif
`;var iP=`
#ifdef USE_FOG

	vFogDepth = - mvPosition.z;

#endif
`;var rP=`
#ifdef USE_FOG

	varying float vFogDepth;

#endif
`;var nP=`
#ifdef USE_FOG

	#ifdef FOG_EXP2

		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );

	#else

		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );

	#endif

	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );

#endif
`;var sP=`
#ifdef USE_FOG

	uniform vec3 fogColor;
	varying float vFogDepth;

	#ifdef FOG_EXP2

		uniform float fogDensity;

	#else

		uniform float fogNear;
		uniform float fogFar;

	#endif

#endif
`;var oP=`

#ifdef USE_GRADIENTMAP

	uniform sampler2D gradientMap;

#endif

vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {

	// dotNL will be from -1.0 to 1.0
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );

	#ifdef USE_GRADIENTMAP

		return vec3( texture2D( gradientMap, coord ).r );

	#else

		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );

	#endif

}
`;var aP=`
#ifdef USE_LIGHTMAP

	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;

	reflectedLight.indirectDiffuse += lightMapIrradiance;

#endif
`;var lP=`
#ifdef USE_LIGHTMAP

	uniform sampler2D lightMap;
	uniform float lightMapIntensity;

#endif
`;var hP=`
vec3 diffuse = vec3( 1.0 );

GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );

GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;

vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif

IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;

vIndirectFront += getAmbientLightIrradiance( ambientLightColor );

vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );

#ifdef DOUBLE_SIDED

	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );

	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );

#endif

#if NUM_POINT_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		getPointLightInfo( pointLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

		#endif

	}
	#pragma unroll_loop_end

#endif

#if NUM_SPOT_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		getSpotLightInfo( spotLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

		#endif
	}
	#pragma unroll_loop_end

#endif

#if NUM_DIR_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );

		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;

		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

		#ifdef DOUBLE_SIDED

			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

		#endif

	}
	#pragma unroll_loop_end

#endif

#if NUM_HEMI_LIGHTS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );

		#ifdef DOUBLE_SIDED

			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );

		#endif

	}
	#pragma unroll_loop_end

#endif
`;var uP=`
uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];

// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere
// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {

	// normal is assumed to have unit length

	float x = normal.x, y = normal.y, z = normal.z;

	// band 0
	vec3 result = shCoefficients[ 0 ] * 0.886227;

	// band 1
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;

	// band 2
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );

	return result;

}

vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {

	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );

	return irradiance;

}

vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {

	vec3 irradiance = ambientLightColor;

	return irradiance;

}

float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {

	#if defined ( PHYSICALLY_CORRECT_LIGHTS )

		// based upon Frostbite 3 Moving to Physically-based Rendering
		// page 32, equation 26: E[window1]
		// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );

		if ( cutoffDistance > 0.0 ) {

			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );

		}

		return distanceFalloff;

	#else

		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {

			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );

		}

		return 1.0;

	#endif

}

float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {

	return smoothstep( coneCosine, penumbraCosine, angleCosine );

}

#if NUM_DIR_LIGHTS > 0

	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};

	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];

	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {

		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;

	}

#endif


#if NUM_POINT_LIGHTS > 0

	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};

	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];

	// light is an out parameter as having it as a return value caused compiler errors on some devices
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {

		vec3 lVector = pointLight.position - geometry.position;

		light.direction = normalize( lVector );

		float lightDistance = length( lVector );

		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );

	}

#endif


#if NUM_SPOT_LIGHTS > 0

	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};

	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];

	// light is an out parameter as having it as a return value caused compiler errors on some devices
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {

		vec3 lVector = spotLight.position - geometry.position;

		light.direction = normalize( lVector );

		float angleCos = dot( light.direction, spotLight.direction );

		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );

		if ( spotAttenuation > 0.0 ) {

			float lightDistance = length( lVector );

			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );

		} else {

			light.color = vec3( 0.0 );
			light.visible = false;

		}

	}

#endif


#if NUM_RECT_AREA_LIGHTS > 0

	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};

	// Pre-computed values of LinearTransformedCosine approximation of BRDF
	// BRDF approximation Texture is 64x64
	uniform sampler2D ltc_1; // RGBA Float
	uniform sampler2D ltc_2; // RGBA Float

	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];

#endif


#if NUM_HEMI_LIGHTS > 0

	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};

	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];

	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {

		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;

		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );

		return irradiance;

	}

#endif
`;var cP=`
#if defined( USE_ENVMAP )

	vec3 getIBLIrradiance( const in vec3 normal ) {

		#if defined( ENVMAP_TYPE_CUBE_UV )

			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );

			return PI * envMapColor.rgb * envMapIntensity;

		#else

			return vec3( 0.0 );

		#endif

	}

	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {

		#if defined( ENVMAP_TYPE_CUBE_UV )

			vec3 reflectVec = reflect( - viewDir, normal );

			// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );

			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );

			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );

			return envMapColor.rgb * envMapIntensity;

		#else

			return vec3( 0.0 );

		#endif

	}

#endif
`;var fP=`
ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
`;var dP=`
varying vec3 vViewPosition;

struct ToonMaterial {

	vec3 diffuseColor;

};

void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon

#define Material_LightProbeLOD( material )	(0)
`;var pP=`
BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;
`;var mP=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong

#define Material_LightProbeLOD( material )	(0)
`;var gP=`
PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );

vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );

material.roughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.
material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );

#ifdef IOR

	#ifdef SPECULAR

		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;

		#ifdef USE_SPECULARINTENSITYMAP

			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;

		#endif

		#ifdef USE_SPECULARCOLORMAP

			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;

		#endif

		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );

	#else

		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;

	#endif

	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );

#else

	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;

#endif

#ifdef USE_CLEARCOAT

	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;

	#ifdef USE_CLEARCOATMAP

		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;

	#endif

	#ifdef USE_CLEARCOAT_ROUGHNESSMAP

		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;

	#endif

	material.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model
	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );

#endif

#ifdef USE_SHEEN

	material.sheenColor = sheenColor;

	#ifdef USE_SHEENCOLORMAP

		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;

	#endif

	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );

	#ifdef USE_SHEENROUGHNESSMAP

		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;

	#endif

#endif
`;var vP=`
struct PhysicalMaterial {

	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;

	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif

	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif

};

// temporary
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );

// This is a curve-fit approxmation to the "Charlie sheen" BRDF integrated over the hemisphere from 
// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF". The analysis can be found
// in the Sheen section of https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {

	float dotNV = saturate( dot( normal, viewDir ) );

	float r2 = roughness * roughness;

	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;

	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;

	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );

	return saturate( DG * RECIPROCAL_PI );

}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {

	float dotNV = saturate( dot( normal, viewDir ) );

	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );

	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );

	vec4 r = roughness * c0 + c1;

	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;

	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;

	return fab;

}

vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {

	vec2 fab = DFGApprox( normal, viewDir, roughness );

	return specularColor * fab.x + specularF90 * fab.y;

}

// Fdez-Ag\xFCera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {

	vec2 fab = DFGApprox( normal, viewDir, roughness );

	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;

	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;

	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21
	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );

	singleScatter += FssEss;
	multiScatter += Fms * Ems;

}

#if NUM_RECT_AREA_LIGHTS > 0

	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;

		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction
		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;

		vec2 uv = LTC_Uv( normal, viewDir, roughness );

		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );

		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);

		// LTC Fresnel Approximation by Stephen Hill
		// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );

		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );

		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );

	}

#endif

void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );

	vec3 irradiance = dotNL * directLight.color;

	#ifdef USE_CLEARCOAT

		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );

		vec3 ccIrradiance = dotNLcc * directLight.color;

		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );

	#endif

	#ifdef USE_SHEEN

		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );

	#endif

	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );


	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {

	#ifdef USE_CLEARCOAT

		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );

	#endif

	#ifdef USE_SHEEN

		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );

	#endif

	// Both indirect specular and indirect diffuse light accumulate here

	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;

	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );

	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );

	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;

	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;

}

#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical

// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {

	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );

}
`;var _P=`
/**
 * This is a template that can be used to light a material, it uses pluggable
 * RenderEquations (RE)for specific lighting scenarios.
 *
 * Instructions for use:
 * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined
 * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???
 * - Create a material parameter that is to be passed as the third parameter to your lighting functions.
 *
 * TODO:
 * - Add area light support.
 * - Add sphere light support.
 * - Add diffuse light probe (irradiance cubemap) support.
 */

GeometricContext geometry;

geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

#ifdef USE_CLEARCOAT

	geometry.clearcoatNormal = clearcoatNormal;

#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`;var yP=`
#if defined( RE_IndirectDiffuse )

	#ifdef USE_LIGHTMAP

		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;

		irradiance += lightMapIrradiance;

	#endif

	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )

		iblIrradiance += getIBLIrradiance( geometry.normal );

	#endif

#endif

#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )

	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );

	#ifdef USE_CLEARCOAT

		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );

	#endif

#endif
`;var xP=`
#if defined( RE_IndirectDiffuse )

	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );

#endif

#if defined( RE_IndirectSpecular )

	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );

#endif
`;var bP=`
#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )

	// Doing a strict comparison with == 1.0 can cause noise artifacts
	// on some platforms. See issue #17623.
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;

#endif
`;var wP=`
#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )

	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;

#endif
`;var SP=`
#ifdef USE_LOGDEPTHBUF

	#ifdef USE_LOGDEPTHBUF_EXT

		varying float vFragDepth;
		varying float vIsPerspective;

	#else

		uniform float logDepthBufFC;

	#endif

#endif
`;var CP=`
#ifdef USE_LOGDEPTHBUF

	#ifdef USE_LOGDEPTHBUF_EXT

		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );

	#else

		if ( isPerspectiveMatrix( projectionMatrix ) ) {

			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;

			gl_Position.z *= gl_Position.w;

		}

	#endif

#endif
`;var MP=`
#ifdef USE_MAP

	vec4 sampledDiffuseColor = texture2D( map, vUv );

	#ifdef DECODE_VIDEO_TEXTURE

		// inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)

		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );

	#endif

	diffuseColor *= sampledDiffuseColor;

#endif
`;var EP=`
#ifdef USE_MAP

	uniform sampler2D map;

#endif
`;var TP=`
#if defined( USE_MAP ) || defined( USE_ALPHAMAP )

	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;

#endif

#ifdef USE_MAP

	diffuseColor *= texture2D( map, uv );

#endif

#ifdef USE_ALPHAMAP

	diffuseColor.a *= texture2D( alphaMap, uv ).g;

#endif
`;var AP=`
#if defined( USE_MAP ) || defined( USE_ALPHAMAP )

	uniform mat3 uvTransform;

#endif

#ifdef USE_MAP

	uniform sampler2D map;

#endif

#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`;var PP=`
float metalnessFactor = metalness;

#ifdef USE_METALNESSMAP

	vec4 texelMetalness = texture2D( metalnessMap, vUv );

	// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	metalnessFactor *= texelMetalness.b;

#endif
`;var RP=`
#ifdef USE_METALNESSMAP

	uniform sampler2D metalnessMap;

#endif
`;var LP=`
#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	vColor *= morphTargetBaseInfluence;

	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

		#if defined( USE_COLOR_ALPHA )

			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];

		#elif defined( USE_COLOR )

			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];

		#endif

	}

#endif
`;var OP=`
#ifdef USE_MORPHNORMALS

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	objectNormal *= morphTargetBaseInfluence;

	#ifdef MORPHTARGETS_TEXTURE

		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];

		}

	#else

		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];

	#endif

#endif
`;var DP=`
#ifdef USE_MORPHTARGETS

	uniform float morphTargetBaseInfluence;

	#ifdef MORPHTARGETS_TEXTURE

		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;

		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {

			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;

			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );

		}

	#else

		#ifndef USE_MORPHNORMALS

			uniform float morphTargetInfluences[ 8 ];

		#else

			uniform float morphTargetInfluences[ 4 ];

		#endif

	#endif

#endif
`;var IP=`
#ifdef USE_MORPHTARGETS

	// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:
	// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)
	// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting
	transformed *= morphTargetBaseInfluence;

	#ifdef MORPHTARGETS_TEXTURE

		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {

			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];

		}

	#else

		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];

		#ifndef USE_MORPHNORMALS

			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];

		#endif

	#endif

#endif
`;var kP=`
float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;

#ifdef FLAT_SHADED

	// Workaround for Adreno GPUs not able to do dFdx( vViewPosition )

	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );

#else

	vec3 normal = normalize( vNormal );

	#ifdef DOUBLE_SIDED

		normal = normal * faceDirection;

	#endif

	#ifdef USE_TANGENT

		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );

		#ifdef DOUBLE_SIDED

			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;

		#endif

		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )

			mat3 vTBN = mat3( tangent, bitangent, normal );

		#endif

	#endif

#endif

// non perturbed normal for clearcoat among others

vec3 geometryNormal = normal;

`;var FP=`

#ifdef OBJECTSPACE_NORMALMAP

	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals

	#ifdef FLIP_SIDED

		normal = - normal;

	#endif

	#ifdef DOUBLE_SIDED

		normal = normal * faceDirection;

	#endif

	normal = normalize( normalMatrix * normal );

#elif defined( TANGENTSPACE_NORMALMAP )

	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;

	#ifdef USE_TANGENT

		normal = normalize( vTBN * mapN );

	#else

		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );

	#endif

#elif defined( USE_BUMPMAP )

	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );

#endif
`;var BP=`
#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif
`;var NP=`
#ifndef FLAT_SHADED

	varying vec3 vNormal;

	#ifdef USE_TANGENT

		varying vec3 vTangent;
		varying vec3 vBitangent;

	#endif

#endif
`;var UP=`
#ifndef FLAT_SHADED // normal is computed with derivatives when FLAT_SHADED

	vNormal = normalize( transformedNormal );

	#ifdef USE_TANGENT

		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );

	#endif

#endif
`;var GP=`
#ifdef USE_NORMALMAP

	uniform sampler2D normalMap;
	uniform vec2 normalScale;

#endif

#ifdef OBJECTSPACE_NORMALMAP

	uniform mat3 normalMatrix;

#endif

#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )

	// Normal Mapping Without Precomputed Tangents
	// http://www.thetenthplanet.de/archives/1180

	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {

		// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );

		vec3 N = surf_norm; // normalized

		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );

		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;

		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );

		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );

	}

#endif
`;var zP=`
#ifdef USE_CLEARCOAT

	vec3 clearcoatNormal = geometryNormal;

#endif
`;var HP=`
#ifdef USE_CLEARCOAT_NORMALMAP

	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;

	#ifdef USE_TANGENT

		clearcoatNormal = normalize( vTBN * clearcoatMapN );

	#else

		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );

	#endif

#endif
`;var WP=`

#ifdef USE_CLEARCOATMAP

	uniform sampler2D clearcoatMap;

#endif

#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform sampler2D clearcoatRoughnessMap;

#endif

#ifdef USE_CLEARCOAT_NORMALMAP

	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;

#endif
`;var VP=`
#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif

// https://github.com/mrdoob/three.js/pull/22425
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif

gl_FragColor = vec4( outgoingLight, diffuseColor.a );
`;var jP=`
vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}

vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}

const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)

const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

const float ShiftRight8 = 1. / 256.;

vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8; // tidy overflow
	return r * PackUpscale;
}

float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}

vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}

vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}

// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions

float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}

// NOTE: https://twitter.com/gonnavis/status/1377183786949959682

float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}
`;var qP=`
#ifdef PREMULTIPLIED_ALPHA

	// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.
	gl_FragColor.rgb *= gl_FragColor.a;

#endif
`;var XP=`
vec4 mvPosition = vec4( transformed, 1.0 );

#ifdef USE_INSTANCING

	mvPosition = instanceMatrix * mvPosition;

#endif

mvPosition = modelViewMatrix * mvPosition;

gl_Position = projectionMatrix * mvPosition;
`;var YP=`
#ifdef DITHERING

	gl_FragColor.rgb = dithering( gl_FragColor.rgb );

#endif
`;var ZP=`
#ifdef DITHERING

	// based on https://www.shadertoy.com/view/MslGR8
	vec3 dithering( vec3 color ) {
		//Calculate grid position
		float grid_position = rand( gl_FragCoord.xy );

		//Shift the individual colors differently, thus making it even harder to see the dithering pattern
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );

		//modify shift according to grid position.
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );

		//shift the color by dither_shift
		return color + dither_shift_RGB;
	}

#endif
`;var KP=`
float roughnessFactor = roughness;

#ifdef USE_ROUGHNESSMAP

	vec4 texelRoughness = texture2D( roughnessMap, vUv );

	// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	roughnessFactor *= texelRoughness.g;

#endif
`;var QP=`
#ifdef USE_ROUGHNESSMAP

	uniform sampler2D roughnessMap;

#endif
`;var JP=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];

		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};

		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): create uniforms for area light shadows

	#endif
	*/

	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

	}

	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

		return unpackRGBATo2Half( texture2D( shadow, uv ) );

	}

	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

		float occlusion = 1.0;

		vec2 distribution = texture2DDistribution( shadow, uv );

		float hard_shadow = step( compare , distribution.x ); // Hard Shadow

		if (hard_shadow != 1.0 ) {

			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

		}
		return occlusion;

	}

	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

		float shadow = 1.0;

		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;

		// if ( something && something ) breaks ATI OpenGL shader compiler
		// if ( all( something, something ) ) using this instead

		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );

		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

		bool frustumTest = all( frustumTestVec );

		if ( frustumTest ) {

		#if defined( SHADOWMAP_TYPE_PCF )

			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;

			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;

			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );

		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )

			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;

			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;

			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );

		#elif defined( SHADOWMAP_TYPE_VSM )

			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

		#else // no percentage-closer filtering:

			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

		#endif

		}

		return shadow;

	}

	// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
	// vector suitable for 2D texture mapping. This code uses the following layout for the
	// 2D texture:
	//
	// xzXZ
	//  y Y
	//
	// Y - Positive y direction
	// y - Negative y direction
	// X - Positive x direction
	// x - Negative x direction
	// Z - Positive z direction
	// z - Negative z direction
	//
	// Source and test bed:
	// https://gist.github.com/tschw/da10c43c467ce8afd0c4

	vec2 cubeToUV( vec3 v, float texelSizeY ) {

		// Number of texels to avoid at the edge of each square

		vec3 absV = abs( v );

		// Intersect unit cube

		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;

		// Apply scale to avoid seams

		// two texels less per square (one texel will do for NEAREST)
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

		// Unwrap

		// space: -1 ... 1 range for each square
		//
		// #X##		dim    := ( 4 , 2 )
		//  # #		center := ( 1 , 1 )

		vec2 planar = v.xy;

		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;

		if ( absV.z >= almostOne ) {

			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;

		} else if ( absV.x >= almostOne ) {

			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;

		} else if ( absV.y >= almostOne ) {

			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;

		}

		// Transform to UV space

		// scale := 0.5 / dim
		// translate := ( center + 0.5 ) / dim
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

	}

	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

		// for point lights, the uniform @vShadowCoord is re-purposed to hold
		// the vector from the light to the world-space position of the fragment.
		vec3 lightToPosition = shadowCoord.xyz;

		// dp = normalized distance from light to fragment position
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
		dp += shadowBias;

		// bd3D = base direction 3D
		vec3 bd3D = normalize( lightToPosition );

		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )

			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;

			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );

		#else // no percentage-closer filtering

			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );

		#endif

	}

#endif
`;var $P=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];

		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};

		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};

		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): uniforms for area light shadows

	#endif
	*/

#endif
`;var e2=`
#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0

		// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;

	#endif

	#if NUM_DIR_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {

		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {

		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {

		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;

	}
	#pragma unroll_loop_end

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): update vAreaShadowCoord with area light info

	#endif
	*/

#endif
`;var t2=`
float getShadowMask() {

	float shadow = 1.0;

	#ifdef USE_SHADOWMAP

	#if NUM_DIR_LIGHT_SHADOWS > 0

	DirectionalLightShadow directionalLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {

		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_SPOT_LIGHT_SHADOWS > 0

	SpotLightShadow spotLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {

		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	#if NUM_POINT_LIGHT_SHADOWS > 0

	PointLightShadow pointLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {

		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;

	}
	#pragma unroll_loop_end

	#endif

	/*
	#if NUM_RECT_AREA_LIGHTS > 0

		// TODO (abelnation): update shadow for Area light

	#endif
	*/

	#endif

	return shadow;

}
`;var i2=`
#ifdef USE_SKINNING

	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );

#endif
`;var r2=`
#ifdef USE_SKINNING

	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;

	#ifdef BONE_TEXTURE

		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;

		mat4 getBoneMatrix( const in float i ) {

			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );

			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );

			y = dy * ( y + 0.5 );

			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );

			mat4 bone = mat4( v1, v2, v3, v4 );

			return bone;

		}

	#else

		uniform mat4 boneMatrices[ MAX_BONES ];

		mat4 getBoneMatrix( const in float i ) {

			mat4 bone = boneMatrices[ int(i) ];
			return bone;

		}

	#endif

#endif
`;var n2=`
#ifdef USE_SKINNING

	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );

	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;

	transformed = ( bindMatrixInverse * skinned ).xyz;

#endif
`;var s2=`
#ifdef USE_SKINNING

	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;

	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;

	#ifdef USE_TANGENT

		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;

	#endif

#endif
`;var o2=`
float specularStrength;

#ifdef USE_SPECULARMAP

	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;

#else

	specularStrength = 1.0;

#endif
`;var a2=`
#ifdef USE_SPECULARMAP

	uniform sampler2D specularMap;

#endif
`;var l2=`
#if defined( TONE_MAPPING )

	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );

#endif
`;var h2=`
#ifndef saturate
// <common> may have defined saturate() already
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif

uniform float toneMappingExposure;

// exposure only
vec3 LinearToneMapping( vec3 color ) {

	return toneMappingExposure * color;

}

// source: https://www.cs.utah.edu/docs/techreports/2002/pdf/UUCS-02-001.pdf
vec3 ReinhardToneMapping( vec3 color ) {

	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );

}

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
vec3 OptimizedCineonToneMapping( vec3 color ) {

	// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );

}

// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs
vec3 RRTAndODTFit( vec3 v ) {

	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;

}

// this implementation of ACES is modified to accommodate a brighter viewing environment.
// the scale factor of 1/0.6 is subjective. see discussion in #19621.

vec3 ACESFilmicToneMapping( vec3 color ) {

	// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ), // transposed from source
		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);

	// ODT_SAT => XYZ => D60_2_D65 => sRGB
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ), // transposed from source
		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);

	color *= toneMappingExposure / 0.6;

	color = ACESInputMat * color;

	// Apply RRT and ODT
	color = RRTAndODTFit( color );

	color = ACESOutputMat * color;

	// Clamp to [0, 1]
	return saturate( color );

}

vec3 CustomToneMapping( vec3 color ) { return color; }
`;var u2=`
#ifdef USE_TRANSMISSION

	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;

	#ifdef USE_TRANSMISSIONMAP

		transmissionFactor *= texture2D( transmissionMap, vUv ).r;

	#endif

	#ifdef USE_THICKNESSMAP

		thicknessFactor *= texture2D( thicknessMap, vUv ).g;

	#endif

	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );

	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );

	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif
`;var c2=`
#ifdef USE_TRANSMISSION

	// Transmission code is based on glTF-Sampler-Viewer
	// https://github.com/KhronosGroup/glTF-Sample-Viewer

	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;

	#ifdef USE_TRANSMISSIONMAP

		uniform sampler2D transmissionMap;

	#endif

	#ifdef USE_THICKNESSMAP

		uniform sampler2D thicknessMap;

	#endif

	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;

	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;

	varying vec3 vWorldPosition;

	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {

		// Direction of refracted light.
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );

		// Compute rotation-independant scaling of the model matrix.
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		// The thickness is specified in local space.
		return normalize( refractionVector ) * thickness * modelScale;

	}

	float applyIorToRoughness( const in float roughness, const in float ior ) {

		// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
		// an IOR of 1.5 results in the default amount of microfacet refraction.
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );

	}

	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {

		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );

		#ifdef texture2DLodEXT

			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );

		#else

			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );

		#endif

	}

	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {

		if ( attenuationDistance == 0.0 ) {

			// Attenuation distance is +\u221E (which we indicate by zero), i.e. the transmitted color is not attenuated at all.
			return radiance;

		} else {

			// Compute light attenuation using Beer's law.
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
			return transmittance * radiance;

		}

	}

	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {

		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;

		// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;

		// Sample framebuffer to get pixel the refracted ray hits.
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );

		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );

		// Get the specular component.
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );

		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );

	}
#endif
`;var f2=`
#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )

	varying vec2 vUv;

#endif
`;var d2=`
#ifdef USE_UV

	#ifdef UVS_VERTEX_ONLY

		vec2 vUv;

	#else

		varying vec2 vUv;

	#endif

	uniform mat3 uvTransform;

#endif
`;var p2=`
#ifdef USE_UV

	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;

#endif
`;var m2=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	varying vec2 vUv2;

#endif
`;var g2=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	attribute vec2 uv2;
	varying vec2 vUv2;

	uniform mat3 uv2Transform;

#endif
`;var v2=`
#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )

	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;

#endif
`;var _2=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )

	vec4 worldPosition = vec4( transformed, 1.0 );

	#ifdef USE_INSTANCING

		worldPosition = instanceMatrix * worldPosition;

	#endif

	worldPosition = modelMatrix * worldPosition;

#endif
`;var y2=`
varying vec2 vUv;
uniform mat3 uvTransform;

void main() {

	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;

	gl_Position = vec4( position.xy, 1.0, 1.0 );

}
`,x2=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

	gl_FragColor = texture2D( t2D, vUv );

	#ifdef DECODE_VIDEO_TEXTURE

		// inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)

		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );

	#endif

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`;var b2=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

	gl_Position.z = gl_Position.w; // set z to camera.far

}
`,w2=`
#include <envmap_common_pars_fragment>
uniform float opacity;

varying vec3 vWorldDirection;

#include <cube_uv_reflection_fragment>

void main() {

	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>

	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`;var S2=`
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.
// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for
// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.
varying vec2 vHighPrecisionZW;

void main() {

	#include <uv_vertex>

	#include <skinbase_vertex>

	#ifdef USE_DISPLACEMENTMAP

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vHighPrecisionZW = gl_Position.zw;

}
`,C2=`
#if DEPTH_PACKING == 3200

	uniform float opacity;

#endif

#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

varying vec2 vHighPrecisionZW;

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( 1.0 );

	#if DEPTH_PACKING == 3200

		diffuseColor.a = opacity;

	#endif

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	#include <logdepthbuf_fragment>

	// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;

	#if DEPTH_PACKING == 3200

		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );

	#elif DEPTH_PACKING == 3201

		gl_FragColor = packDepthToRGBA( fragCoordZ );

	#endif

}
`;var M2=`
#define DISTANCE

varying vec3 vWorldPosition;

#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	#include <skinbase_vertex>

	#ifdef USE_DISPLACEMENTMAP

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>

	vWorldPosition = worldPosition.xyz;

}
`,E2=`
#define DISTANCE

uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;

#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>

void main () {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( 1.0 );

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist ); // clamp to [ 0, 1 ]

	gl_FragColor = packDepthToRGBA( dist );

}
`;var T2=`
varying vec3 vWorldDirection;

#include <common>

void main() {

	vWorldDirection = transformDirection( position, modelMatrix );

	#include <begin_vertex>
	#include <project_vertex>

}
`,A2=`
uniform sampler2D tEquirect;

varying vec3 vWorldDirection;

#include <common>

void main() {

	vec3 direction = normalize( vWorldDirection );

	vec2 sampleUV = equirectUv( direction );

	gl_FragColor = texture2D( tEquirect, sampleUV );

	#include <tonemapping_fragment>
	#include <encodings_fragment>

}
`;var P2=`
uniform float scale;
attribute float lineDistance;

varying float vLineDistance;

#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	vLineDistance = scale * lineDistance;

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

}
`,R2=`
uniform vec3 diffuse;
uniform float opacity;

uniform float dashSize;
uniform float totalSize;

varying float vLineDistance;

#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	if ( mod( vLineDistance, totalSize ) > dashSize ) {

		discard;

	}

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <color_fragment>

	outgoingLight = diffuseColor.rgb; // simple shader

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`;var L2=`
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )

		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>

	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>

}
`,O2=`
uniform vec3 diffuse;
uniform float opacity;

#ifndef FLAT_SHADED

	varying vec3 vNormal;

#endif

#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>

	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

	// accumulation (baked indirect lighting only)
	#ifdef USE_LIGHTMAP

		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;

	#else

		reflectedLight.indirectDiffuse += vec3( 1.0 );

	#endif

	// modulation
	#include <aomap_fragment>

	reflectedLight.indirectDiffuse *= diffuseColor.rgb;

	vec3 outgoingLight = reflectedLight.indirectDiffuse;

	#include <envmap_fragment>

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var D2=`
#define LAMBERT

varying vec3 vLightFront;
varying vec3 vIndirectFront;

#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}
`,I2=`
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;

varying vec3 vLightFront;
varying vec3 vIndirectFront;

#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif


#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>

	// accumulation

	#ifdef DOUBLE_SIDED

		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;

	#else

		reflectedLight.indirectDiffuse += vIndirectFront;

	#endif

	#include <lightmap_fragment>

	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );

	#ifdef DOUBLE_SIDED

		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;

	#else

		reflectedLight.directDiffuse = vLightFront;

	#endif

	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();

	// modulation

	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

	#include <envmap_fragment>

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}
`;var k2=`
#define MATCAP

varying vec3 vViewPosition;

#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>

#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

	vViewPosition = - mvPosition.xyz;

}
`,F2=`
#define MATCAP

uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;

varying vec3 vViewPosition;

#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks

	#ifdef USE_MATCAP

		vec4 matcapColor = texture2D( matcap, uv );

	#else

		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 ); // default if matcap is missing

	#endif

	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var B2=`
#define NORMAL

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	varying vec3 vViewPosition;

#endif

#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	vViewPosition = - mvPosition.xyz;

#endif

}
`,N2=`
#define NORMAL

uniform float opacity;

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )

	varying vec3 vViewPosition;

#endif

#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>

	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );

	#ifdef OPAQUE

		gl_FragColor.a = 1.0;

	#endif

}
`;var U2=`
#define PHONG

varying vec3 vViewPosition;

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,G2=`
#define PHONG

uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;

	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var z2=`
#define STANDARD

varying vec3 vViewPosition;

#ifdef USE_TRANSMISSION

	varying vec3 vWorldPosition;

#endif

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

#ifdef USE_TRANSMISSION

	vWorldPosition = worldPosition.xyz;

#endif
}
`,H2=`
#define STANDARD

#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;

#ifdef IOR
	uniform float ior;
#endif

#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;

	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif

	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif

#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif

#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;

	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif

	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif

varying vec3 vViewPosition;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;

	#include <transmission_fragment>

	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;

	#ifdef USE_SHEEN

		// Sheen energy compensation approximation calculation can be found at the end of
		// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );

		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;

	#endif

	#ifdef USE_CLEARCOAT

		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );

		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );

		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;

	#endif

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var W2=`
#define TOON

varying vec3 vViewPosition;

#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

	vViewPosition = - mvPosition.xyz;

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,V2=`
#define TOON

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>

	// accumulation
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>

	// modulation
	#include <aomap_fragment>

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>

}
`;var j2=`
uniform float size;
uniform float scale;

#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>

	gl_PointSize = size;

	#ifdef USE_SIZEATTENUATION

		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );

	#endif

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>

}
`,q2=`
uniform vec3 diffuse;
uniform float opacity;

#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>

	outgoingLight = diffuseColor.rgb;

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>

}
`;var X2=`
#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>

void main() {

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>

	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>

}
`,Y2=`
uniform vec3 color;
uniform float opacity;

#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>

void main() {

	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );

	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>

}
`;var Z2=`
uniform float rotation;
uniform vec2 center;

#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

	#include <uv_vertex>

	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );

	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

	#ifndef USE_SIZEATTENUATION

		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) scale *= - mvPosition.z;

	#endif

	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;

	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;

	mvPosition.xy += rotatedPosition;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>

}
`,K2=`
uniform vec3 diffuse;
uniform float opacity;

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

	#include <clipping_planes_fragment>

	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );

	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	outgoingLight = diffuseColor.rgb;

	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>

}
`;var Dt={alphamap_fragment:CA,alphamap_pars_fragment:MA,alphatest_fragment:EA,alphatest_pars_fragment:TA,aomap_fragment:AA,aomap_pars_fragment:PA,begin_vertex:RA,beginnormal_vertex:LA,bsdfs:OA,bumpmap_pars_fragment:DA,clipping_planes_fragment:IA,clipping_planes_pars_fragment:kA,clipping_planes_pars_vertex:FA,clipping_planes_vertex:BA,color_fragment:NA,color_pars_fragment:UA,color_pars_vertex:GA,color_vertex:zA,common:HA,cube_uv_reflection_fragment:WA,defaultnormal_vertex:VA,displacementmap_pars_vertex:jA,displacementmap_vertex:qA,emissivemap_fragment:XA,emissivemap_pars_fragment:YA,encodings_fragment:ZA,encodings_pars_fragment:KA,envmap_fragment:QA,envmap_common_pars_fragment:JA,envmap_pars_fragment:$A,envmap_pars_vertex:eP,envmap_physical_pars_fragment:cP,envmap_vertex:tP,fog_vertex:iP,fog_pars_vertex:rP,fog_fragment:nP,fog_pars_fragment:sP,gradientmap_pars_fragment:oP,lightmap_fragment:aP,lightmap_pars_fragment:lP,lights_lambert_vertex:hP,lights_pars_begin:uP,lights_toon_fragment:fP,lights_toon_pars_fragment:dP,lights_phong_fragment:pP,lights_phong_pars_fragment:mP,lights_physical_fragment:gP,lights_physical_pars_fragment:vP,lights_fragment_begin:_P,lights_fragment_maps:yP,lights_fragment_end:xP,logdepthbuf_fragment:bP,logdepthbuf_pars_fragment:wP,logdepthbuf_pars_vertex:SP,logdepthbuf_vertex:CP,map_fragment:MP,map_pars_fragment:EP,map_particle_fragment:TP,map_particle_pars_fragment:AP,metalnessmap_fragment:PP,metalnessmap_pars_fragment:RP,morphcolor_vertex:LP,morphnormal_vertex:OP,morphtarget_pars_vertex:DP,morphtarget_vertex:IP,normal_fragment_begin:kP,normal_fragment_maps:FP,normal_pars_fragment:BP,normal_pars_vertex:NP,normal_vertex:UP,normalmap_pars_fragment:GP,clearcoat_normal_fragment_begin:zP,clearcoat_normal_fragment_maps:HP,clearcoat_pars_fragment:WP,output_fragment:VP,packing:jP,premultiplied_alpha_fragment:qP,project_vertex:XP,dithering_fragment:YP,dithering_pars_fragment:ZP,roughnessmap_fragment:KP,roughnessmap_pars_fragment:QP,shadowmap_pars_fragment:JP,shadowmap_pars_vertex:$P,shadowmap_vertex:e2,shadowmask_pars_fragment:t2,skinbase_vertex:i2,skinning_pars_vertex:r2,skinning_vertex:n2,skinnormal_vertex:s2,specularmap_fragment:o2,specularmap_pars_fragment:a2,tonemapping_fragment:l2,tonemapping_pars_fragment:h2,transmission_fragment:u2,transmission_pars_fragment:c2,uv_pars_fragment:f2,uv_pars_vertex:d2,uv_vertex:p2,uv2_pars_fragment:m2,uv2_pars_vertex:g2,uv2_vertex:v2,worldpos_vertex:_2,background_vert:y2,background_frag:x2,cube_vert:b2,cube_frag:w2,depth_vert:S2,depth_frag:C2,distanceRGBA_vert:M2,distanceRGBA_frag:E2,equirect_vert:T2,equirect_frag:A2,linedashed_vert:P2,linedashed_frag:R2,meshbasic_vert:L2,meshbasic_frag:O2,meshlambert_vert:D2,meshlambert_frag:I2,meshmatcap_vert:k2,meshmatcap_frag:F2,meshnormal_vert:B2,meshnormal_frag:N2,meshphong_vert:U2,meshphong_frag:G2,meshphysical_vert:z2,meshphysical_frag:H2,meshtoon_vert:W2,meshtoon_frag:V2,points_vert:j2,points_frag:q2,shadow_vert:X2,shadow_frag:Y2,sprite_vert:Z2,sprite_frag:K2};var Ge={common:{diffuse:{value:new $e(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new zi},uv2Transform:{value:new zi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ot(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $e(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $e(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new zi}},sprite:{diffuse:{value:new $e(16777215)},opacity:{value:1},center:{value:new ot(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new zi}}};var jr={basic:{uniforms:xr([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.fog]),vertexShader:Dt.meshbasic_vert,fragmentShader:Dt.meshbasic_frag},lambert:{uniforms:xr([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.fog,Ge.lights,{emissive:{value:new $e(0)}}]),vertexShader:Dt.meshlambert_vert,fragmentShader:Dt.meshlambert_frag},phong:{uniforms:xr([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.fog,Ge.lights,{emissive:{value:new $e(0)},specular:{value:new $e(1118481)},shininess:{value:30}}]),vertexShader:Dt.meshphong_vert,fragmentShader:Dt.meshphong_frag},standard:{uniforms:xr([Ge.common,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.roughnessmap,Ge.metalnessmap,Ge.fog,Ge.lights,{emissive:{value:new $e(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag},toon:{uniforms:xr([Ge.common,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.gradientmap,Ge.fog,Ge.lights,{emissive:{value:new $e(0)}}]),vertexShader:Dt.meshtoon_vert,fragmentShader:Dt.meshtoon_frag},matcap:{uniforms:xr([Ge.common,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.fog,{matcap:{value:null}}]),vertexShader:Dt.meshmatcap_vert,fragmentShader:Dt.meshmatcap_frag},points:{uniforms:xr([Ge.points,Ge.fog]),vertexShader:Dt.points_vert,fragmentShader:Dt.points_frag},dashed:{uniforms:xr([Ge.common,Ge.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Dt.linedashed_vert,fragmentShader:Dt.linedashed_frag},depth:{uniforms:xr([Ge.common,Ge.displacementmap]),vertexShader:Dt.depth_vert,fragmentShader:Dt.depth_frag},normal:{uniforms:xr([Ge.common,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,{opacity:{value:1}}]),vertexShader:Dt.meshnormal_vert,fragmentShader:Dt.meshnormal_frag},sprite:{uniforms:xr([Ge.sprite,Ge.fog]),vertexShader:Dt.sprite_vert,fragmentShader:Dt.sprite_frag},background:{uniforms:{uvTransform:{value:new zi},t2D:{value:null}},vertexShader:Dt.background_vert,fragmentShader:Dt.background_frag},cube:{uniforms:xr([Ge.envmap,{opacity:{value:1}}]),vertexShader:Dt.cube_vert,fragmentShader:Dt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Dt.equirect_vert,fragmentShader:Dt.equirect_frag},distanceRGBA:{uniforms:xr([Ge.common,Ge.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Dt.distanceRGBA_vert,fragmentShader:Dt.distanceRGBA_frag},shadow:{uniforms:xr([Ge.lights,Ge.fog,{color:{value:new $e(0)},opacity:{value:1}}]),vertexShader:Dt.shadow_vert,fragmentShader:Dt.shadow_frag}};jr.physical={uniforms:xr([jr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ot(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new $e(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ot},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new $e(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new $e(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag};function Q2(t,e,i,r,n,o){let a=new $e(0),l=n===!0?0:1,h,u,c=null,f=0,d=null;function m(g,p){let _=!1,x=p.isScene===!0?p.background:null;x&&x.isTexture&&(x=e.get(x));let b=t.xr,y=b.getSession&&b.getSession();y&&y.environmentBlendMode==="additive"&&(x=null),x===null?v(a,l):x&&x.isColor&&(v(x,1),_=!0),(t.autoClear||_)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),x&&(x.isCubeTexture||x.mapping===_a)?(u===void 0&&(u=new St(new En(1,1,1),new un({name:"BackgroundCubeMaterial",uniforms:Go(jr.cube.uniforms),vertexShader:jr.cube.vertexShader,fragmentShader:jr.cube.fragmentShader,side:Gi,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(w,S,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,(c!==x||f!==x.version||d!==t.toneMapping)&&(u.material.needsUpdate=!0,c=x,f=x.version,d=t.toneMapping),g.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(h===void 0&&(h=new St(new yr(2,2),new un({name:"BackgroundMaterial",uniforms:Go(jr.background.uniforms),vertexShader:jr.background.vertexShader,fragmentShader:jr.background.fragmentShader,side:Ei,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(h)),h.material.uniforms.t2D.value=x,x.matrixAutoUpdate===!0&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),(c!==x||f!==x.version||d!==t.toneMapping)&&(h.material.needsUpdate=!0,c=x,f=x.version,d=t.toneMapping),g.unshift(h,h.geometry,h.material,0,0,null))}function v(g,p){i.buffers.color.setClear(g.r,g.g,g.b,p,o)}return{getClearColor:function(){return a},setClearColor:function(g,p=1){a.set(g),l=p,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,v(a,l)},render:m}}function J2(t,e,i,r){let n=t.getParameter(t.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||o!==null,l={},h=p(null),u=h,c=!1;function f(O,P,L,I,k){let B=!1;if(a){let F=g(I,L,P);u!==F&&(u=F,m(u.object)),B=_(I,k),B&&x(I,k)}else{let F=P.wireframe===!0;(u.geometry!==I.id||u.program!==L.id||u.wireframe!==F)&&(u.geometry=I.id,u.program=L.id,u.wireframe=F,B=!0)}O.isInstancedMesh===!0&&(B=!0),k!==null&&i.update(k,t.ELEMENT_ARRAY_BUFFER),(B||c)&&(c=!1,E(O,P,L,I),k!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(k).buffer))}function d(){return r.isWebGL2?t.createVertexArray():o.createVertexArrayOES()}function m(O){return r.isWebGL2?t.bindVertexArray(O):o.bindVertexArrayOES(O)}function v(O){return r.isWebGL2?t.deleteVertexArray(O):o.deleteVertexArrayOES(O)}function g(O,P,L){let I=L.wireframe===!0,k=l[O.id];k===void 0&&(k={},l[O.id]=k);let B=k[P.id];B===void 0&&(B={},k[P.id]=B);let F=B[I];return F===void 0&&(F=p(d()),B[I]=F),F}function p(O){let P=[],L=[],I=[];for(let k=0;k<n;k++)P[k]=0,L[k]=0,I[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:L,attributeDivisors:I,object:O,attributes:{},index:null}}function _(O,P){let L=u.attributes,I=O.attributes,k=0;for(let B in I){let F=L[B],W=I[B];if(F===void 0||F.attribute!==W||F.data!==W.data)return!0;k++}return u.attributesNum!==k||u.index!==P}function x(O,P){let L={},I=O.attributes,k=0;for(let B in I){let F=I[B],W={};W.attribute=F,F.data&&(W.data=F.data),L[B]=W,k++}u.attributes=L,u.attributesNum=k,u.index=P}function b(){let O=u.newAttributes;for(let P=0,L=O.length;P<L;P++)O[P]=0}function y(O){w(O,0)}function w(O,P){let L=u.newAttributes,I=u.enabledAttributes,k=u.attributeDivisors;L[O]=1,I[O]===0&&(t.enableVertexAttribArray(O),I[O]=1),k[O]!==P&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](O,P),k[O]=P)}function S(){let O=u.newAttributes,P=u.enabledAttributes;for(let L=0,I=P.length;L<I;L++)P[L]!==O[L]&&(t.disableVertexAttribArray(L),P[L]=0)}function R(O,P,L,I,k,B){r.isWebGL2===!0&&(L===t.INT||L===t.UNSIGNED_INT)?t.vertexAttribIPointer(O,P,L,k,B):t.vertexAttribPointer(O,P,L,I,k,B)}function E(O,P,L,I){if(r.isWebGL2===!1&&(O.isInstancedMesh||I.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;b();let k=I.attributes,B=L.getAttributes(),F=P.defaultAttributeValues;for(let W in B){let V=B[W];if(V.location>=0){let N=k[W];if(N===void 0&&(W==="instanceMatrix"&&O.instanceMatrix&&(N=O.instanceMatrix),W==="instanceColor"&&O.instanceColor&&(N=O.instanceColor)),N!==void 0){let ne=N.normalized,ie=N.itemSize,Q=i.get(N);if(Q===void 0)continue;let K=Q.buffer,de=Q.type,re=Q.bytesPerElement;if(N.isInterleavedBufferAttribute){let Y=N.data,U=Y.stride,z=N.offset;if(Y.isInstancedInterleavedBuffer){for(let te=0;te<V.locationSize;te++)w(V.location+te,Y.meshPerAttribute);O.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=Y.meshPerAttribute*Y.count)}else for(let te=0;te<V.locationSize;te++)y(V.location+te);t.bindBuffer(t.ARRAY_BUFFER,K);for(let te=0;te<V.locationSize;te++)R(V.location+te,ie/V.locationSize,de,ne,U*re,(z+ie/V.locationSize*te)*re)}else{if(N.isInstancedBufferAttribute){for(let Y=0;Y<V.locationSize;Y++)w(V.location+Y,N.meshPerAttribute);O.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=N.meshPerAttribute*N.count)}else for(let Y=0;Y<V.locationSize;Y++)y(V.location+Y);t.bindBuffer(t.ARRAY_BUFFER,K);for(let Y=0;Y<V.locationSize;Y++)R(V.location+Y,ie/V.locationSize,de,ne,ie*re,ie/V.locationSize*Y*re)}}else if(F!==void 0){let ne=F[W];if(ne!==void 0)switch(ne.length){case 2:t.vertexAttrib2fv(V.location,ne);break;case 3:t.vertexAttrib3fv(V.location,ne);break;case 4:t.vertexAttrib4fv(V.location,ne);break;default:t.vertexAttrib1fv(V.location,ne)}}}}S()}function T(){M();for(let O in l){let P=l[O];for(let L in P){let I=P[L];for(let k in I)v(I[k].object),delete I[k];delete P[L]}delete l[O]}}function A(O){if(l[O.id]===void 0)return;let P=l[O.id];for(let L in P){let I=P[L];for(let k in I)v(I[k].object),delete I[k];delete P[L]}delete l[O.id]}function C(O){for(let P in l){let L=l[P];if(L[O.id]===void 0)continue;let I=L[O.id];for(let k in I)v(I[k].object),delete I[k];delete L[O.id]}}function M(){D(),c=!0,u!==h&&(u=h,m(u.object))}function D(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:f,reset:M,resetDefaultState:D,dispose:T,releaseStatesOfGeometry:A,releaseStatesOfProgram:C,initAttributes:b,enableAttribute:y,disableUnusedAttributes:S}}function $2(t,e,i,r){let n=r.isWebGL2,o;function a(u){o=u}function l(u,c){t.drawArrays(o,u,c),i.update(c,o,1)}function h(u,c,f){if(f===0)return;let d,m;if(n)d=t,m="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[m](o,u,c,f),i.update(c,o,f)}this.setMode=a,this.render=l,this.renderInstances=h}function eR(t,e,i){let r;function n(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){let R=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(R){if(R==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";R="mediump"}return R==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&t instanceof WebGL2ComputeRenderingContext,l=i.precision!==void 0?i.precision:"highp",h=o(l);h!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",h,"instead."),l=h);let u=a||e.has("WEBGL_draw_buffers"),c=i.logarithmicDepthBuffer===!0,f=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=t.getParameter(t.MAX_TEXTURE_SIZE),v=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),g=t.getParameter(t.MAX_VERTEX_ATTRIBS),p=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),_=t.getParameter(t.MAX_VARYING_VECTORS),x=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),b=d>0,y=a||e.has("OES_texture_float"),w=b&&y,S=a?t.getParameter(t.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:n,getMaxPrecision:o,precision:l,logarithmicDepthBuffer:c,maxTextures:f,maxVertexTextures:d,maxTextureSize:m,maxCubemapSize:v,maxAttributes:g,maxVertexUniforms:p,maxVaryings:_,maxFragmentUniforms:x,vertexTextures:b,floatFragmentTextures:y,floatVertexTextures:w,maxSamples:S}}function tR(t){let e=this,i=null,r=0,n=!1,o=!1,a=new Xn,l=new zi,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(f,d,m){let v=f.length!==0||d||r!==0||n;return n=d,i=c(f,m,0),r=f.length,v},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1,u()},this.setState=function(f,d,m){let v=f.clippingPlanes,g=f.clipIntersection,p=f.clipShadows,_=t.get(f);if(!n||v===null||v.length===0||o&&!p)o?c(null):u();else{let x=o?0:r,b=x*4,y=_.clippingState||null;h.value=y,y=c(v,d,b,m);for(let w=0;w!==b;++w)y[w]=i[w];_.clippingState=y,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=x}};function u(){h.value!==i&&(h.value=i,h.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(f,d,m,v){let g=f!==null?f.length:0,p=null;if(g!==0){if(p=h.value,v!==!0||p===null){let _=m+g*4,x=d.matrixWorldInverse;l.getNormalMatrix(x),(p===null||p.length<_)&&(p=new Float32Array(_));for(let b=0,y=m;b!==g;++b,y+=4)a.copy(f[b]).applyMatrix4(x,l),a.normal.toArray(p,y),p[y+3]=a.constant}h.value=p,h.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,p}}var Vo=class extends Xt{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new gt,this.projectionMatrix=new gt,this.projectionMatrixInverse=new gt}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return e.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};Vo.prototype.isCamera=!0;var Vi=class extends Vo{constructor(e=50,i=1,r=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let i=.5*this.getFilmHeight()/e;this.fov=Jy*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Am*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Jy*2*Math.atan(Math.tan(Am*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,i,r,n,o,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,i=e*Math.tan(Am*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,o=-.5*n,a=this.view;if(this.view!==null&&this.view.enabled){let h=a.fullWidth,u=a.fullHeight;o+=a.offsetX*n/h,i-=a.offsetY*r/u,n*=a.width/h,r*=a.height/u}let l=this.filmOffset;l!==0&&(o+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+n,i,i-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}};Vi.prototype.isPerspectiveCamera=!0;var kh=90,Fh=1,Qm=class extends Xt{constructor(e,i,r){if(super(),this.type="CubeCamera",r.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=r;let n=new Vi(kh,Fh,e,i);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new q(1,0,0)),this.add(n);let o=new Vi(kh,Fh,e,i);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new q(-1,0,0)),this.add(o);let a=new Vi(kh,Fh,e,i);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new q(0,1,0)),this.add(a);let l=new Vi(kh,Fh,e,i);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new q(0,-1,0)),this.add(l);let h=new Vi(kh,Fh,e,i);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new q(0,0,1)),this.add(h);let u=new Vi(kh,Fh,e,i);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new q(0,0,-1)),this.add(u)}update(e,i){this.parent===null&&this.updateMatrixWorld();let r=this.renderTarget,[n,o,a,l,h,u]=this.children,c=e.getRenderTarget(),f=e.outputEncoding,d=e.toneMapping,m=e.xr.enabled;e.outputEncoding=Vr,e.toneMapping=ln,e.xr.enabled=!1;let v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(i,n),e.setRenderTarget(r,1),e.render(i,o),e.setRenderTarget(r,2),e.render(i,a),e.setRenderTarget(r,3),e.render(i,l),e.setRenderTarget(r,4),e.render(i,h),r.texture.generateMipmaps=v,e.setRenderTarget(r,5),e.render(i,u),e.setRenderTarget(c),e.outputEncoding=f,e.toneMapping=d,e.xr.enabled=m,r.texture.needsPMREMUpdate=!0}};var Sl=class extends vi{constructor(e,i,r,n,o,a,l,h,u,c){e=e!==void 0?e:[],i=i!==void 0?i:bs,super(e,i,r,n,o,a,l,h,u,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};Sl.prototype.isCubeTexture=!0;var Bc=class extends Tr{constructor(e,i={}){super(e,e,i);let r={width:e,height:e,depth:1},n=[r,r,r,r,r,r];this.texture=new Sl(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:$i}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.encoding=i.encoding,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;let r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new En(5,5,5),o=new un({name:"CubemapFromEquirect",uniforms:Go(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Gi,blending:Vn});o.uniforms.tEquirect.value=i;let a=new St(n,o),l=i.minFilter;return i.minFilter===ya&&(i.minFilter=$i),new Qm(1,10,this).update(e,a),i.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,r,n){let o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,r,n);e.setRenderTarget(o)}};Bc.prototype.isWebGLCubeRenderTarget=!0;function iR(t){let e=new WeakMap;function i(a,l){return l===Sc?a.mapping=bs:l===Cc&&(a.mapping=eo),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let l=a.mapping;if(l===Sc||l===Cc)if(e.has(a)){let h=e.get(a).texture;return i(h,a.mapping)}else{let h=a.image;if(h&&h.height>0){let u=new Bc(h.height/2);return u.fromEquirectangularTexture(t,a),e.set(a,u),a.addEventListener("dispose",n),i(u.texture,a.mapping)}else return null}}return a}function n(a){let l=a.target;l.removeEventListener("dispose",n);let h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}var jo=class extends Vo{constructor(e=-1,i=1,r=1,n=-1,o=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=n,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,n,o,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,o=r-e,a=r+e,l=n+i,h=n-i;if(this.view!==null&&this.view.enabled){let u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=u*this.view.offsetX,a=o+u*this.view.width,l-=c*this.view.offsetY,h=l-c*this.view.height}this.projectionMatrix.makeOrthographic(o,a,l,h,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}};jo.prototype.isOrthographicCamera=!0;var Nh=4,rR=[.125,.215,.35,.446,.526,.582],Ml=20,wx=new jo,nR=new $e,Sx=null,Cl=(1+Math.sqrt(5))/2,Bh=1/Cl,sR=[new q(1,1,1),new q(-1,1,1),new q(1,1,-1),new q(-1,1,-1),new q(0,Cl,Bh),new q(0,Cl,-Bh),new q(Bh,0,Cl),new q(-Bh,0,Cl),new q(Cl,Bh,0),new q(-Cl,Bh,0)],Nc=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,r=.1,n=100){Sx=this._renderer.getRenderTarget(),this._setSize(256);let o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,r,n,o),i>0&&this._blur(o,0,0,i),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=lR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=aR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Sx),e.scissorTest=!1,Jm(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===bs||e.mapping===eo?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Sx=this._renderer.getRenderTarget();let r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize-32,r={magFilter:$i,minFilter:$i,generateMipmaps:!1,type:to,format:or,encoding:Vr,depthBuffer:!1},n=oR(e,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=oR(e,i,r);let{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Jz(o)),this._blurMaterial=$z(o,e,i)}return n}_compileMaterial(e){let i=new St(this._lodPlanes[0],e);this._renderer.compile(i,wx)}_sceneToCubeUV(e,i,r,n){let l=new Vi(90,1,i,r),h=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],c=this._renderer,f=c.autoClear,d=c.toneMapping;c.getClearColor(nR),c.toneMapping=ln,c.autoClear=!1;let m=new Wi({name:"PMREM.Background",side:Gi,depthWrite:!1,depthTest:!1}),v=new St(new En,m),g=!1,p=e.background;p?p.isColor&&(m.color.copy(p),e.background=null,g=!0):(m.color.copy(nR),g=!0);for(let _=0;_<6;_++){let x=_%3;x===0?(l.up.set(0,h[_],0),l.lookAt(u[_],0,0)):x===1?(l.up.set(0,0,h[_]),l.lookAt(0,u[_],0)):(l.up.set(0,h[_],0),l.lookAt(0,0,u[_]));let b=this._cubeSize;Jm(n,x*b,_>2?b:0,b,b),c.setRenderTarget(n),g&&c.render(v,l),c.render(e,l)}v.geometry.dispose(),v.material.dispose(),c.toneMapping=d,c.autoClear=f,e.background=p}_textureToCubeUV(e,i){let r=this._renderer,n=e.mapping===bs||e.mapping===eo;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=lR()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=aR());let o=n?this._cubemapMaterial:this._equirectMaterial,a=new St(this._lodPlanes[0],o),l=o.uniforms;l.envMap.value=e;let h=this._cubeSize;Jm(i,0,0,3*h,2*h),r.setRenderTarget(i),r.render(a,wx)}_applyPMREM(e){let i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){let o=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=sR[(n-1)%sR.length];this._blur(e,n-1,n,o,a)}i.autoClear=r}_blur(e,i,r,n,o){let a=this._pingPongRenderTarget;this._halfBlur(e,a,i,r,n,"latitudinal",o),this._halfBlur(a,e,r,r,n,"longitudinal",o)}_halfBlur(e,i,r,n,o,a,l){let h=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,f=new St(this._lodPlanes[n],u),d=u.uniforms,m=this._sizeLods[r]-1,v=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*Ml-1),g=o/v,p=isFinite(o)?1+Math.floor(c*g):Ml;p>Ml&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${p} samples when the maximum is set to ${Ml}`);let _=[],x=0;for(let R=0;R<Ml;++R){let E=R/g,T=Math.exp(-E*E/2);_.push(T),R===0?x+=T:R<p&&(x+=2*T)}for(let R=0;R<_.length;R++)_[R]=_[R]/x;d.envMap.value=e.texture,d.samples.value=p,d.weights.value=_,d.latitudinal.value=a==="latitudinal",l&&(d.poleAxis.value=l);let{_lodMax:b}=this;d.dTheta.value=v,d.mipInt.value=b-r;let y=this._sizeLods[n],w=3*y*(n>b-Nh?n-b+Nh:0),S=4*(this._cubeSize-y);Jm(i,w,S,3*y,2*y),h.setRenderTarget(i),h.render(f,wx)}};function Jz(t){let e=[],i=[],r=[],n=t,o=t-Nh+1+rR.length;for(let a=0;a<o;a++){let l=Math.pow(2,n);i.push(l);let h=1/l;a>t-Nh?h=rR[a-t+Nh-1]:a===0&&(h=0),r.push(h);let u=1/(l-1),c=-u/2,f=1+u/2,d=[c,c,f,c,f,f,c,c,f,f,c,f],m=6,v=6,g=3,p=2,_=1,x=new Float32Array(g*v*m),b=new Float32Array(p*v*m),y=new Float32Array(_*v*m);for(let S=0;S<m;S++){let R=S%3*2/3-1,E=S>2?0:-1,T=[R,E,0,R+2/3,E,0,R+2/3,E+1,0,R,E,0,R+2/3,E+1,0,R,E+1,0];x.set(T,g*v*S),b.set(d,p*v*S);let A=[S,S,S,S,S,S];y.set(A,_*v*S)}let w=new _t;w.setAttribute("position",new wt(x,g)),w.setAttribute("uv",new wt(b,p)),w.setAttribute("faceIndex",new wt(y,_)),e.push(w),n>Nh&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function oR(t,e,i){let r=new Tr(t,e,i);return r.texture.mapping=_a,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Jm(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function $z(t,e,i){let r=new Float32Array(Ml),n=new q(0,1,0);return new un({name:"SphericalGaussianBlur",defines:{n:Ml,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Cx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Vn,depthTest:!1,depthWrite:!1})}function aR(){return new un({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Cx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Vn,depthTest:!1,depthWrite:!1})}function lR(){return new un({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Cx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Vn,depthTest:!1,depthWrite:!1})}function Cx(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function hR(t){let e=new WeakMap,i=null;function r(l){if(l&&l.isTexture){let h=l.mapping,u=h===Sc||h===Cc,c=h===bs||h===eo;if(u||c)if(l.isRenderTargetTexture&&l.needsPMREMUpdate===!0){l.needsPMREMUpdate=!1;let f=e.get(l);return i===null&&(i=new Nc(t)),f=u?i.fromEquirectangular(l,f):i.fromCubemap(l,f),e.set(l,f),f.texture}else{if(e.has(l))return e.get(l).texture;{let f=l.image;if(u&&f&&f.height>0||c&&f&&n(f)){i===null&&(i=new Nc(t));let d=u?i.fromEquirectangular(l):i.fromCubemap(l);return e.set(l,d),l.addEventListener("dispose",o),d.texture}else return null}}}return l}function n(l){let h=0,u=6;for(let c=0;c<u;c++)l[c]!==void 0&&h++;return h===u}function o(l){let h=l.target;h.removeEventListener("dispose",o);let u=e.get(h);u!==void 0&&(e.delete(h),u.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function uR(t){let e={};function i(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function cR(t,e,i,r){let n={},o=new WeakMap;function a(f){let d=f.target;d.index!==null&&e.remove(d.index);for(let v in d.attributes)e.remove(d.attributes[v]);d.removeEventListener("dispose",a),delete n[d.id];let m=o.get(d);m&&(e.remove(m),o.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function l(f,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function h(f){let d=f.attributes;for(let v in d)e.update(d[v],t.ARRAY_BUFFER);let m=f.morphAttributes;for(let v in m){let g=m[v];for(let p=0,_=g.length;p<_;p++)e.update(g[p],t.ARRAY_BUFFER)}}function u(f){let d=[],m=f.index,v=f.attributes.position,g=0;if(m!==null){let x=m.array;g=m.version;for(let b=0,y=x.length;b<y;b+=3){let w=x[b+0],S=x[b+1],R=x[b+2];d.push(w,S,S,R,R,w)}}else{let x=v.array;g=v.version;for(let b=0,y=x.length/3-1;b<y;b+=3){let w=b+0,S=b+1,R=b+2;d.push(w,S,S,R,R,w)}}let p=new(Rm(d)?Ph:Ah)(d,1);p.version=g;let _=o.get(f);_&&e.remove(_),o.set(f,p)}function c(f){let d=o.get(f);if(d){let m=f.index;m!==null&&d.version<m.version&&u(f)}else u(f);return o.get(f)}return{get:l,update:h,getWireframeAttribute:c}}function fR(t,e,i,r){let n=r.isWebGL2,o;function a(d){o=d}let l,h;function u(d){l=d.type,h=d.bytesPerElement}function c(d,m){t.drawElements(o,m,l,d*h),i.update(m,o,1)}function f(d,m,v){if(v===0)return;let g,p;if(n)g=t,p="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),p="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[p](o,m,l,d*h,v),i.update(m,o,v)}this.setMode=a,this.setIndex=u,this.render=c,this.renderInstances=f}function dR(t){let e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,a,l){switch(i.calls++,a){case t.TRIANGLES:i.triangles+=l*(o/3);break;case t.LINES:i.lines+=l*(o/2);break;case t.LINE_STRIP:i.lines+=l*(o-1);break;case t.LINE_LOOP:i.lines+=l*o;break;case t.POINTS:i.points+=l*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:n,update:r}}function eH(t,e){return t[0]-e[0]}function tH(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Mx(t,e){let i=1,r=e.isInterleavedBufferAttribute?e.data.array:e.array;r instanceof Int8Array?i=127:r instanceof Int16Array?i=32767:r instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),t.divideScalar(i)}function pR(t,e,i){let r={},n=new Float32Array(8),o=new WeakMap,a=new jt,l=[];for(let u=0;u<8;u++)l[u]=[u,0];function h(u,c,f,d){let m=u.morphTargetInfluences;if(e.isWebGL2===!0){let v=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,g=v!==void 0?v.length:0,p=o.get(c);if(p===void 0||p.count!==g){let P=function(){D.dispose(),o.delete(c),c.removeEventListener("dispose",P)};p!==void 0&&p.texture.dispose();let b=c.morphAttributes.position!==void 0,y=c.morphAttributes.normal!==void 0,w=c.morphAttributes.color!==void 0,S=c.morphAttributes.position||[],R=c.morphAttributes.normal||[],E=c.morphAttributes.color||[],T=0;b===!0&&(T=1),y===!0&&(T=2),w===!0&&(T=3);let A=c.attributes.position.count*T,C=1;A>e.maxTextureSize&&(C=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);let M=new Float32Array(A*C*4*g),D=new yl(M,A,C,g);D.type=ws,D.needsUpdate=!0;let O=T*4;for(let L=0;L<g;L++){let I=S[L],k=R[L],B=E[L],F=A*C*4*L;for(let W=0;W<I.count;W++){let V=W*O;b===!0&&(a.fromBufferAttribute(I,W),I.normalized===!0&&Mx(a,I),M[F+V+0]=a.x,M[F+V+1]=a.y,M[F+V+2]=a.z,M[F+V+3]=0),y===!0&&(a.fromBufferAttribute(k,W),k.normalized===!0&&Mx(a,k),M[F+V+4]=a.x,M[F+V+5]=a.y,M[F+V+6]=a.z,M[F+V+7]=0),w===!0&&(a.fromBufferAttribute(B,W),B.normalized===!0&&Mx(a,B),M[F+V+8]=a.x,M[F+V+9]=a.y,M[F+V+10]=a.z,M[F+V+11]=B.itemSize===4?a.w:1)}}p={count:g,texture:D,size:new ot(A,C)},o.set(c,p),c.addEventListener("dispose",P)}let _=0;for(let b=0;b<m.length;b++)_+=m[b];let x=c.morphTargetsRelative?1:1-_;d.getUniforms().setValue(t,"morphTargetBaseInfluence",x),d.getUniforms().setValue(t,"morphTargetInfluences",m),d.getUniforms().setValue(t,"morphTargetsTexture",p.texture,i),d.getUniforms().setValue(t,"morphTargetsTextureSize",p.size)}else{let v=m===void 0?0:m.length,g=r[c.id];if(g===void 0||g.length!==v){g=[];for(let y=0;y<v;y++)g[y]=[y,0];r[c.id]=g}for(let y=0;y<v;y++){let w=g[y];w[0]=y,w[1]=m[y]}g.sort(tH);for(let y=0;y<8;y++)y<v&&g[y][1]?(l[y][0]=g[y][0],l[y][1]=g[y][1]):(l[y][0]=Number.MAX_SAFE_INTEGER,l[y][1]=0);l.sort(eH);let p=c.morphAttributes.position,_=c.morphAttributes.normal,x=0;for(let y=0;y<8;y++){let w=l[y],S=w[0],R=w[1];S!==Number.MAX_SAFE_INTEGER&&R?(p&&c.getAttribute("morphTarget"+y)!==p[S]&&c.setAttribute("morphTarget"+y,p[S]),_&&c.getAttribute("morphNormal"+y)!==_[S]&&c.setAttribute("morphNormal"+y,_[S]),n[y]=R,x+=R):(p&&c.hasAttribute("morphTarget"+y)===!0&&c.deleteAttribute("morphTarget"+y),_&&c.hasAttribute("morphNormal"+y)===!0&&c.deleteAttribute("morphNormal"+y),n[y]=0)}let b=c.morphTargetsRelative?1:1-x;d.getUniforms().setValue(t,"morphTargetBaseInfluence",b),d.getUniforms().setValue(t,"morphTargetInfluences",n)}}return{update:h}}function mR(t,e,i,r){let n=new WeakMap;function o(h){let u=r.render.frame,c=h.geometry,f=e.get(h,c);return n.get(f)!==u&&(e.update(f),n.set(f,u)),h.isInstancedMesh&&(h.hasEventListener("dispose",l)===!1&&h.addEventListener("dispose",l),i.update(h.instanceMatrix,t.ARRAY_BUFFER),h.instanceColor!==null&&i.update(h.instanceColor,t.ARRAY_BUFFER)),f}function a(){n=new WeakMap}function l(h){let u=h.target;u.removeEventListener("dispose",l),i.remove(u.instanceMatrix),u.instanceColor!==null&&i.remove(u.instanceColor)}return{update:o,dispose:a}}var wR=new vi,SR=new yl,CR=new Oc,MR=new Sl,gR=[],vR=[],_R=new Float32Array(16),yR=new Float32Array(9),xR=new Float32Array(4);function Uh(t,e,i){let r=t[0];if(r<=0||r>0)return t;let n=e*i,o=gR[n];if(o===void 0&&(o=new Float32Array(n),gR[n]=o),e!==0){r.toArray(o,0);for(let a=1,l=0;a!==e;++a)l+=i,t[a].toArray(o,l)}return o}function qr(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function Rr(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function $m(t,e){let i=vR[e];i===void 0&&(i=new Int32Array(e),vR[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function iH(t,e){let i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function rH(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(qr(i,e))return;t.uniform2fv(this.addr,e),Rr(i,e)}}function nH(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(qr(i,e))return;t.uniform3fv(this.addr,e),Rr(i,e)}}function sH(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(qr(i,e))return;t.uniform4fv(this.addr,e),Rr(i,e)}}function oH(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(qr(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Rr(i,e)}else{if(qr(i,r))return;xR.set(r),t.uniformMatrix2fv(this.addr,!1,xR),Rr(i,r)}}function aH(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(qr(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Rr(i,e)}else{if(qr(i,r))return;yR.set(r),t.uniformMatrix3fv(this.addr,!1,yR),Rr(i,r)}}function lH(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(qr(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Rr(i,e)}else{if(qr(i,r))return;_R.set(r),t.uniformMatrix4fv(this.addr,!1,_R),Rr(i,r)}}function hH(t,e){let i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function uH(t,e){let i=this.cache;qr(i,e)||(t.uniform2iv(this.addr,e),Rr(i,e))}function cH(t,e){let i=this.cache;qr(i,e)||(t.uniform3iv(this.addr,e),Rr(i,e))}function fH(t,e){let i=this.cache;qr(i,e)||(t.uniform4iv(this.addr,e),Rr(i,e))}function dH(t,e){let i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function pH(t,e){let i=this.cache;qr(i,e)||(t.uniform2uiv(this.addr,e),Rr(i,e))}function mH(t,e){let i=this.cache;qr(i,e)||(t.uniform3uiv(this.addr,e),Rr(i,e))}function gH(t,e){let i=this.cache;qr(i,e)||(t.uniform4uiv(this.addr,e),Rr(i,e))}function vH(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(e||wR,n)}function _H(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||CR,n)}function yH(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||MR,n)}function xH(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||SR,n)}function bH(t){switch(t){case 5126:return iH;case 35664:return rH;case 35665:return nH;case 35666:return sH;case 35674:return oH;case 35675:return aH;case 35676:return lH;case 5124:case 35670:return hH;case 35667:case 35671:return uH;case 35668:case 35672:return cH;case 35669:case 35673:return fH;case 5125:return dH;case 36294:return pH;case 36295:return mH;case 36296:return gH;case 35678:case 36198:case 36298:case 36306:case 35682:return vH;case 35679:case 36299:case 36307:return _H;case 35680:case 36300:case 36308:case 36293:return yH;case 36289:case 36303:case 36311:case 36292:return xH}}function wH(t,e){t.uniform1fv(this.addr,e)}function SH(t,e){let i=Uh(e,this.size,2);t.uniform2fv(this.addr,i)}function CH(t,e){let i=Uh(e,this.size,3);t.uniform3fv(this.addr,i)}function MH(t,e){let i=Uh(e,this.size,4);t.uniform4fv(this.addr,i)}function EH(t,e){let i=Uh(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function TH(t,e){let i=Uh(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function AH(t,e){let i=Uh(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function PH(t,e){t.uniform1iv(this.addr,e)}function RH(t,e){t.uniform2iv(this.addr,e)}function LH(t,e){t.uniform3iv(this.addr,e)}function OH(t,e){t.uniform4iv(this.addr,e)}function DH(t,e){t.uniform1uiv(this.addr,e)}function IH(t,e){t.uniform2uiv(this.addr,e)}function kH(t,e){t.uniform3uiv(this.addr,e)}function FH(t,e){t.uniform4uiv(this.addr,e)}function BH(t,e,i){let r=e.length,n=$m(i,r);t.uniform1iv(this.addr,n);for(let o=0;o!==r;++o)i.setTexture2D(e[o]||wR,n[o])}function NH(t,e,i){let r=e.length,n=$m(i,r);t.uniform1iv(this.addr,n);for(let o=0;o!==r;++o)i.setTexture3D(e[o]||CR,n[o])}function UH(t,e,i){let r=e.length,n=$m(i,r);t.uniform1iv(this.addr,n);for(let o=0;o!==r;++o)i.setTextureCube(e[o]||MR,n[o])}function GH(t,e,i){let r=e.length,n=$m(i,r);t.uniform1iv(this.addr,n);for(let o=0;o!==r;++o)i.setTexture2DArray(e[o]||SR,n[o])}function zH(t){switch(t){case 5126:return wH;case 35664:return SH;case 35665:return CH;case 35666:return MH;case 35674:return EH;case 35675:return TH;case 35676:return AH;case 5124:case 35670:return PH;case 35667:case 35671:return RH;case 35668:case 35672:return LH;case 35669:case 35673:return OH;case 5125:return DH;case 36294:return IH;case 36295:return kH;case 36296:return FH;case 35678:case 36198:case 36298:case 36306:case 35682:return BH;case 35679:case 36299:case 36307:return NH;case 35680:case 36300:case 36308:case 36293:return UH;case 36289:case 36303:case 36311:case 36292:return GH}}function HH(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=bH(e.type)}function ER(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=zH(e.type)}ER.prototype.updateCache=function(t){let e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Rr(e,t)};function TR(t){this.id=t,this.seq=[],this.map={}}TR.prototype.setValue=function(t,e,i){let r=this.seq;for(let n=0,o=r.length;n!==o;++n){let a=r[n];a.setValue(t,e[a.id],i)}};var Ex=/(\w+)(\])?(\[|\.)?/g;function bR(t,e){t.seq.push(e),t.map[e.id]=e}function WH(t,e,i){let r=t.name,n=r.length;for(Ex.lastIndex=0;;){let o=Ex.exec(r),a=Ex.lastIndex,l=o[1],h=o[2]==="]",u=o[3];if(h&&(l=l|0),u===void 0||u==="["&&a+2===n){bR(i,u===void 0?new HH(l,t,e):new ER(l,t,e));break}else{let f=i.map[l];f===void 0&&(f=new TR(l),bR(i,f)),i=f}}}function oo(t,e){this.seq=[],this.map={};let i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){let n=t.getActiveUniform(e,r),o=t.getUniformLocation(e,n.name);WH(n,o,this)}}oo.prototype.setValue=function(t,e,i,r){let n=this.map[e];n!==void 0&&n.setValue(t,i,r)};oo.prototype.setOptional=function(t,e,i){let r=e[i];r!==void 0&&this.setValue(t,i,r)};oo.upload=function(t,e,i,r){for(let n=0,o=e.length;n!==o;++n){let a=e[n],l=i[a.id];l.needsUpdate!==!1&&a.setValue(t,l.value,r)}};oo.seqWithValue=function(t,e){let i=[];for(let r=0,n=t.length;r!==n;++r){let o=t[r];o.id in e&&i.push(o)}return i};function Tx(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}var VH=0;function jH(t,e){let i=t.split(`
`),r=[],n=Math.max(e-6,0),o=Math.min(e+6,i.length);for(let a=n;a<o;a++)r.push(a+1+": "+i[a]);return r.join(`
`)}function qH(t){switch(t){case Vr:return["Linear","( value )"];case Qt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function AR(t,e,i){let r=t.getShaderParameter(e,t.COMPILE_STATUS),n=t.getShaderInfoLog(e).trim();if(r&&n==="")return"";let o=parseInt(/ERROR: 0:(\d+)/.exec(n)[1]);return i.toUpperCase()+`

`+n+`

`+jH(t.getShaderSource(e),o)}function XH(t,e){let i=qH(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function YH(t,e){let i;switch(e){case FT:i="Linear";break;case BT:i="Reinhard";break;case NT:i="OptimizedCineon";break;case UT:i="ACESFilmic";break;case GT:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ZH(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Uc).join(`
`)}function KH(t){let e=[];for(let i in t){let r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function QH(t,e){let i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){let o=t.getActiveAttrib(e,n),a=o.name,l=1;o.type===t.FLOAT_MAT2&&(l=2),o.type===t.FLOAT_MAT3&&(l=3),o.type===t.FLOAT_MAT4&&(l=4),i[a]={type:o.type,location:t.getAttribLocation(e,a),locationSize:l}}return i}function Uc(t){return t!==""}function PR(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function RR(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var JH=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ax(t){return t.replace(JH,$H)}function $H(t,e){let i=Dt[e];if(i===void 0)throw new Error("Can not resolve #include <"+e+">");return Ax(i)}var e6=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,t6=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function LR(t){return t.replace(t6,DR).replace(e6,i6)}function i6(t,e,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),DR(t,e,i,r)}function DR(t,e,i,r){let n="";for(let o=parseInt(e);o<parseInt(i);o++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return n}function OR(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function r6(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===ym?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===xm?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===_l&&(e="SHADOWMAP_TYPE_VSM"),e}function n6(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case bs:case eo:e="ENVMAP_TYPE_CUBE";break;case _a:e="ENVMAP_TYPE_CUBE_UV";break}return e}function s6(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case eo:e="ENVMAP_MODE_REFRACTION";break}return e}function o6(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case va:e="ENVMAP_BLENDING_MULTIPLY";break;case IT:e="ENVMAP_BLENDING_MIX";break;case kT:e="ENVMAP_BLENDING_ADD";break}return e}function a6(t){let e=t.envMapCubeUVHeight;if(e===null)return null;let i=Math.log2(e/32+1)+3,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function IR(t,e,i,r){let n=t.getContext(),o=i.defines,a=i.vertexShader,l=i.fragmentShader,h=r6(i),u=n6(i),c=s6(i),f=o6(i),d=a6(i),m=i.isWebGL2?"":ZH(i),v=KH(o),g=n.createProgram(),p,_,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(p=[v].filter(Uc).join(`
`),p.length>0&&(p+=`
`),_=[m,v].filter(Uc).join(`
`),_.length>0&&(_+=`
`)):(p=[OR(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Uc).join(`
`),_=[m,OR(i),"#define SHADER_NAME "+i.shaderName,v,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+c:"",i.envMap?"#define "+f:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==ln?"#define TONE_MAPPING":"",i.toneMapping!==ln?Dt.tonemapping_pars_fragment:"",i.toneMapping!==ln?YH("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Dt.encodings_pars_fragment,XH("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Uc).join(`
`)),a=Ax(a),a=PR(a,i),a=RR(a,i),l=Ax(l),l=PR(l,i),l=RR(l,i),a=LR(a),l=LR(l),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,p=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+p,_=["#define varying in",i.glslVersion===Qy?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Qy?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);let b=x+p+a,y=x+_+l,w=Tx(n,n.VERTEX_SHADER,b),S=Tx(n,n.FRAGMENT_SHADER,y);if(n.attachShader(g,w),n.attachShader(g,S),i.index0AttributeName!==void 0?n.bindAttribLocation(g,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g),t.debug.checkShaderErrors){let T=n.getProgramInfoLog(g).trim(),A=n.getShaderInfoLog(w).trim(),C=n.getShaderInfoLog(S).trim(),M=!0,D=!0;if(n.getProgramParameter(g,n.LINK_STATUS)===!1){M=!1;let O=AR(n,w,"vertex"),P=AR(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,n.VALIDATE_STATUS)+`

Program Info Log: `+T+`
`+O+`
`+P)}else T!==""?console.warn("THREE.WebGLProgram: Program Info Log:",T):(A===""||C==="")&&(D=!1);D&&(this.diagnostics={runnable:M,programLog:T,vertexShader:{log:A,prefix:p},fragmentShader:{log:C,prefix:_}})}n.deleteShader(w),n.deleteShader(S);let R;this.getUniforms=function(){return R===void 0&&(R=new oo(n,g)),R};let E;return this.getAttributes=function(){return E===void 0&&(E=QH(n,g)),E},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=VH++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=S,this}var l6=0,eg=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let i=e.vertexShader,r=e.fragmentShader,n=this._getShaderStage(i),o=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(o)===!1&&(a.add(o),o.usedTimes++),this}remove(e){let i=this.materialCache.get(e);for(let r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let i=this.materialCache;return i.has(e)===!1&&i.set(e,new Set),i.get(e)}_getShaderStage(e){let i=this.shaderCache;if(i.has(e)===!1){let r=new Px(e);i.set(e,r)}return i.get(e)}},Px=class{constructor(e){this.id=l6++,this.code=e,this.usedTimes=0}};function kR(t,e,i,r,n,o,a){let l=new Ca,h=new eg,u=[],c=n.isWebGL2,f=n.logarithmicDepthBuffer,d=n.floatVertexTextures,m=n.maxVertexUniforms,v=n.vertexTextures,g=n.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(C){let D=C.skeleton.bones;if(d)return 1024;{let P=Math.floor((m-20)/4),L=Math.min(P,D.length);return L<D.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+D.length+" bones. This GPU supports "+L+"."),0):L}}function x(C,M,D,O,P){let L=O.fog,I=P.geometry,k=C.isMeshStandardMaterial?O.environment:null,B=(C.isMeshStandardMaterial?i:e).get(C.envMap||k),F=B&&B.mapping===_a?B.image.height:null,W=p[C.type],V=P.isSkinnedMesh?_(P):0;C.precision!==null&&(g=n.getMaxPrecision(C.precision),g!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",g,"instead."));let N=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,ne=N!==void 0?N.length:0,ie=0;I.morphAttributes.position!==void 0&&(ie=1),I.morphAttributes.normal!==void 0&&(ie=2),I.morphAttributes.color!==void 0&&(ie=3);let Q,K,de,re;if(W){let ge=jr[W];Q=ge.vertexShader,K=ge.fragmentShader}else Q=C.vertexShader,K=C.fragmentShader,h.update(C),de=h.getVertexShaderID(C),re=h.getFragmentShaderID(C);let Y=t.getRenderTarget(),U=C.alphaTest>0,z=C.clearcoat>0;return{isWebGL2:c,shaderID:W,shaderName:C.type,vertexShader:Q,fragmentShader:K,defines:C.defines,customVertexShaderID:de,customFragmentShaderID:re,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:g,instancing:P.isInstancedMesh===!0,instancingColor:P.isInstancedMesh===!0&&P.instanceColor!==null,supportsVertexTextures:v,outputEncoding:Y===null?t.outputEncoding:Y.isXRRenderTarget===!0?Y.texture.encoding:Vr,map:!!C.map,matcap:!!C.matcap,envMap:!!B,envMapMode:B&&B.mapping,envMapCubeUVHeight:F,lightMap:!!C.lightMap,aoMap:!!C.aoMap,emissiveMap:!!C.emissiveMap,bumpMap:!!C.bumpMap,normalMap:!!C.normalMap,objectSpaceNormalMap:C.normalMapType===oA,tangentSpaceNormalMap:C.normalMapType===xh,decodeVideoTexture:!!C.map&&C.map.isVideoTexture===!0&&C.map.encoding===Qt,clearcoat:z,clearcoatMap:z&&!!C.clearcoatMap,clearcoatRoughnessMap:z&&!!C.clearcoatRoughnessMap,clearcoatNormalMap:z&&!!C.clearcoatNormalMap,displacementMap:!!C.displacementMap,roughnessMap:!!C.roughnessMap,metalnessMap:!!C.metalnessMap,specularMap:!!C.specularMap,specularIntensityMap:!!C.specularIntensityMap,specularColorMap:!!C.specularColorMap,opaque:C.transparent===!1&&C.blending===Do,alphaMap:!!C.alphaMap,alphaTest:U,gradientMap:!!C.gradientMap,sheen:C.sheen>0,sheenColorMap:!!C.sheenColorMap,sheenRoughnessMap:!!C.sheenRoughnessMap,transmission:C.transmission>0,transmissionMap:!!C.transmissionMap,thicknessMap:!!C.thicknessMap,combine:C.combine,vertexTangents:!!C.normalMap&&!!I.attributes.tangent,vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!I.attributes.color&&I.attributes.color.itemSize===4,vertexUvs:!!C.map||!!C.bumpMap||!!C.normalMap||!!C.specularMap||!!C.alphaMap||!!C.emissiveMap||!!C.roughnessMap||!!C.metalnessMap||!!C.clearcoatMap||!!C.clearcoatRoughnessMap||!!C.clearcoatNormalMap||!!C.displacementMap||!!C.transmissionMap||!!C.thicknessMap||!!C.specularIntensityMap||!!C.specularColorMap||!!C.sheenColorMap||!!C.sheenRoughnessMap,uvsVertexOnly:!(C.map||C.bumpMap||C.normalMap||C.specularMap||C.alphaMap||C.emissiveMap||C.roughnessMap||C.metalnessMap||C.clearcoatNormalMap||C.transmission>0||C.transmissionMap||C.thicknessMap||C.specularIntensityMap||C.specularColorMap||C.sheen>0||C.sheenColorMap||C.sheenRoughnessMap)&&!!C.displacementMap,fog:!!L,useFog:C.fog,fogExp2:L&&L.isFogExp2,flatShading:!!C.flatShading,sizeAttenuation:C.sizeAttenuation,logarithmicDepthBuffer:f,skinning:P.isSkinnedMesh===!0&&V>0,maxBones:V,useVertexTexture:d,morphTargets:I.morphAttributes.position!==void 0,morphNormals:I.morphAttributes.normal!==void 0,morphColors:I.morphAttributes.color!==void 0,morphTargetsCount:ne,morphTextureStride:ie,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:C.dithering,shadowMapEnabled:t.shadowMap.enabled&&D.length>0,shadowMapType:t.shadowMap.type,toneMapping:C.toneMapped?t.toneMapping:ln,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===qt,flipSided:C.side===Gi,depthPacking:C.depthPacking!==void 0?C.depthPacking:!1,index0AttributeName:C.index0AttributeName,extensionDerivatives:C.extensions&&C.extensions.derivatives,extensionFragDepth:C.extensions&&C.extensions.fragDepth,extensionDrawBuffers:C.extensions&&C.extensions.drawBuffers,extensionShaderTextureLOD:C.extensions&&C.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:C.customProgramCacheKey()}}function b(C){let M=[];if(C.shaderID?M.push(C.shaderID):(M.push(C.customVertexShaderID),M.push(C.customFragmentShaderID)),C.defines!==void 0)for(let D in C.defines)M.push(D),M.push(C.defines[D]);return C.isRawShaderMaterial===!1&&(y(M,C),w(M,C),M.push(t.outputEncoding)),M.push(C.customProgramCacheKey),M.join()}function y(C,M){C.push(M.precision),C.push(M.outputEncoding),C.push(M.envMapMode),C.push(M.envMapCubeUVHeight),C.push(M.combine),C.push(M.vertexUvs),C.push(M.fogExp2),C.push(M.sizeAttenuation),C.push(M.maxBones),C.push(M.morphTargetsCount),C.push(M.morphAttributeCount),C.push(M.numDirLights),C.push(M.numPointLights),C.push(M.numSpotLights),C.push(M.numHemiLights),C.push(M.numRectAreaLights),C.push(M.numDirLightShadows),C.push(M.numPointLightShadows),C.push(M.numSpotLightShadows),C.push(M.shadowMapType),C.push(M.toneMapping),C.push(M.numClippingPlanes),C.push(M.numClipIntersection)}function w(C,M){l.disableAll(),M.isWebGL2&&l.enable(0),M.supportsVertexTextures&&l.enable(1),M.instancing&&l.enable(2),M.instancingColor&&l.enable(3),M.map&&l.enable(4),M.matcap&&l.enable(5),M.envMap&&l.enable(6),M.lightMap&&l.enable(7),M.aoMap&&l.enable(8),M.emissiveMap&&l.enable(9),M.bumpMap&&l.enable(10),M.normalMap&&l.enable(11),M.objectSpaceNormalMap&&l.enable(12),M.tangentSpaceNormalMap&&l.enable(13),M.clearcoat&&l.enable(14),M.clearcoatMap&&l.enable(15),M.clearcoatRoughnessMap&&l.enable(16),M.clearcoatNormalMap&&l.enable(17),M.displacementMap&&l.enable(18),M.specularMap&&l.enable(19),M.roughnessMap&&l.enable(20),M.metalnessMap&&l.enable(21),M.gradientMap&&l.enable(22),M.alphaMap&&l.enable(23),M.alphaTest&&l.enable(24),M.vertexColors&&l.enable(25),M.vertexAlphas&&l.enable(26),M.vertexUvs&&l.enable(27),M.vertexTangents&&l.enable(28),M.uvsVertexOnly&&l.enable(29),M.fog&&l.enable(30),C.push(l.mask),l.disableAll(),M.useFog&&l.enable(0),M.flatShading&&l.enable(1),M.logarithmicDepthBuffer&&l.enable(2),M.skinning&&l.enable(3),M.useVertexTexture&&l.enable(4),M.morphTargets&&l.enable(5),M.morphNormals&&l.enable(6),M.morphColors&&l.enable(7),M.premultipliedAlpha&&l.enable(8),M.shadowMapEnabled&&l.enable(9),M.physicallyCorrectLights&&l.enable(10),M.doubleSided&&l.enable(11),M.flipSided&&l.enable(12),M.depthPacking&&l.enable(13),M.dithering&&l.enable(14),M.specularIntensityMap&&l.enable(15),M.specularColorMap&&l.enable(16),M.transmission&&l.enable(17),M.transmissionMap&&l.enable(18),M.thicknessMap&&l.enable(19),M.sheen&&l.enable(20),M.sheenColorMap&&l.enable(21),M.sheenRoughnessMap&&l.enable(22),M.decodeVideoTexture&&l.enable(23),M.opaque&&l.enable(24),C.push(l.mask)}function S(C){let M=p[C.type],D;if(M){let O=jr[M];D=Fc.clone(O.uniforms)}else D=C.uniforms;return D}function R(C,M){let D;for(let O=0,P=u.length;O<P;O++){let L=u[O];if(L.cacheKey===M){D=L,++D.usedTimes;break}}return D===void 0&&(D=new IR(t,M,C,o),u.push(D)),D}function E(C){if(--C.usedTimes===0){let M=u.indexOf(C);u[M]=u[u.length-1],u.pop(),C.destroy()}}function T(C){h.remove(C)}function A(){h.dispose()}return{getParameters:x,getProgramCacheKey:b,getUniforms:S,acquireProgram:R,releaseProgram:E,releaseShaderCache:T,programs:u,dispose:A}}function FR(){let t=new WeakMap;function e(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function i(o){t.delete(o)}function r(o,a,l){t.get(o)[a]=l}function n(){t=new WeakMap}return{get:e,remove:i,update:r,dispose:n}}function h6(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function BR(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function NR(){let t=[],e=0,i=[],r=[],n=[];function o(){e=0,i.length=0,r.length=0,n.length=0}function a(f,d,m,v,g,p){let _=t[e];return _===void 0?(_={id:f.id,object:f,geometry:d,material:m,groupOrder:v,renderOrder:f.renderOrder,z:g,group:p},t[e]=_):(_.id=f.id,_.object=f,_.geometry=d,_.material=m,_.groupOrder=v,_.renderOrder=f.renderOrder,_.z=g,_.group=p),e++,_}function l(f,d,m,v,g,p){let _=a(f,d,m,v,g,p);m.transmission>0?r.push(_):m.transparent===!0?n.push(_):i.push(_)}function h(f,d,m,v,g,p){let _=a(f,d,m,v,g,p);m.transmission>0?r.unshift(_):m.transparent===!0?n.unshift(_):i.unshift(_)}function u(f,d){i.length>1&&i.sort(f||h6),r.length>1&&r.sort(d||BR),n.length>1&&n.sort(d||BR)}function c(){for(let f=e,d=t.length;f<d;f++){let m=t[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:i,transmissive:r,transparent:n,init:o,push:l,unshift:h,finish:c,sort:u}}function UR(){let t=new WeakMap;function e(r,n){let o;return t.has(r)===!1?(o=new NR,t.set(r,[o])):n>=t.get(r).length?(o=new NR,t.get(r).push(o)):o=t.get(r)[n],o}function i(){t=new WeakMap}return{get:e,dispose:i}}function u6(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new q,color:new $e};break;case"SpotLight":i={position:new q,direction:new q,color:new $e,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new q,color:new $e,distance:0,decay:0};break;case"HemisphereLight":i={direction:new q,skyColor:new $e,groundColor:new $e};break;case"RectAreaLight":i={color:new $e,position:new q,halfWidth:new q,halfHeight:new q};break}return t[e.id]=i,i}}}function c6(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}var f6=0;function d6(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function GR(t,e){let i=new u6,r=c6(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let c=0;c<9;c++)n.probe.push(new q);let o=new q,a=new gt,l=new gt;function h(c,f){let d=0,m=0,v=0;for(let T=0;T<9;T++)n.probe[T].set(0,0,0);let g=0,p=0,_=0,x=0,b=0,y=0,w=0,S=0;c.sort(d6);let R=f!==!0?Math.PI:1;for(let T=0,A=c.length;T<A;T++){let C=c[T],M=C.color,D=C.intensity,O=C.distance,P=C.shadow&&C.shadow.map?C.shadow.map.texture:null;if(C.isAmbientLight)d+=M.r*D*R,m+=M.g*D*R,v+=M.b*D*R;else if(C.isLightProbe)for(let L=0;L<9;L++)n.probe[L].addScaledVector(C.sh.coefficients[L],D);else if(C.isDirectionalLight){let L=i.get(C);if(L.color.copy(C.color).multiplyScalar(C.intensity*R),C.castShadow){let I=C.shadow,k=r.get(C);k.shadowBias=I.bias,k.shadowNormalBias=I.normalBias,k.shadowRadius=I.radius,k.shadowMapSize=I.mapSize,n.directionalShadow[g]=k,n.directionalShadowMap[g]=P,n.directionalShadowMatrix[g]=C.shadow.matrix,y++}n.directional[g]=L,g++}else if(C.isSpotLight){let L=i.get(C);if(L.position.setFromMatrixPosition(C.matrixWorld),L.color.copy(M).multiplyScalar(D*R),L.distance=O,L.coneCos=Math.cos(C.angle),L.penumbraCos=Math.cos(C.angle*(1-C.penumbra)),L.decay=C.decay,C.castShadow){let I=C.shadow,k=r.get(C);k.shadowBias=I.bias,k.shadowNormalBias=I.normalBias,k.shadowRadius=I.radius,k.shadowMapSize=I.mapSize,n.spotShadow[_]=k,n.spotShadowMap[_]=P,n.spotShadowMatrix[_]=C.shadow.matrix,S++}n.spot[_]=L,_++}else if(C.isRectAreaLight){let L=i.get(C);L.color.copy(M).multiplyScalar(D),L.halfWidth.set(C.width*.5,0,0),L.halfHeight.set(0,C.height*.5,0),n.rectArea[x]=L,x++}else if(C.isPointLight){let L=i.get(C);if(L.color.copy(C.color).multiplyScalar(C.intensity*R),L.distance=C.distance,L.decay=C.decay,C.castShadow){let I=C.shadow,k=r.get(C);k.shadowBias=I.bias,k.shadowNormalBias=I.normalBias,k.shadowRadius=I.radius,k.shadowMapSize=I.mapSize,k.shadowCameraNear=I.camera.near,k.shadowCameraFar=I.camera.far,n.pointShadow[p]=k,n.pointShadowMap[p]=P,n.pointShadowMatrix[p]=C.shadow.matrix,w++}n.point[p]=L,p++}else if(C.isHemisphereLight){let L=i.get(C);L.skyColor.copy(C.color).multiplyScalar(D*R),L.groundColor.copy(C.groundColor).multiplyScalar(D*R),n.hemi[b]=L,b++}}x>0&&(e.isWebGL2?(n.rectAreaLTC1=Ge.LTC_FLOAT_1,n.rectAreaLTC2=Ge.LTC_FLOAT_2):t.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Ge.LTC_FLOAT_1,n.rectAreaLTC2=Ge.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Ge.LTC_HALF_1,n.rectAreaLTC2=Ge.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=m,n.ambient[2]=v;let E=n.hash;(E.directionalLength!==g||E.pointLength!==p||E.spotLength!==_||E.rectAreaLength!==x||E.hemiLength!==b||E.numDirectionalShadows!==y||E.numPointShadows!==w||E.numSpotShadows!==S)&&(n.directional.length=g,n.spot.length=_,n.rectArea.length=x,n.point.length=p,n.hemi.length=b,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=w,n.pointShadowMap.length=w,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=w,n.spotShadowMatrix.length=S,E.directionalLength=g,E.pointLength=p,E.spotLength=_,E.rectAreaLength=x,E.hemiLength=b,E.numDirectionalShadows=y,E.numPointShadows=w,E.numSpotShadows=S,n.version=f6++)}function u(c,f){let d=0,m=0,v=0,g=0,p=0,_=f.matrixWorldInverse;for(let x=0,b=c.length;x<b;x++){let y=c[x];if(y.isDirectionalLight){let w=n.directional[d];w.direction.setFromMatrixPosition(y.matrixWorld),o.setFromMatrixPosition(y.target.matrixWorld),w.direction.sub(o),w.direction.transformDirection(_),d++}else if(y.isSpotLight){let w=n.spot[v];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(_),w.direction.setFromMatrixPosition(y.matrixWorld),o.setFromMatrixPosition(y.target.matrixWorld),w.direction.sub(o),w.direction.transformDirection(_),v++}else if(y.isRectAreaLight){let w=n.rectArea[g];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(_),l.identity(),a.copy(y.matrixWorld),a.premultiply(_),l.extractRotation(a),w.halfWidth.set(y.width*.5,0,0),w.halfHeight.set(0,y.height*.5,0),w.halfWidth.applyMatrix4(l),w.halfHeight.applyMatrix4(l),g++}else if(y.isPointLight){let w=n.point[m];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(_),m++}else if(y.isHemisphereLight){let w=n.hemi[p];w.direction.setFromMatrixPosition(y.matrixWorld),w.direction.transformDirection(_),w.direction.normalize(),p++}}}return{setup:h,setupView:u,state:n}}function zR(t,e){let i=new GR(t,e),r=[],n=[];function o(){r.length=0,n.length=0}function a(f){r.push(f)}function l(f){n.push(f)}function h(f){i.setup(r,f)}function u(f){i.setupView(r,f)}return{init:o,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:h,setupLightsView:u,pushLight:a,pushShadow:l}}function HR(t,e){let i=new WeakMap;function r(o,a=0){let l;return i.has(o)===!1?(l=new zR(t,e),i.set(o,[l])):a>=i.get(o).length?(l=new zR(t,e),i.get(o).push(l)):l=i.get(o)[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var Gc=class extends Pr{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=nA,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};Gc.prototype.isMeshDepthMaterial=!0;var zc=class extends Pr{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new q,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};zc.prototype.isMeshDistanceMaterial=!0;var WR=`
void main() {

	gl_Position = vec4( position, 1.0 );

}
`,VR=`
uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;

#include <packing>

void main() {

	const float samples = float( VSM_SAMPLES );

	float mean = 0.0;
	float squared_mean = 0.0;

	// This seems totally useless but it's a crazy work around for a Adreno compiler bug
	// float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );

	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {

		float uvOffset = uvStart + i * uvStride;

		#ifdef HORIZONTAL_PASS

			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;

		#else

			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;

		#endif

	}

	mean = mean / samples;
	squared_mean = squared_mean / samples;

	float std_dev = sqrt( squared_mean - mean * mean );

	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );

}
`;function jR(t,e,i){let r=new wa,n=new ot,o=new ot,a=new jt,l=new Gc({depthPacking:sA}),h=new zc,u={},c=i.maxTextureSize,f={0:Gi,1:Ei,2:qt},d=new un({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ot},radius:{value:4}},vertexShader:WR,fragmentShader:VR}),m=d.clone();m.defines.HORIZONTAL_PASS=1;let v=new _t;v.setAttribute("position",new wt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new St(v,d),p=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ym,this.render=function(y,w,S){if(p.enabled===!1||p.autoUpdate===!1&&p.needsUpdate===!1||y.length===0)return;let R=t.getRenderTarget(),E=t.getActiveCubeFace(),T=t.getActiveMipmapLevel(),A=t.state;A.setBlending(Vn),A.buffers.color.setClear(1,1,1,1),A.buffers.depth.setTest(!0),A.setScissorTest(!1);for(let C=0,M=y.length;C<M;C++){let D=y[C],O=D.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",D,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;n.copy(O.mapSize);let P=O.getFrameExtents();if(n.multiply(P),o.copy(O.mapSize),(n.x>c||n.y>c)&&(n.x>c&&(o.x=Math.floor(c/P.x),n.x=o.x*P.x,O.mapSize.x=o.x),n.y>c&&(o.y=Math.floor(c/P.y),n.y=o.y*P.y,O.mapSize.y=o.y)),O.map===null&&!O.isPointLightShadow&&this.type===_l&&(O.map=new Tr(n.x,n.y),O.map.texture.name=D.name+".shadowMap",O.mapPass=new Tr(n.x,n.y),O.camera.updateProjectionMatrix()),O.map===null){let I={minFilter:Ji,magFilter:Ji,format:or};O.map=new Tr(n.x,n.y,I),O.map.texture.name=D.name+".shadowMap",O.camera.updateProjectionMatrix()}t.setRenderTarget(O.map),t.clear();let L=O.getViewportCount();for(let I=0;I<L;I++){let k=O.getViewport(I);a.set(o.x*k.x,o.y*k.y,o.x*k.z,o.y*k.w),A.viewport(a),O.updateMatrices(D,I),r=O.getFrustum(),b(w,S,O.camera,D,this.type)}!O.isPointLightShadow&&this.type===_l&&_(O,S),O.needsUpdate=!1}p.needsUpdate=!1,t.setRenderTarget(R,E,T)};function _(y,w){let S=e.update(g);d.defines.VSM_SAMPLES!==y.blurSamples&&(d.defines.VSM_SAMPLES=y.blurSamples,m.defines.VSM_SAMPLES=y.blurSamples,d.needsUpdate=!0,m.needsUpdate=!0),d.uniforms.shadow_pass.value=y.map.texture,d.uniforms.resolution.value=y.mapSize,d.uniforms.radius.value=y.radius,t.setRenderTarget(y.mapPass),t.clear(),t.renderBufferDirect(w,null,S,d,g,null),m.uniforms.shadow_pass.value=y.mapPass.texture,m.uniforms.resolution.value=y.mapSize,m.uniforms.radius.value=y.radius,t.setRenderTarget(y.map),t.clear(),t.renderBufferDirect(w,null,S,m,g,null)}function x(y,w,S,R,E,T){let A=null,C=S.isPointLight===!0?y.customDistanceMaterial:y.customDepthMaterial;if(C!==void 0?A=C:A=S.isPointLight===!0?h:l,t.localClippingEnabled&&w.clipShadows===!0&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0){let M=A.uuid,D=w.uuid,O=u[M];O===void 0&&(O={},u[M]=O);let P=O[D];P===void 0&&(P=A.clone(),O[D]=P),A=P}return A.visible=w.visible,A.wireframe=w.wireframe,T===_l?A.side=w.shadowSide!==null?w.shadowSide:w.side:A.side=w.shadowSide!==null?w.shadowSide:f[w.side],A.alphaMap=w.alphaMap,A.alphaTest=w.alphaTest,A.clipShadows=w.clipShadows,A.clippingPlanes=w.clippingPlanes,A.clipIntersection=w.clipIntersection,A.displacementMap=w.displacementMap,A.displacementScale=w.displacementScale,A.displacementBias=w.displacementBias,A.wireframeLinewidth=w.wireframeLinewidth,A.linewidth=w.linewidth,S.isPointLight===!0&&A.isMeshDistanceMaterial===!0&&(A.referencePosition.setFromMatrixPosition(S.matrixWorld),A.nearDistance=R,A.farDistance=E),A}function b(y,w,S,R,E){if(y.visible===!1)return;if(y.layers.test(w.layers)&&(y.isMesh||y.isLine||y.isPoints)&&(y.castShadow||y.receiveShadow&&E===_l)&&(!y.frustumCulled||r.intersectsObject(y))){y.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,y.matrixWorld);let C=e.update(y),M=y.material;if(Array.isArray(M)){let D=C.groups;for(let O=0,P=D.length;O<P;O++){let L=D[O],I=M[L.materialIndex];if(I&&I.visible){let k=x(y,I,R,S.near,S.far,E);t.renderBufferDirect(S,null,C,k,y,L)}}}else if(M.visible){let D=x(y,M,R,S.near,S.far,E);t.renderBufferDirect(S,null,C,D,y,null)}}let A=y.children;for(let C=0,M=A.length;C<M;C++)b(A[C],w,S,R,E)}}function qR(t,e,i){let r=i.isWebGL2;function n(){let G=!1,me=new jt,Se=null,Be=new jt(0,0,0,0);return{setMask:function(De){Se!==De&&!G&&(t.colorMask(De,De,De,De),Se=De)},setLocked:function(De){G=De},setClear:function(De,Ze,Te,ft,Et){Et===!0&&(De*=ft,Ze*=ft,Te*=ft),me.set(De,Ze,Te,ft),Be.equals(me)===!1&&(t.clearColor(De,Ze,Te,ft),Be.copy(me))},reset:function(){G=!1,Se=null,Be.set(-1,0,0,0)}}}function o(){let G=!1,me=null,Se=null,Be=null;return{setTest:function(De){De?ie(t.DEPTH_TEST):Q(t.DEPTH_TEST)},setMask:function(De){me!==De&&!G&&(t.depthMask(De),me=De)},setFunc:function(De){if(Se!==De){if(De)switch(De){case AT:t.depthFunc(t.NEVER);break;case $s:t.depthFunc(t.ALWAYS);break;case PT:t.depthFunc(t.LESS);break;case wc:t.depthFunc(t.LEQUAL);break;case RT:t.depthFunc(t.EQUAL);break;case LT:t.depthFunc(t.GEQUAL);break;case OT:t.depthFunc(t.GREATER);break;case DT:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);Se=De}},setLocked:function(De){G=De},setClear:function(De){Be!==De&&(t.clearDepth(De),Be=De)},reset:function(){G=!1,me=null,Se=null,Be=null}}}function a(){let G=!1,me=null,Se=null,Be=null,De=null,Ze=null,Te=null,ft=null,Et=null;return{setTest:function(bt){G||(bt?ie(t.STENCIL_TEST):Q(t.STENCIL_TEST))},setMask:function(bt){me!==bt&&!G&&(t.stencilMask(bt),me=bt)},setFunc:function(bt,mi,sr){(Se!==bt||Be!==mi||De!==sr)&&(t.stencilFunc(bt,mi,sr),Se=bt,Be=mi,De=sr)},setOp:function(bt,mi,sr){(Ze!==bt||Te!==mi||ft!==sr)&&(t.stencilOp(bt,mi,sr),Ze=bt,Te=mi,ft=sr)},setLocked:function(bt){G=bt},setClear:function(bt){Et!==bt&&(t.clearStencil(bt),Et=bt)},reset:function(){G=!1,me=null,Se=null,Be=null,De=null,Ze=null,Te=null,ft=null,Et=null}}}let l=new n,h=new o,u=new a,c={},f={},d=new WeakMap,m=[],v=null,g=!1,p=null,_=null,x=null,b=null,y=null,w=null,S=null,R=!1,E=null,T=null,A=null,C=null,M=null,D=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),O=!1,P=0,L=t.getParameter(t.VERSION);L.indexOf("WebGL")!==-1?(P=parseFloat(/^WebGL (\d)/.exec(L)[1]),O=P>=1):L.indexOf("OpenGL ES")!==-1&&(P=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),O=P>=2);let I=null,k={},B=t.getParameter(t.SCISSOR_BOX),F=t.getParameter(t.VIEWPORT),W=new jt().fromArray(B),V=new jt().fromArray(F);function N(G,me,Se){let Be=new Uint8Array(4),De=t.createTexture();t.bindTexture(G,De),t.texParameteri(G,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(G,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Ze=0;Ze<Se;Ze++)t.texImage2D(me+Ze,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Be);return De}let ne={};ne[t.TEXTURE_2D]=N(t.TEXTURE_2D,t.TEXTURE_2D,1),ne[t.TEXTURE_CUBE_MAP]=N(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),l.setClear(0,0,0,1),h.setClear(1),u.setClear(0),ie(t.DEPTH_TEST),h.setFunc(wc),ge(!1),Me(xy),ie(t.CULL_FACE),z(Vn);function ie(G){c[G]!==!0&&(t.enable(G),c[G]=!0)}function Q(G){c[G]!==!1&&(t.disable(G),c[G]=!1)}function K(G,me){return f[G]!==me?(t.bindFramebuffer(G,me),f[G]=me,r&&(G===t.DRAW_FRAMEBUFFER&&(f[t.FRAMEBUFFER]=me),G===t.FRAMEBUFFER&&(f[t.DRAW_FRAMEBUFFER]=me)),!0):!1}function de(G,me){let Se=m,Be=!1;if(G)if(Se=d.get(me),Se===void 0&&(Se=[],d.set(me,Se)),G.isWebGLMultipleRenderTargets){let De=G.texture;if(Se.length!==De.length||Se[0]!==t.COLOR_ATTACHMENT0){for(let Ze=0,Te=De.length;Ze<Te;Ze++)Se[Ze]=t.COLOR_ATTACHMENT0+Ze;Se.length=De.length,Be=!0}}else Se[0]!==t.COLOR_ATTACHMENT0&&(Se[0]=t.COLOR_ATTACHMENT0,Be=!0);else Se[0]!==t.BACK&&(Se[0]=t.BACK,Be=!0);Be&&(i.isWebGL2?t.drawBuffers(Se):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Se))}function re(G){return v!==G?(t.useProgram(G),v=G,!0):!1}let Y={[ga]:t.FUNC_ADD,[vT]:t.FUNC_SUBTRACT,[_T]:t.FUNC_REVERSE_SUBTRACT};if(r)Y[Cy]=t.MIN,Y[My]=t.MAX;else{let G=e.get("EXT_blend_minmax");G!==null&&(Y[Cy]=G.MIN_EXT,Y[My]=G.MAX_EXT)}let U={[yT]:t.ZERO,[xT]:t.ONE,[bT]:t.SRC_COLOR,[bm]:t.SRC_ALPHA,[TT]:t.SRC_ALPHA_SATURATE,[MT]:t.DST_COLOR,[ST]:t.DST_ALPHA,[wT]:t.ONE_MINUS_SRC_COLOR,[wm]:t.ONE_MINUS_SRC_ALPHA,[ET]:t.ONE_MINUS_DST_COLOR,[CT]:t.ONE_MINUS_DST_ALPHA};function z(G,me,Se,Be,De,Ze,Te,ft){if(G===Vn){g===!0&&(Q(t.BLEND),g=!1);return}if(g===!1&&(ie(t.BLEND),g=!0),G!==gT){if(G!==p||ft!==R){if((_!==ga||y!==ga)&&(t.blendEquation(t.FUNC_ADD),_=ga,y=ga),ft)switch(G){case Do:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case by:t.blendFunc(t.ONE,t.ONE);break;case wy:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Sy:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",G);break}else switch(G){case Do:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case by:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case wy:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Sy:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",G);break}x=null,b=null,w=null,S=null,p=G,R=ft}return}De=De||me,Ze=Ze||Se,Te=Te||Be,(me!==_||De!==y)&&(t.blendEquationSeparate(Y[me],Y[De]),_=me,y=De),(Se!==x||Be!==b||Ze!==w||Te!==S)&&(t.blendFuncSeparate(U[Se],U[Be],U[Ze],U[Te]),x=Se,b=Be,w=Ze,S=Te),p=G,R=null}function te(G,me){G.side===qt?Q(t.CULL_FACE):ie(t.CULL_FACE);let Se=G.side===Gi;me&&(Se=!Se),ge(Se),G.blending===Do&&G.transparent===!1?z(Vn):z(G.blending,G.blendEquation,G.blendSrc,G.blendDst,G.blendEquationAlpha,G.blendSrcAlpha,G.blendDstAlpha,G.premultipliedAlpha),h.setFunc(G.depthFunc),h.setTest(G.depthTest),h.setMask(G.depthWrite),l.setMask(G.colorWrite);let Be=G.stencilWrite;u.setTest(Be),Be&&(u.setMask(G.stencilWriteMask),u.setFunc(G.stencilFunc,G.stencilRef,G.stencilFuncMask),u.setOp(G.stencilFail,G.stencilZFail,G.stencilZPass)),He(G.polygonOffset,G.polygonOffsetFactor,G.polygonOffsetUnits),G.alphaToCoverage===!0?ie(t.SAMPLE_ALPHA_TO_COVERAGE):Q(t.SAMPLE_ALPHA_TO_COVERAGE)}function ge(G){E!==G&&(G?t.frontFace(t.CW):t.frontFace(t.CCW),E=G)}function Me(G){G!==dT?(ie(t.CULL_FACE),G!==T&&(G===xy?t.cullFace(t.BACK):G===pT?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):Q(t.CULL_FACE),T=G}function ze(G){G!==A&&(O&&t.lineWidth(G),A=G)}function He(G,me,Se){G?(ie(t.POLYGON_OFFSET_FILL),(C!==me||M!==Se)&&(t.polygonOffset(me,Se),C=me,M=Se)):Q(t.POLYGON_OFFSET_FILL)}function Ne(G){G?ie(t.SCISSOR_TEST):Q(t.SCISSOR_TEST)}function Ye(G){G===void 0&&(G=t.TEXTURE0+D-1),I!==G&&(t.activeTexture(G),I=G)}function Ae(G,me){I===null&&Ye();let Se=k[I];Se===void 0&&(Se={type:void 0,texture:void 0},k[I]=Se),(Se.type!==G||Se.texture!==me)&&(t.bindTexture(G,me||ne[G]),Se.type=G,Se.texture=me)}function Ft(){let G=k[I];G!==void 0&&G.type!==void 0&&(t.bindTexture(G.type,null),G.type=void 0,G.texture=void 0)}function Z(){try{t.compressedTexImage2D.apply(t,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function j(){try{t.texSubImage2D.apply(t,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function _e(){try{t.texSubImage3D.apply(t,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function Ee(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function We(){try{t.texStorage2D.apply(t,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function je(){try{t.texStorage3D.apply(t,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function ct(){try{t.texImage2D.apply(t,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function ye(){try{t.texImage3D.apply(t,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}function pt(G){W.equals(G)===!1&&(t.scissor(G.x,G.y,G.z,G.w),W.copy(G))}function yt(G){V.equals(G)===!1&&(t.viewport(G.x,G.y,G.z,G.w),V.copy(G))}function Ve(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),r===!0&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},I=null,k={},f={},d=new WeakMap,m=[],v=null,g=!1,p=null,_=null,x=null,b=null,y=null,w=null,S=null,R=!1,E=null,T=null,A=null,C=null,M=null,W.set(0,0,t.canvas.width,t.canvas.height),V.set(0,0,t.canvas.width,t.canvas.height),l.reset(),h.reset(),u.reset()}return{buffers:{color:l,depth:h,stencil:u},enable:ie,disable:Q,bindFramebuffer:K,drawBuffers:de,useProgram:re,setBlending:z,setMaterial:te,setFlipSided:ge,setCullFace:Me,setLineWidth:ze,setPolygonOffset:He,setScissorTest:Ne,activeTexture:Ye,bindTexture:Ae,unbindTexture:Ft,compressedTexImage2D:Z,texImage2D:ct,texImage3D:ye,texStorage2D:We,texStorage3D:je,texSubImage2D:j,texSubImage3D:_e,compressedTexSubImage2D:Ee,scissor:pt,viewport:yt,reset:Ve}}function XR(t,e,i,r,n,o,a){let l=n.isWebGL2,h=n.maxTextures,u=n.maxCubemapSize,c=n.maxTextureSize,f=n.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,m=/OculusBrowser/g.test(navigator.userAgent),v=new WeakMap,g,p=new WeakMap,_=!1;try{_=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(Z){}function x(Z,j){return _?new OffscreenCanvas(Z,j):Pc("canvas")}function b(Z,j,_e,Ee){let We=1;if((Z.width>Ee||Z.height>Ee)&&(We=Ee/Math.max(Z.width,Z.height)),We<1||j===!0)if(typeof HTMLImageElement!="undefined"&&Z instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&Z instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&Z instanceof ImageBitmap){let je=j?Ac:Math.floor,ct=je(We*Z.width),ye=je(We*Z.height);g===void 0&&(g=x(ct,ye));let pt=_e?x(ct,ye):g;return pt.width=ct,pt.height=ye,pt.getContext("2d").drawImage(Z,0,0,ct,ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Z.width+"x"+Z.height+") to ("+ct+"x"+ye+")."),pt}else return"data"in Z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Z.width+"x"+Z.height+")."),Z;return Z}function y(Z){return $y(Z.width)&&$y(Z.height)}function w(Z){return l?!1:Z.wrapS!==Wr||Z.wrapT!==Wr||Z.minFilter!==Ji&&Z.minFilter!==$i}function S(Z,j){return Z.generateMipmaps&&j&&Z.minFilter!==Ji&&Z.minFilter!==$i}function R(Z){t.generateMipmap(Z)}function E(Z,j,_e,Ee,We=!1){if(l===!1)return j;if(Z!==null){if(t[Z]!==void 0)return t[Z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Z+"'")}let je=j;return j===t.RED&&(_e===t.FLOAT&&(je=t.R32F),_e===t.HALF_FLOAT&&(je=t.R16F),_e===t.UNSIGNED_BYTE&&(je=t.R8)),j===t.RG&&(_e===t.FLOAT&&(je=t.RG32F),_e===t.HALF_FLOAT&&(je=t.RG16F),_e===t.UNSIGNED_BYTE&&(je=t.RG8)),j===t.RGBA&&(_e===t.FLOAT&&(je=t.RGBA32F),_e===t.HALF_FLOAT&&(je=t.RGBA16F),_e===t.UNSIGNED_BYTE&&(je=Ee===Qt&&We===!1?t.SRGB8_ALPHA8:t.RGBA8),_e===t.UNSIGNED_SHORT_4_4_4_4&&(je=t.RGBA4),_e===t.UNSIGNED_SHORT_5_5_5_1&&(je=t.RGB5_A1)),(je===t.R16F||je===t.R32F||je===t.RG16F||je===t.RG32F||je===t.RGBA16F||je===t.RGBA32F)&&e.get("EXT_color_buffer_float"),je}function T(Z,j,_e){return S(Z,_e)===!0||Z.isFramebufferTexture&&Z.minFilter!==Ji&&Z.minFilter!==$i?Math.log2(Math.max(j.width,j.height))+1:Z.mipmaps!==void 0&&Z.mipmaps.length>0?Z.mipmaps.length:Z.isCompressedTexture&&Array.isArray(Z.image)?j.mipmaps.length:1}function A(Z){return Z===Ji||Z===Ty||Z===Ay?t.NEAREST:t.LINEAR}function C(Z){let j=Z.target;j.removeEventListener("dispose",C),D(j),j.isVideoTexture&&v.delete(j)}function M(Z){let j=Z.target;j.removeEventListener("dispose",M),P(j)}function D(Z){let j=r.get(Z);if(j.__webglInit===void 0)return;let _e=Z.source,Ee=p.get(_e);if(Ee){let We=Ee[j.__cacheKey];We.usedTimes--,We.usedTimes===0&&O(Z),Object.keys(Ee).length===0&&p.delete(_e)}r.remove(Z)}function O(Z){let j=r.get(Z);t.deleteTexture(j.__webglTexture);let _e=Z.source,Ee=p.get(_e);delete Ee[j.__cacheKey],a.memory.textures--}function P(Z){let j=Z.texture,_e=r.get(Z),Ee=r.get(j);if(Ee.__webglTexture!==void 0&&(t.deleteTexture(Ee.__webglTexture),a.memory.textures--),Z.depthTexture&&Z.depthTexture.dispose(),Z.isWebGLCubeRenderTarget)for(let We=0;We<6;We++)t.deleteFramebuffer(_e.__webglFramebuffer[We]),_e.__webglDepthbuffer&&t.deleteRenderbuffer(_e.__webglDepthbuffer[We]);else t.deleteFramebuffer(_e.__webglFramebuffer),_e.__webglDepthbuffer&&t.deleteRenderbuffer(_e.__webglDepthbuffer),_e.__webglMultisampledFramebuffer&&t.deleteFramebuffer(_e.__webglMultisampledFramebuffer),_e.__webglColorRenderbuffer&&t.deleteRenderbuffer(_e.__webglColorRenderbuffer),_e.__webglDepthRenderbuffer&&t.deleteRenderbuffer(_e.__webglDepthRenderbuffer);if(Z.isWebGLMultipleRenderTargets)for(let We=0,je=j.length;We<je;We++){let ct=r.get(j[We]);ct.__webglTexture&&(t.deleteTexture(ct.__webglTexture),a.memory.textures--),r.remove(j[We])}r.remove(j),r.remove(Z)}let L=0;function I(){L=0}function k(){let Z=L;return Z>=h&&console.warn("THREE.WebGLTextures: Trying to use "+Z+" texture units while this GPU supports only "+h),L+=1,Z}function B(Z){let j=[];return j.push(Z.wrapS),j.push(Z.wrapT),j.push(Z.magFilter),j.push(Z.minFilter),j.push(Z.anisotropy),j.push(Z.internalFormat),j.push(Z.format),j.push(Z.type),j.push(Z.generateMipmaps),j.push(Z.premultiplyAlpha),j.push(Z.flipY),j.push(Z.unpackAlignment),j.push(Z.encoding),j.join()}function F(Z,j){let _e=r.get(Z);if(Z.isVideoTexture&&Ae(Z),Z.isRenderTargetTexture===!1&&Z.version>0&&_e.__version!==Z.version){let Ee=Z.image;if(Ee===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ee.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{de(_e,Z,j);return}}i.activeTexture(t.TEXTURE0+j),i.bindTexture(t.TEXTURE_2D,_e.__webglTexture)}function W(Z,j){let _e=r.get(Z);if(Z.version>0&&_e.__version!==Z.version){de(_e,Z,j);return}i.activeTexture(t.TEXTURE0+j),i.bindTexture(t.TEXTURE_2D_ARRAY,_e.__webglTexture)}function V(Z,j){let _e=r.get(Z);if(Z.version>0&&_e.__version!==Z.version){de(_e,Z,j);return}i.activeTexture(t.TEXTURE0+j),i.bindTexture(t.TEXTURE_3D,_e.__webglTexture)}function N(Z,j){let _e=r.get(Z);if(Z.version>0&&_e.__version!==Z.version){re(_e,Z,j);return}i.activeTexture(t.TEXTURE0+j),i.bindTexture(t.TEXTURE_CUBE_MAP,_e.__webglTexture)}let ne={[Mc]:t.REPEAT,[Wr]:t.CLAMP_TO_EDGE,[Ec]:t.MIRRORED_REPEAT},ie={[Ji]:t.NEAREST,[Ty]:t.NEAREST_MIPMAP_NEAREST,[Ay]:t.NEAREST_MIPMAP_LINEAR,[$i]:t.LINEAR,[zT]:t.LINEAR_MIPMAP_NEAREST,[ya]:t.LINEAR_MIPMAP_LINEAR};function Q(Z,j,_e){if(_e?(t.texParameteri(Z,t.TEXTURE_WRAP_S,ne[j.wrapS]),t.texParameteri(Z,t.TEXTURE_WRAP_T,ne[j.wrapT]),(Z===t.TEXTURE_3D||Z===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Z,t.TEXTURE_WRAP_R,ne[j.wrapR]),t.texParameteri(Z,t.TEXTURE_MAG_FILTER,ie[j.magFilter]),t.texParameteri(Z,t.TEXTURE_MIN_FILTER,ie[j.minFilter])):(t.texParameteri(Z,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(Z,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(Z===t.TEXTURE_3D||Z===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Z,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),(j.wrapS!==Wr||j.wrapT!==Wr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(Z,t.TEXTURE_MAG_FILTER,A(j.magFilter)),t.texParameteri(Z,t.TEXTURE_MIN_FILTER,A(j.minFilter)),j.minFilter!==Ji&&j.minFilter!==$i&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let Ee=e.get("EXT_texture_filter_anisotropic");if(j.type===ws&&e.has("OES_texture_float_linear")===!1||l===!1&&j.type===to&&e.has("OES_texture_half_float_linear")===!1)return;(j.anisotropy>1||r.get(j).__currentAnisotropy)&&(t.texParameterf(Z,Ee.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(j.anisotropy,n.getMaxAnisotropy())),r.get(j).__currentAnisotropy=j.anisotropy)}}function K(Z,j){let _e=!1;Z.__webglInit===void 0&&(Z.__webglInit=!0,j.addEventListener("dispose",C));let Ee=j.source,We=p.get(Ee);We===void 0&&(We={},p.set(Ee,We));let je=B(j);if(je!==Z.__cacheKey){We[je]===void 0&&(We[je]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,_e=!0),We[je].usedTimes++;let ct=We[Z.__cacheKey];ct!==void 0&&(We[Z.__cacheKey].usedTimes--,ct.usedTimes===0&&O(j)),Z.__cacheKey=je,Z.__webglTexture=We[je].texture}return _e}function de(Z,j,_e){let Ee=t.TEXTURE_2D;j.isDataArrayTexture&&(Ee=t.TEXTURE_2D_ARRAY),j.isData3DTexture&&(Ee=t.TEXTURE_3D);let We=K(Z,j),je=j.source;if(i.activeTexture(t.TEXTURE0+_e),i.bindTexture(Ee,Z.__webglTexture),je.version!==je.__currentVersion||We===!0){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,j.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,j.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);let ct=w(j)&&y(j.image)===!1,ye=b(j.image,ct,!1,c);ye=Ft(j,ye);let pt=y(ye)||l,yt=o.convert(j.format,j.encoding),Ve=o.convert(j.type),G=E(j.internalFormat,yt,Ve,j.encoding,j.isVideoTexture);Q(Ee,j,pt);let me,Se=j.mipmaps,Be=l&&j.isVideoTexture!==!0,De=Z.__version===void 0,Ze=T(j,ye,pt);if(j.isDepthTexture)G=t.DEPTH_COMPONENT,l?j.type===ws?G=t.DEPTH_COMPONENT32F:j.type===yh?G=t.DEPTH_COMPONENT24:j.type===io?G=t.DEPTH24_STENCIL8:G=t.DEPTH_COMPONENT16:j.type===ws&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),j.format===Ss&&G===t.DEPTH_COMPONENT&&j.type!==Io&&j.type!==yh&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),j.type=Io,Ve=o.convert(j.type)),j.format===ro&&G===t.DEPTH_COMPONENT&&(G=t.DEPTH_STENCIL,j.type!==io&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),j.type=io,Ve=o.convert(j.type))),Be&&De?i.texStorage2D(t.TEXTURE_2D,1,G,ye.width,ye.height):i.texImage2D(t.TEXTURE_2D,0,G,ye.width,ye.height,0,yt,Ve,null);else if(j.isDataTexture)if(Se.length>0&&pt){Be&&De&&i.texStorage2D(t.TEXTURE_2D,Ze,G,Se[0].width,Se[0].height);for(let Te=0,ft=Se.length;Te<ft;Te++)me=Se[Te],Be?i.texSubImage2D(t.TEXTURE_2D,Te,0,0,me.width,me.height,yt,Ve,me.data):i.texImage2D(t.TEXTURE_2D,Te,G,me.width,me.height,0,yt,Ve,me.data);j.generateMipmaps=!1}else Be?(De&&i.texStorage2D(t.TEXTURE_2D,Ze,G,ye.width,ye.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,ye.width,ye.height,yt,Ve,ye.data)):i.texImage2D(t.TEXTURE_2D,0,G,ye.width,ye.height,0,yt,Ve,ye.data);else if(j.isCompressedTexture){Be&&De&&i.texStorage2D(t.TEXTURE_2D,Ze,G,Se[0].width,Se[0].height);for(let Te=0,ft=Se.length;Te<ft;Te++)me=Se[Te],j.format!==or?yt!==null?Be?i.compressedTexSubImage2D(t.TEXTURE_2D,Te,0,0,me.width,me.height,yt,me.data):i.compressedTexImage2D(t.TEXTURE_2D,Te,G,me.width,me.height,0,me.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Be?i.texSubImage2D(t.TEXTURE_2D,Te,0,0,me.width,me.height,yt,Ve,me.data):i.texImage2D(t.TEXTURE_2D,Te,G,me.width,me.height,0,yt,Ve,me.data)}else if(j.isDataArrayTexture)Be?(De&&i.texStorage3D(t.TEXTURE_2D_ARRAY,Ze,G,ye.width,ye.height,ye.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,ye.width,ye.height,ye.depth,yt,Ve,ye.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,G,ye.width,ye.height,ye.depth,0,yt,Ve,ye.data);else if(j.isData3DTexture)Be?(De&&i.texStorage3D(t.TEXTURE_3D,Ze,G,ye.width,ye.height,ye.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,ye.width,ye.height,ye.depth,yt,Ve,ye.data)):i.texImage3D(t.TEXTURE_3D,0,G,ye.width,ye.height,ye.depth,0,yt,Ve,ye.data);else if(j.isFramebufferTexture)Be&&De?i.texStorage2D(t.TEXTURE_2D,Ze,G,ye.width,ye.height):i.texImage2D(t.TEXTURE_2D,0,G,ye.width,ye.height,0,yt,Ve,null);else if(Se.length>0&&pt){Be&&De&&i.texStorage2D(t.TEXTURE_2D,Ze,G,Se[0].width,Se[0].height);for(let Te=0,ft=Se.length;Te<ft;Te++)me=Se[Te],Be?i.texSubImage2D(t.TEXTURE_2D,Te,0,0,yt,Ve,me):i.texImage2D(t.TEXTURE_2D,Te,G,yt,Ve,me);j.generateMipmaps=!1}else Be?(De&&i.texStorage2D(t.TEXTURE_2D,Ze,G,ye.width,ye.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,yt,Ve,ye)):i.texImage2D(t.TEXTURE_2D,0,G,yt,Ve,ye);S(j,pt)&&R(Ee),je.__currentVersion=je.version,j.onUpdate&&j.onUpdate(j)}Z.__version=j.version}function re(Z,j,_e){if(j.image.length!==6)return;let Ee=K(Z,j),We=j.source;if(i.activeTexture(t.TEXTURE0+_e),i.bindTexture(t.TEXTURE_CUBE_MAP,Z.__webglTexture),We.version!==We.__currentVersion||Ee===!0){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,j.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,j.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);let je=j.isCompressedTexture||j.image[0].isCompressedTexture,ct=j.image[0]&&j.image[0].isDataTexture,ye=[];for(let Te=0;Te<6;Te++)!je&&!ct?ye[Te]=b(j.image[Te],!1,!0,u):ye[Te]=ct?j.image[Te].image:j.image[Te],ye[Te]=Ft(j,ye[Te]);let pt=ye[0],yt=y(pt)||l,Ve=o.convert(j.format,j.encoding),G=o.convert(j.type),me=E(j.internalFormat,Ve,G,j.encoding),Se=l&&j.isVideoTexture!==!0,Be=Z.__version===void 0,De=T(j,pt,yt);Q(t.TEXTURE_CUBE_MAP,j,yt);let Ze;if(je){Se&&Be&&i.texStorage2D(t.TEXTURE_CUBE_MAP,De,me,pt.width,pt.height);for(let Te=0;Te<6;Te++){Ze=ye[Te].mipmaps;for(let ft=0;ft<Ze.length;ft++){let Et=Ze[ft];j.format!==or?Ve!==null?Se?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ft,0,0,Et.width,Et.height,Ve,Et.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ft,me,Et.width,Et.height,0,Et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Se?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ft,0,0,Et.width,Et.height,Ve,G,Et.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ft,me,Et.width,Et.height,0,Ve,G,Et.data)}}}else{Ze=j.mipmaps,Se&&Be&&(Ze.length>0&&De++,i.texStorage2D(t.TEXTURE_CUBE_MAP,De,me,ye[0].width,ye[0].height));for(let Te=0;Te<6;Te++)if(ct){Se?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0,0,0,ye[Te].width,ye[Te].height,Ve,G,ye[Te].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0,me,ye[Te].width,ye[Te].height,0,Ve,G,ye[Te].data);for(let ft=0;ft<Ze.length;ft++){let bt=Ze[ft].image[Te].image;Se?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ft+1,0,0,bt.width,bt.height,Ve,G,bt.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ft+1,me,bt.width,bt.height,0,Ve,G,bt.data)}}else{Se?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0,0,0,Ve,G,ye[Te]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0,me,Ve,G,ye[Te]);for(let ft=0;ft<Ze.length;ft++){let Et=Ze[ft];Se?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ft+1,0,0,Ve,G,Et.image[Te]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,ft+1,me,Ve,G,Et.image[Te])}}}S(j,yt)&&R(t.TEXTURE_CUBE_MAP),We.__currentVersion=We.version,j.onUpdate&&j.onUpdate(j)}Z.__version=j.version}function Y(Z,j,_e,Ee,We){let je=o.convert(_e.format,_e.encoding),ct=o.convert(_e.type),ye=E(_e.internalFormat,je,ct,_e.encoding);r.get(j).__hasExternalTextures||(We===t.TEXTURE_3D||We===t.TEXTURE_2D_ARRAY?i.texImage3D(We,0,ye,j.width,j.height,j.depth,0,je,ct,null):i.texImage2D(We,0,ye,j.width,j.height,0,je,ct,null)),i.bindFramebuffer(t.FRAMEBUFFER,Z),Ye(j)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Ee,We,r.get(_e).__webglTexture,0,Ne(j)):t.framebufferTexture2D(t.FRAMEBUFFER,Ee,We,r.get(_e).__webglTexture,0),i.bindFramebuffer(t.FRAMEBUFFER,null)}function U(Z,j,_e){if(t.bindRenderbuffer(t.RENDERBUFFER,Z),j.depthBuffer&&!j.stencilBuffer){let Ee=t.DEPTH_COMPONENT16;if(_e||Ye(j)){let We=j.depthTexture;We&&We.isDepthTexture&&(We.type===ws?Ee=t.DEPTH_COMPONENT32F:We.type===yh&&(Ee=t.DEPTH_COMPONENT24));let je=Ne(j);Ye(j)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,je,Ee,j.width,j.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,je,Ee,j.width,j.height)}else t.renderbufferStorage(t.RENDERBUFFER,Ee,j.width,j.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,Z)}else if(j.depthBuffer&&j.stencilBuffer){let Ee=Ne(j);_e&&Ye(j)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Ee,t.DEPTH24_STENCIL8,j.width,j.height):Ye(j)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ee,t.DEPTH24_STENCIL8,j.width,j.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,j.width,j.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,Z)}else{let Ee=j.isWebGLMultipleRenderTargets===!0?j.texture[0]:j.texture,We=o.convert(Ee.format,Ee.encoding),je=o.convert(Ee.type),ct=E(Ee.internalFormat,We,je,Ee.encoding),ye=Ne(j);_e&&Ye(j)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,ye,ct,j.width,j.height):Ye(j)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ye,ct,j.width,j.height):t.renderbufferStorage(t.RENDERBUFFER,ct,j.width,j.height)}t.bindRenderbuffer(t.RENDERBUFFER,null)}function z(Z,j){if(j&&j.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,Z),!(j.depthTexture&&j.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(j.depthTexture).__webglTexture||j.depthTexture.image.width!==j.width||j.depthTexture.image.height!==j.height)&&(j.depthTexture.image.width=j.width,j.depthTexture.image.height=j.height,j.depthTexture.needsUpdate=!0),F(j.depthTexture,0);let Ee=r.get(j.depthTexture).__webglTexture,We=Ne(j);if(j.depthTexture.format===Ss)Ye(j)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ee,0,We):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ee,0);else if(j.depthTexture.format===ro)Ye(j)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ee,0,We):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ee,0);else throw new Error("Unknown depthTexture format")}function te(Z){let j=r.get(Z),_e=Z.isWebGLCubeRenderTarget===!0;if(Z.depthTexture&&!j.__autoAllocateDepthBuffer){if(_e)throw new Error("target.depthTexture not supported in Cube render targets");z(j.__webglFramebuffer,Z)}else if(_e){j.__webglDepthbuffer=[];for(let Ee=0;Ee<6;Ee++)i.bindFramebuffer(t.FRAMEBUFFER,j.__webglFramebuffer[Ee]),j.__webglDepthbuffer[Ee]=t.createRenderbuffer(),U(j.__webglDepthbuffer[Ee],Z,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,j.__webglFramebuffer),j.__webglDepthbuffer=t.createRenderbuffer(),U(j.__webglDepthbuffer,Z,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function ge(Z,j,_e){let Ee=r.get(Z);j!==void 0&&Y(Ee.__webglFramebuffer,Z,Z.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),_e!==void 0&&te(Z)}function Me(Z){let j=Z.texture,_e=r.get(Z),Ee=r.get(j);Z.addEventListener("dispose",M),Z.isWebGLMultipleRenderTargets!==!0&&(Ee.__webglTexture===void 0&&(Ee.__webglTexture=t.createTexture()),Ee.__version=j.version,a.memory.textures++);let We=Z.isWebGLCubeRenderTarget===!0,je=Z.isWebGLMultipleRenderTargets===!0,ct=y(Z)||l;if(We){_e.__webglFramebuffer=[];for(let ye=0;ye<6;ye++)_e.__webglFramebuffer[ye]=t.createFramebuffer()}else if(_e.__webglFramebuffer=t.createFramebuffer(),je)if(n.drawBuffers){let ye=Z.texture;for(let pt=0,yt=ye.length;pt<yt;pt++){let Ve=r.get(ye[pt]);Ve.__webglTexture===void 0&&(Ve.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(l&&Z.samples>0&&Ye(Z)===!1){_e.__webglMultisampledFramebuffer=t.createFramebuffer(),_e.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,_e.__webglColorRenderbuffer);let ye=o.convert(j.format,j.encoding),pt=o.convert(j.type),yt=E(j.internalFormat,ye,pt,j.encoding),Ve=Ne(Z);t.renderbufferStorageMultisample(t.RENDERBUFFER,Ve,yt,Z.width,Z.height),i.bindFramebuffer(t.FRAMEBUFFER,_e.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,_e.__webglColorRenderbuffer),t.bindRenderbuffer(t.RENDERBUFFER,null),Z.depthBuffer&&(_e.__webglDepthRenderbuffer=t.createRenderbuffer(),U(_e.__webglDepthRenderbuffer,Z,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}if(We){i.bindTexture(t.TEXTURE_CUBE_MAP,Ee.__webglTexture),Q(t.TEXTURE_CUBE_MAP,j,ct);for(let ye=0;ye<6;ye++)Y(_e.__webglFramebuffer[ye],Z,j,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ye);S(j,ct)&&R(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(je){let ye=Z.texture;for(let pt=0,yt=ye.length;pt<yt;pt++){let Ve=ye[pt],G=r.get(Ve);i.bindTexture(t.TEXTURE_2D,G.__webglTexture),Q(t.TEXTURE_2D,Ve,ct),Y(_e.__webglFramebuffer,Z,Ve,t.COLOR_ATTACHMENT0+pt,t.TEXTURE_2D),S(Ve,ct)&&R(t.TEXTURE_2D)}i.unbindTexture()}else{let ye=t.TEXTURE_2D;(Z.isWebGL3DRenderTarget||Z.isWebGLArrayRenderTarget)&&(l?ye=Z.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(ye,Ee.__webglTexture),Q(ye,j,ct),Y(_e.__webglFramebuffer,Z,j,t.COLOR_ATTACHMENT0,ye),S(j,ct)&&R(ye),i.unbindTexture()}Z.depthBuffer&&te(Z)}function ze(Z){let j=y(Z)||l,_e=Z.isWebGLMultipleRenderTargets===!0?Z.texture:[Z.texture];for(let Ee=0,We=_e.length;Ee<We;Ee++){let je=_e[Ee];if(S(je,j)){let ct=Z.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,ye=r.get(je).__webglTexture;i.bindTexture(ct,ye),R(ct),i.unbindTexture()}}}function He(Z){if(l&&Z.samples>0&&Ye(Z)===!1){let j=Z.width,_e=Z.height,Ee=t.COLOR_BUFFER_BIT,We=[t.COLOR_ATTACHMENT0],je=Z.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;Z.depthBuffer&&We.push(je);let ct=r.get(Z),ye=ct.__ignoreDepthValues!==void 0?ct.__ignoreDepthValues:!1;ye===!1&&(Z.depthBuffer&&(Ee|=t.DEPTH_BUFFER_BIT),Z.stencilBuffer&&(Ee|=t.STENCIL_BUFFER_BIT)),i.bindFramebuffer(t.READ_FRAMEBUFFER,ct.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,ct.__webglFramebuffer),ye===!0&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[je]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[je])),t.blitFramebuffer(0,0,j,_e,0,0,j,_e,Ee,t.NEAREST),m&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,We),i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,ct.__webglMultisampledFramebuffer)}}function Ne(Z){return Math.min(f,Z.samples)}function Ye(Z){let j=r.get(Z);return l&&Z.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&j.__useRenderToTexture!==!1}function Ae(Z){let j=a.render.frame;v.get(Z)!==j&&(v.set(Z,j),Z.update())}function Ft(Z,j){let _e=Z.encoding,Ee=Z.format,We=Z.type;return Z.isCompressedTexture===!0||Z.isVideoTexture===!0||Z.format===Tc||_e!==Vr&&(_e===Qt?l===!1?e.has("EXT_sRGB")===!0&&Ee===or?(Z.format=Tc,Z.minFilter=$i,Z.generateMipmaps=!1):j=wh.sRGBToLinear(j):(Ee!==or||We!==jn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",_e)),j}this.allocateTextureUnit=k,this.resetTextureUnits=I,this.setTexture2D=F,this.setTexture2DArray=W,this.setTexture3D=V,this.setTextureCube=N,this.rebindTextures=ge,this.setupRenderTarget=Me,this.updateRenderTargetMipmap=ze,this.updateMultisampleRenderTarget=He,this.setupDepthRenderbuffer=te,this.setupFrameBufferTexture=Y,this.useMultisampledRTT=Ye}function YR(t,e,i){let r=i.isWebGL2;function n(o,a=null){let l;if(o===jn)return t.UNSIGNED_BYTE;if(o===qT)return t.UNSIGNED_SHORT_4_4_4_4;if(o===XT)return t.UNSIGNED_SHORT_5_5_5_1;if(o===WT)return t.BYTE;if(o===VT)return t.SHORT;if(o===Io)return t.UNSIGNED_SHORT;if(o===jT)return t.INT;if(o===yh)return t.UNSIGNED_INT;if(o===ws)return t.FLOAT;if(o===to)return r?t.HALF_FLOAT:(l=e.get("OES_texture_half_float"),l!==null?l.HALF_FLOAT_OES:null);if(o===YT)return t.ALPHA;if(o===or)return t.RGBA;if(o===KT)return t.LUMINANCE;if(o===QT)return t.LUMINANCE_ALPHA;if(o===Ss)return t.DEPTH_COMPONENT;if(o===ro)return t.DEPTH_STENCIL;if(o===JT)return t.RED;if(o===ZT)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),t.RGBA;if(o===Tc)return l=e.get("EXT_sRGB"),l!==null?l.SRGB_ALPHA_EXT:null;if(o===$T)return t.RED_INTEGER;if(o===eA)return t.RG;if(o===tA)return t.RG_INTEGER;if(o===iA)return t.RGBA_INTEGER;if(o===Sm||o===Cm||o===Mm||o===Em)if(a===Qt)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(o===Sm)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===Cm)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===Mm)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===Em)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(o===Sm)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===Cm)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===Mm)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===Em)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===Py||o===Ry||o===Ly||o===Oy)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(o===Py)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===Ry)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===Ly)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===Oy)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===rA)return l=e.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===Dy||o===Iy)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(o===Dy)return a===Qt?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(o===Iy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===ky||o===Fy||o===By||o===Ny||o===Uy||o===Gy||o===zy||o===Hy||o===Wy||o===Vy||o===jy||o===qy||o===Xy||o===Yy)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(o===ky)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===Fy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===By)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===Ny)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===Uy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===Gy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===zy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===Hy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===Wy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===Vy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===jy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===qy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===Xy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===Yy)return a===Qt?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===Zy)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(o===Zy)return a===Qt?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return o===io?r?t.UNSIGNED_INT_24_8:(l=e.get("WEBGL_depth_texture"),l!==null?l.UNSIGNED_INT_24_8_WEBGL:null):t[o]!==void 0?t[o]:null}return{convert:n}}var Hc=class extends Vi{constructor(e=[]){super(),this.cameras=e}};Hc.prototype.isArrayCamera=!0;var Xr=class extends Xt{constructor(){super(),this.type="Group"}};Xr.prototype.isGroup=!0;var m6={type:"move"},Gh=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Xr,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Xr,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Xr,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,r){let n=null,o=null,a=null,l=this._targetRay,h=this._grip,u=this._hand;if(e&&i.session.visibilityState!=="visible-blurred")if(l!==null&&(n=i.getPose(e.targetRaySpace,r),n!==null&&(l.matrix.fromArray(n.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),n.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(n.linearVelocity)):l.hasLinearVelocity=!1,n.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(n.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(m6))),u&&e.hand){a=!0;for(let g of e.hand.values()){let p=i.getJointPose(g,r);if(u.joints[g.jointName]===void 0){let x=new Xr;x.matrixAutoUpdate=!1,x.visible=!1,u.joints[g.jointName]=x,u.add(x)}let _=u.joints[g.jointName];p!==null&&(_.matrix.fromArray(p.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.jointRadius=p.radius),_.visible=p!==null}let c=u.joints["index-finger-tip"],f=u.joints["thumb-tip"],d=c.position.distanceTo(f.position),m=.02,v=.005;u.inputState.pinching&&d>m+v?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&d<=m-v&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else h!==null&&e.gripSpace&&(o=i.getPose(e.gripSpace,r),o!==null&&(h.matrix.fromArray(o.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),o.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(o.linearVelocity)):h.hasLinearVelocity=!1,o.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(o.angularVelocity)):h.hasAngularVelocity=!1));return l!==null&&(l.visible=n!==null),h!==null&&(h.visible=o!==null),u!==null&&(u.visible=a!==null),this}};var Wc=class extends vi{constructor(e,i,r,n,o,a,l,h,u,c){if(c=c!==void 0?c:Ss,c!==Ss&&c!==ro)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&c===Ss&&(r=Io),r===void 0&&c===ro&&(r=io),super(null,n,o,a,l,h,c,r,u),this.image={width:e,height:i},this.magFilter=l!==void 0?l:Ji,this.minFilter=h!==void 0?h:Ji,this.flipY=!1,this.generateMipmaps=!1}};Wc.prototype.isDepthTexture=!0;var tg=class extends Er{constructor(e,i){super();let r=this,n=null,o=1,a=null,l="local-floor",h=null,u=null,c=null,f=null,d=null,m=i.getContextAttributes(),v=null,g=null,p=[],_=new Map,x=new Vi;x.layers.enable(1),x.viewport=new jt;let b=new Vi;b.layers.enable(2),b.viewport=new jt;let y=[x,b],w=new Hc;w.layers.enable(1),w.layers.enable(2);let S=null,R=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(k){let B=p[k];return B===void 0&&(B=new Gh,p[k]=B),B.getTargetRaySpace()},this.getControllerGrip=function(k){let B=p[k];return B===void 0&&(B=new Gh,p[k]=B),B.getGripSpace()},this.getHand=function(k){let B=p[k];return B===void 0&&(B=new Gh,p[k]=B),B.getHandSpace()};function E(k){let B=_.get(k.inputSource);B&&B.dispatchEvent({type:k.type,data:k.inputSource})}function T(){_.forEach(function(k,B){k.disconnect(B)}),_.clear(),S=null,R=null,e.setRenderTarget(v),f=null,c=null,u=null,n=null,g=null,I.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(k){o=k,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(k){l=k,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getBaseLayer=function(){return c!==null?c:f},this.getBinding=function(){return u},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(k){if(n=k,n!==null){if(v=e.getRenderTarget(),n.addEventListener("select",E),n.addEventListener("selectstart",E),n.addEventListener("selectend",E),n.addEventListener("squeeze",E),n.addEventListener("squeezestart",E),n.addEventListener("squeezeend",E),n.addEventListener("end",T),n.addEventListener("inputsourceschange",A),m.xrCompatible!==!0&&await i.makeXRCompatible(),n.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let B={antialias:n.renderState.layers===void 0?m.antialias:!0,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:o};f=new XRWebGLLayer(n,i,B),n.updateRenderState({baseLayer:f}),g=new Tr(f.framebufferWidth,f.framebufferHeight,{format:or,type:jn,encoding:e.outputEncoding})}else{let B=null,F=null,W=null;m.depth&&(W=m.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,B=m.stencil?ro:Ss,F=m.stencil?io:Io);let V={colorFormat:e.outputEncoding===Qt?i.SRGB8_ALPHA8:i.RGBA8,depthFormat:W,scaleFactor:o};u=new XRWebGLBinding(n,i),c=u.createProjectionLayer(V),n.updateRenderState({layers:[c]}),g=new Tr(c.textureWidth,c.textureHeight,{format:or,type:jn,depthTexture:new Wc(c.textureWidth,c.textureHeight,F,void 0,void 0,void 0,void 0,void 0,void 0,B),stencilBuffer:m.stencil,encoding:e.outputEncoding,samples:m.antialias?4:0});let N=e.properties.get(g);N.__ignoreDepthValues=c.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(1),a=await n.requestReferenceSpace(l),I.setContext(n),I.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};function A(k){let B=n.inputSources;for(let F=0;F<p.length;F++)_.set(B[F],p[F]);for(let F=0;F<k.removed.length;F++){let W=k.removed[F],V=_.get(W);V&&(V.dispatchEvent({type:"disconnected",data:W}),_.delete(W))}for(let F=0;F<k.added.length;F++){let W=k.added[F],V=_.get(W);V&&V.dispatchEvent({type:"connected",data:W})}}let C=new q,M=new q;function D(k,B,F){C.setFromMatrixPosition(B.matrixWorld),M.setFromMatrixPosition(F.matrixWorld);let W=C.distanceTo(M),V=B.projectionMatrix.elements,N=F.projectionMatrix.elements,ne=V[14]/(V[10]-1),ie=V[14]/(V[10]+1),Q=(V[9]+1)/V[5],K=(V[9]-1)/V[5],de=(V[8]-1)/V[0],re=(N[8]+1)/N[0],Y=ne*de,U=ne*re,z=W/(-de+re),te=z*-de;B.matrixWorld.decompose(k.position,k.quaternion,k.scale),k.translateX(te),k.translateZ(z),k.matrixWorld.compose(k.position,k.quaternion,k.scale),k.matrixWorldInverse.copy(k.matrixWorld).invert();let ge=ne+z,Me=ie+z,ze=Y-te,He=U+(W-te),Ne=Q*ie/Me*ge,Ye=K*ie/Me*ge;k.projectionMatrix.makePerspective(ze,He,Ne,Ye,ge,Me)}function O(k,B){B===null?k.matrixWorld.copy(k.matrix):k.matrixWorld.multiplyMatrices(B.matrixWorld,k.matrix),k.matrixWorldInverse.copy(k.matrixWorld).invert()}this.updateCamera=function(k){if(n===null)return;w.near=b.near=x.near=k.near,w.far=b.far=x.far=k.far,(S!==w.near||R!==w.far)&&(n.updateRenderState({depthNear:w.near,depthFar:w.far}),S=w.near,R=w.far);let B=k.parent,F=w.cameras;O(w,B);for(let V=0;V<F.length;V++)O(F[V],B);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),k.position.copy(w.position),k.quaternion.copy(w.quaternion),k.scale.copy(w.scale),k.matrix.copy(w.matrix),k.matrixWorld.copy(w.matrixWorld);let W=k.children;for(let V=0,N=W.length;V<N;V++)W[V].updateMatrixWorld(!0);F.length===2?D(w,x,b):w.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){if(c!==null)return c.fixedFoveation;if(f!==null)return f.fixedFoveation},this.setFoveation=function(k){c!==null&&(c.fixedFoveation=k),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=k)};let P=null;function L(k,B){if(h=B.getViewerPose(a),d=B,h!==null){let W=h.views;f!==null&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let V=!1;W.length!==w.cameras.length&&(w.cameras.length=0,V=!0);for(let N=0;N<W.length;N++){let ne=W[N],ie=null;if(f!==null)ie=f.getViewport(ne);else{let K=u.getViewSubImage(c,ne);ie=K.viewport,N===0&&(e.setRenderTargetTextures(g,K.colorTexture,c.ignoreDepthValues?void 0:K.depthStencilTexture),e.setRenderTarget(g))}let Q=y[N];Q.matrix.fromArray(ne.transform.matrix),Q.projectionMatrix.fromArray(ne.projectionMatrix),Q.viewport.set(ie.x,ie.y,ie.width,ie.height),N===0&&w.matrix.copy(Q.matrix),V===!0&&w.cameras.push(Q)}}let F=n.inputSources;for(let W=0;W<p.length;W++){let V=p[W],N=F[W];V.update(N,B,a)}P&&P(k,B),d=null}let I=new Nm;I.setAnimationLoop(L),this.setAnimationLoop=function(k){P=k},this.dispose=function(){}}};function ZR(t,e){function i(g,p){g.fogColor.value.copy(p.color),p.isFog?(g.fogNear.value=p.near,g.fogFar.value=p.far):p.isFogExp2&&(g.fogDensity.value=p.density)}function r(g,p,_,x,b){p.isMeshBasicMaterial||p.isMeshLambertMaterial?n(g,p):p.isMeshToonMaterial?(n(g,p),c(g,p)):p.isMeshPhongMaterial?(n(g,p),u(g,p)):p.isMeshStandardMaterial?(n(g,p),f(g,p),p.isMeshPhysicalMaterial&&d(g,p,b)):p.isMeshMatcapMaterial?(n(g,p),m(g,p)):p.isMeshDepthMaterial?n(g,p):p.isMeshDistanceMaterial?(n(g,p),v(g,p)):p.isMeshNormalMaterial?n(g,p):p.isLineBasicMaterial?(o(g,p),p.isLineDashedMaterial&&a(g,p)):p.isPointsMaterial?l(g,p,_,x):p.isSpriteMaterial?h(g,p):p.isShadowMaterial?(g.color.value.copy(p.color),g.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function n(g,p){g.opacity.value=p.opacity,p.color&&g.diffuse.value.copy(p.color),p.emissive&&g.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(g.map.value=p.map),p.alphaMap&&(g.alphaMap.value=p.alphaMap),p.bumpMap&&(g.bumpMap.value=p.bumpMap,g.bumpScale.value=p.bumpScale,p.side===Gi&&(g.bumpScale.value*=-1)),p.displacementMap&&(g.displacementMap.value=p.displacementMap,g.displacementScale.value=p.displacementScale,g.displacementBias.value=p.displacementBias),p.emissiveMap&&(g.emissiveMap.value=p.emissiveMap),p.normalMap&&(g.normalMap.value=p.normalMap,g.normalScale.value.copy(p.normalScale),p.side===Gi&&g.normalScale.value.negate()),p.specularMap&&(g.specularMap.value=p.specularMap),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest);let _=e.get(p).envMap;if(_&&(g.envMap.value=_,g.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=p.reflectivity,g.ior.value=p.ior,g.refractionRatio.value=p.refractionRatio),p.lightMap){g.lightMap.value=p.lightMap;let y=t.physicallyCorrectLights!==!0?Math.PI:1;g.lightMapIntensity.value=p.lightMapIntensity*y}p.aoMap&&(g.aoMap.value=p.aoMap,g.aoMapIntensity.value=p.aoMapIntensity);let x;p.map?x=p.map:p.specularMap?x=p.specularMap:p.displacementMap?x=p.displacementMap:p.normalMap?x=p.normalMap:p.bumpMap?x=p.bumpMap:p.roughnessMap?x=p.roughnessMap:p.metalnessMap?x=p.metalnessMap:p.alphaMap?x=p.alphaMap:p.emissiveMap?x=p.emissiveMap:p.clearcoatMap?x=p.clearcoatMap:p.clearcoatNormalMap?x=p.clearcoatNormalMap:p.clearcoatRoughnessMap?x=p.clearcoatRoughnessMap:p.specularIntensityMap?x=p.specularIntensityMap:p.specularColorMap?x=p.specularColorMap:p.transmissionMap?x=p.transmissionMap:p.thicknessMap?x=p.thicknessMap:p.sheenColorMap?x=p.sheenColorMap:p.sheenRoughnessMap&&(x=p.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),g.uvTransform.value.copy(x.matrix));let b;p.aoMap?b=p.aoMap:p.lightMap&&(b=p.lightMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),g.uv2Transform.value.copy(b.matrix))}function o(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity}function a(g,p){g.dashSize.value=p.dashSize,g.totalSize.value=p.dashSize+p.gapSize,g.scale.value=p.scale}function l(g,p,_,x){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.size.value=p.size*_,g.scale.value=x*.5,p.map&&(g.map.value=p.map),p.alphaMap&&(g.alphaMap.value=p.alphaMap),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest);let b;p.map?b=p.map:p.alphaMap&&(b=p.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),g.uvTransform.value.copy(b.matrix))}function h(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.rotation.value=p.rotation,p.map&&(g.map.value=p.map),p.alphaMap&&(g.alphaMap.value=p.alphaMap),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest);let _;p.map?_=p.map:p.alphaMap&&(_=p.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),g.uvTransform.value.copy(_.matrix))}function u(g,p){g.specular.value.copy(p.specular),g.shininess.value=Math.max(p.shininess,1e-4)}function c(g,p){p.gradientMap&&(g.gradientMap.value=p.gradientMap)}function f(g,p){g.roughness.value=p.roughness,g.metalness.value=p.metalness,p.roughnessMap&&(g.roughnessMap.value=p.roughnessMap),p.metalnessMap&&(g.metalnessMap.value=p.metalnessMap),e.get(p).envMap&&(g.envMapIntensity.value=p.envMapIntensity)}function d(g,p,_){g.ior.value=p.ior,p.sheen>0&&(g.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),g.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(g.sheenColorMap.value=p.sheenColorMap),p.sheenRoughnessMap&&(g.sheenRoughnessMap.value=p.sheenRoughnessMap)),p.clearcoat>0&&(g.clearcoat.value=p.clearcoat,g.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(g.clearcoatMap.value=p.clearcoatMap),p.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap),p.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),g.clearcoatNormalMap.value=p.clearcoatNormalMap,p.side===Gi&&g.clearcoatNormalScale.value.negate())),p.transmission>0&&(g.transmission.value=p.transmission,g.transmissionSamplerMap.value=_.texture,g.transmissionSamplerSize.value.set(_.width,_.height),p.transmissionMap&&(g.transmissionMap.value=p.transmissionMap),g.thickness.value=p.thickness,p.thicknessMap&&(g.thicknessMap.value=p.thicknessMap),g.attenuationDistance.value=p.attenuationDistance,g.attenuationColor.value.copy(p.attenuationColor)),g.specularIntensity.value=p.specularIntensity,g.specularColor.value.copy(p.specularColor),p.specularIntensityMap&&(g.specularIntensityMap.value=p.specularIntensityMap),p.specularColorMap&&(g.specularColorMap.value=p.specularColorMap)}function m(g,p){p.matcap&&(g.matcap.value=p.matcap)}function v(g,p){g.referencePosition.value.copy(p.referencePosition),g.nearDistance.value=p.nearDistance,g.farDistance.value=p.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}var Ra=class extends Xt{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),i}};Ra.prototype.isScene=!0;var Yr=class extends wt{constructor(e,i,r,n=1){typeof r=="number"&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,i,r),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};Yr.prototype.isInstancedBufferAttribute=!0;var Oi=class extends Pr{constructor(e){super(),this.type="LineBasicMaterial",this.color=new $e(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}};Oi.prototype.isLineBasicMaterial=!0;var KR=new q,QR=new q,JR=new gt,Rx=new Ea,ig=new hn,La=class extends Xt{constructor(e=new _t,i=new Oi){super(),this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let i=e.attributes.position,r=[0];for(let n=1,o=i.count;n<o;n++)KR.fromBufferAttribute(i,n-1),QR.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=KR.distanceTo(QR);e.setAttribute("lineDistance",new Bt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,i){let r=this.geometry,n=this.matrixWorld,o=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),ig.copy(r.boundingSphere),ig.applyMatrix4(n),ig.radius+=o,e.ray.intersectsSphere(ig)===!1)return;JR.copy(n).invert(),Rx.copy(e.ray).applyMatrix4(JR);let l=o/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,u=new q,c=new q,f=new q,d=new q,m=this.isLineSegments?2:1;if(r.isBufferGeometry){let v=r.index,p=r.attributes.position;if(v!==null){let _=Math.max(0,a.start),x=Math.min(v.count,a.start+a.count);for(let b=_,y=x-1;b<y;b+=m){let w=v.getX(b),S=v.getX(b+1);if(u.fromBufferAttribute(p,w),c.fromBufferAttribute(p,S),Rx.distanceSqToSegment(u,c,d,f)>h)continue;d.applyMatrix4(this.matrixWorld);let E=e.ray.origin.distanceTo(d);E<e.near||E>e.far||i.push({distance:E,point:f.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{let _=Math.max(0,a.start),x=Math.min(p.count,a.start+a.count);for(let b=_,y=x-1;b<y;b+=m){if(u.fromBufferAttribute(p,b),c.fromBufferAttribute(p,b+1),Rx.distanceSqToSegment(u,c,d,f)>h)continue;d.applyMatrix4(this.matrixWorld);let S=e.ray.origin.distanceTo(d);S<e.near||S>e.far||i.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else r.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let i=e.morphAttributes,r=Object.keys(i);if(r.length>0){let n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=n.length;o<a;o++){let l=n[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=o}}}}else{let i=e.morphTargets;i!==void 0&&i.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};La.prototype.isLine=!0;var $R=new q,eL=new q,cn=class extends La{constructor(e,i){super(e,i),this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let i=e.attributes.position,r=[];for(let n=0,o=i.count;n<o;n+=2)$R.fromBufferAttribute(i,n),eL.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+$R.distanceTo(eL);e.setAttribute("lineDistance",new Bt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};cn.prototype.isLineSegments=!0;var El=class extends _t{constructor(e=1,i=8,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);let o=[],a=[],l=[],h=[],u=new q,c=new ot;a.push(0,0,0),l.push(0,0,1),h.push(.5,.5);for(let f=0,d=3;f<=i;f++,d+=3){let m=r+f/i*n;u.x=e*Math.cos(m),u.y=e*Math.sin(m),a.push(u.x,u.y,u.z),l.push(0,0,1),c.x=(a[d]/e+1)/2,c.y=(a[d+1]/e+1)/2,h.push(c.x,c.y)}for(let f=1;f<=i;f++)o.push(f,f+1,0);this.setIndex(o),this.setAttribute("position",new Bt(a,3)),this.setAttribute("normal",new Bt(l,3)),this.setAttribute("uv",new Bt(h,2))}static fromJSON(e){return new El(e.radius,e.segments,e.thetaStart,e.thetaLength)}};var lr=class extends Pr{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new $e(16777215),this.specular=new $e(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xh,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=va,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}};lr.prototype.isMeshPhongMaterial=!0;var Lx={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};var Ox=class{constructor(e,i,r){let n=this,o=!1,a=0,l=0,h,u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(c){l++,o===!1&&n.onStart!==void 0&&n.onStart(c,a,l),o=!0},this.itemEnd=function(c){a++,n.onProgress!==void 0&&n.onProgress(c,a,l),a===l&&(o=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(c){n.onError!==void 0&&n.onError(c)},this.resolveURL=function(c){return h?h(c):c},this.setURLModifier=function(c){return h=c,this},this.addHandler=function(c,f){return u.push(c,f),this},this.removeHandler=function(c){let f=u.indexOf(c);return f!==-1&&u.splice(f,2),this},this.getHandler=function(c){for(let f=0,d=u.length;f<d;f+=2){let m=u[f],v=u[f+1];if(m.global&&(m.lastIndex=0),m.test(c))return v}return null}}},rg=new Ox;var ng=class{constructor(e){this.manager=e!==void 0?e:rg,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){let r=this;return new Promise(function(n,o){r.load(e,n,i,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};var qo={},Tl=class extends ng{constructor(e){super(e)}load(e,i,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let o=Lx.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(o),this.manager.itemEnd(e)},0),o;if(qo[e]!==void 0){qo[e].push({onLoad:i,onProgress:r,onError:n});return}qo[e]=[],qo[e].push({onLoad:i,onProgress:r,onError:n});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,h=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||u.body===void 0||u.body.getReader===void 0)return u;let c=qo[e],f=u.body.getReader(),d=u.headers.get("Content-Length"),m=d?parseInt(d):0,v=m!==0,g=0,p=new ReadableStream({start(_){x();function x(){f.read().then(({done:b,value:y})=>{if(b)_.close();else{g+=y.byteLength;let w=new ProgressEvent("progress",{lengthComputable:v,loaded:g,total:m});for(let S=0,R=c.length;S<R;S++){let E=c[S];E.onProgress&&E.onProgress(w)}_.enqueue(y),x()}})}}});return new Response(p)}else throw Error(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`)}).then(u=>{switch(h){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(c=>new DOMParser().parseFromString(c,l));case"json":return u.json();default:if(l===void 0)return u.text();{let f=/charset="?([^;"\s]*)"?/i.exec(l),d=f&&f[1]?f[1].toLowerCase():void 0,m=new TextDecoder(d);return u.arrayBuffer().then(v=>m.decode(v))}}}).then(u=>{Lx.add(e,u);let c=qo[e];delete qo[e];for(let f=0,d=c.length;f<d;f++){let m=c[f];m.onLoad&&m.onLoad(u)}}).catch(u=>{let c=qo[e];if(c===void 0)throw this.manager.itemError(e),u;delete qo[e];for(let f=0,d=c.length;f<d;f++){let m=c[f];m.onError&&m.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};var Al=class extends Xt{constructor(e,i=1){super(),this.type="Light",this.color=new $e(e),this.intensity=i}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}};Al.prototype.isLight=!0;var tL=new gt,iL=new q,rL=new q,sg=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ot(512,512),this.map=null,this.mapPass=null,this.matrix=new gt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new wa,this._frameExtents=new ot(1,1),this._viewportCount=1,this._viewports=[new jt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let i=this.camera,r=this.matrix;iL.setFromMatrixPosition(e.matrixWorld),i.position.copy(iL),rL.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(rL),i.updateMatrixWorld(),tL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(tL),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(i.projectionMatrix),r.multiply(i.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}};var Vc=class extends sg{constructor(){super(new jo(-5,5,5,-5,.5,500))}};Vc.prototype.isDirectionalLightShadow=!0;var zh=class extends Al{constructor(e,i){super(e,i),this.type="DirectionalLight",this.position.copy(Xt.DefaultUp),this.updateMatrix(),this.target=new Xt,this.shadow=new Vc}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};zh.prototype.isDirectionalLight=!0;var jc=class extends Al{constructor(e,i){super(e,i),this.type="AmbientLight"}};jc.prototype.isAmbientLight=!0;var Pl=class extends _t{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};Pl.prototype.isInstancedBufferGeometry=!0;var Rl=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Rl(this.value.clone===void 0?this.value:this.value.clone())}};var og=class{constructor(e,i,r=0,n=1/0){this.ray=new Ea(e,i),this.near=r,this.far=n,this.camera=null,this.layers=new Ca,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}intersectObject(e,i=!0,r=[]){return Dx(e,this,r,i),r.sort(nL),r}intersectObjects(e,i=!0,r=[]){for(let n=0,o=e.length;n<o;n++)Dx(e[n],this,r,i);return r.sort(nL),r}};function nL(t,e){return t.distance-e.distance}function Dx(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),r===!0){let n=t.children;for(let o=0,a=n.length;o<a;o++)Dx(n[o],e,i,!0)}}var qc=class{constructor(e=1,i=0,r=0){return this.radius=e,this.phi=i,this.theta=r,this}set(e,i,r){return this.radius=e,this.phi=i,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(er(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}};var sL=new q,ag=new q,oL=new q,Xc=class extends Xt{constructor(e,i,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,i===void 0&&(i=1);let n=new _t;n.setAttribute("position",new Bt([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));let o=new Oi({fog:!1,toneMapped:!1});this.lightPlane=new La(n,o),this.add(this.lightPlane),n=new _t,n.setAttribute("position",new Bt([0,0,0,0,0,1],3)),this.targetLine=new La(n,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){sL.setFromMatrixPosition(this.light.matrixWorld),ag.setFromMatrixPosition(this.light.target.matrixWorld),oL.subVectors(ag,sL),this.lightPlane.lookAt(ag),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ag),this.targetLine.scale.z=oL.length()}};var lg=new q,Ti=new Vo,Yc=class extends cn{constructor(e){let i=new _t,r=new Oi({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],o=[],a={},l=new $e(16755200),h=new $e(16711680),u=new $e(43775),c=new $e(16777215),f=new $e(3355443);d("n1","n2",l),d("n2","n4",l),d("n4","n3",l),d("n3","n1",l),d("f1","f2",l),d("f2","f4",l),d("f4","f3",l),d("f3","f1",l),d("n1","f1",l),d("n2","f2",l),d("n3","f3",l),d("n4","f4",l),d("p","n1",h),d("p","n2",h),d("p","n3",h),d("p","n4",h),d("u1","u2",u),d("u2","u3",u),d("u3","u1",u),d("c","t",c),d("p","c",f),d("cn1","cn2",f),d("cn3","cn4",f),d("cf1","cf2",f),d("cf3","cf4",f);function d(v,g,p){m(v,p),m(g,p)}function m(v,g){n.push(0,0,0),o.push(g.r,g.g,g.b),a[v]===void 0&&(a[v]=[]),a[v].push(n.length/3-1)}i.setAttribute("position",new Bt(n,3)),i.setAttribute("color",new Bt(o,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){let e=this.geometry,i=this.pointMap,r=1,n=1;Ti.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Di("c",i,e,Ti,0,0,-1),Di("t",i,e,Ti,0,0,1),Di("n1",i,e,Ti,-r,-n,-1),Di("n2",i,e,Ti,r,-n,-1),Di("n3",i,e,Ti,-r,n,-1),Di("n4",i,e,Ti,r,n,-1),Di("f1",i,e,Ti,-r,-n,1),Di("f2",i,e,Ti,r,-n,1),Di("f3",i,e,Ti,-r,n,1),Di("f4",i,e,Ti,r,n,1),Di("u1",i,e,Ti,r*.7,n*1.1,-1),Di("u2",i,e,Ti,-r*.7,n*1.1,-1),Di("u3",i,e,Ti,0,n*2,-1),Di("cf1",i,e,Ti,-r,0,1),Di("cf2",i,e,Ti,r,0,1),Di("cf3",i,e,Ti,0,-n,1),Di("cf4",i,e,Ti,0,n,1),Di("cn1",i,e,Ti,-r,0,-1),Di("cn2",i,e,Ti,r,0,-1),Di("cn3",i,e,Ti,0,-n,-1),Di("cn4",i,e,Ti,0,n,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Di(t,e,i,r,n,o,a){lg.set(n,o,a).unproject(r);let l=e[t];if(l!==void 0){let h=i.getAttribute("position");for(let u=0,c=l.length;u<c;u++)h.setXYZ(l[u],lg.x,lg.y,lg.z)}}function Ix(t){this.manager=t!==void 0?t:THREE.DefaultLoadingManager}typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:bc}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=bc);Ix.prototype={constructor:Ix,load:function(t,e,i,r){let n=this,o=new Tl(n.manager);o.setResponseType("arraybuffer"),o.load(t,function(a){e(n.parse(a))},i,r)},parse:function(t){function e(l){let h,u,c,f;if(f=new DataView(l),u=32/8*3+32/8*3*3+16/8,c=f.getUint32(80,!0),h=80+32/8+c*u,h===f.byteLength)return!0;let d=[115,111,108,105,100];for(let m=0;m<5;m++)if(d[m]!==f.getUint8(m))return!0;return!1}function i(l){let h=new DataView(l),u=h.getUint32(80,!0),c,f,d,m=!1,v,g,p,_,x;for(let E=0;E<80-10;E++)h.getUint32(E,!1)===1129270351&&h.getUint8(E+4)===82&&h.getUint8(E+5)===61&&(m=!0,v=[],g=h.getUint8(E+6)/255,p=h.getUint8(E+7)/255,_=h.getUint8(E+8)/255,x=h.getUint8(E+9)/255);let b=84,y=12*4+2,w=new _t,S=[],R=[];for(let E=0;E<u;E++){let T=b+E*y,A=h.getFloat32(T,!0),C=h.getFloat32(T+4,!0),M=h.getFloat32(T+8,!0);if(m){let D=h.getUint16(T+48,!0);D&32768?(c=g,f=p,d=_):(c=(D&31)/31,f=(D>>5&31)/31,d=(D>>10&31)/31)}for(let D=1;D<=3;D++){let O=T+D*12;S.push(h.getFloat32(O,!0)),S.push(h.getFloat32(O+4,!0)),S.push(h.getFloat32(O+8,!0)),R.push(A,C,M),m&&v.push(c,f,d)}}return w.setAttribute("position",new wt(new Float32Array(S),3)),w.setAttribute("normal",new wt(new Float32Array(R),3)),m&&(w.setAttribute("color",new wt(new Float32Array(v),3)),w.hasColors=!0,w.alpha=x),w}function r(l){let h=new _t,u=/facet([\s\S]*?)endfacet/g,c=0,f=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,d=new RegExp("vertex"+f+f+f,"g"),m=new RegExp("normal"+f+f+f,"g"),v=[],g=[],p=new q,_;for(;(_=u.exec(l))!==null;){let x=0,b=0,y=_[0];for(;(_=m.exec(y))!==null;)p.x=parseFloat(_[1]),p.y=parseFloat(_[2]),p.z=parseFloat(_[3]),b++;for(;(_=d.exec(y))!==null;)v.push(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])),g.push(p.x,p.y,p.z),x++;b!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+c),x!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+c),c++}return h.setAttribute("position",new Bt(v,3)),h.setAttribute("normal",new Bt(g,3)),h}function n(l){if(typeof l!="string"){let h=new Uint8Array(l);if(window.TextDecoder!==void 0)return new TextDecoder().decode(h);let u="",c=0,f=l.byteLength;for(;c<f;c++)u+=String.fromCharCode(h[c]);return u}else return l}function o(l){if(typeof l=="string"){let h=new Uint8Array(l.length);for(let u=0;u<l.length;u++)h[u]=l.charCodeAt(u)&255;return h.buffer||h}else return l}let a=o(t);return e(a)?i(a):r(n(t))}};var Hh=function(t){this.manager=t!==void 0?t:rg},aL=1;Hh.prototype={constructor:Hh,load:function(t,e,i,r){let n=this,o=new Tl(n.manager);o.setResponseType("arraybuffer");let a="RMFLoad"+aL;aL++,o.load(t,function(l){e(n.parse(l,a))},i,r)},parse:function(t,e){let i=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647,4294967295];function r(p){let _;if(p.bitsLeft>=p.bits)return _=(p.bitBuffer>>p.bitsLeft-p.bits&i[p.bits])>>>0,p.bitsLeft-=p.bits,_;let x=p.bits-p.bitsLeft;return _=(p.bitBuffer&i[p.bitsLeft])<<x,p.bitBuffer=p.reader.getUint32(p.pos,!0),p.pos+=4,p.bitsLeft=32-x,_=(_|p.bitBuffer>>p.bitsLeft&i[x])>>>0,_}let n=new DataView(t),o=new _t,a=8,l;if(n.getUint8(0)!==64||n.getUint8(1)!==114||n.getUint8(2)!==109||n.getUint8(3)!==102)return console.error("wrong format ",n.getUint8(0),n.getUint8(1),n.getUint8(2),n.getUint8(3)),null;let h=n.getUint32(4,!0),u,c,f=new TextDecoder("utf-8"),d={},m=[];function v(){let p=l;for(;n.getUint8(l);)l++;let _=l-p;l++;let x=new Uint8Array(_);for(let b=0;b<_;b++)x[b]=n.getUint8(p+b);return f.decode(x)}function g(){c!==void 0&&(o.setIndex(new wt(c,1)),o.setAttribute("position",new wt(u,3)),o.computeVertexNormals(),o.computeBoundingSphere(),m.push({geometry:o,params:d}),d={},o=new _t)}for(;a<n.byteLength;){let p=n.getUint32(a,!0),_=n.getUint32(a+4,!0);switch(a+=8,p){case 2:g(),l=a;let x=n.getUint32(l,!0);l+=4;for(let b=0;b<x;b++){let y=v();d[y]=v()}a+=_;break;case 3:{let b=_/4;u=new Float32Array(b);for(let y=0;y<b;y++)u[y]=n.getFloat32(a+y*4,!0);a+=_}break;case 4:{l=a;let b=n.getUint32(l,!0),y=n.getUint32(l+4,!0);l+=8,y*3<65535?c=new Uint16Array(y*3):c=new Uint32Array(y*3);let w={reader:n,pos:l,bitBuffer:0,bitsLeft:0,bits:b};for(let S=0;S<y*3;S++)c[S]=r(w)}a+=_;break;case 1718448704:h=_,_=8;break;default:a+=_}if(_===0)break}return g(),m}};var Gt={};(function(){let t={type:"change"},e={type:"start"},i={type:"end"};class r extends Er{constructor(a,l){super(),l===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),l===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=a,this.domElement=l,this.domElement.style.touchAction="none",this.requireShiftZoom=!1,this.enabled=!0,this.target=new q,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Lo.ROTATE,MIDDLE:Lo.DOLLY,RIGHT:Lo.PAN},this.touches={ONE:Oo.ROTATE,TWO:Oo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.setPhiTheta=function(G,me){d.phi=G,d.theta=me;let Se=new q,Be=h.object.position,Ze=new Ar().setFromUnitVectors(a.up,new q(0,1,0)).clone().invert();Se.copy(Be).sub(h.target),d.radius*=v,d.radius=Math.max(h.minDistance,Math.min(h.maxDistance,d.radius)),Se.setFromSpherical(d),Se.applyQuaternion(Ze),Be.copy(h.target).add(Se),h.object.lookAt(h.target),m.set(0,0,0),g.set(0,0,0),v=1},this.fromPhiTheta=function(G){let Se=new Ar().setFromUnitVectors(a.up,new q(0,1,0)).clone().invert(),Be=new q,De=this.object.position;d.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,d.theta)),d.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,d.phi)),d.phi=Math.max(f,Math.min(Math.PI-f,d.phi));let Ze=Be.length();G&&(Ze=G),Ze=Math.max(this.minDistance,Math.min(this.maxDistance,Ze)),Be.x=Ze*Math.sin(d.phi)*Math.sin(d.theta),Be.y=Ze*Math.cos(d.phi),Be.z=Ze*Math.sin(d.phi)*Math.cos(d.theta),Be.applyQuaternion(Se),De.copy(this.target).add(Be),this.object.lookAt(this.target),v=1,g.set(0,0,0),h.object.updateProjectionMatrix()},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(G){G.addEventListener("keydown",Ee),this._domElementKeyEvents=G},this.saveState=function(){h.target0.copy(h.target),h.position0.copy(h.object.position),h.zoom0=h.object.zoom},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(t),h.update(),c=u.NONE},this.update=function(){let G=new q,me=new Ar().setFromUnitVectors(a.up,new q(0,1,0)),Se=me.clone().invert(),Be=new q,De=new Ar,Ze=2*Math.PI;return function(){let ft=h.object.position;G.copy(ft).sub(h.target),G.applyQuaternion(me),d.setFromVector3(G),h.autoRotate&&c===u.NONE&&O(M()),h.enableDamping?(d.theta+=m.theta*h.dampingFactor,d.phi+=m.phi*h.dampingFactor):(d.theta+=m.theta,d.phi+=m.phi);let Et=h.minAzimuthAngle,bt=h.maxAzimuthAngle;return isFinite(Et)&&isFinite(bt)&&(Et<-Math.PI?Et+=Ze:Et>Math.PI&&(Et-=Ze),bt<-Math.PI?bt+=Ze:bt>Math.PI&&(bt-=Ze),Et<=bt?d.theta=Math.max(Et,Math.min(bt,d.theta)):d.theta=d.theta>(Et+bt)/2?Math.max(Et,d.theta):Math.min(bt,d.theta)),d.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=v,d.radius=Math.max(h.minDistance,Math.min(h.maxDistance,d.radius)),h.enableDamping===!0?h.target.addScaledVector(g,h.dampingFactor):h.target.add(g),G.setFromSpherical(d),G.applyQuaternion(Se),ft.copy(h.target).add(G),h.object.lookAt(h.target),h.enableDamping===!0?(m.theta*=1-h.dampingFactor,m.phi*=1-h.dampingFactor,g.multiplyScalar(1-h.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),v=1,p||Be.distanceToSquared(h.object.position)>f||8*(1-De.dot(h.object.quaternion))>f?(h.dispatchEvent(t),Be.copy(h.object.position),De.copy(h.object.quaternion),p=!1,!0):!1}}(),this.dispose=function(){h.domElement.removeEventListener("contextmenu",ct),h.domElement.removeEventListener("pointerdown",Ye),h.domElement.removeEventListener("pointercancel",Z),h.domElement.removeEventListener("wheel",this.onMouseWheel),h.domElement.removeEventListener("pointermove",Ae),h.domElement.removeEventListener("pointerup",Ft),h._domElementKeyEvents!==null&&h._domElementKeyEvents.removeEventListener("keydown",Ee)};let h=this,u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},c=u.NONE,f=1e-6,d=new qc,m=new qc,v=1,g=new q,p=!1,_=new ot,x=new ot,b=new ot,y=new ot,w=new ot,S=new ot,R=new ot,E=new ot,T=new ot,A=[],C={};function M(){return 2*Math.PI/60/60*h.autoRotateSpeed}function D(){return Math.pow(.95,h.zoomSpeed)}function O(G){m.theta-=G}this.rotateLeft=G=>{O(G)};function P(G){m.phi-=G}let L=function(){let G=new q;return function(Se,Be){G.setFromMatrixColumn(Be,0),G.multiplyScalar(-Se),g.add(G)}}(),I=function(){let G=new q;return function(Se,Be){h.screenSpacePanning===!0?G.setFromMatrixColumn(Be,1):(G.setFromMatrixColumn(Be,0),G.crossVectors(h.object.up,G)),G.multiplyScalar(Se),g.add(G)}}(),k=function(){let G=new q;return function(Se,Be){let De=h.domElement;if(h.object.isPerspectiveCamera){let Ze=h.object.position;G.copy(Ze).sub(h.target);let Te=G.length();Te*=Math.tan(h.object.fov/2*Math.PI/180),L(2*Se*Te/De.clientHeight,h.object.matrix),I(2*Be*Te/De.clientHeight,h.object.matrix)}else h.object.isOrthographicCamera?(L(Se*(h.object.right-h.object.left)/h.object.zoom/De.clientWidth,h.object.matrix),I(Be*(h.object.top-h.object.bottom)/h.object.zoom/De.clientHeight,h.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),h.enablePan=!1)}}();function B(G){h.object.isPerspectiveCamera?v/=G:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*G)),h.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function F(G){h.object.isPerspectiveCamera?v*=G:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/G)),h.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function W(G){_.set(G.clientX,G.clientY)}function V(G){R.set(G.clientX,G.clientY)}function N(G){y.set(G.clientX,G.clientY)}function ne(G){x.set(G.clientX,G.clientY),b.subVectors(x,_).multiplyScalar(h.rotateSpeed);let me=h.domElement;O(2*Math.PI*b.x/me.clientHeight),P(2*Math.PI*b.y/me.clientHeight),_.copy(x),h.update()}function ie(G){E.set(G.clientX,G.clientY),T.subVectors(E,R),T.y>0?B(D()):T.y<0&&F(D()),R.copy(E),h.update()}function Q(G){w.set(G.clientX,G.clientY),S.subVectors(w,y).multiplyScalar(h.panSpeed),k(S.x,S.y),y.copy(w),h.update()}function K(G){G.deltaY<0?F(D()):G.deltaY>0&&B(D()),h.update()}function de(G){let me=!1;switch(G.code){case h.keys.UP:k(0,h.keyPanSpeed),me=!0;break;case h.keys.BOTTOM:k(0,-h.keyPanSpeed),me=!0;break;case h.keys.LEFT:k(h.keyPanSpeed,0),me=!0;break;case h.keys.RIGHT:k(-h.keyPanSpeed,0),me=!0;break}me&&(G.preventDefault(),h.update())}function re(){if(A.length===1)_.set(A[0].pageX,A[0].pageY);else{let G=.5*(A[0].pageX+A[1].pageX),me=.5*(A[0].pageY+A[1].pageY);_.set(G,me)}}function Y(){if(A.length===1)y.set(A[0].pageX,A[0].pageY);else{let G=.5*(A[0].pageX+A[1].pageX),me=.5*(A[0].pageY+A[1].pageY);y.set(G,me)}}function U(){let G=A[0].pageX-A[1].pageX,me=A[0].pageY-A[1].pageY,Se=Math.sqrt(G*G+me*me);R.set(0,Se)}function z(){h.enableZoom&&U(),h.enablePan&&Y()}function te(){h.enableZoom&&U(),h.enableRotate&&re()}function ge(G){if(A.length===1)x.set(G.pageX,G.pageY);else{let Se=Ve(G),Be=.5*(G.pageX+Se.x),De=.5*(G.pageY+Se.y);x.set(Be,De)}b.subVectors(x,_).multiplyScalar(h.rotateSpeed);let me=h.domElement;O(2*Math.PI*b.x/me.clientHeight),P(2*Math.PI*b.y/me.clientHeight),_.copy(x)}function Me(G){if(A.length===1)w.set(G.pageX,G.pageY);else{let me=Ve(G),Se=.5*(G.pageX+me.x),Be=.5*(G.pageY+me.y);w.set(Se,Be)}S.subVectors(w,y).multiplyScalar(h.panSpeed),k(S.x,S.y),y.copy(w)}function ze(G){let me=Ve(G),Se=G.pageX-me.x,Be=G.pageY-me.y,De=Math.sqrt(Se*Se+Be*Be);E.set(0,De),T.set(0,Math.pow(E.y/R.y,h.zoomSpeed)),B(T.y),R.copy(E)}function He(G){h.enableZoom&&ze(G),h.enablePan&&Me(G)}function Ne(G){h.enableZoom&&ze(G),h.enableRotate&&ge(G)}function Ye(G){h.enabled!==!1&&(A.length===0&&(h.domElement.setPointerCapture(G.pointerId),h.domElement.addEventListener("pointermove",Ae),h.domElement.addEventListener("pointerup",Ft)),ye(G),G.pointerType==="touch"?We(G):j(G))}function Ae(G){h.enabled!==!1&&(G.pointerType==="touch"?je(G):_e(G))}function Ft(G){pt(G),A.length===0&&(h.domElement.releasePointerCapture(G.pointerId),h.domElement.removeEventListener("pointermove",Ae),h.domElement.removeEventListener("pointerup",Ft)),h.dispatchEvent(i),c=u.NONE}function Z(G){pt(G)}function j(G){let me;switch(G.button){case 0:me=h.mouseButtons.LEFT;break;case 1:me=h.mouseButtons.MIDDLE;break;case 2:me=h.mouseButtons.RIGHT;break;default:me=-1}switch(me){case Lo.DOLLY:if(h.enableZoom===!1)return;V(G),c=u.DOLLY;break;case Lo.ROTATE:if(G.ctrlKey||G.metaKey||G.shiftKey){if(h.enablePan===!1)return;N(G),c=u.PAN}else{if(h.enableRotate===!1)return;W(G),c=u.ROTATE}break;case Lo.PAN:if(G.ctrlKey||G.metaKey||G.shiftKey){if(h.enableRotate===!1)return;W(G),c=u.ROTATE}else{if(h.enablePan===!1)return;N(G),c=u.PAN}break;default:c=u.NONE}c!==u.NONE&&h.dispatchEvent(e)}function _e(G){if(h.enabled!==!1)switch(c){case u.ROTATE:if(h.enableRotate===!1)return;ne(G);break;case u.DOLLY:if(h.enableZoom===!1)return;ie(G);break;case u.PAN:if(h.enablePan===!1)return;Q(G);break}}this.onMouseWheel=G=>{h.enabled===!1||h.enableZoom===!1||c!==u.NONE||!G.shiftKey&&this.requireShiftZoom||(G.preventDefault(),h.dispatchEvent(e),K(G),h.dispatchEvent(i))};function Ee(G){h.enabled===!1||h.enablePan===!1||de(G)}function We(G){switch(yt(G),A.length){case 1:switch(h.touches.ONE){case Oo.ROTATE:if(h.enableRotate===!1)return;re(),c=u.TOUCH_ROTATE;break;case Oo.PAN:if(h.enablePan===!1)return;Y(),c=u.TOUCH_PAN;break;default:c=u.NONE}break;case 2:switch(h.touches.TWO){case Oo.DOLLY_PAN:if(h.enableZoom===!1&&h.enablePan===!1)return;z(),c=u.TOUCH_DOLLY_PAN;break;case Oo.DOLLY_ROTATE:if(h.enableZoom===!1&&h.enableRotate===!1)return;te(),c=u.TOUCH_DOLLY_ROTATE;break;default:c=u.NONE}break;default:c=u.NONE}c!==u.NONE&&h.dispatchEvent(e)}function je(G){switch(yt(G),c){case u.TOUCH_ROTATE:if(h.enableRotate===!1)return;ge(G),h.update();break;case u.TOUCH_PAN:if(h.enablePan===!1)return;Me(G),h.update();break;case u.TOUCH_DOLLY_PAN:if(h.enableZoom===!1&&h.enablePan===!1)return;He(G),h.update();break;case u.TOUCH_DOLLY_ROTATE:if(h.enableZoom===!1&&h.enableRotate===!1)return;Ne(G),h.update();break;default:c=u.NONE}}function ct(G){h.enabled!==!1&&G.preventDefault()}function ye(G){A.push(G)}function pt(G){delete C[G.pointerId];for(let me=0;me<A.length;me++)if(A[me].pointerId==G.pointerId){A.splice(me,1);return}}function yt(G){let me=C[G.pointerId];me===void 0&&(me=new ot,C[G.pointerId]=me),me.set(G.pageX,G.pageY)}function Ve(G){let me=G.pointerId===A[0].pointerId?A[1]:A[0];return C[me.pointerId]}h.domElement.addEventListener("contextmenu",ct),h.domElement.addEventListener("pointerdown",Ye),h.domElement.addEventListener("pointercancel",Z),h.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.update()}}class n extends r{constructor(a,l){super(a,l),this.screenSpacePanning=!1,this.mouseButtons.LEFT=Lo.PAN,this.mouseButtons.RIGHT=Lo.ROTATE,this.touches.ONE=Oo.PAN,this.touches.TWO=Oo.DOLLY_ROTATE}}Gt.MapControls=n,Gt.OrbitControls=r})();window.RSUtils={};RSUtils.createAlphaID=function(t){let e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<t;r++)e+=i.charAt(Math.floor(Math.random()*i.length));return e};Array.prototype.sortOn=function(t){this.sort(function(e,i){return e[t]<i[t]?-1:e[t]>i[t]?1:0})};String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.indexOf(t,e)===e});function v6(){let t=!1;if("maxTouchPoints"in navigator)t=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator)t=navigator.msMaxTouchPoints>0;else{let e=window.matchMedia&&matchMedia("(pointer:coarse)");if(e&&e.media==="(pointer:coarse)")t=!!e.matches;else if("orientation"in window)t=!0;else{let i=navigator.userAgent;t=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(i)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(i)}}return t}var ao=v6();window.RSBase=angular.module("RSBase",["ui.router","ngSanitize"]).provider("RSRegistry",[function(){let t=[],e=[];return{registerGlobalSettingsDialog:function(i,r,n,o){t.push({name:i,state:r,icon:n,feature:o})},$get:function(){return{globalSettingsDialogs:t,userSettingsDialogs:e}}}}]).config(["$stateProvider","$qProvider","$httpProvider",function(t,e,i){e.errorOnUnhandledRejections(!1),i.defaults.xsrfCookieName="Csrf-Token",i.defaults.xsrfHeaderName="X-Csrf-Token",i.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var r=function(n){var o="",a,l,h,u,c,f,d;for(a in n)if(l=n[a],l instanceof Array)for(d=0;d<l.length;++d)c=l[d],h=a+"["+d+"]",f={},f[h]=c,o+=r(f)+"&";else if(l instanceof Object)for(u in l)c=l[u],h=a+"["+u+"]",f={},f[h]=c,o+=r(f)+"&";else l!=null&&(o+=encodeURIComponent(a)+"="+encodeURIComponent(l)+"&");return o.length?o.substr(0,o.length-1):o};i.defaults.transformRequest=[function(n){return angular.isObject(n)&&String(n)!=="[object File]"?r(n):n}]}]);function lL(){$(".equalheight").each(function(){let t=0;$(this).children().each(function(){$(this).height()>t&&(t=$(this).height())}),$(this).children().height(t)})}$(window).on("load",lL);$(window).on("resize",lL);var kx=null;function hL(t,e){return kx||(kx=e.get("/manual/index.html")),new Promise((i,r)=>{kx.then(n=>{i(n.data.substring(n.data.indexOf("<!-- MARKSTART:"+t+" -->")+("<!-- MARKSTART:"+t+" -->").length,n.data.indexOf("<!-- MARKEND:"+t+" -->")))},n=>{r(n)})})}function _6(t){return t.replace(/[\-\[\]\/{}()*+?.^$|]/g,"\\$&")}function Zc(t,e,i){return i.replace(new RegExp(_6(t),"g"),e)}var y6=/^-?\d+$/;RSBase.factory("Fullscreen",["$rootScope",function(t){let e={};t.isFullscreen=!1,e.supportsFullscreen=function(){let r=window.document.body;return!!(r.requestFullscreen||r.mozRequestFullScreen||r.webkitRequestFullscreen||r.msRequestFullscreen)},t.supportsFullscreen=e.supportsFullscreen(),e.launchFullscreen=function(r){r.requestFullscreen?(r.requestFullscreen(),t.isFullscreen=!0):r.mozRequestFullScreen?(r.mozRequestFullScreen(),t.isFullscreen=!0):r.webkitRequestFullscreen?(r.webkitRequestFullscreen(),t.isFullscreen=!0):r.msRequestFullscreen&&(r.msRequestFullscreen(),t.isFullscreen=!0)},e.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),t.isFullscreen=!1},e.toggleFullscreen=function(r){t.isFullscreen?e.exitFullscreen():e.launchFullscreen(r)};let i=function(){t.isFullscreen=!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement),t.$broadcast("fullscreenChanged"),t.$digest()};return document.addEventListener("fullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),e}]);RSBase.directive("onFileChange",function(){return{restrict:"A",link:function(t,e,i){let r=t.$eval(i.onFileChange);e.on("change",r),e.on("$destroy",function(){e.off()})}}});RSBase.directive("switch",["$timeout",function(t){return{restrict:"E",scope:{changed:"&"},template:'<input type="checkbox" data-size="small">',replace:!0,require:"ngModel",link:function(e,i,r,n){n.$parsers=[],n.$formatters=[];let o=r.on||"Вкл",a=r.off||"Выкл";n.$formatters.push(function(l){return typeof l!="undefined"&&t(function(){i.bootstrapSwitch("state",!!l)}),l}),e.$on("$destroy",function(){i.bootstrapSwitch("destroy")}),i.on("switchChange.bootstrapSwitch",function(l,h){h=h?1:0,e.$apply(function(){n.$setViewValue(h)}),e.changed&&e.changed({value:h})}),t(function(){i.bootstrapSwitch("state",!!n.$modelValue)}),i.bootstrapSwitch({onText:o,offText:a}),n.$validators.color=function(){return!0}}}}]).directive("ngTouchstart",function(){return{controller:["$scope","$element",function(t,e){e.bind("touchstart",i);function i(r){let n=e.attr("ng-touchstart");t.$event=r,t.$apply(n)}}]}}).directive("boolswitch",["$timeout",function(t){return{restrict:"E",scope:{changed:"&"},template:'<input type="checkbox" data-size="small">',replace:!0,require:"ngModel",link:function(e,i,r,n){let o=r.on||"Вкл",a=r.off||"Выкл",l=!1;n.$formatters.push(function(h){typeof h!="undefined"&&t(function(){h==="false"&&(h=!1),h==="true"&&(h=!0),i.bootstrapSwitch("state",h||!1,!0)})}),i.on("switchChange.bootstrapSwitch",function(h,u){e.$apply(function(){n.$setViewValue(u)}),!l&&e.changed&&e.changed({value:u})}),t(function(){l=!0,i.bootstrapSwitch("state",n.$modelValue||!1),l=!1}),i.bootstrapSwitch({onText:o,offText:a}),e.$on("$destroy",function(){i.bootstrapSwitch("destroy")})}}}]).directive("tempChart",[function(){return{restrict:"E",template:'<div class="flot-chart"><div class="flot-chart-content"></div></div>',replace:!0,scope:{history:"="},link:function(t,e,i){let r=[],n=[],o=[],a=e.children(0),l=[{data:r,label:"Вывод",yaxis:2,color:"#3E714A",lines:{fill:!0,fillColor:"rgba(108,240,139,0.2)",lineWidth:1}},{data:n,label:"Температура",color:"#2D7495",lines:{lineWidth:5}},{data:o,label:"Заданная температура",color:"#A541B4",lines:{lineWidth:1}}],h={xaxes:[{mode:"time",timeFormat:"%M:%S",timezone:"browser"}],yaxes:[{min:0,max:250,alignTicksWithAxis:1,position:"left",tickFormatter:c,family:"sans-serif",size:8},{alignTicksWithAxis:null,position:"right",min:0,max:100,tickFormatter:f}],legend:{position:"sw"},grid:{backgroundColor:document.documentElement.getAttribute("data-theme")==="dark"?"#222222":"#ffffff",hoverable:!0},tooltip:!0,tooltipOpts:{content:"%s for %x was %y",xDateFormat:"%H:%M:%S",onHover:function(p,_){}}};h.legend.show=!1,typeof i.compact!="undefined"&&(h.legend.show=!1,h.tooltip=!1);function u(p){h.grid.backgroundColor=p==="dark"?"#222222":"#ffffff",d=$.plot(a,l,h),d.draw()}function c(p){return p.toFixed(0)+"\xB0C"}function f(p){return p.toFixed(0)+"%"}t.$on("themeChanged",(p,_)=>{u(_)});let d=null,m=!1;d=$.plot(a,l,h),t.$watchCollection("history",function(p){if(typeof p!="undefined"){r.length=0,n.length=0,o.length=0;let _=1e3,x=-1e3;angular.forEach(p,function(b){let y=b.t;b.T>x&&(x=b.T),b.S>x&&(x=b.S),b.T<_&&(_=b.T),b.S<_&&(_=b.S),r.push([y,b.O]),n.push([y,b.T]),o.push([y,b.S])}),_-=5,x+=5,_<0&&(_=0),d.getOptions().yaxes[0].min=_,d.getOptions().yaxes[0].max=x,d.setData(l),d.setupGrid(),d.draw()}}),t.$on("windowResized",function(){a.width()>0&&(d=$.plot(a,l,h))});let v=-1,g=function(){a.width()!==v&&a.width()>0&&(v=a.width(),d=$.plot(a,l,h)),m||setTimeout(g,200)};t.$on("$destroy",function(){m=!0}),g()}}}]).directive("knob",function(){return{restrict:"E",scope:{value:"=",changed:"&"},replace:!0,template:'<div><input type="text" class="dial "></div>',link:function(t,e,i){let r=i.max;$(".dial",e).knob({min:parseFloat(i.min),max:parseFloat(i.max),readOnly:i.readonly==="true",angleOffset:-125,angleArc:250,width:100,height:100,inputColor:"#005B6E",fgColor:"#005B6E",lineCap:"butt",release:function(n){if(isFinite(n)){if(Math.abs(t.value-n)<.01)return;t.value=n,r!==i.max&&(r=Math.max(n,i.max),$(".dial",e).trigger("configure",{max:r})),t.changed&&t.changed({value:n})}},change:function(n){}}),e.addClass("knob"),e[0].style.position="relative",t.$watch("value",function(n){typeof n!="undefined"&&$(".dial",e).val()!==n&&isFinite(Number(n))&&(n>i.max&&(r=n,$(".dial",e).trigger("configure",{max:n})),$(".dial",e).val(n).trigger("change"))}),i.$observe("min",function(n){$(".dial",e).trigger("setMin",parseFloat(n))}),i.$observe("max",function(n){$(".dial",e).trigger("setMax",parseFloat(n))})}}}).directive("colorpicker",function(){return{restrict:"EA",replace:!0,require:"ngModel",scope:{fallbackValue:"=",disabled:"=?",onChange:"&?"},link:function(t,e,i,r){let n=$(e);n.addClass("input-small"),t.$on("$destroy",function(){n.spectrum("destroy")});function o(u){angular.isFunction(t.onChange)&&t.onChange({color:u})}r.$render=function(){n.spectrum("set",r.$viewValue||""),o(r.$viewValue)};let a={color:r.$viewValue},l={showInput:!0,className:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"hex",chooseText:"Выбрать",cancelText:"Отменить",palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]},h=angular.extend({},a,l);n.spectrum(h),t.$watch("disabled",function(u){typeof u!="undefined"&&n.spectrum(u?"disable":"enable")})}}}).directive("inputerror",function(){return{restrict:"E",scope:{error:"=error"},template:'<div class="error" ng-show="error">{{error}}</div>',replace:!0,link:function(t,e,i){}}}).directive("fileUpload",function(){return{restrict:"E",scope:{done:"&",url:"@",title:"@",response:"&",formData:"@"},replace:!0,template:'<div><form enctype="multipart/form-data" method="post"><span class="btn  fileinput-button"><i class="icon-upload"></i> {{infoText}}<input type="file" name="file" ng-disabled="disabled"></span><div ng-show="uploading"><p class="size">File size:{{fileSize | formatFileSize}}</p><div class="progress progress-success progress-striped active"><div class="bar" style="width:{{percent}}%}"><span style="position:absolute;text-align:center;left:0;right:0;color:#000000">{{percent}}%</span></div></div></div></form><div ng-show="fail" class="alert alert-error"><h4>Upload failed</h4>{{fail}}</div></div>',link:function(t,e,i){t.title?t.infoText=t.title:t.infoText="Upload";let r={dataType:"json",add:function(n,o){t.$apply(function(){t.uploading=!0,t.percent=0,t.fail=!1}),o.submit()},fail:function(n,o){t.$apply(function(){t.uploading=!1,t.percent=0,t.fail="Upload failed";let a=angular.fromJson(o.response().jqXHR.responseText);a.error.message&&(t.fail=a.error.message)})},url:t.url,formData:t.formData};t.percent=0,t.uploading=!1,t.file=$("input[type=file]",$(e)),r.done=function(n,o){t.$apply(function(){t.uploading=!1,t.response&&t.response({data:angular.fromJson(o.response().jqXHR.responseText)}),t.done&&t.done({e:n,data:o})})},r.progress=function(n,o){t.$apply(function(){t.fileSize=o.total,t.percent=parseInt(o.loaded/o.total*100,10)})},t.file.fileupload(r),i.$observe("url",function(n){t.file.fileupload("option","url",n)}),i.$observe("title",function(n){t.infoText=n})}}}).directive("autoset",function(){return{restrict:"E",scope:{name:"@"},template:'<i class="fa margin-left" ng-class="result" ng-show="tested" title="{{comp}}"></i>',replace:!0,require:"ngModel",controller:["$scope",function(t){t.$on("firmwareConfigRead",function(e,i){i&&i.hasOwnProperty(t.name)?(t.tested=!0,t.comp=i[t.name]*t.nfactor,t.result=t.comp==t.value?"fa-dot-circle-o fg-success":"fa-circle-o fg-danger"):t.tested=!1})}],link:function(t,e,i,r){t.nfactor=i.nfactor?parseFloat(i.nfactor):1,t.tested=!1,r.$formatters.push(function(n){t.value=n,n!==void 0&&(t.result=t.comp===n?"fa-dot-circle-o fg-success":"fa-circle-o fg-danger")})}}}).directive("dragme",function(){return{restrict:"A",link:function(t,e){$(e).dragScroll({})}}}).directive("integer",function(){return{require:"ngModel",link:function(t,e,i,r){r.$parsers.unshift(function(n){if(y6.test(n))return r.$setValidity("integer",!0),n;r.$setValidity("integer",!1)})}}}).directive("aDisabled",function(){return{compile:function(){return function(t,e,i){t.$watch(i.aDisabled,function(r){typeof r!="undefined"&&e.toggleClass("disabled",r)}),e.on("click",function(r){t.$eval(i.aDisabled)&&r.preventDefault()})}}}}).directive("rsEnter",function(){return function(t,e,i){e.bind("keydown keypress",function(r){r.which===13&&(t.$apply(function(){t.$eval(i.rsEnter)}),r.preventDefault())})}}).directive("rsInPlaceNumber",["$timeout",function(t){return{restrict:"E",scope:{value:"=",precision:"@",changed:"&",readonly:"<?"},template:'<span ng-click="edit()" ng-bind="value | number:precision"></span><input ng-model="valueInt" class="nospin" rs-enter="close()" type="number">',link:function(e,i){let r=angular.element(i.children()[1]);i.addClass("edit-in-place"),i.addClass("edit-in-place-number"),e.editing=!1,e.edit=function(){e.hasOwnProperty("readonly")&&e.readonly||(e.valueInt=e.value,e.editing=!0,i.addClass("active"),r[0].focus(),e.orig=e.value)},e.close=function(){r.blur()},r.on("blur",function(){e.editing&&e.orig!==e.valueInt&&(e.valueInt==null?e.value=e.orig:e.value=e.valueInt,t(()=>{e.changed({newValue:e.value,oldValue:e.orig})})),e.editing=!1,i.removeClass("active")})}}}]).directive("rsInPlaceString",function(){return{restrict:"E",scope:{value:"=",changed:"&",readonly:"<?"},template:'<span ng-click="edit()" ng-bind="value"></span><input ng-model="value" rs-enter="close()" type="text">',link:function(t,e){let i=angular.element(e.children()[1]);e.addClass("edit-in-place"),e.addClass("edit-in-place-string"),t.editing=!1,t.edit=function(){t.hasOwnProperty("readonly")&&t.readonly||(t.editing=!0,e.addClass("active"),i[0].focus(),t.orig=t.value)},t.close=function(){i.blur()},i.on("blur",function(){t.editing&&t.orig!==t.value&&(t.value==null&&(t.value=t.orig),t.changed({newValue:t.value,oldValue:t.orig})),t.editing=!1,e.removeClass("active")})}}}).directive("preventEnterSubmit",function(){return function(t,e){e.bind("keydown",function(i){i.which===13&&(i.preventDefault(),window.stop(),document.execCommand("Stop"))})}}).directive("convertToNumber",function(){return{require:"ngModel",link:function(t,e,i,r){r.$parsers.push(function(n){return n!=null?parseInt(n,10):null}),r.$formatters.push(function(n){return n!=null?""+n:null})}}}).component("rsDialog",{controller:["$element","$interval","$rootScope","RSCom","$document","$sce",function(t,e,i,r,n,o){let a=0,l=0;this.inputEntrys={},this.inputErrors={};let h=angular.element(t[0].childNodes[0]);this.x=.5*(window.innerWidth-h.outerWidth()),this.y=150,this.extraClass="",this.buttonClass="btn-primary",this.iconClass="fa-arrows",setTimeout(()=>{this.x=.5*(window.innerWidth-h.outerWidth()),this.y=.3*(window.innerHeight-h.outerHeight()),this.extraClass=this.dialog.dialogType===1?"info":this.dialog.dialogType===2?"warning":this.dialog.dialogType===3?"error":"",this.buttonClass=this.dialog.dialogType===1?"btn-info":this.dialog.dialogType===2?"btn-warning":this.dialog.dialogType===3?"btn-danger":"btn-primary",this.iconClass=this.dialog.dialogType===1?"fa fa-info-circle":this.dialog.dialogType===2?"fa fa-exclamation-triangle":this.dialog.dialogType===3?"fa fa-exclamation":"rs rs-printer",this.dialog.input.forEach(f=>{this.inputEntrys[f.name]=this.getDefaultVal(f),this.updateError(f)}),this.message=o.trustAsHtml(this.dialog.message)},0),this.getTypeSteps=f=>f.dataType==="Int"?"1":"any",this.getDefaultVal=f=>f.dataType==="Double"?parseFloat(f.defaultValue):f.dataType==="Int"?parseInt(f.defaultValue):f.defaultValue;let u=f=>{f.originalEvent.touches&&(f.screenX=f.originalEvent.touches.item(0).screenX,f.screenY=f.originalEvent.touches.item(0).screenY),this.y=f.screenY-l,this.x=f.screenX-a,this.x=Math.max(0,this.x),this.y=Math.max(0,this.y),this.x=Math.min(this.x,window.innerWidth-h.outerWidth()),this.y=Math.min(this.y,window.innerHeight-h.outerHeight()),t.css({top:this.x,left:this.y})},c=()=>{n.unbind("mousemove",u),n.unbind("mouseup",c),n.unbind("touchmove",u),n.unbind("touchend",c)};this.shouldBeVisible=()=>i.user.printPermission||this.dialog.dialogType!==0&&this.dialog.dialogType!==4,this.startDrag=f=>{f.preventDefault(),f.originalEvent.touches&&(f.screenX=f.originalEvent.touches.item(0).screenX,f.screenY=f.originalEvent.touches.item(0).screenY),a=f.screenX-this.x,l=f.screenY-this.y,n.on("mousemove",u),n.on("mouseup",c),n.on("touchmove",u),n.on("touchend",c)},this.selectClose=f=>{let d={},m=!1;Object.keys(this.inputErrors).forEach(v=>{this.inputErrors[v].visible=this.inputErrors[v].error!==!1,m=m||this.inputErrors[v].error!==!1}),Object.keys(this.inputEntrys).forEach(v=>{this.inputEntrys[v]===void 0?d[v]="":d[v]=this.inputEntrys[v].toString()}),r.send("closeDialog",{id:this.dialog.id,selection:f,inputData:d},this.dialog.printer).then(v=>{v.ok||console.log("error: not allowed to close the dialog")})},this.updateError=f=>{let d=!1,m=this.inputEntrys[f.name];if(m!==void 0&&f.inputType===0){let v=Math.round(parseFloat(f.minValue)*1e3)/1e3,g=Math.round(parseFloat(f.maxValue)*1e3)/1e3;f.dataType==="String"&&(f.dataType==="String"&&v>m.length?d="Минимальная длина текста: $1".replace("$1",v.toString()):f.dataType==="String"&&g<m.length&&(d="Максимальная длина текста составляет: $1".replace("$1",g.toString()))),(f.dataType==="Int"||f.dataType==="Double")&&(isNaN(m)?d='Введенный текст не является числом':v>m?d='Минимальная стоимость составляет: $1'.replace("$1",v.toString()):g<m&&(d='Максимальная стоимость составляет: $1'.replace("$1",g.toString()))),this.inputErrors[f.name]={error:d,visible:!1}}},this.roundFloat=f=>Math.round(parseFloat(f)*1e3)/1e3,this.getLabelStyles=(f,d,m)=>{let v="normal",g="normal",p="inherit";return(f&32)===32&&(g="bold",p="xx-large"),(f&16)===16&&(g="bold",p="x-large"),(f&8)===8&&(v="italic"),(f&4)===4&&(g="bold"),(f&2)===2&&(p="inherit"),(f&1)===1&&(p="small"),{"font-style":v,"font-weight":g,"font-size":p}}}],controllerAs:"ctrl",bindings:{dialog:"<"},template:`<div ng-show="ctrl.shouldBeVisible()" class="rs-dialog {{ctrl.extraClass}}" ng-touchstart="ctrl.startDrag($event);" ng-mousedown="ctrl.startDrag($event);" style="max-height:100%; overflow: auto; width:100%; top: {{ctrl.y || 0}}px; left: {{ctrl.x || 0}}px">
  <div class="modal-header">
    <h3 class="modal-title" ">
      <rs-menu-icon ng-if="ctrl.dialog.icon !== ''" icon-img="ctrl.dialog.icon"></rs-menu-icon>
      <i ng-if="ctrl.dialog.icon === ''" class="{{ctrl.iconClass}}"></i>
      &nbsp;{{ctrl.dialog.title}}
    </h3>
  </div>
  <div class="modal-body">
    <form name="formDialog" class="customDialog">
      <div ng-bind-html="ctrl.message"></div>
      <small ng-if="ctrl.dialog.dialogType==0"> Примечание: Когда принтер блокируется, а буферы связи переполнены, ответы могут не выполняться!</small>
      <div ng-repeat="c in ctrl.dialog.input track by $index" ng-style="{'margin-top':'{{c.marginTop}}', 'margin-bottom':'{{c.marginBottom}}'}">
        <div ng-if="c.inputType===0" class="margin-top">
          <strong>{{c.caption}}</strong>
            <input name="{{c.name}}" class="form-control ng-pristine ng-untouched ng-valid ng-empty"
                   style="width:100%; font-color:black;"
                   ng-if="c.dataType === 'String'"
                   maxlength="{{c.maxValue}}"
                   minlength="{{c.minValue}}"
                   ng-required="c.dataType === 'String' && c.minValue !== 0"
                   type="text"
                   ng-model="ctrl.inputEntrys[c.name]"
                   ng-mousedown="$event.stopPropagation()"
                   ng-touchstart="$event.stopPropagation()"
                   ng-change="ctrl.updateError(c)"
                   ng-disabled="c.readonly"
                   ng-model-options="{ allowInvalid: true }"
                   >
            <input name="{{c.name}}" class="form-control ng-pristine ng-untouched ng-valid ng-empty"
                   style="width:100%; font-color:black;"
                   ng-if="c.dataType !== 'String'"
                   step="{{ctrl.getTypeSteps(c)}}"
                   min="{{ctrl.roundFloat(c.minValue)}}"
                   max="{{ctrl.roundFloat(c.maxValue)}}"
                   type="number"
                   ng-model="ctrl.inputEntrys[c.name]"
                   ng-mousedown="$event.stopPropagation()"
                   ng-touchstart="$event.stopPropagation()"
                   ng-change="ctrl.updateError(c)"
                   ng-disabled="c.readonly"
                   ng-model-options="{ allowInvalid: true }"
                   >
        </div>
        <strong ng-show="ctrl.inputErrors[c.name].visible" style="color: red; font-weight: normal" >{{ctrl.inputErrors[c.name].error}}</strong>        
        
        <div ng-if="c.inputType===1" class="margin-top">
          <strong>{{c.caption}}</strong>
          <select class="form-control ng-pristine ng-untouched ng-valid ng-not-empty"
                  style=" width:100%; font-color:black;"
                  ng-model="ctrl.inputEntrys[c.name]"
                  ng-mousedown="$event.stopPropagation()"    
                  ng-touchstart="$event.stopPropagation()"            
                  ng-options="option.value as option.name for option in c.dropdownData"
                  ng-disabled="c.readonly">
          </select>
        </div>
        <div ng-if="c.inputType===2" class="margin-top"">
          <div style="display: flex">
            <label style="font-weight: 400;margin: 5px 0 5px 20px" class="checkbox">
              <input
                  type="checkbox"
                  ng-model="ctrl.inputEntrys[c.name]"
                  ng-true-value="'1'"
                  ng-false-value="'0'"
                  ng-disabled="c.readonly"
                  ng-touchstart="$event.stopPropagation()"
                  ng-mousedown="$event.stopPropagation()">
              {{c.caption}}
            </label>
          </div>
        </div>
        <label ng-if="c.inputType===3" class="margin-top" ng-style="{{ctrl.getLabelStyles(c.labelStyles)}}">{{c.caption}}</label>
      </div>
    </form>
  </div>
  <div class="modal-footer" style="text-align: center" ng-if="ctrl.dialog.choices.length>0">
 
   
    <div style="display: flex;flex-wrap: wrap;justify-content: space-between;margin-top:-10px">
      <button 
        ng-repeat="c in ctrl.dialog.choices track by $index" 
        class="btn {{ctrl.buttonClass}}" 
        style="margin-top:10px;margin-left:8px;margin-right:8px" 
        type="button" 
        ng-touchstart="$event.stopPropagation()"
        ng-click="ctrl.selectClose($index)">
         {{c}}
      </button>
    </div>
  </div>
</div>`}).component("rsWebcam",{template:'<div style="{{ctrl.style}}"><img ng-src="{{ctrl.imgurl}}" alt="webcam image" style="max-width:100%"></div>',controller:["$element","$interval","$rootScope","User",function(t,e,i,r){let n=this,o=0,a=0,l="none",h=0;n.imgurl="";let u,c=0,f=!0,d=0,m=null,v=!1;n.fullstyle=n.style;let g=function(){if(v)return;let p=$("img",t);if(f&&(p.on("load",onload),p.on("error",onerror),f=!1),p.length===0)return;let _=p.parent(),x=p.width(),b=p.height();if(c++,n.mjpg===!1&&c>=2&&(c=0,o=-1),d===0&&o===x&&a===b&&h===n.rotation&&l===n.url)return;if(n.url!==l){let C="rand="+RSUtils.createAlphaID(10);n.mjpg?n.imgurl="/printer/previewcammjpg?url="+encodeURIComponent(n.url)+"&rot="+n.rotation:n.imgurl="/printer/previewcamjpg?url="+encodeURIComponent(n.url)+"&rot="+n.rotation,d>0&&d--,n.imgurl.indexOf("?")>0?n.imgurl+="&"+C:n.imgurl+="?"+C}let y=0,w=_.width(),S=1,R,E;switch(n.rotation){case 0:case 180:R=x,E=b;break;case 90:case 270:y=(x-b)/2,R=b,E=x;break}w<R&&(S=w/R);let T=$(window).height()-80;T<E&&(S=Math.min(T/E,S)),n.maxHeight&&n.maxHeight<E&&(S=Math.min(S,n.maxHeight/E));let A="scale("+S+") rotate("+n.rotation+"deg)";p.css("-webkit-transform",A),p.css("-ms-transform",A),p.css("transform",A),p.css("margin-top",((E*S-b)/2).toFixed(0)+"px"),p.css("margin-left",-((x-R*S)/2)+"px"),_.css("height",E*S+"px"),o=x,a=b,h=n.rotation,l=n.url};this.$onChanges=function(){g()},this.$onInit=function(){u=e(g,500),m=i.$on("refreshWebcam",function(){d=2})},this.$onDestroy=function(){e.cancel(u),m();let p=$("img",$(t));f||(p.off("load",onload),p.off("error",onerror)),n.imgurl="/img/empty.png",p[0].src="/img/empty.png",p[0].parentNode.textContent=""}}],controllerAs:"ctrl",bindings:{url:"<",mjpg:"<",maxHeight:"<",rotation:"<",style:"@"}}).component("rsPrinterWebcam",{template:'<div style="{{ctrl.style}};position:relative;z-index:1;overflow:hidden;transition-duration: 300ms;transition-property: transform;{{ctrl.zoomStyle}}"><websocket-camera ng-mouseenter="ctrl.setZoom(true)" alt="zoom" ng-mouseleave="ctrl.setZoom(false)" img-url="{{ctrl.imgurl}}" rotate="ctrl.rotation" max-refresh="ctrl.maxRefresh" max-height="ctrl.maxHeight" style="position:relative;z-index:1;"></div>',controller:["$element","$interval","$rootScope","User","RSCom",function(t,e,i,r,n){let o=this;o.rotation=0,o.imgurl="/img/nowebcam.png",this.zoom=!1;let a,l=1e3,h=0,u=null;o.fullstyle=o.style,o.zoomStyle="";let c="",f=()=>{if(o.zoom)return;let d=i.printerConfig[o.slug];d&&(d=d.webcams[h],o.rotation=d.orientation,(d.method&2)===2?(!o.url||!o.url.startsWith("/printer/cammjpg/"))&&(o.url="/printer/cammjpg/"+o.slug,c=RSUtils.createAlphaID(10),o.imgurl=o.url+"?wcid="+c+"&cam=0"):(d.method&1)===1?(l++,l>=2*d.reloadInterval&&(o.url="/printer/camjpg/"+o.slug,c=RSUtils.createAlphaID(10),o.imgurl=o.url+"?wcid="+c+"&cam=0",l=0)):(o.rotation=0,o.imgurl=o.url="/img/nowebcam.png"))};this.setZoom=function(d){o.zoom=d,d?o.zoomStyle="transform: scale(1.6) translate(0,25px);display:inline-block":o.zoomStyle="display:inline-block"},this.$onChanges=function(){f()},this.$onInit=function(){f(),a=e(f,500),u=i.$on("refreshWebcam",function(){o.url="/img/empty.png",f()})},this.$onDestroy=()=>{e.cancel(a),u(),o.imgurl="/img/empty.png"}}],controllerAs:"ctrl",bindings:{slug:"<",maxHeight:"<",idx:"@",style:"@",maxRefresh:"<"}}).directive("a",function(){return{restrict:"E",link:function(t,e,i){(i.ngClick||i.href===""||i.href==="#")&&e.on("click",function(r){r.preventDefault(),r.stopPropagation()})}}}).component("rsMenuIcon",{template:'<i ng-if="!ctrl.iconImg" ng-class="[ctrl.icon, ctrl.colorClass]" style="{{ctrl.style}}"></i><span ng-if="ctrl.iconImg" class="menuicon" style="display: inline-block;" ng-bind-html="ctrl.html"></span>',controllerAs:"ctrl",bindings:{iconImg:"<",icon:"@",style:"@",colorClass:"@"},controller:["$sce",function(t){let e=this;this.html="";let i=()=>{if(!e.iconImg){this.html="";return}e.iconImg.substring(0,4)==="<svg"?e.html=t.trustAsHtml(e.iconImg):e.iconImg.substring(0,4)==="http"||e.iconImg.substr(0,4)==="data"||e.iconImg[0]==="/"?e.iconImg.endsWith(".svg")?e.html=t.trustAsHtml('<img style="" onload="SVGInject(this)" class="rs-icon '+(e.colorClass?e.colorClass:"")+'" src="'+e.iconImg+'" alt="">'):e.html=t.trustAsHtml('<img style="" class="rs-icon '+(e.colorClass?e.colorClass:"")+'" src="'+e.iconImg+'" alt="">'):e.html=t.trustAsHtml(`<i class="${e.iconImg}"></i>`)};this.$onChanges=function(r){r.iconImg&&i()}}]}).component("rsIcon",{template:'<i ng-if="!ctrl.iconImg" ng-class="[ctrl.icon, ctrl.colorClass]" style="{{ctrl.style}}"></i><span ng-if="ctrl.iconImg" class="rs-icon" style="" ng-bind-html="ctrl.html"></span>',controllerAs:"ctrl",bindings:{iconImg:"<",icon:"@",style:"@",colorClass:"@"},controller:["$sce",function(t){let e=this;this.html="";let i=()=>{if(!e.iconImg){this.html="";return}e.iconImg.substring(0,4)==="<svg"?e.html=t.trustAsHtml(e.iconImg):e.iconImg.substring(0,4)==="http"||e.iconImg.substr(0,4)==="data"||e.iconImg[0]==="/"?e.iconImg.endsWith(".svg")?e.html=t.trustAsHtml('<img style="" onload="SVGInject(this)" class="rs-icon '+(e.colorClass?e.colorClass:"")+'" src="'+e.iconImg+'" alt="">'):e.html=t.trustAsHtml('<img style="" class="rs-icon '+(e.colorClass?e.colorClass:"")+'" src="'+e.iconImg+'" alt="">'):e.html=t.trustAsHtml(`<i class="${e.iconImg}"></i>`)};this.$onChanges=function(r){r.iconImg&&i()}}]}).component("rsPrintStatus",{controllerAs:"ctrl",controller:["$rootScope","User","RSPrinter","RSCom","Confirm",function(t,e,i,r,n){this.RSPrinter=i,this.canPrint=e.canPrint(),this.canFullStop=e.canFullStop()||this.canPrint,this.stopPrint=function(){n("Требуется подтверждение","Действительно остановить текущую печать?","Да","Нет",!0).then(function(){t.active.status.jobid&&r.send("stopJob",{id:t.active.status.jobid})})}}],template:`<div class="margin-top panel" ng-class="{'panel-default':!$root.active.status.paused,'panel-danger':$root.active.status.paused}" ng-show="$root.active.state.isJobActive">
  <div class="panel-heading" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis; display: flex">
    <i class="flex-pull-vertical-center rs rs-print" ng-if="!$root.active.status.paused"></i>
    <i class="flex-pull-vertical-center fa fa-pause" ng-if="$root.active.status.paused"></i>
    <div class="flex-pull-left margin-left-important flex-pull-vertical-center ">{{$root.active.status.job}}</div>
    
    <!--ng-show="!$root.active.status.queueCount" ng-bind="printerWithJobs.length" -->
    <span ng-show="$root.active.status.repeat>1" class="flex-pull-right badge" style="">{{("@ оставшиеся").replace('@',$root.active.status.repeat-1)}}</span>
   
  </div>
  <div class="panel-body" style="height: 130px;">
    <table style="width:100%">
      <tr>
        <td ng-if="$root.hasFeature1" class="hidden-sm-600">
          <img ng-src="{{$root.RSPrinter.printingImage('m')}}" alt="" style="height: 130px;margin: -15px 10px -15px -15px">
        </td>
        <td style="width:100%">
          <table style="width: 100%;white-space: nowrap;margin:-5px 0">
            <tr ng-show="$root.active.status.analysed">
              <td style="white-space: nowrap;"><strong>ETA:</strong>&nbsp;
              </td>
              <td style="padding-right: 10px;">{{($root.stateTime + 1000*($root.active.status.printTime-$root.active.status.printedTimeComp))
                | date:'short'}}
              </td>
              <td>
                <strong class="hidden-xs">Старт:</strong>
              </td>
              <td style="width: 100%">
                        <span class="hidden-xs">
                          {{1000*$root.active.status.printStart| date:'short'}}
                        </span>
              </td>
            </tr>
            <tr ng-show="$root.active.status.analysed">
              <td style="white-space: nowrap;"><strong>ETE:</strong>&nbsp;
              </td>
              <td style="padding-right: 10px;">
                {{$root.active.status.printTime - $root.active.status.printedTimeComp | dhms}}
              </td>
              <td>
                <strong class="hidden-xs">Время печати:</strong>&nbsp;
              </td>
              <td>
                <span class="hidden-xs">
                  {{$root.active.status.serverTime - $root.active.status.printStart | hms}}
                </span>
              </td>
            </tr>
            <tr ng-hide="$root.active.status.analysed">
              <td style="white-space: nowrap;">
                <strong>Время печати:</strong>&nbsp;
              </td>
              <td colspan="3">{{$root.stateTime/1000 - $root.active.status.printStart | hms}}
              </td>
            </tr>
            <tr>
              <td colspan="4" style="width: 100%;padding-top:10px">
                <div style="position: relative">
                  <div class="progress active" style="margin-bottom: 0">
                    <div class="metertext">{{$root.active.status.done | number:2}}% &nbsp;
                      | &nbsp; <i class="fa fa-bars"></i> {{$root.active.state.layer}} /
                      {{$root.active.status.ofLayer}}
                      <span class="hidden-inline-sm-400">&nbsp; | &nbsp; Z: {{$root.active.state.z | number:2}} mm</span>
                    </div>
                    <div class="progress-bar progress-bar-success" role="progressbar"
                         style="width:{{$root.active.status.done}}%"></div>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td colspan="4" style="padding-top: 10px" class="text-right">
                <button ng-show="ctrl.canFullStop" ng-click="ctrl.stopPrint()" class="btn btn-danger btn-sm" style="width:100px">
                  <i
                      class="fa fa-stop"></i> Стоп
                </button>
                <button ng-show="ctrl.canFullStop && !$root.active.status.paused" ng-click="$root.RSPrinter.pausePrint()" style="width:100px" class="btn btn-primary btn-sm">
                  <i
                      class="fa fa-pause"></i>
                    Пауза
                </button>
                <button ng-show="ctrl.canPrint && $root.active.status.paused" ng-click="$root.RSPrinter.unpausePrint()" ng-disabled="$root.active.status.pauseState===3" style="width:100px" class="btn btn-primary btn-sm">
                  <i class="fa fa-play"></i>
                  {{$root.RSPrinter.pauseNames[$root.active.status.pauseState]}}
                </button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>
</div>`}).controller("RsDropdownController",["$scope","$element","$attrs","$parse","uibDropdownConfig","uibDropdownService","$animate","$uibPosition","$document","$compile","$templateRequest",function(t,e,i,r,n,o,a,l,h,u,c){let f=this,d=t.$new(),m,v=n.appendToOpenClass,g=n.openClass,p,_=angular.noop,x=i.onToggle?r(i.onToggle):angular.noop,b=!1;f.selectedOption=null,d.isOpen=!1,e.addClass("dropdown"),this.init=()=>{i.isOpen&&(p=r(i.isOpen),_=p.assign,t.$watch(p,function(w){d.isOpen=!!w})),b=angular.isDefined(i.keyboardNav)},this.toggle=function(w){return d.isOpen=arguments.length?!!w:!d.isOpen,angular.isFunction(_)&&_(d,d.isOpen),d.isOpen},this.isOpen=()=>d.isOpen,d.getToggleElement=function(){return f.toggleElement},d.getAutoClose=function(){return i.autoClose||"always"},d.getElement=function(){return e},d.isKeynavEnabled=function(){return b},d.focusDropdownEntry=function(w){let S=f.dropdownMenu?angular.element(f.dropdownMenu).find("a"):e.find("ul").eq(0).find("a");switch(w){case 40:{angular.isNumber(f.selectedOption)?f.selectedOption=f.selectedOption===S.length-1?f.selectedOption:f.selectedOption+1:f.selectedOption=0;break}case 38:{angular.isNumber(f.selectedOption)?f.selectedOption=f.selectedOption===0?0:f.selectedOption-1:f.selectedOption=S.length-1;break}}S[f.selectedOption].focus()},d.getDropdownElement=function(){return f.dropdownMenu},d.focusToggleElement=function(){f.toggleElement&&f.toggleElement[0].focus()};function y(){e.append(f.dropdownMenu)}d.$watch("isOpen",function(w,S){let R=null,E=!0;if(angular.isDefined(i.dropdownAppendTo)){let D=r(i.dropdownAppendTo)(d);D&&(R=angular.element(D),E=!1)}if(angular.isDefined(i.dropdownAppendToBody)&&r(i.dropdownAppendToBody)(d)!==!1&&(E=!0),E&&!R&&(R=$("#menucontainer")),R&&f.dropdownMenu&&(w?(R.append(f.dropdownMenu),e.on("$destroy",y)):(e.off("$destroy",y),y())),R&&f.dropdownMenu){let D=l.positionElements(e,f.dropdownMenu,"bottom-left",!0),O,P,L,I=0;O={top:D.top+"px",display:w?"block":"none"};let k=l.offset(R);O.top=D.top-k.top+"px";let B=f.dropdownMenu.width();L=l.scrollbarPadding(R),L.heightOverflow&&L.scrollbarWidth&&(I=L.scrollbarWidth+2);let F=window.innerWidth-I;P=D.left>window.innerWidth/2;let W=0,V=0;{let N=D.left+B;if(P)V=window.innerWidth-I-(D.left+e.prop("offsetWidth")),W=window.innerWidth-V-B,W>=0?(O.left="auto",O.right=V+"px"):(O.left="0px",F>B?(V=I,O.right=I+"px",O.overflowX="auto"):O.right="auto");else if(O.left=D.left+"px",O.right="auto",N>F){let ne=D.left+F-N;ne<0?(O.left="0px",O.right=I+"px",O.overflowX="auto"):O.left=ne+"px"}}if(!E){let N=l.offset(R);O.top=D.top-N.top+"px",P?O.right!=="auto"&&(O.right=V-N.left+"px"):O.left=D.left-N.left+"px"}f.dropdownMenu.css(O)}let T=R||e,A=R?v:g,C=T.hasClass(A),M=o.isOnlyOpen(t,R);if(C===!w){let D;R?D=M?"removeClass":"addClass":D=w?"addClass":"removeClass",a[D](T,A).then(function(){angular.isDefined(w)&&w!==S&&x(t,{open:!!w})})}if(w)f.dropdownMenuTemplateUrl?c(f.dropdownMenuTemplateUrl).then(function(D){m=d.$new(),u(D.trim())(m,function(O){let P=O;f.dropdownMenu.replaceWith(P),f.dropdownMenu=P,h.on("keydown",o.keybindFilter)})}):h.on("keydown",o.keybindFilter),d.focusToggleElement(),o.open(d,e,R);else{if(o.close(d,e,R),f.dropdownMenuTemplateUrl){m&&m.$destroy();let D=angular.element('<ul class="dropdown-menu"></ul>');f.dropdownMenu.replaceWith(D),f.dropdownMenu=D}f.selectedOption=null}angular.isFunction(_)&&_(t,w)})}]).directive("rsDropdown",function(){return{controller:"RsDropdownController",link:function(t,e,i,r){r.init()}}}).directive("rsDropdownMenu",function(){return{restrict:"A",require:"?^rsDropdown",link:function(t,e,i,r){if(!r||angular.isDefined(i.dropdownNested))return;e.addClass("dropdown-menu");let n=i.templateUrl;n&&(r.dropdownMenuTemplateUrl=n),r.dropdownMenu||(r.dropdownMenu=e)}}}).directive("rsDropdownToggle",function(){return{require:"?^rsDropdown",link:function(t,e,i,r){if(!r)return;e.addClass("dropdown-toggle"),r.toggleElement=e;let n=function(o){o.preventDefault(),!e.hasClass("disabled")&&!i.disabled&&t.$apply(function(){r.toggle()})};e.on("click",n),e.attr({"aria-haspopup":!0,"aria-expanded":!1}),t.$watch(r.isOpen,function(o){e.attr("aria-expanded",!!o)}),t.$on("$destroy",function(){e.off("click",n)})}}}).component("rsManual",{bindings:{sections:"="},controller:["$element","$scope","$http",function(t,e,i){e.htmlManualText={},this.$onInit=function(){e.getManualText(this.sections)},e.getManualText=function(r){for(let[n,o]of Object.entries(r))hL(n,i).then(a=>{let l={};l.caption=o,l.htmlText=a,e.htmlManualText[n]=l})},e.setManualText=function(r,n){r.setSelectedManualSection(n),$(".manualHelp",t)[0].scrollTop=0}}],controllerAs:"ctrl",template:`<div class="col-lg-3 col-md-4 col-sm-12 col-xs-12" style="height: 100%;
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;">
            <select class="form-control ng-pristine ng-untouched ng-valid ng-not-empty"
                    style="width:100%"
                    ng-model="$parent.selectedManualSection"
                    ng-change="setManualText($parent, $parent.selectedManualSection)">
              <option ng-repeat="(key, value) in htmlManualText" value="{{key}}" title="{{ value.caption }}">{{ value.caption }}</option>
            </select>
            <div style="overflow-y: scroll; height: 100%; margin-bottom: 0px;" class="manualHelp panel panel-default margin-top panel-body select-text">
              <div style="margin-top: 10px; font-size: 80%" ng-bind-html="htmlManualText[$parent.selectedManualSection].htmlText" ></div>
            </div>
          </div>`});var Nt=class{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,i,r){let n=[];return this.decompose(0,e,n,2),r.length&&r.decompose(0,r.length,n,3),this.decompose(i,this.length,n,1),Kn.from(n,this.length-(i-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,i=this.length){let r=[];return this.decompose(e,i,r,0),Kn.from(r,i-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let i=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),n=new Dl(this),o=new Dl(e);for(let a=i,l=i;;){if(n.next(a),o.next(a),a=0,n.lineBreak!=o.lineBreak||n.done!=o.done||n.value!=o.value)return!1;if(l+=n.value.length,n.done||l>=r)return!0}}iter(e=1){return new Dl(this,e)}iterRange(e,i=this.length){return new fg(this,e,i)}iterLines(e,i){let r;if(e==null)r=this.iter();else{i==null&&(i=this.lines+1);let n=this.line(e).from;r=this.iterRange(n,Math.max(n,i==this.lines+1?this.length:i<=1?0:this.line(i-1).to))}return new dg(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Nt.empty:e.length<=32?new _i(e):Kn.from(_i.split(e,[]))}},_i=class extends Nt{constructor(e,i=x6(e)){super(),this.text=e,this.length=i}get lines(){return this.text.length}get children(){return null}lineInner(e,i,r,n){for(let o=0;;o++){let a=this.text[o],l=n+a.length;if((i?r:l)>=e)return new Bx(n,l,r,a);n=l+1,r++}}decompose(e,i,r,n){let o=e<=0&&i>=this.length?this:new _i(uL(this.text,e,i),Math.min(i,this.length)-Math.max(0,e));if(n&1){let a=r.pop(),l=cg(o.text,a.text.slice(),0,o.length);if(l.length<=32)r.push(new _i(l,a.length+o.length));else{let h=l.length>>1;r.push(new _i(l.slice(0,h)),new _i(l.slice(h)))}}else r.push(o)}replace(e,i,r){if(!(r instanceof _i))return super.replace(e,i,r);let n=cg(this.text,cg(r.text,uL(this.text,0,e)),i),o=this.length+r.length-(i-e);return n.length<=32?new _i(n,o):Kn.from(_i.split(n,[]),o)}sliceString(e,i=this.length,r=`
`){let n="";for(let o=0,a=0;o<=i&&a<this.text.length;a++){let l=this.text[a],h=o+l.length;o>e&&a&&(n+=r),e<h&&i>o&&(n+=l.slice(Math.max(0,e-o),i-o)),o=h+1}return n}flatten(e){for(let i of this.text)e.push(i)}scanIdentical(){return 0}static split(e,i){let r=[],n=-1;for(let o of e)r.push(o),n+=o.length+1,r.length==32&&(i.push(new _i(r,n)),r=[],n=-1);return n>-1&&i.push(new _i(r,n)),i}},Kn=class extends Nt{constructor(e,i){super(),this.children=e,this.length=i,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,i,r,n){for(let o=0;;o++){let a=this.children[o],l=n+a.length,h=r+a.lines-1;if((i?h:l)>=e)return a.lineInner(e,i,r,n);n=l+1,r=h+1}}decompose(e,i,r,n){for(let o=0,a=0;a<=i&&o<this.children.length;o++){let l=this.children[o],h=a+l.length;if(e<=h&&i>=a){let u=n&((a<=e?1:0)|(h>=i?2:0));a>=e&&h<=i&&!u?r.push(l):l.decompose(e-a,i-a,r,u)}a=h+1}}replace(e,i,r){if(r.lines<this.lines)for(let n=0,o=0;n<this.children.length;n++){let a=this.children[n],l=o+a.length;if(e>=o&&i<=l){let h=a.replace(e-o,i-o,r),u=this.lines-a.lines+h.lines;if(h.lines<u>>5-1&&h.lines>u>>5+1){let c=this.children.slice();return c[n]=h,new Kn(c,this.length-(i-e)+r.length)}return super.replace(o,l,h)}o=l+1}return super.replace(e,i,r)}sliceString(e,i=this.length,r=`
`){let n="";for(let o=0,a=0;o<this.children.length&&a<=i;o++){let l=this.children[o],h=a+l.length;a>e&&o&&(n+=r),e<h&&i>a&&(n+=l.sliceString(e-a,i-a,r)),a=h+1}return n}flatten(e){for(let i of this.children)i.flatten(e)}scanIdentical(e,i){if(!(e instanceof Kn))return 0;let r=0,[n,o,a,l]=i>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=i,o+=i){if(n==a||o==l)return r;let h=this.children[n],u=e.children[o];if(h!=u)return r+h.scanIdentical(u,i);r+=h.length+1}}static from(e,i=e.reduce((r,n)=>r+n.length+1,-1)){let r=0;for(let m of e)r+=m.lines;if(r<32){let m=[];for(let v of e)v.flatten(m);return new _i(m,i)}let n=Math.max(32,r>>5),o=n<<1,a=n>>1,l=[],h=0,u=-1,c=[];function f(m){let v;if(m.lines>o&&m instanceof Kn)for(let g of m.children)f(g);else m.lines>a&&(h>a||!h)?(d(),l.push(m)):m instanceof _i&&h&&(v=c[c.length-1])instanceof _i&&m.lines+v.lines<=32?(h+=m.lines,u+=m.length+1,c[c.length-1]=new _i(v.text.concat(m.text),v.length+1+m.length)):(h+m.lines>n&&d(),h+=m.lines,u+=m.length+1,c.push(m))}function d(){h!=0&&(l.push(c.length==1?c[0]:Kn.from(c,u)),u=-1,h=c.length=0)}for(let m of e)f(m);return d(),l.length==1?l[0]:new Kn(l,i)}};Nt.empty=new _i([""],0);function x6(t){let e=-1;for(let i of t)e+=i.length+1;return e}function cg(t,e,i=0,r=1e9){for(let n=0,o=0,a=!0;o<t.length&&n<=r;o++){let l=t[o],h=n+l.length;h>=i&&(h>r&&(l=l.slice(0,r-n)),n<i&&(l=l.slice(i-n)),a?(e[e.length-1]+=l,a=!1):e.push(l)),n=h+1}return e}function uL(t,e,i){return cg(t,[""],e,i)}var Dl=class{constructor(e,i=1){this.dir=i,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[i>0?1:(e instanceof _i?e.text.length:e.children.length)<<1]}nextInner(e,i){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,n=this.nodes[r],o=this.offsets[r],a=o>>1,l=n instanceof _i?n.text.length:n.children.length;if(a==(i>0?l:0)){if(r==0)return this.done=!0,this.value="",this;i>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((o&1)==(i>0?0:1)){if(this.offsets[r]+=i,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(n instanceof _i){let h=n.text[a+(i<0?-1:0)];if(this.offsets[r]+=i,h.length>Math.max(0,e))return this.value=e==0?h:i>0?h.slice(e):h.slice(0,h.length-e),this;e-=h.length}else{let h=n.children[a+(i<0?-1:0)];e>h.length?(e-=h.length,this.offsets[r]+=i):(i<0&&this.offsets[r]--,this.nodes.push(h),this.offsets.push(i>0?1:(h instanceof _i?h.text.length:h.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},fg=class{constructor(e,i,r){this.value="",this.done=!1,this.cursor=new Dl(e,i>r?-1:1),this.pos=i>r?e.length:0,this.from=Math.min(i,r),this.to=Math.max(i,r)}nextInner(e,i){if(i<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,i<0?this.pos-this.to:this.from-this.pos);let r=i<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*i,this.value=n.length<=r?n:i<0?n.slice(n.length-r):n.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},dg=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:i,lineBreak:r,value:n}=this.inner.next(e);return i?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol!="undefined"&&(Nt.prototype[Symbol.iterator]=function(){return this.iter()},Dl.prototype[Symbol.iterator]=fg.prototype[Symbol.iterator]=dg.prototype[Symbol.iterator]=function(){return this});var Bx=class{constructor(e,i,r,n){this.from=e,this.to=i,this.number=r,this.text=n}get length(){return this.to-this.from}},Wh="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=1;t<Wh.length;t++)Wh[t]+=Wh[t-1];function b6(t){for(let e=1;e<Wh.length;e+=2)if(Wh[e]>t)return Wh[e-1]<=t;return!1}function cL(t){return t>=127462&&t<=127487}var fL=8205;function hr(t,e,i=!0,r=!0){return(i?_L:w6)(t,e,r)}function _L(t,e,i){if(e==t.length)return e;e&&yL(t.charCodeAt(e))&&xL(t.charCodeAt(e-1))&&e--;let r=ji(t,e);for(e+=Dr(r);e<t.length;){let n=ji(t,e);if(r==fL||n==fL||i&&b6(n))e+=Dr(n),r=n;else if(cL(n)){let o=0,a=e-2;for(;a>=0&&cL(ji(t,a));)o++,a-=2;if(o%2==0)break;e+=2}else break}return e}function w6(t,e,i){for(;e>0;){let r=_L(t,e-2,i);if(r<e)return r;e--}return 0}function yL(t){return t>=56320&&t<57344}function xL(t){return t>=55296&&t<56320}function ji(t,e){let i=t.charCodeAt(e);if(!xL(i)||e+1==t.length)return i;let r=t.charCodeAt(e+1);return yL(r)?(i-55296<<10)+(r-56320)+65536:i}function ef(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(t&1023)+56320))}function Dr(t){return t<65536?1:2}var Nx=/\r\n?|\n/,Or=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(Or||(Or={})),Tn=class{constructor(e){this.sections=e}get length(){let e=0;for(let i=0;i<this.sections.length;i+=2)e+=this.sections[i];return e}get newLength(){let e=0;for(let i=0;i<this.sections.length;i+=2){let r=this.sections[i+1];e+=r<0?this.sections[i]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let i=0,r=0,n=0;i<this.sections.length;){let o=this.sections[i++],a=this.sections[i++];a<0?(e(r,n,o),n+=o):n+=a,r+=o}}iterChangedRanges(e,i=!1){Ux(this,e,i)}get invertedDesc(){let e=[];for(let i=0;i<this.sections.length;){let r=this.sections[i++],n=this.sections[i++];n<0?e.push(r,n):e.push(n,r)}return new Tn(e)}composeDesc(e){return this.empty?e:e.empty?this:bL(this,e)}mapDesc(e,i=!1){return e.empty?this:Gx(this,e,i)}mapPos(e,i=-1,r=Or.Simple){let n=0,o=0;for(let a=0;a<this.sections.length;){let l=this.sections[a++],h=this.sections[a++],u=n+l;if(h<0){if(u>e)return o+(e-n);o+=l}else{if(r!=Or.Simple&&u>=e&&(r==Or.TrackDel&&n<e&&u>e||r==Or.TrackBefore&&n<e||r==Or.TrackAfter&&u>e))return null;if(u>e||u==e&&i<0&&!l)return e==n||i<0?o:o+h;o+=h}n=u}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return o}touchesRange(e,i=e){for(let r=0,n=0;r<this.sections.length&&n<=i;){let o=this.sections[r++],a=this.sections[r++],l=n+o;if(a>=0&&n<=i&&l>=e)return n<e&&l>i?"cover":!0;n=l}return!1}toString(){let e="";for(let i=0;i<this.sections.length;){let r=this.sections[i++],n=this.sections[i++];e+=(e?" ":"")+r+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(i=>typeof i!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Tn(e)}static create(e){return new Tn(e)}},yi=class extends Tn{constructor(e,i){super(e),this.inserted=i}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Ux(this,(i,r,n,o,a)=>e=e.replace(n,n+(r-i),a),!1),e}mapDesc(e,i=!1){return Gx(this,e,i,!0)}invert(e){let i=this.sections.slice(),r=[];for(let n=0,o=0;n<i.length;n+=2){let a=i[n],l=i[n+1];if(l>=0){i[n]=l,i[n+1]=a;let h=n>>1;for(;r.length<h;)r.push(Nt.empty);r.push(a?e.slice(o,o+a):Nt.empty)}o+=a}return new yi(i,r)}compose(e){return this.empty?e:e.empty?this:bL(this,e,!0)}map(e,i=!1){return e.empty?this:Gx(this,e,i,!0)}iterChanges(e,i=!1){Ux(this,e,i)}get desc(){return Tn.create(this.sections)}filter(e){let i=[],r=[],n=[],o=new Il(this);e:for(let a=0,l=0;;){let h=a==e.length?1e9:e[a++];for(;l<h||l==h&&o.len==0;){if(o.done)break e;let c=Math.min(o.len,h-l);Lr(n,c,-1);let f=o.ins==-1?-1:o.off==0?o.ins:0;Lr(i,c,f),f>0&&Oa(r,i,o.text),o.forward(c),l+=c}let u=e[a++];for(;l<u;){if(o.done)break e;let c=Math.min(o.len,u-l);Lr(i,c,-1),Lr(n,c,o.ins==-1?-1:o.off==0?o.ins:0),o.forward(c),l+=c}}return{changes:new yi(i,r),filtered:Tn.create(n)}}toJSON(){let e=[];for(let i=0;i<this.sections.length;i+=2){let r=this.sections[i],n=this.sections[i+1];n<0?e.push(r):n==0?e.push([r]):e.push([r].concat(this.inserted[i>>1].toJSON()))}return e}static of(e,i,r){let n=[],o=[],a=0,l=null;function h(c=!1){if(!c&&!n.length)return;a<i&&Lr(n,i-a,-1);let f=new yi(n,o);l=l?l.compose(f.map(l)):f,n=[],o=[],a=0}function u(c){if(Array.isArray(c))for(let f of c)u(f);else if(c instanceof yi){if(c.length!=i)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${i})`);h(),l=l?l.compose(c.map(l)):c}else{let{from:f,to:d=f,insert:m}=c;if(f>d||f<0||d>i)throw new RangeError(`Invalid change range ${f} to ${d} (in doc of length ${i})`);let v=m?typeof m=="string"?Nt.of(m.split(r||Nx)):m:Nt.empty,g=v.length;if(f==d&&g==0)return;f<a&&h(),f>a&&Lr(n,f-a,-1),Lr(n,d-f,g),Oa(o,n,v),a=d}}return u(e),h(!l),l}static empty(e){return new yi(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let i=[],r=[];for(let n=0;n<e.length;n++){let o=e[n];if(typeof o=="number")i.push(o,-1);else{if(!Array.isArray(o)||typeof o[0]!="number"||o.some((a,l)=>l&&typeof a!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(o.length==1)i.push(o[0],0);else{for(;r.length<n;)r.push(Nt.empty);r[n]=Nt.of(o.slice(1)),i.push(o[0],r[n].length)}}}return new yi(i,r)}static createSet(e,i){return new yi(e,i)}};function Lr(t,e,i,r=!1){if(e==0&&i<=0)return;let n=t.length-2;n>=0&&i<=0&&i==t[n+1]?t[n]+=e:e==0&&t[n]==0?t[n+1]+=i:r?(t[n]+=e,t[n+1]+=i):t.push(e,i)}function Oa(t,e,i){if(i.length==0)return;let r=e.length-2>>1;if(r<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<r;)t.push(Nt.empty);t.push(i)}}function Ux(t,e,i){let r=t.inserted;for(let n=0,o=0,a=0;a<t.sections.length;){let l=t.sections[a++],h=t.sections[a++];if(h<0)n+=l,o+=l;else{let u=n,c=o,f=Nt.empty;for(;u+=l,c+=h,h&&r&&(f=f.append(r[a-2>>1])),!(i||a==t.sections.length||t.sections[a+1]<0);)l=t.sections[a++],h=t.sections[a++];e(n,u,o,c,f),n=u,o=c}}}function Gx(t,e,i,r=!1){let n=[],o=r?[]:null,a=new Il(t),l=new Il(e);for(let h=-1;;)if(a.ins==-1&&l.ins==-1){let u=Math.min(a.len,l.len);Lr(n,u,-1),a.forward(u),l.forward(u)}else if(l.ins>=0&&(a.ins<0||h==a.i||a.off==0&&(l.len<a.len||l.len==a.len&&!i))){let u=l.len;for(Lr(n,l.ins,-1);u;){let c=Math.min(a.len,u);a.ins>=0&&h<a.i&&a.len<=c&&(Lr(n,0,a.ins),o&&Oa(o,n,a.text),h=a.i),a.forward(c),u-=c}l.next()}else if(a.ins>=0){let u=0,c=a.len;for(;c;)if(l.ins==-1){let f=Math.min(c,l.len);u+=f,c-=f,l.forward(f)}else if(l.ins==0&&l.len<c)c-=l.len,l.next();else break;Lr(n,u,h<a.i?a.ins:0),o&&h<a.i&&Oa(o,n,a.text),h=a.i,a.forward(a.len-c)}else{if(a.done&&l.done)return o?yi.createSet(n,o):Tn.create(n);throw new Error("Mismatched change set lengths")}}function bL(t,e,i=!1){let r=[],n=i?[]:null,o=new Il(t),a=new Il(e);for(let l=!1;;){if(o.done&&a.done)return n?yi.createSet(r,n):Tn.create(r);if(o.ins==0)Lr(r,o.len,0,l),o.next();else if(a.len==0&&!a.done)Lr(r,0,a.ins,l),n&&Oa(n,r,a.text),a.next();else{if(o.done||a.done)throw new Error("Mismatched change set lengths");{let h=Math.min(o.len2,a.len),u=r.length;if(o.ins==-1){let c=a.ins==-1?-1:a.off?0:a.ins;Lr(r,h,c,l),n&&c&&Oa(n,r,a.text)}else a.ins==-1?(Lr(r,o.off?0:o.len,h,l),n&&Oa(n,r,o.textBit(h))):(Lr(r,o.off?0:o.len,a.off?0:a.ins,l),n&&!a.off&&Oa(n,r,a.text));l=(o.ins>h||a.ins>=0&&a.len>h)&&(l||r.length>u),o.forward2(h),a.forward(h)}}}}var Il=class{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length?Nt.empty:e[i]}textBit(e){let{inserted:i}=this.set,r=this.i-2>>1;return r>=i.length&&!e?Nt.empty:i[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}},Xo=class{constructor(e,i,r){this.from=e,this.to=i,this.flags=r}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,i=-1){let r,n;return this.empty?r=n=e.mapPos(this.from,i):(r=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),r==this.from&&n==this.to?this:new Xo(r,n,this.flags)}extend(e,i=e){if(e<=this.anchor&&i>=this.anchor)return ve.range(e,i);let r=Math.abs(e-this.anchor)>Math.abs(i-this.anchor)?e:i;return ve.range(this.anchor,r)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return ve.range(e.anchor,e.head)}static create(e,i,r){return new Xo(e,i,r)}},ve=class{constructor(e,i){this.ranges=e,this.mainIndex=i}map(e,i=-1){return e.empty?this:ve.create(this.ranges.map(r=>r.map(e,i)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ve([this.main],0)}addRange(e,i=!0){return ve.create([e].concat(this.ranges),i?0:this.mainIndex+1)}replaceRange(e,i=this.mainIndex){let r=this.ranges.slice();return r[i]=e,ve.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ve(e.ranges.map(i=>Xo.fromJSON(i)),e.main)}static single(e,i=e){return new ve([ve.range(e,i)],0)}static create(e,i=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,n=0;n<e.length;n++){let o=e[n];if(o.empty?o.from<=r:o.from<r)return ve.normalized(e.slice(),i);r=o.to}return new ve(e,i)}static cursor(e,i=0,r,n){return Xo.create(e,e,(i==0?0:i<0?4:8)|(r==null?3:Math.min(2,r))|(n!=null?n:33554431)<<5)}static range(e,i,r,n){let o=(r!=null?r:33554431)<<5|(n==null?3:Math.min(2,n));return i<e?Xo.create(i,e,24|o):Xo.create(e,i,(i>e?4:0)|o)}static normalized(e,i=0){let r=e[i];e.sort((n,o)=>n.from-o.from),i=e.indexOf(r);for(let n=1;n<e.length;n++){let o=e[n],a=e[n-1];if(o.empty?o.from<=a.to:o.from<a.to){let l=a.from,h=Math.max(o.to,a.to);n<=i&&i--,e.splice(--n,2,o.anchor>o.head?ve.range(h,l):ve.range(l,h))}}return new ve(e,i)}};function wL(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}var Yx=0,Qe=class{constructor(e,i,r,n,o){this.combine=e,this.compareInput=i,this.compare=r,this.isStatic=n,this.id=Yx++,this.default=e([]),this.extensions=typeof o=="function"?o(this):o}static define(e={}){return new Qe(e.combine||(i=>i),e.compareInput||((i,r)=>i===r),e.compare||(e.combine?(i,r)=>i===r:Zx),!!e.static,e.enables)}of(e){return new Vh([],this,0,e)}compute(e,i){if(this.isStatic)throw new Error("Can't compute a static facet");return new Vh(e,this,1,i)}computeN(e,i){if(this.isStatic)throw new Error("Can't compute a static facet");return new Vh(e,this,2,i)}from(e,i){return i||(i=r=>r),this.compute([e],r=>i(r.field(e)))}};function Zx(t,e){return t==e||t.length==e.length&&t.every((i,r)=>i===e[r])}var Vh=class{constructor(e,i,r,n){this.dependencies=e,this.facet=i,this.type=r,this.value=n,this.id=Yx++}dynamicSlot(e){var i;let r=this.value,n=this.facet.compareInput,o=this.id,a=e[o]>>1,l=this.type==2,h=!1,u=!1,c=[];for(let f of this.dependencies)f=="doc"?h=!0:f=="selection"?u=!0:((i=e[f.id])!==null&&i!==void 0?i:1)&1||c.push(e[f.id]);return{create(f){return f.values[a]=r(f),1},update(f,d){if(h&&d.docChanged||u&&(d.docChanged||d.selection)||zx(f,c)){let m=r(f);if(l?!dL(m,f.values[a],n):!n(m,f.values[a]))return f.values[a]=m,1}return 0},reconfigure:(f,d)=>{let m,v=d.config.address[o];if(v!=null){let g=mg(d,v);if(this.dependencies.every(p=>p instanceof Qe?d.facet(p)===f.facet(p):p instanceof Ii?d.field(p,!1)==f.field(p,!1):!0)||(l?dL(m=r(f),g,n):n(m=r(f),g)))return f.values[a]=g,0}else m=r(f);return f.values[a]=m,1}}}};function dL(t,e,i){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1;return!0}function zx(t,e){let i=!1;for(let r of e)Qc(t,r)&1&&(i=!0);return i}function S6(t,e,i){let r=i.map(h=>t[h.id]),n=i.map(h=>h.type),o=r.filter(h=>!(h&1)),a=t[e.id]>>1;function l(h){let u=[];for(let c=0;c<r.length;c++){let f=mg(h,r[c]);if(n[c]==2)for(let d of f)u.push(d);else u.push(f)}return e.combine(u)}return{create(h){for(let u of r)Qc(h,u);return h.values[a]=l(h),1},update(h,u){if(!zx(h,o))return 0;let c=l(h);return e.compare(c,h.values[a])?0:(h.values[a]=c,1)},reconfigure(h,u){let c=zx(h,r),f=u.config.facets[e.id],d=u.facet(e);if(f&&!c&&Zx(i,f))return h.values[a]=d,0;let m=l(h);return e.compare(m,d)?(h.values[a]=d,0):(h.values[a]=m,1)}}}var pL=Qe.define({static:!0}),Ii=class{constructor(e,i,r,n,o){this.id=e,this.createF=i,this.updateF=r,this.compareF=n,this.spec=o,this.provides=void 0}static define(e){let i=new Ii(Yx++,e.create,e.update,e.compare||((r,n)=>r===n),e);return e.provide&&(i.provides=e.provide(i)),i}create(e){let i=e.facet(pL).find(r=>r.field==this);return((i==null?void 0:i.create)||this.createF)(e)}slot(e){let i=e[this.id]>>1;return{create:r=>(r.values[i]=this.create(r),1),update:(r,n)=>{let o=r.values[i],a=this.updateF(o,n);return this.compareF(o,a)?0:(r.values[i]=a,1)},reconfigure:(r,n)=>n.config.address[this.id]!=null?(r.values[i]=n.field(this),0):(r.values[i]=this.create(r),1)}}init(e){return[this,pL.of({field:this,create:e})]}get extension(){return this}},Ll={lowest:4,low:3,default:2,high:1,highest:0};function Kc(t){return e=>new pg(e,t)}var lo={highest:Kc(Ll.highest),high:Kc(Ll.high),default:Kc(Ll.default),low:Kc(Ll.low),lowest:Kc(Ll.lowest)},pg=class{constructor(e,i){this.inner=e,this.prec=i}},qh=class{of(e){return new Jc(this,e)}reconfigure(e){return qh.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}},Jc=class{constructor(e,i){this.compartment=e,this.inner=i}},Xh=class{constructor(e,i,r,n,o,a){for(this.base=e,this.compartments=i,this.dynamicSlots=r,this.address=n,this.staticValues=o,this.facets=a,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let i=this.address[e.id];return i==null?e.default:this.staticValues[i>>1]}static resolve(e,i,r){let n=[],o=Object.create(null),a=new Map;for(let d of C6(e,i,a))d instanceof Ii?n.push(d):(o[d.facet.id]||(o[d.facet.id]=[])).push(d);let l=Object.create(null),h=[],u=[];for(let d of n)l[d.id]=u.length<<1,u.push(m=>d.slot(m));let c=r==null?void 0:r.config.facets;for(let d in o){let m=o[d],v=m[0].facet,g=c&&c[d]||[];if(m.every(p=>p.type==0))if(l[v.id]=h.length<<1|1,Zx(g,m))h.push(r.facet(v));else{let p=v.combine(m.map(_=>_.value));h.push(r&&v.compare(p,r.facet(v))?r.facet(v):p)}else{for(let p of m)p.type==0?(l[p.id]=h.length<<1|1,h.push(p.value)):(l[p.id]=u.length<<1,u.push(_=>p.dynamicSlot(_)));l[v.id]=u.length<<1,u.push(p=>S6(p,v,m))}}let f=u.map(d=>d(l));return new Xh(e,a,f,l,h,o)}};function C6(t,e,i){let r=[[],[],[],[],[]],n=new Map;function o(a,l){let h=n.get(a);if(h!=null){if(h<=l)return;let u=r[h].indexOf(a);u>-1&&r[h].splice(u,1),a instanceof Jc&&i.delete(a.compartment)}if(n.set(a,l),Array.isArray(a))for(let u of a)o(u,l);else if(a instanceof Jc){if(i.has(a.compartment))throw new RangeError("Duplicate use of compartment in extensions");let u=e.get(a.compartment)||a.inner;i.set(a.compartment,u),o(u,l)}else if(a instanceof pg)o(a.inner,a.prec);else if(a instanceof Ii)r[l].push(a),a.provides&&o(a.provides,l);else if(a instanceof Vh)r[l].push(a),a.facet.extensions&&o(a.facet.extensions,Ll.default);else{let u=a.extension;if(!u)throw new Error(`Unrecognized extension value in extension set (${a}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);o(u,l)}}return o(t,Ll.default),r.reduce((a,l)=>a.concat(l))}function Qc(t,e){if(e&1)return 2;let i=e>>1,r=t.status[i];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;t.status[i]=4;let n=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|n}function mg(t,e){return e&1?t.config.staticValues[e>>1]:t.values[e>>1]}var SL=Qe.define(),CL=Qe.define({combine:t=>t.some(e=>e),static:!0}),ML=Qe.define({combine:t=>t.length?t[0]:void 0,static:!0}),EL=Qe.define(),TL=Qe.define(),AL=Qe.define(),PL=Qe.define({combine:t=>t.length?t[0]:!1}),Qn=class{constructor(e,i){this.type=e,this.value=i}static define(){return new Hx}},Hx=class{of(e){return new Qn(this,e)}},Wx=class{constructor(e){this.map=e}of(e){return new Lt(this,e)}},Lt=class{constructor(e,i){this.type=e,this.value=i}map(e){let i=this.type.map(this.value,e);return i===void 0?void 0:i==this.value?this:new Lt(this.type,i)}is(e){return this.type==e}static define(e={}){return new Wx(e.map||(i=>i))}static mapEffects(e,i){if(!e.length)return e;let r=[];for(let n of e){let o=n.map(i);o&&r.push(o)}return r}};Lt.reconfigure=Lt.define();Lt.appendConfig=Lt.define();var xi=class{constructor(e,i,r,n,o,a){this.startState=e,this.changes=i,this.selection=r,this.effects=n,this.annotations=o,this.scrollIntoView=a,this._doc=null,this._state=null,r&&wL(r,i.newLength),o.some(l=>l.type==xi.time)||(this.annotations=o.concat(xi.time.of(Date.now())))}static create(e,i,r,n,o,a){return new xi(e,i,r,n,o,a)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let i of this.annotations)if(i.type==e)return i.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let i=this.annotation(xi.userEvent);return!!(i&&(i==e||i.length>e.length&&i.slice(0,e.length)==e&&i[e.length]=="."))}};xi.time=Qn.define();xi.userEvent=Qn.define();xi.addToHistory=Qn.define();xi.remote=Qn.define();function M6(t,e){let i=[];for(let r=0,n=0;;){let o,a;if(r<t.length&&(n==e.length||e[n]>=t[r]))o=t[r++],a=t[r++];else if(n<e.length)o=e[n++],a=e[n++];else return i;!i.length||i[i.length-1]<o?i.push(o,a):i[i.length-1]<a&&(i[i.length-1]=a)}}function RL(t,e,i){var r;let n,o,a;return i?(n=e.changes,o=yi.empty(e.changes.length),a=t.changes.compose(e.changes)):(n=e.changes.map(t.changes),o=t.changes.mapDesc(e.changes,!0),a=t.changes.compose(n)),{changes:a,selection:e.selection?e.selection.map(o):(r=t.selection)===null||r===void 0?void 0:r.map(n),effects:Lt.mapEffects(t.effects,n).concat(Lt.mapEffects(e.effects,o)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function Vx(t,e,i){let r=e.selection,n=jh(e.annotations);return e.userEvent&&(n=n.concat(xi.userEvent.of(e.userEvent))),{changes:e.changes instanceof yi?e.changes:yi.of(e.changes||[],i,t.facet(ML)),selection:r&&(r instanceof ve?r:ve.single(r.anchor,r.head)),effects:jh(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function LL(t,e,i){let r=Vx(t,e.length?e[0]:{},t.doc.length);e.length&&e[0].filter===!1&&(i=!1);for(let o=1;o<e.length;o++){e[o].filter===!1&&(i=!1);let a=!!e[o].sequential;r=RL(r,Vx(t,e[o],a?r.changes.newLength:t.doc.length),a)}let n=xi.create(t,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return T6(i?E6(n):n)}function E6(t){let e=t.startState,i=!0;for(let n of e.facet(EL)){let o=n(t);if(o===!1){i=!1;break}Array.isArray(o)&&(i=i===!0?o:M6(i,o))}if(i!==!0){let n,o;if(i===!1)o=t.changes.invertedDesc,n=yi.empty(e.doc.length);else{let a=t.changes.filter(i);n=a.changes,o=a.filtered.mapDesc(a.changes).invertedDesc}t=xi.create(e,n,t.selection&&t.selection.map(o),Lt.mapEffects(t.effects,o),t.annotations,t.scrollIntoView)}let r=e.facet(TL);for(let n=r.length-1;n>=0;n--){let o=r[n](t);o instanceof xi?t=o:Array.isArray(o)&&o.length==1&&o[0]instanceof xi?t=o[0]:t=LL(e,jh(o),!1)}return t}function T6(t){let e=t.startState,i=e.facet(AL),r=t;for(let n=i.length-1;n>=0;n--){let o=i[n](t);o&&Object.keys(o).length&&(r=RL(r,Vx(e,o,t.changes.newLength),!0))}return r==t?t:xi.create(e,t.changes,t.selection,r.effects,r.annotations,r.scrollIntoView)}var A6=[];function jh(t){return t==null?A6:Array.isArray(t)?t:[t]}var Jt=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(Jt||(Jt={})),P6=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,jx;try{jx=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(t){}function R6(t){if(jx)return jx.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>"\x80"&&(i.toUpperCase()!=i.toLowerCase()||P6.test(i)))return!0}return!1}function L6(t){return e=>{if(!/\S/.test(e))return Jt.Space;if(R6(e))return Jt.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return Jt.Word;return Jt.Other}}var Ct=class{constructor(e,i,r,n,o,a){this.config=e,this.doc=i,this.selection=r,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=o,a&&(a._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Qc(this,l<<1);this.computeSlot=null}field(e,i=!0){let r=this.config.address[e.id];if(r==null){if(i)throw new RangeError("Field is not present in this state");return}return Qc(this,r),mg(this,r)}update(...e){return LL(this,e,!0)}applyTransaction(e){let i=this.config,{base:r,compartments:n}=i;for(let a of e.effects)a.is(qh.reconfigure)?(i&&(n=new Map,i.compartments.forEach((l,h)=>n.set(h,l)),i=null),n.set(a.value.compartment,a.value.extension)):a.is(Lt.reconfigure)?(i=null,r=a.value):a.is(Lt.appendConfig)&&(i=null,r=jh(r).concat(a.value));let o;i?o=e.startState.values.slice():(i=Xh.resolve(r,n,this),o=new Ct(i,this.doc,this.selection,i.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values),new Ct(i,e.newDoc,e.newSelection,o,(a,l)=>l.update(a,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:e},range:ve.cursor(i.from+e.length)}))}changeByRange(e){let i=this.selection,r=e(i.ranges[0]),n=this.changes(r.changes),o=[r.range],a=jh(r.effects);for(let l=1;l<i.ranges.length;l++){let h=e(i.ranges[l]),u=this.changes(h.changes),c=u.map(n);for(let d=0;d<l;d++)o[d]=o[d].map(c);let f=n.mapDesc(u,!0);o.push(h.range.map(f)),n=n.compose(c),a=Lt.mapEffects(a,c).concat(Lt.mapEffects(jh(h.effects),f))}return{changes:n,selection:ve.create(o,i.mainIndex),effects:a}}changes(e=[]){return e instanceof yi?e:yi.of(e,this.doc.length,this.facet(Ct.lineSeparator))}toText(e){return Nt.of(e.split(this.facet(Ct.lineSeparator)||Nx))}sliceDoc(e=0,i=this.doc.length){return this.doc.sliceString(e,i,this.lineBreak)}facet(e){let i=this.config.address[e.id];return i==null?e.default:(Qc(this,i),mg(this,i))}toJSON(e){let i={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let n=e[r];n instanceof Ii&&this.config.address[n.id]!=null&&(i[r]=n.spec.toJSON(this.field(e[r]),this))}return i}static fromJSON(e,i={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(r){for(let o in r)if(Object.prototype.hasOwnProperty.call(e,o)){let a=r[o],l=e[o];n.push(a.init(h=>a.spec.fromJSON(l,h)))}}return Ct.create({doc:e.doc,selection:ve.fromJSON(e.selection),extensions:i.extensions?n.concat([i.extensions]):n})}static create(e={}){let i=Xh.resolve(e.extensions||[],new Map),r=e.doc instanceof Nt?e.doc:Nt.of((e.doc||"").split(i.staticFacet(Ct.lineSeparator)||Nx)),n=e.selection?e.selection instanceof ve?e.selection:ve.single(e.selection.anchor,e.selection.head):ve.single(0);return wL(n,r.length),i.staticFacet(CL)||(n=n.asSingle()),new Ct(i,r,n,i.dynamicSlots.map(()=>null),(o,a)=>a.create(o),null)}get tabSize(){return this.facet(Ct.tabSize)}get lineBreak(){return this.facet(Ct.lineSeparator)||`
`}get readOnly(){return this.facet(PL)}phrase(e,...i){for(let r of this.facet(Ct.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return i.length&&(e=e.replace(/\$(\$|\d*)/g,(r,n)=>{if(n=="$")return"$";let o=+(n||1);return!o||o>i.length?r:i[o-1]})),e}languageDataAt(e,i,r=-1){let n=[];for(let o of this.facet(SL))for(let a of o(this,i,r))Object.prototype.hasOwnProperty.call(a,e)&&n.push(a[e]);return n}charCategorizer(e){return L6(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:i,from:r,length:n}=this.doc.lineAt(e),o=this.charCategorizer(e),a=e-r,l=e-r;for(;a>0;){let h=hr(i,a,!1);if(o(i.slice(h,a))!=Jt.Word)break;a=h}for(;l<n;){let h=hr(i,l);if(o(i.slice(l,h))!=Jt.Word)break;l=h}return a==l?null:ve.range(a+r,l+r)}};Ct.allowMultipleSelections=CL;Ct.tabSize=Qe.define({combine:t=>t.length?t[0]:4});Ct.lineSeparator=ML;Ct.readOnly=PL;Ct.phrases=Qe.define({compare(t,e){let i=Object.keys(t),r=Object.keys(e);return i.length==r.length&&i.every(n=>t[n]==e[n])}});Ct.languageData=SL;Ct.changeFilter=EL;Ct.transactionFilter=TL;Ct.transactionExtender=AL;qh.reconfigure=Lt.define();function fn(t,e,i={}){let r={};for(let n of t)for(let o of Object.keys(n)){let a=n[o],l=r[o];if(l===void 0)r[o]=a;else if(!(l===a||a===void 0))if(Object.hasOwnProperty.call(i,o))r[o]=i[o](l,a);else throw new Error("Config merge conflict for field "+o)}for(let n in e)r[n]===void 0&&(r[n]=e[n]);return r}var As=class{eq(e){return this==e}range(e,i=e){return kl.create(e,i,this)}};As.prototype.startSide=As.prototype.endSide=0;As.prototype.point=!1;As.prototype.mapMode=Or.TrackDel;var kl=class{constructor(e,i,r){this.from=e,this.to=i,this.value=r}static create(e,i,r){return new kl(e,i,r)}};function qx(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}var $c=class{constructor(e,i,r,n){this.from=e,this.to=i,this.value=r,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,i,r,n=0){let o=r?this.to:this.from;for(let a=n,l=o.length;;){if(a==l)return a;let h=a+l>>1,u=o[h]-e||(r?this.value[h].endSide:this.value[h].startSide)-i;if(h==a)return u>=0?a:l;u>=0?l=h:a=h+1}}between(e,i,r,n){for(let o=this.findIndex(i,-1e9,!0),a=this.findIndex(r,1e9,!1,o);o<a;o++)if(n(this.from[o]+e,this.to[o]+e,this.value[o])===!1)return!1}map(e,i){let r=[],n=[],o=[],a=-1,l=-1;for(let h=0;h<this.value.length;h++){let u=this.value[h],c=this.from[h]+e,f=this.to[h]+e,d,m;if(c==f){let v=i.mapPos(c,u.startSide,u.mapMode);if(v==null||(d=m=v,u.startSide!=u.endSide&&(m=i.mapPos(c,u.endSide),m<d)))continue}else if(d=i.mapPos(c,u.startSide),m=i.mapPos(f,u.endSide),d>m||d==m&&u.startSide>0&&u.endSide<=0)continue;(m-d||u.endSide-u.startSide)<0||(a<0&&(a=d),u.point&&(l=Math.max(l,m-d)),r.push(u),n.push(d-a),o.push(m-a))}return{mapped:r.length?new $c(n,o,r,l):null,pos:a}}},zt=class{constructor(e,i,r,n){this.chunkPos=e,this.chunk=i,this.nextLayer=r,this.maxPoint=n}static create(e,i,r,n){return new zt(e,i,r,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let i of this.chunk)e+=i.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:i=[],sort:r=!1,filterFrom:n=0,filterTo:o=this.length}=e,a=e.filter;if(i.length==0&&!a)return this;if(r&&(i=i.slice().sort(qx)),this.isEmpty)return i.length?zt.of(i):this;let l=new gg(this,null,-1).goto(0),h=0,u=[],c=new An;for(;l.value||h<i.length;)if(h<i.length&&(l.from-i[h].from||l.startSide-i[h].value.startSide)>=0){let f=i[h++];c.addInner(f.from,f.to,f.value)||u.push(f)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(h==i.length||this.chunkEnd(l.chunkIndex)<i[h].from)&&(!a||n>this.chunkEnd(l.chunkIndex)||o<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!a||n>l.to||o<l.from||a(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||u.push(kl.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!u.length?zt.empty:this.nextLayer.update({add:u,filter:a,filterFrom:n,filterTo:o}))}map(e){if(e.empty||this.isEmpty)return this;let i=[],r=[],n=-1;for(let a=0;a<this.chunk.length;a++){let l=this.chunkPos[a],h=this.chunk[a],u=e.touchesRange(l,l+h.length);if(u===!1)n=Math.max(n,h.maxPoint),i.push(h),r.push(e.mapPos(l));else if(u===!0){let{mapped:c,pos:f}=h.map(l,e);c&&(n=Math.max(n,c.maxPoint),i.push(c),r.push(f))}}let o=this.nextLayer.map(e);return i.length==0?o:new zt(r,i,o||zt.empty,n)}between(e,i,r){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let o=this.chunkPos[n],a=this.chunk[n];if(i>=o&&e<=o+a.length&&a.between(o,e-o,i-o,r)===!1)return}this.nextLayer.between(e,i,r)}}iter(e=0){return Fl.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,i=0){return Fl.from(e).goto(i)}static compare(e,i,r,n,o=-1){let a=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=o),l=i.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=o),h=mL(a,l,r),u=new Ol(a,h,o),c=new Ol(l,h,o);r.iterGaps((f,d,m)=>gL(u,f,c,d,m,n)),r.empty&&r.length==0&&gL(u,0,c,0,0,n)}static eq(e,i,r=0,n){n==null&&(n=1e9-1);let o=e.filter(c=>!c.isEmpty&&i.indexOf(c)<0),a=i.filter(c=>!c.isEmpty&&e.indexOf(c)<0);if(o.length!=a.length)return!1;if(!o.length)return!0;let l=mL(o,a),h=new Ol(o,l,0).goto(r),u=new Ol(a,l,0).goto(r);for(;;){if(h.to!=u.to||!Xx(h.active,u.active)||h.point&&(!u.point||!h.point.eq(u.point)))return!1;if(h.to>n)return!0;h.next(),u.next()}}static spans(e,i,r,n,o=-1){let a=new Ol(e,null,o).goto(i),l=i,h=a.openStart;for(;;){let u=Math.min(a.to,r);if(a.point){let c=a.activeForPoint(a.to),f=a.pointFrom<i?c.length+1:Math.min(c.length,h);n.point(l,u,a.point,c,f,a.pointRank),h=Math.min(a.openEnd(u),c.length)}else u>l&&(n.span(l,u,a.active,h),h=a.openEnd(u));if(a.to>r)return h+(a.point&&a.to>r?1:0);l=a.to,a.next()}}static of(e,i=!1){let r=new An;for(let n of e instanceof kl?[e]:i?O6(e):e)r.add(n.from,n.to,n.value);return r.finish()}};zt.empty=new zt([],[],null,-1);function O6(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let r=t[i];if(qx(e,r)>0)return t.slice().sort(qx);e=r}return t}zt.empty.nextLayer=zt.empty;var An=class{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new $c(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,i,r){this.addInner(e,i,r)||(this.nextLayer||(this.nextLayer=new An)).add(e,i,r)}addInner(e,i,r){let n=e-this.lastTo||r.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(i-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=i,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,i-e)),!0)}addChunk(e,i){if((e-this.lastTo||i.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,i.maxPoint),this.chunks.push(i),this.chunkPos.push(e);let r=i.value.length-1;return this.last=i.value[r],this.lastFrom=i.from[r]+e,this.lastTo=i.to[r]+e,!0}finish(){return this.finishInner(zt.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let i=zt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,i}};function mL(t,e,i){let r=new Map;for(let o of t)for(let a=0;a<o.chunk.length;a++)o.chunk[a].maxPoint<=0&&r.set(o.chunk[a],o.chunkPos[a]);let n=new Set;for(let o of e)for(let a=0;a<o.chunk.length;a++){let l=r.get(o.chunk[a]);l!=null&&(i?i.mapPos(l):l)==o.chunkPos[a]&&!(i!=null&&i.touchesRange(l,l+o.chunk[a].length))&&n.add(o.chunk[a])}return n}var gg=class{constructor(e,i,r,n=0){this.layer=e,this.skip=i,this.minPoint=r,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,i=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,i,!1),this}gotoInner(e,i,r){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<e||n.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],i,!0);(!r||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,i){(this.to-e||this.endSide-i)<0&&this.gotoInner(e,i,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],i=this.layer.chunk[this.chunkIndex],r=e+i.from[this.rangeIndex];if(this.from=r,this.to=e+i.to[this.rangeIndex],this.value=i.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}},Fl=class{constructor(e){this.heap=e}static from(e,i=null,r=-1){let n=[];for(let o=0;o<e.length;o++)for(let a=e[o];!a.isEmpty;a=a.nextLayer)a.maxPoint>=r&&n.push(new gg(a,i,r,o));return n.length==1?n[0]:new Fl(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,i=-1e9){for(let r of this.heap)r.goto(e,i);for(let r=this.heap.length>>1;r>=0;r--)Fx(this.heap,r);return this.next(),this}forward(e,i){for(let r of this.heap)r.forward(e,i);for(let r=this.heap.length>>1;r>=0;r--)Fx(this.heap,r);(this.to-e||this.value.endSide-i)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Fx(this.heap,0)}}};function Fx(t,e){for(let i=t[e];;){let r=(e<<1)+1;if(r>=t.length)break;let n=t[r];if(r+1<t.length&&n.compare(t[r+1])>=0&&(n=t[r+1],r++),i.compare(n)<0)break;t[r]=i,t[e]=n,e=r}}var Ol=class{constructor(e,i,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Fl.from(e,i,r)}goto(e,i=-1e9){return this.cursor.goto(e,i),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=i,this.openStart=-1,this.next(),this}forward(e,i){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-i)<0;)this.removeActive(this.minActive);this.cursor.forward(e,i)}removeActive(e){hg(this.active,e),hg(this.activeTo,e),hg(this.activeRank,e),this.minActive=vL(this.active,this.activeTo)}addActive(e){let i=0,{value:r,to:n,rank:o}=this.cursor;for(;i<this.activeRank.length&&this.activeRank[i]<=o;)i++;ug(this.active,i,r),ug(this.activeTo,i,n),ug(this.activeRank,i,o),e&&ug(e,i,this.cursor.from),this.minActive=vL(this.active,this.activeTo)}next(){let e=this.to,i=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),r&&hg(r,n)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(r),this.cursor.next();else if(i&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let n=r.length-1;n>=0&&r[n]<e;n--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let i=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&i.push(this.active[r]);return i.reverse()}openEnd(e){let i=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)i++;return i}};function gL(t,e,i,r,n,o){t.goto(e),i.goto(r);let a=r+n,l=r,h=r-e;for(;;){let u=t.to+h-i.to||t.endSide-i.endSide,c=u<0?t.to+h:i.to,f=Math.min(c,a);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&Xx(t.activeForPoint(t.to+h),i.activeForPoint(i.to))||o.comparePoint(l,f,t.point,i.point):f>l&&!Xx(t.active,i.active)&&o.compareRange(l,f,t.active,i.active),c>a)break;l=c,u<=0&&t.next(),u>=0&&i.next()}}function Xx(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function hg(t,e){for(let i=e,r=t.length-1;i<r;i++)t[i]=t[i+1];t.pop()}function ug(t,e,i){for(let r=t.length-1;r>=e;r--)t[r+1]=t[r];t[e]=i}function vL(t,e){let i=-1,r=1e9;for(let n=0;n<e.length;n++)(e[n]-r||t[n].endSide-t[i].endSide)<0&&(i=n,r=e[n]);return i}function Da(t,e,i=t.length){let r=0;for(let n=0;n<i;)t.charCodeAt(n)==9?(r+=e-r%e,n++):(r++,n=hr(t,n));return r}function vg(t,e,i,r){for(let n=0,o=0;;){if(o>=e)return n;if(n==t.length)break;o+=t.charCodeAt(n)==9?i-o%i:1,n=hr(t,n)}return r===!0?-1:t.length}var Kx="\u037C",OL=typeof Symbol=="undefined"?"__"+Kx:Symbol.for(Kx),Qx=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),DL=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{},Jn=class{constructor(e,i){this.rules=[];let{finish:r}=i||{};function n(a){return/^@/.test(a)?[a]:a.split(/,\s*/)}function o(a,l,h,u){let c=[],f=/^@(\w+)\b/.exec(a[0]),d=f&&f[1]=="keyframes";if(f&&l==null)return h.push(a[0]+";");for(let m in l){let v=l[m];if(/&/.test(m))o(m.split(/,\s*/).map(g=>a.map(p=>g.replace(/&/,p))).reduce((g,p)=>g.concat(p)),v,h);else if(v&&typeof v=="object"){if(!f)throw new RangeError("The value of a property ("+m+") should be a primitive value.");o(n(m),v,c,d)}else v!=null&&c.push(m.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+v+";")}(c.length||d)&&h.push((r&&!f&&!u?a.map(r):a).join(", ")+" {"+c.join(" ")+"}")}for(let a in e)o(n(a),e[a],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=DL[OL]||1;return DL[OL]=e+1,Kx+e.toString(36)}static mount(e,i){(e[Qx]||new Jx(e)).mount(Array.isArray(i)?i:[i])}},_g=null,Jx=class{constructor(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(_g)return e.adoptedStyleSheets=[_g.sheet].concat(e.adoptedStyleSheets),e[Qx]=_g;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),_g=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let i=e.head||e;i.insertBefore(this.styleTag,i.firstChild)}this.modules=[],e[Qx]=this}mount(e){let i=this.sheet,r=0,n=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<n&&l>-1&&(this.modules.splice(l,1),n--,l=-1),l==-1){if(this.modules.splice(n++,0,a),i)for(let h=0;h<a.rules.length;h++)i.insertRule(a.rules[h],r++)}else{for(;n<l;)r+=this.modules[n++].rules.length;r+=a.rules.length,n++}}if(!i){let o="";for(let a=0;a<this.modules.length;a++)o+=this.modules[a].getRules()+`
`;this.styleTag.textContent=o}}};var Yo={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Yh={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},IL=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),twe=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),D6=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),I6=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),k6=D6||IL&&+IL[1]<57;for(qi=0;qi<10;qi++)Yo[48+qi]=Yo[96+qi]=String(qi);var qi;for(qi=1;qi<=24;qi++)Yo[qi+111]="F"+qi;var qi;for(qi=65;qi<=90;qi++)Yo[qi]=String.fromCharCode(qi+32),Yh[qi]=String.fromCharCode(qi);var qi;for(yg in Yo)Yh.hasOwnProperty(yg)||(Yh[yg]=Yo[yg]);var yg;function kL(t){var e=k6&&(t.ctrlKey||t.altKey||t.metaKey)||I6&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",i=!e&&t.key||(t.shiftKey?Yh:Yo)[t.keyCode]||t.key||"Unidentified";return i=="Esc"&&(i="Escape"),i=="Del"&&(i="Delete"),i=="Left"&&(i="ArrowLeft"),i=="Up"&&(i="ArrowUp"),i=="Right"&&(i="ArrowRight"),i=="Down"&&(i="ArrowDown"),i}function Og(t){let e;return t.nodeType==11?e=t.getSelection?t:t.ownerDocument:e=t,e.getSelection()}function eu(t,e){return e?t==e||t.contains(e.nodeType!=1?e.parentNode:e):!1}function F6(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Tg(t,e){if(!e.anchorNode)return!1;try{return eu(t,e.anchorNode)}catch(i){return!1}}function hf(t){return t.nodeType==3?tu(t,0,t.nodeValue.length).getClientRects():t.nodeType==1?t.getClientRects():[]}function Dg(t,e,i,r){return i?FL(t,e,i,r,-1)||FL(t,e,i,r,1):!1}function Ig(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e}function FL(t,e,i,r,n){for(;;){if(t==i&&e==r)return!0;if(e==(n<0?0:uf(t))){if(t.nodeName=="DIV")return!1;let o=t.parentNode;if(!o||o.nodeType!=1)return!1;e=Ig(t)+(n<0?0:1),t=o}else if(t.nodeType==1){if(t=t.childNodes[e+(n<0?-1:0)],t.nodeType==1&&t.contentEditable=="false")return!1;e=n<0?uf(t):0}else return!1}}function uf(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}var xO={left:0,right:0,top:0,bottom:0};function jb(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function B6(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function N6(t,e,i,r,n,o,a,l){let h=t.ownerDocument,u=h.defaultView||window;for(let c=t;c;)if(c.nodeType==1){let f,d=c==h.body;if(d)f=B6(u);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let g=c.getBoundingClientRect();f={left:g.left,right:g.left+c.clientWidth,top:g.top,bottom:g.top+c.clientHeight}}let m=0,v=0;if(n=="nearest")e.top<f.top?(v=-(f.top-e.top+a),i>0&&e.bottom>f.bottom+v&&(v=e.bottom-f.bottom+v+a)):e.bottom>f.bottom&&(v=e.bottom-f.bottom+a,i<0&&e.top-v<f.top&&(v=-(f.top+v-e.top+a)));else{let g=e.bottom-e.top,p=f.bottom-f.top;v=(n=="center"&&g<=p?e.top+g/2-p/2:n=="start"||n=="center"&&i<0?e.top-a:e.bottom-p+a)-f.top}if(r=="nearest"?e.left<f.left?(m=-(f.left-e.left+o),i>0&&e.right>f.right+m&&(m=e.right-f.right+m+o)):e.right>f.right&&(m=e.right-f.right+o,i<0&&e.left<f.left+m&&(m=-(f.left+m-e.left+o))):m=(r=="center"?e.left+(e.right-e.left)/2-(f.right-f.left)/2:r=="start"==l?e.left-o:e.right-(f.right-f.left)+o)-f.left,m||v)if(d)u.scrollBy(m,v);else{let g=0,p=0;if(v){let _=c.scrollTop;c.scrollTop+=v,p=c.scrollTop-_}if(m){let _=c.scrollLeft;c.scrollLeft+=m,g=c.scrollLeft-_}e={left:e.left-g,top:e.top-p,right:e.right-g,bottom:e.bottom-p},g&&Math.abs(g-m)<1&&(r="nearest"),p&&Math.abs(p-v)<1&&(n="nearest")}if(d)break;c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function U6(t){let e=t.ownerDocument;for(let i=t.parentNode;i&&i!=e.body;)if(i.nodeType==1){if(i.scrollHeight>i.clientHeight||i.scrollWidth>i.clientWidth)return i;i=i.assignedSlot||i.parentNode}else if(i.nodeType==11)i=i.host;else break;return null}var ob=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,i,r,n){this.anchorNode=e,this.anchorOffset=i,this.focusNode=r,this.focusOffset=n}},Zh=null;function bO(t){if(t.setActive)return t.setActive();if(Zh)return t.focus(Zh);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(Zh==null?{get preventScroll(){return Zh={preventScroll:!0},!0}}:void 0),!Zh){Zh=!1;for(let i=0;i<e.length;){let r=e[i++],n=e[i++],o=e[i++];r.scrollTop!=n&&(r.scrollTop=n),r.scrollLeft!=o&&(r.scrollLeft=o)}}}var BL;function tu(t,e,i=e){let r=BL||(BL=document.createRange());return r.setEnd(t,i),r.setStart(t,e),r}function $h(t,e,i){let r={key:e,code:e,keyCode:i,which:i,cancelable:!0},n=new KeyboardEvent("keydown",r);n.synthetic=!0,t.dispatchEvent(n);let o=new KeyboardEvent("keyup",r);return o.synthetic=!0,t.dispatchEvent(o),n.defaultPrevented||o.defaultPrevented}function G6(t){for(;t;){if(t&&(t.nodeType==9||t.nodeType==11&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function wO(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}function z6(t,e){let i=e.focusNode,r=e.focusOffset;if(!i||e.anchorNode!=i||e.anchorOffset!=r)return!1;for(;;)if(r){if(i.nodeType!=1)return!1;let n=i.childNodes[r-1];n.contentEditable=="false"?r--:(i=n,r=uf(i))}else{if(i==t)return!0;r=Ig(i),i=i.parentNode}}var ur=class{constructor(e,i,r=!0){this.node=e,this.offset=i,this.precise=r}static before(e,i){return new ur(e.parentNode,Ig(e),i)}static after(e,i){return new ur(e.parentNode,Ig(e)+1,i)}},qb=[],ei=class{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let i=this.posAtStart;for(let r of this.children){if(r==e)return i;i+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,i){return null}sync(e){if(this.dirty&2){let i=this.dom,r=null,n;for(let o of this.children){if(o.dirty){if(!o.dom&&(n=r?r.nextSibling:i.firstChild)){let a=ei.get(n);(!a||!a.parent&&a.canReuseDOM(o))&&o.reuseDOM(n)}o.sync(e),o.dirty=0}if(n=r?r.nextSibling:i.firstChild,e&&!e.written&&e.node==i&&n!=o.dom&&(e.written=!0),o.dom.parentNode==i)for(;n&&n!=o.dom;)n=NL(n);else i.insertBefore(o.dom,n);r=o.dom}for(n=r?r.nextSibling:i.firstChild,n&&e&&e.node==i&&(e.written=!0);n;)n=NL(n)}else if(this.dirty&1)for(let i of this.children)i.dirty&&(i.sync(e),i.dirty=0)}reuseDOM(e){}localPosFromDOM(e,i){let r;if(e==this.dom)r=this.dom.childNodes[i];else{let n=uf(e)==0?0:i==0?-1:1;for(;;){let o=e.parentNode;if(o==this.dom)break;n==0&&o.firstChild!=o.lastChild&&(e==o.firstChild?n=-1:n=1),e=o}n<0?r=e:r=e.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!ei.get(r);)r=r.nextSibling;if(!r)return this.length;for(let n=0,o=0;;n++){let a=this.children[n];if(a.dom==r)return o;o+=a.length+a.breakAfter}}domBoundsAround(e,i,r=0){let n=-1,o=-1,a=-1,l=-1;for(let h=0,u=r,c=r;h<this.children.length;h++){let f=this.children[h],d=u+f.length;if(u<e&&d>i)return f.domBoundsAround(e,i,u);if(d>=e&&n==-1&&(n=h,o=u),u>i&&f.dom.parentNode==this.dom){a=h,l=c;break}c=d,u=d+f.breakAfter}return{from:o,to:l<0?r+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:a<this.children.length&&a>=0?this.children[a].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let i=this.parent;i;i=i.parent){if(e&&(i.dirty|=2),i.dirty&1)return;i.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let i=e.parent;if(!i)return e;e=i}}replaceChildren(e,i,r=qb){this.markDirty();for(let n=e;n<i;n++){let o=this.children[n];o.parent==this&&o.destroy()}this.children.splice(e,i-e,...r);for(let n=0;n<r.length;n++)r[n].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new kg(this.children,e,this.children.length)}childPos(e,i=1){return this.childCursor().findPos(e,i)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,i,r,n,o,a){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}};ei.prototype.breakAfter=0;function NL(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}var kg=class{constructor(e,i,r){this.children=e,this.pos=i,this.i=r,this.off=0}findPos(e,i=1){for(;;){if(e>this.pos||e==this.pos&&(i>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}};function SO(t,e,i,r,n,o,a,l,h){let{children:u}=t,c=u.length?u[e]:null,f=o.length?o[o.length-1]:null,d=f?f.breakAfter:a;if(!(e==r&&c&&!a&&!d&&o.length<2&&c.merge(i,n,o.length?f:null,i==0,l,h))){if(r<u.length){let m=u[r];m&&n<m.length?(e==r&&(m=m.split(n),n=0),!d&&f&&m.merge(0,n,f,!0,0,h)?o[o.length-1]=m:(n&&m.merge(0,n,null,!1,0,h),o.push(m))):m!=null&&m.breakAfter&&(f?f.breakAfter=1:a=1),r++}for(c&&(c.breakAfter=a,i>0&&(!a&&o.length&&c.merge(i,c.length,o[0],!1,l,0)?c.breakAfter=o.shift().breakAfter:(i<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(i,c.length,null,!1,l,0),e++));e<r&&o.length;)if(u[r-1].become(o[o.length-1]))r--,o.pop(),h=o.length?0:l;else if(u[e].become(o[0]))e++,o.shift(),l=o.length?0:h;else break;!o.length&&e&&r<u.length&&!u[e-1].breakAfter&&u[r].merge(0,0,u[e-1],!1,l,h)&&e--,(e<r||o.length)&&t.replaceChildren(e,r,o)}}function CO(t,e,i,r,n,o){let a=t.childCursor(),{i:l,off:h}=a.findPos(i,1),{i:u,off:c}=a.findPos(e,-1),f=e-i;for(let d of r)f+=d.length;t.length+=f,SO(t,u,c,l,h,r,0,n,o)}var Pn=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},ab=typeof document!="undefined"?document:{documentElement:{style:{}}},lb=/Edge\/(\d+)/.exec(Pn.userAgent),MO=/MSIE \d/.test(Pn.userAgent),hb=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Pn.userAgent),qg=!!(MO||hb||lb),UL=!qg&&/gecko\/(\d+)/i.test(Pn.userAgent),$x=!qg&&/Chrome\/(\d+)/.exec(Pn.userAgent),GL="webkitFontSmoothing"in ab.documentElement.style,EO=!qg&&/Apple Computer/.test(Pn.vendor),zL=EO&&(/Mobile\/\w+/.test(Pn.userAgent)||Pn.maxTouchPoints>2),it={mac:zL||/Mac/.test(Pn.platform),windows:/Win/.test(Pn.platform),linux:/Linux|X11/.test(Pn.platform),ie:qg,ie_version:MO?ab.documentMode||6:hb?+hb[1]:lb?+lb[1]:0,gecko:UL,gecko_version:UL?+(/Firefox\/(\d+)/.exec(Pn.userAgent)||[0,0])[1]:0,chrome:!!$x,chrome_version:$x?+$x[1]:0,ios:zL,android:/Android\b/.test(Pn.userAgent),webkit:GL,safari:EO,webkit_version:GL?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:ab.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"},H6=256,fo=class extends ei{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,i,r){return r&&(!(r instanceof fo)||this.length-(i-e)+r.length>H6)?!1:(this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(i),this.markDirty(),!0)}split(e){let i=new fo(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),i}localPosFromDOM(e,i){return e==this.dom?i:i?this.text.length:0}domAtPos(e){return new ur(this.dom,e)}domBoundsAround(e,i,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,i){return ub(this.dom,e,i)}},es=class extends ei{constructor(e,i=[],r=0){super(),this.mark=e,this.children=i,this.length=r;for(let n of i)n.setParent(this)}setAttrs(e){if(wO(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let i in this.mark.attrs)e.setAttribute(i,this.mark.attrs[i]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,i,r,n,o,a){return r&&(!(r instanceof es&&r.mark.eq(this.mark))||e&&o<=0||i<this.length&&a<=0)?!1:(CO(this,e,i,r?r.children:[],o-1,a-1),this.markDirty(),!0)}split(e){let i=[],r=0,n=-1,o=0;for(let l of this.children){let h=r+l.length;h>e&&i.push(r<e?l.split(e-r):l),n<0&&r>=e&&(n=o),r=h,o++}let a=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new es(this.mark,i,a)}domAtPos(e){return AO(this,e)}coordsAt(e,i){return RO(this,e,i)}};function ub(t,e,i){let r=t.nodeValue.length;e>r&&(e=r);let n=e,o=e,a=0;e==0&&i<0||e==r&&i>=0?it.chrome||it.gecko||(e?(n--,a=1):o<r&&(o++,a=-1)):i<0?n--:o<r&&o++;let l=tu(t,n,o).getClientRects();if(!l.length)return xO;let h=l[(a?a<0:i>=0)?0:l.length-1];return it.safari&&!a&&h.width==0&&(h=Array.prototype.find.call(l,u=>u.width)||h),a?jb(h,a<0):h||null}var uo=class extends ei{constructor(e,i,r){super(),this.widget=e,this.length=i,this.side=r,this.prevWidget=null}static create(e,i,r){return new(e.customView||uo)(e,i,r)}split(e){let i=uo.create(this.widget,this.length-e,this.side);return this.length-=e,i}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,i,r,n,o,a){return r&&(!(r instanceof uo)||!this.widget.compare(r.widget)||e>0&&o<=0||i<this.length&&a<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-i),!0)}become(e){return e.length==this.length&&e instanceof uo&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Nt.empty;let e=this;for(;e.parent;)e=e.parent;let i=e.editorView,r=i&&i.state.doc,n=this.posAtStart;return r?r.slice(n,n+this.length):Nt.empty}domAtPos(e){return e==0?ur.before(this.dom):ur.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,i){let r=this.dom.getClientRects(),n=null;if(!r.length)return xO;for(let o=e>0?r.length-1:0;n=r[o],!(e>0?o==0:o==r.length-1||n.top<n.bottom);o+=e>0?-1:1);return this.length?n:jb(n,this.side>0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},Fg=class extends uo{domAtPos(e){let{topView:i,text:r}=this.widget;return i?cb(e,0,i,r,(n,o)=>n.domAtPos(o),n=>new ur(r,Math.min(n,r.nodeValue.length))):new ur(r,Math.min(e,r.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,i){let{topView:r,text:n}=this.widget;return r?TO(e,i,r,n):Math.min(i,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,i){let{topView:r,text:n}=this.widget;return r?cb(e,i,r,n,(o,a,l)=>o.coordsAt(a,l),(o,a)=>ub(n,o,a)):ub(n,e,i)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}canReuseDOM(){return!0}};function cb(t,e,i,r,n,o){if(i instanceof es){for(let a=i.dom.firstChild;a;a=a.nextSibling){let l=ei.get(a);if(!l)return o(t,e);let h=eu(a,r),u=l.length+(h?r.nodeValue.length:0);if(t<u||t==u&&l.getSide()<=0)return h?cb(t,e,l,r,n,o):n(l,t,e);t-=u}return n(i,i.length,-1)}else return i.dom==r?o(t,e):n(i,t,e)}function TO(t,e,i,r){if(i instanceof es)for(let n of i.children){let o=0,a=eu(n.dom,r);if(eu(n.dom,t))return o+(a?TO(t,e,n,r):n.localPosFromDOM(t,e));o+=a?r.nodeValue.length:n.length}else if(i.dom==r)return Math.min(e,r.nodeValue.length);return i.localPosFromDOM(t,e)}var Ba=class extends ei{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Ba&&e.side==this.side}split(){return new Ba(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return ur.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let i=this.dom.getBoundingClientRect(),r=W6(this,this.side>0?-1:1);return r&&r.top<i.bottom&&r.bottom>i.top?{left:i.left,right:i.right,top:r.top,bottom:r.bottom}:i}get overrideDOMText(){return Nt.empty}};fo.prototype.children=uo.prototype.children=Ba.prototype.children=qb;function W6(t,e){let i=t.parent,r=i?i.children.indexOf(t):-1;for(;i&&r>=0;)if(e<0?r>0:r<i.children.length){let n=i.children[r+e];if(n instanceof fo){let o=n.coordsAt(e<0?n.length:0,e);if(o)return o}r+=e}else if(i instanceof es&&i.parent)r=i.parent.children.indexOf(i)+(e<0?0:1),i=i.parent;else{let n=i.dom.lastChild;if(n&&n.nodeName=="BR")return n.getClientRects()[0];break}}function AO(t,e){let i=t.dom,{children:r}=t,n=0;for(let o=0;n<r.length;n++){let a=r[n],l=o+a.length;if(!(l==o&&a.getSide()<=0)){if(e>o&&e<l&&a.dom.parentNode==i)return a.domAtPos(e-o);if(e<=o)break;o=l}}for(let o=n;o>0;o--){let a=r[o-1];if(a.dom.parentNode==i)return a.domAtPos(a.length)}for(let o=n;o<r.length;o++){let a=r[o];if(a.dom.parentNode==i)return a.domAtPos(0)}return new ur(i,0)}function PO(t,e,i){let r,{children:n}=t;i>0&&e instanceof es&&n.length&&(r=n[n.length-1])instanceof es&&r.mark.eq(e.mark)?PO(r,e.children[0],i-1):(n.push(e),e.setParent(t)),t.length+=e.length}function RO(t,e,i){let r=null,n=-1,o=null,a=-1;function l(u,c){for(let f=0,d=0;f<u.children.length&&d<=c;f++){let m=u.children[f],v=d+m.length;v>=c&&(m.children.length?l(m,c-d):!o&&(v>c||d==v&&m.getSide()>0)?(o=m,a=c-d):(d<c||d==v&&m.getSide()<0)&&(r=m,n=c-d)),d=v}}l(t,e);let h=(i<0?r:o)||r||o;return h?h.coordsAt(Math.max(0,h==r?n:a),i):V6(t)}function V6(t){let e=t.dom.lastChild;if(!e)return t.dom.getBoundingClientRect();let i=hf(e);return i[i.length-1]||null}function fb(t,e){for(let i in t)i=="class"&&e.class?e.class+=" "+t.class:i=="style"&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}function Xb(t,e){if(t==e)return!0;if(!t||!e)return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!=r.length)return!1;for(let n of i)if(r.indexOf(n)==-1||t[n]!==e[n])return!1;return!0}function db(t,e,i){let r=null;if(e)for(let n in e)i&&n in i||t.removeAttribute(r=n);if(i)for(let n in i)e&&e[n]==i[n]||t.setAttribute(r=n,i[n]);return!!r}var Ps=class{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}},ti=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(ti||(ti={})),xt=class extends As{constructor(e,i,r,n){super(),this.startSide=e,this.endSide=i,this.widget=r,this.spec=n}get heightRelevant(){return!1}static mark(e){return new iu(e)}static widget(e){let i=e.side||0,r=!!e.block;return i+=r?i>0?3e8:-4e8:i>0?1e8:-1e8,new Ko(e,i,i,r,e.widget||null,!1)}static replace(e){let i=!!e.block,r,n;if(e.isBlockGap)r=-5e8,n=4e8;else{let{start:o,end:a}=LO(e,i);r=(o?i?-3e8:-1:5e8)-1,n=(a?i?2e8:1:-6e8)+1}return new Ko(e,r,n,i,e.widget||null,!0)}static line(e){return new Bl(e)}static set(e,i=!1){return zt.of(e,i)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};xt.none=zt.empty;var iu=class extends xt{constructor(e){let{start:i,end:r}=LO(e);super(i?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof iu&&this.tagName==e.tagName&&this.class==e.class&&Xb(this.attrs,e.attrs)}range(e,i=e){if(e>=i)throw new RangeError("Mark decorations may not be empty");return super.range(e,i)}};iu.prototype.point=!1;var Bl=class extends xt{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Bl&&this.spec.class==e.spec.class&&Xb(this.spec.attributes,e.spec.attributes)}range(e,i=e){if(i!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,i)}};Bl.prototype.mapMode=Or.TrackBefore;Bl.prototype.point=!0;var Ko=class extends xt{constructor(e,i,r,n,o,a){super(i,r,o,e),this.block=n,this.isReplace=a,this.mapMode=n?i<=0?Or.TrackBefore:Or.TrackAfter:Or.TrackDel}get type(){return this.startSide<this.endSide?ti.WidgetRange:this.startSide<=0?ti.WidgetBefore:ti.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof Ko&&j6(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,i=e){if(this.isReplace&&(e>i||e==i&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&i!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,i)}};Ko.prototype.point=!0;function LO(t,e=!1){let{inclusiveStart:i,inclusiveEnd:r}=t;return i==null&&(i=t.inclusive),r==null&&(r=t.inclusive),{start:i!=null?i:e,end:r!=null?r:e}}function j6(t,e){return t==e||!!(t&&e&&t.compare(e))}function pb(t,e,i,r=0){let n=i.length-1;n>=0&&i[n]+r>=t?i[n]=Math.max(i[n],e):i.push(t,e)}var br=class extends ei{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,i,r,n,o,a){if(r){if(!(r instanceof br))return!1;this.dom||r.transferDOM(this)}return n&&this.setDeco(r?r.attrs:null),CO(this,e,i,r?r.children:[],o,a),!0}split(e){let i=new br;if(i.breakAfter=this.breakAfter,this.length==0)return i;let{i:r,off:n}=this.childPos(e);n&&(i.append(this.children[r].split(n),0),this.children[r].merge(n,this.children[r].length,null,!1,0,0),r++);for(let o=r;o<this.children.length;o++)i.append(this.children[o],0);for(;r>0&&this.children[r-1].length==0;)this.children[--r].destroy();return this.children.length=r,this.markDirty(),this.length=e,i}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Xb(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,i){PO(this,e,i)}addLineDeco(e){let i=e.spec.attributes,r=e.spec.class;i&&(this.attrs=fb(i,this.attrs||{})),r&&(this.attrs=fb({class:r},this.attrs||{}))}domAtPos(e){return AO(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var i;this.dom?this.dirty&4&&(wO(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(db(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let r=this.dom.lastChild;for(;r&&ei.get(r)instanceof es;)r=r.lastChild;if(!r||!this.length||r.nodeName!="BR"&&((i=ei.get(r))===null||i===void 0?void 0:i.isEditable)==!1&&(!it.ios||!this.children.some(n=>n instanceof fo))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let i of this.children){if(!(i instanceof fo)||/[^ -~]/.test(i.text))return null;let r=hf(i.dom);if(r.length!=1)return null;e+=r[0].width}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}:null}coordsAt(e,i){return RO(this,e,i)}become(e){return!1}get type(){return ti.Text}static find(e,i){for(let r=0,n=0;r<e.children.length;r++){let o=e.children[r],a=n+o.length;if(a>=i){if(o instanceof br)return o;if(a>i)break}n=a+o.breakAfter}return null}},Zo=class extends ei{constructor(e,i,r){super(),this.widget=e,this.length=i,this.type=r,this.breakAfter=0,this.prevWidget=null}merge(e,i,r,n,o,a){return r&&(!(r instanceof Zo)||!this.widget.compare(r.widget)||e>0&&o<=0||i<this.length&&a<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-i),!0)}domAtPos(e){return e==0?ur.before(this.dom):ur.after(this.dom,e==this.length)}split(e){let i=this.length-e;this.length=e;let r=new Zo(this.widget,i,this.type);return r.breakAfter=this.breakAfter,r}get children(){return qb}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Nt.empty}domBoundsAround(){return null}become(e){return e instanceof Zo&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},cf=class{constructor(e,i,r,n){this.doc=e,this.pos=i,this.end=r,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=i}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof Zo&&e.type==ti.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new br),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(xg(new Ba(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||this.getLine()}buildText(e,i,r){for(;e>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:a,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(a){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=o,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(i.slice(i.length-r)),this.getLine().append(xg(new fo(this.text.slice(this.textOff,this.textOff+n)),i),r),this.atCursorPos=!0,this.textOff+=n,e-=n,r=0}}span(e,i,r,n){this.buildText(i-e,r,n),this.pos=i,this.openStart<0&&(this.openStart=n)}point(e,i,r,n,o,a){if(this.disallowBlockEffectsFor[a]&&r instanceof Ko){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(i>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=i-e;if(r instanceof Ko)if(r.block){let{type:h}=r;h==ti.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Zo(r.widget||new Bg("div"),l,h))}else{let h=uo.create(r.widget||new Bg("span"),l,l?0:r.startSide),u=this.atCursorPos&&!h.isEditable&&o<=n.length&&(e<i||r.startSide>0),c=!h.isEditable&&(e<i||o>n.length||r.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!u&&(this.pendingBuffer=0),this.flushBuffer(n),u&&(f.append(xg(new Ba(1),n),o),o=n.length+Math.max(0,o-n.length)),f.append(xg(h,n),o),this.atCursorPos=c,this.pendingBuffer=c?e<i||o>n.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=n.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=i),this.openStart<0&&(this.openStart=o)}static build(e,i,r,n,o){let a=new cf(e,i,r,o);return a.openEnd=zt.spans(n,i,r,a),a.openStart<0&&(a.openStart=a.openEnd),a.finish(a.openEnd),a}};function xg(t,e){for(let i of e)t=new es(i,[t],t.length);return t}var Bg=class extends Ps{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}},OO=Qe.define(),DO=Qe.define(),IO=Qe.define(),kO=Qe.define(),mb=Qe.define(),FO=Qe.define(),BO=Qe.define({combine:t=>t.some(e=>e)}),NO=Qe.define({combine:t=>t.some(e=>e)}),ru=class{constructor(e,i="nearest",r="nearest",n=5,o=5){this.range=e,this.y=i,this.x=r,this.yMargin=n,this.xMargin=o}map(e){return e.empty?this:new ru(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}},HL=Lt.define({map:(t,e)=>t.map(e)});function Rn(t,e,i){let r=t.facet(kO);r.length?r[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}var Xg=Qe.define({combine:t=>t.length?t[0]:!0}),q6=0,tf=Qe.define(),ki=class{constructor(e,i,r,n){this.id=e,this.create=i,this.domEventHandlers=r,this.extension=n(this)}static define(e,i){let{eventHandlers:r,provide:n,decorations:o}=i||{};return new ki(q6++,e,r,a=>{let l=[tf.of(a)];return o&&l.push(ff.of(h=>{let u=h.plugin(a);return u?o(u):xt.none})),n&&l.push(n(a)),l})}static fromClass(e,i){return ki.define(r=>new e(r),i)}},sf=class{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let i=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(i)}catch(r){if(Rn(i.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(n){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(i){Rn(e.state,i,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var i;if(!((i=this.value)===null||i===void 0)&&i.destroy)try{this.value.destroy()}catch(r){Rn(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}},UO=Qe.define(),Yb=Qe.define(),ff=Qe.define(),GO=Qe.define(),zO=Qe.define(),rf=Qe.define(),$n=class{constructor(e,i,r,n){this.fromA=e,this.toA=i,this.fromB=r,this.toB=n}join(e){return new $n(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let i=e.length,r=this;for(;i>0;i--){let n=e[i-1];if(!(n.fromA>r.toA)){if(n.toA<r.fromA)break;r=r.join(n),e.splice(i-1,1)}}return e.splice(i,0,r),e}static extendWithRanges(e,i){if(i.length==0)return e;let r=[];for(let n=0,o=0,a=0,l=0;;n++){let h=n==e.length?null:e[n],u=a-l,c=h?h.fromB:1e9;for(;o<i.length&&i[o]<c;){let f=i[o],d=i[o+1],m=Math.max(l,f),v=Math.min(c,d);if(m<=v&&new $n(m+u,v+u,m,v).addToSet(r),d>c)break;o+=2}if(!h)return r;new $n(h.fromA,h.toA,h.fromB,h.toB).addToSet(r),a=h.toA,l=h.toB}}},nu=class{constructor(e,i,r){this.view=e,this.state=i,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=yi.empty(this.startState.doc.length);for(let a of r)this.changes=this.changes.compose(a.changes);let n=[];this.changes.iterChangedRanges((a,l,h,u)=>n.push(new $n(a,l,h,u))),this.changedRanges=n;let o=e.hasFocus;o!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=o,this.flags|=1)}static create(e,i,r){return new nu(e,i,r)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}},hi=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(hi||(hi={})),gb=hi.LTR,X6=hi.RTL;function HO(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}var Y6=HO("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Z6=HO("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),vb=Object.create(null),ho=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);vb[e]=i,vb[i]=-e}function K6(t){return t<=247?Y6[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?Z6[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8203?256:64336<=t&&t<=65023?4:t==8204?256:1}var Q6=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/,Fa=class{constructor(e,i,r){this.from=e,this.to=i,this.level=r}get dir(){return this.level%2?X6:gb}side(e,i){return this.dir==i==e?this.to:this.from}static find(e,i,r,n){let o=-1;for(let a=0;a<e.length;a++){let l=e[a];if(l.from<=i&&l.to>=i){if(l.level==r)return a;(o<0||(n!=0?n<0?l.from<i:l.to>i:e[o].level>l.level))&&(o=a)}}if(o<0)throw new RangeError("Index out of range");return o}},bi=[];function J6(t,e){let i=t.length,r=e==gb?1:2,n=e==gb?2:1;if(!t||r==1&&!Q6.test(t))return WO(i);for(let a=0,l=r,h=r;a<i;a++){let u=K6(t.charCodeAt(a));u==512?u=l:u==8&&h==4&&(u=16),bi[a]=u==4?2:u,u&7&&(h=u),l=u}for(let a=0,l=r,h=r;a<i;a++){let u=bi[a];if(u==128)a<i-1&&l==bi[a+1]&&l&24?u=bi[a]=l:bi[a]=256;else if(u==64){let c=a+1;for(;c<i&&bi[c]==64;)c++;let f=a&&l==8||c<i&&bi[c]==8?h==1?1:8:256;for(let d=a;d<c;d++)bi[d]=f;a=c-1}else u==8&&h==1&&(bi[a]=1);l=u,u&7&&(h=u)}for(let a=0,l=0,h=0,u,c,f;a<i;a++)if(c=vb[u=t.charCodeAt(a)])if(c<0){for(let d=l-3;d>=0;d-=3)if(ho[d+1]==-c){let m=ho[d+2],v=m&2?r:m&4?m&1?n:r:0;v&&(bi[a]=bi[ho[d]]=v),l=d;break}}else{if(ho.length==189)break;ho[l++]=a,ho[l++]=u,ho[l++]=h}else if((f=bi[a])==2||f==1){let d=f==r;h=d?0:1;for(let m=l-3;m>=0;m-=3){let v=ho[m+2];if(v&2)break;if(d)ho[m+2]|=2;else{if(v&4)break;ho[m+2]|=4}}}for(let a=0;a<i;a++)if(bi[a]==256){let l=a+1;for(;l<i&&bi[l]==256;)l++;let h=(a?bi[a-1]:r)==1,u=(l<i?bi[l]:r)==1,c=h==u?h?1:2:r;for(let f=a;f<l;f++)bi[f]=c;a=l-1}let o=[];if(r==1)for(let a=0;a<i;){let l=a,h=bi[a++]!=1;for(;a<i&&h==(bi[a]!=1);)a++;if(h)for(let u=a;u>l;){let c=u,f=bi[--u]!=2;for(;u>l&&f==(bi[u-1]!=2);)u--;o.push(new Fa(u,c,f?2:1))}else o.push(new Fa(l,a,0))}else for(let a=0;a<i;){let l=a,h=bi[a++]==2;for(;a<i&&h==(bi[a]==2);)a++;o.push(new Fa(l,a,h?1:2))}return o}function WO(t){return[new Fa(0,t,0)]}var VO="";function $6(t,e,i,r,n){var o;let a=r.head-t.from,l=-1;if(a==0){if(!n||!t.length)return null;e[0].level!=i&&(a=e[0].side(!1,i),l=0)}else if(a==t.length){if(n)return null;let d=e[e.length-1];d.level!=i&&(a=d.side(!0,i),l=e.length-1)}l<0&&(l=Fa.find(e,a,(o=r.bidiLevel)!==null&&o!==void 0?o:-1,r.assoc));let h=e[l];a==h.side(n,i)&&(h=e[l+=n?1:-1],a=h.side(!n,i));let u=n==(h.dir==i),c=hr(t.text,a,u);if(VO=t.text.slice(Math.min(a,c),Math.max(a,c)),c!=h.side(n,i))return ve.cursor(c+t.from,u?-1:1,h.level);let f=l==(n?e.length-1:0)?null:e[l+(n?1:-1)];return!f&&h.level!=i?ve.cursor(n?t.to:t.from,n?-1:1,i):f&&f.level<h.level?ve.cursor(f.side(!n,i)+t.from,n?1:-1,f.level):ve.cursor(c+t.from,n?-1:1,h.level)}var ka="\uFFFF",Ng=class{constructor(e,i){this.points=e,this.text="",this.lineSeparator=i.facet(Ct.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=ka}readRange(e,i){if(!e)return this;let r=e.parentNode;for(let n=e;;){this.findPointBefore(r,n),this.readNode(n);let o=n.nextSibling;if(o==i)break;let a=ei.get(n),l=ei.get(o);(a&&l?a.breakAfter:(a?a.breakAfter:WL(n))||WL(o)&&(n.nodeName!="BR"||n.cmIgnore))&&this.lineBreak(),n=o}return this.findPointBefore(r,i),this}readTextNode(e){let i=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,i.length));for(let r=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let o=-1,a=1,l;if(this.lineSeparator?(o=i.indexOf(this.lineSeparator,r),a=this.lineSeparator.length):(l=n.exec(i))&&(o=l.index,a=l[0].length),this.append(i.slice(r,o<0?i.length:o)),o<0)break;if(this.lineBreak(),a>1)for(let h of this.points)h.node==e&&h.pos>this.text.length&&(h.pos-=a-1);r=o+a}}readNode(e){if(e.cmIgnore)return;let i=ei.get(e),r=i&&i.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let n=r.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,i){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==i&&(r.pos=this.text.length)}findPointInside(e,i){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+Math.min(i,r.offset))}};function WL(t){return t.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}var Ug=class{constructor(e,i){this.node=e,this.offset=i,this.pos=-1}},Gg=class extends ei{constructor(e){super(),this.view=e,this.compositionDeco=xt.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new br],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new $n(0,0,0,e.state.doc.length)],0)}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:a,toA:l})=>l<this.minWidthFrom||a>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=xt.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=t8(this.view,e.changes)),(it.ie||it.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let r=this.decorations,n=this.updateDeco(),o=r8(r,n,e.changes);return i=$n.extendWithRanges(i,o),this.dirty==0&&i.length==0?!1:(this.updateInner(i,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,i);let{observer:r}=this.view;r.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=it.chrome||it.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.sync(o),this.dirty=0,o&&(o.written||r.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""});let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Zo&&o.widget instanceof zg&&n.push(o.dom);r.updateGaps(n)}updateChildren(e,i){let r=this.childCursor(i);for(let n=e.length-1;;n--){let o=n>=0?e[n]:null;if(!o)break;let{fromA:a,toA:l,fromB:h,toB:u}=o,{content:c,breakAtStart:f,openStart:d,openEnd:m}=cf.build(this.view.state.doc,h,u,this.decorations,this.dynamicDecorationMap),{i:v,off:g}=r.findPos(l,1),{i:p,off:_}=r.findPos(a,-1);SO(this,p,_,v,g,c,f,d,m)}}updateSelection(e=!1,i=!1){if((e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange(),!(i||this.mayControlSelection()))return;let r=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,o=this.domAtPos(n.anchor),a=n.empty?o:this.domAtPos(n.head);if(it.gecko&&n.empty&&e8(o)){let h=document.createTextNode("");this.view.observer.ignore(()=>o.node.insertBefore(h,o.node.childNodes[o.offset]||null)),o=a=new ur(h,0),r=!0}let l=this.view.observer.selectionRange;(r||!l.focusNode||!Dg(o.node,o.offset,l.anchorNode,l.anchorOffset)||!Dg(a.node,a.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{it.android&&it.chrome&&this.dom.contains(l.focusNode)&&n8(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=Og(this.view.root);if(h)if(n.empty){if(it.gecko){let u=i8(o.node,o.offset);if(u&&u!=3){let c=qO(o.node,o.offset,u==1?1:-1);c&&(o=new ur(c,u==1?0:c.nodeValue.length))}}h.collapse(o.node,o.offset),n.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=n.bidiLevel)}else if(h.extend){h.collapse(o.node,o.offset);try{h.extend(a.node,a.offset)}catch(u){}}else{let u=document.createRange();n.anchor>n.head&&([o,a]=[a,o]),u.setEnd(a.node,a.offset),u.setStart(o.node,o.offset),h.removeAllRanges(),h.addRange(u)}}),this.view.observer.setSelectionRange(o,a)),this.impreciseAnchor=o.precise?null:new ur(l.anchorNode,l.anchorOffset),this.impreciseHead=a.precise?null:new ur(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let{view:e}=this,i=e.state.selection.main,r=Og(e.root),{anchorNode:n,anchorOffset:o}=e.observer.selectionRange;if(!r||!i.empty||!i.assoc||!r.modify)return;let a=br.find(this,i.head);if(!a)return;let l=a.posAtStart;if(i.head==l||i.head==l+a.length)return;let h=this.coordsAt(i.head,-1),u=this.coordsAt(i.head,1);if(!h||!u||h.bottom>u.top)return;let c=this.domAtPos(i.head+i.assoc);r.collapse(c.node,c.offset),r.modify("move",i.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let f=e.observer.selectionRange;e.docView.posFromDOM(f.anchorNode,f.anchorOffset)!=i.from&&r.collapse(n,o)}mayControlSelection(){let e=this.view.root.activeElement;return e==this.dom||Tg(this.dom,this.view.observer.selectionRange)&&!(e&&this.dom.contains(e))}nearest(e){for(let i=e;i;){let r=ei.get(i);if(r&&r.rootView==this)return r;i=i.parentNode}return null}posFromDOM(e,i){let r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,i)+r.posAtStart}domAtPos(e){let{i,off:r}=this.childCursor().findPos(e,-1);for(;i<this.children.length-1;){let n=this.children[i];if(r<n.length||n instanceof br)break;i++,r=0}return this.children[i].domAtPos(r)}coordsAt(e,i){for(let r=this.length,n=this.children.length-1;;n--){let o=this.children[n],a=r-o.breakAfter-o.length;if(e>a||e==a&&o.type!=ti.WidgetBefore&&o.type!=ti.WidgetAfter&&(!n||i==2||this.children[n-1].breakAfter||this.children[n-1].type==ti.WidgetBefore&&i>-2))return o.coordsAt(e-a,i);r=a}}measureVisibleLineHeights(e){let i=[],{from:r,to:n}=e,o=this.view.contentDOM.clientWidth,a=o>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,h=this.view.textDirection==hi.LTR;for(let u=0,c=0;c<this.children.length;c++){let f=this.children[c],d=u+f.length;if(d>n)break;if(u>=r){let m=f.dom.getBoundingClientRect();if(i.push(m.height),a){let v=f.dom.lastChild,g=v?hf(v):[];if(g.length){let p=g[g.length-1],_=h?p.right-m.left:m.right-p.left;_>l&&(l=_,this.minWidth=o,this.minWidthFrom=u,this.minWidthTo=d)}}}u=d+f.breakAfter}return i}textDirectionAt(e){let{i}=this.childPos(e,1);return getComputedStyle(this.children[i].dom).direction=="rtl"?hi.RTL:hi.LTR}measureTextSize(){for(let n of this.children)if(n instanceof br){let o=n.measureTextSize();if(o)return o}let e=document.createElement("div"),i,r;return e.className="cm-line",e.style.width="99999px",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let n=hf(e.firstChild)[0];i=e.getBoundingClientRect().height,r=n?n.width/27:7,e.remove()}),{lineHeight:i,charWidth:r}}childCursor(e=this.length){let i=this.children.length;return i&&(e-=this.children[--i].length),new kg(this.children,e,i)}computeBlockGapDeco(){let e=[],i=this.view.viewState;for(let r=0,n=0;;n++){let o=n==i.viewports.length?null:i.viewports[n],a=o?o.from-1:this.length;if(a>r){let l=i.lineBlockAt(a).bottom-i.lineBlockAt(r).top;e.push(xt.replace({widget:new zg(l),block:!0,inclusive:!0,isBlockGap:!0}).range(r,a))}if(!o)break;r=o.to+1}return xt.set(e)}updateDeco(){let e=this.view.state.facet(ff).map((i,r)=>(this.dynamicDecorationMap[r]=typeof i=="function")?i(this.view):i);for(let i=e.length;i<e.length+3;i++)this.dynamicDecorationMap[i]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:i}=e,r=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1),n;if(!r)return;!i.empty&&(n=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(r={left:Math.min(r.left,n.left),top:Math.min(r.top,n.top),right:Math.max(r.right,n.right),bottom:Math.max(r.bottom,n.bottom)});let o=0,a=0,l=0,h=0;for(let c of this.view.state.facet(zO).map(f=>f(this.view)))if(c){let{left:f,right:d,top:m,bottom:v}=c;f!=null&&(o=Math.max(o,f)),d!=null&&(a=Math.max(a,d)),m!=null&&(l=Math.max(l,m)),v!=null&&(h=Math.max(h,v))}let u={left:r.left-o,top:r.top-l,right:r.right+a,bottom:r.bottom+h};N6(this.view.scrollDOM,u,i.head<i.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==hi.LTR)}};function e8(t){return t.node.nodeType==1&&t.node.firstChild&&(t.offset==0||t.node.childNodes[t.offset-1].contentEditable=="false")&&(t.offset==t.node.childNodes.length||t.node.childNodes[t.offset].contentEditable=="false")}var zg=class extends Ps{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function jO(t){let e=t.observer.selectionRange,i=e.focusNode&&qO(e.focusNode,e.focusOffset,0);if(!i)return null;let r=t.docView.nearest(i);if(!r)return null;if(r instanceof br){let n=i;for(;n.parentNode!=r.dom;)n=n.parentNode;let o=n.previousSibling;for(;o&&!ei.get(o);)o=o.previousSibling;let a=o?ei.get(o).posAtEnd:r.posAtStart;return{from:a,to:a,node:n,text:i}}else{for(;;){let{parent:o}=r;if(!o)return null;if(o instanceof br)break;r=o}let n=r.posAtStart;return{from:n,to:n+r.length,node:r.dom,text:i}}}function t8(t,e){let i=jO(t);if(!i)return xt.none;let{from:r,to:n,node:o,text:a}=i,l=e.mapPos(r,1),h=Math.max(l,e.mapPos(n,-1)),{state:u}=t,c=o.nodeType==3?o.nodeValue:new Ng([],u).readRange(o.firstChild,null).text;if(h-l<c.length)if(u.doc.sliceString(l,Math.min(u.doc.length,l+c.length),ka)==c)h=l+c.length;else if(u.doc.sliceString(Math.max(0,h-c.length),h,ka)==c)l=h-c.length;else return xt.none;else if(u.doc.sliceString(l,h,ka)!=c)return xt.none;let f=ei.get(o);return f instanceof Fg?f=f.widget.topView:f&&(f.parent=null),xt.set(xt.replace({widget:new _b(o,a,f),inclusive:!0}).range(l,h))}var _b=class extends Ps{constructor(e,i,r){super(),this.top=e,this.text=i,this.topView=r}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Fg}};function qO(t,e,i){for(;;){if(t.nodeType==3)return t;if(t.nodeType==1&&e>0&&i<=0)t=t.childNodes[e-1],e=uf(t);else if(t.nodeType==1&&e<t.childNodes.length&&i>=0)t=t.childNodes[e],e=0;else return null}}function i8(t,e){return t.nodeType!=1?0:(e&&t.childNodes[e-1].contentEditable=="false"?1:0)|(e<t.childNodes.length&&t.childNodes[e].contentEditable=="false"?2:0)}var yb=class{constructor(){this.changes=[]}compareRange(e,i){pb(e,i,this.changes)}comparePoint(e,i){pb(e,i,this.changes)}};function r8(t,e,i){let r=new yb;return zt.compare(t,e,i,r),r.changes}function n8(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(i.nodeType==1&&i.contentEditable=="false")return!0;return!1}function s8(t,e,i=1){let r=t.charCategorizer(e),n=t.doc.lineAt(e),o=e-n.from;if(n.length==0)return ve.cursor(e);o==0?i=1:o==n.length&&(i=-1);let a=o,l=o;i<0?a=hr(n.text,o,!1):l=hr(n.text,o);let h=r(n.text.slice(a,l));for(;a>0;){let u=hr(n.text,a,!1);if(r(n.text.slice(u,a))!=h)break;a=u}for(;l<n.length;){let u=hr(n.text,l);if(r(n.text.slice(l,u))!=h)break;l=u}return ve.range(a+n.from,l+n.from)}function o8(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function a8(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function eb(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function VL(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function jL(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function xb(t,e,i){let r,n,o,a,l=!1,h,u,c,f;for(let v=t.firstChild;v;v=v.nextSibling){let g=hf(v);for(let p=0;p<g.length;p++){let _=g[p];n&&eb(n,_)&&(_=VL(jL(_,n.bottom),n.top));let x=o8(e,_),b=a8(i,_);if(x==0&&b==0)return v.nodeType==3?qL(v,e,i):xb(v,e,i);(!r||a>b||a==b&&o>x)&&(r=v,n=_,o=x,a=b,l=!x||(x>0?p<g.length-1:p>0)),x==0?i>_.bottom&&(!c||c.bottom<_.bottom)?(h=v,c=_):i<_.top&&(!f||f.top>_.top)&&(u=v,f=_):c&&eb(c,_)?c=jL(c,_.bottom):f&&eb(f,_)&&(f=VL(f,_.top))}}if(c&&c.bottom>=i?(r=h,n=c):f&&f.top<=i&&(r=u,n=f),!r)return{node:t,offset:0};let d=Math.max(n.left,Math.min(n.right,e));if(r.nodeType==3)return qL(r,d,i);if(l&&r.contentEditable!="false")return xb(r,d,i);let m=Array.prototype.indexOf.call(t.childNodes,r)+(e>=(n.left+n.right)/2?1:0);return{node:t,offset:m}}function qL(t,e,i){let r=t.nodeValue.length,n=-1,o=1e9,a=0;for(let l=0;l<r;l++){let h=tu(t,l,l+1).getClientRects();for(let u=0;u<h.length;u++){let c=h[u];if(c.top==c.bottom)continue;a||(a=e-c.left);let f=(c.top>i?c.top-i:i-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&f<o){let d=e>=(c.left+c.right)/2,m=d;if((it.chrome||it.gecko)&&tu(t,l).getBoundingClientRect().left==c.right&&(m=!d),f<=0)return{node:t,offset:l+(m?1:0)};n=l+(m?1:0),o=f}}}return{node:t,offset:n>-1?n:a>0?t.nodeValue.length:0}}function XO(t,{x:e,y:i},r,n=-1){var o;let a=t.contentDOM.getBoundingClientRect(),l=a.top+t.viewState.paddingTop,h,{docHeight:u}=t.viewState,c=i-l;if(c<0)return 0;if(c>u)return t.state.doc.length;for(let _=t.defaultLineHeight/2,x=!1;h=t.elementAtHeight(c),h.type!=ti.Text;)for(;c=n>0?h.bottom+_:h.top-_,!(c>=0&&c<=u);){if(x)return r?null:0;x=!0,n=-n}i=l+c;let f=h.from;if(f<t.viewport.from)return t.viewport.from==0?0:r?null:XL(t,a,h,e,i);if(f>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:r?null:XL(t,a,h,e,i);let d=t.dom.ownerDocument,m=t.root.elementFromPoint?t.root:d,v=m.elementFromPoint(e,i);v&&!t.contentDOM.contains(v)&&(v=null),v||(e=Math.max(a.left+1,Math.min(a.right-1,e)),v=m.elementFromPoint(e,i),v&&!t.contentDOM.contains(v)&&(v=null));let g,p=-1;if(v&&((o=t.docView.nearest(v))===null||o===void 0?void 0:o.isEditable)!=!1){if(d.caretPositionFromPoint){let _=d.caretPositionFromPoint(e,i);_&&({offsetNode:g,offset:p}=_)}else if(d.caretRangeFromPoint){let _=d.caretRangeFromPoint(e,i);_&&({startContainer:g,startOffset:p}=_,(!t.contentDOM.contains(g)||it.safari&&l8(g,p,e)||it.chrome&&h8(g,p,e))&&(g=void 0))}}if(!g||!t.docView.dom.contains(g)){let _=br.find(t.docView,f);if(!_)return c>h.top+h.height/2?h.to:h.from;({node:g,offset:p}=xb(_.dom,e,i))}return t.docView.posFromDOM(g,p)}function XL(t,e,i,r,n){let o=Math.round((r-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>t.defaultLineHeight*1.5){let l=Math.floor((n-i.top)/t.defaultLineHeight);o+=l*t.viewState.heightOracle.lineLength}let a=t.state.sliceDoc(i.from,i.to);return i.from+vg(a,o,t.state.tabSize)}function l8(t,e,i){let r;if(t.nodeType!=3||e!=(r=t.nodeValue.length))return!1;for(let n=t.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return tu(t,r-1,r).getBoundingClientRect().left>i}function h8(t,e,i){if(e!=0)return!1;for(let n=t;;){let o=n.parentNode;if(!o||o.nodeType!=1||o.firstChild!=n)return!1;if(o.classList.contains("cm-line"))break;n=o}let r=t.nodeType==1?t.getBoundingClientRect():tu(t,0,Math.max(t.nodeValue.length,1)).getBoundingClientRect();return i-r.left>5}function u8(t,e,i,r){let n=t.state.doc.lineAt(e.head),o=!r||!t.lineWrapping?null:t.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head);if(o){let h=t.dom.getBoundingClientRect(),u=t.textDirectionAt(n.from),c=t.posAtCoords({x:i==(u==hi.LTR)?h.right-1:h.left+1,y:(o.top+o.bottom)/2});if(c!=null)return ve.cursor(c,i?-1:1)}let a=br.find(t.docView,e.head),l=a?i?a.posAtEnd:a.posAtStart:i?n.to:n.from;return ve.cursor(l,i?-1:1)}function YL(t,e,i,r){let n=t.state.doc.lineAt(e.head),o=t.bidiSpans(n),a=t.textDirectionAt(n.from);for(let l=e,h=null;;){let u=$6(n,o,a,l,i),c=VO;if(!u){if(n.number==(i?t.state.doc.lines:1))return l;c=`
`,n=t.state.doc.line(n.number+(i?1:-1)),o=t.bidiSpans(n),u=ve.cursor(i?n.from:n.to)}if(h){if(!h(c))return l}else{if(!r)return u;h=r(c)}l=u}}function c8(t,e,i){let r=t.state.charCategorizer(e),n=r(i);return o=>{let a=r(o);return n==Jt.Space&&(n=a),n==a}}function f8(t,e,i,r){let n=e.head,o=i?1:-1;if(n==(i?t.state.doc.length:0))return ve.cursor(n,e.assoc);let a=e.goalColumn,l,h=t.contentDOM.getBoundingClientRect(),u=t.coordsAtPos(n),c=t.documentTop;if(u)a==null&&(a=u.left-h.left),l=o<0?u.top:u.bottom;else{let m=t.viewState.lineBlockAt(n);a==null&&(a=Math.min(h.right-h.left,t.defaultCharacterWidth*(n-m.from))),l=(o<0?m.top:m.bottom)+c}let f=h.left+a,d=r!=null?r:t.defaultLineHeight>>1;for(let m=0;;m+=10){let v=l+(d+m)*o,g=XO(t,{x:f,y:v},!1,o);if(v<h.top||v>h.bottom||(o<0?g<n:g>n))return ve.cursor(g,e.assoc,void 0,a)}}function tb(t,e,i){let r=t.state.facet(GO).map(n=>n(t));for(;;){let n=!1;for(let o of r)o.between(i.from-1,i.from+1,(a,l,h)=>{i.from>a&&i.from<l&&(i=e.head>i.from?ve.cursor(a,1):ve.cursor(l,-1),n=!0)});if(!n)return i}}var bb=class{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.mouseSelection=null;let i=(r,n)=>{this.ignoreDuringComposition(n)||n.type=="keydown"&&this.keydown(e,n)||(this.mustFlushObserver(n)&&e.observer.forceFlush(),this.runCustomHandlers(n.type,e,n)?n.preventDefault():r(e,n))};for(let r in rr){let n=rr[r];e.contentDOM.addEventListener(r,o=>{ZL(e,o)&&i(n,o)},Sb[r]),this.registeredEvents.push(r)}e.scrollDOM.addEventListener("mousedown",r=>{r.target==e.scrollDOM&&i(rr.mousedown,r)}),it.chrome&&it.chrome_version==102&&e.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=e.hasFocus,it.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,i){var r;let n;this.customHandlers=[];for(let o of i)if(n=(r=o.update(e).spec)===null||r===void 0?void 0:r.domEventHandlers){this.customHandlers.push({plugin:o.value,handlers:n});for(let a in n)this.registeredEvents.indexOf(a)<0&&a!="scroll"&&(this.registeredEvents.push(a),e.contentDOM.addEventListener(a,l=>{ZL(e,l)&&this.runCustomHandlers(a,e,l)&&l.preventDefault()}))}}runCustomHandlers(e,i,r){for(let n of this.customHandlers){let o=n.handlers[e];if(o)try{if(o.call(n.plugin,r,i)||r.defaultPrevented)return!0}catch(a){Rn(i.state,a)}}return!1}runScrollHandlers(e,i){this.lastScrollTop=e.scrollDOM.scrollTop,this.lastScrollLeft=e.scrollDOM.scrollLeft;for(let r of this.customHandlers){let n=r.handlers.scroll;if(n)try{n.call(r.plugin,i,e)}catch(o){Rn(e.state,o)}}}keydown(e,i){if(this.lastKeyCode=i.keyCode,this.lastKeyTime=Date.now(),i.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(it.android&&it.chrome&&!i.synthetic&&(i.keyCode==13||i.keyCode==8))return e.observer.delayAndroidKey(i.key,i.keyCode),!0;let r;return it.ios&&!i.synthetic&&!i.altKey&&!i.metaKey&&((r=YO.find(n=>n.keyCode==i.keyCode))&&!i.ctrlKey||d8.indexOf(i.key)>-1&&i.ctrlKey&&!i.shiftKey)?(this.pendingIOSKey=r||i,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let i=this.pendingIOSKey;return i?(this.pendingIOSKey=void 0,$h(e.contentDOM,i.key,i.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:it.safari&&!it.ios&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}},YO=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],d8="dthko",ZO=[16,17,18,20,91,92,224,225];function bg(t){return t*.7+8}var wb=class{constructor(e,i,r,n){this.view=e,this.style=r,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=i,this.scrollParent=U6(e.contentDOM);let o=e.contentDOM.ownerDocument;o.addEventListener("mousemove",this.move=this.move.bind(this)),o.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=i.shiftKey,this.multiple=e.state.facet(Ct.allowMultipleSelections)&&p8(e,i),this.dragMove=m8(e,i),this.dragging=g8(e,i)&&$O(i)==1?null:!1,this.dragging===!1&&(i.preventDefault(),this.select(i))}move(e){var i;if(e.buttons==0)return this.destroy();if(this.dragging!==!1)return;this.select(this.lastEvent=e);let r=0,n=0,o=((i=this.scrollParent)===null||i===void 0?void 0:i.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight};e.clientX<=o.left?r=-bg(o.left-e.clientX):e.clientX>=o.right&&(r=bg(e.clientX-o.right)),e.clientY<=o.top?n=-bg(o.top-e.clientY):e.clientY>=o.bottom&&(n=bg(e.clientY-o.bottom)),this.setScrollSpeed(r,n)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}setScrollSpeed(e,i){this.scrollSpeed={x:e,y:i},e||i?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}select(e){let i=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!i.eq(this.view.state.selection)||i.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}};function p8(t,e){let i=t.state.facet(OO);return i.length?i[0](e):it.mac?e.metaKey:e.ctrlKey}function m8(t,e){let i=t.state.facet(DO);return i.length?i[0](e):it.mac?!e.altKey:!e.ctrlKey}function g8(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let r=Og(t.root);if(!r||r.rangeCount==0)return!0;let n=r.getRangeAt(0).getClientRects();for(let o=0;o<n.length;o++){let a=n[o];if(a.left<=e.clientX&&a.right>=e.clientX&&a.top<=e.clientY&&a.bottom>=e.clientY)return!0}return!1}function ZL(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i=e.target,r;i!=t.contentDOM;i=i.parentNode)if(!i||i.nodeType==11||(r=ei.get(i))&&r.ignoreEvent(e))return!1;return!0}var rr=Object.create(null),Sb=Object.create(null),KO=it.ie&&it.ie_version<15||it.ios&&it.webkit_version<604;function v8(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout(()=>{t.focus(),i.remove(),QO(t,i.value)},50)}function QO(t,e){let{state:i}=t,r,n=1,o=i.toText(e),a=o.lines==i.selection.ranges.length;if(Cb!=null&&i.selection.ranges.every(h=>h.empty)&&Cb==o.toString()){let h=-1;r=i.changeByRange(u=>{let c=i.doc.lineAt(u.from);if(c.from==h)return{range:u};h=c.from;let f=i.toText((a?o.line(n++).text:e)+i.lineBreak);return{changes:{from:c.from,insert:f},range:ve.cursor(u.from+f.length)}})}else a?r=i.changeByRange(h=>{let u=o.line(n++);return{changes:{from:h.from,to:h.to,insert:u.text},range:ve.cursor(h.from+u.length)}}):r=i.replaceSelection(o);t.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}rr.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),e.keyCode==27?t.inputState.lastEscPress=Date.now():ZO.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};rr.touchstart=(t,e)=>{t.inputState.lastTouchTime=Date.now(),t.inputState.setSelectionOrigin("select.pointer")};rr.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")};Sb.touchstart=Sb.touchmove={passive:!0};rr.mousedown=(t,e)=>{if(t.observer.flush(),t.inputState.lastTouchTime>Date.now()-2e3)return;let i=null;for(let r of t.state.facet(IO))if(i=r(t,e),i)break;if(!i&&e.button==0&&(i=x8(t,e)),i){let r=t.root.activeElement!=t.contentDOM;r&&t.observer.ignore(()=>bO(t.contentDOM)),t.inputState.startMouseSelection(new wb(t,e,i,r))}};function KL(t,e,i,r){if(r==1)return ve.cursor(e,i);if(r==2)return s8(t.state,e,i);{let n=br.find(t.docView,e),o=t.state.doc.lineAt(n?n.posAtEnd:e),a=n?n.posAtStart:o.from,l=n?n.posAtEnd:o.to;return l<t.state.doc.length&&l==o.to&&l++,ve.range(a,l)}}var JO=(t,e)=>t>=e.top&&t<=e.bottom,QL=(t,e,i)=>JO(e,i)&&t>=i.left&&t<=i.right;function _8(t,e,i,r){let n=br.find(t.docView,e);if(!n)return 1;let o=e-n.posAtStart;if(o==0)return 1;if(o==n.length)return-1;let a=n.coordsAt(o,-1);if(a&&QL(i,r,a))return-1;let l=n.coordsAt(o,1);return l&&QL(i,r,l)?1:a&&JO(r,a)?-1:1}function JL(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:_8(t,i,e.clientX,e.clientY)}}var y8=it.ie&&it.ie_version<=11,$L=null,eO=0,tO=0;function $O(t){if(!y8)return t.detail;let e=$L,i=tO;return $L=t,tO=Date.now(),eO=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(eO+1)%3:1}function x8(t,e){let i=JL(t,e),r=$O(e),n=t.state.selection;return{update(o){o.docChanged&&(i.pos=o.changes.mapPos(i.pos),n=n.map(o.changes))},get(o,a,l){let h=JL(t,o),u=KL(t,h.pos,h.bias,r);if(i.pos!=h.pos&&!a){let c=KL(t,i.pos,i.bias,r),f=Math.min(c.from,u.from),d=Math.max(c.to,u.to);u=f<u.from?ve.range(f,d):ve.range(d,f)}return a?n.replaceRange(n.main.extend(u.from,u.to)):l&&n.ranges.length>1&&n.ranges.some(c=>c.eq(u))?b8(n,u):l?n.addRange(u):ve.create([u])}}}function b8(t,e){for(let i=0;;i++)if(t.ranges[i].eq(e))return ve.create(t.ranges.slice(0,i).concat(t.ranges.slice(i+1)),t.mainIndex==i?0:t.mainIndex-(t.mainIndex>i?1:0))}rr.dragstart=(t,e)=>{let{selection:{main:i}}=t.state,{mouseSelection:r}=t.inputState;r&&(r.dragging=i),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(i.from,i.to)),e.dataTransfer.effectAllowed="copyMove")};function iO(t,e,i,r){if(!i)return;let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:o}=t.inputState,a=r&&o&&o.dragging&&o.dragMove?{from:o.dragging.from,to:o.dragging.to}:null,l={from:n,insert:i},h=t.state.changes(a?[a,l]:l);t.focus(),t.dispatch({changes:h,selection:{anchor:h.mapPos(n,-1),head:h.mapPos(n,1)},userEvent:a?"move.drop":"input.drop"})}rr.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let i=e.dataTransfer.files;if(i&&i.length){e.preventDefault();let r=Array(i.length),n=0,o=()=>{++n==i.length&&iO(t,e,r.filter(a=>a!=null).join(t.state.lineBreak),!1)};for(let a=0;a<i.length;a++){let l=new FileReader;l.onerror=o,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(r[a]=l.result),o()},l.readAsText(i[a])}}else iO(t,e,e.dataTransfer.getData("Text"),!0)};rr.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let i=KO?null:e.clipboardData;i?(QO(t,i.getData("text/plain")),e.preventDefault()):v8(t)};function w8(t,e){let i=t.dom.parentNode;if(!i)return;let r=i.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),t.focus()},50)}function S8(t){let e=[],i=[],r=!1;for(let n of t.selection.ranges)n.empty||(e.push(t.sliceDoc(n.from,n.to)),i.push(n));if(!e.length){let n=-1;for(let{from:o}of t.selection.ranges){let a=t.doc.lineAt(o);a.number>n&&(e.push(a.text),i.push({from:a.from,to:Math.min(t.doc.length,a.to+1)})),n=a.number}r=!0}return{text:e.join(t.lineBreak),ranges:i,linewise:r}}var Cb=null;rr.copy=rr.cut=(t,e)=>{let{text:i,ranges:r,linewise:n}=S8(t.state);if(!i&&!n)return;Cb=n?i:null;let o=KO?null:e.clipboardData;o?(e.preventDefault(),o.clearData(),o.setData("text/plain",i)):w8(t,i),e.type=="cut"&&!t.state.readOnly&&t.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"})};function eD(t){setTimeout(()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])},10)}rr.focus=t=>{t.inputState.lastFocusTime=Date.now(),!t.scrollDOM.scrollTop&&(t.inputState.lastScrollTop||t.inputState.lastScrollLeft)&&(t.scrollDOM.scrollTop=t.inputState.lastScrollTop,t.scrollDOM.scrollLeft=t.inputState.lastScrollLeft),eD(t)};rr.blur=t=>{t.observer.clearSelectionRange(),eD(t)};rr.compositionstart=rr.compositionupdate=t=>{t.inputState.compositionFirstChange==null&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0)};rr.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,it.chrome&&it.android&&t.observer.flushSoon(),setTimeout(()=>{t.inputState.composing<0&&t.docView.compositionDeco.size&&t.update([])},50)};rr.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()};rr.beforeinput=(t,e)=>{var i;let r;if(it.chrome&&it.android&&(r=YO.find(n=>n.inputType==e.inputType))&&(t.observer.delayAndroidKey(r.key,r.keyCode),r.key=="Backspace"||r.key=="Delete")){let n=((i=window.visualViewport)===null||i===void 0?void 0:i.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>n+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())},100)}};var rO=["pre-wrap","normal","pre-line","break-spaces"],Mb=class{constructor(e){this.lineWrapping=e,this.doc=Nt.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,i){let r=this.doc.lineAt(i).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.ceil((i-e-r*this.lineLength*.5)/this.lineLength)),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return rO.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let i=!1;for(let r=0;r<e.length;r++){let n=e[r];n<0?r++:this.heightSamples[Math.floor(n*10)]||(i=!0,this.heightSamples[Math.floor(n*10)]=!0)}return i}refresh(e,i,r,n,o){let a=rO.indexOf(e)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=i,this.charWidth=r,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<o.length;h++){let u=o[h];u<0?h++:this.heightSamples[Math.floor(u*10)]=!0}}return l}},Eb=class{constructor(e,i){this.from=e,this.heights=i,this.index=0}get more(){return this.index<this.heights.length}},co=class{constructor(e,i,r,n,o){this.from=e,this.length=i,this.top=r,this.height=n,this.type=o}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let i=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new co(this.from,this.length+e.length,this.top,this.height+e.height,i)}},oi=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(oi||(oi={})),Ag=.001,wr=class{constructor(e,i,r=2){this.length=e,this.height=i,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,i){this.height!=i&&(Math.abs(this.height-i)>Ag&&(e.heightChanged=!0),this.height=i)}replace(e,i,r){return wr.of(r)}decomposeLeft(e,i){i.push(this)}decomposeRight(e,i){i.push(this)}applyChanges(e,i,r,n){let o=this;for(let a=n.length-1;a>=0;a--){let{fromA:l,toA:h,fromB:u,toB:c}=n[a],f=o.lineAt(l,oi.ByPosNoHeight,i,0,0),d=f.to>=h?f:o.lineAt(h,oi.ByPosNoHeight,i,0,0);for(c+=d.to-h,h=d.to;a>0&&f.from<=n[a-1].toA;)l=n[a-1].fromA,u=n[a-1].fromB,a--,l<f.from&&(f=o.lineAt(l,oi.ByPosNoHeight,i,0,0));u+=f.from-l,l=f.from;let m=df.build(r,e,u,c);o=o.replace(l,h,m)}return o.updateHeight(r,0)}static empty(){return new Zr(0,0)}static of(e){if(e.length==1)return e[0];let i=0,r=e.length,n=0,o=0;for(;;)if(i==r)if(n>o*2){let l=e[i-1];l.break?e.splice(--i,1,l.left,null,l.right):e.splice(--i,1,l.left,l.right),r+=1+l.break,n-=l.size}else if(o>n*2){let l=e[r];l.break?e.splice(r,1,l.left,null,l.right):e.splice(r,1,l.left,l.right),r+=2+l.break,o-=l.size}else break;else if(n<o){let l=e[i++];l&&(n+=l.size)}else{let l=e[--r];l&&(o+=l.size)}let a=0;return e[i-1]==null?(a=1,i--):e[i]==null&&(a=1,r++),new Tb(wr.of(e.slice(0,i)),a,wr.of(e.slice(r)))}};wr.prototype.size=1;var Hg=class extends wr{constructor(e,i,r){super(e,i),this.type=r}blockAt(e,i,r,n){return new co(n,this.length,r,this.height,this.type)}lineAt(e,i,r,n,o){return this.blockAt(0,r,n,o)}forEachLine(e,i,r,n,o,a){e<=o+this.length&&i>=o&&a(this.blockAt(0,r,n,o))}updateHeight(e,i=0,r=!1,n){return n&&n.from<=i&&n.more&&this.setHeight(e,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},Zr=class extends Hg{constructor(e,i){super(e,i,ti.Text),this.collapsed=0,this.widgetHeight=0}replace(e,i,r){let n=r[0];return r.length==1&&(n instanceof Zr||n instanceof ir&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof ir?n=new Zr(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):wr.of(r)}updateHeight(e,i=0,r=!1,n){return n&&n.from<=i&&n.more?this.setHeight(e,n.heights[n.index++]):(r||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},ir=class extends wr{constructor(e){super(e,0)}lines(e,i){let r=e.lineAt(i).number,n=e.lineAt(i+this.length).number;return{firstLine:r,lastLine:n,lineHeight:this.height/(n-r+1)}}blockAt(e,i,r,n){let{firstLine:o,lastLine:a,lineHeight:l}=this.lines(i,n),h=Math.max(0,Math.min(a-o,Math.floor((e-r)/l))),{from:u,length:c}=i.line(o+h);return new co(u,c,r+l*h,l,ti.Text)}lineAt(e,i,r,n,o){if(i==oi.ByHeight)return this.blockAt(e,r,n,o);if(i==oi.ByPosNoHeight){let{from:f,to:d}=r.lineAt(e);return new co(f,d-f,0,0,ti.Text)}let{firstLine:a,lineHeight:l}=this.lines(r,o),{from:h,length:u,number:c}=r.lineAt(e);return new co(h,u,n+l*(c-a),l,ti.Text)}forEachLine(e,i,r,n,o,a){let{firstLine:l,lineHeight:h}=this.lines(r,o);for(let u=Math.max(e,o),c=Math.min(o+this.length,i);u<=c;){let f=r.lineAt(u);u==e&&(n+=h*(f.number-l)),a(new co(f.from,f.length,n,h,ti.Text)),n+=h,u=f.to+1}}replace(e,i,r){let n=this.length-i;if(n>0){let o=r[r.length-1];o instanceof ir?r[r.length-1]=new ir(o.length+n):r.push(null,new ir(n-1))}if(e>0){let o=r[0];o instanceof ir?r[0]=new ir(e+o.length):r.unshift(new ir(e-1),null)}return wr.of(r)}decomposeLeft(e,i){i.push(new ir(e-1),null)}decomposeRight(e,i){i.push(null,new ir(this.length-e-1))}updateHeight(e,i=0,r=!1,n){let o=i+this.length;if(n&&n.from<=i+this.length&&n.more){let a=[],l=Math.max(i,n.from),h=-1,u=e.heightChanged;for(n.from>i&&a.push(new ir(n.from-i-1).updateHeight(e,i));l<=o&&n.more;){let f=e.doc.lineAt(l).length;a.length&&a.push(null);let d=n.heights[n.index++];h==-1?h=d:Math.abs(d-h)>=Ag&&(h=-2);let m=new Zr(f,d);m.outdated=!1,a.push(m),l+=f+1}l<=o&&a.push(null,new ir(o-l).updateHeight(e,l));let c=wr.of(a);return e.heightChanged=u||h<0||Math.abs(c.height-this.height)>=Ag||Math.abs(h-this.lines(e.doc,i).lineHeight)>=Ag,c}else(r||this.outdated)&&(this.setHeight(e,e.heightForGap(i,i+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},Tb=class extends wr{constructor(e,i,r){super(e.length+i+r.length,e.height+r.height,i|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,i,r,n){let o=r+this.left.height;return e<o?this.left.blockAt(e,i,r,n):this.right.blockAt(e,i,o,n+this.left.length+this.break)}lineAt(e,i,r,n,o){let a=n+this.left.height,l=o+this.left.length+this.break,h=i==oi.ByHeight?e<a:e<l,u=h?this.left.lineAt(e,i,r,n,o):this.right.lineAt(e,i,r,a,l);if(this.break||(h?u.to<l:u.from>l))return u;let c=i==oi.ByPosNoHeight?oi.ByPosNoHeight:oi.ByPos;return h?u.join(this.right.lineAt(l,c,r,a,l)):this.left.lineAt(l,c,r,n,o).join(u)}forEachLine(e,i,r,n,o,a){let l=n+this.left.height,h=o+this.left.length+this.break;if(this.break)e<h&&this.left.forEachLine(e,i,r,n,o,a),i>=h&&this.right.forEachLine(e,i,r,l,h,a);else{let u=this.lineAt(h,oi.ByPos,r,n,o);e<u.from&&this.left.forEachLine(e,u.from-1,r,n,o,a),u.to>=e&&u.from<=i&&a(u),i>u.to&&this.right.forEachLine(u.to+1,i,r,l,h,a)}}replace(e,i,r){let n=this.left.length+this.break;if(i<n)return this.balanced(this.left.replace(e,i,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,i-n,r));let o=[];e>0&&this.decomposeLeft(e,o);let a=o.length;for(let l of r)o.push(l);if(e>0&&nO(o,a-1),i<this.length){let l=o.length;this.decomposeRight(i,o),nO(o,l)}return wr.of(o)}decomposeLeft(e,i){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,i);i.push(this.left),this.break&&(r++,e>=r&&i.push(null)),e>r&&this.right.decomposeLeft(e-r,i)}decomposeRight(e,i){let r=this.left.length,n=r+this.break;if(e>=n)return this.right.decomposeRight(e-n,i);e<r&&this.left.decomposeRight(e,i),this.break&&e<n&&i.push(null),i.push(this.right)}balanced(e,i){return e.size>2*i.size||i.size>2*e.size?wr.of(this.break?[e,null,i]:[e,i]):(this.left=e,this.right=i,this.height=e.height+i.height,this.outdated=e.outdated||i.outdated,this.size=e.size+i.size,this.length=e.length+this.break+i.length,this)}updateHeight(e,i=0,r=!1,n){let{left:o,right:a}=this,l=i+o.length+this.break,h=null;return n&&n.from<=i+o.length&&n.more?h=o=o.updateHeight(e,i,r,n):o.updateHeight(e,i,r),n&&n.from<=l+a.length&&n.more?h=a=a.updateHeight(e,l,r,n):a.updateHeight(e,l,r),h?this.balanced(o,a):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function nO(t,e){let i,r;t[e]==null&&(i=t[e-1])instanceof ir&&(r=t[e+1])instanceof ir&&t.splice(e-1,3,new ir(i.length+1+r.length))}var C8=5,df=class{constructor(e,i){this.pos=e,this.oracle=i,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,i){if(this.lineStart>-1){let r=Math.min(i,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof Zr?n.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new Zr(r-this.pos,-1)),this.writtenTo=r,i>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=i}point(e,i,r){if(e<i||r.heightRelevant){let n=r.widget?r.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let o=i-e;r.block?this.addBlock(new Hg(o,n,r.type)):(o||n>=C8)&&this.addLineDeco(n,o)}else i>e&&this.span(e,i);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:i}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=i,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Zr(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,i){let r=new ir(i-e);return this.oracle.doc.lineAt(e).to==i&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Zr)return e;let i=new Zr(0,-1);return this.nodes.push(i),i}addBlock(e){this.enterLine(),e.type==ti.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=ti.WidgetBefore&&(this.covering=e)}addLineDeco(e,i){let r=this.ensureLine();r.length+=i,r.collapsed+=i,r.widgetHeight=Math.max(r.widgetHeight,e),this.writtenTo=this.pos=this.pos+i}finish(e){let i=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(i instanceof Zr)&&!this.isCovered?this.nodes.push(new Zr(0,-1)):(this.writtenTo<this.pos||i==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let n of this.nodes)n instanceof Zr&&n.updateHeight(this.oracle,r),r+=n?n.length:1;return this.nodes}static build(e,i,r,n){let o=new df(r,e);return zt.spans(i,r,n,o,0),o.finish(r)}};function M8(t,e,i){let r=new Ab;return zt.compare(t,e,i,r,0),r.changes}var Ab=class{constructor(){this.changes=[]}compareRange(){}comparePoint(e,i,r,n){(e<i||r&&r.heightRelevant||n&&n.heightRelevant)&&pb(e,i,this.changes,5)}};function E8(t,e){let i=t.getBoundingClientRect(),r=t.ownerDocument,n=r.defaultView||window,o=Math.max(0,i.left),a=Math.min(n.innerWidth,i.right),l=Math.max(0,i.top),h=Math.min(n.innerHeight,i.bottom);for(let u=t.parentNode;u&&u!=r.body;)if(u.nodeType==1){let c=u,f=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&f.overflow!="visible"){let d=c.getBoundingClientRect();o=Math.max(o,d.left),a=Math.min(a,d.right),l=Math.max(l,d.top),h=u==t.parentNode?d.bottom:Math.min(h,d.bottom)}u=f.position=="absolute"||f.position=="fixed"?c.offsetParent:c.parentNode}else if(u.nodeType==11)u=u.host;else break;return{left:o-i.left,right:Math.max(o,a)-i.left,top:l-(i.top+e),bottom:Math.max(l,h)-(i.top+e)}}function T8(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}var of=class{constructor(e,i,r){this.from=e,this.to=i,this.size=r}static same(e,i){if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){let n=e[r],o=i[r];if(n.from!=o.from||n.to!=o.to||n.size!=o.size)return!1}return!0}draw(e){return xt.replace({widget:new Pb(this.size,e)}).range(this.from,this.to)}},Pb=class extends Ps{constructor(e,i){super(),this.size=e,this.vertical=i}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}},Wg=class{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scaler=sO,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=hi.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let i=e.facet(Yb).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new Mb(i),this.stateDeco=e.facet(ff).filter(r=>typeof r!="function"),this.heightMap=wr.empty().applyChanges(this.stateDeco,Nt.empty,this.heightOracle.setDoc(e.doc),[new $n(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=xt.set(this.lineGaps.map(r=>r.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:i}=this.state.selection;for(let r=0;r<=1;r++){let n=r?i.head:i.anchor;if(!e.some(({from:o,to:a})=>n>=o&&n<=a)){let{from:o,to:a}=this.lineBlockAt(n);e.push(new Kh(o,a))}}this.viewports=e.sort((r,n)=>r.from-n.from),this.scaler=this.heightMap.height<=7e6?sO:new Rb(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:nf(e,this.scaler))})}update(e,i=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=this.state.facet(ff).filter(u=>typeof u!="function");let n=e.changedRanges,o=$n.extendWithRanges(n,M8(r,this.stateDeco,e?e.changes:yi.empty(this.state.doc.length))),a=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=a&&(e.flags|=2);let l=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(i&&(i.range.head<l.from||i.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,i));let h=!e.changes.empty||e.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>2e3<<1)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),i&&(this.scrollTarget=i),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(NO)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let i=e.contentDOM,r=window.getComputedStyle(i),n=this.heightOracle,o=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?hi.RTL:hi.LTR;let a=this.heightOracle.mustRefreshForWrapping(o),l=a||this.mustMeasureContent||this.contentDOMHeight!=i.clientHeight;this.contentDOMHeight=i.clientHeight,this.mustMeasureContent=!1;let h=0,u=0,c=parseInt(r.paddingTop)||0,f=parseInt(r.paddingBottom)||0;(this.paddingTop!=c||this.paddingBottom!=f)&&(this.paddingTop=c,this.paddingBottom=f,h|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,h|=8);let d=(this.printing?T8:E8)(i,this.paddingTop),m=d.top-this.pixelViewport.top,v=d.bottom-this.pixelViewport.bottom;this.pixelViewport=d;let g=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(g!=this.inView&&(this.inView=g,g&&(l=!0)),!this.inView&&!this.scrollTarget)return 0;let p=i.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=p,this.editorHeight=e.scrollDOM.clientHeight,h|=8),l){let x=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(x)&&(a=!0),a||n.lineWrapping&&Math.abs(p-this.contentDOMWidth)>n.charWidth){let{lineHeight:b,charWidth:y}=e.docView.measureTextSize();a=b>0&&n.refresh(o,b,y,p/y,x),a&&(e.docView.minWidth=0,h|=8)}m>0&&v>0?u=Math.max(m,v):m<0&&v<0&&(u=Math.min(m,v)),n.heightChanged=!1;for(let b of this.viewports){let y=b.from==this.viewport.from?x:e.docView.measureVisibleLineHeights(b);this.heightMap=(a?wr.empty().applyChanges(this.stateDeco,Nt.empty,this.heightOracle,[new $n(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,a,new Eb(b.from,y))}n.heightChanged&&(h|=2)}let _=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return _&&(this.viewport=this.getViewport(u,this.scrollTarget)),this.updateForViewport(),(h&2||_)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>2e3<<1)&&this.updateLineGaps(this.ensureLineGaps(a?[]:this.lineGaps,e)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,i){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,o=this.state.doc,{visibleTop:a,visibleBottom:l}=this,h=new Kh(n.lineAt(a-r*1e3,oi.ByHeight,o,0,0).from,n.lineAt(l+(1-r)*1e3,oi.ByHeight,o,0,0).to);if(i){let{head:u}=i.range;if(u<h.from||u>h.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=n.lineAt(u,oi.ByPos,o,0,0),d;i.y=="center"?d=(f.top+f.bottom)/2-c/2:i.y=="start"||i.y=="nearest"&&u<h.from?d=f.top:d=f.bottom-c,h=new Kh(n.lineAt(d-1e3/2,oi.ByHeight,o,0,0).from,n.lineAt(d+c+1e3/2,oi.ByHeight,o,0,0).to)}}return h}mapViewport(e,i){let r=i.mapPos(e.from,-1),n=i.mapPos(e.to,1);return new Kh(this.heightMap.lineAt(r,oi.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,oi.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:i},r=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,oi.ByPos,this.state.doc,0,0),{bottom:o}=this.heightMap.lineAt(i,oi.ByPos,this.state.doc,0,0),{visibleTop:a,visibleBottom:l}=this;return(e==0||n<=a-Math.max(10,Math.min(-r,250)))&&(i==this.state.doc.length||o>=l+Math.max(10,Math.min(r,250)))&&n>a-2*1e3&&o<l+2*1e3}mapLineGaps(e,i){if(!e.length||i.empty)return e;let r=[];for(let n of e)i.touchesRange(n.from,n.to)||r.push(new of(i.mapPos(n.from),i.mapPos(n.to),n.size));return r}ensureLineGaps(e,i){let r=this.heightOracle.lineWrapping,n=r?1e4:2e3,o=n>>1,a=n<<1;if(this.defaultTextDirection!=hi.LTR&&!r)return[];let l=[],h=(u,c,f,d)=>{if(c-u<o)return;let m=this.state.selection.main,v=[m.from];m.empty||v.push(m.to);for(let p of v)if(p>u&&p<c){h(u,p-10,f,d),h(p+10,c,f,d);return}let g=P8(e,p=>p.from>=f.from&&p.to<=f.to&&Math.abs(p.from-u)<o&&Math.abs(p.to-c)<o&&!v.some(_=>p.from<_&&p.to>_));if(!g){if(c<f.to&&i&&r&&i.visibleRanges.some(p=>p.from<=c&&p.to>=c)){let p=i.moveToLineBoundary(ve.cursor(c),!1,!0).head;p>u&&(c=p)}g=new of(u,c,this.gapSize(f,u,c,d))}l.push(g)};for(let u of this.viewportLines){if(u.length<a)continue;let c=A8(u.from,u.to,this.stateDeco);if(c.total<a)continue;let f=this.scrollTarget?this.scrollTarget.range.head:null,d,m;if(r){let v=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,g,p;if(f!=null){let _=Sg(c,f),x=((this.visibleBottom-this.visibleTop)/2+v)/u.height;g=_-x,p=_+x}else g=(this.visibleTop-u.top-v)/u.height,p=(this.visibleBottom-u.top+v)/u.height;d=wg(c,g),m=wg(c,p)}else{let v=c.total*this.heightOracle.charWidth,g=n*this.heightOracle.charWidth,p,_;if(f!=null){let x=Sg(c,f),b=((this.pixelViewport.right-this.pixelViewport.left)/2+g)/v;p=x-b,_=x+b}else p=(this.pixelViewport.left-g)/v,_=(this.pixelViewport.right+g)/v;d=wg(c,p),m=wg(c,_)}d>u.from&&h(u.from,d,u,c),m<u.to&&h(m,u.to,u,c)}return l}gapSize(e,i,r,n){let o=Sg(n,r)-Sg(n,i);return this.heightOracle.lineWrapping?e.height*o:n.total*this.heightOracle.charWidth*o}updateLineGaps(e){of.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=xt.set(e.map(i=>i.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let i=[];zt.spans(e,this.viewport.from,this.viewport.to,{span(n,o){i.push({from:n,to:o})},point(){}},20);let r=i.length!=this.visibleRanges.length||this.visibleRanges.some((n,o)=>n.from!=i[o].from||n.to!=i[o].to);return this.visibleRanges=i,r?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(i=>i.from<=e&&i.to>=e)||nf(this.heightMap.lineAt(e,oi.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return nf(this.heightMap.lineAt(this.scaler.fromDOM(e),oi.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return nf(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},Kh=class{constructor(e,i){this.from=e,this.to=i}};function A8(t,e,i){let r=[],n=t,o=0;return zt.spans(i,t,e,{span(){},point(a,l){a>n&&(r.push({from:n,to:a}),o+=a-n),n=l}},20),n<e&&(r.push({from:n,to:e}),o+=e-n),{total:o,ranges:r}}function wg({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let r=Math.floor(t*i);for(let n=0;;n++){let{from:o,to:a}=e[n],l=a-o;if(r<=l)return o+r;r-=l}}function Sg(t,e){let i=0;for(let{from:r,to:n}of t.ranges){if(e<=n){i+=e-r;break}i+=n-r}return i/t.total}function P8(t,e){for(let i of t)if(e(i))return i}var sO={toDOM(t){return t},fromDOM(t){return t},scale:1},Rb=class{constructor(e,i,r){let n=0,o=0,a=0;this.viewports=r.map(({from:l,to:h})=>{let u=i.lineAt(l,oi.ByPos,e,0,0).top,c=i.lineAt(h,oi.ByPos,e,0,0).bottom;return n+=c-u,{from:l,to:h,top:u,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(i.height-n);for(let l of this.viewports)l.domTop=a+(l.top-o)*this.scale,a=l.domBottom=l.domTop+(l.bottom-l.top),o=l.bottom}toDOM(e){for(let i=0,r=0,n=0;;i++){let o=i<this.viewports.length?this.viewports[i]:null;if(!o||e<o.top)return n+(e-r)*this.scale;if(e<=o.bottom)return o.domTop+(e-o.top);r=o.bottom,n=o.domBottom}}fromDOM(e){for(let i=0,r=0,n=0;;i++){let o=i<this.viewports.length?this.viewports[i]:null;if(!o||e<o.domTop)return r+(e-n)/this.scale;if(e<=o.domBottom)return o.top+(e-o.domTop);r=o.bottom,n=o.domBottom}}};function nf(t,e){if(e.scale==1)return t;let i=e.toDOM(t.top),r=e.toDOM(t.bottom);return new co(t.from,t.length,i,r-i,Array.isArray(t.type)?t.type.map(n=>nf(n,e)):t.type)}var Cg=Qe.define({combine:t=>t.join(" ")}),Lb=Qe.define({combine:t=>t.indexOf(!0)>-1}),Ob=Jn.newName(),tD=Jn.newName(),iD=Jn.newName(),rD={"&light":"."+tD,"&dark":"."+iD};function Db(t,e,i){return new Jn(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,n=>{if(n=="&")return t;if(!i||!i[n])throw new RangeError(`Unsupported selector: ${n}`);return i[n]}):t+" "+r}})}var R8=Db("."+Ob,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},rD),Ib=class{constructor(e,i,r,n){this.typeOver=n,this.bounds=null,this.text="";let{impreciseHead:o,impreciseAnchor:a}=e.docView;if(e.state.readOnly&&i>-1)this.newSel=null;else if(i>-1&&(this.bounds=e.docView.domBoundsAround(i,r,0))){let l=o||a?[]:O8(e),h=new Ng(l,e.state);h.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=h.text,this.newSel=D8(l,this.bounds.from)}else{let l=e.observer.selectionRange,h=o&&o.node==l.focusNode&&o.offset==l.focusOffset||!eu(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),u=a&&a.node==l.anchorNode&&a.offset==l.anchorOffset||!eu(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset);this.newSel=ve.single(u,h)}}};function nD(t,e){let i,{newSel:r}=e,n=t.state.selection.main;if(e.bounds){let{from:o,to:a}=e.bounds,l=n.from,h=null;(t.inputState.lastKeyCode===8&&t.inputState.lastKeyTime>Date.now()-100||it.android&&e.text.length<a-o)&&(l=n.to,h="end");let u=L8(t.state.doc.sliceString(o,a,ka),e.text,l-o,h);u&&(it.chrome&&t.inputState.lastKeyCode==13&&u.toB==u.from+2&&e.text.slice(u.from,u.toB)==ka+ka&&u.toB--,i={from:o+u.from,to:o+u.toA,insert:Nt.of(e.text.slice(u.from,u.toB).split(ka))})}else r&&(!t.hasFocus&&t.state.facet(Xg)||r.main.eq(n))&&(r=null);if(!i&&!r)return!1;if(!i&&e.typeOver&&!n.empty&&r&&r.main.empty?i={from:n.from,to:n.to,insert:t.state.doc.slice(n.from,n.to)}:i&&i.from>=n.from&&i.to<=n.to&&(i.from!=n.from||i.to!=n.to)&&n.to-n.from-(i.to-i.from)<=4?i={from:n.from,to:n.to,insert:t.state.doc.slice(n.from,i.from).append(i.insert).append(t.state.doc.slice(i.to,n.to))}:(it.mac||it.android)&&i&&i.from==i.to&&i.from==n.head-1&&/^\. ?$/.test(i.insert.toString())?(r&&i.insert.length==2&&(r=ve.single(r.main.anchor-1,r.main.head-1)),i={from:n.from,to:n.to,insert:Nt.of([" "])}):it.chrome&&i&&i.from==i.to&&i.from==n.head&&i.insert.toString()==`
 `&&t.lineWrapping&&(r&&(r=ve.single(r.main.anchor-1,r.main.head-1)),i={from:n.from,to:n.to,insert:Nt.of([" "])}),i){let o=t.state;if(it.ios&&t.inputState.flushIOSKey(t)||it.android&&(i.from==n.from&&i.to==n.to&&i.insert.length==1&&i.insert.lines==2&&$h(t.contentDOM,"Enter",13)||i.from==n.from-1&&i.to==n.to&&i.insert.length==0&&$h(t.contentDOM,"Backspace",8)||i.from==n.from&&i.to==n.to+1&&i.insert.length==0&&$h(t.contentDOM,"Delete",46)))return!0;let a=i.insert.toString();if(t.state.facet(FO).some(u=>u(t,i.from,i.to,a)))return!0;t.inputState.composing>=0&&t.inputState.composing++;let l;if(i.from>=n.from&&i.to<=n.to&&i.to-i.from>=(n.to-n.from)/3&&(!r||r.main.empty&&r.main.from==i.from+i.insert.length)&&t.inputState.composing<0){let u=n.from<i.from?o.sliceDoc(n.from,i.from):"",c=n.to>i.to?o.sliceDoc(i.to,n.to):"";l=o.replaceSelection(t.state.toText(u+i.insert.sliceString(0,void 0,t.state.lineBreak)+c))}else{let u=o.changes(i),c=r&&!o.selection.main.eq(r.main)&&r.main.to<=u.newLength?r.main:void 0;if(o.selection.ranges.length>1&&t.inputState.composing>=0&&i.to<=n.to&&i.to>=n.to-10){let f=t.state.sliceDoc(i.from,i.to),d=jO(t)||t.state.doc.lineAt(n.head),m=n.to-i.to,v=n.to-n.from;l=o.changeByRange(g=>{if(g.from==n.from&&g.to==n.to)return{changes:u,range:c||g.map(u)};let p=g.to-m,_=p-f.length;if(g.to-g.from!=v||t.state.sliceDoc(_,p)!=f||d&&g.to>=d.from&&g.from<=d.to)return{range:g};let x=o.changes({from:_,to:p,insert:i.insert}),b=g.to-n.to;return{changes:x,range:c?ve.range(Math.max(0,c.anchor+b),Math.max(0,c.head+b)):g.map(x)}})}else l={changes:u,selection:c&&o.selection.replaceRange(c)}}let h="input.type";return t.composing&&(h+=".compose",t.inputState.compositionFirstChange&&(h+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(l,{scrollIntoView:!0,userEvent:h}),!0}else if(r&&!r.main.eq(n)){let o=!1,a="select";return t.inputState.lastSelectionTime>Date.now()-50&&(t.inputState.lastSelectionOrigin=="select"&&(o=!0),a=t.inputState.lastSelectionOrigin),t.dispatch({selection:r,scrollIntoView:o,userEvent:a}),!0}else return!1}function L8(t,e,i,r){let n=Math.min(t.length,e.length),o=0;for(;o<n&&t.charCodeAt(o)==e.charCodeAt(o);)o++;if(o==n&&t.length==e.length)return null;let a=t.length,l=e.length;for(;a>0&&l>0&&t.charCodeAt(a-1)==e.charCodeAt(l-1);)a--,l--;if(r=="end"){let h=Math.max(0,o-Math.min(a,l));i-=a+h-o}if(a<o&&t.length<e.length){let h=i<=o&&i>=a?o-i:0;o-=h,l=o+(l-a),a=o}else if(l<o){let h=i<=o&&i>=l?o-i:0;o-=h,a=o+(a-l),l=o}return{from:o,toA:a,toB:l}}function O8(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:r,focusNode:n,focusOffset:o}=t.observer.selectionRange;return i&&(e.push(new Ug(i,r)),(n!=i||o!=r)&&e.push(new Ug(n,o))),e}function D8(t,e){if(t.length==0)return null;let i=t[0].pos,r=t.length==2?t[1].pos:i;return i>-1&&r>-1?ve.single(i+e,r+e):null}var I8={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},ib=it.ie&&it.ie_version<=11,kb=class{constructor(e){this.view=e,this.active=!1,this.selectionRange=new ob,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.resizeContent=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(i=>{for(let r of i)this.queue.push(r);(it.ie&&it.ie_version<=11||it.ios&&e.composing)&&i.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),ib&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var i;((i=this.view.docView)===null||i===void 0?void 0:i.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM),this.resizeContent=new ResizeObserver(()=>this.view.requestMeasure()),this.resizeContent.observe(e.contentDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(i=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),i.length>0&&i[i.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(i=>{i.length>0&&i[i.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runScrollHandlers(this.view,e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((i,r)=>i!=e[r]))){this.gapIntersection.disconnect();for(let i of e)this.gapIntersection.observe(i);this.gaps=e}}onSelectionChange(e){let i=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,n=this.selectionRange;if(r.state.facet(Xg)?r.root.activeElement!=this.dom:!Tg(r.dom,n))return;let o=n.anchorNode&&r.docView.nearest(n.anchorNode);if(o&&o.ignoreEvent(e)){i||(this.selectionChanged=!1);return}(it.ie&&it.ie_version<=11||it.android&&it.chrome)&&!r.state.selection.main.empty&&n.focusNode&&Dg(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,i=it.safari&&e.root.nodeType==11&&F6(this.dom.ownerDocument)==this.dom&&k8(this.view)||Og(e.root);if(!i||this.selectionRange.eq(i))return!1;let r=Tg(this.dom,i);return r&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&z6(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),r&&(this.selectionChanged=!0),!0)}setSelectionRange(e,i){this.selectionRange.set(e.node,e.offset,i.node,i.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,i=null;for(let r=this.dom;r;)if(r.nodeType==1)!i&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:i||(i=this.scrollTargets.slice(0,e)),i&&i.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!i&&(i=this.scrollTargets.slice(0,e)),i){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=i)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,I8),ib&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),ib&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,i){var r;if(!this.delayedAndroidKey){let n=()=>{let o=this.delayedAndroidKey;o&&(this.clearDelayedAndroidKey(),!this.flush()&&o.force&&$h(this.dom,o.key,o.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(n)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:i,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}processRecords(){let e=this.queue;for(let o of this.observer.takeRecords())e.push(o);e.length&&(this.queue=[]);let i=-1,r=-1,n=!1;for(let o of e){let a=this.readMutation(o);a&&(a.typeOver&&(n=!0),i==-1?{from:i,to:r}=a:(i=Math.min(a.from,i),r=Math.max(a.to,r)))}return{from:i,to:r,typeOver:n}}readChange(){let{from:e,to:i,typeOver:r}=this.processRecords(),n=this.selectionChanged&&Tg(this.dom,this.selectionRange);return e<0&&!n?null:(e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1,new Ib(this.view,e,i,r))}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let i=this.readChange();if(!i)return!1;let r=this.view.state,n=nD(this.view,i);return this.view.state==r&&this.view.update([]),n}readMutation(e){let i=this.view.docView.nearest(e.target);if(!i||i.ignoreMutation(e))return null;if(i.markDirty(e.type=="attributes"),e.type=="attributes"&&(i.dirty|=4),e.type=="childList"){let r=oO(i,e.previousSibling||e.target.previousSibling,-1),n=oO(i,e.nextSibling||e.target.nextSibling,1);return{from:r?i.posAfter(r):i.posAtStart,to:n?i.posBefore(n):i.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:i.posAtStart,to:i.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,i,r,n;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(i=this.gapIntersection)===null||i===void 0||i.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect(),(n=this.resizeContent)===null||n===void 0||n.disconnect();for(let o of this.scrollTargets)o.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}};function oO(t,e,i){for(;e;){let r=ei.get(e);if(r&&r.parent==t)return r;let n=e.parentNode;e=n!=t.dom?n:i>0?e.nextSibling:e.previousSibling}return null}function k8(t){let e=null;function i(h){h.preventDefault(),h.stopImmediatePropagation(),e=h.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",i,!0),t.dom.ownerDocument.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",i,!0),!e)return null;let r=e.startContainer,n=e.startOffset,o=e.endContainer,a=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);return Dg(l.node,l.offset,o,a)&&([r,n,o,a]=[o,a,r,n]),{anchorNode:r,anchorOffset:n,focusNode:o,focusOffset:a}}var qe=class{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: fixed; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(i=>this.update([i])),this.dispatch=this.dispatch.bind(this),this._root=e.root||G6(e.parent)||document,this.viewState=new Wg(e.state||Ct.create(e)),this.plugins=this.state.facet(tf).map(i=>new sf(i));for(let i of this.plugins)i.update(this);this.observer=new kb(this),this.inputState=new bb(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new Gg(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof xi?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let i=!1,r=!1,n,o=this.state;for(let u of e){if(u.startState!=o)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");o=u.state}if(this.destroyed){this.viewState.state=o;return}let a=this.observer.delayedAndroidKey,l=null;if(a?(this.observer.clearDelayedAndroidKey(),l=this.observer.readChange(),(l&&!this.state.doc.eq(o.doc)||!this.state.selection.eq(o.selection))&&(l=null)):this.observer.clear(),o.facet(Ct.phrases)!=this.state.facet(Ct.phrases))return this.setState(o);n=nu.create(this,o,e);let h=this.viewState.scrollTarget;try{this.updateState=2;for(let u of e){if(h&&(h=h.map(u.changes)),u.scrollIntoView){let{main:c}=u.state.selection;h=new ru(c.empty?c:ve.cursor(c.head,c.head>c.anchor?-1:1))}for(let c of u.effects)c.is(HL)&&(h=c.value)}this.viewState.update(n,h),this.bidiCache=su.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),i=this.docView.update(n),this.state.facet(rf)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some(u=>u.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(Cg)!=n.state.facet(Cg)&&(this.viewState.mustMeasureContent=!0),(i||r||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let u of this.state.facet(mb))u(n);l&&!nD(this,l)&&a.force&&$h(this.contentDOM,a.key,a.keyCode)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let i=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new Wg(e),this.plugins=e.facet(tf).map(r=>new sf(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView=new Gg(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}i&&this.focus(),this.requestMeasure()}updatePlugins(e){let i=e.startState.facet(tf),r=e.state.facet(tf);if(i!=r){let n=[];for(let o of r){let a=i.indexOf(o);if(a<0)n.push(new sf(o));else{let l=this.plugins[a];l.mustUpdate=e,n.push(l)}}for(let o of this.plugins)o.mustUpdate!=e&&o.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let n of this.plugins)n.mustUpdate=e;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.forceFlush();let i=null,{scrollHeight:r,scrollTop:n,clientHeight:o}=this.scrollDOM,a=n>r-o-4?r:n;try{for(let l=0;;l++){this.updateState=1;let h=this.viewport,u=this.viewState.lineBlockAtHeight(a),c=this.viewState.measure(this);if(!c&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let f=[];c&4||([this.measureRequests,f]=[f,this.measureRequests]);let d=f.map(p=>{try{return p.read(this)}catch(_){return Rn(this.state,_),aO}}),m=nu.create(this,this.state,[]),v=!1,g=!1;m.flags|=c,i?i.flags|=c:i=m,this.updateState=2,m.empty||(this.updatePlugins(m),this.inputState.update(m),this.updateAttrs(),v=this.docView.update(m));for(let p=0;p<f.length;p++)if(d[p]!=aO)try{let _=f[p];_.write&&_.write(d[p],this)}catch(_){Rn(this.state,_)}if(this.viewState.editorHeight)if(this.viewState.scrollTarget)this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,g=!0;else{let p=this.viewState.lineBlockAt(u.from).top-u.top;(p>1||p<-1)&&(this.scrollDOM.scrollTop+=p,g=!0)}if(v&&this.docView.updateSelection(!0),this.viewport.from==h.from&&this.viewport.to==h.to&&!g&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(i&&!i.empty)for(let l of this.state.facet(mb))l(i)}get themeClasses(){return Ob+" "+(this.state.facet(Lb)?iD:tD)+" "+this.state.facet(Cg)}updateAttrs(){let e=lO(this,UO,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),i={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Xg)?"true":"false",class:"cm-content",style:`${it.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(i["aria-readonly"]="true"),lO(this,Yb,i);let r=this.observer.ignore(()=>{let n=db(this.contentDOM,this.contentAttrs,i),o=db(this.dom,this.editorAttrs,e);return n||o});return this.editorAttrs=e,this.contentAttrs=i,r}showAnnouncements(e){let i=!0;for(let r of e)for(let n of r.effects)if(n.is(qe.announce)){i&&(this.announceDOM.textContent=""),i=!1;let o=this.announceDOM.appendChild(document.createElement("div"));o.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(rf),Jn.mount(this.root,this.styleModules.concat(R8).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let i=0;i<this.measureRequests.length;i++)if(this.measureRequests[i].key===e.key){this.measureRequests[i]=e;return}}this.measureRequests.push(e)}}plugin(e){let i=this.pluginMap.get(e);return(i===void 0||i&&i.spec!=e)&&this.pluginMap.set(e,i=this.plugins.find(r=>r.spec==e)||null),i&&i.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,i,r){return tb(this,e,YL(this,e,i,r))}moveByGroup(e,i){return tb(this,e,YL(this,e,i,r=>c8(this,e.head,r)))}moveToLineBoundary(e,i,r=!0){return u8(this,e,i,r)}moveVertically(e,i,r){return tb(this,e,f8(this,e,i,r))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,i=0){return this.docView.posFromDOM(e,i)}posAtCoords(e,i=!0){return this.readMeasured(),XO(this,e,i)}coordsAtPos(e,i=1){this.readMeasured();let r=this.docView.coordsAt(e,i);if(!r||r.left==r.right)return r;let n=this.state.doc.lineAt(e),o=this.bidiSpans(n),a=o[Fa.find(o,e-n.from,-1,i)];return jb(r,a.dir==hi.LTR==i>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(BO)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>F8)return WO(e.length);let i=this.textDirectionAt(e.from);for(let n of this.bidiCache)if(n.from==e.from&&n.dir==i)return n.order;let r=J6(e.text,i);return this.bidiCache.push(new su(e.from,e.to,i,r)),r}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||it.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{bO(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,i={}){return HL.of(new ru(typeof e=="number"?ve.cursor(e):e,i.y,i.x,i.yMargin,i.xMargin))}static domEventHandlers(e){return ki.define(()=>({}),{eventHandlers:e})}static theme(e,i){let r=Jn.newName(),n=[Cg.of(r),rf.of(Db(`.${r}`,e))];return i&&i.dark&&n.push(Lb.of(!0)),n}static baseTheme(e){return lo.lowest(rf.of(Db("."+Ob,e,rD)))}static findFromDOM(e){var i;let r=e.querySelector(".cm-content"),n=r&&ei.get(r)||ei.get(e);return((i=n==null?void 0:n.rootView)===null||i===void 0?void 0:i.view)||null}};qe.styleModule=rf;qe.inputHandler=FO;qe.perLineTextDirection=BO;qe.exceptionSink=kO;qe.updateListener=mb;qe.editable=Xg;qe.mouseSelectionStyle=IO;qe.dragMovesSelection=DO;qe.clickAddsSelectionRange=OO;qe.decorations=ff;qe.atomicRanges=GO;qe.scrollMargins=zO;qe.darkTheme=Lb;qe.contentAttributes=Yb;qe.editorAttributes=UO;qe.lineWrapping=qe.contentAttributes.of({class:"cm-lineWrapping"});qe.announce=Lt.define();var F8=4096,aO={},su=class{constructor(e,i,r,n){this.from=e,this.to=i,this.dir=r,this.order=n}static update(e,i){if(i.empty)return e;let r=[],n=e.length?e[e.length-1].dir:hi.LTR;for(let o=Math.max(0,e.length-10);o<e.length;o++){let a=e[o];a.dir==n&&!i.touchesRange(a.from,a.to)&&r.push(new su(i.mapPos(a.from,1),i.mapPos(a.to,-1),a.dir,a.order))}return r}};function lO(t,e,i){for(let r=t.state.facet(e),n=r.length-1;n>=0;n--){let o=r[n],a=typeof o=="function"?o(t):o;a&&fb(a,i)}return i}var B8=it.mac?"mac":it.windows?"win":it.linux?"linux":"key";function N8(t,e){let i=t.split(/-(?!$)/),r=i[i.length-1];r=="Space"&&(r=" ");let n,o,a,l;for(let h=0;h<i.length-1;++h){let u=i[h];if(/^(cmd|meta|m)$/i.test(u))l=!0;else if(/^a(lt)?$/i.test(u))n=!0;else if(/^(c|ctrl|control)$/i.test(u))o=!0;else if(/^s(hift)?$/i.test(u))a=!0;else if(/^mod$/i.test(u))e=="mac"?l=!0:o=!0;else throw new Error("Unrecognized modifier name: "+u)}return n&&(r="Alt-"+r),o&&(r="Ctrl-"+r),l&&(r="Meta-"+r),a&&(r="Shift-"+r),r}function Mg(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),i!==!1&&e.shiftKey&&(t="Shift-"+t),t}var U8=lo.default(qe.domEventHandlers({keydown(t,e){return aD(sD(e.state),t,e,"editor")}})),Ul=Qe.define({enables:U8}),hO=new WeakMap;function sD(t){let e=t.facet(Ul),i=hO.get(e);return i||hO.set(e,i=z8(e.reduce((r,n)=>r.concat(n),[]))),i}function oD(t,e,i){return aD(sD(t.state),e,t,i)}var Ia=null,G8=4e3;function z8(t,e=B8){let i=Object.create(null),r=Object.create(null),n=(a,l)=>{let h=r[a];if(h==null)r[a]=l;else if(h!=l)throw new Error("Key binding "+a+" is used both as a regular binding and as a multi-stroke prefix")},o=(a,l,h,u)=>{var c,f;let d=i[a]||(i[a]=Object.create(null)),m=l.split(/ (?!$)/).map(p=>N8(p,e));for(let p=1;p<m.length;p++){let _=m.slice(0,p).join(" ");n(_,!0),d[_]||(d[_]={preventDefault:!0,run:[x=>{let b=Ia={view:x,prefix:_,scope:a};return setTimeout(()=>{Ia==b&&(Ia=null)},G8),!0}]})}let v=m.join(" ");n(v,!1);let g=d[v]||(d[v]={preventDefault:!1,run:((f=(c=d._any)===null||c===void 0?void 0:c.run)===null||f===void 0?void 0:f.slice())||[]});h&&g.run.push(h),u&&(g.preventDefault=!0)};for(let a of t){let l=a.scope?a.scope.split(" "):["editor"];if(a.any)for(let u of l){let c=i[u]||(i[u]=Object.create(null));c._any||(c._any={preventDefault:!1,run:[]});for(let f in c)c[f].run.push(a.any)}let h=a[e]||a.key;if(h)for(let u of l)o(u,h,a.run,a.preventDefault),a.shift&&o(u,"Shift-"+h,a.shift,a.preventDefault)}return i}function aD(t,e,i,r){let n=kL(e),o=ji(n,0),a=Dr(o)==n.length&&n!=" ",l="",h=!1;Ia&&Ia.view==i&&Ia.scope==r&&(l=Ia.prefix+" ",(h=ZO.indexOf(e.keyCode)<0)&&(Ia=null));let u=new Set,c=v=>{if(v){for(let g of v.run)if(!u.has(g)&&(u.add(g),g(i,e)))return!0;v.preventDefault&&(h=!0)}return!1},f=t[r],d,m;if(f){if(c(f[l+Mg(n,e,!a)]))return!0;if(a&&(e.altKey||e.metaKey||e.ctrlKey)&&!(it.windows&&e.ctrlKey&&e.altKey)&&(d=Yo[e.keyCode])&&d!=n){if(c(f[l+Mg(d,e,!0)]))return!0;if(e.shiftKey&&(m=Yh[e.keyCode])!=n&&m!=d&&c(f[l+Mg(m,e,!1)]))return!0}else if(a&&e.shiftKey&&c(f[l+Mg(n,e,!0)]))return!0;if(c(f._any))return!0}return h}var Nl=class{constructor(e,i,r,n,o){this.className=e,this.left=i,this.top=r,this.width=n,this.height=o}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,i){return i.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,i,r){if(r.empty){let n=e.coordsAtPos(r.head,r.assoc||1);if(!n)return[];let o=lD(e);return[new Nl(i,n.left-o.left,n.top-o.top,null,n.bottom-n.top)]}else return H8(e,i,r)}};function lD(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==hi.LTR?e.left:e.right-t.scrollDOM.clientWidth)-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}}function uO(t,e,i){let r=ve.cursor(e);return{from:Math.max(i.from,t.moveToLineBoundary(r,!1,!0).from),to:Math.min(i.to,t.moveToLineBoundary(r,!0,!0).from),type:ti.Text}}function cO(t,e){let i=t.lineBlockAt(e);if(Array.isArray(i.type)){for(let r of i.type)if(r.to>e||r.to==e&&(r.to==i.to||r.type==ti.Text))return r}return i}function H8(t,e,i){if(i.to<=t.viewport.from||i.from>=t.viewport.to)return[];let r=Math.max(i.from,t.viewport.from),n=Math.min(i.to,t.viewport.to),o=t.textDirection==hi.LTR,a=t.contentDOM,l=a.getBoundingClientRect(),h=lD(t),u=window.getComputedStyle(a.firstChild),c=l.left+parseInt(u.paddingLeft)+Math.min(0,parseInt(u.textIndent)),f=l.right-parseInt(u.paddingRight),d=cO(t,r),m=cO(t,n),v=d.type==ti.Text?d:null,g=m.type==ti.Text?m:null;if(t.lineWrapping&&(v&&(v=uO(t,r,v)),g&&(g=uO(t,n,g))),v&&g&&v.from==g.from)return _(x(i.from,i.to,v));{let y=v?x(i.from,null,v):b(d,!1),w=g?x(null,i.to,g):b(m,!0),S=[];return(v||d).to<(g||m).from-1?S.push(p(c,y.bottom,f,w.top)):y.bottom<w.top&&t.elementAtHeight((y.bottom+w.top)/2).type==ti.Text&&(y.bottom=w.top=(y.bottom+w.top)/2),_(y).concat(S).concat(_(w))}function p(y,w,S,R){return new Nl(e,y-h.left,w-h.top-.01,S-y,R-w+.01)}function _({top:y,bottom:w,horizontal:S}){let R=[];for(let E=0;E<S.length;E+=2)R.push(p(S[E],y,S[E+1],w));return R}function x(y,w,S){let R=1e9,E=-1e9,T=[];function A(D,O,P,L,I){let k=t.coordsAtPos(D,D==S.to?-2:2),B=t.coordsAtPos(P,P==S.from?2:-2);R=Math.min(k.top,B.top,R),E=Math.max(k.bottom,B.bottom,E),I==hi.LTR?T.push(o&&O?c:k.left,o&&L?f:B.right):T.push(!o&&L?c:B.left,!o&&O?f:k.right)}let C=y!=null?y:S.from,M=w!=null?w:S.to;for(let D of t.visibleRanges)if(D.to>C&&D.from<M)for(let O=Math.max(D.from,C),P=Math.min(D.to,M);;){let L=t.state.doc.lineAt(O);for(let I of t.bidiSpans(L)){let k=I.from+L.from,B=I.to+L.from;if(k>=P)break;B>O&&A(Math.max(k,O),y==null&&k<=C,Math.min(B,P),w==null&&B>=M,I.dir)}if(O=L.to+1,O>=P)break}return T.length==0&&A(C,y==null,M,w==null,t.textDirection),{top:R,bottom:E,horizontal:T}}function b(y,w){let S=l.top+(w?y.top:y.bottom);return{top:S,bottom:S,horizontal:[]}}}function W8(t,e){return t.constructor==e.constructor&&t.eq(e)}var Fb=class{constructor(e,i){this.view=e,this.layer=i,this.drawn=[],this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),i.above&&this.dom.classList.add("cm-layer-above"),i.class&&this.dom.classList.add(i.class),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),i.mount&&i.mount(this.dom,e)}update(e){e.startState.facet(Pg)!=e.state.facet(Pg)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&e.view.requestMeasure(this.measureReq)}setOrder(e){let i=0,r=e.facet(Pg);for(;i<r.length&&r[i]!=this.layer;)i++;this.dom.style.zIndex=String((this.layer.above?150:-1)-i)}measure(){return this.layer.markers(this.view)}draw(e){if(e.length!=this.drawn.length||e.some((i,r)=>!W8(i,this.drawn[r]))){let i=this.dom.firstChild,r=0;for(let n of e)n.update&&i&&n.constructor&&this.drawn[r].constructor&&n.update(i,this.drawn[r])?(i=i.nextSibling,r++):this.dom.insertBefore(n.draw(),i);for(;i;){let n=i.nextSibling;i.remove(),i=n}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}},Pg=Qe.define();function hD(t){return[ki.define(e=>new Fb(e,t)),Pg.of(t)]}var uD=!it.ios,pf=Qe.define({combine(t){return fn(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,i)=>Math.min(e,i),drawRangeCursor:(e,i)=>e||i})}});function Yg(t={}){return[pf.of(t),V8,j8,q8,NO.of(!0)]}function cD(t){return t.startState.facet(pf)!=t.state.facet(pf)}var V8=hD({above:!0,markers(t){let{state:e}=t,i=e.facet(pf),r=[];for(let n of e.selection.ranges){let o=n==e.selection.main;if(n.empty?!o||uD:i.drawRangeCursor){let a=o?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=n.empty?n:ve.cursor(n.head,n.head>n.anchor?-1:1);for(let h of Nl.forRange(t,a,l))r.push(h)}}return r},update(t,e){t.transactions.some(r=>r.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let i=cD(t);return i&&fO(t.state,e),t.docChanged||t.selectionSet||i},mount(t,e){fO(e.state,t)},class:"cm-cursorLayer"});function fO(t,e){e.style.animationDuration=t.facet(pf).cursorBlinkRate+"ms"}var j8=hD({above:!1,markers(t){return t.state.selection.ranges.map(e=>e.empty?[]:Nl.forRange(t,"cm-selectionBackground",e)).reduce((e,i)=>e.concat(i))},update(t,e){return t.docChanged||t.selectionSet||t.viewportChanged||cD(t)},class:"cm-selectionLayer"}),fD={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};uD&&(fD[".cm-line"].caretColor="transparent !important");var q8=lo.highest(qe.theme(fD));function dO(t,e,i,r,n){e.lastIndex=0;for(let o=t.iterRange(i,r),a=i,l;!o.next().done;a+=o.value.length)if(!o.lineBreak)for(;l=e.exec(o.value);)n(a+l.index,l)}function X8(t,e){let i=t.visibleRanges;if(i.length==1&&i[0].from==t.viewport.from&&i[0].to==t.viewport.to)return i;let r=[];for(let{from:n,to:o}of i)n=Math.max(t.state.doc.lineAt(n).from,n-e),o=Math.min(t.state.doc.lineAt(o).to,o+e),r.length&&r[r.length-1].to>=n?r[r.length-1].to=o:r.push({from:n,to:o});return r}var Bb=class{constructor(e){let{regexp:i,decoration:r,decorate:n,boundary:o,maxLength:a=1e3}=e;if(!i.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=i,n)this.addMatch=(l,h,u,c)=>n(c,u,u+l[0].length,l,h);else if(typeof r=="function")this.addMatch=(l,h,u,c)=>{let f=r(l,h,u);f&&c(u,u+l[0].length,f)};else if(r)this.addMatch=(l,h,u,c)=>c(u,u+l[0].length,r);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=o,this.maxLength=a}createDeco(e){let i=new An,r=i.add.bind(i);for(let{from:n,to:o}of X8(e,this.maxLength))dO(e.state.doc,this.regexp,n,o,(a,l)=>this.addMatch(l,e,a,r));return i.finish()}updateDeco(e,i){let r=1e9,n=-1;return e.docChanged&&e.changes.iterChanges((o,a,l,h)=>{h>e.view.viewport.from&&l<e.view.viewport.to&&(r=Math.min(l,r),n=Math.max(h,n))}),e.viewportChanged||n-r>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,i.map(e.changes),r,n):i}updateRange(e,i,r,n){for(let o of e.visibleRanges){let a=Math.max(o.from,r),l=Math.min(o.to,n);if(l>a){let h=e.state.doc.lineAt(a),u=h.to<l?e.state.doc.lineAt(l):h,c=Math.max(o.from,h.from),f=Math.min(o.to,u.to);if(this.boundary){for(;a>h.from;a--)if(this.boundary.test(h.text[a-1-h.from])){c=a;break}for(;l<u.to;l++)if(this.boundary.test(u.text[l-u.from])){f=l;break}}let d=[],m,v=(g,p,_)=>d.push(_.range(g,p));if(h==u)for(this.regexp.lastIndex=c-h.from;(m=this.regexp.exec(h.text))&&m.index<f-h.from;)this.addMatch(m,e,m.index+h.from,v);else dO(e.state.doc,this.regexp,c,f,(g,p)=>this.addMatch(p,e,g,v));i=i.update({filterFrom:c,filterTo:f,filter:(g,p)=>g<c||p>f,add:d})}}return i}},Nb=/x/.unicode!=null?"gu":"g",Y8=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\u2066\u2067\u2069\uFEFF\uFFF9-\uFFFC]`,Nb),Z8={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"},rb=null;function K8(){var t;if(rb==null&&typeof document!="undefined"&&document.body){let e=document.body.style;rb=((t=e.tabSize)!==null&&t!==void 0?t:e.MozTabSize)!=null}return rb||!1}var Rg=Qe.define({combine(t){let e=fn(t,{render:null,specialChars:Y8,addSpecialChars:null});return(e.replaceTabs=!K8())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,Nb)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,Nb)),e}});function Zg(t={}){return[Rg.of(t),Q8()]}var pO=null;function Q8(){return pO||(pO=ki.fromClass(class{constructor(t){this.view=t,this.decorations=xt.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(Rg)),this.decorations=this.decorator.createDeco(t)}makeDecorator(t){return new Bb({regexp:t.specialChars,decoration:(e,i,r)=>{let{doc:n}=i.state,o=ji(e[0],0);if(o==9){let a=n.lineAt(r),l=i.state.tabSize,h=Da(a.text,l,r-a.from);return xt.replace({widget:new Gb((l-h%l)*this.view.defaultCharacterWidth)})}return this.decorationCache[o]||(this.decorationCache[o]=xt.replace({widget:new Ub(t,o)}))},boundary:t.replaceTabs?void 0:/[^]/})}update(t){let e=t.state.facet(Rg);t.startState.facet(Rg)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations}))}var J8="\u2022";function $8(t){return t>=32?J8:t==10?"\u2424":String.fromCharCode(9216+t)}var Ub=class extends Ps{constructor(e,i){super(),this.options=e,this.code=i}eq(e){return e.code==this.code}toDOM(e){let i=$8(this.code),r=e.state.phrase("Control character")+" "+(Z8[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,r,i);if(n)return n;let o=document.createElement("span");return o.textContent=i,o.title=r,o.setAttribute("aria-label",r),o.className="cm-specialChar",o}ignoreEvent(){return!1}},Gb=class extends Ps{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}};function Kg(){return tW}var eW=xt.line({class:"cm-activeLine"}),tW=ki.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,i=[];for(let r of t.state.selection.ranges){let n=t.lineBlockAt(r.head);n.from>e&&(i.push(eW.range(n.from)),e=n.from)}return xt.set(i)}},{decorations:t=>t.decorations});var zb=2e3;function iW(t,e,i){let r=Math.min(e.line,i.line),n=Math.max(e.line,i.line),o=[];if(e.off>zb||i.off>zb||e.col<0||i.col<0){let a=Math.min(e.off,i.off),l=Math.max(e.off,i.off);for(let h=r;h<=n;h++){let u=t.doc.line(h);u.length<=l&&o.push(ve.range(u.from+a,u.to+l))}}else{let a=Math.min(e.col,i.col),l=Math.max(e.col,i.col);for(let h=r;h<=n;h++){let u=t.doc.line(h),c=vg(u.text,a,t.tabSize,!0);if(c<0)o.push(ve.cursor(u.to));else{let f=vg(u.text,l,t.tabSize);o.push(ve.range(u.from+c,u.from+f))}}}return o}function rW(t,e){let i=t.coordsAtPos(t.viewport.from);return i?Math.round(Math.abs((i.left-e)/t.defaultCharacterWidth)):-1}function mO(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1),r=t.state.doc.lineAt(i),n=i-r.from,o=n>zb?-1:n==r.length?rW(t,e.clientX):Da(r.text,t.state.tabSize,i-r.from);return{line:r.number,col:o,off:n}}function nW(t,e){let i=mO(t,e),r=t.state.selection;return i?{update(n){if(n.docChanged){let o=n.changes.mapPos(n.startState.doc.line(i.line).from),a=n.state.doc.lineAt(o);i={line:a.number,col:i.col,off:Math.min(i.off,a.length)},r=r.map(n.changes)}},get(n,o,a){let l=mO(t,n);if(!l)return r;let h=iW(t.state,i,l);return h.length?a?ve.create(h.concat(r.ranges)):ve.create(h):r}}:null}function Qg(t){let e=(t==null?void 0:t.eventFilter)||(i=>i.altKey&&i.button==0);return qe.mouseSelectionStyle.of((i,r)=>e(r)?nW(i,r):null)}var Eg="-10000px",Hb=class{constructor(e,i,r){this.facet=i,this.createTooltipView=r,this.input=e.state.facet(i),this.tooltips=this.input.filter(n=>n),this.tooltipViews=this.tooltips.map(r)}update(e){var i;let r=e.state.facet(this.facet),n=r.filter(a=>a);if(r===this.input){for(let a of this.tooltipViews)a.update&&a.update(e);return!1}let o=[];for(let a=0;a<n.length;a++){let l=n[a],h=-1;if(l){for(let u=0;u<this.tooltips.length;u++){let c=this.tooltips[u];c&&c.create==l.create&&(h=u)}if(h<0)o[a]=this.createTooltipView(l);else{let u=o[a]=this.tooltipViews[h];u.update&&u.update(e)}}}for(let a of this.tooltipViews)o.indexOf(a)<0&&(a.dom.remove(),(i=a.destroy)===null||i===void 0||i.call(a));return this.input=r,this.tooltips=n,this.tooltipViews=o,!0}};function sW(t){let{win:e}=t;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}var nb=Qe.define({combine:t=>{var e,i,r;return{position:it.ios?"absolute":((e=t.find(n=>n.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((i=t.find(n=>n.parent))===null||i===void 0?void 0:i.parent)||null,tooltipSpace:((r=t.find(n=>n.tooltipSpace))===null||r===void 0?void 0:r.tooltipSpace)||sW}}}),dD=ki.fromClass(class{constructor(t){this.view=t,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let e=t.state.facet(nb);this.position=e.position,this.parent=e.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new Hb(t,Zb,i=>this.createTooltip(i)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(i=>{Date.now()>this.lastTransaction-50&&i.length>0&&i[i.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),t.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t);e&&this.observeIntersection();let i=e||t.geometryChanged,r=t.state.facet(nb);if(r.position!=this.position){this.position=r.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;i=!0}if(r.parent!=this.parent){this.parent&&this.container.remove(),this.parent=r.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(t){let e=t.create(this.view);if(e.dom.classList.add("cm-tooltip"),t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let i=document.createElement("div");i.className="cm-tooltip-arrow",e.dom.appendChild(i)}return e.dom.style.position=this.position,e.dom.style.top=Eg,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var t,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let i of this.manager.tooltipViews)i.dom.remove(),(t=i.destroy)===null||t===void 0||t.call(i);(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=this.view.dom.getBoundingClientRect();return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map((e,i)=>{let r=this.manager.tooltipViews[i];return r.getCoords?r.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(nb).tooltipSpace(this.view)}}writeMeasure(t){let{editor:e,space:i}=t,r=[];for(let n=0;n<this.manager.tooltips.length;n++){let o=this.manager.tooltips[n],a=this.manager.tooltipViews[n],{dom:l}=a,h=t.pos[n],u=t.size[n];if(!h||h.bottom<=Math.max(e.top,i.top)||h.top>=Math.min(e.bottom,i.bottom)||h.right<Math.max(e.left,i.left)-.1||h.left>Math.min(e.right,i.right)+.1){l.style.top=Eg;continue}let c=o.arrow?a.dom.querySelector(".cm-tooltip-arrow"):null,f=c?7:0,d=u.right-u.left,m=u.bottom-u.top,v=a.offset||aW,g=this.view.textDirection==hi.LTR,p=u.width>i.right-i.left?g?i.left:i.right-u.width:g?Math.min(h.left-(c?14:0)+v.x,i.right-d):Math.max(i.left,h.left-d+(c?14:0)-v.x),_=!!o.above;!o.strictSide&&(_?h.top-(u.bottom-u.top)-v.y<i.top:h.bottom+(u.bottom-u.top)+v.y>i.bottom)&&_==i.bottom-h.bottom>h.top-i.top&&(_=!_);let x=(_?h.top-i.top:i.bottom-h.bottom)-f;if(x<m&&a.resize!==!1){if(x<this.view.defaultLineHeight){l.style.top=Eg;continue}l.style.height=(m=x)+"px"}else l.style.height&&(l.style.height="");let b=_?h.top-m-f-v.y:h.bottom+f+v.y,y=p+d;if(a.overlap!==!0)for(let w of r)w.left<y&&w.right>p&&w.top<b+m&&w.bottom>b&&(b=_?w.top-m-2-f:w.bottom+f+2);this.position=="absolute"?(l.style.top=b-t.parent.top+"px",l.style.left=p-t.parent.left+"px"):(l.style.top=b+"px",l.style.left=p+"px"),c&&(c.style.left=`${h.left+(g?v.x:-v.x)-(p+14-7)}px`),a.overlap!==!0&&r.push({left:p,top:b,right:y,bottom:b+m}),l.classList.toggle("cm-tooltip-above",_),l.classList.toggle("cm-tooltip-below",!_),a.positioned&&a.positioned(t.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top=Eg}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),oW=qe.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:`${7}px`,width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:`${7}px solid transparent`,borderRight:`${7}px solid transparent`},".cm-tooltip-above &":{bottom:`-${7}px`,"&:before":{borderTop:`${7}px solid #bbb`},"&:after":{borderTop:`${7}px solid #f5f5f5`,bottom:"1px"}},".cm-tooltip-below &":{top:`-${7}px`,"&:before":{borderBottom:`${7}px solid #bbb`},"&:after":{borderBottom:`${7}px solid #f5f5f5`,top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),aW={x:0,y:0},Zb=Qe.define({enables:[dD,oW]});function pD(t,e){let i=t.plugin(dD);if(!i)return null;let r=i.manager.tooltips.indexOf(e);return r<0?null:i.manager.tooltipViews[r]}var gO=Qe.define({combine(t){let e,i;for(let r of t)e=e||r.topContainer,i=i||r.bottomContainer;return{topContainer:e,bottomContainer:i}}});function gf(t,e){let i=t.plugin(mD),r=i?i.specs.indexOf(e):-1;return r>-1?i.panels[r]:null}var mD=ki.fromClass(class{constructor(t){this.input=t.state.facet(mf),this.specs=this.input.filter(i=>i),this.panels=this.specs.map(i=>i(t));let e=t.state.facet(gO);this.top=new Qh(t,!0,e.topContainer),this.bottom=new Qh(t,!1,e.bottomContainer),this.top.sync(this.panels.filter(i=>i.top)),this.bottom.sync(this.panels.filter(i=>!i.top));for(let i of this.panels)i.dom.classList.add("cm-panel"),i.mount&&i.mount()}update(t){let e=t.state.facet(gO);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Qh(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Qh(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=t.state.facet(mf);if(i!=this.input){let r=i.filter(h=>h),n=[],o=[],a=[],l=[];for(let h of r){let u=this.specs.indexOf(h),c;u<0?(c=h(t.view),l.push(c)):(c=this.panels[u],c.update&&c.update(t)),n.push(c),(c.top?o:a).push(c)}this.specs=r,this.panels=n,this.top.sync(o),this.bottom.sync(a);for(let h of l)h.dom.classList.add("cm-panel"),h.mount&&h.mount()}else for(let r of this.panels)r.update&&r.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:t=>qe.scrollMargins.of(e=>{let i=e.plugin(t);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}})}),Qh=class{constructor(e,i,r){this.view=e,this.top=i,this.container=r,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let i of this.panels)i.destroy&&e.indexOf(i)<0&&i.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let i=this.container||this.view.dom;i.insertBefore(this.dom,this.top?i.firstChild:null)}let e=this.dom.firstChild;for(let i of this.panels)if(i.dom.parentNode==this.dom){for(;e!=i.dom;)e=vO(e);e=e.nextSibling}else this.dom.insertBefore(i.dom,e);for(;e;)e=vO(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}};function vO(t){let e=t.nextSibling;return t.remove(),e}var mf=Qe.define({enables:mD}),Ir=class extends As{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}};Ir.prototype.elementClass="";Ir.prototype.toDOM=void 0;Ir.prototype.mapMode=Or.TrackBefore;Ir.prototype.startSide=Ir.prototype.endSide=-1;Ir.prototype.point=!0;var Lg=Qe.define(),lW={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>zt.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},af=Qe.define();function ou(t){return[gD(),af.of(Object.assign(Object.assign({},lW),t))]}var Wb=Qe.define({combine:t=>t.some(e=>e)});function gD(t){let e=[hW];return t&&t.fixed===!1&&e.push(Wb.of(!0)),e}var hW=ki.fromClass(class{constructor(t){this.view=t,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=t.state.facet(af).map(e=>new Vg(t,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!t.state.facet(Wb),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}update(t){if(this.updateGutters(t)){let e=this.prevViewport,i=t.view.viewport,r=Math.min(e.to,i.to)-Math.max(e.from,i.from);this.syncGutters(r<(i.to-i.from)*.8)}t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Wb)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&this.dom.remove();let i=zt.iter(this.view.state.facet(Lg),this.view.viewport.from),r=[],n=this.gutters.map(o=>new Vb(o,this.view.viewport,-this.view.documentPadding.top));for(let o of this.view.viewportLineBlocks){let a;if(Array.isArray(o.type)){for(let l of o.type)if(l.type==ti.Text){a=l;break}}else a=o.type==ti.Text?o:void 0;if(a){r.length&&(r=[]),vD(i,r,o.from);for(let l of n)l.line(this.view,a,r)}}for(let o of n)o.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){let e=t.startState.facet(af),i=t.state.facet(af),r=t.docChanged||t.heightChanged||t.viewportChanged||!zt.eq(t.startState.facet(Lg),t.state.facet(Lg),t.view.viewport.from,t.view.viewport.to);if(e==i)for(let n of this.gutters)n.update(t)&&(r=!0);else{r=!0;let n=[];for(let o of i){let a=e.indexOf(o);a<0?n.push(new Vg(this.view,o)):(this.gutters[a].update(t),n.push(this.gutters[a]))}for(let o of this.gutters)o.dom.remove(),n.indexOf(o)<0&&o.destroy();for(let o of n)this.dom.appendChild(o.dom);this.gutters=n}return r}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove()}},{provide:t=>qe.scrollMargins.of(e=>{let i=e.plugin(t);return!i||i.gutters.length==0||!i.fixed?null:e.textDirection==hi.LTR?{left:i.dom.offsetWidth}:{right:i.dom.offsetWidth}})});function _O(t){return Array.isArray(t)?t:[t]}function vD(t,e,i){for(;t.value&&t.from<=i;)t.from==i&&e.push(t.value),t.next()}var Vb=class{constructor(e,i,r){this.gutter=e,this.height=r,this.i=0,this.cursor=zt.iter(e.markers,i.from)}line(e,i,r){let n=[];vD(this.cursor,n,i.from),r.length&&(n=n.concat(r));let o=this.gutter.config.lineMarker(e,i,n);o&&n.unshift(o);let a=this.gutter;if(n.length==0&&!a.config.renderEmptyElements)return;let l=i.top-this.height;if(this.i==a.elements.length){let h=new jg(e,i.height,l,n);a.elements.push(h),a.dom.appendChild(h.dom)}else a.elements[this.i].update(e,i.height,l,n);this.height=i.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let i=e.elements.pop();e.dom.removeChild(i.dom),i.destroy()}}},Vg=class{constructor(e,i){this.view=e,this.config=i,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in i.domEventHandlers)this.dom.addEventListener(r,n=>{let o=n.target,a;if(o!=this.dom&&this.dom.contains(o)){for(;o.parentNode!=this.dom;)o=o.parentNode;let h=o.getBoundingClientRect();a=(h.top+h.bottom)/2}else a=n.clientY;let l=e.lineBlockAtHeight(a-e.documentTop);i.domEventHandlers[r](e,l,n)&&n.preventDefault()});this.markers=_O(i.markers(e)),i.initialSpacer&&(this.spacer=new jg(e,0,0,[i.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let i=this.markers;if(this.markers=_O(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],e);n!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[n])}let r=e.view.viewport;return!zt.eq(this.markers,i,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}},jg=class{constructor(e,i,r,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,i,r,n)}update(e,i,r,n){this.height!=i&&(this.dom.style.height=(this.height=i)+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),uW(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,i){let r="cm-gutterElement",n=this.dom.firstChild;for(let o=0,a=0;;){let l=a,h=o<i.length?i[o++]:null,u=!1;if(h){let c=h.elementClass;c&&(r+=" "+c);for(let f=a;f<this.markers.length;f++)if(this.markers[f].compare(h)){l=f,u=!0;break}}else l=this.markers.length;for(;a<l;){let c=this.markers[a++];if(c.toDOM){c.destroy(n);let f=n.nextSibling;n.remove(),n=f}}if(!h)break;h.toDOM&&(u?n=n.nextSibling:this.dom.insertBefore(h.toDOM(e),n)),u&&a++}this.dom.className=r,this.markers=i}destroy(){this.setMarkers(null,[])}};function uW(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].compare(e[i]))return!1;return!0}var cW=Qe.define(),Jh=Qe.define({combine(t){return fn(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,i){let r=Object.assign({},e);for(let n in i){let o=r[n],a=i[n];r[n]=o?(l,h,u)=>o(l,h,u)||a(l,h,u):a}return r}})}}),lf=class extends Ir{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}};function sb(t,e){return t.state.facet(Jh).formatNumber(e,t.state)}var fW=af.compute([Jh],t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(cW)},lineMarker(e,i,r){return r.some(n=>n.toDOM)?null:new lf(sb(e,e.state.doc.lineAt(i.from).number))},lineMarkerChange:e=>e.startState.facet(Jh)!=e.state.facet(Jh),initialSpacer(e){return new lf(sb(e,yO(e.state.doc.lines)))},updateSpacer(e,i){let r=sb(i.view,yO(i.view.state.doc.lines));return r==e.number?e:new lf(r)},domEventHandlers:t.facet(Jh).domEventHandlers}));function Jg(t={}){return[Jh.of(t),gD(),fW]}function yO(t){let e=9;for(;e<t;)e=e*10+9;return e}var dW=new class extends Ir{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},pW=Lg.compute(["selection"],t=>{let e=[],i=-1;for(let r of t.selection.ranges){let n=t.doc.lineAt(r.head).from;n>i&&(i=n,e.push(dW.range(n)))}return zt.of(e)});function $g(){return pW}xf();xf();var _W=0,ts=class{constructor(e,i,r){this.set=e,this.base=i,this.modified=r,this.id=_W++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let i=new ts([],null,[]);if(i.set.push(i),e)for(let r of e.set)i.set.push(r);return i}static defineModifier(){let e=new hu;return i=>i.modified.indexOf(e)>-1?i:hu.get(i.base||i,i.modified.concat(e).sort((r,n)=>r.id-n.id))}},yW=0,hu=class{constructor(){this.instances=[],this.id=yW++}static get(e,i){if(!i.length)return e;let r=i[0].instances.find(l=>l.base==e&&xW(i,l.modified));if(r)return r;let n=[],o=new ts(n,e,i);for(let l of i)l.instances.push(o);let a=bW(i);for(let l of e.set)if(!l.modified.length)for(let h of a)n.push(hu.get(l,h));return o}};function xW(t,e){return t.length==e.length&&t.every((i,r)=>i==e[r])}function bW(t){let e=[[]];for(let i=0;i<t.length;i++)for(let r=0,n=e.length;r<n;r++)e.push(e[r].concat(t[i]));return e.sort((i,r)=>r.length-i.length)}function cu(t){let e=Object.create(null);for(let i in t){let r=t[i];Array.isArray(r)||(r=[r]);for(let n of i.split(" "))if(n){let o=[],a=2,l=n;for(let f=0;;){if(l=="..."&&f>0&&f+3==n.length){a=1;break}let d=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!d)throw new RangeError("Invalid path: "+n);if(o.push(d[0]=="*"?"":d[0][0]=='"'?JSON.parse(d[0]):d[0]),f+=d[0].length,f==n.length)break;let m=n[f++];if(f==n.length&&m=="!"){a=0;break}if(m!="/")throw new RangeError("Invalid path: "+n);l=n.slice(f)}let h=o.length-1,u=o[h];if(!u)throw new RangeError("Invalid path: "+n);let c=new uu(r,a,h>0?o.slice(0,h):null);e[u]=c.sort(e[u])}}return CD.add(e)}var CD=new It,uu=class{constructor(e,i,r,n){this.tags=e,this.mode=i,this.context=r,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}};uu.empty=new uu([],2,null);function rw(t,e){let i=Object.create(null);for(let o of t)if(!Array.isArray(o.tag))i[o.tag.id]=o.class;else for(let a of o.tag)i[a.id]=o.class;let{scope:r,all:n=null}=e||{};return{style:o=>{let a=n;for(let l of o)for(let h of l.set){let u=i[h.id];if(u){a=a?a+" "+u:u;break}}return a},scope:r}}function wW(t,e){let i=null;for(let r of t){let n=r.style(e);n&&(i=i?i+" "+n:n)}return i}function MD(t,e,i,r=0,n=t.length){let o=new tw(r,Array.isArray(e)?e:[e],i);o.highlightRange(t.cursor(),r,n,"",o.highlighters),o.flush(n)}var tw=class{constructor(e,i,r){this.at=e,this.highlighters=i,this.span=r,this.class=""}startSpan(e,i){i!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=i)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,i,r,n,o){let{type:a,from:l,to:h}=e;if(l>=r||h<=i)return;a.isTop&&(o=this.highlighters.filter(m=>!m.scope||m.scope(a)));let u=n,c=SW(e)||uu.empty,f=wW(o,c.tags);if(f&&(u&&(u+=" "),u+=f,c.mode==1&&(n+=(n?" ":"")+f)),this.startSpan(e.from,u),c.opaque)return;let d=e.tree&&e.tree.prop(It.mounted);if(d&&d.overlay){let m=e.node.enter(d.overlay[0].from+l,1),v=this.highlighters.filter(p=>!p.scope||p.scope(d.tree.type)),g=e.firstChild();for(let p=0,_=l;;p++){let x=p<d.overlay.length?d.overlay[p]:null,b=x?x.from+l:h,y=Math.max(i,_),w=Math.min(r,b);if(y<w&&g)for(;e.from<w&&(this.highlightRange(e,y,w,n,o),this.startSpan(Math.min(w,e.to),u),!(e.to>=b||!e.nextSibling())););if(!x||b>r)break;_=x.to+l,_>i&&(this.highlightRange(m.cursor(),Math.max(i,x.from+l),Math.min(r,_),n,v),this.startSpan(_,u))}g&&e.parent()}else if(e.firstChild()){do if(!(e.to<=i)){if(e.from>=r)break;this.highlightRange(e,i,r,n,o),this.startSpan(Math.min(r,e.to),u)}while(e.nextSibling());e.parent()}}};function SW(t){let e=t.type.prop(CD);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}var Ue=ts.define,nv=Ue(),Na=Ue(),wD=Ue(Na),SD=Ue(Na),Ua=Ue(),sv=Ue(Ua),ew=Ue(Ua),_o=Ue(),Gl=Ue(_o),go=Ue(),vo=Ue(),iw=Ue(),bf=Ue(iw),ov=Ue(),ee={comment:nv,lineComment:Ue(nv),blockComment:Ue(nv),docComment:Ue(nv),name:Na,variableName:Ue(Na),typeName:wD,tagName:Ue(wD),propertyName:SD,attributeName:Ue(SD),className:Ue(Na),labelName:Ue(Na),namespace:Ue(Na),macroName:Ue(Na),literal:Ua,string:sv,docString:Ue(sv),character:Ue(sv),attributeValue:Ue(sv),number:ew,integer:Ue(ew),float:Ue(ew),bool:Ue(Ua),regexp:Ue(Ua),escape:Ue(Ua),color:Ue(Ua),url:Ue(Ua),keyword:go,self:Ue(go),null:Ue(go),atom:Ue(go),unit:Ue(go),modifier:Ue(go),operatorKeyword:Ue(go),controlKeyword:Ue(go),definitionKeyword:Ue(go),moduleKeyword:Ue(go),operator:vo,derefOperator:Ue(vo),arithmeticOperator:Ue(vo),logicOperator:Ue(vo),bitwiseOperator:Ue(vo),compareOperator:Ue(vo),updateOperator:Ue(vo),definitionOperator:Ue(vo),typeOperator:Ue(vo),controlOperator:Ue(vo),punctuation:iw,separator:Ue(iw),bracket:bf,angleBracket:Ue(bf),squareBracket:Ue(bf),paren:Ue(bf),brace:Ue(bf),content:_o,heading:Gl,heading1:Ue(Gl),heading2:Ue(Gl),heading3:Ue(Gl),heading4:Ue(Gl),heading5:Ue(Gl),heading6:Ue(Gl),contentSeparator:Ue(_o),list:Ue(_o),quote:Ue(_o),emphasis:Ue(_o),strong:Ue(_o),link:Ue(_o),monospace:Ue(_o),strikethrough:Ue(_o),inserted:Ue(),deleted:Ue(),changed:Ue(),invalid:Ue(),meta:ov,documentMeta:Ue(ov),annotation:Ue(ov),processingInstruction:Ue(ov),definition:ts.defineModifier(),constant:ts.defineModifier(),function:ts.defineModifier(),standard:ts.defineModifier(),local:ts.defineModifier(),special:ts.defineModifier()},gwe=rw([{tag:ee.link,class:"tok-link"},{tag:ee.heading,class:"tok-heading"},{tag:ee.emphasis,class:"tok-emphasis"},{tag:ee.strong,class:"tok-strong"},{tag:ee.keyword,class:"tok-keyword"},{tag:ee.atom,class:"tok-atom"},{tag:ee.bool,class:"tok-bool"},{tag:ee.url,class:"tok-url"},{tag:ee.labelName,class:"tok-labelName"},{tag:ee.inserted,class:"tok-inserted"},{tag:ee.deleted,class:"tok-deleted"},{tag:ee.literal,class:"tok-literal"},{tag:ee.string,class:"tok-string"},{tag:ee.number,class:"tok-number"},{tag:[ee.regexp,ee.escape,ee.special(ee.string)],class:"tok-string2"},{tag:ee.variableName,class:"tok-variableName"},{tag:ee.local(ee.variableName),class:"tok-variableName tok-local"},{tag:ee.definition(ee.variableName),class:"tok-variableName tok-definition"},{tag:ee.special(ee.variableName),class:"tok-variableName2"},{tag:ee.definition(ee.propertyName),class:"tok-propertyName tok-definition"},{tag:ee.typeName,class:"tok-typeName"},{tag:ee.namespace,class:"tok-namespace"},{tag:ee.className,class:"tok-className"},{tag:ee.macroName,class:"tok-macroName"},{tag:ee.propertyName,class:"tok-propertyName"},{tag:ee.operator,class:"tok-operator"},{tag:ee.comment,class:"tok-comment"},{tag:ee.meta,class:"tok-meta"},{tag:ee.invalid,class:"tok-invalid"},{tag:ee.punctuation,class:"tok-punctuation"}]);var nw,Cf=new It;function MW(t){return Qe.define({combine:t?e=>e.concat(t):void 0})}var Ln=class{constructor(e,i,r=[],n=""){this.data=e,this.name=n,Ct.prototype.hasOwnProperty("tree")||Object.defineProperty(Ct.prototype,"tree",{get(){return fr(this)}}),this.parser=i,this.extension=[za.of(this),Ct.languageData.of((o,a,l)=>o.facet(ED(o,a,l)))].concat(r)}isActiveAt(e,i,r=-1){return ED(e,i,r)==this.data}findRegions(e){let i=e.facet(za);if((i==null?void 0:i.data)==this.data)return[{from:0,to:e.doc.length}];if(!i||!i.allowsNesting)return[];let r=[],n=(o,a)=>{if(o.prop(Cf)==this.data){r.push({from:a,to:a+o.length});return}let l=o.prop(It.mounted);if(l){if(l.tree.prop(Cf)==this.data){if(l.overlay)for(let h of l.overlay)r.push({from:h.from+a,to:h.to+a});else r.push({from:a,to:a+o.length});return}else if(l.overlay){let h=r.length;if(n(l.tree,l.overlay[0].from+a),r.length>h)return}}for(let h=0;h<o.children.length;h++){let u=o.children[h];u instanceof Xi&&n(u,o.positions[h]+a)}};return n(fr(e),0),r}get allowsNesting(){return!0}};Ln.setState=Lt.define();function ED(t,e,i){let r=t.facet(za);if(!r)return null;let n=r.data;if(r.allowsNesting)for(let o=fr(t).topNode;o;o=o.enter(e,i,cr.ExcludeBuffers))n=o.type.prop(Cf)||n;return n}var Jo=class extends Ln{constructor(e,i,r){super(e,i,[],r),this.parser=i}static define(e){let i=MW(e.languageData);return new Jo(i,e.parser.configure({props:[Cf.add(r=>r.isTop?i:void 0)]}),e.name)}configure(e,i){return new Jo(this.data,this.parser.configure(e),i||this.name)}get allowsNesting(){return this.parser.hasWrappers()}};function fr(t){let e=t.field(Ln.state,!1);return e?e.tree:Xi.empty}var lw=class{constructor(e,i=e.length){this.doc=e,this.length=i,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,i){let r=this.cursorPos-this.string.length;return e<r||i>=this.cursorPos?this.doc.sliceString(e,i):this.string.slice(e-r,i-r)}},wf=null,fu=class{constructor(e,i,r=[],n,o,a,l,h){this.parser=e,this.state=i,this.fragments=r,this.tree=n,this.treeLen=o,this.viewport=a,this.skipped=l,this.scheduleOn=h,this.parse=null,this.tempSkipped=[]}static create(e,i,r){return new fu(e,i,[],Xi.empty,0,r,[],null)}startParse(){return this.parser.startParse(new lw(this.state.doc),this.fragments)}work(e,i){return i!=null&&i>=this.state.doc.length&&(i=void 0),this.tree!=Xi.empty&&this.isDone(i!=null?i:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let n=Date.now()+e;e=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),i!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>i)&&i<this.state.doc.length&&this.parse.stopAt(i);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(mo.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(i!=null?i:this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,i;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(i=this.parse.advance()););}),this.treeLen=e,this.tree=i,this.fragments=this.withoutTempSkipped(mo.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let i=wf;wf=this;try{return e()}finally{wf=i}}withoutTempSkipped(e){for(let i;i=this.tempSkipped.pop();)e=TD(e,i.from,i.to);return e}changes(e,i){let{fragments:r,tree:n,treeLen:o,viewport:a,skipped:l}=this;if(this.takeTree(),!e.empty){let h=[];if(e.iterChangedRanges((u,c,f,d)=>h.push({fromA:u,toA:c,fromB:f,toB:d})),r=mo.applyChanges(r,h),n=Xi.empty,o=0,a={from:e.mapPos(a.from,-1),to:e.mapPos(a.to,1)},this.skipped.length){l=[];for(let u of this.skipped){let c=e.mapPos(u.from,1),f=e.mapPos(u.to,-1);c<f&&l.push({from:c,to:f})}}}return new fu(this.parser,i,r,n,o,a,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let i=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:n,to:o}=this.skipped[r];n<e.to&&o>e.from&&(this.fragments=TD(this.fragments,n,o),this.skipped.splice(r--,1))}return this.skipped.length>=i?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,i){this.skipped.push({from:e,to:i})}static getSkippingParser(e){return new class extends yf{createParse(i,r,n){let o=n[0].from,a=n[n.length-1].to;return{parsedPos:o,advance(){let h=wf;if(h){for(let u of n)h.tempSkipped.push(u);e&&(h.scheduleOn=h.scheduleOn?Promise.all([h.scheduleOn,e]):e)}return this.parsedPos=a,new Xi(kr.none,[],[],a-o)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let i=this.fragments;return this.treeLen>=e&&i.length&&i[0].from==0&&i[0].to>=e}static get(){return wf}};function TD(t,e,i){return mo.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}var Ga=class{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let i=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),i.viewport.to);return i.work(20,r)||i.takeTree(),new Ga(i)}static init(e){let i=Math.min(3e3,e.doc.length),r=fu.create(e.facet(za).parser,e,{from:0,to:i});return r.work(20,i)||r.takeTree(),new Ga(r)}};Ln.state=Ii.define({create:Ga.init,update(t,e){for(let i of e.effects)if(i.is(Ln.setState))return i.value;return e.startState.facet(za)!=e.state.facet(za)?Ga.init(e.state):t.apply(e)}});var LD=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};typeof requestIdleCallback!="undefined"&&(LD=t=>{let e=-1,i=setTimeout(()=>{e=requestIdleCallback(t,{timeout:500-100})},100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});var sw=typeof navigator!="undefined"&&(!((nw=navigator.scheduling)===null||nw===void 0)&&nw.isInputPending)?()=>navigator.scheduling.isInputPending():null,EW=ki.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let i=this.view.state.field(Ln.state).context;(i.updateViewport(e.view.viewport)||this.view.viewport.to>i.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(i)}scheduleWork(){if(this.working)return;let{state:e}=this.view,i=e.field(Ln.state);(i.tree!=i.context.tree||!i.context.isDone(e.doc.length))&&(this.working=LD(this.work))}work(e){this.working=null;let i=Date.now();if(this.chunkEnd<i&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=i+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,o=r.field(Ln.state);if(o.tree==o.context.tree&&o.context.isDone(n+1e5))return;let a=Date.now()+Math.min(this.chunkBudget,100,e&&!sw?Math.max(25,e.timeRemaining()-5):1e9),l=o.context.treeLen<n&&r.doc.length>n+1e3,h=o.context.work(()=>sw&&sw()||Date.now()>a,n+(l?0:1e5));this.chunkBudget-=Date.now()-i,(h||this.chunkBudget<=0)&&(o.context.takeTree(),this.view.dispatch({effects:Ln.setState.of(new Ga(o.context))})),this.chunkBudget>0&&!(h&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(o.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(i=>Rn(this.view.state,i)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),za=Qe.define({combine(t){return t.length?t[0]:null},enables:t=>[Ln.state,EW,qe.contentAttributes.compute([t],e=>{let i=e.facet(t);return i&&i.name?{"data-language":i.name}:{}})]}),du=class{constructor(e,i=[]){this.language=e,this.support=i,this.extension=[e,i]}};var TW=Qe.define(),Ef=Qe.define({combine:t=>{if(!t.length)return"  ";if(!/^(?: +|\t+)$/.test(t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return t[0]}});function Tf(t){let e=t.facet(Ef);return e.charCodeAt(0)==9?t.tabSize*e.length:e.length}function pu(t,e){let i="",r=t.tabSize;if(t.facet(Ef).charCodeAt(0)==9)for(;e>=r;)i+="	",e-=r;for(let n=0;n<e;n++)i+=" ";return i}function hv(t,e){t instanceof Ct&&(t=new zl(t));for(let r of t.state.facet(TW)){let n=r(t,e);if(n!==void 0)return n}let i=fr(t.state);return i?AW(t,i,e):null}var zl=class{constructor(e,i={}){this.state=e,this.options=i,this.unit=Tf(e)}lineAt(e,i=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:o}=this.options;return n!=null&&n>=r.from&&n<=r.to?o&&n==e?{text:"",from:e}:(i<0?n<e:n<=e)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(e,i=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,i);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,i=1){let{text:r,from:n}=this.lineAt(e,i),o=this.countColumn(r,e-n),a=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return a>-1&&(o+=a-this.countColumn(r,r.search(/\S|$/))),o}countColumn(e,i=e.length){return Da(e,this.state.tabSize,i)}lineIndent(e,i=1){let{text:r,from:n}=this.lineAt(e,i),o=this.options.overrideIndentation;if(o){let a=o(n);if(a>-1)return a}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}},fw=new It;function AW(t,e,i){return OD(e.resolveInner(i).enterUnfinishedNodesBefore(i),i,t)}function PW(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function RW(t){let e=t.type.prop(fw);if(e)return e;let i=t.firstChild,r;if(i&&(r=i.type.prop(It.closedBy))){let n=t.lastChild,o=n&&r.indexOf(n.name)>-1;return a=>IW(a,!0,1,void 0,o&&!PW(a)?n.from:void 0)}return t.parent==null?LW:null}function OD(t,e,i){for(;t;t=t.parent){let r=RW(t);if(r)return r(Mf.create(i,e,t))}return null}function LW(){return 0}var Mf=class extends zl{constructor(e,i,r){super(e.state,e.options),this.base=e,this.pos=i,this.node=r}static create(e,i,r){return new Mf(e,i,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let i=this.node.resolve(e.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(OW(i,this.node))break;e=this.state.doc.lineAt(i.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?OD(e,this.pos,this.base):0}};function OW(t,e){for(let i=e;i;i=i.parent)if(t==i)return!0;return!1}function DW(t){let e=t.node,i=e.childAfter(e.from),r=e.lastChild;if(!i)return null;let n=t.options.simulateBreak,o=t.state.doc.lineAt(i.from),a=n==null||n<=o.from?o.to:Math.min(o.to,n);for(let l=i.to;;){let h=e.childAfter(l);if(!h||h==r)return null;if(!h.type.isSkipped)return h.from<a?i:null;l=h.to}}function IW(t,e,i,r,n){let o=t.textAfter,a=o.match(/^\s*/)[0].length,l=r&&o.slice(a,a+r.length)==r||n==t.pos+a,h=e?DW(t):null;return h?l?t.column(h.from):t.column(h.to):t.baseIndent+(l?0:t.unit*i)}var kW=200;function uv(){return Ct.transactionFilter.of(t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let i=t.newDoc,{head:r}=t.newSelection.main,n=i.lineAt(r);if(r>n.from+kW)return t;let o=i.sliceString(n.from,r);if(!e.some(u=>u.test(o)))return t;let{state:a}=t,l=-1,h=[];for(let{head:u}of a.selection.ranges){let c=a.doc.lineAt(u);if(c.from==l)continue;l=c.from;let f=hv(a,c.from);if(f==null)continue;let d=/^\s*/.exec(c.text)[0],m=pu(a,f);d!=m&&h.push({from:c.from,to:c.from+d.length,insert:m})}return h.length?[t,{changes:h,sequential:!0}]:t})}var FW=Qe.define(),dw=new It;function DD(t){let e=t.firstChild,i=t.lastChild;return e&&e.to<i.from?{from:e.to,to:i.type.isError?t.to:i.from}:null}function BW(t,e,i){let r=fr(t);if(r.length<i)return null;let n=r.resolveInner(i,1),o=null;for(let a=n;a;a=a.parent){if(a.to<=i||a.from>i)continue;if(o&&a.from<e)break;let l=a.type.prop(dw);if(l&&(a.to<r.length-50||r.length==t.doc.length||!NW(a))){let h=l(a,t);h&&h.from<=i&&h.from>=e&&h.to>i&&(o=h)}}return o}function NW(t){let e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function av(t,e,i){for(let r of t.facet(FW)){let n=r(t,e,i);if(n)return n}return BW(t,e,i)}function ID(t,e){let i=e.mapPos(t.from,1),r=e.mapPos(t.to,-1);return i>=r?void 0:{from:i,to:r}}var cv=Lt.define({map:ID}),Af=Lt.define({map:ID});function kD(t){let e=[];for(let{head:i}of t.state.selection.ranges)e.some(r=>r.from<=i&&r.to>=i)||e.push(t.lineBlockAt(i));return e}var Hl=Ii.define({create(){return xt.none},update(t,e){t=t.map(e.changes);for(let i of e.effects)i.is(cv)&&!UW(t,i.value.from,i.value.to)?t=t.update({add:[AD.range(i.value.from,i.value.to)]}):i.is(Af)&&(t=t.update({filter:(r,n)=>i.value.from!=r||i.value.to!=n,filterFrom:i.value.from,filterTo:i.value.to}));if(e.selection){let i=!1,{head:r}=e.selection.main;t.between(r,r,(n,o)=>{n<r&&o>r&&(i=!0)}),i&&(t=t.update({filterFrom:r,filterTo:r,filter:(n,o)=>o<=r||n>=r}))}return t},provide:t=>qe.decorations.from(t),toJSON(t,e){let i=[];return t.between(0,e.doc.length,(r,n)=>{i.push(r,n)}),i},fromJSON(t){if(!Array.isArray(t)||t.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let i=0;i<t.length;){let r=t[i++],n=t[i++];if(typeof r!="number"||typeof n!="number")throw new RangeError("Invalid JSON for fold state");e.push(AD.range(r,n))}return xt.set(e,!0)}});function lv(t,e,i){var r;let n=null;return(r=t.field(Hl,!1))===null||r===void 0||r.between(e,i,(o,a)=>{(!n||n.from>o)&&(n={from:o,to:a})}),n}function UW(t,e,i){let r=!1;return t.between(e,e,(n,o)=>{n==e&&o==i&&(r=!0)}),r}function FD(t,e){return t.field(Hl,!1)?e:e.concat(Lt.appendConfig.of(UD()))}var GW=t=>{for(let e of kD(t)){let i=av(t.state,e.from,e.to);if(i)return t.dispatch({effects:FD(t.state,[cv.of(i),BD(t,i)])}),!0}return!1},zW=t=>{if(!t.state.field(Hl,!1))return!1;let e=[];for(let i of kD(t)){let r=lv(t.state,i.from,i.to);r&&e.push(Af.of(r),BD(t,r,!1))}return e.length&&t.dispatch({effects:e}),e.length>0};function BD(t,e,i=!0){let r=t.state.doc.lineAt(e.from).number,n=t.state.doc.lineAt(e.to).number;return qe.announce.of(`${t.state.phrase(i?"Folded lines":"Unfolded lines")} ${r} ${t.state.phrase("to")} ${n}.`)}var HW=t=>{let{state:e}=t,i=[];for(let r=0;r<e.doc.length;){let n=t.lineBlockAt(r),o=av(e,n.from,n.to);o&&i.push(cv.of(o)),r=(o?t.lineBlockAt(o.to):n).to+1}return i.length&&t.dispatch({effects:FD(t.state,i)}),!!i.length},WW=t=>{let e=t.state.field(Hl,!1);if(!e||!e.size)return!1;let i=[];return e.between(0,t.state.doc.length,(r,n)=>{i.push(Af.of({from:r,to:n}))}),t.dispatch({effects:i}),!0},fv=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:GW},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:zW},{key:"Ctrl-Alt-[",run:HW},{key:"Ctrl-Alt-]",run:WW}],VW={placeholderDOM:null,placeholderText:"\u2026"},ND=Qe.define({combine(t){return fn(t,VW)}});function UD(t){let e=[Hl,qW];return t&&e.push(ND.of(t)),e}var AD=xt.replace({widget:new class extends Ps{toDOM(t){let{state:e}=t,i=e.facet(ND),r=o=>{let a=t.lineBlockAt(t.posAtDOM(o.target)),l=lv(t.state,a.from,a.to);l&&t.dispatch({effects:Af.of(l)}),o.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(t,r);let n=document.createElement("span");return n.textContent=i.placeholderText,n.setAttribute("aria-label",e.phrase("folded code")),n.title=e.phrase("unfold"),n.className="cm-foldPlaceholder",n.onclick=r,n}}}),jW={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1},Sf=class extends Ir{constructor(e,i){super(),this.config=e,this.open=i}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let i=document.createElement("span");return i.textContent=this.open?this.config.openText:this.config.closedText,i.title=e.state.phrase(this.open?"Fold line":"Unfold line"),i}};function dv(t={}){let e=Object.assign(Object.assign({},jW),t),i=new Sf(e,!0),r=new Sf(e,!1),n=ki.fromClass(class{constructor(a){this.from=a.viewport.from,this.markers=this.buildMarkers(a)}update(a){(a.docChanged||a.viewportChanged||a.startState.facet(za)!=a.state.facet(za)||a.startState.field(Hl,!1)!=a.state.field(Hl,!1)||fr(a.startState)!=fr(a.state)||e.foldingChanged(a))&&(this.markers=this.buildMarkers(a.view))}buildMarkers(a){let l=new An;for(let h of a.viewportLineBlocks){let u=lv(a.state,h.from,h.to)?r:av(a.state,h.from,h.to)?i:null;u&&l.add(h.from,h.from,u)}return l.finish()}}),{domEventHandlers:o}=e;return[n,ou({class:"cm-foldGutter",markers(a){var l;return((l=a.plugin(n))===null||l===void 0?void 0:l.markers)||zt.empty},initialSpacer(){return new Sf(e,!1)},domEventHandlers:Object.assign(Object.assign({},o),{click:(a,l,h)=>{if(o.click&&o.click(a,l,h))return!0;let u=lv(a.state,l.from,l.to);if(u)return a.dispatch({effects:Af.of(u)}),!0;let c=av(a.state,l.from,l.to);return c?(a.dispatch({effects:cv.of(c)}),!0):!1}})}),UD()]}var qW=qe.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}}),yo=class{constructor(e,i){this.specs=e;let r;function n(l){let h=Jn.newName();return(r||(r=Object.create(null)))["."+h]=l,h}let o=typeof i.all=="string"?i.all:i.all?n(i.all):void 0,a=i.scope;this.scope=a instanceof Ln?l=>l.prop(Cf)==a.data:a?l=>l==a:void 0,this.style=rw(e.map(l=>({tag:l.tag,class:l.class||n(Object.assign({},l,{tag:null}))})),{all:o}).style,this.module=r?new Jn(r):null,this.themeType=i.themeType}static define(e,i){return new yo(e,i||{})}},hw=Qe.define(),GD=Qe.define({combine(t){return t.length?[t[0]]:null}});function ow(t){let e=t.facet(hw);return e.length?e:t.facet(GD)}function pv(t,e){let i=[XW],r;return t instanceof yo&&(t.module&&i.push(qe.styleModule.of(t.module)),r=t.themeType),e!=null&&e.fallback?i.push(GD.of(t)):r?i.push(hw.computeN([qe.darkTheme],n=>n.facet(qe.darkTheme)==(r=="dark")?[t]:[])):i.push(hw.of(t)),i}var uw=class{constructor(e){this.markCache=Object.create(null),this.tree=fr(e.state),this.decorations=this.buildDeco(e,ow(e.state))}update(e){let i=fr(e.state),r=ow(e.state),n=r!=ow(e.startState);i.length<e.view.viewport.to&&!n&&i.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(i!=this.tree||e.viewportChanged||n)&&(this.tree=i,this.decorations=this.buildDeco(e.view,r))}buildDeco(e,i){if(!i||!this.tree.length)return xt.none;let r=new An;for(let{from:n,to:o}of e.visibleRanges)MD(this.tree,i,(a,l,h)=>{r.add(a,l,this.markCache[h]||(this.markCache[h]=xt.mark({class:h})))},n,o);return r.finish()}},XW=lo.high(ki.fromClass(uw,{decorations:t=>t.decorations})),zD=yo.define([{tag:ee.meta,color:"#404740"},{tag:ee.link,textDecoration:"underline"},{tag:ee.heading,textDecoration:"underline",fontWeight:"bold"},{tag:ee.emphasis,fontStyle:"italic"},{tag:ee.strong,fontWeight:"bold"},{tag:ee.strikethrough,textDecoration:"line-through"},{tag:ee.keyword,color:"#708"},{tag:[ee.atom,ee.bool,ee.url,ee.contentSeparator,ee.labelName],color:"#219"},{tag:[ee.literal,ee.inserted],color:"#164"},{tag:[ee.string,ee.deleted],color:"#a11"},{tag:[ee.regexp,ee.escape,ee.special(ee.string)],color:"#e40"},{tag:ee.definition(ee.variableName),color:"#00f"},{tag:ee.local(ee.variableName),color:"#30a"},{tag:[ee.typeName,ee.namespace],color:"#085"},{tag:ee.className,color:"#167"},{tag:[ee.special(ee.variableName),ee.macroName],color:"#256"},{tag:ee.definition(ee.propertyName),color:"#00c"},{tag:ee.comment,color:"#940"},{tag:ee.invalid,color:"#f00"}]),YW=qe.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),HD=1e4,WD="()[]{}",VD=Qe.define({combine(t){return fn(t,{afterCursor:!0,brackets:WD,maxScanDistance:HD,renderMatch:QW})}}),ZW=xt.mark({class:"cm-matchingBracket"}),KW=xt.mark({class:"cm-nonmatchingBracket"});function QW(t){let e=[],i=t.matched?ZW:KW;return e.push(i.range(t.start.from,t.start.to)),t.end&&e.push(i.range(t.end.from,t.end.to)),e}var JW=Ii.define({create(){return xt.none},update(t,e){if(!e.docChanged&&!e.selection)return t;let i=[],r=e.state.facet(VD);for(let n of e.state.selection.ranges){if(!n.empty)continue;let o=Ls(e.state,n.head,-1,r)||n.head>0&&Ls(e.state,n.head-1,1,r)||r.afterCursor&&(Ls(e.state,n.head,1,r)||n.head<e.state.doc.length&&Ls(e.state,n.head+1,-1,r));o&&(i=i.concat(r.renderMatch(o,e.state)))}return xt.set(i,!0)},provide:t=>qe.decorations.from(t)}),$W=[JW,YW];function mv(t={}){return[VD.of(t),$W]}function cw(t,e,i){let r=t.prop(e<0?It.openedBy:It.closedBy);if(r)return r;if(t.name.length==1){let n=i.indexOf(t.name);if(n>-1&&n%2==(e<0?1:0))return[i[n+e]]}return null}function Ls(t,e,i,r={}){let n=r.maxScanDistance||HD,o=r.brackets||WD,a=fr(t),l=a.resolveInner(e,i);for(let h=l;h;h=h.parent){let u=cw(h.type,i,o);if(u&&h.from<h.to)return e9(t,e,i,h,u,o)}return t9(t,e,i,a,l.type,n,o)}function e9(t,e,i,r,n,o){let a=r.parent,l={from:r.from,to:r.to},h=0,u=a==null?void 0:a.cursor();if(u&&(i<0?u.childBefore(r.from):u.childAfter(r.to)))do if(i<0?u.to<=r.from:u.from>=r.to){if(h==0&&n.indexOf(u.type.name)>-1&&u.from<u.to)return{start:l,end:{from:u.from,to:u.to},matched:!0};if(cw(u.type,i,o))h++;else if(cw(u.type,-i,o)){if(h==0)return{start:l,end:u.from==u.to?void 0:{from:u.from,to:u.to},matched:!1};h--}}while(i<0?u.prevSibling():u.nextSibling());return{start:l,matched:!1}}function t9(t,e,i,r,n,o,a){let l=i<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),h=a.indexOf(l);if(h<0||h%2==0!=i>0)return null;let u={from:i<0?e-1:e,to:i>0?e+1:e},c=t.doc.iterRange(e,i>0?t.doc.length:0),f=0;for(let d=0;!c.next().done&&d<=o;){let m=c.value;i<0&&(d+=m.length);let v=e+d*i;for(let g=i>0?0:m.length-1,p=i>0?m.length:-1;g!=p;g+=i){let _=a.indexOf(m[g]);if(!(_<0||r.resolveInner(v+g,1).type!=n))if(_%2==0==i>0)f++;else{if(f==1)return{start:u,end:{from:v+g,to:v+g+1},matched:_>>1==h>>1};f--}}i>0&&(d+=m.length)}return c.done?{start:u,matched:!1}:null}var i9=Object.create(null),PD=[kr.none];var RD=[],r9=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])r9[t]=n9(i9,e);function aw(t,e){RD.indexOf(t)>-1||(RD.push(t),console.warn(e))}function n9(t,e){let i=null;for(let o of e.split(".")){let a=t[o]||ee[o];a?typeof a=="function"?i?i=a(i):aw(o,`Modifier ${o} used at start of tag`):i?aw(o,`Tag ${o} used as modifier`):i=a:aw(o,`Unknown highlighting tag ${o}`)}if(!i)return 0;let r=e.replace(/ /g,"_"),n=kr.define({id:PD.length,name:r,props:[cu({[r]:i})]});return PD.push(n),n.id}xf();var s9=t=>{let e=xw(t.state);return e.line?o9(t):e.block?l9(t):!1};function yw(t,e){return({state:i,dispatch:r})=>{if(i.readOnly)return!1;let n=t(e,i);return n?(r(i.update(n)),!0):!1}}var o9=yw(c9,0);var a9=yw(JD,0);var l9=yw((t,e)=>JD(t,e,u9(e)),0);function xw(t,e=t.selection.main.head){let i=t.languageDataAt("commentTokens",e);return i.length?i[0]:{}}var Pf=50;function h9(t,{open:e,close:i},r,n){let o=t.sliceDoc(r-Pf,r),a=t.sliceDoc(n,n+Pf),l=/\s*$/.exec(o)[0].length,h=/^\s*/.exec(a)[0].length,u=o.length-l;if(o.slice(u-e.length,u)==e&&a.slice(h,h+i.length)==i)return{open:{pos:r-l,margin:l&&1},close:{pos:n+h,margin:h&&1}};let c,f;n-r<=2*Pf?c=f=t.sliceDoc(r,n):(c=t.sliceDoc(r,r+Pf),f=t.sliceDoc(n-Pf,n));let d=/^\s*/.exec(c)[0].length,m=/\s*$/.exec(f)[0].length,v=f.length-m-i.length;return c.slice(d,d+e.length)==e&&f.slice(v,v+i.length)==i?{open:{pos:r+d+e.length,margin:/\s/.test(c.charAt(d+e.length))?1:0},close:{pos:n-m-i.length,margin:/\s/.test(f.charAt(v-1))?1:0}}:null}function u9(t){let e=[];for(let i of t.selection.ranges){let r=t.doc.lineAt(i.from),n=i.to<=r.to?r:t.doc.lineAt(i.to),o=e.length-1;o>=0&&e[o].to>r.from?e[o].to=n.to:e.push({from:r.from,to:n.to})}return e}function JD(t,e,i=e.selection.ranges){let r=i.map(o=>xw(e,o.from).block);if(!r.every(o=>o))return null;let n=i.map((o,a)=>h9(e,r[a],o.from,o.to));if(t!=2&&!n.every(o=>o))return{changes:e.changes(i.map((o,a)=>n[a]?[]:[{from:o.from,insert:r[a].open+" "},{from:o.to,insert:" "+r[a].close}]))};if(t!=1&&n.some(o=>o)){let o=[];for(let a=0,l;a<n.length;a++)if(l=n[a]){let h=r[a],{open:u,close:c}=l;o.push({from:u.pos-h.open.length,to:u.pos+u.margin},{from:c.pos-c.margin,to:c.pos+h.close.length})}return{changes:o}}return null}function c9(t,e,i=e.selection.ranges){let r=[],n=-1;for(let{from:o,to:a}of i){let l=r.length,h=1e9;for(let u=o;u<=a;){let c=e.doc.lineAt(u);if(c.from>n&&(o==a||a>c.from)){n=c.from;let f=xw(e,u).line;if(!f)continue;let d=/^\s*/.exec(c.text)[0].length,m=d==c.length,v=c.text.slice(d,d+f.length)==f?d:-1;d<c.text.length&&d<h&&(h=d),r.push({line:c,comment:v,token:f,indent:d,empty:m,single:!1})}u=c.to+1}if(h<1e9)for(let u=l;u<r.length;u++)r[u].indent<r[u].line.text.length&&(r[u].indent=h);r.length==l+1&&(r[l].single=!0)}if(t!=2&&r.some(o=>o.comment<0&&(!o.empty||o.single))){let o=[];for(let{line:l,token:h,indent:u,empty:c,single:f}of r)(f||!c)&&o.push({from:l.from+u,insert:h+" "});let a=e.changes(o);return{changes:a,selection:e.selection.map(a,1)}}else if(t!=1&&r.some(o=>o.comment>=0)){let o=[];for(let{line:a,comment:l,token:h}of r)if(l>=0){let u=a.from+l,c=u+h.length;a.text[c-a.from]==" "&&c++,o.push({from:u,to:c})}return{changes:o}}return null}var mw=Qn.define(),f9=Qn.define(),d9=Qe.define(),$D=Qe.define({combine(t){return fn(t,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function p9(t){let e=0;return t.iterChangedRanges((i,r)=>e=r),e}var eI=Ii.define({create(){return rs.empty},update(t,e){let i=e.state.facet($D),r=e.annotation(mw);if(r){let h=e.docChanged?ve.single(p9(e.changes)):void 0,u=Fr.fromTransaction(e,h),c=r.side,f=c==0?t.undone:t.done;return u?f=vv(f,f.length,i.minDepth,u):f=rI(f,e.startState.selection),new rs(c==0?r.rest:f,c==0?f:r.rest)}let n=e.annotation(f9);if((n=="full"||n=="before")&&(t=t.isolate()),e.annotation(xi.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let o=Fr.fromTransaction(e),a=e.annotation(xi.time),l=e.annotation(xi.userEvent);return o?t=t.addChanges(o,a,l,i.newGroupDelay,i.minDepth):e.selection&&(t=t.addSelection(e.startState.selection,a,l,i.newGroupDelay)),(n=="full"||n=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new rs(t.done.map(Fr.fromJSON),t.undone.map(Fr.fromJSON))}});function _v(t={}){return[eI,$D.of(t),qe.domEventHandlers({beforeinput(e,i){let r=e.inputType=="historyUndo"?tI:e.inputType=="historyRedo"?gw:null;return r?(e.preventDefault(),r(i)):!1}})]}function yv(t,e){return function({state:i,dispatch:r}){if(!e&&i.readOnly)return!1;let n=i.field(eI,!1);if(!n)return!1;let o=n.pop(t,i,e);return o?(r(o),!0):!1}}var tI=yv(0,!1),gw=yv(1,!1),m9=yv(0,!0),g9=yv(1,!0);var Fr=class{constructor(e,i,r,n,o){this.changes=e,this.effects=i,this.mapped=r,this.startSelection=n,this.selectionsAfter=o}setSelAfter(e){return new Fr(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,i,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(i=this.mapped)===null||i===void 0?void 0:i.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(n=>n.toJSON())}}static fromJSON(e){return new Fr(e.changes&&yi.fromJSON(e.changes),[],e.mapped&&Tn.fromJSON(e.mapped),e.startSelection&&ve.fromJSON(e.startSelection),e.selectionsAfter.map(ve.fromJSON))}static fromTransaction(e,i){let r=is;for(let n of e.startState.facet(d9)){let o=n(e);o.length&&(r=r.concat(o))}return!r.length&&e.changes.empty?null:new Fr(e.changes.invert(e.startState.doc),r,void 0,i||e.startState.selection,is)}static selection(e){return new Fr(void 0,is,void 0,void 0,e)}};function vv(t,e,i,r){let n=e+1>i+20?e-i-1:0,o=t.slice(n,e);return o.push(r),o}function v9(t,e){let i=[],r=!1;return t.iterChangedRanges((n,o)=>i.push(n,o)),e.iterChangedRanges((n,o,a,l)=>{for(let h=0;h<i.length;){let u=i[h++],c=i[h++];l>=u&&a<=c&&(r=!0)}}),r}function _9(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((i,r)=>i.empty!=e.ranges[r].empty).length===0}function iI(t,e){return t.length?e.length?t.concat(e):t:e}var is=[],y9=200;function rI(t,e){if(t.length){let i=t[t.length-1],r=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-y9));return r.length&&r[r.length-1].eq(e)?t:(r.push(e),vv(t,t.length-1,1e9,i.setSelAfter(r)))}else return[Fr.selection([e])]}function x9(t){let e=t[t.length-1],i=t.slice();return i[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),i}function pw(t,e){if(!t.length)return t;let i=t.length,r=is;for(;i;){let n=b9(t[i-1],e,r);if(n.changes&&!n.changes.empty||n.effects.length){let o=t.slice(0,i);return o[i-1]=n,o}else e=n.mapped,i--,r=n.selectionsAfter}return r.length?[Fr.selection(r)]:is}function b9(t,e,i){let r=iI(t.selectionsAfter.length?t.selectionsAfter.map(l=>l.map(e)):is,i);if(!t.changes)return Fr.selection(r);let n=t.changes.map(e),o=e.mapDesc(t.changes,!0),a=t.mapped?t.mapped.composeDesc(o):o;return new Fr(n,Lt.mapEffects(t.effects,e),a,t.startSelection.map(o),r)}var w9=/^(input\.type|delete)($|\.)/,rs=class{constructor(e,i,r=0,n=void 0){this.done=e,this.undone=i,this.prevTime=r,this.prevUserEvent=n}isolate(){return this.prevTime?new rs(this.done,this.undone):this}addChanges(e,i,r,n,o){let a=this.done,l=a[a.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!r||w9.test(r))&&(!l.selectionsAfter.length&&i-this.prevTime<n&&v9(l.changes,e.changes)||r=="input.type.compose")?a=vv(a,a.length-1,o,new Fr(e.changes.compose(l.changes),iI(e.effects,l.effects),l.mapped,l.startSelection,is)):a=vv(a,a.length,o,e),new rs(a,is,i,r)}addSelection(e,i,r,n){let o=this.done.length?this.done[this.done.length-1].selectionsAfter:is;return o.length>0&&i-this.prevTime<n&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&_9(o[o.length-1],e)?this:new rs(rI(this.done,e),this.undone,i,r)}addMapping(e){return new rs(pw(this.done,e),pw(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,i,r){let n=e==0?this.done:this.undone;if(n.length==0)return null;let o=n[n.length-1];if(r&&o.selectionsAfter.length)return i.update({selection:o.selectionsAfter[o.selectionsAfter.length-1],annotations:mw.of({side:e,rest:x9(n)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(o.changes){let a=n.length==1?is:n.slice(0,n.length-1);return o.mapped&&(a=pw(a,o.mapped)),i.update({changes:o.changes,selection:o.startSelection,effects:o.effects,annotations:mw.of({side:e,rest:a}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}};rs.empty=new rs(is,is);var xv=[{key:"Mod-z",run:tI,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:gw,preventDefault:!0},{linux:"Ctrl-Shift-z",run:gw,preventDefault:!0},{key:"Mod-u",run:m9,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:g9,preventDefault:!0}];function mu(t,e){return ve.create(t.ranges.map(e),t.mainIndex)}function xo(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Os({state:t,dispatch:e},i){let r=mu(t.selection,i);return r.eq(t.selection)?!1:(e(xo(t,r)),!0)}function bv(t,e){return ve.cursor(e?t.to:t.from)}function nI(t,e){return Os(t,i=>i.empty?t.moveByChar(i,e):bv(i,e))}function Br(t){return t.textDirectionAt(t.state.selection.main.head)==hi.LTR}var sI=t=>nI(t,!Br(t)),oI=t=>nI(t,Br(t));function aI(t,e){return Os(t,i=>i.empty?t.moveByGroup(i,e):bv(i,e))}var S9=t=>aI(t,!Br(t)),C9=t=>aI(t,Br(t));function M9(t,e,i){if(e.type.prop(i))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function wv(t,e,i){let r=fr(t).resolveInner(e.head),n=i?It.closedBy:It.openedBy;for(let h=e.head;;){let u=i?r.childAfter(h):r.childBefore(h);if(!u)break;M9(t,u,n)?r=u:h=i?u.to:u.from}let o=r.type.prop(n),a,l;return o&&(a=i?Ls(t,r.from,1):Ls(t,r.to,-1))&&a.matched?l=i?a.end.to:a.end.from:l=i?r.to:r.from,ve.cursor(l,i?-1:1)}var E9=t=>Os(t,e=>wv(t.state,e,!Br(t))),T9=t=>Os(t,e=>wv(t.state,e,Br(t)));function lI(t,e){return Os(t,i=>{if(!i.empty)return bv(i,e);let r=t.moveVertically(i,e);return r.head!=i.head?r:t.moveToLineBoundary(i,e)})}var hI=t=>lI(t,!1),uI=t=>lI(t,!0);function cI(t){return Math.max(t.defaultLineHeight,Math.min(t.dom.clientHeight,innerHeight)-5)}function fI(t,e){let{state:i}=t,r=mu(i.selection,l=>l.empty?t.moveVertically(l,e,cI(t)):bv(l,e));if(r.eq(i.selection))return!1;let n=t.coordsAtPos(i.selection.main.head),o=t.scrollDOM.getBoundingClientRect(),a;return n&&n.top>o.top&&n.bottom<o.bottom&&n.top-o.top<=t.scrollDOM.scrollHeight-t.scrollDOM.scrollTop-t.scrollDOM.clientHeight&&(a=qe.scrollIntoView(r.main.head,{y:"start",yMargin:n.top-o.top})),t.dispatch(xo(i,r),{effects:a}),!0}var jD=t=>fI(t,!1),vw=t=>fI(t,!0);function Ha(t,e,i){let r=t.lineBlockAt(e.head),n=t.moveToLineBoundary(e,i);if(n.head==e.head&&n.head!=(i?r.to:r.from)&&(n=t.moveToLineBoundary(e,i,!1)),!i&&n.head==r.from&&r.length){let o=/^\s*/.exec(t.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;o&&e.head!=r.from+o&&(n=ve.cursor(r.from+o))}return n}var A9=t=>Os(t,e=>Ha(t,e,!0)),P9=t=>Os(t,e=>Ha(t,e,!1)),R9=t=>Os(t,e=>Ha(t,e,!Br(t))),L9=t=>Os(t,e=>Ha(t,e,Br(t))),O9=t=>Os(t,e=>ve.cursor(t.lineBlockAt(e.head).from,1)),D9=t=>Os(t,e=>ve.cursor(t.lineBlockAt(e.head).to,-1));function I9(t,e,i){let r=!1,n=mu(t.selection,o=>{let a=Ls(t,o.head,-1)||Ls(t,o.head,1)||o.head>0&&Ls(t,o.head-1,1)||o.head<t.doc.length&&Ls(t,o.head+1,-1);if(!a||!a.end)return o;r=!0;let l=a.start.from==o.head?a.end.to:a.end.from;return i?ve.range(o.anchor,l):ve.cursor(l)});return r?(e(xo(t,n)),!0):!1}var k9=({state:t,dispatch:e})=>I9(t,e,!1);function ns(t,e){let i=mu(t.state.selection,r=>{let n=e(r);return ve.range(r.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)});return i.eq(t.state.selection)?!1:(t.dispatch(xo(t.state,i)),!0)}function dI(t,e){return ns(t,i=>t.moveByChar(i,e))}var pI=t=>dI(t,!Br(t)),mI=t=>dI(t,Br(t));function gI(t,e){return ns(t,i=>t.moveByGroup(i,e))}var F9=t=>gI(t,!Br(t)),B9=t=>gI(t,Br(t));var N9=t=>ns(t,e=>wv(t.state,e,!Br(t))),U9=t=>ns(t,e=>wv(t.state,e,Br(t)));function vI(t,e){return ns(t,i=>t.moveVertically(i,e))}var _I=t=>vI(t,!1),yI=t=>vI(t,!0);function xI(t,e){return ns(t,i=>t.moveVertically(i,e,cI(t)))}var qD=t=>xI(t,!1),XD=t=>xI(t,!0),G9=t=>ns(t,e=>Ha(t,e,!0)),z9=t=>ns(t,e=>Ha(t,e,!1)),H9=t=>ns(t,e=>Ha(t,e,!Br(t))),W9=t=>ns(t,e=>Ha(t,e,Br(t))),V9=t=>ns(t,e=>ve.cursor(t.lineBlockAt(e.head).from)),j9=t=>ns(t,e=>ve.cursor(t.lineBlockAt(e.head).to)),YD=({state:t,dispatch:e})=>(e(xo(t,{anchor:0})),!0),ZD=({state:t,dispatch:e})=>(e(xo(t,{anchor:t.doc.length})),!0),KD=({state:t,dispatch:e})=>(e(xo(t,{anchor:t.selection.main.anchor,head:0})),!0),QD=({state:t,dispatch:e})=>(e(xo(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),q9=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),X9=({state:t,dispatch:e})=>{let i=Cv(t).map(({from:r,to:n})=>ve.range(r,Math.min(n+1,t.doc.length)));return e(t.update({selection:ve.create(i),userEvent:"select"})),!0},Y9=({state:t,dispatch:e})=>{let i=mu(t.selection,r=>{var n;let o=fr(t).resolveInner(r.head,1);for(;!(o.from<r.from&&o.to>=r.to||o.to>r.to&&o.from<=r.from||!(!((n=o.parent)===null||n===void 0)&&n.parent));)o=o.parent;return ve.range(o.to,o.from)});return e(xo(t,i)),!0},Z9=({state:t,dispatch:e})=>{let i=t.selection,r=null;return i.ranges.length>1?r=ve.create([i.main]):i.main.empty||(r=ve.create([ve.cursor(i.main.head)])),r?(e(xo(t,r)),!0):!1};function Sv(t,e){if(t.state.readOnly)return!1;let i="delete.selection",{state:r}=t,n=r.changeByRange(o=>{let{from:a,to:l}=o;if(a==l){let h=e(a);h<a?(i="delete.backward",h=gv(t,h,!1)):h>a&&(i="delete.forward",h=gv(t,h,!0)),a=Math.min(a,h),l=Math.max(l,h)}else a=gv(t,a,!1),l=gv(t,l,!0);return a==l?{range:o}:{changes:{from:a,to:l},range:ve.cursor(a)}});return n.changes.empty?!1:(t.dispatch(r.update(n,{scrollIntoView:!0,userEvent:i,effects:i=="delete.selection"?qe.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function gv(t,e,i){if(t instanceof qe)for(let r of t.state.facet(qe.atomicRanges).map(n=>n(t)))r.between(e,e,(n,o)=>{n<e&&o>e&&(e=i?o:n)});return e}var bI=(t,e)=>Sv(t,i=>{let{state:r}=t,n=r.doc.lineAt(i),o,a;if(!e&&i>n.from&&i<n.from+200&&!/[^ \t]/.test(o=n.text.slice(0,i-n.from))){if(o[o.length-1]=="	")return i-1;let l=Da(o,r.tabSize),h=l%Tf(r)||Tf(r);for(let u=0;u<h&&o[o.length-1-u]==" ";u++)i--;a=i}else a=hr(n.text,i-n.from,e,e)+n.from,a==i&&n.number!=(e?r.doc.lines:1)&&(a+=e?1:-1);return a}),_w=t=>bI(t,!1),wI=t=>bI(t,!0),SI=(t,e)=>Sv(t,i=>{let r=i,{state:n}=t,o=n.doc.lineAt(r),a=n.charCategorizer(r);for(let l=null;;){if(r==(e?o.to:o.from)){r==i&&o.number!=(e?n.doc.lines:1)&&(r+=e?1:-1);break}let h=hr(o.text,r-o.from,e)+o.from,u=o.text.slice(Math.min(r,h)-o.from,Math.max(r,h)-o.from),c=a(u);if(l!=null&&c!=l)break;(u!=" "||r!=i)&&(l=c),r=h}return r}),CI=t=>SI(t,!1),K9=t=>SI(t,!0),MI=t=>Sv(t,e=>{let i=t.lineBlockAt(e).to;return e<i?i:Math.min(t.state.doc.length,e+1)}),Q9=t=>Sv(t,e=>{let i=t.lineBlockAt(e).from;return e>i?i:Math.max(0,e-1)});var J9=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:Nt.of(["",""])},range:ve.cursor(r.from)}));return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0},$9=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(r=>{if(!r.empty||r.from==0||r.from==t.doc.length)return{range:r};let n=r.from,o=t.doc.lineAt(n),a=n==o.from?n-1:hr(o.text,n-o.from,!1)+o.from,l=n==o.to?n+1:hr(o.text,n-o.from,!0)+o.from;return{changes:{from:a,to:l,insert:t.doc.slice(n,l).append(t.doc.slice(a,n))},range:ve.cursor(l)}});return i.changes.empty?!1:(e(t.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Cv(t){let e=[],i=-1;for(let r of t.selection.ranges){let n=t.doc.lineAt(r.from),o=t.doc.lineAt(r.to);if(!r.empty&&r.to==o.from&&(o=t.doc.lineAt(r.to-1)),i>=n.number){let a=e[e.length-1];a.to=o.to,a.ranges.push(r)}else e.push({from:n.from,to:o.to,ranges:[r]});i=o.number+1}return e}function EI(t,e,i){if(t.readOnly)return!1;let r=[],n=[];for(let o of Cv(t)){if(i?o.to==t.doc.length:o.from==0)continue;let a=t.doc.lineAt(i?o.to+1:o.from-1),l=a.length+1;if(i){r.push({from:o.to,to:a.to},{from:o.from,insert:a.text+t.lineBreak});for(let h of o.ranges)n.push(ve.range(Math.min(t.doc.length,h.anchor+l),Math.min(t.doc.length,h.head+l)))}else{r.push({from:a.from,to:o.from},{from:o.to,insert:t.lineBreak+a.text});for(let h of o.ranges)n.push(ve.range(h.anchor-l,h.head-l))}}return r.length?(e(t.update({changes:r,scrollIntoView:!0,selection:ve.create(n,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}var eV=({state:t,dispatch:e})=>EI(t,e,!1),tV=({state:t,dispatch:e})=>EI(t,e,!0);function TI(t,e,i){if(t.readOnly)return!1;let r=[];for(let n of Cv(t))i?r.push({from:n.from,insert:t.doc.slice(n.from,n.to)+t.lineBreak}):r.push({from:n.to,insert:t.lineBreak+t.doc.slice(n.from,n.to)});return e(t.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}var iV=({state:t,dispatch:e})=>TI(t,e,!1),rV=({state:t,dispatch:e})=>TI(t,e,!0),nV=t=>{if(t.state.readOnly)return!1;let{state:e}=t,i=e.changes(Cv(e).map(({from:n,to:o})=>(n>0?n--:o<e.doc.length&&o++,{from:n,to:o}))),r=mu(e.selection,n=>t.moveVertically(n,!0)).map(i);return t.dispatch({changes:i,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function sV(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let i=fr(t).resolveInner(e),r=i.childBefore(e),n=i.childAfter(e),o;return r&&n&&r.to<=e&&n.from>=e&&(o=r.type.prop(It.closedBy))&&o.indexOf(n.name)>-1&&t.doc.lineAt(r.to).from==t.doc.lineAt(n.from).from?{from:r.to,to:n.from}:null}var oV=AI(!1),aV=AI(!0);function AI(t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let r=e.changeByRange(n=>{let{from:o,to:a}=n,l=e.doc.lineAt(o),h=!t&&o==a&&sV(e,o);t&&(o=a=(a<=l.to?l:e.doc.lineAt(a)).to);let u=new zl(e,{simulateBreak:o,simulateDoubleBreak:!!h}),c=hv(u,o);for(c==null&&(c=/^\s*/.exec(e.doc.lineAt(o).text)[0].length);a<l.to&&/\s/.test(l.text[a-l.from]);)a++;h?{from:o,to:a}=h:o>l.from&&o<l.from+100&&!/\S/.test(l.text.slice(0,o))&&(o=l.from);let f=["",pu(e,c)];return h&&f.push(pu(e,u.lineIndent(l.from,-1))),{changes:{from:o,to:a,insert:Nt.of(f)},range:ve.cursor(o+1+f[1].length)}});return i(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function bw(t,e){let i=-1;return t.changeByRange(r=>{let n=[];for(let a=r.from;a<=r.to;){let l=t.doc.lineAt(a);l.number>i&&(r.empty||r.to>l.from)&&(e(l,n,r),i=l.number),a=l.to+1}let o=t.changes(n);return{changes:n,range:ve.range(o.mapPos(r.anchor,1),o.mapPos(r.head,1))}})}var lV=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=Object.create(null),r=new zl(t,{overrideIndentation:o=>{let a=i[o];return a==null?-1:a}}),n=bw(t,(o,a,l)=>{let h=hv(r,o.from);if(h==null)return;/\S/.test(o.text)||(h=0);let u=/^\s*/.exec(o.text)[0],c=pu(t,h);(u!=c||l.from<o.from+u.length)&&(i[o.from]=h,a.push({from:o.from,to:o.from+u.length,insert:c}))});return n.changes.empty||e(t.update(n,{userEvent:"indent"})),!0},PI=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(bw(t,(i,r)=>{r.push({from:i.from,insert:t.facet(Ef)})}),{userEvent:"input.indent"})),!0),RI=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(bw(t,(i,r)=>{let n=/^\s*/.exec(i.text)[0];if(!n)return;let o=Da(n,t.tabSize),a=0,l=pu(t,Math.max(0,o-Tf(t)));for(;a<n.length&&a<l.length&&n.charCodeAt(a)==l.charCodeAt(a);)a++;r.push({from:i.from+a,to:i.from+n.length,insert:l.slice(a)})}),{userEvent:"delete.dedent"})),!0);var hV=[{key:"Ctrl-b",run:sI,shift:pI,preventDefault:!0},{key:"Ctrl-f",run:oI,shift:mI},{key:"Ctrl-p",run:hI,shift:_I},{key:"Ctrl-n",run:uI,shift:yI},{key:"Ctrl-a",run:O9,shift:V9},{key:"Ctrl-e",run:D9,shift:j9},{key:"Ctrl-d",run:wI},{key:"Ctrl-h",run:_w},{key:"Ctrl-k",run:MI},{key:"Ctrl-Alt-h",run:CI},{key:"Ctrl-o",run:J9},{key:"Ctrl-t",run:$9},{key:"Ctrl-v",run:vw}],uV=[{key:"ArrowLeft",run:sI,shift:pI,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:S9,shift:F9,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:R9,shift:H9,preventDefault:!0},{key:"ArrowRight",run:oI,shift:mI,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:C9,shift:B9,preventDefault:!0},{mac:"Cmd-ArrowRight",run:L9,shift:W9,preventDefault:!0},{key:"ArrowUp",run:hI,shift:_I,preventDefault:!0},{mac:"Cmd-ArrowUp",run:YD,shift:KD},{mac:"Ctrl-ArrowUp",run:jD,shift:qD},{key:"ArrowDown",run:uI,shift:yI,preventDefault:!0},{mac:"Cmd-ArrowDown",run:ZD,shift:QD},{mac:"Ctrl-ArrowDown",run:vw,shift:XD},{key:"PageUp",run:jD,shift:qD},{key:"PageDown",run:vw,shift:XD},{key:"Home",run:P9,shift:z9,preventDefault:!0},{key:"Mod-Home",run:YD,shift:KD},{key:"End",run:A9,shift:G9,preventDefault:!0},{key:"Mod-End",run:ZD,shift:QD},{key:"Enter",run:oV},{key:"Mod-a",run:q9},{key:"Backspace",run:_w,shift:_w},{key:"Delete",run:wI},{key:"Mod-Backspace",mac:"Alt-Backspace",run:CI},{key:"Mod-Delete",mac:"Alt-Delete",run:K9},{mac:"Mod-Backspace",run:Q9},{mac:"Mod-Delete",run:MI}].concat(hV.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),Mv=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:E9,shift:N9},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:T9,shift:U9},{key:"Alt-ArrowUp",run:eV},{key:"Shift-Alt-ArrowUp",run:iV},{key:"Alt-ArrowDown",run:tV},{key:"Shift-Alt-ArrowDown",run:rV},{key:"Escape",run:Z9},{key:"Mod-Enter",run:aV},{key:"Alt-l",mac:"Ctrl-l",run:X9},{key:"Mod-i",run:Y9,preventDefault:!0},{key:"Mod-[",run:RI},{key:"Mod-]",run:PI},{key:"Mod-Alt-\\",run:lV},{key:"Shift-Mod-k",run:nV},{key:"Shift-Mod-\\",run:k9},{key:"Mod-/",run:s9},{key:"Alt-A",run:a9}].concat(uV),Ev={key:"Tab",run:PI,shift:RI};var Mk=Qi(ak());var Uv=class{constructor(e,i,r){this.state=e,this.pos=i,this.explicit=r,this.abortListeners=[]}tokenBefore(e){let i=fr(this.state).resolveInner(this.pos,-1);for(;i&&e.indexOf(i.name)<0;)i=i.parent;return i?{from:i.from,to:this.pos,text:this.state.sliceDoc(i.from,this.pos),type:i.type}:null}matchBefore(e){let i=this.state.doc.lineAt(this.pos),r=Math.max(i.from,this.pos-250),n=i.text.slice(r-i.from,this.pos-i.from),o=n.search(vk(e,!1));return o<0?null:{from:r+o,to:this.pos,text:n.slice(o)}}get aborted(){return this.abortListeners==null}addEventListener(e,i){e=="abort"&&this.abortListeners&&this.abortListeners.push(i)}};function lk(t){let e=Object.keys(t).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function GV(t){let e=Object.create(null),i=Object.create(null);for(let{label:n}of t){e[n[0]]=!0;for(let o=1;o<n.length;o++)i[n[o]]=!0}let r=lk(e)+lk(i)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function If(t){let e=t.map(n=>typeof n=="string"?{label:n}:n),[i,r]=e.every(n=>/^\w+$/.test(n.label))?[/\w*$/,/\w+$/]:GV(e);return n=>{let o=n.matchBefore(r);return o||n.explicit?{from:o?o.from:n.pos,options:e,validFor:i}:null}}var Gv=class{constructor(e,i,r){this.completion=e,this.source=i,this.match=r}};function qa(t){return t.selection.main.head}function vk(t,e){var i;let{source:r}=t,n=e&&r[0]!="^",o=r[r.length-1]!="$";return!n&&!o?t:new RegExp(`${n?"^":""}(?:${r})${o?"$":""}`,(i=t.flags)!==null&&i!==void 0?i:t.ignoreCase?"i":"")}var zV=Qn.define();function HV(t,e,i,r){return Object.assign(Object.assign({},t.changeByRange(n=>{if(n==t.selection.main)return{changes:{from:i,to:r,insert:e},range:ve.cursor(i+e.length)};let o=r-i;return!n.empty||o&&t.sliceDoc(n.from-o,n.from)!=t.sliceDoc(i,r)?{range:n}:{changes:{from:n.from-o,to:n.from,insert:e},range:ve.cursor(n.from-o+e.length)}})),{userEvent:"input.complete"})}function _k(t,e){let i=e.completion.apply||e.completion.label,r=e.source;typeof i=="string"?t.dispatch(Object.assign(Object.assign({},HV(t.state,i,r.from,r.to)),{annotations:zV.of(e.completion)})):i(t,e.completion,r.from,r.to)}var hk=new WeakMap;function WV(t){if(!Array.isArray(t))return t;let e=hk.get(t);return e||hk.set(t,e=If(t)),e}var jw=class{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let i=0;i<e.length;){let r=ji(e,i),n=Dr(r);this.chars.push(r);let o=e.slice(i,i+n),a=o.toUpperCase();this.folded.push(ji(a==o?o.toLowerCase():a,0)),i+=n}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;let{chars:i,folded:r,any:n,precise:o,byWord:a}=this;if(i.length==1){let x=ji(e,0);return x==i[0]?[0,0,Dr(x)]:x==r[0]?[-200,0,Dr(x)]:null}let l=e.indexOf(this.pattern);if(l==0)return[0,0,this.pattern.length];let h=i.length,u=0;if(l<0){for(let x=0,b=Math.min(e.length,200);x<b&&u<h;){let y=ji(e,x);(y==i[u]||y==r[u])&&(n[u++]=x),x+=Dr(y)}if(u<h)return null}let c=0,f=0,d=!1,m=0,v=-1,g=-1,p=/[a-z]/.test(e),_=!0;for(let x=0,b=Math.min(e.length,200),y=0;x<b&&f<h;){let w=ji(e,x);l<0&&(c<h&&w==i[c]&&(o[c++]=x),m<h&&(w==i[m]||w==r[m]?(m==0&&(v=x),g=x+1,m++):m=0));let S,R=w<255?w>=48&&w<=57||w>=97&&w<=122?2:w>=65&&w<=90?1:0:(S=ef(w))!=S.toLowerCase()?1:S!=S.toUpperCase()?2:0;(!x||R==1&&p||y==0&&R!=0)&&(i[f]==w||r[f]==w&&(d=!0)?a[f++]=x:a.length&&(_=!1)),y=R,x+=Dr(w)}return f==h&&a[0]==0&&_?this.result(-100+(d?-200:0),a,e):m==h&&v==0?[-200-e.length,0,g]:l>-1?[-700-e.length,l,l+this.pattern.length]:m==h?[-200+-700-e.length,v,g]:f==h?this.result(-100+(d?-200:0)+-700+(_?0:-1100),a,e):i.length==2?null:this.result((n[0]?-700:0)+-200+-1100,n,e)}result(e,i,r){let n=[e-r.length],o=1;for(let a of i){let l=a+(this.astral?Dr(ji(r,a)):1);o>1&&n[o-1]==a?n[o-1]=l:(n[o++]=a,n[o++]=l)}return n}},ls=Qe.define({combine(t){return fn(t,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],compareCompletions:(e,i)=>e.label.localeCompare(i.label),interactionDelay:75},{defaultKeymap:(e,i)=>e&&i,closeOnBlur:(e,i)=>e&&i,icons:(e,i)=>e&&i,tooltipClass:(e,i)=>r=>uk(e(r),i(r)),optionClass:(e,i)=>r=>uk(e(r),i(r)),addToOptions:(e,i)=>e.concat(i)})}});function uk(t,e){return t?e?t+" "+e:t:e}function VV(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(i){let r=document.createElement("div");return r.classList.add("cm-completionIcon"),i.type&&r.classList.add(...i.type.split(/\s+/g).map(n=>"cm-completionIcon-"+n)),r.setAttribute("aria-hidden","true"),r},position:20}),e.push({render(i,r,n){let o=document.createElement("span");o.className="cm-completionLabel";let{label:a}=i,l=0;for(let h=1;h<n.length;){let u=n[h++],c=n[h++];u>l&&o.appendChild(document.createTextNode(a.slice(l,u)));let f=o.appendChild(document.createElement("span"));f.appendChild(document.createTextNode(a.slice(u,c))),f.className="cm-completionMatchedText",l=c}return l<a.length&&o.appendChild(document.createTextNode(a.slice(l))),o},position:50},{render(i){if(!i.detail)return null;let r=document.createElement("span");return r.className="cm-completionDetail",r.textContent=i.detail,r},position:80}),e.sort((i,r)=>i.position-r.position).map(i=>i.render)}function ck(t,e,i){if(t<=i)return{from:0,to:t};if(e<0&&(e=0),e<=t>>1){let n=Math.floor(e/i);return{from:n*i,to:(n+1)*i}}let r=Math.floor((t-e)/i);return{from:t-(r+1)*i,to:t-r*i}}var qw=class{constructor(e,i){this.view=e,this.stateField=i,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:l=>this.positionInfo(l),key:this},this.space=null,this.currentClass="";let r=e.state.field(i),{options:n,selected:o}=r.open,a=e.state.facet(ls);this.optionContent=VV(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=ck(n.length,o,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",l=>{for(let h=l.target,u;h&&h!=this.dom;h=h.parentNode)if(h.nodeName=="LI"&&(u=/-(\d+)$/.exec(h.id))&&+u[1]<n.length){_k(e,n[+u[1]]),l.preventDefault();return}}),this.list=this.dom.appendChild(this.createListBox(n,r.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})}mount(){this.updateSel()}update(e){var i,r,n;let o=e.state.field(this.stateField),a=e.startState.field(this.stateField);this.updateTooltipClass(e.state),o!=a&&(this.updateSel(),((i=o.open)===null||i===void 0?void 0:i.disabled)!=((r=a.open)===null||r===void 0?void 0:r.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!(!((n=o.open)===null||n===void 0)&&n.disabled)))}updateTooltipClass(e){let i=this.tooltipClass(e);if(i!=this.currentClass){for(let r of this.currentClass.split(" "))r&&this.dom.classList.remove(r);for(let r of i.split(" "))r&&this.dom.classList.add(r);this.currentClass=i}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),i=e.open;if((i.selected>-1&&i.selected<this.range.from||i.selected>=this.range.to)&&(this.range=ck(i.options.length,i.selected,this.view.state.facet(ls).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(i.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})),this.updateSelectedOption(i.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:r}=i.options[i.selected],{info:n}=r;if(!n)return;let o=typeof n=="string"?document.createTextNode(n):n(r);if(!o)return;"then"in o?o.then(a=>{a&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(a)}).catch(a=>Rn(this.view.state,a,"completion info")):this.addInfoPane(o)}}addInfoPane(e){let i=this.info=document.createElement("div");i.className="cm-tooltip cm-completionInfo",i.appendChild(e),this.dom.appendChild(i),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(e){let i=null;for(let r=this.list.firstChild,n=this.range.from;r;r=r.nextSibling,n++)n==e?r.hasAttribute("aria-selected")||(r.setAttribute("aria-selected","true"),i=r):r.hasAttribute("aria-selected")&&r.removeAttribute("aria-selected");return i&&qV(this.list,i),i}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let i=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),n=e.getBoundingClientRect(),o=this.space;if(!o){let v=this.dom.ownerDocument.defaultView||window;o={left:0,top:0,right:v.innerWidth,bottom:v.innerHeight}}if(n.top>Math.min(o.bottom,i.bottom)-10||n.bottom<Math.max(o.top,i.top)+10)return null;let a=this.view.textDirection==hi.RTL,l=a,h=!1,u,c="",f="",d=i.left-o.left,m=o.right-i.right;if(l&&d<Math.min(r.width,m)?l=!1:!l&&m<Math.min(r.width,d)&&(l=!0),r.width<=(l?d:m))c=Math.max(o.top,Math.min(n.top,o.bottom-r.height))-i.top+"px",u=Math.min(400,l?d:m)+"px";else{h=!0,u=Math.min(400,(a?i.right:o.right-i.left)-30)+"px";let v=o.bottom-i.bottom;v>=r.height||v>i.top?c=n.bottom-i.top+"px":f=i.bottom-n.top+"px"}return{top:c,bottom:f,maxWidth:u,class:h?a?"left-narrow":"right-narrow":l?"left":"right"}}positionInfo(e){this.info&&(e?(this.info.style.top=e.top,this.info.style.bottom=e.bottom,this.info.style.maxWidth=e.maxWidth,this.info.className="cm-tooltip cm-completionInfo cm-completionInfo-"+e.class):this.info.style.top="-1e6px")}createListBox(e,i,r){let n=document.createElement("ul");n.id=i,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions"));for(let o=r.from;o<r.to;o++){let{completion:a,match:l}=e[o],h=n.appendChild(document.createElement("li"));h.id=i+"-"+o,h.setAttribute("role","option");let u=this.optionClass(a);u&&(h.className=u);for(let c of this.optionContent){let f=c(a,this.view.state,l);f&&h.appendChild(f)}}return r.from&&n.classList.add("cm-completionListIncompleteTop"),r.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}};function jV(t){return e=>new qw(e,t)}function qV(t,e){let i=t.getBoundingClientRect(),r=e.getBoundingClientRect();r.top<i.top?t.scrollTop-=i.top-r.top:r.bottom>i.bottom&&(t.scrollTop+=r.bottom-i.bottom)}function fk(t){return(t.boost||0)*100+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function XV(t,e){let i=[],r=0;for(let l of t)if(l.hasResult())if(l.result.filter===!1){let h=l.result.getMatch;for(let u of l.result.options){let c=[1e9-r++];if(h)for(let f of h(u))c.push(f);i.push(new Gv(u,l,c))}}else{let h=new jw(e.sliceDoc(l.from,l.to)),u;for(let c of l.result.options)(u=h.match(c.label))&&(c.boost!=null&&(u[0]+=c.boost),i.push(new Gv(c,l,u)))}let n=[],o=null,a=e.facet(ls).compareCompletions;for(let l of i.sort((h,u)=>u.match[0]-h.match[0]||a(h.completion,u.completion)))!o||o.label!=l.completion.label||o.detail!=l.completion.detail||o.type!=null&&l.completion.type!=null&&o.type!=l.completion.type||o.apply!=l.completion.apply?n.push(l):fk(l.completion)>fk(o)&&(n[n.length-1]=l),o=l.completion;return n}var ja=class{constructor(e,i,r,n,o,a){this.options=e,this.attrs=i,this.tooltip=r,this.timestamp=n,this.selected=o,this.disabled=a}setSelected(e,i){return e==this.selected||e>=this.options.length?this:new ja(this.options,dk(i,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,i,r,n,o){let a=XV(e,i);if(!a.length)return n&&e.some(h=>h.state==1)?new ja(n.options,n.attrs,n.tooltip,n.timestamp,n.selected,!0):null;let l=i.facet(ls).selectOnOpen?0:-1;if(n&&n.selected!=l&&n.selected!=-1){let h=n.options[n.selected].completion;for(let u=0;u<a.length;u++)if(a[u].completion==h){l=u;break}}return new ja(a,dk(r,l),{pos:e.reduce((h,u)=>u.hasResult()?Math.min(h,u.from):h,1e8),create:jV(as),above:o.aboveCursor},n?n.timestamp:Date.now(),l,!1)}map(e){return new ja(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}},bu=class{constructor(e,i,r){this.active=e,this.id=i,this.open=r}static start(){return new bu(KV,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:i}=e,r=i.facet(ls),o=(r.override||i.languageDataAt("autocomplete",qa(i)).map(WV)).map(l=>(this.active.find(u=>u.source==l)||new Ur(l,this.active.some(u=>u.state!=0)?1:0)).update(e,r));o.length==this.active.length&&o.every((l,h)=>l==this.active[h])&&(o=this.active);let a=this.open;a&&e.docChanged&&(a=a.map(e.changes)),e.selection||o.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!YV(o,this.active)?a=ja.build(o,i,this.id,a,r):a&&a.disabled&&!o.some(l=>l.state==1)&&(a=null),!a&&o.every(l=>l.state!=1)&&o.some(l=>l.hasResult())&&(o=o.map(l=>l.hasResult()?new Ur(l.source,0):l));for(let l of e.effects)l.is(xk)&&(a=a&&a.setSelected(l.value,this.id));return o==this.active&&a==this.open?this:new bu(o,this.id,a)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:ZV}};function YV(t,e){if(t==e)return!0;for(let i=0,r=0;;){for(;i<t.length&&!t[i].hasResult;)i++;for(;r<e.length&&!e[r].hasResult;)r++;let n=i==t.length,o=r==e.length;if(n||o)return n==o;if(t[i++].result!=e[r++].result)return!1}}var ZV={"aria-autocomplete":"list"};function dk(t,e){let i={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":t};return e>-1&&(i["aria-activedescendant"]=t+"-"+e),i}var KV=[];function Xw(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}var Ur=class{constructor(e,i,r=-1){this.source=e,this.state=i,this.explicitPos=r}hasResult(){return!1}update(e,i){let r=Xw(e),n=this;r?n=n.handleUserEvent(e,r,i):e.docChanged?n=n.handleChange(e):e.selection&&n.state!=0&&(n=new Ur(n.source,0));for(let o of e.effects)if(o.is(Zw))n=new Ur(n.source,1,o.value?qa(e.state):-1);else if(o.is(zv))n=new Ur(n.source,0);else if(o.is(yk))for(let a of o.value)a.source==n.source&&(n=a);return n}handleUserEvent(e,i,r){return i=="delete"||!r.activateOnTyping?this.map(e.changes):new Ur(this.source,1)}handleChange(e){return e.changes.touchesRange(qa(e.startState))?new Ur(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new Ur(this.source,this.state,e.mapPos(this.explicitPos))}},ql=class extends Ur{constructor(e,i,r,n,o){super(e,2,i),this.result=r,this.from=n,this.to=o}hasResult(){return!0}handleUserEvent(e,i,r){var n;let o=e.changes.mapPos(this.from),a=e.changes.mapPos(this.to,1),l=qa(e.state);if((this.explicitPos<0?l<=o:l<this.from)||l>a||i=="delete"&&qa(e.startState)==this.from)return new Ur(this.source,i=="input"&&r.activateOnTyping?1:0);let h=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),u;return QV(this.result.validFor,e.state,o,a)?new ql(this.source,h,this.result,o,a):this.result.update&&(u=this.result.update(this.result,o,a,new Uv(e.state,l,h>=0)))?new ql(this.source,h,u,u.from,(n=u.to)!==null&&n!==void 0?n:qa(e.state)):new Ur(this.source,1,h)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new Ur(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new ql(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}};function QV(t,e,i,r){if(!t)return!1;let n=e.sliceDoc(i,r);return typeof t=="function"?t(n,i,r,e):vk(t,!0).test(n)}var Zw=Lt.define(),zv=Lt.define(),yk=Lt.define({map(t,e){return t.map(i=>i.map(e))}}),xk=Lt.define(),as=Ii.define({create(){return bu.start()},update(t,e){return t.update(e)},provide:t=>[Zb.from(t,e=>e.tooltip),qe.contentAttributes.from(t,e=>e.attrs)]});function Nv(t,e="option"){return i=>{let r=i.state.field(as,!1);if(!r||!r.open||r.open.disabled||Date.now()-r.open.timestamp<i.state.facet(ls).interactionDelay)return!1;let n=1,o;e=="page"&&(o=pD(i,r.open.tooltip))&&(n=Math.max(2,Math.floor(o.dom.offsetHeight/o.dom.querySelector("li").offsetHeight)-1));let{length:a}=r.open.options,l=r.open.selected>-1?r.open.selected+n*(t?1:-1):t?0:a-1;return l<0?l=e=="page"?0:a-1:l>=a&&(l=e=="page"?a-1:0),i.dispatch({effects:xk.of(l)}),!0}}var JV=t=>{let e=t.state.field(as,!1);return t.state.readOnly||!e||!e.open||e.open.selected<0||Date.now()-e.open.timestamp<t.state.facet(ls).interactionDelay?!1:(e.open.disabled||_k(t,e.open.options[e.open.selected]),!0)},$V=t=>t.state.field(as,!1)?(t.dispatch({effects:Zw.of(!0)}),!0):!1,ej=t=>{let e=t.state.field(as,!1);return!e||!e.active.some(i=>i.state!=0)?!1:(t.dispatch({effects:zv.of(null)}),!0)},Yw=class{constructor(e,i){this.active=e,this.context=i,this.time=Date.now(),this.updates=[],this.done=void 0}},pk=50,tj=50,ij=1e3,rj=ki.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of t.state.field(as).active)e.state==1&&this.startQuery(e)}update(t){let e=t.state.field(as);if(!t.selectionSet&&!t.docChanged&&t.startState.field(as)==e)return;let i=t.transactions.some(r=>(r.selection||r.docChanged)&&!Xw(r));for(let r=0;r<this.running.length;r++){let n=this.running[r];if(i||n.updates.length+t.transactions.length>tj&&Date.now()-n.time>ij){for(let o of n.context.abortListeners)try{o()}catch(a){Rn(this.view.state,a)}n.context.abortListeners=null,this.running.splice(r--,1)}else n.updates.push(...t.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(r=>r.state==1&&!this.running.some(n=>n.active.source==r.source))?setTimeout(()=>this.startUpdate(),pk):-1,this.composing!=0)for(let r of t.transactions)Xw(r)=="input"?this.composing=2:this.composing==2&&r.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:t}=this.view,e=t.field(as);for(let i of e.active)i.state==1&&!this.running.some(r=>r.active.source==i.source)&&this.startQuery(i)}startQuery(t){let{state:e}=this.view,i=qa(e),r=new Uv(e,i,t.explicitPos==i),n=new Yw(t,r);this.running.push(n),Promise.resolve(t.source(r)).then(o=>{n.context.aborted||(n.done=o||null,this.scheduleAccept())},o=>{this.view.dispatch({effects:zv.of(null)}),Rn(this.view.state,o)})}scheduleAccept(){this.running.every(t=>t.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),pk))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],i=this.view.state.facet(ls);for(let r=0;r<this.running.length;r++){let n=this.running[r];if(n.done===void 0)continue;if(this.running.splice(r--,1),n.done){let a=new ql(n.active.source,n.active.explicitPos,n.done,n.done.from,(t=n.done.to)!==null&&t!==void 0?t:qa(n.updates.length?n.updates[0].startState:this.view.state));for(let l of n.updates)a=a.update(l,i);if(a.hasResult()){e.push(a);continue}}let o=this.view.state.field(as).active.find(a=>a.source==n.active.source);if(o&&o.state==1)if(n.done==null){let a=new Ur(n.active.source,0);for(let l of n.updates)a=a.update(l,i);a.state!=1&&e.push(a)}else this.startQuery(o)}e.length&&this.view.dispatch({effects:yk.of(e)})}},{eventHandlers:{blur(){let t=this.view.state.field(as,!1);t&&t.tooltip&&this.view.state.facet(ls).closeOnBlur&&this.view.dispatch({effects:zv.of(null)})},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Zw.of(!1)}),20),this.composing=0}}}),nj=qe.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:`${400}px`,boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:`${30}px`},".cm-completionInfo.cm-completionInfo-right-narrow":{left:`${30}px`},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});var Df={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},jl=Lt.define({map(t,e){let i=e.mapPos(t,-1,Or.TrackAfter);return i==null?void 0:i}}),Kw=Lt.define({map(t,e){return e.mapPos(t)}}),Qw=new class extends As{};Qw.startSide=1;Qw.endSide=-1;var bk=Ii.define({create(){return zt.empty},update(t,e){if(e.selection){let i=e.state.doc.lineAt(e.selection.main.head).from,r=e.startState.doc.lineAt(e.startState.selection.main.head).from;i!=e.changes.mapPos(r,-1)&&(t=zt.empty)}t=t.map(e.changes);for(let i of e.effects)i.is(jl)?t=t.update({add:[Qw.range(i.value,i.value+1)]}):i.is(Kw)&&(t=t.update({filter:r=>r!=i.value}));return t}});function Hv(){return[oj,bk]}var Vw="()[]{}<>";function wk(t){for(let e=0;e<Vw.length;e+=2)if(Vw.charCodeAt(e)==t)return Vw.charAt(e+1);return ef(t<128?t:t+1)}function Sk(t,e){return t.languageDataAt("closeBrackets",e)[0]||Df}var sj=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),oj=qe.inputHandler.of((t,e,i,r)=>{if((sj?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let n=t.state.selection.main;if(r.length>2||r.length==2&&Dr(ji(r,0))==1||e!=n.from||i!=n.to)return!1;let o=lj(t.state,r);return o?(t.dispatch(o),!0):!1}),aj=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=Sk(t,t.selection.main.head).brackets||Df.brackets,n=null,o=t.changeByRange(a=>{if(a.empty){let l=hj(t.doc,a.head);for(let h of r)if(h==l&&Vv(t.doc,a.head)==wk(ji(h,0)))return{changes:{from:a.head-h.length,to:a.head+h.length},range:ve.cursor(a.head-h.length)}}return{range:n=a}});return n||e(t.update(o,{scrollIntoView:!0,userEvent:"delete.backward"})),!n},Wv=[{key:"Backspace",run:aj}];function lj(t,e){let i=Sk(t,t.selection.main.head),r=i.brackets||Df.brackets;for(let n of r){let o=wk(ji(n,0));if(e==n)return o==n?fj(t,n,r.indexOf(n+n+n)>-1,i):uj(t,n,o,i.before||Df.before);if(e==o&&Ck(t,t.selection.main.from))return cj(t,n,o)}return null}function Ck(t,e){let i=!1;return t.field(bk).between(0,t.doc.length,r=>{r==e&&(i=!0)}),i}function Vv(t,e){let i=t.sliceString(e,e+2);return i.slice(0,Dr(ji(i,0)))}function hj(t,e){let i=t.sliceString(e-2,e);return Dr(ji(i,0))==i.length?i:i.slice(1)}function uj(t,e,i,r){let n=null,o=t.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:i,from:a.to}],effects:jl.of(a.to+e.length),range:ve.range(a.anchor+e.length,a.head+e.length)};let l=Vv(t.doc,a.head);return!l||/\s/.test(l)||r.indexOf(l)>-1?{changes:{insert:e+i,from:a.head},effects:jl.of(a.head+e.length),range:ve.cursor(a.head+e.length)}:{range:n=a}});return n?null:t.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function cj(t,e,i){let r=null,n=t.selection.ranges.map(o=>o.empty&&Vv(t.doc,o.head)==i?ve.cursor(o.head+i.length):r=o);return r?null:t.update({selection:ve.create(n,t.selection.mainIndex),scrollIntoView:!0,effects:t.selection.ranges.map(({from:o})=>Kw.of(o))})}function fj(t,e,i,r){let n=r.stringPrefixes||Df.stringPrefixes,o=null,a=t.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:e,from:l.to}],effects:jl.of(l.to+e.length),range:ve.range(l.anchor+e.length,l.head+e.length)};let h=l.head,u=Vv(t.doc,h),c;if(u==e){if(mk(t,h))return{changes:{insert:e+e,from:h},effects:jl.of(h+e.length),range:ve.cursor(h+e.length)};if(Ck(t,h)){let f=i&&t.sliceDoc(h,h+e.length*3)==e+e+e;return{range:ve.cursor(h+e.length*(f?3:1)),effects:Kw.of(h)}}}else{if(i&&t.sliceDoc(h-2*e.length,h)==e+e&&(c=gk(t,h-2*e.length,n))>-1&&mk(t,c))return{changes:{insert:e+e+e+e,from:h},effects:jl.of(h+e.length),range:ve.cursor(h+e.length)};if(t.charCategorizer(h)(u)!=Jt.Word&&gk(t,h,n)>-1&&!dj(t,h,e,n))return{changes:{insert:e+e,from:h},effects:jl.of(h+e.length),range:ve.cursor(h+e.length)}}return{range:o=l}});return o?null:t.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function mk(t,e){let i=fr(t).resolveInner(e+1);return i.parent&&i.from==e}function dj(t,e,i,r){let n=fr(t).resolveInner(e,-1),o=r.reduce((a,l)=>Math.max(a,l.length),0);for(let a=0;a<5;a++){let l=t.sliceDoc(n.from,Math.min(n.to,n.from+i.length+o)),h=l.indexOf(i);if(!h||h>-1&&r.indexOf(l.slice(0,h))>-1){let c=n.firstChild;for(;c&&c.from==n.from&&c.to-c.from>i.length+h;){if(t.sliceDoc(c.to-i.length,c.to)==i)return!1;c=c.firstChild}return!0}let u=n.to==e&&n.parent;if(!u)break;n=u}return!1}function gk(t,e,i){let r=t.charCategorizer(e);if(r(t.sliceDoc(e-1,e))!=Jt.Word)return e;for(let n of i){let o=e-n.length;if(t.sliceDoc(o,e)==n&&r(t.sliceDoc(o-1,o))!=Jt.Word)return o}return-1}function jv(t={}){return[as,ls.of(t),rj,pj,nj]}var kf=[{key:"Ctrl-Space",run:$V},{key:"Escape",run:ej},{key:"ArrowDown",run:Nv(!0)},{key:"ArrowUp",run:Nv(!1)},{key:"PageDown",run:Nv(!0,"page")},{key:"PageUp",run:Nv(!1,"page")},{key:"Enter",run:JV}],pj=lo.highest(Ul.computeN([ls],t=>t.facet(ls).defaultKeymap?[kf]:[]));function qv(t){let e=t.firstChild,i=t.lastChild,r=e;for(;e.type.name!=="EndLine"&&e.nextSibling;)r=e,e=e.nextSibling;return r&&i&&r.to<i.from?{from:r.to,to:i&&i.type.isError?t.to:i.from}:null}function Xv(t,e){let i=t.lineIndent(e.from),r=t.lineAt(t.pos,-1),n=r.from+r.text.length;return!/\S/.test(r.text)&&t.node.to<n+100&&!/\S/.test(t.state.sliceDoc(n,t.node.to))&&t.lineIndent(t.pos,-1)<=i?null:i+t.unit}var Ek=Jo.define({parser:Mk.parser.configure({props:[fw.add({If:t=>{var e;return(e=Xv(t,t.node))!=null?e:t.continue()},While:t=>{var e;return(e=Xv(t,t.node))!=null?e:t.continue()},Function:t=>{var e;return(e=Xv(t,t.node))!=null?e:t.continue()},Dialog:t=>{var e;return(e=Xv(t,t.node))!=null?e:t.continue()}}),dw.add({If:qv,While:qv,Function:qv,Dialog:qv,computedExpressionBlock:DD}),cu({Varname:ee.variableName,Function:ee.modifier,Scope:ee.self,GCodeCode:ee.processingInstruction,GCodeCodeLetter:ee.processingInstruction,NonGCodeFunction:ee.processingInstruction,GCodeIdentifier:ee.variableName,GCodeChar:ee.variableName,Operator:ee.variableName,SimpleOperator:ee.variableName,String:ee.string,ServerParamTextNoDQuote:ee.string,ServerParamTextNoSQuote:ee.string,ServerParamTextNoSpace:ee.attributeName,DQuote:ee.string,SQuote:ee.string,LineComment:ee.lineComment,LineError:ee.annotation,GeneralServerCommand:ee.keyword,StartWhile:ee.keyword,EndWhile:ee.keyword,StartIf:ee.keyword,EndIf:ee.keyword,StartFunction:ee.keyword,EndFunction:ee.keyword,StartDialog:ee.keyword,EndDialog:ee.keyword,SCSet:ee.keyword,SCUnset:ee.keyword,SCCall:ee.keyword,SCDialogInput:ee.keyword,SCReportVariables:ee.keyword,SCDialogInputCheckbox:ee.keyword,SCDialogInputDropdown:ee.keyword,SCCallAndSave:ee.keyword,SCMonitorCall:ee.keyword,SCTimedCall:ee.keyword,SCNoParam:ee.keyword,SC1Param:ee.keyword,SC2Params:ee.keyword,SCCall1:ee.keyword,Number:ee.number,NumberParam:ee.number,OneToOne:ee.blockComment,CExpressionStart:ee.brace,CExpressionEnd:ee.brace,ParenOpen:ee.paren,ParenClose:ee.paren,"( )":ee.paren,"{ }":ee.brace,"[ ]":ee.squareBracket})]}),languageData:{commentTokens:{line:";"}}});function Mt(t,e,i,r){let n=i+e.label.length+1;t.dispatch(t.state.update({changes:{from:i,to:r,insert:e.label+"()"},selection:ve.create([ve.range(n,n)],0)}))}var mj=Ek.data.of({autocomplete:If([{label:"local",type:"scope"},{label:"deeplocal",type:"scope"},{label:"global",type:"scope"},{label:"sglobal",type:"scope"},{label:"perm",type:"scope"},{label:"gperm",type:"scope"},{label:"form",type:"scope"},{label:"job",type:"scope"},{label:"config",type:"scope"},{label:"transfer",type:"scope"},{label:"state",type:"scope"},{label:"const",type:"scope"},{label:"ext_0",type:"scope"},{label:"ext_1",type:"scope"},{label:"ext_2",type:"scope"},{label:"ext_3",type:"scope"},{label:"ext_4",type:"scope"},{label:"ext_5",type:"scope"},{label:"bed_0",type:"scope"},{label:"chamber_0",type:"scope"},{label:"duet_global",type:"scope"},{label:"@echo",type:"keyword",detail:"message..."},{label:"@pause",type:"keyword"},{label:"@pauseNoCooldown",type:"keyword"},{label:"@pauseExtruderCooldown",type:"keyword"},{label:"@pauseFullCooldown",type:"keyword"},{label:"@outOfFilament",type:"keyword"},{label:"@continue",type:"keyword"},{label:"@continueReheat",type:"keyword"},{label:"@stopPrint",type:"keyword"},{label:"@powerloss",type:"keyword"},{label:"@message",type:"keyword",detail:"text"},{label:"@pushmessage",type:"keyword",detail:"text"},{label:"@execute",type:"keyword",detail:"function [params..]"},{label:"@quickCommand",type:"keyword",detail:"command"},{label:"@wizardCommand",type:"keyword",detail:"command"},{label:"@runButtonCommand",type:"keyword",detail:"command"},{label:"@isathome",type:"keyword"},{label:"@kill",type:"keyword"},{label:"@waitForAllTemperatures",type:"keyword",detail:"maxDiff"},{label:"@cancelWaitForTemperatures",type:"keyword"},{label:"@event",type:"keyword"},{label:"@makeSnapshot",type:"keyword",detail:"webcamId"},{label:"@getip",type:"keyword"},{label:"@skip",type:"keyword",detail:"count"},{label:"@adderror",type:"keyword"},{label:"@autostartNextJob",type:"keyword"},{label:"@startNextPrintInQueue",type:"keyword"},{label:"@stopNextAutostart",type:"keyword"},{label:"@debugCon",type:"keyword"},{label:"@serverInfo",type:"keyword"},{label:"@printLastPrint",type:"keyword",detail:"[position]"},{label:"@queueLastPrint",type:"keyword",detail:"[position]"},{label:"@explainCom",type:"keyword"},{label:"@syncMotion",type:"keyword"},{label:"@webAction",type:"keyword",detail:"action [params..]"},{label:"@nosize",type:"keyword"},{label:"@size",type:"keyword"},{label:"@extruderColor",type:"keyword",detail:'extruderId "#RRGGBB"'},{label:"@info",type:"keyword",detail:"text"},{label:"@warning",type:"keyword",detail:"text"},{label:"@error",type:"keyword",detail:"text"},{label:"@dialogStart",type:"keyword",apply:(t,e,i,r)=>{let n=t.state.doc.lineAt(i),o=i-n.from,a=" ".repeat(o);t.dispatch(t.state.update({changes:{from:i,to:r,insert:`@dialogStart "" ""
${a}@dialogShow
`},selection:ve.create([ve.range(i+14,i+14)],0)}))}},{label:"@dialogIcon",type:"keyword",detail:"svgCode"},{label:"@dialogNoButtons",type:"keyword"},{label:"@dialogBlocking",type:"keyword"},{label:"@dialogBlockingJob",type:"keyword"},{label:"@dialogInputInt",type:"keyword",detail:'"Caption" [scope.]var [options...]'},{label:"@dialogInputDouble",type:"keyword",detail:'"Caption" [scope.]var [options...]'},{label:"@dialogInputString",type:"keyword",detail:'"Caption" [scope.]var [options...]'},{label:"@dialogInputDropdown",type:"keyword",detail:'"Caption" [scope.]var list [options...]'},{label:"@dialogInputCheckbox",type:"keyword",detail:'"Caption" "text" [scope.]var [options...]'},{label:"@dialogLabel",type:"keyword",detail:'"Text" [options...]'},{label:"@dialogButton",type:"keyword",detail:"text [codeWhenHit]"},{label:"@dialogShow",type:"keyword",detail:"[scope.var]"},{label:"@dialogHide",type:"keyword",detail:"id"},{label:"@dialogHideAll",type:"keyword"},{label:"@reportTimer",type:"keyword",detail:"[message]"},{label:"@setTimer",type:"keyword",detail:"value"},{label:"@waitForTimer",type:"keyword",detail:"value"},{label:"@reloadLua",type:"keyword"},{label:"@set",type:"keyword",detail:"scope.name value"},{label:"@unset",type:"keyword",detail:"scope.name"},{label:"@triggerRescue",type:"keyword"},{label:"@if",type:"keyword",apply:(t,e,i,r)=>{let n=t.state.doc.lineAt(i),o=i-n.from,a=" ".repeat(o);t.dispatch(t.state.update({changes:{from:i,to:r,insert:`@if {{condition}}
${a}@endif
`},selection:ve.create([ve.range(i+6,i+15)],0)}))},detail:"condition"},{label:"@else",type:"keyword"},{label:"@endif",type:"keyword"},{label:"@ifTimerBelow",type:"keyword",detail:"value"},{label:"@ifPaused",type:"keyword"},{label:"@resetStack",type:"keyword"},{label:"@reportStack",type:"keyword"},{label:"@reportVariables",type:"keyword",detail:"[scope]"},{label:"@func",type:"keyword",apply:(t,e,i,r)=>{let n=t.state.doc.lineAt(i),o=i-n.from,a=" ".repeat(o);console.log("create",e,i,r),t.dispatch(t.state.update({changes:{from:i,to:r,insert:`@func name
${a}@endfunc
`},selection:ve.create([ve.range(i+6,i+10)],0)}))},detail:"name [params ...]"},{label:"@endfunc",type:"keyword"},{label:"@return",type:"keyword",detail:"[value]"},{label:"@call",type:"keyword",detail:"function [params ...]"},{label:"@callAndSave",type:"keyword",detail:"function scope.var [params ...]"},{label:"@monitorCall",type:"keyword",detail:'name "expression" timeoutMS hitFunction missFunction'},{label:"@deleteMonitorCall",type:"keyword",detail:"name"},{label:"@callOnEvent",type:"keyword",detail:"event function"},{label:"@removeCallOnEvent",type:"keyword",detail:"event function"},{label:"@reportCallOnEvents",type:"keyword"},{label:"@moveRel",type:"keyword",detail:"[X] [Y] [Z] [E] [F]"},{label:"@moveAbs",type:"keyword",detail:"[X] [Y] [Z] [E] [F]"},{label:"@listMonitorCalls",type:"keyword"},{label:"@timedCall",type:"keyword"},{label:"@printModelById",type:"keyword",detail:"ID"},{label:"@printModelByName",type:"keyword",detail:"name"},{label:"@deleteTimedCall",type:"keyword"},{label:"@addDefaultWizard",type:"keyword",detail:"name [override]"},{label:"@listDefaultWizards",type:"keyword"},{label:"@screenshot",type:"keyword",detail:"webcamId"},{label:"@screenshotForced",type:"keyword",detail:"webcamId"},{label:"@meatpackStatus",type:"keyword"},{label:"@meatpackResetUsage",type:"keyword"},{label:"@while",type:"keyword",apply:(t,e,i,r)=>{let n=t.state.doc.lineAt(i),o=i-n.from,a=" ".repeat(o);t.dispatch(t.state.update({changes:{from:i,to:r,insert:`@while {{condition}}
${a}@endwhile
`},selection:ve.create([ve.range(i+9,i+18)],0)}))},detail:"condition"},{label:"@endwhile",type:"keyword"},{label:"fixed",type:"function",apply:Mt,detail:"(value, digits):string"},{label:"ifelse",type:"function",apply:Mt,detail:"(condition, trueValue, falseValue):number"},{label:"min",type:"function",apply:Mt,detail:"(val1, val2, ...):number"},{label:"max",type:"function",apply:Mt,detail:"(val1, val2, ...):number"},{label:"int",type:"function",apply:Mt,detail:"(value):int"},{label:"float",type:"function",apply:Mt,detail:"(value):number"},{label:"string",type:"function",apply:Mt,detail:"(value):string"},{label:"mod",type:"function",apply:Mt,detail:"(value, modulus):int"},{label:"floor",type:"function",apply:Mt,detail:"(value):number"},{label:"ceil",type:"function",apply:Mt,detail:"(value):number"},{label:"round",type:"function",apply:Mt,detail:"(value):number"},{label:"not",type:"function",apply:Mt,detail:"(value):bool"},{label:"get",type:"function",apply:Mt,detail:"('scope','name'[, default]):any"},{label:"defined",type:"function",apply:Mt,detail:"('scope','name'):bool"},{label:"undefined",type:"function",apply:Mt,detail:"undefined('scope','name'):bool"},{label:"random",type:"function",apply:Mt,detail:"(maxValue):number"},{label:"time",type:"function",apply:Mt,detail:"():number"},{label:"sqrt",type:"function",apply:Mt,detail:"(value):number"},{label:"pow",type:"function",apply:Mt,detail:"(value, power):number"},{label:"exp",type:"function",apply:Mt,detail:"(value):number"},{label:"log",type:"function",apply:Mt,detail:"(value):number"},{label:"log10",type:"function",apply:Mt,detail:"(value):number"},{label:"to_deg",type:"function",apply:Mt,detail:"(rad):number"},{label:"to_rad",type:"function",apply:Mt,detail:"(degree):number"},{label:"sin",type:"function",apply:Mt,detail:"(rad):number"},{label:"cos",type:"function",apply:Mt,detail:"(rad):number"},{label:"tan",type:"function",apply:Mt,detail:"(rad):number"},{label:"asin",type:"function",apply:Mt,detail:"(value):number"},{label:"acos",type:"function",apply:Mt,detail:"(value):number"},{label:"atan",type:"function",apply:Mt,detail:"(value):number"},{label:"atan2",type:"function",apply:Mt,detail:"(value):number"},{label:"escape",type:"function",apply:Mt,detail:"(text):string"},{label:"length",type:"function",apply:Mt,detail:"(text):int"},{label:"substr",type:"function",apply:Mt,detail:"(text, start, len):string"},{label:"duet_get_model",type:"function",apply:Mt,detail:"(pointer_string [,default_value]):json"},{label:"get_json",type:"function",apply:Mt,detail:"(json_string, pointer_string [,default_value]):json"},{label:"get_json_array_size",type:"function",apply:Mt,detail:"(json_string, pointer_string):int"},{label:"set_json_string",type:"function",apply:Mt,detail:"(json_string, pointer_string,value]):json"},{label:"set_json_int",type:"function",apply:Mt,detail:"(json_string, pointer_string,value]):json"},{label:"set_json_double",type:"function",apply:Mt,detail:"(json_string, pointer_string,value]):json"},{label:"set_json_bool",type:"function",apply:Mt,detail:"(json_string, pointer_string,value]):json"},{label:"http_get",type:"function",apply:Mt,detail:"(url):json"},{label:"http_post",type:"function",apply:Mt,detail:"(url, json_object_data):json"},{label:"http_post_json",type:"function",apply:Mt,detail:"(url, json_object_data):json"},{label:"url_escape",type:"function",apply:Mt,deatil:"(text):string"}])});function Tk(){return new du(Ek,[mj])}var Ik=Qi(Dk());var kk=Jo.define({parser:Ik.parser.configure({props:[cu({ConfigOption:ee.modifier,Comment:ee.lineComment,Section:ee.keyword,Special:ee.brace,GCodeLine:ee.string})]}),languageData:{commentTokens:{line:"#"}}});function dt(t,e,i,r){let n=i+e.label.length+1;t.state.sliceDoc(r,r+1)==="]"&&r++,t.dispatch(t.state.update({changes:{from:i,to:r,insert:e.label+`
`},selection:ve.create([ve.range(n,n)],0)}))}function kt(t,e,i,r){let n=e.label.substr(0,e.label.length-1)+` name]
`,o=i+n.length-6;t.state.sliceDoc(r,r+1)==="]"&&r++,t.dispatch(t.state.update({changes:{from:i,to:r,insert:n},selection:ve.create([ve.range(o,o+4)],0)}))}var Mj=kk.data.of({autocomplete:If([{label:"[mcu]",type:"section",apply:dt},{label:"[printer]",type:"section",apply:dt},{label:"[stepper_x]",type:"section",apply:dt},{label:"[stepper_y]",type:"section",apply:dt},{label:"[stepper_z]",type:"section",apply:dt},{label:"[extruder]",type:"section",apply:dt},{label:"[stepper_a]",type:"section",apply:dt},{label:"[stepper_b]",type:"section",apply:dt},{label:"[stepper_c]",type:"section",apply:dt},{label:"[delta_calibrate]",type:"section",apply:dt},{label:"[heater_bed]",type:"section",apply:dt},{label:"[bed_mesh]",type:"section",apply:dt},{label:"[bed_tilt]",type:"section",apply:dt},{label:"[bed_screws]",type:"section",apply:dt},{label:"[screws_tilt_adjust]",type:"section",apply:dt},{label:"[z_tilt]",type:"section",apply:dt},{label:"[quad_gantry_level]",type:"section",apply:dt},{label:"[skew_correction]",type:"section",apply:dt},{label:"[safe_z_home]",type:"section",apply:dt},{label:"[homing_override]",type:"section",apply:dt},{label:"[endstop_phase]",type:"section",apply:kt},{label:"[gcode_macro]",type:"section",apply:kt},{label:"[delayed_gcode]",type:"section",apply:kt},{label:"[save_variables]",type:"section",apply:dt},{label:"[idle_timeout]",type:"section",apply:dt},{label:"[virtual_sdcard]",type:"section",apply:dt},{label:"[sdcard_loop]",type:"section",apply:dt},{label:"[force_move]",type:"section",apply:dt},{label:"[pause_resume]",type:"section",apply:dt},{label:"[firmware_retraction]",type:"section",apply:dt},{label:"[gcode_arcs]",type:"section",apply:dt},{label:"[respond]",type:"section",apply:dt},{label:"[input_shaper]",type:"section",apply:dt},{label:"[adxl345]",type:"section",apply:dt},{label:"[resonance_tester]",type:"section",apply:dt},{label:"[board_pins]",type:"section",apply:kt},{label:"[include]",type:"section",apply:kt},{label:"[duplicate_pin_override]",type:"section",apply:dt},{label:"[probe]",type:"section",apply:dt},{label:"[bltouch]",type:"section",apply:dt},{label:"[stepper_z1]",type:"section",apply:dt},{label:"[stepper_z2]",type:"section",apply:dt},{label:"[stepper_z3]",type:"section",apply:dt},{label:"[extruder1]",type:"section",apply:dt},{label:"[extruder2]",type:"section",apply:dt},{label:"[extruder3]",type:"section",apply:dt},{label:"[extruder4]",type:"section",apply:dt},{label:"[dual_carriage]",type:"section",apply:dt},{label:"[extruder_stepper]",type:"section",apply:kt},{label:"[manual_stepper]",type:"section",apply:kt},{label:"[verify_heater]",type:"section",apply:kt},{label:"[homing_heaters]",type:"section",apply:dt},{label:"[thermistor]",type:"section",apply:kt},{label:"[adc_temperature]",type:"section",apply:kt},{label:"[heater_generic]",type:"section",apply:kt},{label:"[temperature_sensor]",type:"section",apply:kt},{label:"[fan]",type:"section",apply:dt},{label:"[heater_fan]",type:"section",apply:kt},{label:"[controller_fan]",type:"section",apply:kt},{label:"[temperature_fan]",type:"section",apply:kt},{label:"[fan_generic]",type:"section",apply:kt},{label:"[servo]",type:"section",apply:kt},{label:"[neopixel]",type:"section",apply:kt},{label:"[dotstar]",type:"section",apply:kt},{label:"[PCA9533]",type:"section",apply:kt},{label:"[gcode_button]",type:"section",apply:kt},{label:"[output_pin]",type:"section",apply:kt},{label:"[static_digital_output]",type:"section",apply:kt},{label:"[multi_pin]",type:"section",apply:kt},{label:"[tmc2130]",type:"section",apply:kt},{label:"[tmc2208]",type:"section",apply:kt},{label:"[tmc2209]",type:"section",apply:kt},{label:"[tmc2660]",type:"section",apply:kt},{label:"[tmc5160]",type:"section",apply:kt},{label:"[ad5206]",type:"section",apply:kt},{label:"[mcp4451]",type:"section",apply:kt},{label:"[mcp4728]",type:"section",apply:kt},{label:"[mcp4018]",type:"section",apply:kt},{label:"[display]",type:"section",apply:dt},{label:"[display_data]",type:"section",apply:dt},{label:"[display_template]",type:"section",apply:dt},{label:"[display_glyph]",type:"section",apply:dt},{label:"[menu]",type:"section",apply:kt},{label:"[filament_switch_sensor]",type:"section",apply:kt},{label:"[filament_motion_sensor]",type:"section",apply:kt},{label:"[tsl1401cl_filament_width_sensor]",type:"section",apply:dt},{label:"[hall_filament_width_sensor]",type:"section",apply:dt},{label:"[sx1509]",type:"section",apply:kt},{label:"[samd_sercom]",type:"section",apply:kt},{label:"[adc_scaled]",type:"section",apply:kt},{label:"[replicape]",type:"section",apply:dt},{label:"[palette2]",type:"section",apply:dt},{label:"cartesian",type:"value"},{label:"delta",type:"value"},{label:"corexy",type:"value"},{label:"corexz",type:"value"},{label:"hybrid_corexy",type:"value"},{label:"hybrid_corexz",type:"value"},{label:"polar",type:"value"},{label:"rotary_delta",type:"value"},{label:"winch",type:"value"},{label:"none",type:"value"},{label:"lagrange",type:"value"},{label:"bicubic",type:"value"},{label:"False",type:"value"},{label:"True",type:"value"},{label:"average",type:"value"},{label:"median",type:"value"},{label:"a0_pin: ",type:"option"},{label:"accel_chip: ",type:"option"},{label:"accel_chip_x: ",type:"option"},{label:"accel_chip_y: ",type:"option"},{label:"accel_per_hz: ",type:"option"},{label:"activate_gcode: ",type:"option"},{label:"adc1: ",type:"option"},{label:"adc2: ",type:"option"},{label:"adc_voltage: ",type:"option"},{label:"algorithm: ",type:"option"},{label:"aliases: ",type:"option"},{label:"aliases_",type:"option"},{label:"analog_pullup_resistor: ",type:"option"},{label:"analog_range: ",type:"option"},{label:"analog_range_back_pin: ",type:"option"},{label:"analog_range_click_pin: ",type:"option"},{label:"analog_range_down_pin: ",type:"option"},{label:"analog_range_kill_pin: ",type:"option"},{label:"analog_range_up_pin: ",type:"option"},{label:"anchor_x: ",type:"option"},{label:"anchor_y: ",type:"option"},{label:"anchor_z: ",type:"option"},{label:"angle: ",type:"option"},{label:"arm_length: ",type:"option"},{label:"auto_cancel_variation: ",type:"option"},{label:"auto_load_speed: ",type:"option"},{label:"axes: ",type:"option"},{label:"axes_map: ",type:"option"},{label:"back_pin: ",type:"option"},{label:"baud: ",type:"option"},{label:"beta: ",type:"option"},{label:"bicubic_tension: ",type:"option"},{label:"cal_dia1: ",type:"option"},{label:"cal_dia2: ",type:"option"},{label:"canbus_interface: ",type:"option"},{label:"canbus_uuid: ",type:"option"},{label:"chain_count: ",type:"option"},{label:"chain_length: ",type:"option"},{label:"channel_",type:"option"},{label:"check_gain_time: ",type:"option"},{label:"click_pin: ",type:"option"},{label:"clock_pin: ",type:"option"},{label:"color_order: ",type:"option"},{label:"contrast: ",type:"option"},{label:"control: ",type:"option"},{label:"control_pin: ",type:"option"},{label:"cs_pin: ",type:"option"},{label:"cycle_time: ",type:"option"},{label:"d4_pin: ",type:"option"},{label:"d5_pin: ",type:"option"},{label:"d6_pin: ",type:"option"},{label:"d7_pin: ",type:"option"},{label:"damping_ratio_x: ",type:"option"},{label:"damping_ratio_y: ",type:"option"},{label:"data_pin: ",type:"option"},{label:"deactivate_gcode: ",type:"option"},{label:"deactivate_on_each_sample: ",type:"option"},{label:"default_nominal_filament_diameter: ",type:"option"},{label:"default_prefix: ",type:"option"},{label:"default_type: ",type:"option"},{label:"delta_radius: ",type:"option"},{label:"description: ",type:"option"},{label:"detection_length: ",type:"option"},{label:"diag0_pin: ",type:"option"},{label:"diag1_pin: ",type:"option"},{label:"diag_pin: ",type:"option"},{label:"dir_pin: ",type:"option"},{label:"display_group: ",type:"option"},{label:"down_pin: ",type:"option"},{label:"driver_CHM: ",type:"option"},{label:"driver_DISS2G: ",type:"option"},{label:"driver_DISS2VS: ",type:"option"},{label:"driver_FD3: ",type:"option"},{label:"driver_FREEWHEEL: ",type:"option"},{label:"driver_HDEC: ",type:"option"},{label:"driver_HEND: ",type:"option"},{label:"driver_HSTRT: ",type:"option"},{label:"driver_IHOLDDELAY: ",type:"option"},{label:"driver_PWM_AMPL: ",type:"option"},{label:"driver_PWM_AUTOGRAD: ",type:"option"},{label:"driver_PWM_AUTOSCALE: ",type:"option"},{label:"driver_PWM_FREQ: ",type:"option"},{label:"driver_PWM_GRAD: ",type:"option"},{label:"driver_PWM_LIM: ",type:"option"},{label:"driver_PWM_OFS: ",type:"option"},{label:"driver_PWM_REG: ",type:"option"},{label:"driver_RNDTF: ",type:"option"},{label:"driver_SEIMIN: ",type:"option"},{label:"driver_SEMAX: ",type:"option"},{label:"driver_SEMIN: ",type:"option"},{label:"driver_SEUP: ",type:"option"},{label:"driver_SFILT: ",type:"option"},{label:"driver_SGT: ",type:"option"},{label:"driver_SGT: ",type:"option"},{label:"driver_SGTHRS: ",type:"option"},{label:"driver_SLPH: ",type:"option"},{label:"driver_SLPL: ",type:"option"},{label:"driver_TBL: ",type:"option"},{label:"driver_TOFF: ",type:"option"},{label:"driver_TPFD: ",type:"option"},{label:"driver_TPOWERDOWN: ",type:"option"},{label:"driver_TS2G: ",type:"option"},{label:"driver_VHIGHCHM: ",type:"option"},{label:"driver_VHIGHFS: ",type:"option"},{label:"ds18_report_time: ",type:"option"},{label:"e_pin: ",type:"option"},{label:"enable: ",type:"option"},{label:"enable_force_move: ",type:"option"},{label:"enable_pin: ",type:"option"},{label:"encoder_pins: ",type:"option"},{label:"endstop_accuracy: ",type:"option"},{label:"endstop_align_zero: ",type:"option"},{label:"endstop_pin: ",type:"option"},{label:"event_delay: ",type:"option"},{label:"extruder: ",type:"option"},{label:"fade_end: ",type:"option"},{label:"fade_start: ",type:"option"},{label:"fade_target: ",type:"option"},{label:"faulty_region_1_max: ",type:"option"},{label:"faulty_region_1_min: ",type:"option"},{label:"feedrate_normal: ",type:"option"},{label:"feedrate_splice: ",type:"option"},{label:"filename: ",type:"option"},{label:"full_steps_per_rotation: ",type:"option"},{label:"gantry_corners: ",type:"option"},{label:"gcode: ",type:"option"},{label:"gcode_id: ",type:"option"},{label:"gear_ratio: ",type:"option"},{label:"hardware_pwm: ",type:"option"},{label:"hd44780_protocol_init: ",type:"option"},{label:"heater_pin: ",type:"option"},{label:"heaters: ",type:"option"},{label:"heating_gain: ",type:"option"},{label:"hold_current: ",type:"option"},{label:"home_xy_position: ",type:"option"},{label:"homing_positive_dir: ",type:"option"},{label:"homing_retract_dist: ",type:"option"},{label:"homing_retract_speed: ",type:"option"},{label:"homing_speed: ",type:"option"},{label:"horizontal_move_z: ",type:"option"},{label:"host_mcu: ",type:"option"},{label:"htu21d_hold_master: ",type:"option"},{label:"htu21d_report_time: ",type:"option"},{label:"htu21d_resolution: ",type:"option"},{label:"hysteresis: ",type:"option"},{label:"hz_per_sec: ",type:"option"},{label:"i2c_address: ",type:"option"},{label:"i2c_bus: ",type:"option"},{label:"i2c_mcu: ",type:"option"},{label:"i2c_speed: ",type:"option"},{label:"idle_current_percent: ",type:"option"},{label:"idle_speed: ",type:"option"},{label:"idle_timeout: ",type:"option"},{label:"initial_BLUE: ",type:"option"},{label:"initial_GREEN: ",type:"option"},{label:"initial_RED: ",type:"option"},{label:"initial_WHITE: ",type:"option"},{label:"initial_angle: ",type:"option"},{label:"initial_duration: ",type:"option"},{label:"initial_pulse_width: ",type:"option"},{label:"inline_resistor: ",type:"option"},{label:"input: ",type:"option"},{label:"input_max: ",type:"option"},{label:"input_min: ",type:"option"},{label:"input_step: ",type:"option"},{label:"insert_gcode: ",type:"option"},{label:"instantaneous_corner_velocity: ",type:"option"},{label:"interpolate: ",type:"option"},{label:"invert: ",type:"option"},{label:"kick_start_time: ",type:"option"},{label:"kill_pin: ",type:"option"},{label:"kinematics: ",type:"option"},{label:"lcd_type: ",type:"option"},{label:"lift_speed: ",type:"option"},{label:"line_length: ",type:"option"},{label:"lm75_report_time: ",type:"option"},{label:"logging: ",type:"option"},{label:"lower_arm_length: ",type:"option"},{label:"max_accel: ",type:"option"},{label:"max_accel_to_decel: ",type:"option"},{label:"max_adjust: ",type:"option"},{label:"max_delta: ",type:"option"},{label:"max_difference: ",type:"option"},{label:"max_error: ",type:"option"},{label:"max_extrude_cross_section: ",type:"option"},{label:"max_extrude_only_accel: ",type:"option"},{label:"max_extrude_only_distance: ",type:"option"},{label:"max_extrude_only_velocity: ",type:"option"},{label:"max_freq: ",type:"option"},{label:"max_power: ",type:"option"},{label:"max_smoothing: ",type:"option"},{label:"max_temp: ",type:"option"},{label:"max_velocity: ",type:"option"},{label:"max_z_accel: ",type:"option"},{label:"max_z_velocity: ",type:"option"},{label:"maximum_mcu_duration: ",type:"option"},{label:"maximum_pulse_width: ",type:"option"},{label:"maximum_servo_angle: ",type:"option"},{label:"measurement_delay: ",type:"option"},{label:"measurement_interval: ",type:"option"},{label:"menu_reverse_navigation: ",type:"option"},{label:"menu_root: ",type:"option"},{label:"menu_timeout: ",type:"option"},{label:"mesh_max: ",type:"option"},{label:"mesh_min: ",type:"option"},{label:"mesh_origin: ",type:"option"},{label:"mesh_pps: ",type:"option"},{label:"mesh_radius: ",type:"option"},{label:"microsteps: ",type:"option"},{label:"min_diameter: ",type:"option"},{label:"min_extrude_temp: ",type:"option"},{label:"min_freq: ",type:"option"},{label:"min_temp: ",type:"option"},{label:"minimum_pulse_width: ",type:"option"},{label:"move_check_distance: ",type:"option"},{label:"move_to_previous: ",type:"option"},{label:"name: ",type:"option"},{label:"nozzle_diameter: ",type:"option"},{label:"off_below: ",type:"option"},{label:"param_",type:"option"},{label:"path: ",type:"option"},{label:"pause_delay: ",type:"option"},{label:"pause_on_runout: ",type:"option"},{label:"pid_Kd: ",type:"option"},{label:"pid_Ki: ",type:"option"},{label:"pid_Kp: ",type:"option"},{label:"pin: ",type:"option"},{label:"pin_move_time: ",type:"option"},{label:"pin_up_reports_not_triggered: ",type:"option"},{label:"pin_up_touch_mode_reports_triggered: ",type:"option"},{label:"pins: ",type:"option"},{label:"points: ",type:"option"},{label:"position: ",type:"option"},{label:"position_endstop: ",type:"option"},{label:"position_max: ",type:"option"},{label:"position_min: ",type:"option"},{label:"press_gcode: ",type:"option"},{label:"pressure_advance: ",type:"option"},{label:"pressure_advance_smooth_time: ",type:"option"},{label:"print_radius: ",type:"option"},{label:"probe_count: ",type:"option"},{label:"probe_points: ",type:"option"},{label:"probe_with_touch_mode: ",type:"option"},{label:"pullup_resistor: ",type:"option"},{label:"pwm: ",type:"option"},{label:"pwm_cycle_time: ",type:"option"},{label:"rate: ",type:"option"},{label:"raw_dia1: ",type:"option"},{label:"raw_dia2: ",type:"option"},{label:"realtime: ",type:"option"},{label:"recover_velocity: ",type:"option"},{label:"relative_reference_index: ",type:"option"},{label:"release_gcode: ",type:"option"},{label:"rename_existing: ",type:"option"},{label:"resistance",type:"option"},{label:"resolution: ",type:"option"},{label:"restart_method: ",type:"option"},{label:"retract_length: ",type:"option"},{label:"retract_speed: ",type:"option"},{label:"retries: ",type:"option"},{label:"retry_tolerance: ",type:"option"},{label:"revision: ",type:"option"},{label:"rotation_distance: ",type:"option"},{label:"round_probe_count: ",type:"option"},{label:"rs_pin: ",type:"option"},{label:"rst_pin: ",type:"option"},{label:"rtd_nominal_r: ",type:"option"},{label:"rtd_num_of_wires: ",type:"option"},{label:"rtd_reference_r: ",type:"option"},{label:"rtd_use_50Hz_filter: ",type:"option"},{label:"run_current: ",type:"option"},{label:"runout_gcode: ",type:"option"},{label:"sample_retract_dist: ",type:"option"},{label:"samples: ",type:"option"},{label:"samples_result: ",type:"option"},{label:"samples_tolerance: ",type:"option"},{label:"samples_tolerance_retries: ",type:"option"},{label:"scale: ",type:"option"},{label:"screw1: ",type:"option"},{label:"screw1_fine_adjust: ",type:"option"},{label:"screw1_name: ",type:"option"},{label:"screw2: ",type:"option"},{label:"screw2_fine_adjust: ",type:"option"},{label:"screw2_name: ",type:"option"},{label:"screw3: ",type:"option"},{label:"screw3_fine_adjust: ",type:"option"},{label:"screw3_name: ",type:"option"},{label:"screw4: ",type:"option"},{label:"screw4_fine_adjust: ",type:"option"},{label:"screw4_name: ",type:"option"},{label:"screw_thread: ",type:"option"},{label:"second_homing_speed: ",type:"option"},{label:"select_pins: ",type:"option"},{label:"sense_resistor: ",type:"option"},{label:"sensor_adc",type:"option"},{label:"sensor_mcu: ",type:"option"},{label:"sensor_path: ",type:"option"},{label:"sensor_pin: ",type:"option"},{label:"sensor_temperature: ",type:"option"},{label:"sensor_type: ",type:"option"},{label:"serial: ",type:"option"},{label:"serial_no: ",type:"option"},{label:"set_output_mode: ",type:"option"},{label:"set_position_x: ",type:"option"},{label:"set_position_y: ",type:"option"},{label:"set_position_z: ",type:"option"},{label:"shaper_freq_x: ",type:"option"},{label:"shaper_freq_y: ",type:"option"},{label:"shaper_type: ",type:"option"},{label:"shaper_type_x: ",type:"option"},{label:"shaper_type_y: ",type:"option"},{label:"shoulder_height: ",type:"option"},{label:"shoulder_radius: ",type:"option"},{label:"shutdown_speed: ",type:"option"},{label:"shutdown_value: ",type:"option"},{label:"sid_pin: ",type:"option"},{label:"smooth_time: ",type:"option"},{label:"smooth_time: ",type:"option"},{label:"speed: ",type:"option"},{label:"spi_bus: ",type:"option"},{label:"spi_software_miso_pin: ",type:"option"},{label:"spi_software_mosi_pin: ",type:"option"},{label:"spi_software_sclk_pin: ",type:"option"},{label:"spi_speed: ",type:"option"},{label:"split_delta_z: ",type:"option"},{label:"square_corner_velocity: ",type:"option"},{label:"standstill_power_down: ",type:"option"},{label:"static_value: ",type:"option"},{label:"stealthchop_threshold: ",type:"option"},{label:"step_pin: ",type:"option"},{label:"stepper_e_chopper_blank_time_high: ",type:"option"},{label:"stepper_e_chopper_hysteresis_high: ",type:"option"},{label:"stepper_e_chopper_off_time_high: ",type:"option"},{label:"stepper_e_current: ",type:"option"},{label:"stepper_e_microstep_mode: ",type:"option"},{label:"stepper_h_chopper_blank_time_high: ",type:"option"},{label:"stepper_h_chopper_hysteresis_high: ",type:"option"},{label:"stepper_h_chopper_off_time_high: ",type:"option"},{label:"stepper_h_current: ",type:"option"},{label:"stepper_h_microstep_mode: ",type:"option"},{label:"stepper_x_chopper_blank_time_high: ",type:"option"},{label:"stepper_x_chopper_hysteresis_high: ",type:"option"},{label:"stepper_x_chopper_off_time_high: ",type:"option"},{label:"stepper_x_current: ",type:"option"},{label:"stepper_x_microstep_mode: ",type:"option"},{label:"stepper_y_chopper_blank_time_high: ",type:"option"},{label:"stepper_y_chopper_hysteresis_high: ",type:"option"},{label:"stepper_y_chopper_off_time_high: ",type:"option"},{label:"stepper_y_current: ",type:"option"},{label:"stepper_y_microstep_mode: ",type:"option"},{label:"stepper_z_chopper_blank_time_high: ",type:"option"},{label:"stepper_z_chopper_hysteresis_high: ",type:"option"},{label:"stepper_z_chopper_off_time_high: ",type:"option"},{label:"stepper_z_current: ",type:"option"},{label:"stepper_z_microstep_mode: ",type:"option"},{label:"steppers: ",type:"option"},{label:"stow_on_each_sample: ",type:"option"},{label:"switch_pin: ",type:"option"},{label:"tachometer_pin: ",type:"option"},{label:"tachometer_poll_interval: ",type:"option"},{label:"tachometer_ppr: ",type:"option"},{label:"tc_averaging_count: ",type:"option"},{label:"tc_type: ",type:"option"},{label:"tc_use_50Hz_filter: ",type:"option"},{label:"temperature",type:"option"},{label:"text: ",type:"option"},{label:"timeout: ",type:"option"},{label:"trigger_phase: ",type:"option"},{label:"tx_pin: ",type:"option"},{label:"type: ",type:"option"},{label:"uart_pin: ",type:"option"},{label:"unretract_extra_length: ",type:"option"},{label:"unretract_speed: ",type:"option"},{label:"up_pin: ",type:"option"},{label:"upper_arm_length: ",type:"option"},{label:"use_current_dia_while_delay: ",type:"option"},{label:"value: ",type:"option"},{label:"variable_",type:"option"},{label:"vcomh: ",type:"option"},{label:"voltage",type:"option"},{label:"voltage_offset: ",type:"option"},{label:"vssa_pin: ",type:"option"},{label:"wiper: ",type:"option"},{label:"wiper_",type:"option"},{label:"x_adjust: ",type:"option"},{label:"x_offset: ",type:"option"},{label:"y_adjust: ",type:"option"},{label:"y_offset: ",type:"option"},{label:"z_adjust: ",type:"option"},{label:"z_hop: ",type:"option"},{label:"z_hop_speed: ",type:"option"},{label:"z_offset: ",type:"option"},{label:"z_positions: ",type:"option"}])});function Fk(){return new du(kk,[Mj])}function dr(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,i=arguments[1];if(i&&typeof i=="object"&&i.nodeType==null&&!Array.isArray(i)){for(var r in i)if(Object.prototype.hasOwnProperty.call(i,r)){var n=i[r];typeof n=="string"?t.setAttribute(r,n):n!=null&&(t[r]=n)}e++}for(;e<arguments.length;e++)Bk(t,arguments[e]);return t}function Bk(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var i=0;i<e.length;i++)Bk(t,e[i]);else throw new RangeError("Unsupported child node: "+e)}var Nk=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t,Za=class{constructor(e,i,r=0,n=e.length,o,a){this.test=a,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,n),this.bufferStart=r,this.normalize=o?l=>o(Nk(l)):Nk,this.query=this.normalize(i)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return ji(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let i=ef(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=Dr(e);let n=this.normalize(i);for(let o=0,a=r;;o++){let l=n.charCodeAt(o),h=this.match(l,a);if(h)return this.value=h,this;if(o==n.length-1)break;a==r&&o<i.length&&i.charCodeAt(o)==l&&a++}}}match(e,i){let r=null;for(let n=0;n<this.matches.length;n+=2){let o=this.matches[n],a=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?r={from:this.matches[n+1],to:i+1}:(this.matches[n]++,a=!0)),a||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?r={from:i,to:i+1}:this.matches.push(1,i)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferPos)&&(r=null),r}};typeof Symbol!="undefined"&&(Za.prototype[Symbol.iterator]=function(){return this});var Hk={from:-1,to:-1,match:/.*/.exec("")},n1="gm"+(/x/.unicode==null?"":"u"),Kv=class{constructor(e,i,r,n=0,o=e.length){if(this.text=e,this.to=o,this.curLine="",this.done=!1,this.value=Hk,/\\[sWDnr]|\n|\r|\[\^/.test(i))return new Qv(e,i,r,n,o);this.re=new RegExp(i,n1+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.iter=e.iter();let a=e.lineAt(n);this.curLineStart=a.from,this.matchPos=Jv(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let i=this.matchPos<=this.to&&this.re.exec(this.curLine);if(i){let r=this.curLineStart+i.index,n=r+i[0].length;if(this.matchPos=Jv(this.text,n+(r==n?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<n||r>this.value.to)&&(!this.test||this.test(r,n,i)))return this.value={from:r,to:n,match:i},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},Jw=new WeakMap,Xa=class{constructor(e,i){this.from=e,this.text=i}get to(){return this.from+this.text.length}static get(e,i,r){let n=Jw.get(e);if(!n||n.from>=r||n.to<=i){let l=new Xa(i,e.sliceString(i,r));return Jw.set(e,l),l}if(n.from==i&&n.to==r)return n;let{text:o,from:a}=n;return a>i&&(o=e.sliceString(i,a)+o,a=i),n.to<r&&(o+=e.sliceString(n.to,r)),Jw.set(e,new Xa(a,o)),new Xa(i,o.slice(i-a,r-a))}},Qv=class{constructor(e,i,r,n,o){this.text=e,this.to=o,this.done=!1,this.value=Hk,this.matchPos=Jv(e,n),this.re=new RegExp(i,n1+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.flat=Xa.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,i=this.re.exec(this.flat.text);if(i&&!i[0]&&i.index==e&&(this.re.lastIndex=e+1,i=this.re.exec(this.flat.text)),i){let r=this.flat.from+i.index,n=r+i[0].length;if((this.flat.to>=this.to||i.index+i[0].length<=this.flat.text.length-10)&&(!this.test||this.test(r,n,i)))return this.value={from:r,to:n,match:i},this.matchPos=Jv(this.text,n+(r==n?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=Xa.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};typeof Symbol!="undefined"&&(Kv.prototype[Symbol.iterator]=Qv.prototype[Symbol.iterator]=function(){return this});function Ej(t){try{return new RegExp(t,n1),!0}catch(e){return!1}}function Jv(t,e){if(e>=t.length)return e;let i=t.lineAt(e),r;for(;e<i.to&&(r=i.text.charCodeAt(e-i.from))>=56320&&r<57344;)e++;return e}function $w(t){let e=dr("input",{class:"cm-textfield",name:"line"}),i=dr("form",{class:"cm-gotoLine",onkeydown:n=>{n.keyCode==27?(n.preventDefault(),t.dispatch({effects:$v.of(!1)}),t.focus()):n.keyCode==13&&(n.preventDefault(),r())},onsubmit:n=>{n.preventDefault(),r()}},dr("label",t.state.phrase("Go to line"),": ",e)," ",dr("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function r(){let n=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!n)return;let{state:o}=t,a=o.doc.lineAt(o.selection.main.head),[,l,h,u,c]=n,f=u?+u.slice(1):0,d=h?+h:a.number;if(h&&c){let v=d/100;l&&(v=v*(l=="-"?-1:1)+a.number/o.doc.lines),d=Math.round(o.doc.lines*v)}else h&&l&&(d=d*(l=="-"?-1:1)+a.number);let m=o.doc.line(Math.max(1,Math.min(o.doc.lines,d)));t.dispatch({effects:$v.of(!1),selection:ve.cursor(m.from+Math.max(0,Math.min(f,m.length))),scrollIntoView:!0}),t.focus()}return{dom:i}}var $v=Lt.define(),Uk=Ii.define({create(){return!0},update(t,e){for(let i of e.effects)i.is($v)&&(t=i.value);return t},provide:t=>mf.from(t,e=>e?$w:null)}),Tj=t=>{let e=gf(t,$w);if(!e){let i=[$v.of(!0)];t.state.field(Uk,!1)==null&&i.push(Lt.appendConfig.of([Uk,Aj])),t.dispatch({effects:i}),e=gf(t,$w)}return e&&e.dom.querySelector("input").focus(),!0},Aj=qe.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),Pj={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Wk=Qe.define({combine(t){return fn(t,Pj,{highlightWordAroundCursor:(e,i)=>e||i,minSelectionLength:Math.min,maxMatches:Math.min})}});function o0(t){let e=[Ij,Dj];return t&&e.push(Wk.of(t)),e}var Rj=xt.mark({class:"cm-selectionMatch"}),Lj=xt.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Gk(t,e,i,r){return(i==0||t(e.sliceDoc(i-1,i))!=Jt.Word)&&(r==e.doc.length||t(e.sliceDoc(r,r+1))!=Jt.Word)}function Oj(t,e,i,r){return t(e.sliceDoc(i,i+1))==Jt.Word&&t(e.sliceDoc(r-1,r))==Jt.Word}var Dj=ki.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(Wk),{state:i}=t,r=i.selection;if(r.ranges.length>1)return xt.none;let n=r.main,o,a=null;if(n.empty){if(!e.highlightWordAroundCursor)return xt.none;let h=i.wordAt(n.head);if(!h)return xt.none;a=i.charCategorizer(n.head),o=i.sliceDoc(h.from,h.to)}else{let h=n.to-n.from;if(h<e.minSelectionLength||h>200)return xt.none;if(e.wholeWords){if(o=i.sliceDoc(n.from,n.to),a=i.charCategorizer(n.head),!(Gk(a,i,n.from,n.to)&&Oj(a,i,n.from,n.to)))return xt.none}else if(o=i.sliceDoc(n.from,n.to).trim(),!o)return xt.none}let l=[];for(let h of t.visibleRanges){let u=new Za(i.doc,o,h.from,h.to);for(;!u.next().done;){let{from:c,to:f}=u.value;if((!a||Gk(a,i,c,f))&&(n.empty&&c<=n.from&&f>=n.to?l.push(Lj.range(c,f)):(c>=n.to||f<=n.from)&&l.push(Rj.range(c,f)),l.length>e.maxMatches))return xt.none}}return xt.set(l)}},{decorations:t=>t.decorations}),Ij=qe.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),kj=({state:t,dispatch:e})=>{let{selection:i}=t,r=ve.create(i.ranges.map(n=>t.wordAt(n.head)||ve.cursor(n.head)),i.mainIndex);return r.eq(i)?!1:(e(t.update({selection:r})),!0)};function Fj(t,e){let{main:i,ranges:r}=t.selection,n=t.wordAt(i.head),o=n&&n.from==i.from&&n.to==i.to;for(let a=!1,l=new Za(t.doc,e,r[r.length-1].to);;)if(l.next(),l.done){if(a)return null;l=new Za(t.doc,e,0,Math.max(0,r[r.length-1].from-1)),a=!0}else{if(a&&r.some(h=>h.from==l.value.from))continue;if(o){let h=t.wordAt(l.value.from);if(!h||h.from!=l.value.from||h.to!=l.value.to)continue}return l.value}}var Bj=({state:t,dispatch:e})=>{let{ranges:i}=t.selection;if(i.some(o=>o.from===o.to))return kj({state:t,dispatch:e});let r=t.sliceDoc(i[0].from,i[0].to);if(t.selection.ranges.some(o=>t.sliceDoc(o.from,o.to)!=r))return!1;let n=Fj(t,r);return n?(e(t.update({selection:t.selection.addRange(ve.range(n.from,n.to),!1),effects:qe.scrollIntoView(n.to)})),!0):!1},s1=Qe.define({combine(t){return fn(t,{top:!1,caseSensitive:!1,literal:!1,wholeWord:!1,createPanel:e=>new r1(e)})}});var e0=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||Ej(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(i,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new t1(this):new e1(this)}getCursor(e,i=0,r){let n=e.doc?e:Ct.create({doc:e});return r==null&&(r=n.doc.length),this.regexp?Su(this,n,i,r):wu(this,n,i,r)}},t0=class{constructor(e){this.spec=e}};function wu(t,e,i,r){return new Za(e.doc,t.unquoted,i,r,t.caseSensitive?void 0:n=>n.toLowerCase(),t.wholeWord?Nj(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Nj(t,e){return(i,r,n,o)=>((o>i||o+n.length<r)&&(o=Math.max(0,i-2),n=t.sliceString(o,Math.min(t.length,r+2))),(e(i0(n,i-o))!=Jt.Word||e(r0(n,i-o))!=Jt.Word)&&(e(r0(n,r-o))!=Jt.Word||e(i0(n,r-o))!=Jt.Word))}var e1=class extends t0{constructor(e){super(e)}nextMatch(e,i,r){let n=wu(this.spec,e,r,e.doc.length).nextOverlapping();return n.done&&(n=wu(this.spec,e,0,i).nextOverlapping()),n.done?null:n.value}prevMatchInRange(e,i,r){for(let n=r;;){let o=Math.max(i,n-1e4-this.spec.unquoted.length),a=wu(this.spec,e,o,n),l=null;for(;!a.nextOverlapping().done;)l=a.value;if(l)return l;if(o==i)return null;n-=1e4}}prevMatch(e,i,r){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,i){let r=wu(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=i)return null;n.push(r.value)}return n}highlight(e,i,r,n){let o=wu(this.spec,e,Math.max(0,i-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!o.next().done;)n(o.value.from,o.value.to)}};function Su(t,e,i,r){return new Kv(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?Uj(e.charCategorizer(e.selection.main.head)):void 0},i,r)}function i0(t,e){return t.slice(hr(t,e,!1),e)}function r0(t,e){return t.slice(e,hr(t,e))}function Uj(t){return(e,i,r)=>!r[0].length||(t(i0(r.input,r.index))!=Jt.Word||t(r0(r.input,r.index))!=Jt.Word)&&(t(r0(r.input,r.index+r[0].length))!=Jt.Word||t(i0(r.input,r.index+r[0].length))!=Jt.Word)}var t1=class extends t0{nextMatch(e,i,r){let n=Su(this.spec,e,r,e.doc.length).next();return n.done&&(n=Su(this.spec,e,0,i).next()),n.done?null:n.value}prevMatchInRange(e,i,r){for(let n=1;;n++){let o=Math.max(i,r-n*1e4),a=Su(this.spec,e,o,r),l=null;for(;!a.next().done;)l=a.value;if(l&&(o==i||l.from>o+10))return l;if(o==i)return null}}prevMatch(e,i,r){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(i,r)=>r=="$"?"$":r=="&"?e.match[0]:r!="0"&&+r<e.match.length?e.match[r]:i))}matchAll(e,i){let r=Su(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=i)return null;n.push(r.value)}return n}highlight(e,i,r,n){let o=Su(this.spec,e,Math.max(0,i-250),Math.min(r+250,e.doc.length));for(;!o.next().done;)n(o.value.from,o.value.to)}},Bf=Lt.define(),o1=Lt.define(),Ya=Ii.define({create(t){return new Ff(i1(t).create(),null)},update(t,e){for(let i of e.effects)i.is(Bf)?t=new Ff(i.value.create(),t.panel):i.is(o1)&&(t=new Ff(t.query,i.value?a1:null));return t},provide:t=>mf.from(t,e=>e.panel)});var Ff=class{constructor(e,i){this.query=e,this.panel=i}},Gj=xt.mark({class:"cm-searchMatch"}),zj=xt.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Hj=ki.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(Ya))}update(t){let e=t.state.field(Ya);(e!=t.startState.field(Ya)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return xt.none;let{view:i}=this,r=new An;for(let n=0,o=i.visibleRanges,a=o.length;n<a;n++){let{from:l,to:h}=o[n];for(;n<a-1&&h>o[n+1].from-2*250;)h=o[++n].to;t.highlight(i.state,l,h,(u,c)=>{let f=i.state.selection.ranges.some(d=>d.from==u&&d.to==c);r.add(u,c,f?zj:Gj)})}return r.finish()}},{decorations:t=>t.decorations});function Nf(t){return e=>{let i=e.state.field(Ya,!1);return i&&i.query.spec.valid?t(e,i):Vk(e)}}var n0=Nf((t,{query:e})=>{let{to:i}=t.state.selection.main,r=e.nextMatch(t.state,i,i);return r?(t.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:l1(t,r),userEvent:"select.search"}),!0):!1}),s0=Nf((t,{query:e})=>{let{state:i}=t,{from:r}=i.selection.main,n=e.prevMatch(i,r,r);return n?(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:l1(t,n),userEvent:"select.search"}),!0):!1}),Wj=Nf((t,{query:e})=>{let i=e.matchAll(t.state,1e3);return!i||!i.length?!1:(t.dispatch({selection:ve.create(i.map(r=>ve.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),Vj=({state:t,dispatch:e})=>{let i=t.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:r,to:n}=i.main,o=[],a=0;for(let l=new Za(t.doc,t.sliceDoc(r,n));!l.next().done;){if(o.length>1e3)return!1;l.value.from==r&&(a=o.length),o.push(ve.range(l.value.from,l.value.to))}return e(t.update({selection:ve.create(o,a),userEvent:"select.search.matches"})),!0},zk=Nf((t,{query:e})=>{let{state:i}=t,{from:r,to:n}=i.selection.main;if(i.readOnly)return!1;let o=e.nextMatch(i,r,r);if(!o)return!1;let a=[],l,h,u=[];if(o.from==r&&o.to==n&&(h=i.toText(e.getReplacement(o)),a.push({from:o.from,to:o.to,insert:h}),o=e.nextMatch(i,o.from,o.to),u.push(qe.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(r).number)+"."))),o){let c=a.length==0||a[0].from>=o.to?0:o.to-o.from-h.length;l={anchor:o.from-c,head:o.to-c},u.push(l1(t,o))}return t.dispatch({changes:a,selection:l,scrollIntoView:!!l,effects:u,userEvent:"input.replace"}),!0}),jj=Nf((t,{query:e})=>{if(t.state.readOnly)return!1;let i=e.matchAll(t.state,1e9).map(n=>{let{from:o,to:a}=n;return{from:o,to:a,insert:e.getReplacement(n)}});if(!i.length)return!1;let r=t.state.phrase("replaced $ matches",i.length)+".";return t.dispatch({changes:i,effects:qe.announce.of(r),userEvent:"input.replace.all"}),!0});function a1(t){return t.state.facet(s1).createPanel(t)}function i1(t,e){var i,r,n,o;let a=t.selection.main,l=a.empty||a.to>a.from+100?"":t.sliceDoc(a.from,a.to);if(e&&!l)return e;let h=t.facet(s1);return new e0({search:((i=e==null?void 0:e.literal)!==null&&i!==void 0?i:h.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(r=e==null?void 0:e.caseSensitive)!==null&&r!==void 0?r:h.caseSensitive,literal:(n=e==null?void 0:e.literal)!==null&&n!==void 0?n:h.literal,wholeWord:(o=e==null?void 0:e.wholeWord)!==null&&o!==void 0?o:h.wholeWord})}var Vk=t=>{let e=t.state.field(Ya,!1);if(e&&e.panel){let i=gf(t,a1);if(!i)return!1;let r=i.dom.querySelector("[main-field]");if(r&&r!=t.root.activeElement){let n=i1(t.state,e.query.spec);n.valid&&t.dispatch({effects:Bf.of(n)}),r.focus(),r.select()}}else t.dispatch({effects:[o1.of(!0),e?Bf.of(i1(t.state,e.query.spec)):Lt.appendConfig.of(Xj)]});return!0},jk=t=>{let e=t.state.field(Ya,!1);if(!e||!e.panel)return!1;let i=gf(t,a1);return i&&i.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:o1.of(!1)}),!0},a0=[{key:"Mod-f",run:Vk,scope:"editor search-panel"},{key:"F3",run:n0,shift:s0,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:n0,shift:s0,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:jk,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Vj},{key:"Alt-g",run:Tj},{key:"Mod-d",run:Bj,preventDefault:!0}],r1=class{constructor(e){this.view=e;let i=this.query=e.state.field(Ya).query.spec;this.commit=this.commit.bind(this),this.searchField=dr("input",{value:i.search,placeholder:On(e,"Find"),"aria-label":On(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=dr("input",{value:i.replace,placeholder:On(e,"Replace"),"aria-label":On(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=dr("input",{type:"checkbox",name:"case",form:"",checked:i.caseSensitive,onchange:this.commit}),this.reField=dr("input",{type:"checkbox",name:"re",form:"",checked:i.regexp,onchange:this.commit}),this.wordField=dr("input",{type:"checkbox",name:"word",form:"",checked:i.wholeWord,onchange:this.commit});function r(n,o,a){return dr("button",{class:"cm-button",name:n,onclick:o,type:"button"},a)}this.dom=dr("div",{onkeydown:n=>this.keydown(n),class:"cm-search"},[this.searchField,r("next",()=>n0(e),[On(e,"next")]),r("prev",()=>s0(e),[On(e,"previous")]),r("select",()=>Wj(e),[On(e,"all")]),dr("label",null,[this.caseField,On(e,"match case")]),dr("label",null,[this.reField,On(e,"regexp")]),dr("label",null,[this.wordField,On(e,"by word")]),...e.state.readOnly?[]:[dr("br"),this.replaceField,r("replace",()=>zk(e),[On(e,"replace")]),r("replaceAll",()=>jj(e),[On(e,"replace all")])],dr("button",{name:"close",onclick:()=>jk(e),"aria-label":On(e,"close"),type:"button"},["\xD7"])])}commit(){let e=new e0({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Bf.of(e)}))}keydown(e){oD(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?s0:n0)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),zk(this.view))}update(e){for(let i of e.transactions)for(let r of i.effects)r.is(Bf)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(s1).top}};function On(t,e){return t.state.phrase(e)}var Yv=30,Zv=/[\s\.,:;?!]/;function l1(t,{from:e,to:i}){let r=t.state.doc.lineAt(e),n=t.state.doc.lineAt(i).to,o=Math.max(r.from,e-Yv),a=Math.min(n,i+Yv),l=t.state.sliceDoc(o,a);if(o!=r.from){for(let h=0;h<Yv;h++)if(!Zv.test(l[h+1])&&Zv.test(l[h])){l=l.slice(h);break}}if(a!=n){for(let h=l.length-1;h>l.length-Yv;h--)if(!Zv.test(l[h-1])&&Zv.test(l[h])){l=l.slice(0,h);break}}return qe.announce.of(`${t.state.phrase("current match")}. ${l} ${t.state.phrase("on line")} ${r.number}.`)}var qj=qe.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Xj=[Ya,lo.lowest(Hj),qj];RSBase.component("rsGcodeEditor",{require:{ngModel:"^ngModel"},template:"",controller:["$scope","$element","$rootScope",function(t,e,i){let r=this;this.$onDestroy=()=>{r.view.destroy()},this.$onInit=()=>{let n=qe.baseTheme(i.theme==="dark"?{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#15518d !important",backgroundColor:"#15518d !important",color:"white !important"}}:{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#B8CDE8F !important",backgroundColor:"#B8CDE8FF !important",color:"black !important"}}),o=qe.theme({".cm-content, .cm-gutter":{minHeight:"100%"},".cm-completionIcon":{paddingRight:"1.2em !important"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#7fb2d5"},"&.cm-focused .cm-cursor":{borderLeftColor:i.theme==="dark"?"#fff":"#000"},".cm-content":{caretColor:i.theme==="dark"?"#fff":"#000",whiteSpace:"pre-wrap"}}),a=yo.define(i.theme==="dark"?[{tag:ee.keyword,color:"#3DA6E8"},{tag:ee.processingInstruction,color:"#97c3e0"},{tag:ee.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:ee.number,color:"#A5C29A"},{tag:ee.variableName,color:"#fdfdfd"},{tag:ee.string,color:"#C9856C"},{tag:ee.blockComment,color:"#CBCBCB"},{tag:ee.brace,color:"#f5e882"},{tag:ee.squareBracket,color:"#c7c7c7"},{tag:ee.paren,color:"#ffffff"},{tag:ee.modifier,color:"#66cdaa"},{tag:ee.self,color:"#cccccc"},{tag:ee.attributeName,color:"#ffffff"},{tag:ee.annotation,color:"#ff5454",borderBottom:"1px dotted #ff5454"}]:[{tag:ee.keyword,color:"#246186"},{tag:ee.processingInstruction,color:"#7c9bb0"},{tag:ee.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:ee.number,color:"#b63dcb"},{tag:ee.variableName,color:"#000000"},{tag:ee.string,color:"#C9856C"},{tag:ee.blockComment,color:"#737373"},{tag:ee.brace,color:"#3300ff"},{tag:ee.squareBracket,color:"#3a3a3a"},{tag:ee.paren,color:"#000000"},{tag:ee.modifier,color:"#668c86"},{tag:ee.self,color:"#737373"},{tag:ee.attributeName,color:"#000000"},{tag:ee.annotation,color:"#a11313",borderBottom:"1px dotted #a11313"}]),l=new class extends Ir{toDOM(){return document.createTextNode("\xF8")}},h=ou({lineMarker(u,c){return c.from==c.to?l:null},initialSpacer:()=>l});r.extensions=[Jg(),$g(),Zg(),_v(),dv(),Yg(),Ct.allowMultipleSelections.of(!0),uv(),mv({brackets:"[]"}),Hv(),jv(),Qg(),Kg(),o0(),Ul.of([...Wv,...Mv,...a0,...xv,...fv,...kf,Ev]),Tk(),n,o,pv(a),h,qe.updateListener.of(u=>{u.docChanged&&r.ngModel.$setViewValue(r.view.state.doc.toString())})],r.startState=Ct.create({doc:"",extensions:r.extensions}),e[0].classList.add(i.theme),r.view=new qe({state:r.startState,parent:e[0]}),this.ngModel.$render=()=>{r.model=r.ngModel.$viewValue,r.view.state.doc!==r.model&&(r.startState=Ct.create({doc:r.model,extensions:r.extensions}),r.view.setState(r.startState))},t.$watch(function(){return r.model},function(u){r.ngModel.$setViewValue(u)})}}],controllerAs:"ctrl"});RSBase.component("rsKlipperConfigEditor",{require:{ngModel:"^ngModel"},template:"",controller:["$scope","$element","$rootScope",function(t,e,i){let r=this;this.$onDestroy=()=>{r.view.destroy()},this.$onInit=()=>{let n=qe.baseTheme(i.theme==="dark"?{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#15518d !important",backgroundColor:"#15518d !important",color:"white !important"}}:{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#B8CDE8F !important",backgroundColor:"#B8CDE8FF !important",color:"black !important"}}),o=qe.theme({".cm-content, .cm-gutter":{minHeight:"100%"},".cm-completionIcon":{paddingRight:"1.2em !important"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#7fb2d5"},"&.cm-focused .cm-cursor":{borderLeftColor:i.theme==="dark"?"#fff":"#000"},".cm-content":{caretColor:i.theme==="dark"?"#fff":"#000",whiteSpace:"pre-wrap"}}),a=yo.define(i.theme==="dark"?[{tag:ee.keyword,color:"#3DA6E8"},{tag:ee.processingInstruction,color:"#97c3e0"},{tag:ee.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:ee.number,color:"#A5C29A"},{tag:ee.variableName,color:"#fdfdfd"},{tag:ee.string,color:"#C9856C"},{tag:ee.blockComment,color:"#CBCBCB"},{tag:ee.brace,color:"#f5e882"},{tag:ee.squareBracket,color:"#c7c7c7"},{tag:ee.paren,color:"#ffffff"},{tag:ee.modifier,color:"#66cdaa"},{tag:ee.self,color:"#cccccc"},{tag:ee.attributeName,color:"#ffffff"},{tag:ee.annotation,color:"#ff5454",borderBottom:"1px dotted #ff5454"}]:[{tag:ee.keyword,color:"#246186"},{tag:ee.processingInstruction,color:"#7c9bb0"},{tag:ee.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:ee.number,color:"#b63dcb"},{tag:ee.variableName,color:"#000000"},{tag:ee.string,color:"#C9856C"},{tag:ee.blockComment,color:"#737373"},{tag:ee.brace,color:"#3300ff"},{tag:ee.squareBracket,color:"#3a3a3a"},{tag:ee.paren,color:"#000000"},{tag:ee.modifier,color:"#668c86"},{tag:ee.self,color:"#737373"},{tag:ee.attributeName,color:"#000000"},{tag:ee.annotation,color:"#a11313",borderBottom:"1px dotted #a11313"}]),l=new class extends Ir{toDOM(){return document.createTextNode("\xF8")}},h=ou({lineMarker(u,c){return c.from==c.to?l:null},initialSpacer:()=>l});r.extensions=[Jg(),$g(),Zg(),_v(),dv(),Yg(),Ct.allowMultipleSelections.of(!0),uv(),mv({brackets:"[](){}"}),Hv(),jv(),Qg(),Kg(),o0(),Ul.of([...Wv,...Mv,...a0,...xv,...fv,...kf,Ev]),Fk(),n,o,pv(a),h,qe.updateListener.of(u=>{u.docChanged&&r.ngModel.$setViewValue(r.view.state.doc.toString())})],r.startState=Ct.create({doc:"",extensions:r.extensions}),e[0].classList.add(i.theme),r.view=new qe({state:r.startState,parent:e[0]}),this.ngModel.$render=()=>{r.model=r.ngModel.$viewValue,r.view.state.doc!==r.model&&(r.startState=Ct.create({doc:r.model,extensions:r.extensions}),r.view.setState(r.startState))},t.$watch(function(){return r.model},function(u){r.ngModel.$setViewValue(u)})}}],controllerAs:"ctrl"});RSBase.component("rsCodeEditor",{require:{ngModel:"^ngModel"},template:"",controller:["$scope","$element","$rootScope",function(t,e,i){let r=this;this.$onDestroy=()=>{r.view.destroy()},this.$onInit=()=>{let n=qe.baseTheme(i.theme==="dark"?{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#15518d !important",backgroundColor:"#15518d !important",color:"white !important"}}:{".cm-tooltip.cm-tooltip-autocomplete > ul > li[aria-selected]":{background:"#B8CDE8F !important",backgroundColor:"#B8CDE8FF !important",color:"black !important"}}),o=qe.theme({".cm-content, .cm-gutter":{minHeight:"100%"},".cm-completionIcon":{paddingRight:"1.2em !important"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#7fb2d5"},"&.cm-focused .cm-cursor":{borderLeftColor:i.theme==="dark"?"#fff":"#000"},".cm-content":{caretColor:i.theme==="dark"?"#fff":"#000",whiteSpace:"pre-wrap"}}),a=yo.define(i.theme==="dark"?[{tag:ee.keyword,color:"#3DA6E8"},{tag:ee.processingInstruction,color:"#97c3e0"},{tag:ee.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:ee.number,color:"#A5C29A"},{tag:ee.variableName,color:"#fdfdfd"},{tag:ee.string,color:"#C9856C"},{tag:ee.blockComment,color:"#CBCBCB"},{tag:ee.brace,color:"#f5e882"},{tag:ee.squareBracket,color:"#c7c7c7"},{tag:ee.paren,color:"#ffffff"},{tag:ee.modifier,color:"#66cdaa"},{tag:ee.self,color:"#cccccc"},{tag:ee.attributeName,color:"#ffffff"},{tag:ee.annotation,color:"#ff5454",borderBottom:"1px dotted #ff5454"}]:[{tag:ee.keyword,color:"#246186"},{tag:ee.processingInstruction,color:"#7c9bb0"},{tag:ee.lineComment,color:"#5D9C4C",fontStyle:"italic"},{tag:ee.number,color:"#b63dcb"},{tag:ee.variableName,color:"#000000"},{tag:ee.string,color:"#C9856C"},{tag:ee.blockComment,color:"#737373"},{tag:ee.brace,color:"#3300ff"},{tag:ee.squareBracket,color:"#3a3a3a"},{tag:ee.paren,color:"#000000"},{tag:ee.modifier,color:"#668c86"},{tag:ee.self,color:"#737373"},{tag:ee.attributeName,color:"#000000"},{tag:ee.annotation,color:"#a11313",borderBottom:"1px dotted #a11313"}]),l=new class extends Ir{toDOM(){return document.createTextNode("\xF8")}},h=ou({lineMarker(u,c){return c.from==c.to?l:null},initialSpacer:()=>l});r.extensions=[Jg(),$g(),Zg(),_v(),dv(),Yg(),Ct.allowMultipleSelections.of(!0),uv(),zD.fallback,mv({brackets:"[](){}"}),Hv(),jv(),Qg(),Kg(),o0(),Ul.of([...Wv,...Mv,...a0,...xv,...fv,...kf,Ev]),n,o,pv(a),h,qe.updateListener.of(u=>{u.docChanged&&r.ngModel.$setViewValue(r.view.state.doc.toString())})],r.startState=Ct.create({doc:"",extensions:r.extensions}),e[0].classList.add(i.theme),r.view=new qe({state:r.startState,parent:e[0]}),this.ngModel.$render=()=>{r.model=r.ngModel.$viewValue,r.view.state.doc!==r.model&&(r.startState=Ct.create({doc:r.model,extensions:r.extensions}),r.view.setState(r.startState))},t.$watch(function(){return r.model},function(u){r.ngModel.$setViewValue(u)})}}],controllerAs:"ctrl"});var D1=Qi(ta());var L1={arrowX:null,arrowY:null,arrowZ:null,rotateX:null,rotateY:null,rotateZ:null,scaleX:null,scaleY:null,scaleZ:null,nozzle:null},K7={x:new lr({name:"xAxisMaterial",color:12202281,specular:1118481,shininess:50,side:Ei}),y:new lr({name:"yAxisMaterial",color:3717661,specular:1118481,shininess:50,side:Ei}),z:new lr({name:"zAxisMaterial",color:4149685,specular:1118481,shininess:50,side:Ei}),nozzle:new lr({name:"nozzleMaterial",color:13674342,specular:1118481,shininess:50,side:Ei,flatShading:!0,transparent:!0,opacity:.6})},ks=[new q(1,0,0),new q(0,1,0),new q(0,0,1)],O1=class{constructor(){this.openHelpers=0,this._initialized=null}get initialized(){return this._initialized===null&&(this._initialized=new Promise((e,i)=>{this._initResolve=e,this._initReject=i,this.maxTextureSize=0,L1.arrowX===null&&this.loadHelper()})),this._initialized}loadGeoHelper(e,i){this.openHelpers++,new Hh().load(i,n=>{n[0].geometry.name=e,L1[e]=n[0].geometry,this.openHelpers--,this.openHelpers===0&&this._initResolve()})}loadHelper(){this.openHelpers++,this.loadGeoHelper("arrowX","/views/printer/slicer/arrow2X.rmf"),this.loadGeoHelper("arrowY","/views/printer/slicer/arrow2Y.rmf"),this.loadGeoHelper("arrowZ","/views/printer/slicer/arrow2Z.rmf"),this.loadGeoHelper("scaleX","/views/printer/slicer/scaleX.rmf"),this.loadGeoHelper("scaleY","/views/printer/slicer/scaleY.rmf"),this.loadGeoHelper("scaleZ","/views/printer/slicer/scaleZ.rmf"),this.loadGeoHelper("rotateX","/views/printer/slicer/rotateX.rmf"),this.loadGeoHelper("rotateY","/views/printer/slicer/rotateY.rmf"),this.loadGeoHelper("rotateZ","/views/printer/slicer/rotateZ.rmf"),this.loadGeoHelper("nozzle","/views/printer/slicer/nozzle.rmf"),this.openHelpers--}getAxisMaterials(){return K7}getGeometryHelper(){return L1}getMaxTextureSize(){if(!this.maxTextureSize){let i=document.createElement("canvas").getContext("webgl");this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),i=null}return this.maxTextureSize}get isWebGL2Supported(){return this._isWebGL2Supported||(this._isWebGL2Supported=()=>!!document.createElement("canvas").getContext("webgl2")),this._isWebGL2Supported}},wi=new O1;RSBase.factory("RSCom",["$q","$rootScope","User","$location","$uibModal","$http","$templateCache","localStorageService","$timeout","Flash","Confirm","$interval",function(t,e,i,r,n,o,a,l,h,u,c,f){e.mobile=typeof window.orientation!="undefined"||navigator.userAgent.indexOf("IEMobile")!==-1,e.isWebGL2Supported=wi.isWebGL2Supported,e.isMobile=ao;let d={},m={},v=0,g=null,p=0;d.connected=!1,d.wasConnected=!1,e.alert=!1;let _=[],x="",b=null,y=0,w=!0,S=50,R="",E=-1;e.hardwareInfo={maxUrgency:-1,list:[]},d.isSecure=function(){return window.location.protocol==="https:"},d.closeOopsDialog=function(){b&&b.close(),b=null},d.getCookie=function(k){let F=`; ${document.cookie}`.split(`; ${k}=`);if(F.length===2)return F.pop().split(";").shift().trim()},d.isSecure()?e.httpType="https":e.httpType="http",e.update={features:0},window.rs=e,e.hasFeature=function(k){return(k&e.update.features)===k},e.toClipboard=function(k){let B=document.createElement("textarea");B.style.position="fixed",B.style.top="0",B.style.left="0",B.style.width="1px",B.style.height="1px",B.style.padding="0",B.style.border="none",B.style.outline="none",B.style.boxShadow="none",B.style.background="transparent",B.value=k,document.body.appendChild(B),B.focus(),B.select();try{document.execCommand("copy"),u.success("Текст скопирован")}catch(F){}document.body.removeChild(B)},e.isOEM=function(){return e.hasFeature(32768)},e.isPro=function(){return e.hasFeature(2048)},e.isLight=function(){return e.hasFeature(4096)},e.hasFeature1=!1,o.get("uib/template/modal/backdrop.html",{cache:a}),o.get("uib/template/modal/window.html",{cache:a}),o.get("/views/base/connectionLost.php?lang="+window.lang,{cache:a}),d.updateImportant=function(){d.send("csrf",{csrf:d.getCookie("Csrf-Token")}),d.send("updateAvailable",{}).then(function(k){e.update=k,k.currentVersion!==R&&(R!==""&&location.reload(!0),R=k.currentVersion),e.hasFeature1=e.hasFeature(1),e.hasWebcamSupport=e.hasFeature(4),e.hasLocalCloud=e.hasFeature(32),e.hasFirmwareUpload=e.hasFeature(256),e.$broadcast("newUpdateLoaded",k)},function(){})},e.globalErrorsVisible=[],e.fetchGlobalErrors=function(){d.send("getGlobalErrors",{}).then(k=>{angular.forEach(k.errors,B=>{e.globalErrorsVisible.find(F=>F===B.id)?console.log("error id: ",B.id,"already open"):(e.globalErrorsVisible.push(B.id),console.log("errors visible before confirm",e.globalErrorsVisible),c(B.data.headline,B.data.text,"Подтвердить","",!0,"",!0).then(function(){d.send("removeGlobalError",{id:B.id}).then(()=>{let F=e.globalErrorsVisible.indexOf(B.id);F>-1&&e.globalErrorsVisible.splice(F,1)})}))})})},e.$on("globalErrorsChanged",function(){e.fetchGlobalErrors()}),e.$on("licenceChanged",function(){d.updateImportant()});let T=["rs-fw rs-bigtab","fa fa-bolt rs-fw rs-bigtab","fa fa-thermometer-half rs-fw rs-bigtab","fa fa-exclamation-triangle rs-fw rs-bigtab","fa fa-battery-full rs-fw rs-bigtab","fa fa-bug rs-fw rs-bigtab","fa fa-plug rs-fw rs-bigtab","fa fa-usb rs-fw rs-bigtab","rs rs-webcam rs-fw rs-bigtab","fa fa-tasks rs-fw rs-bigtab","fa fa-bell rs-fw rs-bigtab","fa fa-bluetooth rs-fw rs-bigtab","fa fa-square-o rs-fw rs-bigtab","fa fa-check-square-o rs-fw rs-bigtab","fa fa-hdd-o rs-fw rs-bigtab","fa fa-hourglass rs-fw rs-bigtab","fa fa-wifi rs-fw rs-bigtab","fa fa-microchip rs-fw rs-bigtab","fa fa-clock-o rs-fw rs-bigtab"];e.autoupdateRunning=!1,e.$on("autoupdateStarted",function(){e.autoupdateRunning=!0}),e.$on("hardwareInfo",function(k,B){switch(e.hardwareInfo=B.data,e.hardwareInfo.maxUrgency){case 0:case 1:e.hardwareInfo.boltClass="fa fa-bolt";break;case 2:e.hardwareInfo.boltClass="fa fa-bolt text-warning-light";break;case 3:e.hardwareInfo.boltClass="fa fa-bolt text-danger-light";break}angular.forEach(e.hardwareInfo.list,function(F){let W=F.url?' &nbsp; <i class="fa fa-external-link"></i>':"";switch(F.msgType){case 0:F.content=F.name+" "+F.text+W;break;case 1:F.content=F.name+" "+parseInt(F.value)+" "+F.unit+W;break;case 2:F.content=F.name+" "+parseFloat(F.value).toFixed(1)+" "+F.unit+W;break;case 3:F.content=F.name+" "+parseFloat(F.value).toFixed(1)+" "+F.unit+W;break}F.iconClass=T[F.icon],F.urgency===2&&(F.iconClass+=" text-warning-light"),F.urgency===3&&(F.iconClass+=" text-danger-light")})});let A=!1,C=async function(){if(A||g!==null&&g.readyState===WebSocket.OPEN)return;if(typeof document.hidden!="undefined"&&document.hidden){setTimeout(C,50);return}if(A=!0,!await i.refreshSession(d)){A=!1,setTimeout(C,S),S<1e3?S=2*S:S=2e3;return}p++,p>20&&(p=0,console.clear());let k="";E=-1,window.frontEnd&&(k+="&front=1");try{g=new WebSocket((d.isSecure()?"wss://":"ws://")+window.location.host+"/socket/?lang="+window.lang+k),g.onopen=function(){A=!1,e.autoupdateRunning&&location.reload(!0),e.autoupdateRunning=!1,d.connected=!0,y=0,b&&b.close(),b=null,d.updateImportant();let B=[];angular.forEach(m,function(W){B.push(W)}),e.$broadcast("connected");let F=function(){if(g.readyState!==1){g.readyState<1&&h(F,20);return}w=!1,$.each(_,function(W,V){V.resolve(g)}),_=[],S=50,d.wasConnected=!0};angular.forEach(B,function(W){let V=t.defer();_.push(V),V.promise.then(function(){(!W.request.ws||W.request.ws!==g)&&(delete W.request.ws,g.send(angular.toJson(W.request)),W.request.ws=g)},function(){})}),h(F,10),e.$apply()},g.onerror=function(B){A=!1,console.log("websocket error",B)},g.onclose=function(){A=!1,console.log("close socket"),d.connected&&(d.connected=!1,e.$broadcast("disconnected"),b===null&&!w&&i.isLoggedIn&&(b=n.open({templateUrl:"/views/base/connectionLost.php?lang="+window.lang,keyboard:!1,size:"lg",backdrop:"static"}),b.result.catch(function(B){}))),setTimeout(C,S),S<1e3?S=2*S:S=2e3},g.onmessage=function(B){e.timeMS=new Date().getTime();try{D(angular.fromJson(B.data))}catch(F){console.log("websocket listener"),console.log(F),console.log(B)}}}catch(B){console.log("connection error",B),A=!1}};d.stopConnection=function(){g&&(g.onclose=function(){g=null},g.close()),d.closeOopsDialog()},$(window).unload(function(){g&&(g.onclose=function(){},g.close())}),e.forceLogin=function(){r.path()!=="/login"?e.pathAfterLogin=r.path():e.pathAfterLogin="/",i.autologin(d)},window.loc=r,e.forceLogin();function M(k){let B=t.defer();if(k.callback_id=O(),k.action==="login"&&(E=k.callback_id),m[k.callback_id]={time:new Date,cb:B,request:k},!d.connected||!g||g&&g.readyState!==1){let F=t.defer();_.push(F),F.promise.then(function(){(!k.ws||k.ws!==g)&&(delete k.ws,g.send(angular.toJson(k)),k.ws=g)},function(){})}else g.send(angular.toJson(k)),k.ws=g;return B.promise}function D(k){let B=k;if(B.callback_id<0)angular.forEach(B.data,function(F){e.$broadcast(F.event,F),e.$apply(),F.event==="pong"&&d.send("ping",{source:"gui-Pong"})});else if(m[B.callback_id]){let F=m[B.callback_id];if(E<0&&E>B.callback_id&&(E=-1),typeof B.data.permissionDenied!="undefined"){E>=0&&B.callback_id<E?(F.cb.reject(),delete m[B.callback_id]):(F.cb.reject(),delete m[B.callback_id],i.logout(),e.forceLogin());return}else if(typeof B.data.alert!="undefined"){F.cb.reject(),delete m[B.callback_id],e.alert=B.data.alert;return}e.$apply(F.cb.resolve(B.data)),delete m[B.callback_id]}}function O(){return v+=1,v>1e4&&(v=0),v}d.startConnection=C,d.uploadFiles=async function({url:k,a:B,files:F,group:W,autostart:V},N){let ne=0,ie=1,Q={onUploadProgress:re=>{let Y=Math.round(ne+ie*re.loaded/re.total*100);N(Y)},headers:{"Content-Type":"multipart/form-data"},maxContentLength:1/0,maxBodyLength:1/0},K=0;for(let re of F)K+=re.filename.size;let de=(re,Y)=>{let U=new FormData;return U.append("a",B),U.append("name",re),U.append("filename",Y),W&&U.append("group",W),V&&U.append("autostart",V),D1.default.post(k,U,Q)};d.extendPing(300);for(let re of F){ie=re.filename.size/K;let Y=await de(re.name,re.filename);ne+=100*ie;let U=typeof Y.data=="object"?Y:JSON.parse(Y.data);U.error===void 0||u.error("Сбой при загрузке: "+U.error)}d.extendPing(0)},d.send=function(k,B,F){return F||(F=x),B||(B={}),M({action:k,data:B,printer:F})},d.selectPrinter=function(k){x=k,d.send("activePrinter",{printer:k},k)},d.extendPing=function(k){d.send("extendPing",{timeout:k})},e.RSCom=d;let P=!1,L=function(){d.connected&&g&&g.readyState===1&&(y>10?g.close():(typeof document.hidden!="undefined"&&P!==document.hidden&&(d.extendPing(document.hidden?300:0),P=document.hidden),y++,d.send("ping",{source:"gui"}).then(function(){y--},function(){})))};return f(function(){D1.default.get("/global/ping").then(function(k){k.status===200&&!k.data.ok&&i.refreshSession(d)})},6e4),f(L,2e3),d}]).factory("RSOverview",["$rootScope","RSCom","$timeout","$compile","$q","Confirm","$filter","User","$state","Flash",function(t,e,i,r,n,o,a,l,h,u){t.externalCommands=[],t.externalLinks=[],t.loading=!1,t.printerList=[],t.printerListActive=[],t.printerListInactive=[],t.printerStateList={},t.active={status:{}},t.activeConfig={},t.activeSlug="",t.serverSetup={},t.printerConfig={},t.printer={},t.serverSettings={},t.printerWithJobs=[],t.folders=[],t.dispatcherOpen=0,t.manufacturerNews=[],t.newManufacturerNews=!1;let c=!0,f=!0,d=null,m=null,v='<div class="loading" ng-show="loading"><i class="icon-spin icon-spinner"></i> Loading ...</div>',g=angular.element(v);r(g)(t),angular.element(document.body).append(g),t.$on("load",function(){t.loading=!0}),t.$on("loaded",function(){t.loading=!1});let p=function(){e.send("getFolders",{}).then(function(O){t.folders=O.folders})},_=()=>{e.send("getManufacturerNews",{}).then(function(O){O.ok&&(t.manufacturerNews=O.messages,t.manufacturerNewsTitle=O.title,t.newManufacturerNews=O.newMessages,t.$broadcast("manufacturerNewsUpdated"))})};t.$on("manufacturerNewsChanged",_);let x=function(){angular.forEach(t.printer,function(O,P){e.send("getDialogs",{lang},P).then(function(L){O.dialogs=L.dialogs})})};t.$on("dialogsChanged",function(O,P){e.send("getDialogs",{lang},P.printer).then(function(L){t.printer[P.printer].dialogs=L.dialogs})}),t.$on("dispatcherCount",function(O,P){t.dispatcherOpen=P.data.count}),t.$on("foldersChanged",p);let b=function(){angular.forEach(t.printer,function(O,P){e.send("getRecover",{},P).then(function(L){O.recover=L.recover})})},y=n.defer(),w=function(O){t.printer[O.slug]?t.printer[O.slug].status=O:(t.printer[O.slug]={status:O,state:{},log:[],history:[],layer:[],dialogs:[],previousLayer:[],recover:{state:-1},local:{},reconnectCounter:0},e.send("getDialogs",{lang},O.slug).then(function(P){t.printer[O.slug].dialogs=P.dialogs})),t.printer[O.slug].state.isJobActive=O.jobstate==="running",O.slug===t.activeSlug&&(t.active=t.printer[O.slug]),O.done&&t.printerWithJobs.push(O)},S="",R="",E=function(O){let P=angular.toJson(O),L=l.getSetting("printerOrder","dynamic");if(S!==P||R!==L){S=P,R=L,L==="name"?t.printerList=a("orderBy")(O,["name"]):t.printerList=a("orderBy")(O,["-online","-active","name"]),t.printerListActive=a("filter")(t.printerList,{active:!0}),t.printerListInactive=a("filter")(t.printerList,{active:!1}),t.printerWithJobs=[];let I=O.length;t.stateTime=new Date().getTime(),angular.forEach(O,function(k){w(k),(c||typeof t.printerConfig[k.slug]=="undefined")&&(I++,e.send("getPrinterConfig",{printer:k.slug}).then(function(B){Object.entries(B).length?(B.isZBelt=B.shape.basicShape.shape==="zbelt",t.printerConfig[k.slug]=B,t.printer[k.slug]&&t.printer[k.slug].local.showAbsolutePositions===void 0&&(t.printer[k.slug].local.showAbsolutePositions=B.movement.startWithAbsolutePositions),t.activeConfig=t.printerConfig[t.activeSlug],I--,c&&I===0&&(c=!1,y.resolve(),b()),t.$broadcast("loadedPrinterConfig",k.slug)):delete t.printer[k.slug]})),I--}),c&&I===0&&(c=!1,y.resolve(),b()),t.$broadcast("printerListUpdated",t.printerList)}},T=function(){d!==null&&d!==!0&&i.cancel(d),d=!0,e.send("listPrinter",{}).then(function(O){E(O),d=i(T,5e3)},function(){d=null})},A=function(O,P){O.fans&&O.fans.forEach(function(L){L.percent=Math.floor(.5+L.voltage/2.55)}),t.printer[P].status?(O.isJobActive=t.printer[P].status.jobstate==="running",O.canMove=!O.doorOpen||t.printerConfig&&t.printerConfig[P]&&t.printerConfig[P].general.doorHandling!==2):(O.isJobActive=!1,O.canMove=!1)},C=function(O,P){let L=t.printer[O];if(L)if(P.x!==void 0){let I=L.state.x!==P.x||L.state.x!==P.y||L.state.x!==P.z;L.state&&L.state.heatedBeds&&L.state.heatedBeds[0]&&L.state.heatedBeds[0].history&&!P.heatedBeds[0].history&&(P.heatedBeds[0].history=L.state.heatedBeds[0].history),L.state&&L.state.heatedChambers&&L.state.heatedChambers[0]&&L.state.heatedChambers[0].history&&!P.heatedChambers[0].history&&(P.heatedChambers[0].history=L.state.heatedChambers[0].history),angular.forEach(P.extruder,function(k,B){!k.history&&L.state&&L.state.extruder&&L.state.extruder[B]&&L.state.extruder[B].history&&(k.history=L.state.extruder[B].history)}),L.state=P,A(L.state,O),I&&O===t.activeSlug&&t.$broadcast("toolMoved",{data:L.state})}else L.state=Object.assign({},L.state,P),L.state.isJobActive=!1,L.state.canMove=!1},M=function(){if(m!==null&&m!==!0&&i.cancel(m),!l.isLoggedIn){m=i(M,2e3);return}m=!0,e.send("stateList",{includeHistory:f}).then(function(O){t.stateTime=new Date().getTime(),angular.forEach(O,function(P,L){C(L,P)}),f=!1,m=i(M,2e3)},function(){m=i(M,2e3)})};t.$on("state",function(O,P){P&&P.printer&&t.printer[P.printer]&&(angular.extend(t.printer[P.printer].state,P.data),A(t.printer[P.printer].state,P.printer))}),t.$on("updatePrinterState",function(O,P){C(P.printer,P.data)}),t.$on("printerListChanged",function(O,P){E(P.data)}),t.$on("temp",function(O,P){let L=t.printer[P.printer];if(!L||!L.state)return;let I=P.data.id;if(typeof L.state=="undefined"&&console.log("history error",L),I>=0&&typeof L.state.extruder=="undefined")return;let k=I>999?I>1999?L.state.heatedChambers[I-2e3]:L.state.heatedBeds[I-1e3]:typeof L.state.extruder[I]=="undefined"?void 0:L.state.extruder[I];if(k){for(k.history||(k.history=[]);k.history.length>0&&k.history[0].t+3e5<P.data.t;)k.history.splice(0,1);k.history.push(P.data)}}),t.$on("config",function(O,P){let L=P.data;L.isZBelt=L.shape.basicShape.shape==="zbelt",t.printerConfig[L.general.slug]=L,t.activeConfig=t.printerConfig[t.activeSlug]});function D(){e.send("getExternalLinks",{}).then(function(O){t.externalLinks=O.links,t.globalExternalLinks=[],angular.forEach(t.externalLinks,function(P){P.gui&&P.slug===""&&t.globalExternalLinks.push(P)}),t.$broadcast("int_externalLinksChanged",t.externalLinks)})}return t.$on("connected",function(){d===null&&T(),m===null&&M(),e.send("listExternalCommands",{}).then(function(O){t.externalCommands=O,t.$broadcast("externalCommandsChanged",O)}),D(),e.send("webCallsList",{}).then(function(O){t.webCalls=O.list,t.$broadcast("webCallsListChanged",O)}),e.send("GPIOGetList",{}).then(function(O){t.gpio=O.list,t.$broadcast("gpioChanged",O)}),p(),b(),x(),_()}),t.$on("externalLinksChanged",D),t.$on("recoverChanged",function(O,P){t.printer[P.printer]&&(t.printer[P.printer].recover=P.data)}),t.$on("reconnectCounter",function(O,P){t.printer[P.printer].reconnectCounter=P.data.reconnectCounter}),t.$on("webCallsChanged",function(){e.send("webCallsList",{}).then(function(O){t.webCalls=O.list,t.$broadcast("webCallsListChanged",O)})}),t.$on("gpioListChanged",function(){e.send("GPIOGetList",{}).then(function(O){t.gpio=O.list,t.$broadcast("gpioChanged",O)})}),t.$on("gpioPinChanged",function(O,P){P=P.data,t.gpio&&angular.forEach(t.gpio,function(L){P.uuid===L.uuid&&(L.state=P.state,L.pwmDutyCycle=P.pwmDutyCycle)})}),t.$on("disconnected",function(){d!==null&&d!==!0&&i.cancel(d),d=null,m!==null&&m!==!0&&i.cancel(m),m=null}),{selectPrinter:function(O){e.selectPrinter(O),t.activeSlug=O,O===""?(t.activeConfig={},t.active={}):(t.activeConfig=t.printerConfig[O],t.printer[O]&&(t.active=t.printer[O])),t.$broadcast("printerSelected",O)},runExternalCommand:function(O){let P=t.externalCommands[O],L=!1;if(P.ifAllNotPrinting&&(L=Object.values(t.printer).filter(I=>I.state.isJobActive).length>0),P.ifThisNotPrinting&&P.slug&&t.printer[P.slug]&&(L||(L=t.printer[P.slug].state.isJobActive)),L){u.error("Принтер не простаивает - выполнение остановлено!");return}P.confirm.length>0?o("Контрольный вопрос",P.confirm,"Да","Нет",!0).then(function(){P.terminal?h.go("terminalCommand",{id:O}):e.send("runExternalCommand",{id:O})},function(){}):P.terminal?h.go("terminalCommand",{id:O}):e.send("runExternalCommand",{id:O})},supportsFullscreen:function(){let O=window.document.body;return O.requestFullscreen||O.mozRequestFullScreen||O.webkitRequestFullscreen||O.msRequestFullscreen},updateStateNow:function(){setTimeout(M,100)},updatePrintersNew:function(){T()},printerListLoadedPromise:y.promise}}]).factory("RSMessages",["$rootScope","RSCom",function(t,e){let i=[];t.messages=i;let r=function(){e.send("messages",{}).then(function(l){t.messages=i=l})};t.$on("messagesChanged",function(){r()}),t.$on("connected",function(){r()});let n=function(l){let h="job";l.link.indexOf("unpause")>0&&(h="unpause"),e.send("removeMessage",{id:l.id,a:h},l.slug)},a={messages:i,remove:n,removeAll:function(){angular.forEach(i,function(l){l.link.indexOf("unpause")<0&&n(l)})}};return t.RSMessages=a,a}]).factory("Flash",function(){let t={};return toastr.options={closeButton:!1,debug:!1,positionClass:"toast-bottom-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},t.success=function(e,i,r,n){!e&&!i||(n||(n=!1),toastr.options.closeButton=n,toastr.options.timeOut=r||5e3,toastr.success(i,e))},t.info=function(e,i,r,n){!e&&!i||(n||(n=!1),toastr.options.closeButton=n,toastr.options.timeOut=r||5e3,toastr.info(i,e))},t.warning=function(e,i,r,n){!e&&!i||(n||(n=!1),toastr.options.closeButton=n,toastr.options.timeOut=r||5e3,toastr.warning(i,e))},t.error=function(e,i,r,n){!e&&!i||(n||(n=!1),toastr.options.closeButton=n,toastr.options.timeOut=r||5e3,toastr.error(i,e))},t}).factory("RSPasswordCheck",["RSCom",function(t){let e={};return t.send("getPasswordRules",{}).then(i=>{e=i}),i=>{let r=0,n=0,o=0;if(i.length<e.minLength)return"Минимальная длина пароля составляет @1".replace("@1",e.minLength);if(e.differentCharacterGroups){for(let a of i)a>="a"&&a<="z"?r=1:a>="A"&&a<="Z"?n=1:o=1;if(r+n+o<2)return"Password must contain characters of different groups a-z, A-Z and other characters"}return""}}]).factory("GSettings",["RSCom","$rootScope","$q","$state",function(t,e,i,r){let n={},o={},a=i.defer();e.serverSettings={pricing:{currency:"EUR",digits:2,perPrint:5,perHour:.3,filaments:[{u:RSUtils.createAlphaID(10),n:"PLA",p:25,w:1.25}],map:{}}},e.$on("settingChanged",function(h,u){$.extend(e.serverSettings,u.data),$.extend(o,angular.copy(u.data))}),n.serverSettingsChanged=function(){let h={};if(angular.forEach(e.serverSettings,function(u,c){angular.equals(u,o[c])||(h[c]=angular.copy(u))}),$.isEmptyObject(h)){let u=i.defer();return u.resolve(),u.promise}return o=angular.copy(e.serverSettings),t.send("updateSettings",h)};let l=function(){t.send("getSettings",{}).then(function(h){angular.extend(e.serverSettings,h),o=angular.copy(e.serverSettings),a.resolve(),e.serverSettings.policy_accepted===!1&&r.go("privacypolicy")})};return e.$on("connected",function(){l()}),t.connected&&l(),n.promise=a.promise,n}]).filter("slice",function(){return function(t,e,i){return t?(Math.abs(Number(e))===1/0?e=Number(e):e=parseInt(e),isNaN(e)?t:(i=!i||Number.isNaN(i)?0:parseInt(i),i=i<0&&i>=-t.length?t.length+i:i,e>=0?t.slice(i,i+e):i===0?t.slice(e,t.length):t.slice(Math.max(0,i+e),i))):[]}}).factory("Theme",["$rootScope",function(t){let e={mode:"auto",detected:""},i="(prefers-color-scheme: dark)",r="(prefers-color-scheme: light)";function n(l){t.theme=l,document.getElementsByTagName("html")[0].setAttribute("data-theme",l),t.$broadcast("themeChanged",l)}function o(){if(!window.matchMedia){console.log("matchMedia not supported");return}function l(c){c.matches&&(c.media===i?(e.detected="dark",e.mode==="auto"&&n("dark")):c.media===r&&(e.detected="light",e.mode==="auto"&&n("light")))}let h=window.matchMedia(i);h.addListener(l),l(h);let u=window.matchMedia(r);u.addListener(l),l(u)}function a(l){l==="auto"?e.mode!=="auto"&&(e.mode="auto",n(e.detected)):(e.mode=l,n(l))}return o(),e.setMode=a,e}]).factory("Wifi",["RSCom","$rootScope",function(t,e){let i={routerListResponse:void 0,apModeList:[{id:0,n:"Никогда не включать точку доступа"},{id:1,n:"Включать точку доступа когда подсоединено"},{id:2,n:"Всегда включать точку доступа"}]},r=!1;return i.updateRouterList=function(){r||t.connected!==!1&&(r=!0,t.send("wifiRefreshRouter",{}).then(function(n){i.routerListResponse=n,r=!1},function(){r=!1}))},i.setWifiList=function(n){i.routerListResponse=n},e.$on("wifiChanged",function(n,o){let a=i.routerListResponse.regions;i.routerListResponse=Object.assign(i.routerListResponse,o.data,{ethernet:Object.assign(i.routerListResponse.ethernet,o.data.ethernet)}),i.routerListResponse.regions=a}),i.refreshRouterList=function(){r||t.connected!==!1&&(r=!0,t.send("wifiRefreshRouter").then(function(n){i.routerListResponse=n,r=!1},function(){r=!1}))},i.eth=function(){return i.routerListResponse.ethernet},i.getRouterList=function(){return i.routerListResponse?i.routerListResponse.routerList:[]},i.getManageable=function(){return i.routerListResponse?i.routerListResponse.manageable:(i.updateRouterList(),!1)},i.manualWifi=function(){return i.routerListResponse.manualWifi},i.getHostname=function(){return i.routerListResponse.hostname},i.setHostname=function(n){t.send("wifiSetHostname",{hostname:n})},i.getAPSSID=function(){return i.routerListResponse.apSSID},i.setAPSSID=function(n){t.send("wifiSetAPSSID",{ssid:n})},i.setAPPassword=function(n){t.send("wifiSetAPPassword",{password:n})},i.getAPMode=function(){return i.routerListResponse.apMode},i.getSupportAP=function(){return i.routerListResponse.supportAP},i.setAPMode=function(n){t.send("wifiSetAPMode",{apMode:n})},i.getAPChannel=function(){return i.routerListResponse.channel},i.setAPChannel=function(n){t.send("wifiSetAPChannel",{channel:n})},i.getRegion=function(){return i.routerListResponse.country},i.setRegion=function(n){t.send("wifiSetCountry",{country:n})},i.setAPPassword=function(n){t.send("wifiSetAPPassword",{password:n})},i.connect=function(n){return t.send("wifiConnect",{uuid:n})},i.activateAP=function(){t.send("wifiActivateAP",{})},i.updateRouterList(),i}]);var g0=Qi(ta());window.RSUserModule=angular.module("RSUser",["ui.router","RSBase","LocalStorageModule"]).factory("User",["$rootScope","$location","$q","localStorageService","$state","Theme","$http",function(t,e,i,r,n,o,a){let l=15,h="";function u(){let p=window.location.href,_="",x=p.indexOf("#");x>-1&&(_=p.substring(x),p=p.substring(0,x));let b=p.split("?")[0]+"?",y=decodeURIComponent(window.location.search.substring(1)),w=y.split("&"),S,R=!1;for(let E=0;E<w.length;E++)S=w[E].split("="),S[0]!=="login"&&S[0]!=="password"?b=b+S[0]+"="+S[1]+"&":R=!0;b=b.substring(0,b.length-1)+_,R&&(window.location.href=b)}let c=!1,f=i.defer(),d={},m=!1,v={isLoggedIn:!1,isRealUser:!1,loggedIn:function(){return c||h===""&&l!==0},realUser:function(){return h!==""&&h!=="global"},canPrint:function(){return(l&1)===1},canAddFiles:function(){return(l&2)===2},canDeleteFiles:function(){return(l&4)===4},canChangeConfig:function(){return(l&8)===8},canHistory:function(){return(l&16)===16},canSeeProjects:function(){return(l&32)===32},canEditProjects:function(){return(l&64)===64},canReadFiles:function(){return(l&256)===256},canFullStop:function(){return(l&512)===512},canManageAccounts:function(){return(l&1024)===1024},isAdmin:function(){return(l&2048)===2048},canChangePassword:function(){return(l&6144)!==0},getLogin:function(){return h},printPermission:!1,readPermission:!1,addPermission:!1,delPermission:!1,changeConfigPermission:!1,historyPermission:!1,seeProjectsPermission:!1,editProjectsPermission:!1,fullStopPermission:!1,manageAccountsPermission:!1,adminPermission:!1,changePasswordPermission:!1,animatedLogin:!1,sessionStarted:function(){return f.promise},getSetting:function(p,_){return typeof d[p]=="undefined"&&(t.RSCom.send("updateUserSetting",{key:p,value:_}),d[p]=_),d[p]},setSetting:function(p,_){d[p]!==_&&(d[p]=_,t.RSCom.send("updateUserSetting",{key:p,value:_}),t.$broadcast("userSettingsChanged"))}},g=function(){let p=[];angular.forEach(t.externalCommands,function(_){_.permPrint&&!v.printPermission||_.permConfig&&!v.changeConfigPermission||_.permAdd&&!v.addPermission||_.permDel&&!v.delPermission||p.push(_)}),t.externalCommandsFiltered=p};return v.logout=function(){v.isLoggedIn===!1&&h===""||(v.setPermissions(0),h="",c=!1,v.isLoggedIn=!1,v.isRealUser=!1,t.RSCom&&t.RSCom.stopConnection(),a.post("/global/user/logout",{}),n.go("login"),t.RSCom)},v.logoutFromOutside=function(){v.isLoggedIn===!1&&h===""||(v.setPermissions(0),h="",c=!1,v.isLoggedIn=!1,v.isRealUser=!1,m=!1,n.go("login"))},v.setPermissions=function(p){l=p,v.permissions=p,v.printPermission=v.canPrint(),v.readPermission=v.canReadFiles(),v.addPermission=v.canAddFiles(),v.delPermission=v.canDeleteFiles(),v.changeConfigPermission=v.canChangeConfig(),v.historyPermission=v.canHistory(),v.seeProjectsPermission=v.canSeeProjects(),v.editProjectsPermission=v.canEditProjects(),v.fullStopPermission=v.canFullStop(),v.manageAccountsPermission=v.canManageAccounts(),v.adminPermission=v.isAdmin(),v.changePasswordPermission=v.canChangePassword(),t.frontend.visible["user.printPermission"]=v.printPermission,t.frontend.visible["user.addPermission"]=v.addPermission,t.frontend.visible["user.readPermission"]=v.readPermission,t.frontend.visible["user.delPermission"]=v.delPermission,t.frontend.visible["user.changeConfigPermission"]=v.changeConfigPermission,t.frontend.visible["user.historyPermission"]=v.historyPermission,t.frontend.visible["user.seeProjectsPermission"]=v.seePermission,t.frontend.visible["user.editProjectsPermission"]=v.editPermission,t.frontend.visible["user.fullStopPermission"]=v.fullStopPermission,g()},v.refreshSession=async function(p){if(e.path()==="/login"||e.path()==="/login")return v.isLoggedIn;c=!1,m=!0;try{let _=await a.post("/global/user/verify",{});return g0.default.defaults.headers.common["X-Csrf-Token"]=p.getCookie("Csrf-Token"),_.data.ok?(v.setCredentialsFromServer(_.data),!0):(e.path()!=="/login"?t.pathAfterLogin=e.path():t.pathAfterLogin="/",v.logout(),!1)}catch(_){return!1}},v.recheckLogin=function(){return c||a.post("/global/user/verify",{}).then(function(p){v.animatedLogin=p.data.animatedLogin,g0.default.defaults.headers.common["X-Csrf-Token"]=t.RSCom.getCookie("Csrf-Token"),p.data.ok&&(v.setCredentialsFromServer(p.data),t.RSCom.startConnection())}),!0},v.autologin=function(p){return m||c||(c=!1,m=!0,a.post("/global/user/verify",{}).then(function(_){g0.default.defaults.headers.common["X-Csrf-Token"]=p.getCookie("Csrf-Token"),_.data.ok?(v.setCredentialsFromServer(_.data),p.startConnection()):e.path("/login")})),!0},v.setCredentials=function(p){let _=c;c=!0,v.setPermissions(p.permissions),h=p.login,d=p.settings,v.isLoggedIn=v.loggedIn(),v.isRealUser=v.realUser(),u(),_||t.$broadcast("connected");let x=v.getSetting("theme","auto");o.setMode(x),f.resolve(),t.$broadcast("userSettingsChanged")},v.setCredentialsFromServer=function(p){let _=c;c=!0,v.setPermissions(p.permissions),h=p.login,d=p.settings,v.isLoggedIn=v.loggedIn(),v.isRealUser=v.realUser(),u(),_||t.$broadcast("connected"),(n.is("login")||e.path()==="/login")&&n.go("home");let x=v.getSetting("theme","auto");o.setMode(x),f.resolve(),t.$broadcast("userSettingsChanged")},t.$on("userCredentials",function(p,_){v.setCredentialsFromServer(_.data)}),t.$on("logout",()=>{v.logoutFromOutside()}),t.$on("disconnected",function(){m=!1}),t.$on("externalCommandsChanged",function(){g()}),v}]);RSBase.factory("RSFirmware",["$q","$rootScope","RSCom","$filter",function(t,e,i,r){let n={},o=t.defer();n.firmwareNames=[],n.firmwareInfo=[],n.firmwareInfoMap={};let a=function(){i.send("listFirmwareNames",{}).then(function(h){n.firmwareNames=r("orderBy")(h.firmwareNames,"",!1),o.resolve()})},l=function(){i.send("listFirmwareInfo",{}).then(function(h){n.firmwareInfo=r("orderBy")(h.firmwareInfo,"name",!1),n.firmwareInfo.forEach(function(u){n.firmwareInfoMap[u.name]=u}),o.resolve()})};return e.$on("connected",function(){n.firmwareNames.length===0&&a(),l()}),a(),l(),n.promise=t.all([o]),n}]);var LB=Qi(RB());RSBase.factory("RSPrinters",["$q","RSPrinter","$rootScope","$uibModal","RSOverview","Confirm","RSCom","Flash","$state","Info",function(t,e,i,r,n,o,a,l,h,u){let c={};i.globals||(i.globals={}),c.globals=i.globals,c.addPrinter=function(){r.open({templateUrl:"/views/printer/dialog/addPrinter.php?lang="+lang,controller:["$scope","$uibModalInstance","RSCom",function(d,m,v){d.newprinter={name:"",slug:""},d.createPrinter=function(){d.newprinter.errors={},d.newprinter.name.length===0&&(d.newprinter.errors.name="Имя принтера не дано."),d.newprinter.slug.match(/^[a-zA-Z0-9]+$/)||(d.newprinter.errors.slug="Допускаются только a-z, A-Z и 0-9."),typeof i.printerConfig[d.newprinter.slug]!="undefined"&&(d.newprinter.errors.slug="Короткое имя уже используется."),!(Object.keys(d.newprinter.errors).length>0)&&v.send("createConfiguration",d.newprinter).then(function(){m.close()})},d.close=function(){m.dismiss()}}]}).result.catch(function(d){})},c.backupPrinter=function(d){r.open({templateUrl:"/views/printer/dialog/backupPrinter.php?lang="+lang,controller:["$scope","$uibModalInstance",function(m,v){m.printerSlug=d.slug,m.backupJobs=!1,m.backupModels=!1,m.backupConfig=!0,m.backupTimelapse=!1,m.restoreId=-1,m.backupLogs=!1,m.folderSizes={logs:{count:0,size:0},jobs:{entryCount:0,count:0,size:0,countFiltered:0},models:{entryCount:0,count:0,size:0,countFiltered:0},timelapse:{entryCount:0,count:0,size:0,countFiltered:0}},m.getBackupRequestLink=function(){return"/printer/pconfig/"+m.printerSlug+"?a=download&exportModels="+m.backupModels+"&exportJobs="+m.backupJobs+"&exportLogs="+m.backupLogs+"&exportConfig="+m.backupConfig+"&exportTimelapse="+m.backupTimelapse},m.fetchFolderSize=function(){return console.log(m.printerSlug),new Promise((g,p)=>{a.send("getPrinterFolderInfo",{},m.printerSlug).then(_=>{_.ok?g(_.data):p(_)})})},m.getFolderSizes=async function(){m.folderSizes={logs:{count:0,size:0,countFiltered:0},jobs:{entryCount:0,count:0,size:0,countFiltered:0},models:{entryCount:0,count:0,size:0,countFiltered:0},timelapse:{entryCount:0,count:0,size:0,countFiltered:0}},m.folderSizes=await m.fetchFolderSize()},m.getFolderSizes(),m.toggleSelectAll=function(){m.folderSizes.jobs.countFiltered&&(m.backupJobs=m.selectAll),m.folderSizes.models.countFiltered&&(m.backupModels=m.selectAll),m.folderSizes.timelapse.countFiltered&&(m.backupTimelapse=m.selectAll),m.folderSizes.logs.count&&(m.backupLogs=m.selectAll),m.backupConfig=m.selectAll},m.close=function(){v.dismiss()}}]}).result.catch(function(m){})},c.uploadPrinter=function(d){r.open({templateUrl:"/views/printer/dialog/uploadPrinter.php?lang="+lang,backdrop:"static",controller:["$scope","$uibModalInstance",function(m,v){m.confupload=d?{mode:0,name:d.name,slug:d.slug}:{mode:1,name:"",overwriteConnection:!1,keepPermanentVariables:!1,slug:""};let g=100;m.ports=[],m.menuPort=!1,m.getRestoreRequestUrl=function(){return d?"/printer/pconfig/"+d.slug+"/":"/printer/pconfig/"},m.getPorts=function(){a.send("listPorts",{}).then(function(p){m.ports=p})},m.getPorts(),m.confOptions={format:0,printerName:"",connectionMethod:0,serialPort:"",pipe:"",ipAdr:"",ipPort:0,jobs:{available:!1,restore:!1,size:0,count:0,countFiltered:0},models:{available:!1,restore:!1,size:0,count:0,countFiltered:0},timelapses:{available:!1,restore:!1,size:0,count:0,countFiltered:0},logs:{available:!1,restore:!1,size:0,count:0,countFiltered:0},config:{available:!1,restore:!1,size:0,count:0,countFiltered:0}},m.selectAll=!1,m.selectedfilename="",m.uploadConfigProgress=0,m.restoreProgress=0,m.diskUsage={capacity:0,available:0},m.spaceNeeded=0,m.toggleSelectAll=function(){m.confOptions.jobs.available&&(m.confOptions.jobs.restore=m.selectAll),m.confOptions.models.available&&(m.confOptions.models.restore=m.selectAll),m.confOptions.timelapses.available&&(m.confOptions.timelapses.restore=m.selectAll),m.confOptions.logs.available&&(m.confOptions.logs.restore=m.selectAll),m.confOptions.config.available&&m.confupload.mode!==1&&(m.confOptions.config.restore=m.selectAll)},m.checkDiskSpaceForRestore=function(){if($("#confuploadbutton")[0].files[0]!==void 0){g=$("#confuploadbutton")[0].files[0].size;let p=0;return angular.forEach(m.confOptions,_=>{_.restore&&(p+=_.size)}),m.spaceNeeded=m.diskUsage.available-(p+g+100*1024*1024),m.spaceNeeded>0}else return!1},m.analyzeRPCFile=function(){a.send("freeSpace",{}).then(function(y){m.diskUsage=y}),m.confOptions={format:0,printerName:"",connectionMethod:0,serialPort:"",pipe:"",ipAdr:"",ipPort:0,jobs:{available:!1,restore:!1,size:0,count:0,countFiltered:0},models:{available:!1,restore:!1,size:0,count:0,countFiltered:0},timelapses:{available:!1,restore:!1,size:0,count:0,countFiltered:0},logs:{available:!1,restore:!1,size:0,count:0,countFiltered:0},config:{available:!1,restore:!1,size:0,count:0,countFiltered:0}};let p=$("#confuploadbutton")[0].files[0],_=t.defer(),x=new FileReader;x.onload=function(y){let w=new DataView(x.result),S="";for(let R=0;R!==3;R++)S+=String.fromCharCode(w.getUint8(R));if(S==="<?x"){m.confOptions.format=1;return}if(S==="rpc"){m.confOptions.format=2;let R=new FileReader;R.onerror=_.reject.bind(_),R.onload=function(T){let C=new DataView(R.result).getUint32(0,!0),M=new FileReader;M.onerror=_.reject.bind(_),M.onload=function(O){if(!M.result){_.reject(new Error("Unknown error"));return}let P=new Uint8Array(M.result),L=LB.default.decode(P),I=function(k,B,F){k.available=(L.c&B)===B,k.count=k.available?L[F+"c"]:0,k.countFiltered=k.available?L[F+"cf"]:0,k.size=k.available?L[F+"s"]:0};if(L){switch(m.confupload.restoreData=!0,m.confupload.name=L.pn,m.confOptions.connectionMethod=L.cm,m.confOptions.connectionMethod){case 0:m.confOptions.serialPort=L.pc;break;case 1:m.confOptions.pipe=L.pc;break;case 2:m.confOptions.ipAdr=L.pIpAdr,m.confOptions.ipPort=L.pIpPort;break;case 3:m.confOptions.pipe=L.pc;break}I(m.confOptions.config,16,"c"),I(m.confOptions.logs,8,"l"),I(m.confOptions.jobs,4,"j"),I(m.confOptions.models,2,"m"),I(m.confOptions.timelapses,1,"t")}};let D=p.slice(7,C+7);M.readAsArrayBuffer(D)};let E=p.slice(3,7);R.readAsArrayBuffer(E)}else m.confOptions.format=3};let b=p.slice(0,3);return x.readAsArrayBuffer(b),m.checkDiskSpaceForRestore(),_.promise},m.newPrinter=function(){window.open("#!/configWizard","_self"),v.dismiss()},m.createPrinterFromConfig=function(){m.confupload.errors={},m.selectfilename="",a.extendPing(600),!(Object.keys(m.confupload.errors).length>0)&&$("#formuploadconfig").ajaxSubmit({success:function(p){p=angular.fromJson(p),m.restoreId=p.id},uploadProgress:function(p,_,x,b){m.uploadConfigProgress=b},headers:{"X-Csrf-Token":a.getCookie("Csrf-Token")}})},m.$on("restoreFinished",(p,_)=>{m.restoreId===_.data.id&&(m.uploadConfigProgress=0,m.restoreProgress=0,a.extendPing(0),v.close(),_.data.error?(m.confupload.errors.createerror=_.data.error,l.error("Загрузка не удалась:"+_.data.error),v.close()):l.success("Загрузка завершена"))}),m.$on("restoreProgress",(p,_)=>{m.restoreProgress=Math.round(_.data/g*100)}),m.close=function(){m.uploadConfigProgress===0&&v.dismiss()},m.canUpload=function(){let p=$("#confuploadbutton").val();m.selectfilename=p.replace(/\\/g,"/").replace(/.*\//,""),m.confupload.slug=d?d.slug:c.autocreateSlug(m.confupload.name);let _=p&&p.length>4&&(p.lastIndexOf(".rpc")===p.length-4||p.lastIndexOf(".xml")===p.length-4);return _&=m.confupload.name.length>0,m.checkDiskSpaceForRestore()&&_&&(m.confupload.mode!==1||!(m.confupload.mode===1&&m.confOptions.format===2&&!m.confOptions.config.available))}}]}).result.catch(function(m){})},c.removePrinter=function(d){a.send("getKlipperStatus",{}).then(m=>{m.installations.includes(d.slug)?u("Эксплуатация запрещена","У тебя установлена установка klipper для этого принтера. Пожалуйста, сначала удали установку klipper!").then(()=>{h.go("printer.klipperConfig",{slug:d.slug})}):o("Требуется подтверждение","Действительно удалить настройки принтера для #1 и все связанные g-код файлы?".replace("#1",d.name+""),null,null,!0).then(function(){a.send("removeConfiguration",{slug:d.slug}).then(function(v){v.ok?(delete i.printerConfig[d.slug],delete i.printer[d.slug],l.success("Принтер удален"),h.go("home")):l.error("Удаление принтера не удалось! "+v.error)})},function(v){l.error("Удаление принтера не удалось! "+v.error)})},()=>{})},c.emergencyStop=function(d){a.send("emergencyStop",{},d.slug)},c.stopPrint=function(d){i.active.status.jobid&&a.send("stopJob",{id:i.active.status.jobid},d.slug)},c.pausePrint=function(d){a.send("send",{cmd:"@pause Пользователь запросил паузу."},d.slug)},c.unpausePrint=function(d){console.log("unpause",d.slug),a.send("continueJob",{},d.slug)},c.activate=function(d){a.send("activate",{printer:d.slug}).then(function(m){m.ok?l.success("Принтер активирован"):l.error("Не удалось активировать принтер",m.error,2e4,!0)})},c.deactivate=function(d){a.send("deactivate",{printer:d.slug}).then(function(){l.success("Принтер отключен")})};let f=function(d){return d>="0"&&d<="9"};return c.doesSlugExist=function(d){return typeof i.printerConfig[d]!="undefined"},c.autocreateSlug=function(d){let m="",v=0,g=d.length;for(;v<g;v++){let _=d[v];_>="a"&&_<="z"||_>="A"&&_<="Z"||_>="0"&&_<="9"||_==="_"?m+=_:_===" "&&(m+="_")}let p="";for(;m.length>0&&f(m[m.length-1]);)p=m[m.length-1]+p,m=m.substr(0,m.length-1);for(;c.doesSlugExist(m+p);)p.length===0&&(p="0"),p=(parseInt(p)+1).toString();return m+p},c.printersUsingPort=function(d,m){function v(p){let _="";return angular.forEach(i.printerList,function(x){x.slug===p&&(x.active?x.online===1?_=" (Онлайн)":x.online===2?_=" (Подсоединен)":_=" (Оффлайн)":_=" (Отключен)")}),_}let g=[];return angular.forEach(i.printerConfig,function(p,_){_===m||!p.connection||!p.connection.serial||p.connection.connectionMethod!==0||p.connection.serial.device===d&&(p.connection.serial.device==="VirtualCartesian"||p.connection.serial.device==="VirtualDelta"||g.push("<li>"+p.general.name+v(_)+"</li>"))}),g.length===0?!1:"<ul>"+g.join("")+"</ul>"},i.RSPrinters=c,c}]);RSBase.factory("RSPrinter",["$q","$rootScope","RSOverview","RSCom","$uibModal","RSPrinterConfig","$timeout","$filter","Flash","User","localStorageService","Confirm",function(t,e,i,r,n,o,a,l,h,u,c,f){let d=function(){e.activeSlug&&(m.fetchModelsFor(e.activeSlug),m.fetchPrintqueueFor(e.activeSlug),m.updateExcludeRegions())},m={excludeRegions:[],pauseNames:["Пауза","Продолжить","Предварительный нагрев","Нагрев...","Приостановить","Продолжить","Перезапуск..."],eepromLoaded:!1,eepromErrors:!1,eepromData:[]};e.RSPrinter=m,e.globals||(e.globals={}),m.globals=e.globals;let v={},g=function(C,M,D,O,P){if(P||(P=1),typeof D=="undefined")return"/mod/server/img/rendering_"+O+".png";let L=C+"_"+M+D+O;return v[L]||(v[L]="/dyn/render_image?q="+M+"&id="+D+"&slug="+C+"&t="+O+"&v="+P),e.hasFeature(1)?v[L]:"/img/pro_"+O+".png"};e.$on("connected",function(){v=[],d()}),e.$on("gcodeInfoUpdated",function(C,M){M.data.list==="jobs"?m.fetchPrintqueueFor(M.printer):m.fetchModelsFor(M.printer)}),e.$on("newRenderImage",function(C,M){let D=M.data,O=M.printer+"_"+D.list+D.id;v[O+"l"]="/dyn/render_image?q="+D.list+"&id="+D.id+"&slug="+M.printer+"&t=l&tm="+new Date().getTime(),v[O+"m"]="/dyn/render_image?q="+D.list+"&id="+D.id+"&slug="+M.printer+"&t=m&tm="+new Date().getTime(),v[O+"s"]="/dyn/render_image?q="+D.list+"&id="+D.id+"&slug="+M.printer+"&t=s&tm="+new Date().getTime(),D.list==="jobs"?m.fetchPrintqueueFor(M.printer):m.fetchModelsFor(M.printer)}),m.setActivePage=function(C,M){let D=c.get("v1PrinterPage");D===null&&(D={}),D[C]=M,c.set("v1PrinterPage",D)},m.getActivePage=function(C,M){let D=c.get("v1PrinterPage");return D===null&&(D={}),D[C]?D[C]:M},m.printingImage=function(C,M){return!e.active.status||!e.active.status.jobid?"":g(M||e.activeSlug,"jobs",e.active.status.jobid,C||"l")},m.sortModelsFor=function(C){let M=m.localFor(C),D=M.sortModelsBy||0,O=(D&1)===1,P=l("orderBy"),L=e.printer[C];switch(D&254){case 0:L.models=P(L.allModels,"name",O);break;case 2:L.models=P(L.allModels,"created",O);break;case 4:L.models=P(L.allModels,"printTime",O);break;case 6:L.models=P(L.allModels,"length",O);break;case 8:L.models=P(L.allModels,"lines",O);break;case 10:L.models=P(L.allModels,"filamentTotal",O);break;case 12:L.models=P(L.allModels,"layer",O);break}let I=(M.modelFilter||"").toLowerCase();if(I!==""&&(L.models=L.models.reduce(function(k,B){return(B.name.toLowerCase().indexOf(I)!==-1||B.notes.toLowerCase().indexOf(I)!==-1)&&k.push(B),k},[])),M.activeGroup!=="*"){let k=[];angular.forEach(L.models,function(B){B.group===M.activeGroup&&k.push(B)}),L.models=k,e.globals.gcodeView&&e.globals.gcodeView.perPage<=L.models.length&&(e.globals.gcodeView.page=1)}},m.localFor=function(C){let M=e.printer[C];if(M!==void 0)return typeof M.local=="undefined"&&(M.local={}),M.local},m.local=function(){return m.localFor(e.activeSlug)},m.showConnectionData=function(){r.send("communicationData",{}).then(function(C){n.open({templateUrl:"/views/printer/dialog/connectionData.php?lang="+lang,controller:["$scope","$uibModalInstance",function(M,D){M.comData=C,M.close=function(){D.close()}}],size:"sm"}).result.catch(function(M){})})},m.fetchPrintqueueFor=function(C){let M=e.printer[C];M&&(M.queue||(M.queue=[]),r.send("listJobs",{includeRunning:!0},C).then(function(D){M.queue=D.data,M.queueFilament=0,M.queueTime=0,M.queueLines=0;let O=m.localFor(C);angular.forEach(M.queue,function(P){P.error=P.analysed===2,P.processing=P.analysed===0,P.ok=P.analysed===1,P.list="jobs",P.imgL=g(C,"jobs",P.id,"l",P.version),P.imgM=g(C,"jobs",P.id,"m",P.version),P.imgT=g(C,"jobs",P.id,"s",P.version),O.activeGCode&&O.activeGCode.id===P.id&&O.activeGCode.list===P.list&&(O.activeGCode=P,e.$broadcast("selectActiveGCode",P,1)),P.printTimeBest=P.lastPrintTime?P.lastPrintTime:P.printTime,M.queueFilament+=P.filamentTotal*P.repeat,M.queueTime+=P.printTimeBest*P.repeat,M.queueLines+=P.lines*P.repeat})}))},m.fetchPrintqueue=function(C,M){M.printer===e.activeSlug&&m.fetchPrintqueueFor(e.activeSlug)},m.fetchModelsFor=function(C){if(!e.printer[C])return;let M=e.printer[C];M.models||(M.models=[]),r.send("listModels",{},C).then(function(D){M.allModels=D.data;let O=m.localFor(C);angular.forEach(M.allModels,function(P){P.error=P.analysed===2,P.processing=P.analysed===0,P.ok=P.analysed===1,P.list="models",P.imgL=g(C,"models",P.id,"l",P.version),P.imgM=g(C,"models",P.id,"m",P.version),P.imgT=g(C,"models",P.id,"s",P.version),typeof O.activeGCode!="undefined"&&O.activeGCode.id===P.id&&O.activeGCode.list===P.list&&(O.activeGCode=P,e.$broadcast("selectActiveGCode",P,2)),P.printTimeBest=P.lastPrintTime?P.lastPrintTime:P.printTime}),m.sortModelsFor(C)})},m.fetchModels=function(C,M){M.printer===e.activeSlug&&m.fetchModelsFor(e.activeSlug)},m.motorsOff=function(){r.send("motorsOff",{})},m.updateExcludeRegions=function(){r.send("getExcludeRegions",{}).then(function(C){m.excludeRegions=C.regions,e.$broadcast("excludeRegionsStored")})},e.$on("printqueueChanged",m.fetchPrintqueue),e.$on("jobsChanged",m.fetchModels),e.$on("excludeRegionsChanged",m.updateExcludeRegions),e.$watch("activeSlug",d),d(),m.hasFirmwareSettings=!1,m.firmwareSettings=[];let p=function(){let C=o.config,M=m.firmwareSettings;M.hasOwnProperty("KeepAliveInterval")&&M.KeepAliveInterval>1e3&&(C.connection.serial.communicationTimeout=parseInt(M.KeepAliveInterval/1e3)),M.hasOwnProperty("baudrate")&&(C.connection.serial.baudrate=M.baudrate),M.hasOwnProperty("InputBuffer")&&(C.connection.serial.inputBufferSize=M.InputBuffer),M.hasOwnProperty("PrintlineCache")&&(C.movement.movebuffer=M.PrintlineCache),M.hasOwnProperty("maxXYSpeed")&&(C.movement.maxXYSpeed=M.maxXYSpeed),M.hasOwnProperty("xyJerk")&&(C.movement.xyJerk=M.xyJerk),M.hasOwnProperty("maxZSpeed")&&(C.movement.maxZSpeed=M.maxZSpeed),M.hasOwnProperty("zJerk")&&(M.zJerk>0?C.movement.zJerk=M.zJerk:M.xyJerk>0&&(C.movement.zJerk=M.xyJerk)),M.hasOwnProperty("xPrintAcceleration")&&M.hasOwnProperty("yPrintAcceleration")&&M.xPrintAcceleration===M.yPrintAcceleration&&(C.movement.xyPrintAcceleration=M.xPrintAcceleration),M.hasOwnProperty("xyPrintAcceleration")&&(C.movement.xyPrintAcceleration=M.xyPrintAcceleration),M.hasOwnProperty("xTravelAcceleration")&&M.hasOwnProperty("yTravelAcceleration")&&M.xTravelAcceleration===M.yTravelAcceleration&&(C.movement.xyTravelAcceleration=M.xTravelAcceleration),M.hasOwnProperty("xyTravelAcceleration")&&(C.movement.xyTravelAcceleration=M.xyTravelAcceleration),M.hasOwnProperty("zPrintAcceleration")&&(C.movement.zPrintAcceleration=M.zPrintAcceleration),M.hasOwnProperty("zTravelAcceleration")&&(C.movement.zTravelAcceleration=M.zTravelAcceleration),M.hasOwnProperty("ZLength")&&(C.movement.zMax=M.ZLength),M.hasOwnProperty("RetractionSpeed")&&(C.movement.G10Speed=M.RetractionSpeed),M.hasOwnProperty("RetractionLength")&&(C.movement.G10Distance=M.RetractionLength),M.hasOwnProperty("RetractionLongLength")&&(C.movement.G10LongDistance=M.RetractionLongLength),M.hasOwnProperty("RetractionUndoSpeed")&&(C.movement.G11Speed=M.RetractionUndoSpeed),M.hasOwnProperty("RetractionUndoExtraLength")&&(C.movement.G11ExtraDistance=M.RetractionUndoExtraLength),M.hasOwnProperty("RetractionUndoExtraLongLength")&&(C.movement.G11ExtraLongDistance=M.RetractionUndoExtraLongLength),M.hasOwnProperty("RetractionZLift")&&(C.movement.G10ZLift=M.RetractionZLift),M.hasOwnProperty("XHomePos")&&(C.movement.xHome=M.XHomePos),M.hasOwnProperty("YHomePos")&&(C.movement.yHome=M.YHomePos),M.hasOwnProperty("ZHomePos")&&(C.movement.zHome=M.ZHomePos),M.hasOwnProperty("ZMin")&&(C.shape.basicShape.zMin=C.movement.zMin=M.ZMin,M.hasOwnProperty("ZLength")&&(C.shape.basicShape.zMax=C.movement.zMax=M.ZMin+M.ZLength)),M.hasOwnProperty("ZMax")&&(C.shape.basicShape.zMax=C.movement.zMax=M.ZMax),M.hasOwnProperty("printerType")?(C.general.printerVariant="cartesian",M.printerType===2&&(C.general.printerVariant="delta",C.shape.basicShape.shape="circle",M.hasOwnProperty("printableRadius")&&(C.shape.basicShape.radius=M.printableRadius,C.shape.basicShape.xMin=C.movement.xMin=-M.printableRadius,C.shape.basicShape.xMax=C.movement.xMax=M.printableRadius,C.shape.basicShape.yMin=C.movement.yMin=-M.printableRadius,C.shape.basicShape.yMax=C.movement.yMax=M.printableRadius)),M.printerType===1&&(M.hasOwnProperty("XMin")&&(C.shape.basicShape.xMin=C.movement.xMin=M.XMin,M.hasOwnProperty("XLength")&&(C.shape.basicShape.xMax=C.movement.xMax=M.XMin+M.XLength)),M.hasOwnProperty("YMin")&&(C.shape.basicShape.yMin=C.movement.yMin=M.YMin,M.hasOwnProperty("YLength")&&(C.shape.basicShape.yMax=C.movement.yMax=M.YMin+M.YLength)),M.hasOwnProperty("XMax")&&(C.shape.basicShape.xMax=C.movement.xMax=M.XMax),M.hasOwnProperty("YMax")&&(C.shape.basicShape.yMax=C.movement.yMax=M.YMax))):(M.hasOwnProperty("XMin")&&(C.shape.basicShape.xMin=C.movement.xMin=M.XMin,M.hasOwnProperty("XLength")&&(C.shape.basicShape.xMax=C.movement.xMax=M.XMin+M.XLength)),M.hasOwnProperty("YMin")&&(C.shape.basicShape.yMin=C.movement.yMin=M.YMin,M.hasOwnProperty("YLength")&&(C.shape.basicShape.yMax=C.movement.yMax=M.YMin+M.YLength)),M.hasOwnProperty("ZMin")&&(C.shape.basicShape.zMin=C.movement.zMin=M.ZMin,M.hasOwnProperty("ZLength")&&(C.shape.basicShape.zMax=C.movement.zMax=M.ZMin+M.ZLength)),M.hasOwnProperty("XMax")&&(C.shape.basicShape.xMax=C.movement.xMax=M.XMax),M.hasOwnProperty("YMax")&&(C.shape.basicShape.yMax=C.movement.yMax=M.YMax),M.hasOwnProperty("ZMax")&&(C.shape.basicShape.zMax=C.movement.zMax=M.ZMax)),M.hasOwnProperty("BedXMin")&&(C.shape.basicShape.xMin=M.BedXMin),M.hasOwnProperty("BedYMin")&&(C.shape.basicShape.yMin=M.BedYMin),M.hasOwnProperty("BedXMax")&&(C.shape.basicShape.xMax=M.BedXMax),M.hasOwnProperty("BedYMax")&&(C.shape.basicShape.yMax=M.BedYMax),M.hasOwnProperty("hasHeatedBed")&&C.heatedBeds.length===0&&C.heatedBeds.push({heatupPerSecond:.1,lastTemp:0,maxTemp:110,cooldownPerSecond:.1,temperatures:[]}),M.hasOwnProperty("hasHeatedChamber")&&C.heatedChambers.length===0&&C.heatedChambers.push({heatupPerSecond:.1,lastTemp:0,maxTemp:110,cooldownPerSecond:.1,temperatures:[]}),M.hasOwnProperty("maxBedTemp")&&(C.heatedBeds[0].maxTemp=M.maxBedTemp),M.hasOwnProperty("maxChamberTemp")&&(C.heatedChambers[0].maxTemp=M.maxChamberTemp),M.hasOwnProperty("sdInstalled")&&(C.general.sdcard=Boolean(M.sdInstalled)),M.hasOwnProperty("minFansInstalled")&&(C.general.numFans=Math.max(C.general.numFans,M.minFansInstalled)),M.hasOwnProperty("fansInstalled")&&(C.general.numFans=M.fansInstalled),M.hasOwnProperty("softwarePowerSwitch")&&(C.general.softwarePower=Boolean(M.softwarePowerSwitch)),M.hasOwnProperty("CaseLights")&&(C.general.softwareLight=Boolean(M.CaseLights)),angular.forEach(C.extruders,function(D,O){let P="["+O+"]";M.hasOwnProperty("extrJerk"+P)&&(D.eJerk=M["extrJerk"+P]),M.hasOwnProperty("extrMaxSpeed"+P)&&(D.maxSpeed=M["extrMaxSpeed"+P]),M.hasOwnProperty("extrMaxTemp"+P)&&(D.maxTemp=M["extrMaxTemp"+P]),M.hasOwnProperty("extrAcceleration"+P)&&(D.acceleration=M["extrAcceleration"+P])})};m.readingFirmware=!1;let _=null,x=function(){r.send("getFirmwareSettings",{}).then(function(C){m.firmwareSettings=C.settings,m.hasFirmwareSettings=!0,p(),m.readingFirmware=!1,e.$broadcast("firmwareConfigRead",m.firmwareSettings),_!=null&&(_.resolve(m.firmwareSettings),_=null)})},b=!1,y=null;function w(){b=!1,y=null}let S=function(C){let M=!0,D=/^-?\d+$/,O=/^-?\d+\.?\d*$/,P;C.type==="0"&&(D.exec(C.value)===null?M=!1:(P=parseInt(C.value),M=P>-128&&P<256)),C.type==="1"&&(D.exec(C.value)===null?M=!1:(P=parseInt(C.value),M=P>-32768&&P<65536)),C.type==="2"&&(D.exec(C.value)===null?M=!1:(P=parseInt(C.value),M=P>-2147483648&&P<4294967296)),C.type==="3"&&O.exec(C.value)===null&&(M=!1),M?C.value===C.valueOrig?C.class="":C.class="has-success":C.class="has-error",m.eepromErrors=m.eepromErrors||!M};m.updateEepromErrors=function(){m.eepromErrors=!1,angular.forEach(m.eepromData,function(C){S(C)})},e.$on("eepromClear",function(C,M){M.printer===e.activeSlug&&(m.eepromData=[],b=!0,y&&window.clearTimeout(y),y=window.setTimeout(w,1e3))}),e.$on("eepromData",function(C,M){if(M.printer===e.activeSlug){if(!b)return;m.eepromData=m.eepromData.concat(M.data),m.updateEepromErrors(),y&&window.clearTimeout(y),y=window.setTimeout(w,1e3)}}),e.$on("eepromImport",function(C,M){M.printer===e.activeSlug&&(angular.forEach(M.data.eeprom,function(D){angular.forEach(m.eepromData,function(O,P){D.text===O.text&&D.type===O.type&&(m.eepromData[P].value=D.value)})}),m.updateEepromErrors(),h.success("EEPROM данные импортированы"))}),m.saveEeprom=function(C,M){m.updateEepromErrors(),!m.eepromErrors&&r.send("setEeprom",{eeprom:m.eepromData}).then(function(){angular.forEach(m.eepromData,function(D){D.valueOrig=D.value}),m.updateEepromErrors(),h.success("EEPROM данные обновлены!","",3e3)})},m.eepromDescription=function(C){let M=C.indexOf("[");return M<0?C:C.substr(0,M)},m.eepromUnits=function(C){let M=C.indexOf("[");if(M<0)return"";let D=C.indexOf("]",M);return D<0?"":C.substring(M+1,D).replace("^2","\xB2").replace("^3","\xB3")},m.exportEEPROM=function(){r.send("storeEEPROMFile",{eeprom:m.eepromData}).then(function(){window.open("/printer/eeprom/"+e.activeSlug+"?a=export","_self")})},m.readEEPROM=function(){r.send("getEeprom",{})};let R=function(){m.eepromLoaded=!1,m.eepromErrors=!1,m.eepromData=[],m.hasFirmwareSettings=!1,m.firmwareSettings=[],r.send("getFirmwareSettings",{}).then(function(C){m.firmwareSettings=C.settings,m.hasFirmwareSettings=!0,e.$broadcast("firmwareConfigRead",m.firmwareSettings)})};m.updateFirmwareAutoset=function(){e.$broadcast("firmwareConfigRead",m.firmwareSettings)},m.updateFirmwareSettings=function(){return m.readingFirmware=!0,_=t.defer(),r.send("startUpdateFirmwareSettings",{}).then(function(){a(x,3e3)}),_.promise},m.setExtruderTemperature=function(C,M){r.send("setExtruderTemperature",{temperature:M,extruder:C})},m.setBedTemperature=function(C,M){M===void 0&&(M=0),r.send("setBedTemperature",{temperature:C,bedId:M})},m.setChamberTemperature=function(C,M){M===void 0&&(M=0),r.send("setChamberTemperature",{temperature:C,chamberId:M})},m.sendGCode=function(C){r.send("send",{cmd:C})},m.disableAutostartNextPrint=function(){r.send("setAutostart",{state:!1})},m.setAutostartNextPrint=function(C){C?m.enableAutostartNextPrint():m.disableAutostartNextPrint()},m.enableAutostartNextPrint=function(){r.send("setAutostart",{state:!0})},m.recomputeAllGCodeInfo=function(){r.send("recomputeAllGCodeInfo",{})},m.recomputeGCodeInfo=function(C){r.send("recomputeGCodeInfo",{id:C.id,list:C.list})},m.sendQuickCommand=function(C){r.send("sendQuickCommand",{name:C})},m.sendWizardCommand=function(C){r.send("sendWizardCommand",{uuid:C})},m.power=function(){m.sendGCode("@runButtonCommand togglePower")},m.autolevel=function(){f('Автоматический уровень кровати','Пожалуйста, убедитесь, что кровать свободна от препятствий.','Продолжить','Отменить',!0).then(function(){m.sendGCode("@runButtonCommand autolevel")})},m.emergencyStop=function(){r.send("emergencyStop",{})},m.toggleShutdownAfterPrint=function(){r.send("setShutdownAfterPrint",{shutdown:!e.active.state.shutdownAfterPrint})},m.toggleFilterFan=function(){r.send("setFilterFan",{filter:!e.active.state.filterFan})},m.speedChange=function(C){e.active.state.speedMultiply=C,r.send("setSpeedMultiply",{speed:e.active.state.speedMultiply})},m.flowChange=function(C){e.active.state.flowMultiply=C,r.send("setFlowMultiply",{speed:e.active.state.flowMultiply})},m.setFanPercent=function(C,M){r.send("setFanSpeed",{speed:Math.round(C*2.55),fanId:M})},m.setFanOn=function(C,M){e.active.state.fans[M].on=C,r.send("setFanSpeed",{speed:Math.round(e.active.state.fans[M].percent*2.55),on:C,fanId:M})},m.toggleCaseLights=function(){m.sendGCode("@runButtonCommand toggleLight")},m.xMoveRel=function(C){e.activeConfig.movement.invertX&&(C=-C),r.send("move",{x:C,relative:!0}),i.updateStateNow()},m.yMoveRel=function(C){e.activeConfig.movement.invertY&&(C=-C),r.send("move",{y:C,relative:!0}),i.updateStateNow()},m.zMoveRel=function(C){e.activeConfig.movement.invertZ&&(C=-C),r.send("move",{z:C,relative:!0}),i.updateStateNow()},m.eMoveRel=function(C,M){r.send("move",{e:C,relative:!0,speed:M}),i.updateStateNow()},m.selectExtruder=function(C){r.send("activateExtruder",{extruder:parseInt(C)}),e.active.state.activeExtruder=C,i.updateStateNow()},m.runScript=function(C){r.send("runScript",{script:C})},m.activate=function(){r.send("activate",{printer:slug})},m.deactivate=function(){r.send("deactivate",{printer:slug})},m.stopPrint=function(){e.active.status.jobid&&r.send("stopJob",{id:e.active.status.jobid})},m.pausePrint=function(){r.send("send",{cmd:"@pause Пользователь запросил паузу."})},m.unpausePrint=function(){r.send("continueJob",{})};let E=["Экструдер","Фрезерная головка","Лазер","Шприц","Камера с подогревом"],T=["rs rs-extruder","rs rs-mill","rs rs-laser","rs rs-syringe","rs rs-chamber"],A=["Диаметр сопла","Ширина фрезерования","Диаметр лазера","Диаметр шприца","Диаметр"];return m.extruderName=function(C){if(e.activeConfig&&e.activeConfig.extruders&&C>=0&&C<e.activeConfig.extruders.length){let M=e.activeConfig.extruders[C].alias;return M||E[e.activeConfig.extruders[C].toolType]+" "+(C+1)}return"Экструдер "+(C+1)},m.extruderIcon=function(C){return e.activeConfig&&e.activeConfig.extruders&&C>=0&&C<e.activeConfig.extruders.length?T[e.activeConfig.extruders[C].toolType]:T[0]},m.extruderDiameterName=function(C){return e.activeConfig&&e.activeConfig.extruders&&C>=0&&C<e.activeConfig.extruders.length?A[e.activeConfig.extruders[C].toolType]:A[0]},e.$on("printerSelected",R),e.activeSlug&&R(),m}]);RSBase.factory("Confirm",["$uibModal","$sce",function(t,e){return function(i,r,n,o,a,l,h){let u=t.open({templateUrl:"/views/base/confirm.php?lang="+lang,controller:["$scope","$uibModalInstance",function(c,f){c.infoText=r,c.infoHeader=i,c.infoYes=n||"Да",c.infoNo=o||"Нет",c.infoHtml=e.trustAsHtml(l||""),c.infoNoClass="",c.infoYesClass="",h&&(c.infoNoClass+="hidden "),a?(c.infoYesClass+="btn-danger",c.infoNoClass+="btn-primary"):(c.infoYesClass+="btn-primary",c.infoNoClass+="btn-default"),c.confirmNo=function(){f.dismiss()},c.confirmYes=function(){f.close()}}],size:"lg"});return u.result.catch(function(c){}),u.result}}]).factory("Info",["$uibModal",function(t){return function(e,i,r){let n=t.open({templateUrl:"/views/base/info.php?lang="+lang,controller:["$scope","$uibModalInstance",function(o,a){o.infoText=i,o.infoHeader=e,o.infoOk=r||"хорошо",o.infoOkClass="btn-primary",o.ok=function(){a.close()}}],size:"lg"});return n.result.catch(function(o){}),n.result}}]).factory("StringDialog",["$uibModal",function(t){return function(e,i,r,n,o,a){let l=t.open({templateUrl:"/views/base/string.php?lang="+lang,controller:["$scope","$uibModalInstance",function(h,u){h.value=r,h.infoText=i,h.infoHeader=e,h.infoYes=n||"Ок",h.infoNo=o||"Отменить",a?(h.infoYesClass="btn-danger",h.infoNoClass="btn-primary"):(h.infoYesClass="btn-primary",h.infoNoClass="btn-default"),h.confirmNo=function(){u.dismiss()},h.confirmYes=function(){u.close(h.value)},setTimeout(function(){let c=document.getElementById("textinput");c&&c.focus()},200)}],size:"sm",backdrop:"static"});return l.result.catch(function(h){}),l.result}}]);RSBase.filter("online",function(){return function(t){return t.active?t.online?t.done?'<span class="label label-success label-online">'+t.done.toFixed(1)+"%</span>":t.online===1?`<span class="label label-success label-online">Онлайн</span>`:`<span class="label label-warning label-online">Подсоединен</span>`:`<span class="label label-danger label-online">Оффлайн</span>`:`<span class="label label-default label-online">Отключен</span>`}}).filter("onlinecircle",function(){return function(t){return t?t.active?t.online===1?`<span class="fg-success" title="Онлайн"><i class="fa fa-link fa-lg"></i></span>`:t.online===2?`<span class="fg-warning" title="Подсоединен"><i class="fa fa-signal fa-lg"></i></span>`:`<span class="fg-danger" title="Оффлайн"><i class="fa fa-unlink fa-lg" ></i></span>`:`<span style="color:#999999" title="Отключен"><i class="fa fa-power-off fa-lg"></i></span>`:""}}).filter("printerConditionIconHome",function(){return function(t){if(!t)return"";if(!t.status.active)return"fa fa-power-off";if(t.status.online===0)return"fa fa-unlink";switch(t.state.condition){case 0:return"fa fa-link";case 1:return"fa fa-link";case 2:return"fa fa-warning fg-warning";case 3:return"fa fa-exclamation";case 4:return"fa fa-warning";case 5:return"fa fa-power-off"}return"fa fa-link"}}).filter("printerConditionIcon",function(){return function(t){if(!t)return"";if(!t.status.active)return'<span style="color:#999999"><i class="fa fa-power-off fa-lg margin-right"></i></span>';if(t.status.online===0)return'<span class="fg-danger"><i class="fa fa-unlink fa-lg" ></i></span>';switch(t.state.condition){case 0:return'<span class="fa fa-lg fa-question fg-gray margin-right"></span>';case 1:return'<span class="fa fa-lg fa-check fg-success margin-right"></span>';case 2:return'<span class="fa fa-lg fa-warning fg-warning margin-right"></span>';case 3:return'<span class="fa fa-lg fa-exclamation fg-danger margin-right"></span>';case 4:return'<span class="fa fa-lg fa-warning fg-warning margin-right"></span>';case 5:return'<span class="fa fa-lg fa-power-off fg-gray margin-right"></span>'}return""}}).filter("printerConditionText",function(){return function(t){if(!t)return"";if(!t.status.active)return"Отключен";if(t.status.online===0)return"Оффлайн";switch(t.state.condition){case 0:return"Ожидание общения";case 1:return"Онлайн";case 2:return"Выключить";case 3:return"Ошибка";case 4:return"Проблемы с принтером";case 5:return"Оффлайн"}return""}}).filter("onlineclass",function(){return function(t){return t.active?t.online===1?"success":t.online===2?"warning":"danger":"default"}}).filter("onlinepanel",function(){return function(t){return t.active?t.online===1?"panel-green":t.online===2?"panel-warning":"panel-red":"panel-default"}}).filter("temp",function(){return function(t){return t===0?"Выкл":t===-333?"DEF":t===-444?"DEC":t+"\xB0C"}}).filter("printing",function(){return function(t){return t.job==="none"?"Нет текущей задачи":t.job}}).filter("byte",function(){return function(t){return t<1024?t+" байт":(t/=1024,t<1024?t.toFixed(1)+" кб":(t/=1024,t<1024?t.toFixed(1)+" Mб":(t/=1024,t.toFixed(1)+" Гб")))}}).filter("hms",function(){function t(e){return e=e.toFixed(0),e.length===1?"0"+e:e}return function(e){if(e<0)return"Вычисление ...";var i=Math.floor(e/3600);e-=3600*i;var r=Math.floor(e/60);e-=r*60;var n="";return i>0&&(n+=i+"h "),(r>0||i>0)&&(n+=r+"m "),i>0?n:n+Math.round(e)+"s"}}).filter("hmsFinal",function(){function t(e){return e=e.toFixed(0),e.length===1?"0"+e:e}return function(e){if(e<0)return"0s";var i=Math.floor(e/3600);e-=3600*i;var r=Math.floor(e/60);e-=r*60;var n="";return i>0&&(n+=i+"h "),(r>0||i>0)&&(n+=r+"m "),i>0?n:n+Math.round(e)+"s"}}).filter("dhms",function(){function t(e){return e=e.toFixed(0),e.length===1?"0"+e:e}return function(e){if(e<0)return"Вычисление ...";var i=Math.floor(e/3600);e-=3600*i;var r=0;i>23&&(r=Math.floor(i/24),i-=r*24);var n=Math.floor(e/60);e-=n*60;var o="";return r>0&&(o+=r+"d "),(i>0||r>0)&&(o+=i+"h "),(n>0||i>0)&&(o+=t(n)+"m "),r===0&&(o+=t(e)+"s "),o}}).filter("permissions",function(){return function(t){let e="";return t&2048&&(e+=" / Администратор"),t&1024&&(e+=" / Управление учетными записями"),t&4096&&(e+=" / Изменить пароль"),t&1&&(e+=" / Печать"),t&512&&(e+=" / Полная остановка \/ Остановка \/ Пауза \/ Деактивация"),t&256&&(e+=" / Прочитать файлы"),t&2&&(e+=" / Добавить файлы"),t&4&&(e+=" / Удаление файлы"),t&8&&(e+=" / Настроить"),t&16&&(e+=" / История"),t&32&&(e+=" / См. раздел Проекты"),t&64&&(e+=" / Редактировать проекты"),e.length>0&&(e=e.substring(3)),e}}).filter("yesno",function(){return function(t){return t?"Да":"Нет"}}).filter("onoff",function(){return function(t){return t?"Вкл":"Выкл"}}).filter("convertReturn",function(){return function(t){return t.replace(/</g,"&lt;").replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n/g,"<br>")}}).filter("matches",function(){return function(t,e,i){var r=[];if(t)for(var n=0;n<t.length;n++){var o=t[n];o[e]===i&&r.push(o)}return r}}).filter("tempRead",function(){return function(t,e){return e||(e=0),typeof t=="undefined"?"":t===-333?"DEF":t===-444?"DEC":t.toFixed(e)+"\xB0C"}}).filter("cropLogName",function(){return function(t){let e=t.split("_").slice(1).join("_");return e.length==0&&(e=t),e}}).filter("tempFull",function(){return function(t,e){return e||(e=0),t?t.tempRead===-333?"DEF":t.tempRead===-444?"DEC":t.tempRead.toFixed(e)+"\xB0C / "+(t.tempSet===0?"Выкл":t.tempSet.toFixed(0)+"\xB0C"):""}}).filter("unsafe",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]);(function(){let t=[],e=[],i=[],r={setupMenu:[],printerMenu:[],printerTabs:[],printerConfigTabs:[],globalSettings:[],visible:{true:!0,false:!1}};function n(a,l){return a.prio<l.prio?-1:a.prio>l.prio?1:0}r.registerPrinterMenuEntry=function(a){a.prio||(a.prio=1e4),t.push(a),t.sort(n)},r.registerSetupMenuEntry=function(a){a.prio||(a.prio=1e4),r.setupMenu.push(a),r.setupMenu.sort(n)},r.registerPrinterTab=function(a){a.prio||(a.prio=1e4),e.push(a),e.sort(n)},r.setPrinterTabNameByState=function(a,l){angular.forEach(e,function(h){h.state===a&&(h.name=l)})},r.setPrinterTabIconByState=function(a,l){angular.forEach(e,function(h){h.state===a&&(h.icon=l)})},r.registerPrinterConfigTab=function(a){a.prio||(a.prio=1e4),i.push(a),i.sort(n)},r.registerGlobalSettingsConfig=function(a){r.globalSettings.push(a)},r.setVisible=function(a,l){r.visible[a]=l};let o=function(a,l,h){return a.visible&&!r.visible[a.visible]||a.requireOnline&&!l?!1:!(a.requireActive&&!h)};RSBase.provider("RSFrontend",[function(){this.$get=function(){return r},this.registerPrinterTab=r.registerPrinterTab,this.setPrinterTabNameByState=r.setPrinterTabNameByState,this.registerPrinterConfigTab=r.registerPrinterConfigTab,this.registerSetupMenuEntry=r.registerSetupMenuEntry,this.registerGlobalSettingsConfig=r.registerGlobalSettingsConfig,this.registerPrinterMenuEntry=r.registerPrinterMenuEntry,this.setVisible=r.setVisible}]),RSBase.run(["$rootScope","RSFrontend",function(a,l){a.frontend=l;let h=function(){let u=a.active&&a.active.status&&a.active.status.online===1,c=a.active&&a.active.status&&a.active.status.active;r.printerTabs=[],angular.forEach(e,function(f){o(f,u,c)&&r.printerTabs.push(f)}),r.printerConfigTabs=[],angular.forEach(i,function(f){o(f,u,c)&&r.printerConfigTabs.push(f)}),r.printerMenu=[],angular.forEach(t,function(f){o(f,u,c)&&r.printerMenu.push(f)})};r.setVisible=function(u,c){r.visible[u]=c,h()},a.$watch("active.status.online",h),a.$watch("active.status.active",h),h()}])})();RSBase.controller("PushMessageController",["$scope","$rootScope","RSCom","GSettings","RSGS","Flash",function(t,e,i,r,n,o){t.textThirdParty="Здесь ты можешь ввести API-ссылку своего внешнего push-сервиса для отправки сообщения. Пожалуйста, используй для текстового параметра заполнитель {{message}}. Пример с CallMeBot смотри в статье",t.groupId=e.serverSettings.g_push_group;let a=e.serverSettings.g_push_group;t.serverSettingsChanged=r.serverSettingsChanged,t.timeout=30,e.$watch("serverSettings.g_push_group",function(u){u!==a&&(a=t.groupId=u)}),e.$watch("serverSettings.g_push_print_busy_timeout",function(u){t.timeout=u}),t.$watch("timeout",function(u){u&&u>=10&&(e.serverSettings.g_push_print_busy_timeout=u,r.serverSettingsChanged())});function l(u){return u.length===29}function h(u){u=Zc("-","",u.toUpperCase()).trim();let c="";for(let f=0;f<u.length;f++){let d=u.charAt(f);(d>="0"&&d<="9"||d>="A"&&d<="Z")&&(c+=d)}for(u=c.substr(0,25),c="";u.length>0;)c+=u.substr(0,5),u.length>5?(c+="-",u=u.substr(5)):u="";return c}t.$watch("groupId",function(u){if(typeof u=="undefined")return;let c=h(u);c!==u&&(t.groupId=c),l(c)&&(e.serverSettings.g_push_group=c,r.serverSettingsChanged())}),t.sendTestMessage=function(u){let c=u==="repetierInformer"?"testPushMessage":"";c=u==="pushover"?"testPushoverPushMessage":c,c=u==="thirdParty"?"testThirdPartyPushMessage":c,i.send(c,{}).then(function(f){f.send?o.success("Всплывающее сообщение отправлено"):o.error("Не удалось отправить всплывающее уведомление")})}}]);RSBase.controller("UpdateController",["$scope","$rootScope","RSCom","Flash","GSettings","$timeout",function(t,e,i,r,n,o){t.checkingUpdate=!0,t.updateError="",t.registerResult="",t.isUpdating=!1,t.licence={licence:"",active:!1,wantsBranding:!1,hasBranding:!1};let a=function(){i.send("getLicenceData",{}).then(function(h){t.licence=h})};function l(){i.send("checkForUpdates",{}).then(function(){i.updateImportant()}),a()}l(),t.$on("newUpdateLoaded",function(){o(function(){t.checkingUpdate=!1},500)}),t.autoupdate=function(){t.isUpdating||(t.isUpdating=!1,i.send("autoupdate",{}).then(function(h){t.isUpdating=!0,t.updateError=h.error,h.error===""?(r.success("Автообновление начато"),e.serverSettings.ServerOS===0||e.serverSettings.ServerOS===2?t.registerResult="Загрузка и запуск обновления. Дисплей будет перезагружен по завершении.":t.registerResult="Загрузка и запуск обновления."):t.isUpdating=!1}))},t.$on("connected",function(){t.isUpdating?location.reload(!0):l()}),t.startPeriod=function(){r.info("Начало испытательного периода"),i.send("setTestperiodMode",{mode:2})}}]);RSBase.controller("RegisterController",["$scope","$rootScope","RSCom","Flash",function(t,e,i,r){t.update={},t.licence={licence:"",active:!1,wantsBranding:!1,hasBranding:!1},t.upgradeLicense="",t.upgradeLicenseValid=!1,t.licenceValid=!1,t.deactivated=!1,t.licenceError=!1,t.waitActivate=!1,t.waitDeactivate=!1,t.updateError="",t.registerResult="",t.isUpdating=!1,t.infoClass=()=>e.isOEM()?"col-xs-6":"col-xs-4";let n=function(){i.updateImportant(),i.send("getLicenceData",{}).then(function(l){t.licence=l,t.licence.wantsBranding&&!t.licence.active&&location.reload(!0)})};t.startPeriod=function(){r.info("Начало испытательного периода"),i.send("setTestperiodMode",{mode:2})},t.$on("connected",function(){t.isUpdating?location.reload(!0):n()}),t.$on("autoupdateResponse",function(l,h){h.data.code===0?t.registerResult=h.data.response:t.updateError=h.data.response,t.isUpdating=!1});function o(l){return l.length===29}function a(l){l=Zc("-","",l.toUpperCase()).trim();let h="";for(let u=0;u<l.length;u++){let c=l.charAt(u);(c>="0"&&c<="9"||c>="A"&&c<="Z")&&(h+=c)}for(l=h.substring(0,25),h="";l.length>0;)h+=l.substring(0,5),l.length>5?(h+="-",l=l.substring(5)):l="";return h}t.$watch("licence.licence",function(l){if(typeof l=="undefined")return;let h=a(l);h!==l&&(t.licence.licence=h),t.licenceValid=o(h)}),t.$watch("upgradeLicense",function(l){if(typeof l=="undefined")return;let h=a(l);h!==l&&(t.upgradeLicense=h),t.upgradeLicenseValid=o(h)}),t.clearLicense=function(){i.send("setLicenceData",{a:"clear",licence:t.licence.licence}).then(()=>{n()})},t.activate=function(){t.waitActivate=!0,i.send("setLicenceData",{a:"activate",licence:t.licence.licence}).then(function(l){t.waitActivate=!1,l.success?(t.licence.active=!0,t.deactivated=!1,t.licenceError=!1,location.reload(!0),n()):t.licenceError=l.errorMsg})},t.upgradeFromOEM=function(){t.waitActivate=!0,i.send("upgradeLicence",{licence:t.upgradeLicense}).then(function(l){t.waitActivate=!1,l.success?(t.licence.active=!0,t.deactivated=!1,t.licenceError=!1,location.reload(!0)):t.licenceError=l.errorMsg,n()})},t.deactivate=function(){t.licence.active&&(t.waitDeactivate=!0,i.send("setLicenceData",{a:"deactivate"}).then(function(l){t.waitDeactivate=!1,l.success?(t.licence.active=!1,t.deactivated=!0,t.licenceError=!1,location.reload(!0)):t.licenceError=l.errorMsg,n()}))},t.autoupdate=function(){t.isUpdating=!1,i.send("autoupdate",{}).then(function(l){t.isUpdating=!0,t.updateError=l.error,l.error===""&&(r.success("Автообновление начато"),e.serverSettings.ServerOS===0||e.serverSettings.ServerOS===2?t.registerResult="Загрузка и запуск обновления. Дисплей будет перезагружен по завершении.":t.registerResult="Загрузка и запуск обновления.")})},n()}]);RSBase.controller("RegisterBrandingController",["$scope","$rootScope","RSCom","Flash",function(t,e,i,r){t.update={},t.licence={licence:"",active:!1},t.licenceValid=!1,t.deactivated=!1,t.licenceError=!1,t.waitActivate=!1,t.waitDeactivate=!1,t.updateError="",t.registerResult="",t.isUpdating=!1;let n=function(){i.updateImportant(),i.send("getLicenceData",{}).then(function(l){t.licence=l})};t.$on("connected",function(){t.isUpdating?location.reload(!0):n()}),t.$on("autoupdateResponse",function(l,h){h.data.code===0?t.registerResult=h.data.response:t.updateError=h.data.response,t.isUpdating=!1});function o(l){return l.length===29}t.clearLicense=function(){i.send("setLicenceData",{a:"clear",licence:t.licence.licence}).then(()=>{n()})};function a(l){l=Zc("-","",l.toUpperCase()).trim();let h="";for(let u=0;u<l.length;u++){let c=l.charAt(u);(c>="0"&&c<="9"||c>="A"&&c<="Z")&&(h+=c)}for(l=h.substr(0,25),h="";l.length>0;)h+=l.substr(0,5),l.length>5?(h+="-",l=l.substr(5)):l="";return h}t.$watch("licence.licence",function(l){if(typeof l=="undefined")return;let h=a(l);h!==l&&(t.licence.licence=h),t.licenceValid=o(h)}),t.activate=function(){t.waitActivate=!0,i.send("setLicenceData",{a:"activate",licence:t.licence.licence}).then(function(l){t.waitActivate=!1,l.success?(t.licence.active=!0,t.deactivated=!1,t.licenceError=!1,window.location.href="/?lang="+window.lang):t.licenceError=l.errorMsg,n()})},t.autoupdate=function(){t.isUpdating=!1,i.send("autoupdate",{}).then(function(l){t.isUpdating=!0,t.updateError=l.error,l.error===""&&(r.success("Автообновление начато"),e.serverSettings.ServerOS===0||e.serverSettings.ServerOS===2?t.registerResult="Загрузка и запуск обновления. Дисплей будет перезагружен по завершении.":t.registerResult="Загрузка и запуск обновления.")})},n()}]);RSBase.controller("ServerController",["$scope","$rootScope","$timeout","$http","RSCom","$q","User","RSOverview","RSMessages","RSRegistry","GSettings","RSFrontend","$uibModal","Flash","Fullscreen","$state","Confirm","RSPrinter","AdvertisementController",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p,_,x){e.user=a,t.overview=l,t.RSRegistry=u,e.page="",e.ft=51,t.question={},t.menuMessages=!1,t.menuMain=!1,t.menuHardware=!1,t.menuLanguage=!1,t.menuPrinter=!1;let b=Math.floor(Math.random()*10)+1;e.view={showLeft:!0,showRight:!0,showFullscreen:!1};let y={hideLeft:!1,hideRight:!1,fullscreen:!1};e.setOverride=(M,D)=>{y[M]=D,R()};let w=!1,S=()=>{l.printerListLoadedPromise.then(function(){let M=!1;if(!e.isPro()&&!e.isOEM()||M){let D=localStorage.getItem("RServer.reminderLastTimeVisible")||new Date;if(!w&&(M||b===10||new Date().getTime()>=parseInt(D))){b=0;let O=new Date;O.setDate(O.getDate()+7),w=!0,x().then(()=>{localStorage.setItem("RServer.reminderLastTimeVisible",O.getTime().toString()),w=!1})}}})},R=()=>{let M=!1;a.isLoggedIn&&(M=a.getSetting("leftPrinterList","0")==="1"),e.view.showLeft=M&&a.getSetting("leftPrinterList","0")==="1"&&e.wwidth>1520&&!y.hideLeft,e.view.showFullscreen=y.fullscreen};R(),e.$on("userSettingsChanged",R),t.closeMessages=function(){t.menuMessages=!1},t.closeMain=function(){t.menuMain=!1},t.closeHardware=function(){t.menuHardware=!1},t.closeLanguage=function(){t.menuLanguage=!1},t.showPrinter=function(M){let D=_.getActivePage(M,{state:"printer.print",params:{slug:M}});g.go(D.state,D.params),t.menuPrinter=!1},t.supportedLanguages={},r.get("/languages.json").then(function(M){t.supportedLanguages=M.data},function(){});let E=function(){e.wwidth=$(window).width(),e.wheight=$(window).height(),R(),e.$broadcast("windowResized",{width:e.wwidth,height:e.wheight})};$(window).resize(E),E(),t.executeGlobalExternalLink=function(M){t.menuMain=!1,M.openExternal?window.open(M.href,"_blank"):g.go("externalLink",{id:M.id})},t.$on("$destroy",()=>{e.setOverride("hideLeft",!1),$(window).off("resize",E)}),t.toggleFullscreen=function(){v.toggleFullscreen(window.document.body)},t.selectLanguage=function(M){let D=document.URL,O=D.indexOf("lang=");O<0?(O=D.indexOf("#"),D.indexOf("?")<0?(O<0&&(O=D.length),D=D.substring(0,O)+"?lang="+M+D.substring(O)):D=D.substring(0,O)+"&lang="+M+D.substring(O)):D=D.substring(0,O+5)+M+D.substring(O+7),console.log("select ",M,D),window.location=D};let T=-1;t.$on("newUpdateLoaded",function(M,D){D.testperiodMode===2&&T>-1&&T!==2&&location.reload(!0),D.testperiodMode>2&&T===2&&(T=D.testperiodMode,location.reload(!0)),D.testperiodMode===2&&(T=2),D.testperiodMode===0&&T!==0&&(T=0,d.open({templateUrl:"/views/services/startTestperiod.modal.php?lang="+lang,scope:t,size:"lg",controller:["$scope","$uibModalInstance",function(O,P){O.noTest=function(){n.send("setTestperiodMode",{mode:1}).then(function(){P.close()},function(){})},O.startPeriod=function(){m.info("Начало испытательного периода"),n.send("setTestperiodMode",{mode:2}).then(function(){P.close()})}}]}).result.catch(function(O){})),D.testperiodMode===3&&T!==3&&(T=3,d.open({templateUrl:"/views/services/endTestperiod.modal.php?lang="+lang,scope:t,size:"lg",controller:["$scope","$uibModalInstance",function(O,P){O.ok=function(){n.send("setTestperiodMode",{mode:4}).then(function(){P.close()})}}]}).result.catch(function(O){}))});let A={};t.qr=function(M,D,O,P,L){P||(P=0),L||(L=4);let I=M+"://"+D+":"+O,k=A[I];return k||(k=QRCode.generatePNG(I,{modulesize:L,margin:P}),A[I]=k),k},t.qr6=function(M,D,O,P,L){P||(P=0),L||(L=4);let I=M+"://["+D+"]:"+O,k=A[I];return k||(k=QRCode.generatePNG(I,{modulesize:L,margin:P}),A[I]=k),k},t.runCall=function(M){M.question?p("Контрольный вопрос",M.question).then(function(){n.send("webCallExecute",{name:M.name,params:["Test"]})}):n.send("webCallExecute",{name:M.name,params:["Test"]})},t.runGPIOCall=function(M){if(M.operation===3)if(M.securityQuestion){let D=(M.state?"Действительно отключить @?":"Действительно включить @?").replace("@",M.display);p("Контрольный вопрос",D,"Да","Нет",!0).then(function(){n.send("GPIORun",{uuid:M.uuid,cmd:"toggle"})},function(){})}else n.send("GPIORun",{uuid:M.uuid,cmd:"toggle"});M.operation===4&&d.open({templateUrl:"/views/gsettings/gpioPWMDialog.php?lang="+lang,size:"sm",controller:["$scope",function(D){D.pin=M,console.log("pin diag",M,D),D.disablePin=function(){n.send("GPIORun",{uuid:D.pin.uuid,cmd:"off"}).then(function(){D.$close()},function(){})},D.setPWM=function(O){D.pin.state=!0,console.log("pwm",O,D.pin),n.send("GPIORun",{uuid:D.pin.uuid,cmd:""+O})}}]})},t.$on("changeFilamentRequested",function(M,D){console.log("Change filament requested",D),g.go("printer.filamentchange",{slug:D.printer,extruder:D.data.extruder})});function C(){localStorage.getItem("RServer.fullWidth")==="true"?document.body.classList.add("full-width"):document.body.classList.remove("full-width")}e.toggleFullWidth=function(){localStorage.setItem("RServer.fullWidth",localStorage.getItem("RServer.fullWidth")!=="true"),C()},C()}]);RSBase.controller("ManufacturerNewsController",["$scope","$rootScope","$http","RSCom","$q","User","RSOverview","Flash",function(t,e,i,r,n,o,a,l){let h=c=>{r.send("markManufacturerNewsRead",{uuid:c.uuid}).then(function(){c.read=!0})};t.panelClass={};let u=()=>{e.manufacturerNews.forEach(c=>{t.panelClass[c.uuid]||(t.panelClass[c.uuid]=c.read?"panel-default":"panel-info",c.read||h(c))})};t.$on("manufacturerNewsUpdated",u),u()}]);RSBase.directive("slider",[function(){return{scope:{model:"=ngModel",min:"@min",max:"@max",step:"@step",precision:"@precision",size:"@",enabled:"@",moved:"&"},restrict:"A",replace:!1,link:function(t,e,i){let r=!1,n="";i.flip&&(r=Boolean(i.flip)),i.letter&&(n=i.letter),$(e).slider({orientation:i.orientation,step:i.step,min:0,max:100,flip:r,letter:n,formater:function(a){return t.$eval(a+" | number:precision")}}).on("slideStop",function(a){t.$apply(function(){t.model=parseFloat(a.value),t.moved&&t.moved({value:parseFloat(a.value)})})}),t.$watch("model",function(){(typeof i.enabled=="undefined"||Boolean(t.enabled))&&$(e).slider("setValue",t.model)}),t.$watch("enabled",function(){$(e).slider("setEnabled",Boolean(t.enabled)),t.enabled&&$(e).slider("setValue",t.model)}),t.$watch("min",function(){$(e).slider("setMin",parseFloat(t.min)),$(e).slider("setValue",t.model)}),t.$watch("max",function(){$(e).slider("setMax",parseFloat(t.max)),$(e).slider("setValue",t.model)}),t.$watch("step",function(){$(e).slider("setStep",parseFloat(t.step)),$(e).slider("setValue",t.model)}),t.$watch("size",function(){$(e).slider("setSize",parseFloat(t.size)),$(e).slider("setValue",t.model)})}}}]);function QX(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function JX(){let t=QX("canvas");return t.style.display="block",t}function P0(t={}){let e=t.canvas!==void 0?t.canvas:JX(),i=t.context!==void 0?t.context:null,r=t.depth!==void 0?t.depth:!0,n=t.stencil!==void 0?t.stencil:!0,o=t.antialias!==void 0?t.antialias:!1,a=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,l=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,h=t.powerPreference!==void 0?t.powerPreference:"default",u=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,c;t.context!==void 0?c=i.getContextAttributes().alpha:c=t.alpha!==void 0?t.alpha:!1;let f=null,d=null,m=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Vr,this.physicallyCorrectLights=!1,this.toneMapping=ln,this.toneMappingExposure=1;let g=this,p=!1,_=0,x=0,b=null,y=-1,w=null,S=new jt,R=new jt,E=null,T=e.width,A=e.height,C=1,M=null,D=null,O=new jt(0,0,T,A),P=new jt(0,0,T,A),L=!1,I=new wa,k=!1,B=!1,F=null,W=new gt,V=new ot,N=new q,ne={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ie(){return b===null?C:1}let Q=i;function K(H,X){for(let oe=0;oe<H.length;oe++){let J=H[oe],se=e.getContext(J,X);if(se!==null)return se}return null}try{let H={alpha:!0,depth:r,stencil:n,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${bc}`),e.addEventListener("webglcontextlost",G,!1),e.addEventListener("webglcontextrestored",me,!1),Q===null){let X=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&X.shift(),Q=K(X,H),Q===null)throw K(X)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Q.getShaderPrecisionFormat===void 0&&(Q.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let de,re,Y,U,z,te,ge,Me,ze,He,Ne,Ye,Ae,Ft,Z,j,_e,Ee,We,je,ct,ye,pt;function yt(){de=new uR(Q),re=new eR(Q,de,t),de.init(re),ye=new YR(Q,de,re),Y=new qR(Q,de,re),U=new dR(Q),z=new FR,te=new XR(Q,de,Y,z,re,ye,U),ge=new iR(g),Me=new hR(g),ze=new fA(Q,re),pt=new J2(Q,de,ze,re),He=new cR(Q,ze,U,pt),Ne=new mR(Q,He,ze,U),We=new pR(Q,re,te),j=new tR(z),Ye=new kR(g,ge,Me,de,re,pt,j),Ae=new ZR(g,z),Ft=new UR,Z=new HR(de,re),Ee=new Q2(g,ge,Y,Ne,c,a),_e=new jR(g,Ne,re),je=new $2(Q,de,U,re),ct=new fR(Q,de,U,re),U.programs=Ye.programs,g.capabilities=re,g.extensions=de,g.properties=z,g.renderLists=Ft,g.shadowMap=_e,g.state=Y,g.info=U}yt();let Ve=new tg(g,Q);this.xr=Ve,this.getContext=function(){return Q},this.getContextAttributes=function(){return Q.getContextAttributes()},this.forceContextLoss=function(){let H=de.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){let H=de.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(H){H!==void 0&&(C=H,this.setSize(T,A,!1))},this.getSize=function(H){return H.set(T,A)},this.setSize=function(H,X,oe){if(Ve.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}T=H,A=X,e.width=Math.floor(H*C),e.height=Math.floor(X*C),oe!==!1&&(e.style.width=H+"px",e.style.height=X+"px"),this.setViewport(0,0,H,X)},this.getDrawingBufferSize=function(H){return H.set(T*C,A*C).floor()},this.setDrawingBufferSize=function(H,X,oe){T=H,A=X,C=oe,e.width=Math.floor(H*oe),e.height=Math.floor(X*oe),this.setViewport(0,0,H,X)},this.getCurrentViewport=function(H){return H.copy(S)},this.getViewport=function(H){return H.copy(O)},this.setViewport=function(H,X,oe,J){H.isVector4?O.set(H.x,H.y,H.z,H.w):O.set(H,X,oe,J),Y.viewport(S.copy(O).multiplyScalar(C).floor())},this.getScissor=function(H){return H.copy(P)},this.setScissor=function(H,X,oe,J){H.isVector4?P.set(H.x,H.y,H.z,H.w):P.set(H,X,oe,J),Y.scissor(R.copy(P).multiplyScalar(C).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(H){Y.setScissorTest(L=H)},this.setOpaqueSort=function(H){M=H},this.setTransparentSort=function(H){D=H},this.getClearColor=function(H){return H.copy(Ee.getClearColor())},this.setClearColor=function(){Ee.setClearColor.apply(Ee,arguments)},this.getClearAlpha=function(){return Ee.getClearAlpha()},this.setClearAlpha=function(){Ee.setClearAlpha.apply(Ee,arguments)},this.clear=function(H=!0,X=!0,oe=!0){let J=0;H&&(J|=Q.COLOR_BUFFER_BIT),X&&(J|=Q.DEPTH_BUFFER_BIT),oe&&(J|=Q.STENCIL_BUFFER_BIT),Q.clear(J)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",G,!1),e.removeEventListener("webglcontextrestored",me,!1),Ft.dispose(),Z.dispose(),z.dispose(),ge.dispose(),Me.dispose(),Ne.dispose(),pt.dispose(),Ye.dispose(),Ve.dispose(),Ve.removeEventListener("sessionstart",Et),Ve.removeEventListener("sessionend",bt),F&&(F.dispose(),F=null),mi.stop()};function G(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function me(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1;let H=U.autoReset,X=_e.enabled,oe=_e.autoUpdate,J=_e.needsUpdate,se=_e.type;yt(),U.autoReset=H,_e.enabled=X,_e.autoUpdate=oe,_e.needsUpdate=J,_e.type=se}function Se(H){let X=H.target;X.removeEventListener("dispose",Se),Be(X)}function Be(H){De(H),z.remove(H)}function De(H){let X=z.get(H).programs;X!==void 0&&(X.forEach(function(oe){Ye.releaseProgram(oe)}),H.isShaderMaterial&&Ye.releaseShaderCache(H))}let Ze=0;this.renderBufferDirect=function(H,X,oe,J,se,xe){if(X===null&&(X=ne),oe.isFilament){if(xe.count===0)return;let Ce=xe.sx?xe.sx:0,ke=xe.sy?xe.sy:0,tt=xe.sz?xe.sz:0,mt=xe.sw?xe.sw:0,Ot=J.uniforms.splitPos.value;(Ot[0]!==Ce||Ot[1]!==ke||Ot[2]!==tt||Ot[3]!==mt)&&(J.uniformsNeedUpdate=!0,Ot[0]=Ce,Ot[1]=ke,Ot[2]=tt,Ot[3]=mt)}let pe=se.isMesh&&se.matrixWorld.determinant()<0,Pe=Ao(H,X,oe,J,se);Y.setMaterial(J,pe);let Ie=oe.index,ut=oe.attributes.position;if(Ie===null){if(ut===void 0||ut.count===0)return}else if(Ie.count===0)return;let Xe=1;J.wireframe===!0&&(Ie=He.getWireframeAttribute(oe),Xe=2),pt.setup(se,J,Pe,oe,Ie);let Ke,et=je;Ie!==null&&(Ke=ze.get(Ie),et=ct,et.setIndex(Ke));let rt=Ie!==null?Ie.count:ut.count,st=oe.drawRange.start*Xe,Je=oe.drawRange.count*Xe,Vt=xe!==null?xe.start*Xe:0,vt=xe!==null?xe.count*Xe:1/0,we=Math.max(st,Vt),he=Math.min(rt,st+Je,Vt+vt)-1;oe.isFilament&&(we=st,he=st+Je-1);let be=Math.max(0,he-we+1);if(!(be<=0)){if(se.isMesh)J.wireframe===!0?(Y.setLineWidth(J.wireframeLinewidth*ie()),et.setMode(Q.LINES)):et.setMode(Q.TRIANGLES);else if(se.isLine){let Ce=J.linewidth;Ce===void 0&&(Ce=1),Y.setLineWidth(Ce*ie()),se.isLineSegments?et.setMode(Q.LINES):se.isLineLoop?et.setMode(Q.LINE_LOOP):et.setMode(Q.LINE_STRIP)}else se.isPoints?et.setMode(Q.POINTS):se.isSprite&&et.setMode(Q.TRIANGLES);if(se.isInstancedMesh)et.renderInstances(we,be,se.count);else if(oe.isInstancedBufferGeometry){let Ce=Math.min(oe.instanceCount,oe._maxInstanceCount);oe.isFilament&&(Ce=vt),Ce>0&&et.renderInstances(we,be,Ce)}else et.render(we,be)}},this.compile=function(H,X){d=Z.get(H),d.init(),v.push(d),H.traverseVisible(function(oe){oe.isLight&&oe.layers.test(X.layers)&&(d.pushLight(oe),oe.castShadow&&d.pushShadow(oe))}),d.setupLights(g.physicallyCorrectLights),H.traverse(function(oe){let J=oe.material;if(J)if(Array.isArray(J))for(let se=0;se<J.length;se++){let xe=J[se];_s(xe,H,oe)}else _s(J,H,oe)}),v.pop(),d=null};let Te=null;function ft(H){Te&&Te(H)}function Et(){mi.stop()}function bt(){mi.start()}let mi=new Nm;mi.setAnimationLoop(ft),typeof self!="undefined"&&mi.setContext(self),this.setAnimationLoop=function(H){Te=H,Ve.setAnimationLoop(H),H===null?mi.stop():mi.start()},Ve.addEventListener("sessionstart",Et),Ve.addEventListener("sessionend",bt),this.render=function(H,X){if(X!==void 0&&X.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(p===!0)return;H.autoUpdate===!0&&H.updateMatrixWorld(),X.parent===null&&X.updateMatrixWorld(),Ve.enabled===!0&&Ve.isPresenting===!0&&(Ve.cameraAutoUpdate===!0&&Ve.updateCamera(X),X=Ve.getCamera()),H.isScene===!0&&H.onBeforeRender(g,H,X,b),d=Z.get(H,v.length),d.init(),v.push(d),W.multiplyMatrices(X.projectionMatrix,X.matrixWorldInverse),I.setFromProjectionMatrix(W),B=this.localClippingEnabled,k=j.init(this.clippingPlanes,B,X),f=Ft.get(H,m.length),f.init(),m.push(f),sr(H,X,0,g.sortObjects),f.finish(),g.sortObjects===!0&&f.sort(M,D),k===!0&&j.beginShadows();let oe=d.state.shadowsArray;if(_e.render(oe,H,X),k===!0&&j.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ee.render(f,H),d.setupLights(g.physicallyCorrectLights),X.isArrayCamera){let J=X.cameras;for(let se=0,xe=J.length;se<xe;se++){let pe=J[se];js(f,H,pe,pe.viewport)}}else js(f,H,X);b!==null&&(te.updateMultisampleRenderTarget(b),te.updateRenderTargetMipmap(b)),H.isScene===!0&&H.onAfterRender(g,H,X),pt.resetDefaultState(),y=-1,w=null,v.pop(),v.length>0?d=v[v.length-1]:d=null,m.pop(),m.length>0?f=m[m.length-1]:f=null};function sr(H,X,oe,J){if(H.visible===!1)return;if(H.layers.test(X.layers)){if(H.isGroup)oe=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(X);else if(H.isLight)d.pushLight(H),H.castShadow&&d.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||I.intersectsSprite(H)){J&&N.setFromMatrixPosition(H.matrixWorld).applyMatrix4(W);let pe=Ne.update(H),Pe=H.material;Pe.visible&&f.push(H,pe,Pe,oe,N.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(H.isSkinnedMesh&&H.skeleton.frame!==U.render.frame&&(H.skeleton.update(),H.skeleton.frame=U.render.frame),!H.frustumCulled||I.intersectsObject(H))){J&&N.setFromMatrixPosition(H.matrixWorld).applyMatrix4(W);let pe=Ne.update(H),Pe=H.material;if(Array.isArray(Pe)){let Ie=pe.groups;for(let ut=0,Xe=Ie.length;ut<Xe;ut++){let Ke=Ie[ut],et=Pe[Ke.materialIndex];et&&et.visible&&f.push(H,pe,et,oe,N.z,Ke)}}else Pe.visible&&f.push(H,pe,Pe,oe,N.z,null)}}let xe=H.children;for(let pe=0,Pe=xe.length;pe<Pe;pe++)sr(xe[pe],X,oe,J)}function js(H,X,oe,J){let se=H.opaque,xe=H.transmissive,pe=H.transparent;d.setupLightsView(oe),xe.length>0&&pl(se,X,oe),J&&Y.viewport(S.copy(J)),se.length>0&&qs(se,X,oe),xe.length>0&&qs(xe,X,oe),pe.length>0&&qs(pe,X,oe),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function pl(H,X,oe){let J=re.isWebGL2;F===null&&(F=new Tr(1,1,{generateMipmaps:!0,type:ye.convert(to)!==null?to:jn,minFilter:ya,samples:J&&o===!0?4:0})),g.getDrawingBufferSize(V),J?F.setSize(V.x,V.y):F.setSize(Ac(V.x),Ac(V.y));let se=g.getRenderTarget();g.setRenderTarget(F),g.clear();let xe=g.toneMapping;g.toneMapping=ln,qs(H,X,oe),g.toneMapping=xe,te.updateMultisampleRenderTarget(F),te.updateRenderTargetMipmap(F),g.setRenderTarget(se)}function qs(H,X,oe){let J=X.isScene===!0?X.overrideMaterial:null;for(let se=0,xe=H.length;se<xe;se++){let pe=H[se],Pe=pe.object,Ie=pe.geometry,ut=J===null?pe.material:J,Xe=pe.group;Pe.layers.test(oe.layers)&&To(Pe,X,oe,Ie,ut,Xe)}}function To(H,X,oe,J,se,xe){H.onBeforeRender(g,X,oe,J,se,xe),H.modelViewMatrix.multiplyMatrices(oe.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),se.onBeforeRender(g,X,oe,J,H,xe),se.transparent===!0&&se.side===qt?(se.side=Gi,se.needsUpdate=!0,g.renderBufferDirect(oe,X,J,se,H,xe),se.side=Ei,se.needsUpdate=!0,g.renderBufferDirect(oe,X,J,se,H,xe),se.side=qt):g.renderBufferDirect(oe,X,J,se,H,xe),H.onAfterRender(g,X,oe,J,se,xe)}function _s(H,X,oe){X.isScene!==!0&&(X=ne);let J=z.get(H),se=d.state.lights,xe=d.state.shadowsArray,pe=se.state.version,Pe=Ye.getParameters(H,se.state,xe,X,oe),Ie=Ye.getProgramCacheKey(Pe),ut=J.programs;J.environment=H.isMeshStandardMaterial?X.environment:null,J.fog=X.fog,J.envMap=(H.isMeshStandardMaterial?Me:ge).get(H.envMap||J.environment),ut===void 0&&(H.addEventListener("dispose",Se),ut=new Map,J.programs=ut);let Xe=ut.get(Ie);if(Xe!==void 0){if(J.currentProgram===Xe&&J.lightsStateVersion===pe)return Xs(H,Pe),Xe}else Pe.uniforms=Ye.getUniforms(H),H.onBuild(oe,Pe,g),H.onBeforeCompile(Pe,g),Xe=Ye.acquireProgram(Pe,Ie),ut.set(Ie,Xe),J.uniforms=Pe.uniforms;let Ke=J.uniforms;(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&(Ke.clippingPlanes=j.uniform),Xs(H,Pe),J.needsLights=nt(H),J.lightsStateVersion=pe,J.needsLights&&(Ke.ambientLightColor.value=se.state.ambient,Ke.lightProbe.value=se.state.probe,Ke.directionalLights.value=se.state.directional,Ke.directionalLightShadows.value=se.state.directionalShadow,Ke.spotLights.value=se.state.spot,Ke.spotLightShadows.value=se.state.spotShadow,Ke.rectAreaLights.value=se.state.rectArea,Ke.ltc_1.value=se.state.rectAreaLTC1,Ke.ltc_2.value=se.state.rectAreaLTC2,Ke.pointLights.value=se.state.point,Ke.pointLightShadows.value=se.state.pointShadow,Ke.hemisphereLights.value=se.state.hemi,Ke.directionalShadowMap.value=se.state.directionalShadowMap,Ke.directionalShadowMatrix.value=se.state.directionalShadowMatrix,Ke.spotShadowMap.value=se.state.spotShadowMap,Ke.spotShadowMatrix.value=se.state.spotShadowMatrix,Ke.pointShadowMap.value=se.state.pointShadowMap,Ke.pointShadowMatrix.value=se.state.pointShadowMatrix);let et=Xe.getUniforms(),rt=oo.seqWithValue(et.seq,Ke);return J.currentProgram=Xe,J.uniformsList=rt,Xe}function Xs(H,X){let oe=z.get(H);oe.outputEncoding=X.outputEncoding,oe.instancing=X.instancing,oe.skinning=X.skinning,oe.morphTargets=X.morphTargets,oe.morphNormals=X.morphNormals,oe.morphColors=X.morphColors,oe.morphTargetsCount=X.morphTargetsCount,oe.numClippingPlanes=X.numClippingPlanes,oe.numIntersection=X.numClipIntersection,oe.vertexAlphas=X.vertexAlphas,oe.vertexTangents=X.vertexTangents,oe.toneMapping=X.toneMapping}function Ao(H,X,oe,J,se){X.isScene!==!0&&(X=ne),te.resetTextureUnits();let xe=X.fog,pe=J.isMeshStandardMaterial?X.environment:null,Pe=b===null?g.outputEncoding:b.isXRRenderTarget===!0?b.texture.encoding:Vr,Ie=(J.isMeshStandardMaterial?Me:ge).get(J.envMap||pe),ut=J.vertexColors===!0&&!!oe.attributes.color&&oe.attributes.color.itemSize===4,Xe=!!J.normalMap&&!!oe.attributes.tangent,Ke=!!oe.morphAttributes.position,et=!!oe.morphAttributes.normal,rt=!!oe.morphAttributes.color,st=J.toneMapped?g.toneMapping:ln,Je=oe.morphAttributes.position||oe.morphAttributes.normal||oe.morphAttributes.color,Vt=Je!==void 0?Je.length:0,vt=z.get(J),we=d.state.lights;if(k===!0&&(B===!0||H!==w)){let si=H===w&&J.id===y;j.setState(J,H,si)}let he=!1;J.version===vt.__version?(vt.needsLights&&vt.lightsStateVersion!==we.state.version||vt.outputEncoding!==Pe||se.isInstancedMesh&&vt.instancing===!1||!se.isInstancedMesh&&vt.instancing===!0||se.isSkinnedMesh&&vt.skinning===!1||!se.isSkinnedMesh&&vt.skinning===!0||vt.envMap!==Ie||J.fog&&vt.fog!==xe||vt.numClippingPlanes!==void 0&&(vt.numClippingPlanes!==j.numPlanes||vt.numIntersection!==j.numIntersection)||vt.vertexAlphas!==ut||vt.vertexTangents!==Xe||vt.morphTargets!==Ke||vt.morphNormals!==et||vt.morphColors!==rt||vt.toneMapping!==st||re.isWebGL2===!0&&vt.morphTargetsCount!==Vt)&&(he=!0):(he=!0,vt.__version=J.version);let be=vt.currentProgram;he===!0&&(be=_s(J,X,se));let Ce=!1,ke=!1,tt=!1,mt=be.getUniforms(),Ot=vt.uniforms;if(Y.useProgram(be.program)&&(Ce=!0,ke=!0,tt=!0),J.id!==y&&(y=J.id,ke=!0),Ce||w!==H){if(mt.setValue(Q,"projectionMatrix",H.projectionMatrix),re.logarithmicDepthBuffer&&mt.setValue(Q,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),w!==H&&(w=H,ke=!0,tt=!0),J.isShaderMaterial||J.isMeshPhongMaterial||J.isMeshToonMaterial||J.isMeshStandardMaterial||J.envMap){let si=mt.map.cameraPosition;si!==void 0&&si.setValue(Q,N.setFromMatrixPosition(H.matrixWorld))}(J.isMeshPhongMaterial||J.isMeshToonMaterial||J.isMeshLambertMaterial||J.isMeshBasicMaterial||J.isMeshStandardMaterial||J.isShaderMaterial)&&mt.setValue(Q,"isOrthographic",H.isOrthographicCamera===!0),(J.isMeshPhongMaterial||J.isMeshToonMaterial||J.isMeshLambertMaterial||J.isMeshBasicMaterial||J.isMeshStandardMaterial||J.isShaderMaterial||J.isShadowMaterial||se.isSkinnedMesh)&&mt.setValue(Q,"viewMatrix",H.matrixWorldInverse)}if(se.isSkinnedMesh){mt.setOptional(Q,se,"bindMatrix"),mt.setOptional(Q,se,"bindMatrixInverse");let si=se.skeleton;si&&(re.floatVertexTextures?(si.boneTexture===null&&si.computeBoneTexture(),mt.setValue(Q,"boneTexture",si.boneTexture,te),mt.setValue(Q,"boneTextureSize",si.boneTextureSize)):mt.setOptional(Q,si,"boneMatrices"))}let Mi=oe.morphAttributes;return(Mi.position!==void 0||Mi.normal!==void 0||Mi.color!==void 0&&re.isWebGL2===!0)&&We.update(se,oe,J,be),(ke||vt.receiveShadow!==se.receiveShadow)&&(vt.receiveShadow=se.receiveShadow,mt.setValue(Q,"receiveShadow",se.receiveShadow)),ke&&(mt.setValue(Q,"toneMappingExposure",g.toneMappingExposure),vt.needsLights&&le(Ot,tt),xe&&J.fog&&Ae.refreshFogUniforms(Ot,xe),Ae.refreshMaterialUniforms(Ot,J,C,A,F),oo.upload(Q,vt.uniformsList,Ot,te)),J.isShaderMaterial&&J.uniformsNeedUpdate===!0&&(oo.upload(Q,vt.uniformsList,Ot,te),J.uniformsNeedUpdate=!1),J.isSpriteMaterial&&mt.setValue(Q,"center",se.center),mt.setValue(Q,"modelViewMatrix",se.modelViewMatrix),mt.setValue(Q,"normalMatrix",se.normalMatrix),mt.setValue(Q,"modelMatrix",se.matrixWorld),be}function le(H,X){H.ambientLightColor.needsUpdate=X,H.lightProbe.needsUpdate=X,H.directionalLights.needsUpdate=X,H.directionalLightShadows.needsUpdate=X,H.pointLights.needsUpdate=X,H.pointLightShadows.needsUpdate=X,H.spotLights.needsUpdate=X,H.spotLightShadows.needsUpdate=X,H.rectAreaLights.needsUpdate=X,H.hemisphereLights.needsUpdate=X}function nt(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(H,X,oe){z.get(H.texture).__webglTexture=X,z.get(H.depthTexture).__webglTexture=oe;let J=z.get(H);J.__hasExternalTextures=!0,J.__hasExternalTextures&&(J.__autoAllocateDepthBuffer=oe===void 0,J.__autoAllocateDepthBuffer||de.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),J.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(H,X){let oe=z.get(H);oe.__webglFramebuffer=X,oe.__useDefaultFramebuffer=X===void 0},this.setRenderTarget=function(H,X=0,oe=0){b=H,_=X,x=oe;let J=!0;if(H){let Ie=z.get(H);Ie.__useDefaultFramebuffer!==void 0?(Y.bindFramebuffer(Q.FRAMEBUFFER,null),J=!1):Ie.__webglFramebuffer===void 0?te.setupRenderTarget(H):Ie.__hasExternalTextures&&te.rebindTextures(H,z.get(H.texture).__webglTexture,z.get(H.depthTexture).__webglTexture)}let se=null,xe=!1,pe=!1;if(H){let Ie=H.texture;(Ie.isData3DTexture||Ie.isDataArrayTexture)&&(pe=!0);let ut=z.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(se=ut[X],xe=!0):re.isWebGL2&&H.samples>0&&te.useMultisampledRTT(H)===!1?se=z.get(H).__webglMultisampledFramebuffer:se=ut,S.copy(H.viewport),R.copy(H.scissor),E=H.scissorTest}else S.copy(O).multiplyScalar(C).floor(),R.copy(P).multiplyScalar(C).floor(),E=L;if(Y.bindFramebuffer(Q.FRAMEBUFFER,se)&&re.drawBuffers&&J&&Y.drawBuffers(H,se),Y.viewport(S),Y.scissor(R),Y.setScissorTest(E),xe){let Ie=z.get(H.texture);Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_CUBE_MAP_POSITIVE_X+X,Ie.__webglTexture,oe)}else if(pe){let Ie=z.get(H.texture),ut=X||0;Q.framebufferTextureLayer(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Ie.__webglTexture,oe||0,ut)}y=-1},this.readRenderTargetPixels=function(H,X,oe,J,se,xe,pe){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Pe=z.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&pe!==void 0&&(Pe=Pe[pe]),Pe){Y.bindFramebuffer(Q.FRAMEBUFFER,Pe);try{let Ie=H.texture,ut=Ie.format,Xe=Ie.type;if(ut!==or&&ye.convert(ut)!==Q.getParameter(Q.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ke=Xe===to&&(de.has("EXT_color_buffer_half_float")||re.isWebGL2&&de.has("EXT_color_buffer_float"));if(Xe!==jn&&ye.convert(Xe)!==Q.getParameter(Q.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Xe===ws&&(re.isWebGL2||de.has("OES_texture_float")||de.has("WEBGL_color_buffer_float")))&&!Ke){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Q.checkFramebufferStatus(Q.FRAMEBUFFER)===Q.FRAMEBUFFER_COMPLETE?X>=0&&X<=H.width-J&&oe>=0&&oe<=H.height-se&&Q.readPixels(X,oe,J,se,ye.convert(ut),ye.convert(Xe),xe):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let Ie=b!==null?z.get(b).__webglFramebuffer:null;Y.bindFramebuffer(Q.FRAMEBUFFER,Ie)}}},this.copyFramebufferToTexture=function(H,X,oe=0){if(X.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}let J=Math.pow(2,-oe),se=Math.floor(X.image.width*J),xe=Math.floor(X.image.height*J);te.setTexture2D(X,0),Q.copyTexSubImage2D(Q.TEXTURE_2D,oe,0,0,H.x,H.y,se,xe),Y.unbindTexture()},this.copyTextureToTexture=function(H,X,oe,J=0){let se=X.image.width,xe=X.image.height,pe=ye.convert(oe.format),Pe=ye.convert(oe.type);te.setTexture2D(oe,0),Q.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,oe.flipY),Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,oe.premultiplyAlpha),Q.pixelStorei(Q.UNPACK_ALIGNMENT,oe.unpackAlignment),X.isDataTexture?Q.texSubImage2D(Q.TEXTURE_2D,J,H.x,H.y,se,xe,pe,Pe,X.image.data):X.isCompressedTexture?Q.compressedTexSubImage2D(Q.TEXTURE_2D,J,H.x,H.y,X.mipmaps[0].width,X.mipmaps[0].height,pe,X.mipmaps[0].data):Q.texSubImage2D(Q.TEXTURE_2D,J,H.x,H.y,pe,Pe,X.image),J===0&&oe.generateMipmaps&&Q.generateMipmap(Q.TEXTURE_2D),Y.unbindTexture()},this.copyTextureToTexture3D=function(H,X,oe,J,se=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let xe=H.max.x-H.min.x+1,pe=H.max.y-H.min.y+1,Pe=H.max.z-H.min.z+1,Ie=ye.convert(J.format),ut=ye.convert(J.type),Xe;if(J.isData3DTexture)te.setTexture3D(J,0),Xe=Q.TEXTURE_3D;else if(J.isDataArrayTexture)te.setTexture2DArray(J,0),Xe=Q.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Q.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,J.flipY),Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,J.premultiplyAlpha),Q.pixelStorei(Q.UNPACK_ALIGNMENT,J.unpackAlignment);let Ke=Q.getParameter(Q.UNPACK_ROW_LENGTH),et=Q.getParameter(Q.UNPACK_IMAGE_HEIGHT),rt=Q.getParameter(Q.UNPACK_SKIP_PIXELS),st=Q.getParameter(Q.UNPACK_SKIP_ROWS),Je=Q.getParameter(Q.UNPACK_SKIP_IMAGES),Vt=oe.isCompressedTexture?oe.mipmaps[0]:oe.image;Q.pixelStorei(Q.UNPACK_ROW_LENGTH,Vt.width),Q.pixelStorei(Q.UNPACK_IMAGE_HEIGHT,Vt.height),Q.pixelStorei(Q.UNPACK_SKIP_PIXELS,H.min.x),Q.pixelStorei(Q.UNPACK_SKIP_ROWS,H.min.y),Q.pixelStorei(Q.UNPACK_SKIP_IMAGES,H.min.z),oe.isDataTexture||oe.isData3DTexture?Q.texSubImage3D(Xe,se,X.x,X.y,X.z,xe,pe,Pe,Ie,ut,Vt.data):oe.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Q.compressedTexSubImage3D(Xe,se,X.x,X.y,X.z,xe,pe,Pe,Ie,Vt.data)):Q.texSubImage3D(Xe,se,X.x,X.y,X.z,xe,pe,Pe,Ie,ut,Vt),Q.pixelStorei(Q.UNPACK_ROW_LENGTH,Ke),Q.pixelStorei(Q.UNPACK_IMAGE_HEIGHT,et),Q.pixelStorei(Q.UNPACK_SKIP_PIXELS,rt),Q.pixelStorei(Q.UNPACK_SKIP_ROWS,st),Q.pixelStorei(Q.UNPACK_SKIP_IMAGES,Je),se===0&&J.generateMipmaps&&Q.generateMipmap(Xe),Y.unbindTexture()},this.initTexture=function(H){te.setTexture2D(H,0),Y.unbindTexture()},this.resetState=function(){_=0,x=0,b=null,Y.reset(),pt.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}P0.prototype.isWebGLRenderer=!0;var OB=Qi(ta());jt.prototype.toVector3=function(){return new q(this.x/this.w,this.y/this.w,this.z/this.w)};q.prototype.toVector4=function(){return new jt(this.x,this.y,this.z,1)};q.prototype.toArray=function(){return[this.x,this.y,this.z]};gt.prototype.lookAt2=function(){let t=new q,e=new q,i=new q;return function(r,n,o){let a=this.elements;return i.subVectors(r,n).normalize(),i.length()===0&&(i.z=1),t.crossVectors(o,i).normalize(),t.length()===0&&(i.x+=1e-4,t.crossVectors(o,i).normalize()),e.crossVectors(i,t),a[0]=t.x,a[4]=t.y,a[8]=t.z,a[1]=e.x,a[5]=e.y,a[9]=e.z,a[2]=i.x,a[6]=i.y,a[10]=i.z,a[12]=-(t.x*r.x+t.y*r.y+t.z*r.z),a[13]=-(e.x*r.x+e.y*r.y+e.z*r.z),a[14]=-(i.x*r.x+i.y*r.y+i.z*r.z),a[15]=1,this}}();var hS=class{constructor(){this.disposables=new Set}add(e){return e.dispose&&this.disposables.add(e),e}remove(e,i){e.dispose&&((i===!0||i===void 0)&&e.dispose(),this.disposables.delete(e))}dispose(){for(let e of this.disposables)e.dispose();this.disposables.clear()}};function Gu(t,e,i,r,n,o){n===void 0&&(n=!0),this.tracker=new hS,this.withShadows=n;let a=!1,l=e?i.printerConfig[e]:!1,h=l?l.shape:void 0,u=r?$(r):!1,c=!1,f=$(".axis",t),d={x:0,y:0};this.mouse=d,this.renderCallback=!1,this.clickCallback=!1,this.unclickCallback=!1,this.doRaycasts=!1,this.ray=new og,this.textMaterials={};function m(le){return parseInt("0x"+le.substring(1))}this.makeMaterialWithText=function(le){let nt=le+"-"+i.theme;if(this.textMaterials[nt])return this.textMaterials[nt];let H=document.createElement("canvas");H.height=64,H.width=256;let X=H.getContext("2d");X.font="64px Arial",X.textAlign="center",X.textBaseline="top",i.theme==="dark"?X.fillStyle="rgba(255,255,255,1)":X.fillStyle="rgba(0,0,0,1)",X.fillText(le,128,0);let oe=new vi(H);oe.needsUpdate=!0,this.tracker.add(oe);let J=new Wi({map:oe,side:qt,alphaTest:.05,transparent:!0});return this.tracker.add(J),this.textMaterials[nt]=J,H=null,J};let v=null,g=l!==!1?new Oi({color:m(h.gridColor),transparent:!0}):new Oi({color:m("#454545"),transparent:!0}),p=l!==!1?new Oi({color:m(h.gridColor),linewidth:2,transparent:!0}):new Oi({color:m("#454545"),linewidth:2,transparent:!0}),_=l!==!1?this.tracker.add(new Wi({color:m(h.gridColor),depthFunc:$s,transparent:!0,opacity:.7,side:qt})):this.tracker.add(new Wi({color:m("#dddddd"),depthFunc:$s,transparent:!0,opacity:.7,side:qt})),x=l!==!1?this.tracker.add(new Wi({color:m(h.gridColor),depthFunc:$s,transparent:!0,side:qt})):this.tracker.add(new Wi({color:m("#dddddd"),depthFunc:$s,transparent:!0,side:qt})),b=l!==!1?new Wi({side:Ei,color:m(l.shape.basicShape.color),transparent:!1}):new Wi({side:Ei,color:m("#cccccc"),transparent:!1});this.tracker.add(g),this.tracker.add(p),this.tracker.add(b),this.disposed=!1;let y=l!==!1?l.shape.basicShape:!1;this.isZBelt=y.shape==="zbelt";let w,S,R,E,T,A,C,M,D,O,P,L=t.width(),I=!1,k=0,B=Math.PI/2,F=-Math.PI/2,W=200,V=800,N=!1,ne=!1,ie=null,Q=null,K=null,de=null,re=null,Y=new Li,U=new Li,z=!0,te=new Ra,ge=!0,Me=new Ra,ze=new Ra;this.scene=te,this.scene2=Me,this.sceneBed=new Ra,this.sceneAxis=ze;let He=new q(0,0,0),Ne=null,Ye=null,Ae=!0;this.bedGroup=new Xr,this.bedGroup.renderOrder=-1,this.sceneBed.add(this.bedGroup),this.setSize=function(le,nt,H){M=le,D=nt,O=H,P=Math.sqrt(M*M+D*D+O*O)},this.setChanged=function(){ge=!0},this.setScene=function(le){te=le,ge=!0},this.getScene=function(){return te},this.setObjectsBBox=function(le){Y=le.clone()},this.setPrinterBox=function(le){U=le.clone()},this.addAxis=function(){wi.initialized.then(()=>{let le=wi.getGeometryHelper(),nt=wi.getAxisMaterials(),H=nt.x.clone(),X=nt.y.clone(),oe=nt.z.clone();this.tracker.add(H),this.tracker.add(X),this.tracker.add(oe);let J=le.arrowX.clone(),se=le.arrowY.clone(),xe=le.arrowZ.clone();this.tracker.add(J),this.tracker.add(J),this.tracker.add(J),this.sceneAxis.add(new St(J,H)),this.sceneAxis.add(new St(se,X)),this.sceneAxis.add(new St(xe,oe)),this.setChanged()})};let Ft=()=>{if(this.disposed||!ge&&!I)return;if(c&&v.update(),I)switch(k){case 1:ie.fov-=.2,ie.fov<.1&&(ie.fov=.1),ie.updateProjectionMatrix();break;case 2:ie.fov+=.2,ie.fov>60&&(ie.fov=60),ie.updateProjectionMatrix();break;case 3:F+=.01,F>Math.PI&&(F-=2*Math.PI),this.orbit.rotateLeft(.01);break;case 4:F-=.01/3,F<-Math.PI&&(F+=2*Math.PI),this.orbit.rotateLeft(-.01/3);break;case 5:B-=.01;break;case 6:B+=.01;break}this.orbit.update();let le=new Li;le.setFromObject(this.scene,!1),le.expandByObject(this.sceneBed,!1),le.expandByObject(this.scene2,!1),le.applyMatrix4(ie.matrixWorldInverse),ie.far=10-le.min.z,ie.near=Math.max(1,-le.max.z),ie.updateProjectionMatrix(),this.doRaycasts&&this.ray.setFromCamera(d,ie);let nt=!1;this.renderCallback!==!1&&this.renderCallback()===!0&&(nt=!0),Ne.clear(),Ne.render(this.sceneBed,ie),Ne.render(te,ie),Me.children.length>this.numLights&&(Ne.clearDepth(),Ne.render(Me,ie)),Ye&&(re.position.copy(ie.position),re.position.sub(this.orbit.target),re.position.setLength(150),re.lookAt(ze.position),re.updateProjectionMatrix(),Ye.clear(),Ye.render(ze,re)),ge=nt||I};this.toggleAnimate=le=>{I?this.stopAnimate():this.startAnimate(le)},this.stopAnimate=function(){I=!1},this.startAnimate=function(le){k=le,I=!0};let Z=()=>{this.startAnimate(1)},j=()=>{this.startAnimate(2)},_e=()=>{this.startAnimate(5)},Ee=()=>{this.startAnimate(6)},We=()=>{this.startAnimate(3)},je=()=>{this.startAnimate(4)},ct=()=>{c&&(v=new Stats,v.setMode(0),v.domElement.style.position="absolute",v.domElement.style.left="0px",v.domElement.style.top="0px",t.append(v.domElement)),$(window).resize(ye),u!==!1&&($(".btn",u).mouseout(()=>{this.stopAnimate()}),$(".btn",u).mouseup(()=>{this.stopAnimate()}),$(".zoomin",u).mousedown(Z),$(".zoomout",u).mousedown(j),$(".up",t).mousedown(_e),$(".down",t).mousedown(Ee),$(".left",t).mousedown(We),$(".right",t).mousedown(je),$(".orientLeft",u).click(()=>{this.orientLeft()}),$(".orientRight",u).click(()=>{this.orientRight()}),$(".orientTop",u).click(()=>{this.orientTop()}),$(".orientBottom",u).click(()=>{this.orientBottom()}),$(".orientFront",u).click(()=>{this.orientFront()}),$(".orientBack",u).click(()=>{this.orientBack()}),$(".orientIso",u).click(()=>{this.orientIsometric()}),$(".fitObjects",u).click(()=>{this.fitObjects()}),$(".fitPrinter",u).click(()=>{this.fitPrinter()})),Ne=new P0({canvas:$("canvas",t)[0],antialias:!1,powerPreference:"high-performance",sortObjects:!0,autoClear:!1,autoClearDepth:!1,autoClearStencil:!1}),Ne.setPixelRatio(window.devicePixelRatio),Ne.setSize(t.width(),t.height()),this.withShadows&&(Ne.shadowMap.enabled=!0,Ne.shadowMapSoft=!0,Ne.shadowMap.type=xm),Ne.autoClear=!1,window.rs.theme==="dark"?Ne.setClearColor(1710618,1):Ne.setClearColor(16777215,1),Ye=new P0({canvas:$("canvas",f)[0],antialias:!0,alpha:!0,powerPreference:"high-performance",sortObjects:!0,autoClear:!1,autoClearDepth:!1,autoClearStencil:!1}),Ye.setSize(f.width(),f.height()),f.append(Ye.domElement),ie=K=new Vi(30,t.width()/t.height(),.1,3e3),ie.up.set(0,0,1),ie.position.set(0,-200,0),ie.lookAt(new q(0,0,0)),re=new Vi(30,1,.1,1e3),re.up.set(0,0,1),o&&o.printerType===2&&(this.isZBelt=!0),this.isZBelt&&(ie.up.set(0,1,0),re.up.set(0,1,0)),this.tracker.add(K),this.tracker.add(re),this.camera=ie,this.renderer=Ne,t.append(Ne.domElement),Q=$(Ne.domElement),this.canvas=Q,this.orbit=this.orbitPerspective=new Gt.OrbitControls(ie,Ne.domElement),this.orbit.zoomSpeed=.5,this.orbit.zoomSpeed=.5,this.orbit.listenToKeyEvents(Ne.domElement),this.orbit.addEventListener("change",()=>{ge=!0}),this.tracker.add(this.orbitPerspective),de=new jo(t.width()/-2,t.width()/2,t.height()/2,t.height()/-2,.1,3e3),this.tracker.add(de),de.up.set(0,0,1),de.position.set(0,1,200),de.lookAt(new q(0,0,0)),this.orbitParallel=new Gt.OrbitControls(de,Ne.domElement),this.orbitParallel.zoomSpeed=.5,this.orbitParallel.listenToKeyEvents(Ne.domElement),this.orbitParallel.addEventListener("change",()=>{ge=!0}),this.orbitParallel.enabled=!1,this.tracker.add(this.orbitParallel)};this.selectCamera=le=>{le?(ie=K,this.orbit=this.orbitPerspective,this.orbitParallel.enabled=!1,this.orbitPerspective.enabled=!0,Ae=!0):(ie=de,this.orbit=this.orbitParallel,this.orbitParallel.enabled=!0,this.orbitPerspective.enabled=!1,Ae=!1),this.setChanged()};let ye=()=>{Ne&&(Q.width(t.width()),Q.height(t.height()),ie.aspect=t.width()/t.height(),Ae||(ie.left=-ie.aspect*ie.top,ie.right=ie.aspect*ie.top),ie.updateProjectionMatrix(),Ne.setSize(t.width(),t.height()),ge=!0,setTimeout(()=>{Ne&&(Q.width(t.width()),Q.height(t.height()),ie.aspect=t.width()/t.height(),Ae||(ie.left=-ie.aspect*ie.top,ie.right=ie.aspect*ie.top),ie.updateProjectionMatrix(),Ne.setSize(t.width(),t.height()),ge=!0)},300))};this.recursiveRemove=le=>{for(;le.children.length>0;)this.recursiveRemove(le.children[0]),le.remove(le.children[0]);ge=!0},this.disconnect=()=>{this.renderer.setAnimationLoop(null),this.disposed=!0,$(window).off("resize",ye),t.off(),u!==!1&&u.off(),this.recursiveRemove(this.sceneBed),this.recursiveRemove(this.scene),this.recursiveRemove(this.scene2),this.recursiveRemove(this.sceneAxis),this.tracker.dispose(),Ne.forceContextLoss(),Ne.dispose(),Ye.forceContextLoss(),Ye.dispose(),this.orbit=null,this.canvas=null,Ne=null,Ye=null,ne=!0},this.refresh=function(){ye()};let pt,yt,Ve;function G(){return new Promise((le,nt)=>{let H=new Image;h.imageExtension!=="png"?(H.onload=async()=>{(H.height===0||H.width===0)&&(console.warn("unknown image size - this svg is not supported"),nt(new Error("unknown image size - this svg is not supported")));let X=document.createElement("canvas"),oe=X.getContext("2d"),J,se,xe=wi.getMaxTextureSize(),pe=xe>4096?4096:xe;ao&&pe>1024&&(pe=1024);let Pe=!1,Ie=document.createElement("canvas");Ie.width=1,Ie.height=1;let ut=Ie.getContext("2d");do{J=X.width=pe,se=X.height=Math.floor(pe*H.height/H.width),oe.fillStyle="#818283",oe.fillRect(J-1,se-1,1,1),ut.drawImage(X,J-1,se-1,1,1,0,0,1,1);let Ke=ut.getImageData(0,0,1,1).data;Pe=pe<1e3||se<=xe&&Ke[3]!==0,Pe||(pe=pe/2)}while(!Pe);yt=J,Ve=se,oe.clearRect(J-1,J-1,1,1),oe.drawImage(H,0,0,J,se),Ie.remove();let Xe=document.createElement("img");Xe.src=X.toDataURL(),X.remove(),X=null,le(Xe)},OB.default.get("/printer/bed/"+e+"/get_image?r="+Math.random()).then(X=>{if(X.status===200){let se=new DOMParser().parseFromString(X.data,"text/xml").getElementsByTagName("svg")[0],xe=0,pe=0,Pe=X.data.match(/viewBox="(.*?)"/);if(Pe.length===2){let Ie=Pe[1].split(" ");Ie.length===4&&(xe=Number(Ie[2]),pe=Number(Ie[3]))}xe!==0&&pe!==0&&(se.setAttribute("width",Math.floor(xe)+"px"),se.setAttribute("height",Math.floor(pe)+"px")),H.src="data:image/svg+xml;base64,"+btoa(new XMLSerializer().serializeToString(se))}else nt()},()=>{nt(new Error("Failed downloading image"))})):(H.onload=()=>{yt=H.width,Ve=H.height,le(H)},H.src="/printer/bed/"+e+"/get_image?r="+Math.random())})}let me=async()=>{let le=await G();pt=new vi,pt.magFilter=$i,pt.minFilter=HT,pt.image=le,pt.needsUpdate=!0,w=new Wi({map:pt,opacity:h.imageOpacity*.01,transparent:!0,side:Ei,depthWrite:!1,depthFunc:$s}),this.tracker.add(pt),this.tracker.add(w)};this.addYLine=(le,nt,H,X,oe)=>{let J=Math.min(H,X)-.5*oe,se=Math.max(H,X)+.5*oe,xe=nt-.5*oe,pe=nt+.5*oe;le.push(pe,se,this.zMin,xe,se,this.zMin,xe,J,this.zMin),le.push(pe,se,this.zMin,xe,J,this.zMin,pe,J,this.zMin)},this.addXLine=(le,nt,H,X,oe)=>{let J=Math.min(nt,H)-.5*oe,se=Math.max(nt,H)+.5*oe;if(this.isZBelt){let xe=X-.5*oe,pe=X+.5*oe;le.push(se,y.yMin,pe,J,y.yMin,pe,J,y.yMin,xe),le.push(se,y.yMin,pe,J,y.yMin,xe,se,y.yMin,xe)}else{let xe=X-.5*oe,pe=X+.5*oe;le.push(se,pe,this.zMin,J,pe,this.zMin,J,xe,this.zMin),le.push(se,pe,this.zMin,J,xe,this.zMin,se,xe,this.zMin)}},this.addZLine=(le,nt,H,X,oe)=>{let J=Math.min(H,X)-.5*oe,se=Math.max(H,X)+.5*oe,xe=nt-.5*oe,pe=nt+.5*oe;le.push(pe,y.yMin,se,xe,y.yMin,se,xe,y.yMin,J),le.push(pe,y.yMin,se,xe,y.yMin,J,pe,y.yMin,J)},this.addSquareBed=le=>{this.bedGroup.clear(),le=Math.ceil(le/100)*100;let nt=this.tracker.add(new yr(le,le,10,10)),H=new St(nt,b);H.castShadow=!1,H.receiveShadow=!0,this.bedGroup.add(H);let X=le/2,oe=10;X>1e3?(oe=Math.floor(X/10),oe=Math.floor(X/5)*5):X>300&&(oe=25);let J=oe,se=.01*J,xe=.03*J,pe=[],Pe=[];this.addXLine(Pe,-X,X,-X,xe),this.addXLine(Pe,-X,X,X,xe),this.addYLine(Pe,-X,-X,X,xe),this.addYLine(Pe,X,-X,X,xe),X=le/2;let Ie=0;for(;Ie<X;){let we=Math.round(Ie/J)%5==0;we?(this.addYLine(Pe,Ie,-X,X,xe),this.addXLine(Pe,-X,X,Ie,xe)):(this.addYLine(pe,Ie,-X,X,se),this.addXLine(pe,-X,X,Ie,se)),Ie>0&&(we?(this.addYLine(Pe,-Ie,-X,X,xe),this.addXLine(Pe,-X,X,-Ie,xe)):(this.addYLine(pe,-Ie,-X,X,se),this.addXLine(pe,-X,X,-Ie,se))),Ie+=J}let ut=this.tracker.add(new _t);ut.setAttribute("position",new wt(new Float32Array(Pe),3));let Xe=new St(ut,x);Xe.renderOrder=20,this.bedGroup.add(Xe);let Ke=this.tracker.add(new _t);Ke.setAttribute("position",new wt(new Float32Array(pe),3));let et=new St(Ke,_);et.renderOrder=20,this.bedGroup.add(et);let rt=3+.5*xe,st=this.tracker.add(new yr(4*rt,rt)),Je=(we,he,be,Ce)=>{let ke=new St(st,we);ke.position.set(he,be,Ce*.05),ke.rotation.set(0,0,Ce),this.bedGroup.add(ke)};for(let we=0;we<=X;we+=oe){let he=this.makeMaterialWithText(we);if(we!==0){let be=this.makeMaterialWithText("-"+we);Je(be,-we,-X-rt,0),Je(be,-X-rt,-we,1.5*Math.PI),Je(be,-we,X+rt,Math.PI),Je(be,X+rt,-we,.5*Math.PI)}Je(he,we,-X-rt,0),Je(he,-X-rt,we,1.5*Math.PI),Je(he,we,X+rt,Math.PI),Je(he,X+rt,we,.5*Math.PI)}let Vt=this.makeMaterialWithText("X"),vt=this.makeMaterialWithText("Y");Je(Vt,0,-X-2.5*rt,0),Je(Vt,0,X+2.5*rt,Math.PI),Je(vt,-X-2.5*rt,0,1.5*Math.PI),Je(vt,X+2.5*rt,0,.5*Math.PI)},this.addPrinter=()=>{this.bedGroup.clear();let le=i.printerConfig[e].movement,nt=new _t;this.tracker.add(nt),nt.name="PrinterGeom";let H=new _t;this.tracker.add(H),H.name="printerGeomFat";let X=[],oe=[],J;this.zMin=le.zMin,this.zMax=le.zMax,this.isZBelt&&this.zMaxContent&&this.zMaxContent>this.zMax&&(this.zMax=this.zMaxContent),A=this.zMin,C=this.zMax,S=y.xMin,R=y.xMax,E=y.yMin,T=y.yMax;let se=h.gridSpacing,xe=.01*se,pe=.03*se;Y.makeEmpty(),Y.expandByPoint(new q(S,E,A)),Y.expandByPoint(new q(R,T,C)),M=R-S,D=T-E,O=C-A,P=Math.sqrt(M*M+D*D+O*O),W=2*P;let Pe,Ie,ut,Xe,Ke,et,rt=h.imageZoom*.01,st=[],Je=[];if(this.isZBelt){Pe=new yr(y.xMax-y.xMin,this.zMax,1,1),Pe.name="Bed plane",this.tracker.add(Pe),J=new St(Pe,b),J.position.x=.5*(y.xMax+y.xMin),J.position.y=y.yMin,J.position.z=.5*this.zMax,J.rotateX(-Math.PI*.5),this.addXLine(Je,y.xMin,y.xMax,this.zMin,pe),this.addXLine(Je,y.xMin,y.xMax,this.zMax,pe),this.addZLine(Je,y.xMin,this.zMin,this.zMax,pe),this.addZLine(Je,y.xMax,this.zMin,this.zMax,pe);let he=Math.sin(y.angle*Math.PI/180),be=Math.cos(y.angle*Math.PI/180),Ce=[new q(y.xMin,y.yMin,this.zMin),new q(y.xMax,y.yMin*he,this.zMin),new q(y.xMax,y.yMax*he,this.zMin+y.yMax*be),new q(y.xMin,y.yMax*he,this.zMin+y.yMax*be),new q(y.xMin,y.yMin*he,this.zMax),new q(y.xMax,y.yMin*he,this.zMax),new q(y.xMax,y.yMax*he,this.zMin+y.yMax*be),new q(y.xMin,y.yMax*he,this.zMin+y.yMax*be)];X.push(Ce[0].x,Ce[0].y,Ce[0].z,Ce[3].x,Ce[3].y,Ce[3].z,Ce[4].x,Ce[4].y,Ce[4].z,Ce[7].x,Ce[7].y,Ce[7].z,Ce[5].x,Ce[5].y,Ce[5].z,Ce[6].x,Ce[6].y,Ce[6].z,Ce[1].x,Ce[1].y,Ce[1].z,Ce[2].x,Ce[2].y,Ce[2].z,Ce[3].x,Ce[3].y,Ce[3].z,Ce[7].x,Ce[7].y,Ce[7].z,Ce[7].x,Ce[7].y,Ce[7].z,Ce[6].x,Ce[6].y,Ce[6].z,Ce[6].x,Ce[6].y,Ce[6].z,Ce[2].x,Ce[2].y,Ce[2].z,Ce[2].x,Ce[2].y,Ce[2].z,Ce[3].x,Ce[3].y,Ce[3].z),X.name="printerGeomPos";let ke=Math.ceil(y.xMin/se)*se;for(;ke<y.xMax;)parseInt(ke/se)%5==0?this.addZLine(Je,ke,this.zMin,this.zMax,pe):this.addZLine(st,ke,this.zMin,this.zMax,xe),ke+=se;for(ke=Math.ceil(this.zMin/se)*se;ke<this.zMax;)parseInt(ke/se)%5==0?this.addXLine(Je,y.xMin,y.xMax,ke,pe):this.addXLine(st,y.xMin,y.xMax,ke,xe),ke+=se;!w&&h.showImage&&me().then(()=>{let tt=O,mt=M,Ot=tt/mt,Mi=yt/Ve;Ot<Mi?mt=tt/Mi:tt=mt*Mi;let si=new yr(tt*rt,mt*rt);this.tracker.add(si),si.name="Bed image",si.rotateZ(-Math.PI*.5),si.rotateX(-Math.PI*.5),si.translate(.5*(y.xMax+y.xMin),y.yMin,.5*(this.zMax+this.zMin));let vc=new St(si,w);this.bedGroup.add(vc)})}else if(y.shape==="rectangle"){Pe=new yr(y.xMax-y.xMin,y.yMax-y.yMin,1,1),Pe.name="Bed plane",this.tracker.add(Pe),J=new St(Pe,b),J.position.x=.5*(y.xMax+y.xMin),J.position.y=.5*(y.yMax+y.yMin),J.position.z=A,this.addXLine(Je,y.xMin,y.xMax,y.yMin,pe),this.addXLine(Je,y.xMin,y.xMax,y.yMax,pe),this.addYLine(Je,y.xMin,y.yMin,y.yMax,pe),this.addYLine(Je,y.xMax,y.yMin,y.yMax,pe);let he=[new q(y.xMin,y.yMin,le.zMin),new q(y.xMax,y.yMin,le.zMin),new q(y.xMax,y.yMax,le.zMin),new q(y.xMin,y.yMax,le.zMin),new q(y.xMin,y.yMin,le.zMax),new q(y.xMax,y.yMin,le.zMax),new q(y.xMax,y.yMax,le.zMax),new q(y.xMin,y.yMax,le.zMax)];X.push(he[0].x,he[0].y,he[0].z,he[4].x,he[4].y,he[4].z,he[1].x,he[1].y,he[1].z,he[5].x,he[5].y,he[5].z,he[2].x,he[2].y,he[2].z,he[6].x,he[6].y,he[6].z,he[3].x,he[3].y,he[3].z,he[7].x,he[7].y,he[7].z,he[4].x,he[4].y,he[4].z,he[5].x,he[5].y,he[5].z,he[5].x,he[5].y,he[5].z,he[6].x,he[6].y,he[6].z,he[6].x,he[6].y,he[6].z,he[7].x,he[7].y,he[7].z,he[7].x,he[7].y,he[7].z,he[4].x,he[4].y,he[4].z),X.name="printerGeomPos";let be=Math.ceil(y.xMin/se)*se;for(;be<y.xMax;)parseInt(be/se)%5==0?this.addYLine(Je,be,y.yMin,y.yMax,pe):this.addYLine(st,be,y.yMin,y.yMax,xe),be+=se;for(be=Math.ceil(y.yMin/se)*se;be<y.yMax;)parseInt(be/se)%5==0?this.addXLine(Je,y.xMin,y.xMax,be,pe):this.addXLine(st,y.xMin,y.xMax,be,xe),be+=se;!w&&h.showImage&&me().then(()=>{let Ce=R-S,ke=T-E,tt=Ce/ke,mt=yt/Ve;tt<mt?ke=Ce/mt:Ce=ke*mt;let Ot=new yr(Ce*rt,ke*rt);this.tracker.add(Ot),Ot.name="Bed image",Ot.translate(.5*(y.xMax+y.xMin),.5*(y.yMax+y.yMin),le.zMin);let Mi=new St(Ot,w);this.bedGroup.add(Mi)})}else{Pe=new El(y.radius,64),this.tracker.add(Pe),Pe.name="Bed circle",J=new St(Pe,b),J.position.x=y.x,J.position.y=y.y,J.position.z=A;let he=y.radius;for(let ke=0;ke<8;ke++)et=.25*Math.PI*ke,Xe=Math.cos(et)*he,Ke=Math.sin(et)*he,X.push(Xe,Ke,A,Xe,Ke,C);for(let ke=0;ke<64;ke++){et=.0625*Math.PI*ke*.5,Xe=Math.cos(et)*(he-.5*pe),Ke=Math.sin(et)*(he-.5*pe),Ie=Math.cos(et)*(he+.5*pe),ut=Math.sin(et)*(he+.5*pe);let tt=.0625*Math.PI*(ke+1)*.5,mt=Math.cos(tt)*(he-.5*pe),Ot=Math.sin(tt)*(he-.5*pe),Mi=Math.cos(tt)*(he+.5*pe),si=Math.sin(tt)*(he+.5*pe);Je.push(Ie,ut,A,Mi,si,A,mt,Ot,A,Ie,ut,A,mt,Ot,A,Xe,Ke,A),Je.push(Ie,ut,C,Mi,si,C,mt,Ot,C,Ie,ut,C,mt,Ot,C,Xe,Ke,C)}!w&&h.showImage&&me().then(()=>{let ke=2*y.radius,tt=2*y.radius,mt=yt/Ve;1<mt?tt=ke/mt:tt=tt*mt;let Ot=new yr(ke*rt,tt*rt);this.tracker.add(Ot),Ot.name="Bed image",Ot.translate(0,0,le.zMin);let Mi=new St(Ot,w);this.bedGroup.add(Mi)});let be=se,Ce=Math.max(Math.abs(y.x-y.radius),Math.abs(y.x+y.radius),Math.abs(y.y-y.radius),Math.abs(y.y+y.radius));if(parseFloat(se)>=1){0>y.yMin&&0<y.yMax&&this.addXLine(Je,y.x-y.radius,y.x+y.radius,0,pe),0>y.xMin&&0<y.xMax&&this.addYLine(Je,0,y.y-y.radius,y.y+y.radius,pe);let ke,tt;for(;be<Ce;){let mt=parseInt(be/se)%5==0;be>y.yMin&&be<y.yMax&&(ke=Math.asin((-be-y.y)/he),tt=he*Math.cos(ke),mt?this.addXLine(Je,y.x-tt,y.x+tt,y.y-be,pe):this.addXLine(st,y.x-tt,y.x+tt,y.y-be,xe)),be>y.xMin&&be<y.xMax&&(ke=Math.asin((be-y.x)/he),tt=he*Math.cos(ke),mt?this.addYLine(Je,y.x+be,y.y-tt,y.y+tt,pe):this.addYLine(st,y.x+be,y.y-tt,y.y+tt,xe)),be!==0&&(-be>y.yMin&&-be<y.yMax&&(ke=Math.asin((be-y.y)/he),tt=he*Math.cos(ke),mt?this.addXLine(Je,y.x-tt,y.x+tt,y.y+be,pe):this.addXLine(st,y.x-tt,y.x+tt,y.y+be,xe)),-be>y.xMin&&-be<y.xMax&&(ke=Math.asin((-be-y.x)/he),tt=he*Math.cos(ke),mt?this.addYLine(Je,y.x-be,y.y-tt,y.y+tt,pe):this.addYLine(st,y.x-be,y.y-tt,y.y+tt,xe))),be+=se}}}J.receiveShadow=this.withShadows,this.bedGroup.add(J),nt.setAttribute("position",new Bt(X,3));let Vt=new cn(nt,g);if(Vt.renderOrder=10,Vt.castShadow=!1,this.bedGroup.add(Vt),oe.length>0){H.setAttribute("position",new Bt(oe,3));let he=new cn(H,p);he.castShadow=!1,this.bedGroup.add(he)}this.printerTriSmallGeom=this.tracker.add(new _t),this.printerTriSmallGeom.setAttribute("position",new wt(new Float32Array(Je),3));let vt=new St(this.printerTriSmallGeom,x);vt.renderOrder=20,vt.translateZ(A),this.bedGroup.add(vt),this.printerTriSmallGeom=this.tracker.add(new _t),this.printerTriSmallGeom.setAttribute("position",new wt(new Float32Array(st),3));let we=new St(this.printerTriSmallGeom,_);we.translateZ(A),we.renderOrder=20,this.bedGroup.add(we),z&&(Y.getCenter(He),Y.getCenter(this.orbit.target),V=W=4*P,U=Y.clone(),this.orientIsometric(),this.fitBoundingBox(Y)),z=!1,ge=!0},this.addProject=le=>{this.bedGroup.clear();let nt=new _t;this.tracker.add(nt),nt.name="PrinterGeom";let H=new _t;this.tracker.add(H),H.name="printerGeomFat";let X=[],oe=[],J;this.zMin=le.zMin,this.zMax=le.zMax+20,this.isZBelt=le.printerType===2,y={xMin:le.xMin-20,xMax:le.xMax+20,yMin:this.isZBelt?le.yMin:le.yMinMove-20,yMax:this.isZBelt?le.yMaxMove+20:le.yMax+20,angle:le.printerParam1,shape:"rectangle"},U.set(new q(y.xMin,y.yMin,this.zMin),new q(y.xMax,y.yMax,this.zMax)),this.isZBelt&&(ie.up.set(0,1,0),re.up.set(0,1,0)),A=this.zMin,C=this.zMax,S=y.xMin,R=y.xMax,E=y.yMin,T=y.yMax;let se=10,xe=.01*se,pe=.03*se;Y.makeEmpty(),Y.expandByPoint(new q(S,E,A)),Y.expandByPoint(new q(R,T,C)),M=R-S,D=T-E,O=C-A,P=Math.sqrt(M*M+D*D+O*O),W=2*P;let Pe,Ie,ut,Xe,Ke,et,rt=[],st=[];if(this.isZBelt){Pe=new yr(y.xMax-y.xMin,this.zMax,1,1),Pe.name="Bed plane",this.tracker.add(Pe),J=new St(Pe,b),J.position.x=.5*(y.xMax+y.xMin),J.position.y=y.yMin,J.position.z=.5*this.zMax,J.rotateX(-Math.PI*.5),this.addXLine(st,y.xMin,y.xMax,this.zMin,pe),this.addXLine(st,y.xMin,y.xMax,this.zMax,pe),this.addZLine(st,y.xMin,this.zMin,this.zMax,pe),this.addZLine(st,y.xMax,this.zMin,this.zMax,pe);let we=Math.sin(y.angle*Math.PI/180),he=Math.cos(y.angle*Math.PI/180),be=[new q(y.xMin,y.yMin,this.zMin),new q(y.xMax,y.yMin*we,this.zMin),new q(y.xMax,y.yMax*we,this.zMin+y.yMax*he),new q(y.xMin,y.yMax*we,this.zMin+y.yMax*he),new q(y.xMin,y.yMin*we,this.zMax),new q(y.xMax,y.yMin*we,this.zMax),new q(y.xMax,y.yMax*we,this.zMin+y.yMax*he),new q(y.xMin,y.yMax*we,this.zMin+y.yMax*he)];X.push(be[0].x,be[0].y,be[0].z,be[3].x,be[3].y,be[3].z,be[4].x,be[4].y,be[4].z,be[7].x,be[7].y,be[7].z,be[5].x,be[5].y,be[5].z,be[6].x,be[6].y,be[6].z,be[1].x,be[1].y,be[1].z,be[2].x,be[2].y,be[2].z,be[3].x,be[3].y,be[3].z,be[7].x,be[7].y,be[7].z,be[7].x,be[7].y,be[7].z,be[6].x,be[6].y,be[6].z,be[6].x,be[6].y,be[6].z,be[2].x,be[2].y,be[2].z,be[2].x,be[2].y,be[2].z,be[3].x,be[3].y,be[3].z),X.name="printerGeomPos";let Ce=Math.ceil(y.xMin/se)*se;for(;Ce<y.xMax;)parseInt(Ce/se)%5==0?this.addZLine(st,Ce,this.zMin,this.zMax,pe):this.addZLine(rt,Ce,this.zMin,this.zMax,xe),Ce+=se;for(Ce=Math.ceil(this.zMin/se)*se;Ce<this.zMax;)parseInt(Ce/se)%5==0?this.addXLine(st,y.xMin,y.xMax,Ce,pe):this.addXLine(rt,y.xMin,y.xMax,Ce,xe),Ce+=se}else if(y.shape==="rectangle"){Pe=new yr(y.xMax-y.xMin,y.yMax-y.yMin,1,1),Pe.name="Bed plane",this.tracker.add(Pe),J=new St(Pe,b),J.position.x=.5*(y.xMax+y.xMin),J.position.y=.5*(y.yMax+y.yMin),J.position.z=A,this.addXLine(st,y.xMin,y.xMax,y.yMin,pe),this.addXLine(st,y.xMin,y.xMax,y.yMax,pe),this.addYLine(st,y.xMin,y.yMin,y.yMax,pe),this.addYLine(st,y.xMax,y.yMin,y.yMax,pe);let we=[new q(y.xMin,y.yMin,this.zMin),new q(y.xMax,y.yMin,this.zMin),new q(y.xMax,y.yMax,this.zMin),new q(y.xMin,y.yMax,this.zMin),new q(y.xMin,y.yMin,this.zMax),new q(y.xMax,y.yMin,this.zMax),new q(y.xMax,y.yMax,this.zMax),new q(y.xMin,y.yMax,this.zMax)];X.push(we[0].x,we[0].y,we[0].z,we[4].x,we[4].y,we[4].z,we[1].x,we[1].y,we[1].z,we[5].x,we[5].y,we[5].z,we[2].x,we[2].y,we[2].z,we[6].x,we[6].y,we[6].z,we[3].x,we[3].y,we[3].z,we[7].x,we[7].y,we[7].z,we[4].x,we[4].y,we[4].z,we[5].x,we[5].y,we[5].z,we[5].x,we[5].y,we[5].z,we[6].x,we[6].y,we[6].z,we[6].x,we[6].y,we[6].z,we[7].x,we[7].y,we[7].z,we[7].x,we[7].y,we[7].z,we[4].x,we[4].y,we[4].z),X.name="printerGeomPos";let he=Math.ceil(y.xMin/se)*se;for(;he<y.xMax;)parseInt(he/se)%5==0?this.addYLine(st,he,y.yMin,y.yMax,pe):this.addYLine(rt,he,y.yMin,y.yMax,xe),he+=se;for(he=Math.ceil(y.yMin/se)*se;he<y.yMax;)parseInt(he/se)%5==0?this.addXLine(st,y.xMin,y.xMax,he,pe):this.addXLine(rt,y.xMin,y.xMax,he,xe),he+=se}else{Pe=new El(y.radius,64),this.tracker.add(Pe),Pe.name="Bed circle",J=new St(Pe,b),J.position.x=y.x,J.position.y=y.y,J.position.z=A;let we=y.radius;for(let Ce=0;Ce<8;Ce++)et=.25*Math.PI*Ce,Xe=Math.cos(et)*we,Ke=Math.sin(et)*we,X.push(Xe,Ke,A,Xe,Ke,C);for(let Ce=0;Ce<64;Ce++){et=.0625*Math.PI*Ce*.5,Xe=Math.cos(et)*(we-.5*pe),Ke=Math.sin(et)*(we-.5*pe),Ie=Math.cos(et)*(we+.5*pe),ut=Math.sin(et)*(we+.5*pe);let ke=.0625*Math.PI*(Ce+1)*.5,tt=Math.cos(ke)*(we-.5*pe),mt=Math.sin(ke)*(we-.5*pe),Ot=Math.cos(ke)*(we+.5*pe),Mi=Math.sin(ke)*(we+.5*pe);st.push(Ie,ut,A,Ot,Mi,A,tt,mt,A,Ie,ut,A,tt,mt,A,Xe,Ke,A),st.push(Ie,ut,C,Ot,Mi,C,tt,mt,C,Ie,ut,C,tt,mt,C,Xe,Ke,C)}let he=se,be=Math.max(Math.abs(y.x-y.radius),Math.abs(y.x+y.radius),Math.abs(y.y-y.radius),Math.abs(y.y+y.radius));if(parseFloat(se)>=1){0>y.yMin&&0<y.yMax&&this.addXLine(st,y.x-y.radius,y.x+y.radius,0,pe),0>y.xMin&&0<y.xMax&&this.addYLine(st,0,y.y-y.radius,y.y+y.radius,pe);let Ce,ke;for(;he<be;){let tt=parseInt(he/se)%5==0;he>y.yMin&&he<y.yMax&&(Ce=Math.asin((-he-y.y)/we),ke=we*Math.cos(Ce),tt?this.addXLine(st,y.x-ke,y.x+ke,y.y-he,pe):this.addXLine(rt,y.x-ke,y.x+ke,y.y-he,xe)),he>y.xMin&&he<y.xMax&&(Ce=Math.asin((he-y.x)/we),ke=we*Math.cos(Ce),tt?this.addYLine(st,y.x+he,y.y-ke,y.y+ke,pe):this.addYLine(rt,y.x+he,y.y-ke,y.y+ke,xe)),he!==0&&(-he>y.yMin&&-he<y.yMax&&(Ce=Math.asin((he-y.y)/we),ke=we*Math.cos(Ce),tt?this.addXLine(st,y.x-ke,y.x+ke,y.y+he,pe):this.addXLine(rt,y.x-ke,y.x+ke,y.y+he,xe)),-he>y.xMin&&-he<y.xMax&&(Ce=Math.asin((-he-y.x)/we),ke=we*Math.cos(Ce),tt?this.addYLine(st,y.x-he,y.y-ke,y.y+ke,pe):this.addYLine(rt,y.x-he,y.y-ke,y.y+ke,xe))),he+=se}}}J.receiveShadow=this.withShadows,this.bedGroup.add(J),nt.setAttribute("position",new Bt(X,3));let Je=new cn(nt,g);if(Je.renderOrder=10,Je.castShadow=!1,this.bedGroup.add(Je),oe.length>0){H.setAttribute("position",new Bt(oe,3));let we=new cn(H,p);we.castShadow=!1,this.bedGroup.add(we)}this.printerTriSmallGeom=this.tracker.add(new _t),this.printerTriSmallGeom.setAttribute("position",new wt(new Float32Array(st),3));let Vt=new St(this.printerTriSmallGeom,x);Vt.renderOrder=20,Vt.translateZ(A),this.bedGroup.add(Vt),this.printerTriSmallGeom=this.tracker.add(new _t),this.printerTriSmallGeom.setAttribute("position",new wt(new Float32Array(rt),3));let vt=new St(this.printerTriSmallGeom,_);vt.translateZ(A),vt.renderOrder=20,this.bedGroup.add(vt),z&&(Y.getCenter(He),Y.getCenter(this.orbit.target),V=W=4*P,U=Y.clone(),this.orientIsometric(),this.fitBoundingBox(Y)),z=!1,ge=!0},this.fitBoundingBox=le=>{let nt=t.width()/t.height(),H=1.5*Math.sqrt((M*M+D*D+O*O)*.25);le.getCenter(He),this.orbit.target.copy(He),W=V;let X=8,oe=(Ae?ie.fov:30)/2*Math.PI/180;for(;X>0;){X--,this.orbit.fromPhiTheta(W),this.orbit.update();let J=new q().copy(ie.position),se=new gt;se.lookAt2(J,He,ie.up);let xe=new gt,pe=new q;pe.subVectors(He,J),pe.normalize();let Pe=-pe.dot(J),Ie=Math.max(1,Pe-H),ut=Math.max(H*2,Pe+H),Xe=2*Math.tan(oe)*Pe;if(!Ae)xe.makeOrthographic(-.5*Xe*nt,.5*Xe*nt,.5*Xe,-.5*Xe,Ie,ut),X=0;else{let Vt=Math.tan(oe)*Ie,vt=Vt*nt;xe.makePerspective(-vt,vt,-Vt,Vt,Ie,ut)}let Ke=new gt;Ke.multiplyMatrices(xe,se);let et=new Li,rt=le.min.toVector4().applyMatrix4(Ke).toVector3();et.expandByPoint(rt),rt=le.max.toVector4().applyMatrix4(Ke).toVector3(),et.expandByPoint(rt);let st=new q(le.min.x,le.max.y,le.min.z);rt=st.toVector4().applyMatrix4(Ke).toVector3(),et.expandByPoint(rt),st=new q(le.max.x,le.min.y,le.min.z),rt=st.toVector4().applyMatrix4(Ke).toVector3(),et.expandByPoint(rt),st=new q(le.max.x,le.max.y,le.min.z),rt=st.toVector4().applyMatrix4(Ke).toVector3(),et.expandByPoint(rt),st=new q(le.min.x,le.max.y,le.max.z),rt=st.toVector4().applyMatrix4(Ke).toVector3(),et.expandByPoint(rt),st=new q(le.min.x,le.min.y,le.max.z),rt=st.toVector4().applyMatrix4(Ke).toVector3(),et.expandByPoint(rt),st=new q(le.max.x,le.min.y,le.max.z),rt=st.toVector4().applyMatrix4(Ke).toVector3(),et.expandByPoint(rt);let Je=Math.max(Math.abs(et.min.x),Math.abs(et.max.x));Je=Math.max(Je,Math.abs(et.min.y)),Je=Math.max(Je,Math.abs(et.max.y)),Ae?W*=Je*1.03:(Je=Je*1.03*.5,ie.left=-Je*Xe*nt,ie.right=Je*Xe*nt,ie.top=Je*Xe,ie.bottom=-Je*Xe,ie.near=Ie,ie.far=ut,ie.zoom=1,ie.updateProjectionMatrix())}ie.updateProjectionMatrix(),ge=!0},this.orientFront=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI/2,-Math.PI/2):this.orbit.setPhiTheta(Math.PI/2,0),this.fitBoundingBox(U)},this.orientBack=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI/2,Math.PI/2):this.orbit.setPhiTheta(Math.PI/2,Math.PI),this.fitBoundingBox(U)},this.orientLeft=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI/2,Math.PI):this.orbit.setPhiTheta(Math.PI/2,-Math.PI/2),this.fitBoundingBox(U)},this.orientRight=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI/2,0):this.orbit.setPhiTheta(Math.PI/2,Math.PI/2),this.fitBoundingBox(U)},this.orientTop=()=>{this.isZBelt?this.orbit.setPhiTheta(1e-5,-Math.PI*.5):this.orbit.setPhiTheta(1e-5,0),this.fitBoundingBox(U)},this.orientBottom=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI,-Math.PI*.5):this.orbit.setPhiTheta(Math.PI,0),this.fitBoundingBox(U)},this.orientIsometric=()=>{this.isZBelt?this.orbit.setPhiTheta(Math.PI*.3,-Math.PI/5-.5*Math.PI):this.orbit.setPhiTheta(Math.PI*.3,-Math.PI/5),this.fitBoundingBox(U)},this.fitObjects=()=>{this.fitBoundingBox(Y)},this.fitPrinter=()=>{this.fitBoundingBox(U)},this.removeLightsIn=le=>{let nt=[];le.children.forEach(H=>{H.isLight&&nt.push(H)}),nt.forEach(H=>{this.tracker.remove(H,!0),le.remove(H)})},this.addLights=()=>{this.removeLightsIn(te),this.removeLightsIn(Me),this.removeLightsIn(this.sceneBed),this.removeLightsIn(ze),this.ambientLight=new jc(4210752),te.add(this.tracker.add(this.ambientLight)),Me.add(this.tracker.add(this.ambientLight.clone())),this.sceneBed.add(this.tracker.add(this.ambientLight.clone())),ze.add(this.tracker.add(this.ambientLight.clone()));let le=y===!1?M:Math.max(Math.abs(y.xMin),Math.abs(y.xMax)),nt=y===!1?D:Math.max(Math.abs(y.yMin),Math.abs(y.yMax)),H=Math.sqrt(le*le+nt*nt)*.5,X=new zh(16777215);this.directLight1=X;let oe=(this.isZBelt?D:O)/P;if(this.isZBelt?X.position.set(oe*.5*P,oe*.2*P,.3*oe*P):X.position.set(oe*.3*P,oe*.5*P,.2*oe*P),te.add(this.tracker.add(X)),Me.add(this.tracker.add(X.clone())),this.sceneBed.add(this.tracker.add(X.clone())),ze.add(this.tracker.add(X.clone())),X.castShadow=this.withShadows,X.shadow.camera.left=-H,X.shadow.camera.right=H,X.shadow.camera.top=H,X.shadow.camera.bottom=-H,X.shadow.camera.near=0,X.shadow.camera.far=2*P,X.shadow.mapSize.width=4096,X.shadow.mapSize.height=4096,X.shadow.bias=.005,a){let J=new Xc(X,5,0);te.add(J),this.tracker.add(J);let se=new Yc(X.shadow.camera);te.add(se),this.tracker.add(se)}if(X=this.tracker.add(new zh(16777215)),this.directLight1=X,this.isZBelt?X.position.set(oe*-.5*P,oe*.2*P,-.4*oe*P):X.position.set(oe*-.4*P,oe*-.5*P,.2*oe*P),te.add(this.tracker.add(X)),Me.add(this.tracker.add(X.clone())),this.sceneBed.add(this.tracker.add(X.clone())),ze.add(this.tracker.add(X.clone())),X.castShadow=this.withShadows,X.shadow.camera.left=-H,X.shadow.camera.right=H,X.shadow.camera.top=H,X.shadow.camera.bottom=-H,X.shadow.camera.near=0,X.shadow.camera.far=2*P*oe,X.shadow.mapSize.width=4096,X.shadow.mapSize.height=4096,X.shadow.bias=.005,a){let J=new Xc(X,5,0);te.add(J),this.tracker.add(J);let se=new Yc(X.shadow.camera);te.add(se),this.tracker.add(se)}this.numLights=3,ge=!0},this.getPrinterBox=function(){return U};let Se,Be,De,Ze,Te={},ft=le=>{this.shiftKey=le.shiftKey,this.ctrlKey=le.ctrlKey,this.altKey=le.altKey;let nt=Q.offset();Te[le.pointerId]={x:le.clientX,y:le.clientY},le.points=Object.values(Te);let H={x:0,y:0},X=le.points.length;le.points.forEach(oe=>{H.x+=oe.x/X,H.y+=oe.y/X}),le.center=H,le.handleAsLeftButton=le.pointerType==="touch"&&X===1||le.button===0,d.x=(H.x-nt.left)/Q.width()*2-1,d.y=-((H.y-nt.top)/Q.height())*2+1,this.ray.setFromCamera(d,ie)},Et=le=>{ft(le),this.clickCallback&&this.clickCallback(le)},bt=le=>{ft(le),this.moveCallback&&this.moveCallback(le)},mi=le=>{ft(le),this.unclickCallback&&this.unclickCallback(le),Te[le.pointerId]&&delete Te[le.pointerId],N=!1},sr=le=>{ft(le),Te[le.pointerId]&&delete Te[le.pointerId],this.cancelCallback&&this.cancelCallback(le),N=!1};this.disablePointerCallbacks=()=>{this.clickCallback=void 0,this.moveCallback=void 0,this.unclickCallback=void 0,this.cancelCallback=void 0};function js(le){}function pl(le){le.touches.length===1&&(le.preventDefault(),Se=le.touches[0].pageX,Be=le.touches[0].pageY,De=F,Ze=B)}function qs(le){le.touches.length===1&&(le.preventDefault(),F=(Se-le.touches[0].pageX)*.0174+De,B=-(le.touches[0].pageY-Be)*.0174+Ze)}function To(){let le=t.width();L!==le&&(ye(),L=le),ne||setTimeout(To,500)}To();let _s=le=>(le.preventDefault(),le.returnValue=!1,!1),Xs=()=>{N=!1,document.removeEventListener("mousewheel",js,!1),window.removeEventListener("DOMMouseScroll",_s,!1)},Ao=()=>{document.addEventListener("mousewheel",js,!1),window.addEventListener("DOMMouseScroll",_s,!1)};this.enableRaycasts=()=>{this.doRaycasts=!0,t[0].addEventListener("pointerdown",Et),t[0].addEventListener("pointermove",bt),t[0].addEventListener("pointerup",mi),t[0].addEventListener("pointerout",Xs),t[0].addEventListener("pointerenter",Ao),t[0].addEventListener("pointercancel",sr)},this.disableRaycasts=()=>{this.doRaycasts=!1,t[0].removeEventListener("pointerdown",Et),t[0].removeEventListener("pointermove",bt),t[0].removeEventListener("pointerup",mi),t[0].removeEventListener("pointerout",Xs),t[0].removeEventListener("pointerenter",Ao),t[0].removeEventListener("pointercancel",sr)},ct(),this.renderer.setAnimationLoop(Ft),ge=!0}RSBase.directive("autoscroll",function(){return{scope:{scroll:"=autoscroll"},restrict:"A",link:function(t,e){t.$watch("scroll",function(){t.scroll&&(e[0].scrollTop=e[0].scrollHeight)}),e.bind("scroll",function(){t.$apply(function(){t.scroll&&(e[0].scrollTop=e[0].scrollHeight)})})}}}).directive("enter",function(){return function(t,e,i){e.bind("keydown keypress",function(r){r.which===13&&(t.$apply(function(){t.$eval(i.enter)}),r.preventDefault())})}});RSBase.component("rsIconEditor",{template:`
<!-- <script type="text/ng-template" id="rsIconEditor.html">
        <div class="modal-header">
            <h3 class="modal-title" id="modal-title">I'm a modal!</h3>
        </div>
        <div class="modal-body" id="modal-body">
            <ul>
                <li ng-repeat="item in $ctrl.items">
                    <a href="#" ng-click="$event.preventDefault(); $ctrl.selected.item = item">{{ item }}</a>
                </li>
            </ul>
            Selected: 
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="button" ng-click="$ctrl.ok()">OK</button>
            <button class="btn btn-warning" type="button" ng-click="$ctrl.cancel()">Cancel</button>
        </div>
    <\/script> -->
<div class="input-group" ng-click="ctrl.openEditor()">
        <input type="text" class="form-control" readonly ng-model="ctrl.ngModel" ng-change="ctrl.ngModelChange()">
        <span class="input-group-addon" id="basic-addon2"><rs-menu-icon icon="{{ctrl.defaultIcon}}" icon-img="ctrl.ngModel"></rs-menu-icon></span>
      </div>`,controllerAs:"ctrl",bindings:{ngModel:"<",defaultIcon:"@"},require:{ngModelCtrl:"ngModel"},controller:["$uibModal",function(t){let e=this;this.openEditor=()=>{let i,r=t.open({template:`
        <div id="iconDrop">
        <div class="modal-header">
            <h3 class="modal-title" id="modal-title">Редактор иконок</h3>
        </div>
        <div class="modal-body" id="modal-body">
        <h3>Просмотр</h3>
        <div class="alert alert-info margin-top margin-bottom" >
           Ты видишь предварительный просмотр иконки в светлом и темном режиме в маленьком и большом размере. Все должно выглядеть отлично. Для сравнения иконка сопровождается знаком X для сравнения и позиции judjing при использовании с текстовым контентом.            
        </div>
        <div style="display: flex;justify-content: space-around">
        <div style="background:#eeeeee;padding:10px;flex-grow: 1;display:flex;justify-content: space-around;align-items: center">
        <span style="font-size:19px;color: #111111;display: inline-block"><rs-icon icon-img="$ctrl.icon"></rs-icon>&nbsp;X</span>
        <span style="font-size:64px;color: #111111;display: inline-block"><rs-icon icon-img="$ctrl.icon"></rs-icon>&nbsp;X</span>
        </div>
        <div style="background:#111111;padding:10px;flex-grow: 1;display:flex;justify-content: space-around;align-items: center">
        <span style="font-size:19px;color: #eeeeee;display: inline-block"><rs-icon icon-img="$ctrl.icon"></rs-icon>&nbsp;X</span>
        <span style="font-size:64px;color: #eeeeee;display: inline-block"><rs-icon icon-img="$ctrl.icon"></rs-icon>&nbsp;X</span>
         </div>
        </div>
        <h3>Редактор</h3>
            <div class="btn-group  btn-group-justified" >
              <div class="btn-group btn-group-lg" style="width: 100%">
              <div style="" class="btn btn-file btn-primary btn-block">
                <input type="file" id="iconUpload"/>            
                {{$ctrl.dragMessage}}
              </div>
              </div>
              <div class="btn-group btn-group-lg" style="width: 70px" ng-if="$ctrl.original!==$ctrl.icon">
              <div class="btn btn-primary" ng-click="$ctrl.reset()"><i class="fa fa-undo"></i></div>
              </div>
            </div>
            <div class="alert alert-warning margin-top margin-bottom" ng-if="$ctrl.isPNG"><i class="fa fa-warning"></i>
              Ты загрузил изображение. Изображения не будут правильно подстраиваться под цвет и разрешение шрифта. Поэтому тебе следует подумать о замене пиксельного изображения на SVG-изображение.            
            </div>
            <div class="alert alert-warning margin-top margin-bottom" ng-if="$ctrl.isURL"><i class="fa fa-warning"></i>
              Ты выбрал URL-адрес. Изображения не будут правильно подстраиваться под цвет и разрешение шрифта. Поэтому тебе следует подумать о замене пиксельного изображения на встроенное SVG-изображение.            
            </div>
            <div class="alert alert-warning margin-top margin-bottom" ng-if="$ctrl.isEmpty"><i class="fa fa-warning"></i>
              Введите здесь предпочтительно одноцветный код изображения SVG. URL-адрес или PNG-изображение также возможны, но не позволяют настроить цвет шрифта.            
            </div>
            <div class="alert alert-warning margin-top margin-bottom" ng-if="$ctrl.isUnknown"><i class="fa fa-warning"></i>
              Нераспознанный формат. Убедись, что хотя бы значок отображается правильно, или удали содержимое, чтобы предотвратить ошибки!            
            </div>

            <textarea spellcheck="false" ng-model="$ctrl.icon" style="width:100%;height:150px"></textarea>
                
            <div ng-if="$ctrl.isSVG && $ctrl.colors && $ctrl.colors.length>0">
              <div class="alert alert-info margin-top margin-bottom">
                The SVG needs to use currentColor as color, so it uses font size and adjust to correct font color. We found the following colors. To convert them to currentColor hit the button with the color name you want to change.            
              </div>
              <div class="btn btn-default" ng-click="$ctrl.replaceColors($ctrl.colors)">Замените все цвета</div>
              <div class="btn btn-default" ng-repeat="c in $ctrl.colors" style="background:{{c}};text-shadow: 0px 0px 3px rgba(0,0,0,0.95);" ng-click="$ctrl.replaceColors([c])">{{c}}</div>
            </div>        
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="button" ng-click="$ctrl.ok()">Хорошо</button>
            <button class="btn btn-default" type="button" ng-click="$ctrl.cancel()">Отменить</button>
        </div>
        </div>
        `,controller:["$uibModalInstance","icon","$scope",function(n,o,a){i=this,i.colors=!1,this.icon=o,i.ok=function(){u(),n.close(i.icon)},i.dragMessage="Перетащите SVG-иконку сюда",i.cancel=function(){n.dismiss("cancel")};let l=[new RegExp('(.*?)(fill\\s*?:\\s*?([^\\s};"]+))(.*)',"gmsi"),new RegExp('(.*?)(fill\\s*?=\\s*?"\\s*?([^"]+))(.*)',"gmsi"),new RegExp('(.*?)(color\\s*?:\\s*?([^\\s};"]+))(.*)',"gmsi"),new RegExp('(.*?)(stroke\\s*?=\\s*?"\\s*?([^"]+))(.*)',"gmsi")];function h(){if(i.isSVG===!1)return;let c=i.icon,f={},d=[],m=!0;for(let v=0;v<l.length;v++)for(l[v].lastIndex=-1;;){let g=l[v].lastIndex,p=l[v].exec(c);if(p!==null&&p.length>3)!f[p[3]]&&p[3]!=="currentColor"&&d.push(p[3]),f[p[3]]=!0,l[v].lastIndex=g+p[1].length+p[2].length;else break}d.sort(),i.colors=d}i.replaceColors=c=>{let f=i.icon,d=!0,m=new Array(l.length).fill(-1);for(;d;){d=!1;for(let v=0;v<l.length;v++)if(m[v]!==-2){l[v].lastIndex=m[v];do{let g=Math.max(0,l[v].lastIndex),p=l[v].exec(f);if(p!==null&&p.length>3){if(c.includes(p[3])){f=f.substr(0,g)+p[1]+p[2].replace(p[3],"currentColor")+p[4],d=!0,m[v]=g+p[1].length+12;break}p[1].length+p[2].length&&(l[v].lastIndex=p[1].length+p[2].length+g)}else{m[v]=-2;break}}while(!0)}}i.icon=f,h()};function u(){i.isSVG=!1,i.isEmpty=!1,i.isPNG=!1,i.isURL=!1,i.isUnknown=!1;let c=i.icon,f=c.indexOf("<svg");if(f>=0){if(i.isSVG=!0,c=c.substr(f),c.match(/fill\s*?[:=]/)||(c='<svg fill="currentColor"'+c.substr(4)),!c.match(/viewBox/)){let m=0,v=0,g=new RegExp('<svg.*?\\bwidth\\w*?=\\w*?"(.*?)".*?>',"gmsi").exec(c);g&&(m=g[1]);let p=new RegExp('<svg.*?\\bheight\\w*?=\\w*?"(.*?)".*?>',"gmsi").exec(c);g&&(v=p[1]),m!==0&&v!==0&&(c=c.replace("<svg",`<svg viewBox="0 0 ${m} ${v}"`))}c=c.replace(new RegExp('(<svg.*?)(\\swidth=".*?")(.*?>)',"gms"),"$1$3"),c=c.replace(new RegExp('(<svg.*?)(\\sheight=".*?")(.*?>)',"gms"),"$1$3"),c=c.replaceAll(new RegExp('(\\s+?(inkscape:|sodipodi:|xmlns).*?".*?")',"gmsi"),""),c=c.replace(new RegExp("<metadata.*?<\\/metadata>","gmsi"),"")}else c.charCodeAt(1)===80&&c.charCodeAt(2)===78&&c.charCodeAt(3)===71&&c.charCodeAt(4)===13&&c.charCodeAt(5)===10&&c.charCodeAt(6)===26&&c.charCodeAt(7)===10?(i.isPNG=!0,c="data:image/png;base64,"+btoa(c)):c.charCodeAt(0)===255&&c.charCodeAt(1)==216&&c.charCodeAt(2)===255?(i.isPNG=!0,c="data:image/jpeg;base64,"+btoa(c)):c.substr(0,5)==="data:"?i.isPNG=!0:c.substr(0,4)==="http"||c.substr(0,4)==="data"||c[0]==="/"?i.isURL=!0:c.length===0?i.isEmpty=!0:i.isUnknown=!0;i.original=i.icon=c}a.$watch("icon",function(){u(),h()}),this.$onChanges=c=>{c.icon&&h()},i.readFile=c=>{var f=c.target.files[0];if(f){var d=new FileReader;d.onload=function(m){i.original=i.icon=m.target.result,u(),h()},d.readAsBinaryString(f)}},i.reset=function(){i.icon=i.original,u(),h()},i.$postLink=function(){i.original=i.icon;let c=document.getElementById("iconDrop");document.getElementById("iconUpload").onchange=i.readFile,c.ondrop=f=>{f.preventDefault();let d=f.dataTransfer.files[0],m=new FileReader;return m.onload=function(v){i.original=i.icon=v.target.result,u(),h()},m.readAsBinaryString(d),!1},c.ondragover=function(){return this.className="dragOver",i.dragMessage="Перетащите файл",!1},c.onmouseleave=function(){return this.className="",i.dragMessage="Перетащите SVG-иконку сюда",!1},u()}}],controllerAs:"$ctrl",size:"lg",backdrop:"static",resolve:{icon:function(){return e.ngModel}}});window.mi=r,r.rendered.then(()=>{i.$postLink()}),r.result.then(n=>{this.ngModel=n,this.ngModelCtrl.$setViewValue(this.ngModel)},()=>{})},this.$onInit=()=>{this.ngModelChange=()=>{this.ngModelCtrl.$setViewValue(this.ngModel)}}}]});RSBase.factory("RSBrowseFolder",["$rootScope","$timeout","RSCom",function(t,e,i){let r={selectedFolder:t.folders.length>0?t.folders[0].id:0,activeFolderPath:"",filesInPath:[],unfiltered:[],filter:"",useFilter:!0,numSelected:0};return r.toggleSelectFile=function(n){if(n.isDir){r.activeFolderPath=n.path,r.updateFiles("");return}n.selected=!n.selected,r.updateFilter()},r.updateFilter=function(){r.filesInPath=[],r.numSelected=0,angular.forEach(r.unfiltered,function(n){let o=!1,a=n.name.substring(n.name.lastIndexOf(".")+1).toLowerCase();r.useFilter===!1?o=!0:n.name!==".."&&n.name.startsWith(".")?o=!1:(n.isDir||r.filter==="gcode"&&(a==="g"||a==="gco"||a==="gcode"||a==="nc"||a==="tap"||a==="gcd"||a==="dnc"||a==="cnc"||a==="zip"||a==="")||r.filter==="model"&&(a==="stl"||a==="obj"||a==="amf"))&&(o=!0),o&&(r.filesInPath.push(n),n.selected&&r.numSelected++)}),r.filesInPath.sort(function(n,o){return n.isDir!==o.isDir?n.isDir?-1:1:n.name.toLowerCase()<o.name.toLowerCase()?-1:1})},r.updateFiles=function(n){n||(n=""),i.send("browseFolder",{folder:r.selectedFolder,next:n,root:r.activeFolderPath}).then(function(o){o.ok&&(r.unfiltered=o.files,angular.forEach(r.unfiltered,function(a){a.selected=!1;let l=a.name.substr(a.name.lastIndexOf(".")+1).toLowerCase();a.isDir?a.icon="fa fa-folder-o":l==="g"||l==="gco"||l==="gcode"||l==="nc"||l==="tap"||l==="cnc"||l==="gcd"||l==="dnc"||l==="cnc"||l===""?a.icon="rs rs-file-gcode":l==="stl"||l==="obj"||l==="amf"?a.icon="rs rs-file-object":l==="mov"||l==="mp4"||l==="wmv"?a.icon="rs rs-file-video":l==="png"||l==="gif"||l==="jpg"?a.icon="rs rs-file-image":l==="zip"?a.icon="fa fa-file-archive-o":a.icon="rs rs-file",a.icon+=" rs-bigtab"}),r.activeFolderPath=o.root,r.updateFilter())})},r}]);(function(){window.RSPrinterModule=angular.module("RSPrinter",["ui.router","RSBase"]).config(["$stateProvider","RSFrontendProvider",function(t,e){t.state("about",{url:"/about",templateUrl:"/views/base/about.php?lang="+window.lang,controller:"AboutController"}).state("privacypolicy",{url:"/privacypolicy",templateUrl:"/views/base/privacypolicy.php?lang="+window.lang,controller:"PrivacyPolicyController"}).state("register",{url:"/register",templateUrl:"/views/base/register.php?lang="+window.lang,controller:"RegisterController"}).state("troubleshooting",{url:"/troubleshooting",templateUrl:"/views/base/troubleshooting.php?lang="+window.lang,controller:"TroubleshootingController"}).state("update",{url:"/update",templateUrl:"/views/base/update.php?lang="+window.lang,controller:"UpdateController"}).state("manufacturerNews",{url:"/manufacturerNews",templateUrl:"/views/base/manufacturerNews.php?lang="+window.lang,controller:"ManufacturerNewsController"}).state("project",{url:"/project/:serverid/:projectid",templateUrl:"/views/projects/projects.php?lang="+window.lang,resolve:{P:["RSOverview","GSettings","$q",function(i,r,n){return n.all([i.printerListLoadedPromise,r.promise])}]},controller:"ProjectController"}).state("projectgcodepreview",{url:"/projectgcodepreview/:serverid/:projectid/:model/:tab",templateUrl:"/views/projects/gcodepreview.php?lang="+window.lang,controller:"ProjectGCodePreviewController"}).state("externalLink",{name:"externalLink",url:"/externalLink/{id}",templateUrl:"/views/base/externallink.php?lang="+window.lang,controller:"ExternalLinkPrinterController"}).state("terminalCommand",{name:"terminalCommand",url:"/terminalCommand/{id}",templateUrl:"/views/base/terminalCommand.php?lang="+window.lang,controller:"TerminalCommandController"}).state("browse_projects",{url:"/browse_projects/:serverid/:folderid",templateUrl:"/views/projects/browseProjects.php?lang="+window.lang,resolve:{P:["RSOverview","GSettings","$q",function(i,r,n){return n.all([i.printerListLoadedPromise,r.promise])}]},controller:"BrowseProjectController"}).state("search_projects",{url:"/search_projects/:serverid/:tag/:search",params:{tag:{dynamic:!0},search:{dynamic:!0}},templateUrl:"/views/projects/searchProjects.php?lang="+window.lang,controller:"SearchProjectController"}).state("home",{url:"/dashboard",templateUrl:"/views/home.php?lang="+window.lang,controller:"HomeController",resolve:{IPS:["RSCom",function(i){return i.send("networkInterfaces",{})}]}}).state("start",{url:"/",template:"",controller:"StartController"}).state({name:"printer",url:"/printer/{slug}",templateUrl:"/views/printer/control/printer.php?lang="+window.lang,resolve:{P:["RSOverview","$stateParams","$rootScope","$q",function(i,r,n,o){var a=o.defer();return i.printerListLoadedPromise.then(function(){i.selectPrinter(r.slug),a.resolve()}),a.promise}]},controller:"PrinterController"}).state("printer.externalLink",{name:"externalLinkPrinter",url:"/externalLinkPrinter/{id}",templateUrl:"/views/printer/control/printer.externallink.php?lang="+window.lang,controller:"ExternalLinkPrinterController"}).state("printer.camera",{url:"/camera",templateUrl:"/views/printer/control/printer.camera.php?lang="+window.lang+"index=0",resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterCameraController"}).state("printer.timelapse",{url:"/timelapse",templateUrl:"/views/printer/control/printer.timelapse.php?lang="+window.lang+"index=1",resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterCameraController"}).state("printer.console",{url:"/console",templateUrl:"/views/printer/control/printer.console.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterConsoleController"}).state("printer.filamentchange",{url:"/filamentchange",templateUrl:"/views/printer/control/printer.filamentchange.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterFilamentChangeController"}).state("printer.control",{url:"/control?page",templateUrl:"/views/printer/control/printer.control.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterControlController"}).state("printer.eeprom",{url:"/eeprom",templateUrl:"/views/printer/control/printer.eeprom.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterEepromController"}).state("printer.klipperConfig",{url:"/klipper_config",templateUrl:"/views/printer/control/printer.klipperConfig.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterKlipperConfigController"}).state("printer.setup",{url:"/setup",templateUrl:"/views/printer/control/printer.setup.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterSetupController"}).state("printer.rescue",{url:"/rescue",templateUrl:"/views/printer/control/printer.rescue.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterRecoverController"}).state("printer.logs",{url:"/logs",templateUrl:"/views/printer/control/printer.logs.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterLogsController"}).state("printer.history",{url:"/history",templateUrl:"/views/printer/control/printer.history.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PrinterHistoryController"}).state({name:"printer.print",url:"/print",templateUrl:"/views/printer/control/printer.print.php?lang="+window.lang,resolve:{P:["RSOverview","GSettings","$q",function(i,r,n){return n.all([i.printerListLoadedPromise,r.promise])}]},controller:"PrinterGCodesController"}).state("printer.plates",{url:"/plates",templateUrl:"/views/printer/slicer/plates.php?lang="+window.lang,resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}]},controller:"PlatesController"}).state("printer.preview",{url:"/preview/:model/:tab",templateUrl:"/views/printer/control/printer.preview.php?lang="+window.lang,controller:"PrinterPreviewController"}).state("printer.preview_demo",{url:"/preview_demo/:model/:tab",templateUrl:"/views/printer/control/printer.preview_demo.php?lang="+window.lang,controller:"PrinterPreviewController"}).state("printerConfig",{url:"/printerConfig/:slug",templateUrl:"/views/printer/config/printerConfig.php?lang="+window.lang,resolve:{resA:["RSPrinterConfig","$stateParams","RSFirmware","$q",function(i,r,n,o){return o.all([i.selectPrinter(r.slug),n.promise])}]},onExit:["RSPrinterConfig","Confirm",function(i,r){i.hasConfigChanged()&&!i.hasErrors()&&r("Сохранить конфигурацию?","Ваша конфигурация изменилась и не сохранена. Следует сохранить изменения?").then(function(){i.save()},function(){})}],controller:"PrinterConfigController"}).state("printerConfig.webcam",{url:"/webcam",templateUrl:"/views/printer/config/printerConfig.webcam.php?lang="+window.lang,controller:"PrinterConfigAdvancedController"}).state("printerConfig.extruder",{url:"/extruder",templateUrl:"/views/printer/config/printerConfig.extruder.php?lang="+window.lang,controller:"PrinterConfigExtruderController"}).state("printerConfig.general",{url:"/general",templateUrl:"/views/printer/config/printerConfig.general.php?lang="+window.lang,controller:"PrinterConfigGeneralController"}).state("printerConfig.gcodes",{url:"/gcodes",templateUrl:"/views/printer/config/printerConfig.gcodes.php?lang="+window.lang,controller:"PrinterConfigGCodesController"}).state("printerConfig.rescue",{url:"/rescue",templateUrl:"/views/printer/config/printerConfig.rescue.php?lang="+window.lang,controller:"PrinterConfigRecoverController"}).state("printerConfig.shape",{url:"/shape",templateUrl:"/views/printer/config/printerConfig.shape.php?lang="+window.lang,controller:"PrinterConfigShapeController"}).state("configWizard",{url:"/configWizard",templateUrl:"/views/printer/config/configWizard.php?lang="+window.lang,controller:"ConfigWizardController"}).state("slicer",{url:"/slicer/:slug/:plateid",templateUrl:"/views/printer/slicer/editPlate.php?lang="+window.lang,controller:"EditPlateController",resolve:{P:["RSOverview",function(i){return i.printerListLoadedPromise}],resA:["RSPrinterConfig","$stateParams","RSFirmware","$q",function(i,r,n,o){return o.all([i.selectPrinter(r.slug),n.promise])}]}}),e.registerPrinterTab({name:"Печать",icon:"rs rs-print",visible:"true",state:"printer.print",prio:100,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Смена нити",icon:"rs rs-filamentchange",visible:"showFilamentchange",state:"printer.filamentchange",prio:250,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Управление",icon:"fa fa-arrows",visible:"true",state:"printer.control",prio:200,requireOnline:!0,requireActive:!0}),e.registerPrinterTab({name:"Консоль",icon:"fa fa-terminal",visible:"showConsole",state:"printer.console",prio:300,requireOnline:!1,requireActive:!0}),e.registerPrinterTab({name:"Веб-камера",icon:"rs rs-webcam",visible:"activeWebcam",state:"printer.camera",prio:400,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Записи",icon:"rs rs-timelapse",visible:"showTimelapseTab",state:"printer.timelapse",prio:500,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"EEPROM",icon:"rs rs-eeprom-settings",visible:"activeEEPROM",state:"printer.eeprom",prio:600,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Конфигурация клиппера",icon:"rs rs-klipper",visible:"activeKlipperConfig",state:"printer.klipperConfig",prio:600,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Настройка параметров принтера",icon:"fa fa-wrench",visible:"activePrinterSetup",state:"printer.setup",prio:600,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Восстановление печати",icon:"rs rs-print",visible:"activeRecover",state:"printer.rescue",prio:600,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Просмотр",icon:"fa fa-eye",visible:"gcodePreview",state:"printer.preview",prio:700,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Журналы",icon:"rs rs-log",visible:"logs",state:"printer.logs",prio:800,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"История",icon:"rs rs-history",visible:"history",state:"printer.history",prio:900,requireOnline:!1,requireActive:!1}),e.registerPrinterTab({name:"Внешняя ссылка",icon:"fa fa-external-link",visible:"externalLink",state:"printer.externalLink",prio:900,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"Основное",icon:"fa fa-list-ul",visible:"true",state:"printerConfig.general",prio:100,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"Инструменты",icon:"rs rs-extruder",visible:"true",state:"printerConfig.extruder",prio:200,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"Формы принтера",icon:"fa fa-square-o",visible:"true",state:"printerConfig.shape",prio:300,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"Веб-камера",icon:"rs rs-webcam",visible:"true",state:"printerConfig.webcam",prio:400,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"G-коды",icon:"rs rs-file-gcode",visible:"true",state:"printerConfig.gcodes",prio:500,requireOnline:!1,requireActive:!1}),e.registerPrinterConfigTab({name:"Восстановление печати",icon:"rs rs-print",visible:"true",state:"printerConfig.rescue",prio:600,requireOnline:!1,requireActive:!1}),e.setVisible("externalLink",!1)}]),RSPrinterModule.run(["$transitions","$rootScope",function(t,e){t.onBefore({},function(i){if(e.serverSettings&&e.serverSettings.policy_accepted===!1){let r=i.to().name;if(r!=="privacypolicy"&&r!=="login")return i.router.stateService.target("privacypolicy")}})}])})();var IB=function(){if(typeof Map!="undefined")return Map;function t(e,i){var r=-1;return e.some(function(n,o){return n[0]===i?(r=o,!0):!1}),r}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(i){var r=t(this.__entries__,i),n=this.__entries__[r];return n&&n[1]},e.prototype.set=function(i,r){var n=t(this.__entries__,i);~n?this.__entries__[n][1]=r:this.__entries__.push([i,r])},e.prototype.delete=function(i){var r=this.__entries__,n=t(r,i);~n&&r.splice(n,1)},e.prototype.has=function(i){return!!~t(this.__entries__,i)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(i,r){r===void 0&&(r=null);for(var n=0,o=this.__entries__;n<o.length;n++){var a=o[n];i.call(r,a[1],a[0])}},e}()}(),uS=typeof window!="undefined"&&typeof document!="undefined"&&window.document===document,R0=function(){return typeof global!="undefined"&&global.Math===Math?global:typeof self!="undefined"&&self.Math===Math?self:typeof window!="undefined"&&window.Math===Math?window:Function("return this")()}(),$X=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(R0):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)}}(),eY=2;function tY(t,e){var i=!1,r=!1,n=0;function o(){i&&(i=!1,t()),r&&l()}function a(){$X(o)}function l(){var h=Date.now();if(i){if(h-n<eY)return;r=!0}else i=!0,r=!1,setTimeout(a,e);n=h}return l}var iY=20,rY=["top","right","bottom","left","width","height","size","weight"],nY=typeof MutationObserver!="undefined",sY=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=tY(this.refresh.bind(this),iY)}return t.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},t.prototype.removeObserver=function(e){var i=this.observers_,r=i.indexOf(e);~r&&i.splice(r,1),!i.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},t.prototype.updateObservers_=function(){var e=this.observers_.filter(function(i){return i.gatherActive(),i.hasActive()});return e.forEach(function(i){return i.broadcastActive()}),e.length>0},t.prototype.connect_=function(){!uS||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),nY?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){!uS||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(e){var i=e.propertyName,r=i===void 0?"":i,n=rY.some(function(o){return!!~r.indexOf(o)});n&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),kB=function(t,e){for(var i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];Object.defineProperty(t,n,{value:e[n],enumerable:!1,writable:!1,configurable:!0})}return t},zu=function(t){var e=t&&t.ownerDocument&&t.ownerDocument.defaultView;return e||R0},FB=O0(0,0,0,0);function L0(t){return parseFloat(t)||0}function DB(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce(function(r,n){var o=t["border-"+n+"-width"];return r+L0(o)},0)}function oY(t){for(var e=["top","right","bottom","left"],i={},r=0,n=e;r<n.length;r++){var o=n[r],a=t["padding-"+o];i[o]=L0(a)}return i}function aY(t){var e=t.getBBox();return O0(0,0,e.width,e.height)}function lY(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return FB;var r=zu(t).getComputedStyle(t),n=oY(r),o=n.left+n.right,a=n.top+n.bottom,l=L0(r.width),h=L0(r.height);if(r.boxSizing==="border-box"&&(Math.round(l+o)!==e&&(l-=DB(r,"left","right")+o),Math.round(h+a)!==i&&(h-=DB(r,"top","bottom")+a)),!uY(t)){var u=Math.round(l+o)-e,c=Math.round(h+a)-i;Math.abs(u)!==1&&(l-=u),Math.abs(c)!==1&&(h-=c)}return O0(n.left,n.top,l,h)}var hY=function(){return typeof SVGGraphicsElement!="undefined"?function(t){return t instanceof zu(t).SVGGraphicsElement}:function(t){return t instanceof zu(t).SVGElement&&typeof t.getBBox=="function"}}();function uY(t){return t===zu(t).document.documentElement}function cY(t){return uS?hY(t)?aY(t):lY(t):FB}function fY(t){var e=t.x,i=t.y,r=t.width,n=t.height,o=typeof DOMRectReadOnly!="undefined"?DOMRectReadOnly:Object,a=Object.create(o.prototype);return kB(a,{x:e,y:i,width:r,height:n,top:i,right:e+r,bottom:n+i,left:e}),a}function O0(t,e,i,r){return{x:t,y:e,width:i,height:r}}var dY=function(){function t(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=O0(0,0,0,0),this.target=e}return t.prototype.isActive=function(){var e=cY(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},t}(),pY=function(){function t(e,i){var r=fY(i);kB(this,{target:e,contentRect:r})}return t}(),mY=function(){function t(e,i,r){if(this.activeObservations_=[],this.observations_=new IB,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=i,this.callbackCtx_=r}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(e instanceof zu(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(e)||(i.set(e,new dY(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(e instanceof zu(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(e)&&(i.delete(e),i.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(i){i.isActive()&&e.activeObservations_.push(i)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,i=this.activeObservations_.map(function(r){return new pY(r.target,r.broadcastRect())});this.callback_.call(e,i,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),BB=typeof WeakMap!="undefined"?new WeakMap:new IB,NB=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=sY.getInstance(),r=new mY(e,i,this);BB.set(this,r)}return t}();["observe","unobserve","disconnect"].forEach(function(t){NB.prototype[t]=function(){var e;return(e=BB.get(this))[t].apply(e,arguments)}});var gY=function(){return typeof R0.ResizeObserver!="undefined"?R0.ResizeObserver:NB}(),UB=gY;RSPrinterModule.component("websocketCamera",{template:'<img alt="webcam" style="{{$ctrl.myStyle}}" src="/img/empty.png">',controllerAs:"$ctrl",bindings:{imgUrl:"@",imgStyle:"@",imgClass:"@",rotate:"<",fullscreen:"<",maxHeight:"<",forceMjpg:"<",maxRefresh:"<"},controller:["RSCom","$rootScope","User","$element","$scope","$q",function(t,e,i,r,n,o){let a=this,l=null,h=!1,u=!1,c=100,f=null,d=null,m=null;n.frames=0;let v=null,g=null,p=0,_=null,x=!1,b=()=>{n.frames=p,p=0};a.myStyle="",a.myStyleMargin="",a.myStyleTrans="",a.myStyleMaxHeight="",a.myStyleExtra="";let y=-1,w=!1,S=!0,R,E;typeof document.hidden!="undefined"?(R="hidden",E="visibilitychange"):typeof document.msHidden!="undefined"?(R="msHidden",E="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(R="webkitHidden",E="webkitvisibilitychange");function T(){if(!_)return;let I=_.offsetWidth,k=_.offsetHeight,B="0px",F="0px",W=I,V=k,N=1,ne=0,ie;switch(a.rotate){case 0:case 180:W=I,V=k,ie="height:100vh; max-height:100vh;";break;case 90:case 270:W=k,V=I,a.maxHeight&&a.maxHeight<V&&(N=a.maxHeight/V,ne=(-(V-a.maxHeight)/2).toFixed(0)+"px"),B=Math.max(0,Math.round((I-k)/2)).toFixed(0)+"px",ie="width:100vh; max-width:100vh;";break}if(W>0&&V>0){let Q="translateY("+ne+") scale("+N+") rotate("+a.rotate+"deg)";a.myStyleTrans=`-webkit-transform:${Q};-ms-transform:${Q};transform:${Q};`,a.myStyleMargin=`margin:${B} ${F}; object-fit:contain;`}a.myStyle=a.myStyleMargin+a.myStyleTrans+a.myStyleMaxHeight,a.myStyle+=a.fullscreen?ie:a.myStyleExtra}function A(){f&&(URL.revokeObjectURL(f),f=null),d&&(URL.revokeObjectURL(d),d=null)}function C(){if(l)return;m&&clearInterval(m),x=!0,h=!1,u=!1,l=new WebSocket(w);let I=l;l.onopen=function(){if(l===null){I.close();return}h=!0,l.send("next"),a.maxRefresh||l.send("next")},l.onerror=function(k){},l.onclose=function(){if(h=!1,A(),u!==!1){u.resolve();return}l=null,c*=2,c>5e3&&(c=5e3),setTimeout(C,c)},l.onmessage=function(k){c=100,f===null?(f=(window.URL||window.webkitURL).createObjectURL(k.data),_.src=f):d===null&&(d=(window.URL||window.webkitURL).createObjectURL(k.data)),p++}}function M(){if(m&&clearInterval(m),l==null){let I=o.defer();return I.resolve(),I.promise}return u=o.defer(),x=!1,h&&l.close(),l=null,u.promise}let D=[];function O(I){I&&(D.length>1?D=[D[0],I]:D.push(I));function k(B){A(),w=B,B.startsWith("/printer/cammjpg/")?a.forceMjpg||!1?(y=2,_.src=w,x=!0,u=!1):(y=1,w=(t.isSecure()?"wss://":"ws://")+window.location.host+"/socket/mjpg/"+B.substr(17),C()):(u=!1,y=0,_.src=w,x=!0),D.length&&O(!1)}D.length!==0&&(I=D.shift(),I!==w&&(y===1?M().then(()=>{k(I)}):k(I)))}this.$onChanges=function(I){I.imgUrl&&y!==-1&&O(this.imgUrl),I.imgStyle&&y!==-1&&(a.myStyleExtra=this.imgStyle,T()),I.imgClass&&y!==-1&&(_.className=this.imgClass||""),I.maxHeight&&(a.myStyleMaxHeight=this.maxHeight?`max-height:${this.maxHeight}px;`:"",T()),I.rotate&&T(),I.fullscreen&&T()};function P(){y===1&&h&&(f&&(URL.revokeObjectURL(this.src),f=null),d?(f=d,d=null,this.src=f):l&&(a.maxRefresh?setTimeout(()=>{l&&l.send("next")},a.maxRefresh):l.send("next")))}function L(){let I=S&&!document[R];y<1||x===I||(x=I,x?y===2?_.src=w:y===1&&(u===!1?C():u.promise.then(()=>{C()})):y===2?_.src="/img/nowebcam.png":y===1&&u===!1&&M())}this.$postLink=()=>{_=$("img",r)[0],_.onload=P,a.myStyleExtra=_.style=this.imgStyle||"",_.className=this.imgClass||"",O(this.imgUrl),v=new IntersectionObserver(I=>{S=I[0].isIntersecting,L(),!(y<1||x===I[0].isIntersecting)&&(x=I[0].isIntersecting,x?y===2?_.src=w:y===1&&C():y===2?_.src="/img/nowebcam.png":y===1&&M())},{}),v.observe(_),g=new UB(I=>{T()}),g.observe(_),document.addEventListener(E,L,!1),T()},this.$onDestroy=function(){v&&v.disconnect(),g&&g.disconnect(),document.removeEventListener(E,L,!1),M(),A(),_.src="/img/empty.png"}}]});var WB=Qi(GB()),VB=Qi(zB()),jB=Qi(HB());RSPrinterModule.component("rsTerminal",{template:`<div style="width:100%; height:100%; position:absolute; padding:10px; background:#000000; opacity: 0.8">
<div style="width:100%; height:100%; overflow-x: hidden; box-sizing: border-box;" class="rs-terminal"></div>
<div ng-if="$ctrl.closed" style="position: absolute; left:0; right:0; top:0" class="text-white bg-info">Клемма закрыта</div>
</div>`,bindings:{callback:"<",channel:"<",readonly:"<"},controller:["$rootScope","Fullscreen","$element","$interval","RSCom","$scope","$timeout","Confirm",function(t,e,i,r,n,o,a,l){let h={cursorStyle:"bar",cursorBlink:!0,disableStdin:this.readonly===!0},u=new TextDecoder,c="",f=new WB.Terminal(h),d=new VB.FitAddon,m=new jB.WebLinksAddon,v=80,g=24;f.loadAddon(d),f.loadAddon(m),this.closed=!1,this.paused=!1;let p=()=>{this.paused||(this.paused=!0,this.channel&&n.send("terminal",{id:this.channel,a:"pause",data:""}))},_=D=>{this.channel&&!this.closed&&(D.id=this.channel,n.send("terminal",D))},x=()=>{this.paused&&(this.paused=!1,_({a:"resume",data:""}))},b=1e5,y=1e4,w=0;f.open($(".rs-terminal",i)[0]),f.onData(D=>{_({a:"send",data:D})});let S=new RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))","g"),R=new RegExp(`[\r
]`,"g"),E=t.$on("terminal",(D,O)=>{if(O.data.id!==this.channel)return;let P=O.data.a;if(P==="recv"){let I=window.atob(O.data.data.replace(R,"")),k=I.length,B=new Uint8Array(k);for(let F=0;F<k;F++)B[F]=I.charCodeAt(F);if(this.callback&&this.callback.onLine)for(c+=u.decode(B);c.length>0;){let F=c.indexOf(`
`);if(F<0)break;var L=c.substring(0,F).trim().replace(S,"");this.callback.onLine(L),c=c.substring(F+1)}w+=k,f.write(B,()=>{w=Math.max(w-k,0),w<y&&x()}),w>b&&p()}else P==="close"&&(this.callback&&this.callback.onClose&&this.callback.onClose(),this.closed=!0)}),T=()=>{a(()=>{try{let D=d.proposeDimensions();D&&D.cols&&D.rows&&(D.cols!==v||D.rows!==g)&&(v=D.cols,g=D.rows,_({a:"resize",rows:D.rows,cols:D.cols})),f._core._renderService.clear(),f.resize(D.cols,D.rows),f.scrollToBottom()}catch(D){console.error(D)}},0)},A=()=>{if(this.closed){r.cancel(C),C=!1;return}_({a:"ping",data:""})},C=r(A,5e3);this.$onChanges=function(D){D.channel&&(this.closed=!1,this.paused=!1,_({a:"resize",rows:g,cols:v}),C||(this.pingInterval=r(A,5e3)))};let M=D=>{console.log("canLeaveWindow",this.closed),!this.closed&&_({a:"close",data:""})};window.addEventListener("beforeunload",M),T(),o.$on("windowResized",T),this.readonly!==!0&&f.focus(),this.$onDestroy=()=>{console.log("destroy terminal",this.channel),window.removeEventListener("beforeunload",M),_({a:"close",data:""}),C&&r.cancel(C),d.dispose(),f.dispose(),E()}}]});RSPrinterModule.directive("filamentchange",["$timeout",function(t){return{restrict:"E",templateUrl:"/views/printer/control/filamentchange.php?lang="+window.lang,replace:!0,controller:["$scope","$rootScope","RSCom","RSPrinter",function(e,i,r,n){e.page=0,e.remove=!1,e.t={targetExtruder:-1,fastDistance:0,slowDistance:0,targetTemperature:0},e.startTemperature=0,e.showStart=!1,e.waitForTargetTemp=!1,e.status="",e.filamentWasInserted=!1,e.exlist=[],e.title="Смена нити";let o=!1;e.$on("$destroy",function(){o=!0,e.page===1&&n.setExtruderTemperature(e.targetExtruder,e.startTemperature)});let a=function(){o||(e.t.targetExtruder===-1&&i.active.state.activeExtruder!==void 0&&i.activeConfig.extruders&&i.activeConfig.extruders.length>0&&(e.t.targetExtruder=i.active.state.activeExtruder,e.t.fastDistance=i.activeConfig.extruders[e.t.targetExtruder].changeFastDistance,e.t.slowDistance=i.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance,e.t.targetTemperature=i.activeConfig.extruders[e.t.targetExtruder].lastTemp,e.exlist=[],angular.forEach(i.activeConfig.extruders,function(c,f){e.exlist.push({id:f,name:n.extruderName(f)})})),e.waitForTargetTemp&&(e.active.state.extruder[e.t.targetExtruder].tempRead>=e.t.targetTemperature-.7?l():e.status="Нагрев..."+i.active.state.extruder[e.t.targetExtruder].tempRead.toFixed(1)+"/"+e.t.targetTemperature+"\xB0C"),o||t(a,500))};a(),e.$watch("active.state.activeExtruder",function(c,f){c!==e.t.targetExtruder&&(e.t.targetExtruder=c,e.t.fastDistance=i.activeConfig.extruders[e.t.targetExtruder].changeFastDistance,e.t.slowDistance=i.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance,e.t.targetTemperature=i.activeConfig.extruders[e.t.targetExtruder].lastTemp)}),e.setExtruder=function(c){n.selectExtruder(c),i.active.state.activeExtruder=c,e.t.fastDistance=i.activeConfig.extruders[e.t.targetExtruder].changeFastDistance,e.t.slowDistance=i.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance,e.t.targetTemperature=i.activeConfig.extruders[e.t.targetExtruder].lastTemp},e.setTargetTemp=function(){},e.setFastDistance=function(){},e.setSlowDistance=function(){};let l=function(){e.waitForTargetTemp=!1;let c=0;e.remove?(n.runScript("remove_filament"),c=(e.slowDistance+e.fastDistance)/i.activeConfig.extruders[e.t.targetExtruder].retractSpeed,e.status="Откат нити...",n.eMoveRel(-(e.t.fastDistance+e.t.slowDistance),e.activeConfig.extruders[e.t.targetExtruder].retractSpeed),t(function(){e.status="Используйте подачу или втягивание если необходимо."},c*1e3)):(e.status="Вставьте нить в экструдер и нажмите Старт для втягивания нити.",e.showStart=!0)};e.startPressed=function(){e.showStart=!1,n.runScript("insert_filament");let c=e.t.slowDistance/e.activeConfig.extruders[e.t.targetExtruder].extrudeSpeed+e.t.fastDistance/e.activeConfig.extruders[e.t.targetExtruder].retractSpeed;e.status="Втягивание нити...",n.eMoveRel(e.t.fastDistance,e.activeConfig.extruders[e.t.targetExtruder].retractSpeed),n.eMoveRel(e.t.slowDistance,e.activeConfig.extruders[e.t.targetExtruder].extrudeSpeed),t(function(){e.status="Используйте подачу или втягивание если необходимо."},c*1e3)};let h=function(){(e.t.fastDistance!==e.activeConfig.extruders[e.t.targetExtruder].changeFastDistance||e.t.slowDistance!==e.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance)&&(e.activeConfig.extruders[e.t.targetExtruder].changeFastDistance=e.t.fastDistance,e.activeConfig.extruders[e.t.targetExtruder].changeSlowDistance=e.t.slowDistance,r.send("setPrinterConfig",e.activeConfig))},u=function(){e.activeConfig.extruders[e.t.targetExtruder].supportTemperature?(e.startTemperature=e.active.state.extruder[e.t.targetExtruder].tempSet,n.setExtruderTemperature(e.t.targetExtruder,e.t.targetTemperature),e.waitForTargetTemp=!0,n.setExtruderTemperature(e.t.targetExtruder,e.t.targetTemperature),e.status="Нагрев..."+i.active.state.extruder[e.t.targetExtruder].tempRead.toFixed(1)+"/"+e.t.targetTemperature+"\xB0C"):l()};e.removeFilament=function(){e.remove=!0,e.title="Убрать нить",e.page=1,e.showStart=!1,e.filamentWasInserted=!1,h(),u()},e.insertFilament=function(){e.remove=!1,e.title="Вставить нить",e.page=1,e.showStart=!1,e.filamentWasInserted=!0,h(),u()},e.cancel=function(){e.page===1&&(e.filamentWasInserted&&n.runScript("insert_filament_finished"),n.setExtruderTemperature(e.targetExtruder,e.startTemperature)),e.page=0},e.insertMore=function(c){n.eMoveRel(c,e.activeConfig.extruders[e.t.targetExtruder].extrudeSpeed)},e.removeMore=function(c){n.eMoveRel(-c,e.activeConfig.extruders[e.t.targetExtruder].retractSpeed)}}]}}]);RSPrinterModule.controller("HomeController",["$scope","$rootScope","RSPrinters","RSOverview","RSCom","$state","IPS","User","Theme","localStorageService","RSPrinter","PrinterConditionDialog","Flash",function(t,e,i,r,n,o,a,l,h,u,c,f,d){e.setOverride("hideLeft",!0),e.titlePrepend="",t.showCam=!1,t.menuTheme=!1,t.menuAddPrinter=!1,t.menuOrder=!1,t.menuEmergency={},t.theme=h,r.selectPrinter(""),t.ips=a,window.scrollTo(0,0),t.disk={},t.update={},t.menuContext={},t.closeContext=function(v){t.menuContext[v]=!1},t.printerOrder=l.getSetting("printerOrder","dynamic"),t.setPrinterOrder=function(v){t.menuOrder=!1,l.setSetting("printerOrder",v),t.printerOrder=v,r.updatePrintersNew()},t.showMaxActiveInfo=()=>{d.error("Активный предел принтера","Твоя активная лицензия позволяет использовать только до @ активных принтеров. Пожалуйста, активируй соответствующую лицензию для запланированного количества принтеров.".replace("@",""+t.licence.maxActivePrinter),2e4,!0)},t.showPrinterCondition=function(v){f(v)};let m=function(){n.send("freeSpace",{}).then(function(v){t.disk=v,t.disk.usage=100-100*(v.available/v.capacity),v.capacity<1e3*1024*1024?t.disk.class="progress-bar-warning":v.capacity<500*1024*1024?t.disk.class="progress-bar-danger":t.disk.class="progress-bar-success"}),n.send("getLicenceData",{}).then(function(v){t.licence=v}),n.updateImportant()};t.$on("connected",m),t.ignoreVersion=function(){n.send("ignoreUpdate",{}),m()},t.$on("$destroy",()=>{e.setOverride("hideLeft",!1)}),t.showPrinter=function(v){let g=c.getActivePage(v,{state:"printer.print",params:{slug:v}});o.get(g.state)?o.go(g.state,g.params):o.go("printer.print",g.params)},t.canShowCam=function(v){return t.showCam&&e.printerConfig&&e.printerConfig[v]&&typeof e.printerConfig[v].webcams=="object"&&e.printerConfig[v].webcams.length>0&&(t.printerConfig[v].webcams[0].method&3)!==0},t.setTheme=function(v){l.setSetting("theme",v),h.setMode(v)},t.closeTheme=function(){t.menuTheme=!1},t.closeAddPrinter=function(){t.menuAddPrinter=!1},t.closeOrder=function(){t.menuOrder=!1},t.closeEmergency=function(v){t.menuEmergency[v]=!1},m(),t.storeCam=function(){u.set("v1HomeShowCam",t.showCam)},e.printerListActive.length<=30&&u.get("v1HomeShowCam")!==null&&(t.showCam=u.get("v1HomeShowCam"))}]);RSPrinterModule.controller("StartController",["$scope","$rootScope","RSPrinters","RSOverview","RSCom","$state",function(t,e,i,r,n,o){r.printerListLoadedPromise.then(function(){let a=0,l;angular.forEach(e.printerList,function(h){h.active&&(a++,a===1&&(l=h))}),a===1?o.go("printer.print",{slug:l.slug}):o.go("home")},function(){})}]);RSPrinterModule.controller("TroubleshootingController",["$scope","$rootScope","RSPrinters","RSOverview","RSCom","$state","$interval",function(t,e,i,r,n,o,a){t.wd={};function l(f,d=!1){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){(f.scrollTop>=f.scrollHeight-350||!d)&&(f.scrollTop=f.scrollHeight)})})}function h(){let f=document.getElementById("logpanel");f||setTimeout(h,50),n.send("getLastErrors",{}).then(d=>{if(f){let m="";d.data.forEach(v=>{m+='<div class="logError">'+v.toString()+"</div>"}),f.innerHTML=m,l(f)}})}h(),t.$on("addErrorLogLine",function(){let f=document.getElementById("logpanel");if(f){let d=document.createElement("div");d.className="logError",n.send("getLastErrors",{}).then(m=>{d.append(m.data[m.data.length-1]),f.append(d)}),f.childElementCount>200&&f.removeChild(f.firstChild),l(f,!0)}});let u=function(){n.send("WDispatcherStatus",{}).then(function(f){t.wd=f})},c=a(u,1e3);t.$on("$destroy",function(){a.cancel(c)}),t.stopExt=function(){n.send("WDispatcherStopExt",{})},t.stopInt=function(){n.send("WDispatcherStopInt",{})},u()}]);function vY(t){var e=this.constructor;return this.then(function(i){return e.resolve(t()).then(function(){return i})},function(i){return e.resolve(t()).then(function(){return e.reject(i)})})}var qB=vY;function _Y(t){var e=this;return new e(function(i,r){if(!(t&&typeof t.length!="undefined"))return r(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var n=Array.prototype.slice.call(t);if(n.length===0)return i([]);var o=n.length;function a(h,u){if(u&&(typeof u=="object"||typeof u=="function")){var c=u.then;if(typeof c=="function"){c.call(u,function(f){a(h,f)},function(f){n[h]={status:"rejected",reason:f},--o===0&&i(n)});return}}n[h]={status:"fulfilled",value:u},--o===0&&i(n)}for(var l=0;l<n.length;l++)a(l,n[l])})}var XB=_Y;var yY=setTimeout;function YB(t){return Boolean(t&&typeof t.length!="undefined")}function xY(){}function bY(t,e){return function(){t.apply(e,arguments)}}function Ai(t){if(!(this instanceof Ai))throw new TypeError("Promises must be constructed via new");if(typeof t!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],KB(t,this)}function ZB(t,e){for(;t._state===3;)t=t._value;if(t._state===0){t._deferreds.push(e);return}t._handled=!0,Ai._immediateFn(function(){var i=t._state===1?e.onFulfilled:e.onRejected;if(i===null){(t._state===1?pS:Zf)(e.promise,t._value);return}var r;try{r=i(t._value)}catch(n){Zf(e.promise,n);return}pS(e.promise,r)})}function pS(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&(typeof e=="object"||typeof e=="function")){var i=e.then;if(e instanceof Ai){t._state=3,t._value=e,mS(t);return}else if(typeof i=="function"){KB(bY(i,e),t);return}}t._state=1,t._value=e,mS(t)}catch(r){Zf(t,r)}}function Zf(t,e){t._state=2,t._value=e,mS(t)}function mS(t){t._state===2&&t._deferreds.length===0&&Ai._immediateFn(function(){t._handled||Ai._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)ZB(t,t._deferreds[e]);t._deferreds=null}function wY(t,e,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.promise=i}function KB(t,e){var i=!1;try{t(function(r){i||(i=!0,pS(e,r))},function(r){i||(i=!0,Zf(e,r))})}catch(r){if(i)return;i=!0,Zf(e,r)}}Ai.prototype.catch=function(t){return this.then(null,t)};Ai.prototype.then=function(t,e){var i=new this.constructor(xY);return ZB(this,new wY(t,e,i)),i};Ai.prototype.finally=qB;Ai.all=function(t){return new Ai(function(e,i){if(!YB(t))return i(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(t);if(r.length===0)return e([]);var n=r.length;function o(l,h){try{if(h&&(typeof h=="object"||typeof h=="function")){var u=h.then;if(typeof u=="function"){u.call(h,function(c){o(l,c)},i);return}}r[l]=h,--n===0&&e(r)}catch(c){i(c)}}for(var a=0;a<r.length;a++)o(a,r[a])})};Ai.allSettled=XB;Ai.resolve=function(t){return t&&typeof t=="object"&&t.constructor===Ai?t:new Ai(function(e){e(t)})};Ai.reject=function(t){return new Ai(function(e,i){i(t)})};Ai.race=function(t){return new Ai(function(e,i){if(!YB(t))return i(new TypeError("Promise.race accepts an array"));for(var r=0,n=t.length;r<n;r++)Ai.resolve(t[r]).then(e,i)})};Ai._immediateFn=typeof setImmediate=="function"&&function(t){setImmediate(t)}||function(t){yY(t,0)};Ai._unhandledRejectionFn=function(e){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var QB=Ai;var r5=Qi(e5(),1);typeof globalThis=="undefined"&&(typeof self!="undefined"?self.globalThis=self:typeof global!="undefined"&&(global.globalThis=global));globalThis.Promise||(globalThis.Promise=QB);Object.assign||(Object.assign=r5.default);var TY=16;Date.now&&Date.prototype.getTime||(Date.now=function(){return new Date().getTime()});globalThis.performance&&globalThis.performance.now||(t5=Date.now(),globalThis.performance||(globalThis.performance={}),globalThis.performance.now=function(){return Date.now()-t5});var t5,gS=Date.now(),i5=["ms","moz","webkit","o"];for(F0=0;F0<i5.length&&!globalThis.requestAnimationFrame;++F0)B0=i5[F0],globalThis.requestAnimationFrame=globalThis[B0+"RequestAnimationFrame"],globalThis.cancelAnimationFrame=globalThis[B0+"CancelAnimationFrame"]||globalThis[B0+"CancelRequestAnimationFrame"];var B0,F0;globalThis.requestAnimationFrame||(globalThis.requestAnimationFrame=function(t){if(typeof t!="function")throw new TypeError(t+"is not a function");var e=Date.now(),i=TY+gS-e;return i<0&&(i=0),gS=e,globalThis.self.setTimeout(function(){gS=Date.now(),t(performance.now())},i)});globalThis.cancelAnimationFrame||(globalThis.cancelAnimationFrame=function(t){return clearTimeout(t)});Math.sign||(Math.sign=function(e){return e=Number(e),e===0||isNaN(e)?e:e>0?1:-1});Number.isInteger||(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e});globalThis.ArrayBuffer||(globalThis.ArrayBuffer=Array);globalThis.Float32Array||(globalThis.Float32Array=Array);globalThis.Uint32Array||(globalThis.Uint32Array=Array);globalThis.Uint16Array||(globalThis.Uint16Array=Array);globalThis.Uint8Array||(globalThis.Uint8Array=Array);globalThis.Int32Array||(globalThis.Int32Array=Array);var il={};yy(il,{BaseTextureCache:()=>Bn,CanvasRenderTarget:()=>Z0,DATA_URI:()=>U5,EventEmitter:()=>Mo.default,ProgramCache:()=>Y0,TextureCache:()=>rn,clearTextureCache:()=>oJ,correctBlendMode:()=>ad,createIndicesForQuads:()=>OS,decomposeDataUri:()=>aJ,deprecation:()=>Yi,destroyTextureCache:()=>sJ,determineCrossOrigin:()=>IS,earcut:()=>ud.default,getBufferType:()=>hd,getResolutionOfUrl:()=>tl,hex2rgb:()=>ds,hex2string:()=>sd,interleaveTypedArrays:()=>rJ,isMobile:()=>yn,isPow2:()=>q0,isWebGLSupported:()=>RS,log2:()=>X0,nextPow2:()=>Qu,path:()=>N5,premultiplyBlendMode:()=>j0,premultiplyRgba:()=>LS,premultiplyTint:()=>ih,premultiplyTintToRgba:()=>ld,removeItems:()=>Us,rgb2hex:()=>eJ,sayHello:()=>PS,sign:()=>oa,skipHello:()=>fZ,string2hex:()=>od,trimCanvas:()=>DS,uid:()=>Co,url:()=>sa});var wo;(function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"})(wo||(wo={}));var Hu;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"})(Hu||(Hu={}));var Kf;(function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"})(Kf||(Kf={}));var at;(function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"})(at||(at={}));var vn;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(vn||(vn={}));var Oe;(function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(Oe||(Oe={}));var el;(function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(el||(el={}));var ht;(function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"})(ht||(ht={}));var Qf;(function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"})(Qf||(Qf={}));var cs;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"})(cs||(cs={}));var Jr;(function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(Jr||(Jr={}));var $r;(function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"})($r||($r={}));var _n;(function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(_n||(_n={}));var Fn;(function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"})(Fn||(Fn={}));var Wu;(function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"})(Wu||(Wu={}));var en;(function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"})(en||(en={}));var Pi;(function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR"})(Pi||(Pi={}));var n5;(function(t){t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=4]="BLUE",t[t.ALPHA=8]="ALPHA"})(n5||(n5={}));var ai;(function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"})(ai||(ai={}));var Bs;(function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(Bs||(Bs={}));var AY={createCanvas:function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var t;return(t=document.baseURI)!==null&&t!==void 0?t:window.location.href},fetch:function(t,e){return fetch(t,e)}},vS=/iPhone/i,s5=/iPod/i,o5=/iPad/i,a5=/\biOS-universal(?:.+)Mac\b/i,_S=/\bAndroid(?:.+)Mobile\b/i,l5=/Android/i,Vu=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,N0=/Silk/i,na=/Windows Phone/i,h5=/\bWindows(?:.+)ARM\b/i,u5=/BlackBerry/i,c5=/BB10/i,f5=/Opera Mini/i,d5=/\b(CriOS|Chrome)(?:.+)Mobile/i,p5=/Mobile(?:.+)Firefox\b/i,m5=function(t){return typeof t!="undefined"&&t.platform==="MacIntel"&&typeof t.maxTouchPoints=="number"&&t.maxTouchPoints>1&&typeof MSStream=="undefined"};function PY(t){return function(e){return e.test(t)}}function RY(t){var e={userAgent:"",platform:"",maxTouchPoints:0};!t&&typeof navigator!="undefined"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof t=="string"?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0});var i=e.userAgent,r=i.split("[FBAN");typeof r[1]!="undefined"&&(i=r[0]),r=i.split("Twitter"),typeof r[1]!="undefined"&&(i=r[0]);var n=PY(i),o={apple:{phone:n(vS)&&!n(na),ipod:n(s5),tablet:!n(vS)&&(n(o5)||m5(e))&&!n(na),universal:n(a5),device:(n(vS)||n(s5)||n(o5)||n(a5)||m5(e))&&!n(na)},amazon:{phone:n(Vu),tablet:!n(Vu)&&n(N0),device:n(Vu)||n(N0)},android:{phone:!n(na)&&n(Vu)||!n(na)&&n(_S),tablet:!n(na)&&!n(Vu)&&!n(_S)&&(n(N0)||n(l5)),device:!n(na)&&(n(Vu)||n(N0)||n(_S)||n(l5))||n(/\bokhttp\b/i)},windows:{phone:n(na),tablet:n(h5),device:n(na)||n(h5)},other:{blackberry:n(u5),blackberry10:n(c5),opera:n(f5),firefox:n(p5),chrome:n(d5),device:n(u5)||n(c5)||n(f5)||n(p5)||n(d5)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}var yn=RY(globalThis.navigator);function LY(){return!yn.apple.device}function OY(t){var e=!0;if(yn.tablet||yn.phone){if(yn.apple.device){var i=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(i){var r=parseInt(i[1],10);r<11&&(e=!1)}}if(yn.android.device){var i=navigator.userAgent.match(/Android\s([0-9.]*)/);if(i){var r=parseInt(i[1],10);r<7&&(e=!1)}}}return e?t:4}var Fe={ADAPTER:AY,MIPMAP_TEXTURES:$r.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:ai.NONE,SPRITE_MAX_TEXTURES:OY(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:Wu.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:Jr.CLAMP,SCALE_MODE:cs.LINEAR,PRECISION_VERTEX:en.HIGH,PRECISION_FRAGMENT:yn.apple.device?en.HIGH:en.MEDIUM,CAN_UPLOAD_SAME_BUFFER:LY(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Mo=Qi(v5(),1),ud=Qi(w5(),1),Ku=Qi(I5(),1);var sa={parse:Ku.parse,format:Ku.format,resolve:Ku.resolve};function Ns(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function k5(t){var e=t.split("?")[0];return e.split("#")[0]}function hZ(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function uZ(t,e,i){return t.replace(new RegExp(hZ(e),"g"),i)}function cZ(t,e){for(var i="",r=0,n=-1,o=0,a,l=0;l<=t.length;++l){if(l<t.length)a=t.charCodeAt(l);else{if(a===47)break;a=47}if(a===47){if(!(n===l-1||o===1))if(n!==l-1&&o===2){if(i.length<2||r!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){var h=i.lastIndexOf("/");if(h!==i.length-1){h===-1?(i="",r=0):(i=i.slice(0,h),r=i.length-1-i.lastIndexOf("/")),n=l,o=0;continue}}else if(i.length===2||i.length===1){i="",r=0,n=l,o=0;continue}}e&&(i.length>0?i+="/..":i="..",r=2)}else i.length>0?i+="/"+t.slice(n+1,l):i=t.slice(n+1,l),r=l-n-1;n=l,o=0}else a===46&&o!==-1?++o:o=-1}return i}var N5={toPosix:function(t){return uZ(t,"\\","/")},isUrl:function(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:function(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},hasProtocol:function(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol:function(t){Ns(t),t=this.toPosix(t);var e="",i=/^file:\/\/\//.exec(t),r=/^[^/:]+:\/\//.exec(t),n=/^[^/:]+:\//.exec(t);if(i||r||n){var o=(i==null?void 0:i[0])||(r==null?void 0:r[0])||(n==null?void 0:n[0]);e=o,t=t.slice(o.length)}return e},toAbsolute:function(t,e,i){if(this.isDataUrl(t))return t;var r=k5(this.toPosix(e!=null?e:Fe.ADAPTER.getBaseUrl())),n=k5(this.toPosix(i!=null?i:this.rootname(r)));if(Ns(t),t=this.toPosix(t),t.startsWith("/"))return N5.join(n,t.slice(1));var o=this.isAbsolute(t)?t:this.join(r,t);return o},normalize:function(t){if(t=this.toPosix(t),Ns(t),t.length===0)return".";var e="",i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));var r=t.endsWith("/");return t=cZ(t,!1),t.length>0&&r&&(t+="/"),i?"/"+t:e+t},isAbsolute:function(t){return Ns(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join:function(){for(var t=arguments,e,i=[],r=0;r<arguments.length;r++)i[r]=t[r];if(i.length===0)return".";for(var n,o=0;o<i.length;++o){var a=i[o];if(Ns(a),a.length>0)if(n===void 0)n=a;else{var l=(e=i[o-1])!==null&&e!==void 0?e:"";this.extname(l)?n+="/../"+a:n+="/"+a}}return n===void 0?".":this.normalize(n)},dirname:function(t){if(Ns(t),t.length===0)return".";t=this.toPosix(t);var e=t.charCodeAt(0),i=e===47,r=-1,n=!0,o=this.getProtocol(t),a=t;t=t.slice(o.length);for(var l=t.length-1;l>=1;--l)if(e=t.charCodeAt(l),e===47){if(!n){r=l;break}}else n=!1;return r===-1?i?"/":this.isUrl(a)?o+t:o:i&&r===1?"//":o+t.slice(0,r)},rootname:function(t){Ns(t),t=this.toPosix(t);var e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){var i=t.indexOf("/",e.length);i!==-1?e=t.slice(0,i):e=t,e.endsWith("/")||(e+="/")}return e},basename:function(t,e){Ns(t),e&&Ns(e),t=this.toPosix(t);var i=0,r=-1,n=!0,o;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var a=e.length-1,l=-1;for(o=t.length-1;o>=0;--o){var h=t.charCodeAt(o);if(h===47){if(!n){i=o+1;break}}else l===-1&&(n=!1,l=o+1),a>=0&&(h===e.charCodeAt(a)?--a===-1&&(r=o):(a=-1,r=l))}return i===r?r=l:r===-1&&(r=t.length),t.slice(i,r)}for(o=t.length-1;o>=0;--o)if(t.charCodeAt(o)===47){if(!n){i=o+1;break}}else r===-1&&(n=!1,r=o+1);return r===-1?"":t.slice(i,r)},extname:function(t){Ns(t),t=this.toPosix(t);for(var e=-1,i=0,r=-1,n=!0,o=0,a=t.length-1;a>=0;--a){var l=t.charCodeAt(a);if(l===47){if(!n){i=a+1;break}continue}r===-1&&(n=!1,r=a+1),l===46?e===-1?e=a:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||r===-1||o===0||o===1&&e===r-1&&e===i+1?"":t.slice(e,r)},parse:function(t){Ns(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=this.toPosix(t);var i=t.charCodeAt(0),r=this.isAbsolute(t),n;e.root=this.rootname(t),r||this.hasProtocol(t)?n=1:n=0;for(var o=-1,a=0,l=-1,h=!0,u=t.length-1,c=0;u>=n;--u){if(i=t.charCodeAt(u),i===47){if(!h){a=u+1;break}continue}l===-1&&(h=!1,l=u+1),i===46?o===-1?o=u:c!==1&&(c=1):o!==-1&&(c=-1)}return o===-1||l===-1||c===0||c===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&r?e.base=e.name=t.slice(1,l):e.base=e.name=t.slice(a,l)):(a===0&&r?(e.name=t.slice(1,o),e.base=t.slice(1,l)):(e.name=t.slice(a,o),e.base=t.slice(a,l)),e.ext=t.slice(o,l)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"};Fe.RETINA_PREFIX=/@([0-9\.]+)x/;Fe.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var AS=!1,F5="6.5.8";function fZ(){AS=!0}function PS(t){var e;if(!AS){if(Fe.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){var i=[`
 %c %c %c PixiJS `+F5+" - \u2730 "+t+` \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=globalThis.console).log.apply(e,i)}else globalThis.console&&globalThis.console.log("PixiJS "+F5+" - "+t+" - http://www.pixijs.com/");AS=!0}}var TS;function RS(){return typeof TS=="undefined"&&(TS=function(){var e={stencil:!0,failIfMajorPerformanceCaveat:Fe.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Fe.ADAPTER.getWebGLRenderingContext())return!1;var i=Fe.ADAPTER.createCanvas(),r=i.getContext("webgl",e)||i.getContext("experimental-webgl",e),n=!!(r&&r.getContextAttributes().stencil);if(r){var o=r.getExtension("WEBGL_lose_context");o&&o.loseContext()}return r=null,n}catch(a){return!1}}()),TS}var dZ="#f0f8ff",pZ="#faebd7",mZ="#00ffff",gZ="#7fffd4",vZ="#f0ffff",_Z="#f5f5dc",yZ="#ffe4c4",xZ="#000000",bZ="#ffebcd",wZ="#0000ff",SZ="#8a2be2",CZ="#a52a2a",MZ="#deb887",EZ="#5f9ea0",TZ="#7fff00",AZ="#d2691e",PZ="#ff7f50",RZ="#6495ed",LZ="#fff8dc",OZ="#dc143c",DZ="#00ffff",IZ="#00008b",kZ="#008b8b",FZ="#b8860b",BZ="#a9a9a9",NZ="#006400",UZ="#a9a9a9",GZ="#bdb76b",zZ="#8b008b",HZ="#556b2f",WZ="#ff8c00",VZ="#9932cc",jZ="#8b0000",qZ="#e9967a",XZ="#8fbc8f",YZ="#483d8b",ZZ="#2f4f4f",KZ="#2f4f4f",QZ="#00ced1",JZ="#9400d3",$Z="#ff1493",eK="#00bfff",tK="#696969",iK="#696969",rK="#1e90ff",nK="#b22222",sK="#fffaf0",oK="#228b22",aK="#ff00ff",lK="#dcdcdc",hK="#f8f8ff",uK="#daa520",cK="#ffd700",fK="#808080",dK="#008000",pK="#adff2f",mK="#808080",gK="#f0fff0",vK="#ff69b4",_K="#cd5c5c",yK="#4b0082",xK="#fffff0",bK="#f0e68c",wK="#fff0f5",SK="#e6e6fa",CK="#7cfc00",MK="#fffacd",EK="#add8e6",TK="#f08080",AK="#e0ffff",PK="#fafad2",RK="#d3d3d3",LK="#90ee90",OK="#d3d3d3",DK="#ffb6c1",IK="#ffa07a",kK="#20b2aa",FK="#87cefa",BK="#778899",NK="#778899",UK="#b0c4de",GK="#ffffe0",zK="#00ff00",HK="#32cd32",WK="#faf0e6",VK="#ff00ff",jK="#800000",qK="#66cdaa",XK="#0000cd",YK="#ba55d3",ZK="#9370db",KK="#3cb371",QK="#7b68ee",JK="#00fa9a",$K="#48d1cc",eQ="#c71585",tQ="#191970",iQ="#f5fffa",rQ="#ffe4e1",nQ="#ffe4b5",sQ="#ffdead",oQ="#000080",aQ="#fdf5e6",lQ="#808000",hQ="#6b8e23",uQ="#ffa500",cQ="#ff4500",fQ="#da70d6",dQ="#eee8aa",pQ="#98fb98",mQ="#afeeee",gQ="#db7093",vQ="#ffefd5",_Q="#ffdab9",yQ="#cd853f",xQ="#ffc0cb",bQ="#dda0dd",wQ="#b0e0e6",SQ="#800080",CQ="#663399",MQ="#ff0000",EQ="#bc8f8f",TQ="#4169e1",AQ="#8b4513",PQ="#fa8072",RQ="#f4a460",LQ="#2e8b57",OQ="#fff5ee",DQ="#a0522d",IQ="#c0c0c0",kQ="#87ceeb",FQ="#6a5acd",BQ="#708090",NQ="#708090",UQ="#fffafa",GQ="#00ff7f",zQ="#4682b4",HQ="#d2b48c",WQ="#008080",VQ="#d8bfd8",jQ="#ff6347",qQ="#40e0d0",XQ="#ee82ee",YQ="#f5deb3",ZQ="#ffffff",KQ="#f5f5f5",QQ="#ffff00",JQ="#9acd32",$Q={aliceblue:dZ,antiquewhite:pZ,aqua:mZ,aquamarine:gZ,azure:vZ,beige:_Z,bisque:yZ,black:xZ,blanchedalmond:bZ,blue:wZ,blueviolet:SZ,brown:CZ,burlywood:MZ,cadetblue:EZ,chartreuse:TZ,chocolate:AZ,coral:PZ,cornflowerblue:RZ,cornsilk:LZ,crimson:OZ,cyan:DZ,darkblue:IZ,darkcyan:kZ,darkgoldenrod:FZ,darkgray:BZ,darkgreen:NZ,darkgrey:UZ,darkkhaki:GZ,darkmagenta:zZ,darkolivegreen:HZ,darkorange:WZ,darkorchid:VZ,darkred:jZ,darksalmon:qZ,darkseagreen:XZ,darkslateblue:YZ,darkslategray:ZZ,darkslategrey:KZ,darkturquoise:QZ,darkviolet:JZ,deeppink:$Z,deepskyblue:eK,dimgray:tK,dimgrey:iK,dodgerblue:rK,firebrick:nK,floralwhite:sK,forestgreen:oK,fuchsia:aK,gainsboro:lK,ghostwhite:hK,goldenrod:uK,gold:cK,gray:fK,green:dK,greenyellow:pK,grey:mK,honeydew:gK,hotpink:vK,indianred:_K,indigo:yK,ivory:xK,khaki:bK,lavenderblush:wK,lavender:SK,lawngreen:CK,lemonchiffon:MK,lightblue:EK,lightcoral:TK,lightcyan:AK,lightgoldenrodyellow:PK,lightgray:RK,lightgreen:LK,lightgrey:OK,lightpink:DK,lightsalmon:IK,lightseagreen:kK,lightskyblue:FK,lightslategray:BK,lightslategrey:NK,lightsteelblue:UK,lightyellow:GK,lime:zK,limegreen:HK,linen:WK,magenta:VK,maroon:jK,mediumaquamarine:qK,mediumblue:XK,mediumorchid:YK,mediumpurple:ZK,mediumseagreen:KK,mediumslateblue:QK,mediumspringgreen:JK,mediumturquoise:$K,mediumvioletred:eQ,midnightblue:tQ,mintcream:iQ,mistyrose:rQ,moccasin:nQ,navajowhite:sQ,navy:oQ,oldlace:aQ,olive:lQ,olivedrab:hQ,orange:uQ,orangered:cQ,orchid:fQ,palegoldenrod:dQ,palegreen:pQ,paleturquoise:mQ,palevioletred:gQ,papayawhip:vQ,peachpuff:_Q,peru:yQ,pink:xQ,plum:bQ,powderblue:wQ,purple:SQ,rebeccapurple:CQ,red:MQ,rosybrown:EQ,royalblue:TQ,saddlebrown:AQ,salmon:PQ,sandybrown:RQ,seagreen:LQ,seashell:OQ,sienna:DQ,silver:IQ,skyblue:kQ,slateblue:FQ,slategray:BQ,slategrey:NQ,snow:UQ,springgreen:GQ,steelblue:zQ,tan:HQ,teal:WQ,thistle:VQ,tomato:jQ,turquoise:qQ,violet:XQ,wheat:YQ,white:ZQ,whitesmoke:KQ,yellow:QQ,yellowgreen:JQ};function ds(t,e){return e===void 0&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(t&255)/255,e}function sd(t){var e=t.toString(16);return e="000000".substring(0,6-e.length)+e,"#"+e}function od(t){return typeof t=="string"&&(t=$Q[t.toLowerCase()]||t,t[0]==="#"&&(t=t.slice(1))),parseInt(t,16)}function eJ(t){return(t[0]*255<<16)+(t[1]*255<<8)+(t[2]*255|0)}function tJ(){for(var t=[],e=[],i=0;i<32;i++)t[i]=i,e[i]=i;t[at.NORMAL_NPM]=at.NORMAL,t[at.ADD_NPM]=at.ADD,t[at.SCREEN_NPM]=at.SCREEN,e[at.NORMAL]=at.NORMAL_NPM,e[at.ADD]=at.ADD_NPM,e[at.SCREEN]=at.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}var j0=tJ();function ad(t,e){return j0[e?1:0][t]}function LS(t,e,i,r){return i=i||new Float32Array(4),r||r===void 0?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e):(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=e,i}function ih(t,e){if(e===1)return(e*255<<24)+t;if(e===0)return 0;var i=t>>16&255,r=t>>8&255,n=t&255;return i=i*e+.5|0,r=r*e+.5|0,n=n*e+.5|0,(e*255<<24)+(i<<16)+(r<<8)+n}function ld(t,e,i,r){return i=i||new Float32Array(4),i[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(t&255)/255,(r||r===void 0)&&(i[0]*=e,i[1]*=e,i[2]*=e),i[3]=e,i}function OS(t,e){e===void 0&&(e=null);var i=t*6;if(e=e||new Uint16Array(i),e.length!==i)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+i);for(var r=0,n=0;r<i;r+=6,n+=4)e[r+0]=n+0,e[r+1]=n+1,e[r+2]=n+2,e[r+3]=n+0,e[r+4]=n+2,e[r+5]=n+3;return e}function hd(t){if(t.BYTES_PER_ELEMENT===4)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(t.BYTES_PER_ELEMENT===2){if(t instanceof Uint16Array)return"Uint16Array"}else if(t.BYTES_PER_ELEMENT===1&&t instanceof Uint8Array)return"Uint8Array";return null}var iJ={Float32Array,Uint32Array,Int32Array,Uint8Array};function rJ(t,e){for(var i=0,r=0,n={},o=0;o<t.length;o++)r+=e[o],i+=t[o].length;for(var a=new ArrayBuffer(i*4),l=null,h=0,o=0;o<t.length;o++){var u=e[o],c=t[o],f=hd(c);n[f]||(n[f]=new iJ[f](a)),l=n[f];for(var d=0;d<c.length;d++){var m=(d/u|0)*r+h,v=d%u;l[m+v]=c[d]}h+=u}return new Float32Array(a)}function Qu(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function q0(t){return!(t&t-1)&&!!t}function X0(t){var e=(t>65535?1:0)<<4;t>>>=e;var i=(t>255?1:0)<<3;return t>>>=i,e|=i,i=(t>15?1:0)<<2,t>>>=i,e|=i,i=(t>3?1:0)<<1,t>>>=i,e|=i,e|t>>1}function Us(t,e,i){var r=t.length,n;if(!(e>=r||i===0)){i=e+i>r?r-e:i;var o=r-i;for(n=e;n<o;++n)t[n]=t[n+i];t.length=o}}function oa(t){return t===0?0:t<0?-1:1}var nJ=0;function Co(){return++nJ}var B5={};function Yi(t,e,i){if(i===void 0&&(i=3),!B5[e]){var r=new Error().stack;typeof r=="undefined"?console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+t):(r=r.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+`
Deprecated since v`+t),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+t),console.warn(r))),B5[e]=!0}}var Y0={},rn=Object.create(null),Bn=Object.create(null);function sJ(){var t;for(t in rn)rn[t].destroy();for(t in Bn)Bn[t].destroy()}function oJ(){var t;for(t in rn)delete rn[t];for(t in Bn)delete Bn[t]}var Z0=function(){function t(e,i,r){this.canvas=Fe.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=r||Fe.RESOLUTION,this.resize(e,i)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(e,i){this.canvas.width=Math.round(e*this.resolution),this.canvas.height=Math.round(i*this.resolution)},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=Math.round(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=Math.round(e)},enumerable:!1,configurable:!0}),t}();function DS(t){var e=t.width,i=t.height,r=t.getContext("2d",{willReadFrequently:!0}),n=r.getImageData(0,0,e,i),o=n.data,a=o.length,l={top:null,left:null,right:null,bottom:null},h=null,u,c,f;for(u=0;u<a;u+=4)o[u+3]!==0&&(c=u/4%e,f=~~(u/4/e),l.top===null&&(l.top=f),(l.left===null||c<l.left)&&(l.left=c),(l.right===null||l.right<c)&&(l.right=c+1),(l.bottom===null||l.bottom<f)&&(l.bottom=f));return l.top!==null&&(e=l.right-l.left,i=l.bottom-l.top+1,h=r.getImageData(l.left,l.top,e,i)),{height:i,width:e,data:h}}var U5=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function aJ(t){var e=U5.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}var V0;function IS(t,e){if(e===void 0&&(e=globalThis.location),t.indexOf("data:")===0)return"";e=e||globalThis.location,V0||(V0=document.createElement("a")),V0.href=t;var i=sa.parse(V0.href),r=!i.port&&e.port===""||i.port===e.port;return i.hostname!==e.hostname||!r||i.protocol!==e.protocol?"anonymous":""}function tl(t,e){var i=Fe.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):e!==void 0?e:1}var cd=Math.PI*2,G5=180/Math.PI,z5=Math.PI/180,nr;(function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"})(nr||(nr={}));var Ht=function(){function t(e,i){e===void 0&&(e=0),i===void 0&&(i=0),this.x=0,this.y=0,this.x=e,this.y=i}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(e){return this.set(e.x,e.y),this},t.prototype.copyTo=function(e){return e.set(this.x,this.y),e},t.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},t.prototype.set=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=e),this.x=e,this.y=i,this},t.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},t}(),K0=[new Ht,new Ht,new Ht,new Ht],Tt=function(){function t(e,i,r,n){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=Number(e),this.y=Number(i),this.width=Number(r),this.height=Number(n),this.type=nr.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},t.prototype.copyTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},t.prototype.contains=function(e,i){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height},t.prototype.intersects=function(e,i){if(!i){var r=this.x<e.x?e.x:this.x,n=this.right>e.right?e.right:this.right;if(n<=r)return!1;var o=this.y<e.y?e.y:this.y,a=this.bottom>e.bottom?e.bottom:this.bottom;return a>o}var l=this.left,h=this.right,u=this.top,c=this.bottom;if(h<=l||c<=u)return!1;var f=K0[0].set(e.left,e.top),d=K0[1].set(e.left,e.bottom),m=K0[2].set(e.right,e.top),v=K0[3].set(e.right,e.bottom);if(m.x<=f.x||d.y<=f.y)return!1;var g=Math.sign(i.a*i.d-i.b*i.c);if(g===0||(i.apply(f,f),i.apply(d,d),i.apply(m,m),i.apply(v,v),Math.max(f.x,d.x,m.x,v.x)<=l||Math.min(f.x,d.x,m.x,v.x)>=h||Math.max(f.y,d.y,m.y,v.y)<=u||Math.min(f.y,d.y,m.y,v.y)>=c))return!1;var p=g*(d.y-f.y),_=g*(f.x-d.x),x=p*l+_*u,b=p*h+_*u,y=p*l+_*c,w=p*h+_*c;if(Math.max(x,b,y,w)<=p*f.x+_*f.y||Math.min(x,b,y,w)>=p*v.x+_*v.y)return!1;var S=g*(f.y-m.y),R=g*(m.x-f.x),E=S*l+R*u,T=S*h+R*u,A=S*l+R*c,C=S*h+R*c;return!(Math.max(E,T,A,C)<=S*f.x+R*f.y||Math.min(E,T,A,C)>=S*v.x+R*v.y)},t.prototype.pad=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=e),this.x-=e,this.y-=i,this.width+=e*2,this.height+=i*2,this},t.prototype.fit=function(e){var i=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),o=Math.min(this.y+this.height,e.y+e.height);return this.x=i,this.width=Math.max(r-i,0),this.y=n,this.height=Math.max(o-n,0),this},t.prototype.ceil=function(e,i){e===void 0&&(e=1),i===void 0&&(i=.001);var r=Math.ceil((this.x+this.width-i)*e)/e,n=Math.ceil((this.y+this.height-i)*e)/e;return this.x=Math.floor((this.x+i)*e)/e,this.y=Math.floor((this.y+i)*e)/e,this.width=r-this.x,this.height=n-this.y,this},t.prototype.enlarge=function(e){var i=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),o=Math.max(this.y+this.height,e.y+e.height);return this.x=i,this.width=r-i,this.y=n,this.height=o-n,this},t.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),H5=function(){function t(e,i,r){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),this.x=e,this.y=i,this.radius=r,this.type=nr.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(e,i){if(this.radius<=0)return!1;var r=this.radius*this.radius,n=this.x-e,o=this.y-i;return n*=n,o*=o,n+o<=r},t.prototype.getBounds=function(){return new Tt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},t.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},t}(),W5=function(){function t(e,i,r,n){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=e,this.y=i,this.width=r,this.height=n,this.type=nr.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(e,i){if(this.width<=0||this.height<=0)return!1;var r=(e-this.x)/this.width,n=(i-this.y)/this.height;return r*=r,n*=n,r+n<=1},t.prototype.getBounds=function(){return new Tt(this.x-this.width,this.y-this.height,this.width,this.height)},t.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),Ju=function(){function t(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var n=Array.isArray(i[0])?i[0]:i;if(typeof n[0]!="number"){for(var o=[],a=0,l=n.length;a<l;a++)o.push(n[a].x,n[a].y);n=o}this.points=n,this.type=nr.POLY,this.closeStroke=!0}return t.prototype.clone=function(){var e=this.points.slice(),i=new t(e);return i.closeStroke=this.closeStroke,i},t.prototype.contains=function(e,i){for(var r=!1,n=this.points.length/2,o=0,a=n-1;o<n;a=o++){var l=this.points[o*2],h=this.points[o*2+1],u=this.points[a*2],c=this.points[a*2+1],f=h>i!=c>i&&e<(u-l)*((i-h)/(c-h))+l;f&&(r=!r)}return r},t.prototype.toString=function(){return"[@pixi/math:Polygon"+("closeStroke="+this.closeStroke)+("points="+this.points.reduce(function(e,i){return e+", "+i},"")+"]")},t}(),V5=function(){function t(e,i,r,n,o){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=0),o===void 0&&(o=20),this.x=e,this.y=i,this.width=r,this.height=n,this.radius=o,this.type=nr.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(e,i){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){var r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+r&&i<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;var n=e-(this.x+r),o=i-(this.y+r),a=r*r;if(n*n+o*o<=a||(n=e-(this.x+this.width-r),n*n+o*o<=a)||(o=i-(this.y+this.height-r),n*n+o*o<=a)||(n=e-(this.x+r),n*n+o*o<=a))return!0}return!1},t.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+("width="+this.width+" height="+this.height+" radius="+this.radius+"]")},t}(),rl=function(){function t(e,i,r,n){r===void 0&&(r=0),n===void 0&&(n=0),this._x=r,this._y=n,this.cb=e,this.scope=i}return t.prototype.clone=function(e,i){return e===void 0&&(e=this.cb),i===void 0&&(i=this.scope),new t(e,i,this._x,this._y)},t.prototype.set=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=e),(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(e){return e.set(this._x,this._y),e},t.prototype.equals=function(e){return e.x===this._x&&e.y===this._y},t.prototype.toString=function(){return"[@pixi/math:ObservablePoint x="+0+" y="+0+" scope="+this.scope+"]"},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),Zt=function(){function t(e,i,r,n,o,a){e===void 0&&(e=1),i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=0),a===void 0&&(a=0),this.array=null,this.a=e,this.b=i,this.c=r,this.d=n,this.tx=o,this.ty=a}return t.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},t.prototype.set=function(e,i,r,n,o,a){return this.a=e,this.b=i,this.c=r,this.d=n,this.tx=o,this.ty=a,this},t.prototype.toArray=function(e,i){this.array||(this.array=new Float32Array(9));var r=i||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},t.prototype.apply=function(e,i){i=i||new Ht;var r=e.x,n=e.y;return i.x=this.a*r+this.c*n+this.tx,i.y=this.b*r+this.d*n+this.ty,i},t.prototype.applyInverse=function(e,i){i=i||new Ht;var r=1/(this.a*this.d+this.c*-this.b),n=e.x,o=e.y;return i.x=this.d*r*n+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*o+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,i},t.prototype.translate=function(e,i){return this.tx+=e,this.ty+=i,this},t.prototype.scale=function(e,i){return this.a*=e,this.d*=i,this.c*=e,this.b*=i,this.tx*=e,this.ty*=i,this},t.prototype.rotate=function(e){var i=Math.cos(e),r=Math.sin(e),n=this.a,o=this.c,a=this.tx;return this.a=n*i-this.b*r,this.b=n*r+this.b*i,this.c=o*i-this.d*r,this.d=o*r+this.d*i,this.tx=a*i-this.ty*r,this.ty=a*r+this.ty*i,this},t.prototype.append=function(e){var i=this.a,r=this.b,n=this.c,o=this.d;return this.a=e.a*i+e.b*n,this.b=e.a*r+e.b*o,this.c=e.c*i+e.d*n,this.d=e.c*r+e.d*o,this.tx=e.tx*i+e.ty*n+this.tx,this.ty=e.tx*r+e.ty*o+this.ty,this},t.prototype.setTransform=function(e,i,r,n,o,a,l,h,u){return this.a=Math.cos(l+u)*o,this.b=Math.sin(l+u)*o,this.c=-Math.sin(l-h)*a,this.d=Math.cos(l-h)*a,this.tx=e-(r*this.a+n*this.c),this.ty=i-(r*this.b+n*this.d),this},t.prototype.prepend=function(e){var i=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){var r=this.a,n=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=i*e.a+this.ty*e.c+e.tx,this.ty=i*e.b+this.ty*e.d+e.ty,this},t.prototype.decompose=function(e){var i=this.a,r=this.b,n=this.c,o=this.d,a=e.pivot,l=-Math.atan2(-n,o),h=Math.atan2(r,i),u=Math.abs(l+h);return u<1e-5||Math.abs(cd-u)<1e-5?(e.rotation=h,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=l,e.skew.y=h),e.scale.x=Math.sqrt(i*i+r*r),e.scale.y=Math.sqrt(n*n+o*o),e.position.x=this.tx+(a.x*i+a.y*n),e.position.y=this.ty+(a.x*r+a.y*o),e},t.prototype.invert=function(){var e=this.a,i=this.b,r=this.c,n=this.d,o=this.tx,a=e*n-i*r;return this.a=n/a,this.b=-i/a,this.c=-r/a,this.d=e/a,this.tx=(r*this.ty-n*o)/a,this.ty=-(e*this.ty-i*o)/a,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},t.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),rh=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],nh=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],sh=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],oh=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],kS=[],j5=[],Q0=Math.sign;function lJ(){for(var t=0;t<16;t++){var e=[];kS.push(e);for(var i=0;i<16;i++)for(var r=Q0(rh[t]*rh[i]+sh[t]*nh[i]),n=Q0(nh[t]*rh[i]+oh[t]*nh[i]),o=Q0(rh[t]*sh[i]+sh[t]*oh[i]),a=Q0(nh[t]*sh[i]+oh[t]*oh[i]),l=0;l<16;l++)if(rh[l]===r&&nh[l]===n&&sh[l]===o&&oh[l]===a){e.push(l);break}}for(var t=0;t<16;t++){var h=new Zt;h.set(rh[t],nh[t],sh[t],oh[t],0,0),j5.push(h)}}lJ();var ci={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return rh[t]},uY:function(t){return nh[t]},vX:function(t){return sh[t]},vY:function(t){return oh[t]},inv:function(t){return t&8?t&15:-t&7},add:function(t,e){return kS[t][e]},sub:function(t,e){return kS[t][ci.inv(e)]},rotate180:function(t){return t^4},isVertical:function(t){return(t&3)===2},byDirection:function(t,e){return Math.abs(t)*2<=Math.abs(e)?e>=0?ci.S:ci.N:Math.abs(e)*2<=Math.abs(t)?t>0?ci.E:ci.W:e>0?t>0?ci.SE:ci.SW:t>0?ci.NE:ci.NW},matrixAppendRotationInv:function(t,e,i,r){i===void 0&&(i=0),r===void 0&&(r=0);var n=j5[ci.inv(e)];n.tx=i,n.ty=r,t.append(n)}},J0=function(){function t(){this.worldTransform=new Zt,this.localTransform=new Zt,this.position=new rl(this.onChange,this,0,0),this.scale=new rl(this.onChange,this,1,1),this.pivot=new rl(this.onChange,this,0,0),this.skew=new rl(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},t.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(e){var i=this.localTransform;if(this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var r=e.worldTransform,n=this.worldTransform;n.a=i.a*r.a+i.b*r.c,n.b=i.a*r.b+i.b*r.d,n.c=i.c*r.a+i.d*r.c,n.d=i.c*r.b+i.d*r.d,n.tx=i.tx*r.a+i.ty*r.c+r.tx,n.ty=i.tx*r.b+i.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}},t.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();Fe.SORTABLE_CHILDREN=!1;var $u=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?Tt.EMPTY:(e=e||new Tt(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},t.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},t.prototype.addPointMatrix=function(e,i){var r=e.a,n=e.b,o=e.c,a=e.d,l=e.tx,h=e.ty,u=r*i.x+o*i.y+l,c=n*i.x+a*i.y+h;this.minX=Math.min(this.minX,u),this.maxX=Math.max(this.maxX,u),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)},t.prototype.addQuad=function(e){var i=this.minX,r=this.minY,n=this.maxX,o=this.maxY,a=e[0],l=e[1];i=a<i?a:i,r=l<r?l:r,n=a>n?a:n,o=l>o?l:o,a=e[2],l=e[3],i=a<i?a:i,r=l<r?l:r,n=a>n?a:n,o=l>o?l:o,a=e[4],l=e[5],i=a<i?a:i,r=l<r?l:r,n=a>n?a:n,o=l>o?l:o,a=e[6],l=e[7],i=a<i?a:i,r=l<r?l:r,n=a>n?a:n,o=l>o?l:o,this.minX=i,this.minY=r,this.maxX=n,this.maxY=o},t.prototype.addFrame=function(e,i,r,n,o){this.addFrameMatrix(e.worldTransform,i,r,n,o)},t.prototype.addFrameMatrix=function(e,i,r,n,o){var a=e.a,l=e.b,h=e.c,u=e.d,c=e.tx,f=e.ty,d=this.minX,m=this.minY,v=this.maxX,g=this.maxY,p=a*i+h*r+c,_=l*i+u*r+f;d=p<d?p:d,m=_<m?_:m,v=p>v?p:v,g=_>g?_:g,p=a*n+h*r+c,_=l*n+u*r+f,d=p<d?p:d,m=_<m?_:m,v=p>v?p:v,g=_>g?_:g,p=a*i+h*o+c,_=l*i+u*o+f,d=p<d?p:d,m=_<m?_:m,v=p>v?p:v,g=_>g?_:g,p=a*n+h*o+c,_=l*n+u*o+f,d=p<d?p:d,m=_<m?_:m,v=p>v?p:v,g=_>g?_:g,this.minX=d,this.minY=m,this.maxX=v,this.maxY=g},t.prototype.addVertexData=function(e,i,r){for(var n=this.minX,o=this.minY,a=this.maxX,l=this.maxY,h=i;h<r;h+=2){var u=e[h],c=e[h+1];n=u<n?u:n,o=c<o?c:o,a=u>a?u:a,l=c>l?c:l}this.minX=n,this.minY=o,this.maxX=a,this.maxY=l},t.prototype.addVertices=function(e,i,r,n){this.addVerticesMatrix(e.worldTransform,i,r,n)},t.prototype.addVerticesMatrix=function(e,i,r,n,o,a){o===void 0&&(o=0),a===void 0&&(a=o);for(var l=e.a,h=e.b,u=e.c,c=e.d,f=e.tx,d=e.ty,m=this.minX,v=this.minY,g=this.maxX,p=this.maxY,_=r;_<n;_+=2){var x=i[_],b=i[_+1],y=l*x+u*b+f,w=c*b+h*x+d;m=Math.min(m,y-o),g=Math.max(g,y+o),v=Math.min(v,w-a),p=Math.max(p,w+a)}this.minX=m,this.minY=v,this.maxX=g,this.maxY=p},t.prototype.addBounds=function(e){var i=this.minX,r=this.minY,n=this.maxX,o=this.maxY;this.minX=e.minX<i?e.minX:i,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>o?e.maxY:o},t.prototype.addBoundsMask=function(e,i){var r=e.minX>i.minX?e.minX:i.minX,n=e.minY>i.minY?e.minY:i.minY,o=e.maxX<i.maxX?e.maxX:i.maxX,a=e.maxY<i.maxY?e.maxY:i.maxY;if(r<=o&&n<=a){var l=this.minX,h=this.minY,u=this.maxX,c=this.maxY;this.minX=r<l?r:l,this.minY=n<h?n:h,this.maxX=o>u?o:u,this.maxY=a>c?a:c}},t.prototype.addBoundsMatrix=function(e,i){this.addFrameMatrix(i,e.minX,e.minY,e.maxX,e.maxY)},t.prototype.addBoundsArea=function(e,i){var r=e.minX>i.x?e.minX:i.x,n=e.minY>i.y?e.minY:i.y,o=e.maxX<i.x+i.width?e.maxX:i.x+i.width,a=e.maxY<i.y+i.height?e.maxY:i.y+i.height;if(r<=o&&n<=a){var l=this.minX,h=this.minY,u=this.maxX,c=this.maxY;this.minX=r<l?r:l,this.minY=n<h?n:h,this.maxX=o>u?o:u,this.maxY=a>c?a:c}},t.prototype.pad=function(e,i){e===void 0&&(e=0),i===void 0&&(i=e),this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=i,this.maxY+=i)},t.prototype.addFramePad=function(e,i,r,n,o,a){e-=o,i-=a,r+=o,n+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<i?this.minY:i,this.maxY=this.maxY>n?this.maxY:n},t}();var FS=function(t,e){return FS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},FS(t,e)};function BS(t,e){FS(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var ri=function(t){BS(e,t);function e(){var i=t.call(this)||this;return i.tempDisplayObjectParent=null,i.transform=new J0,i.alpha=1,i.visible=!0,i.renderable=!0,i.cullable=!1,i.cullArea=null,i.parent=null,i.worldAlpha=1,i._lastSortedIndex=0,i._zIndex=0,i.filterArea=null,i.filters=null,i._enabledFilters=null,i._bounds=new $u,i._localBounds=null,i._boundsID=0,i._boundsRect=null,i._localBoundsRect=null,i._mask=null,i._maskRefCount=0,i._destroyed=!1,i.isSprite=!1,i.isMask=!1,i}return e.mixin=function(i){for(var r=Object.keys(i),n=0;n<r.length;++n){var o=r[n];Object.defineProperty(e.prototype,o,Object.getOwnPropertyDescriptor(i,o))}},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(i,r){return i||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new Tt),r=this._boundsRect),this._bounds.getRectangle(r)},e.prototype.getLocalBounds=function(i){i||(this._localBoundsRect||(this._localBoundsRect=new Tt),i=this._localBoundsRect),this._localBounds||(this._localBounds=new $u);var r=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var o=this._bounds,a=this._boundsID;this._bounds=this._localBounds;var l=this.getBounds(!1,i);return this.parent=n,this.transform=r,this._bounds=o,this._bounds.updateID+=this._boundsID-a,l},e.prototype.toGlobal=function(i,r,n){return n===void 0&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(i,r)},e.prototype.toLocal=function(i,r,n,o){return r&&(i=r.toGlobal(i,n,o)),o||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(i,n)},e.prototype.setParent=function(i){if(!i||!i.addChild)throw new Error("setParent: Argument must be a Container");return i.addChild(this),i},e.prototype.setTransform=function(i,r,n,o,a,l,h,u,c){return i===void 0&&(i=0),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=1),a===void 0&&(a=0),l===void 0&&(l=0),h===void 0&&(h=0),u===void 0&&(u=0),c===void 0&&(c=0),this.position.x=i,this.position.y=r,this.scale.x=n||1,this.scale.y=o||1,this.rotation=a,this.skew.x=l,this.skew.y=h,this.pivot.x=u,this.pivot.y=c,this},e.prototype.destroy=function(i){this.parent&&this.parent.removeChild(this),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new NS),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var i=this.parent;return this.parent=this._tempDisplayObjectParent,i},e.prototype.disableTempParent=function(i){this.parent=i},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(i){this.transform.position.x=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(i){this.transform.position.y=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(i){this.transform.position.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(i){this.transform.scale.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(i){this.transform.pivot.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(i){this.transform.skew.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(i){this.transform.rotation=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*G5},set:function(i){this.transform.rotation=i*z5},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(i){this._zIndex=i,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var i=this;do{if(!i.visible)return!1;i=i.parent}while(i);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(i){if(this._mask!==i){if(this._mask){var r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=i,this._mask){var r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}},enumerable:!1,configurable:!0}),e}(Mo.default),NS=function(t){BS(e,t);function e(){var i=t!==null&&t.apply(this,arguments)||this;return i.sortDirty=null,i}return e}(ri);ri.prototype.displayObjectUpdateTransform=ri.prototype.updateTransform;function hJ(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}var fi=function(t){BS(e,t);function e(){var i=t.call(this)||this;return i.children=[],i.sortableChildren=Fe.SORTABLE_CHILDREN,i.sortDirty=!1,i}return e.prototype.onChildrenChange=function(i){},e.prototype.addChild=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];if(r.length>1)for(var o=0;o<r.length;o++)this.addChild(r[o]);else{var a=r[0];a.parent&&a.parent.removeChild(a),a.parent=this,this.sortDirty=!0,a.transform._parentID=-1,this.children.push(a),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",a,this,this.children.length-1),a.emit("added",this)}return r[0]},e.prototype.addChildAt=function(i,r){if(r<0||r>this.children.length)throw new Error(i+"addChildAt: The index "+r+" supplied is out of bounds "+this.children.length);return i.parent&&i.parent.removeChild(i),i.parent=this,this.sortDirty=!0,i.transform._parentID=-1,this.children.splice(r,0,i),this._boundsID++,this.onChildrenChange(r),i.emit("added",this),this.emit("childAdded",i,this,r),i},e.prototype.swapChildren=function(i,r){if(i!==r){var n=this.getChildIndex(i),o=this.getChildIndex(r);this.children[n]=r,this.children[o]=i,this.onChildrenChange(n<o?n:o)}},e.prototype.getChildIndex=function(i){var r=this.children.indexOf(i);if(r===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return r},e.prototype.setChildIndex=function(i,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(i);Us(this.children,n,1),this.children.splice(r,0,i),this.onChildrenChange(r)},e.prototype.getChildAt=function(i){if(i<0||i>=this.children.length)throw new Error("getChildAt: Index ("+i+") does not exist.");return this.children[i]},e.prototype.removeChild=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];if(r.length>1)for(var o=0;o<r.length;o++)this.removeChild(r[o]);else{var a=r[0],l=this.children.indexOf(a);if(l===-1)return null;a.parent=null,a.transform._parentID=-1,Us(this.children,l,1),this._boundsID++,this.onChildrenChange(l),a.emit("removed",this),this.emit("childRemoved",a,this,l)}return r[0]},e.prototype.removeChildAt=function(i){var r=this.getChildAt(i);return r.parent=null,r.transform._parentID=-1,Us(this.children,i,1),this._boundsID++,this.onChildrenChange(i),r.emit("removed",this),this.emit("childRemoved",r,this,i),r},e.prototype.removeChildren=function(i,r){i===void 0&&(i=0),r===void 0&&(r=this.children.length);var n=i,o=r,a=o-n,l;if(a>0&&a<=o){l=this.children.splice(n,a);for(var h=0;h<l.length;++h)l[h].parent=null,l[h].transform&&(l[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(i);for(var h=0;h<l.length;++h)l[h].emit("removed",this),this.emit("childRemoved",l[h],this,h);return l}else if(a===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var i=!1,r=0,n=this.children.length;r<n;++r){var o=this.children[r];o._lastSortedIndex=r,!i&&o.zIndex!==0&&(i=!0)}i&&this.children.length>1&&this.children.sort(hJ),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,r=this.children.length;i<r;++i){var n=this.children[i];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var i=0;i<this.children.length;i++){var r=this.children[i];if(!(!r.visible||!r.renderable))if(r.calculateBounds(),r._mask){var n=r._mask.isMaskData?r._mask.maskObject:r._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(r._bounds,n._bounds)):this._bounds.addBounds(r._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(i,r){r===void 0&&(r=!1);var n=t.prototype.getLocalBounds.call(this,i);if(!r)for(var o=0,a=this.children.length;o<a;++o){var l=this.children[o];l.visible&&l.updateTransform()}return n},e.prototype._calculateBounds=function(){},e.prototype._renderWithCulling=function(i){var r=i.renderTexture.sourceFrame;if(r.width>0&&r.height>0){var n,o;if(this.cullArea?(n=this.cullArea,o=this.worldTransform):this._render!==e.prototype._render&&(n=this.getBounds(!0)),n&&r.intersects(n,o))this._render(i);else if(this.cullArea)return;for(var a=0,l=this.children.length;a<l;++a){var h=this.children[a],u=h.cullable;h.cullable=u||!this.cullArea,h.render(i),h.cullable=u}}},e.prototype.render=function(i){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(i);else if(this.cullable)this._renderWithCulling(i);else{this._render(i);for(var r=0,n=this.children.length;r<n;++r)this.children[r].render(i)}},e.prototype.renderAdvanced=function(i){var r=this.filters,n=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var o=0;o<r.length;o++)r[o].enabled&&this._enabledFilters.push(r[o])}var a=r&&this._enabledFilters&&this._enabledFilters.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==Pi.NONE));if(a&&i.batch.flush(),r&&this._enabledFilters&&this._enabledFilters.length&&i.filter.push(this,this._enabledFilters),n&&i.mask.push(this,this._mask),this.cullable)this._renderWithCulling(i);else{this._render(i);for(var o=0,l=this.children.length;o<l;++o)this.children[o].render(i)}a&&i.batch.flush(),n&&i.mask.pop(this),r&&this._enabledFilters&&this._enabledFilters.length&&i.filter.pop()},e.prototype._render=function(i){},e.prototype.destroy=function(i){t.prototype.destroy.call(this),this.sortDirty=!1;var r=typeof i=="boolean"?i:i&&i.children,n=this.removeChildren(0,this.children.length);if(r)for(var o=0;o<n.length;++o)n[o].destroy(i)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(i){var r=this.getLocalBounds().width;r!==0?this.scale.x=i/r:this.scale.x=1,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(i){var r=this.getLocalBounds().height;r!==0?this.scale.y=i/r:this.scale.y=1,this._height=i},enumerable:!1,configurable:!0}),e}(ri);fi.prototype.containerUpdateTransform=fi.prototype.updateTransform;var fd=function(){return fd=Object.assign||function(e){for(var i=arguments,r,n=1,o=arguments.length;n<o;n++){r=i[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},fd.apply(this,arguments)},Pt;(function(t){t.Application="application",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Loader="loader",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser"})(Pt||(Pt={}));var q5=function(t){if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");var e=typeof t.extension!="object"?{type:t.extension}:t.extension;t=fd(fd({},e),{ref:t})}if(typeof t=="object")t=fd({},t);else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},Nn={_addHandlers:null,_removeHandlers:null,_queue:{},remove:function(){for(var t=arguments,e=this,i=[],r=0;r<arguments.length;r++)i[r]=t[r];return i.map(q5).forEach(function(n){n.type.forEach(function(o){var a,l;return(l=(a=e._removeHandlers)[o])===null||l===void 0?void 0:l.call(a,n)})}),this},add:function(){for(var t=arguments,e=this,i=[],r=0;r<arguments.length;r++)i[r]=t[r];return i.map(q5).forEach(function(n){n.type.forEach(function(o){var a=e._addHandlers,l=e._queue;a[o]?a[o](n):(l[o]=l[o]||[],l[o].push(n))})}),this},handle:function(t,e,i){var r=this._addHandlers=this._addHandlers||{},n=this._removeHandlers=this._removeHandlers||{};if(r[t]||n[t])throw new Error("Extension type "+t+" already has a handler");r[t]=e,n[t]=i;var o=this._queue;return o[t]&&(o[t].forEach(function(a){return e(a)}),delete o[t]),this},handleByMap:function(t,e){return this.handle(t,function(i){e[i.name]=i.ref},function(i){delete e[i.name]})},handleByList:function(t,e){return this.handle(t,function(i){var r,n;e.push(i.ref),t===Pt.Loader&&((n=(r=i.ref).add)===null||n===void 0||n.call(r))},function(i){var r=e.indexOf(i.ref);r!==-1&&e.splice(r,1)})}};var gr=function(){function t(e){this.items=[],this._name=e,this._aliasCount=0}return t.prototype.emit=function(e,i,r,n,o,a,l,h){if(arguments.length>8)throw new Error("max arguments reached");var u=this,c=u.name,f=u.items;this._aliasCount++;for(var d=0,m=f.length;d<m;d++)f[d][c](e,i,r,n,o,a,l,h);return f===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this},t.prototype.remove=function(e){var i=this.items.indexOf(e);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this},t.prototype.contains=function(e){return this.items.indexOf(e)!==-1},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(gr.prototype,{dispatch:{value:gr.prototype.emit},run:{value:gr.prototype.emit}});Fe.TARGET_FPMS=.06;var ps;(function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"})(ps||(ps={}));var US=function(){function t(e,i,r,n){i===void 0&&(i=null),r===void 0&&(r=0),n===void 0&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=i,this.priority=r,this.once=n}return t.prototype.match=function(e,i){return i===void 0&&(i=null),this.fn===e&&this.context===i},t.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));var i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i},t.prototype.connect=function(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this},t.prototype.destroy=function(e){e===void 0&&(e=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var i=this.next;return this.next=e?null:i,this.previous=null,i},t}(),Bi=function(){function t(){var e=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new US(null,null,1/0),this.deltaMS=1/Fe.TARGET_FPMS,this.elapsedMS=1/Fe.TARGET_FPMS,this._tick=function(i){e._requestId=null,e.started&&(e.update(i),e.started&&e._requestId===null&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return t.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(e,i,r){return r===void 0&&(r=ps.NORMAL),this._addListener(new US(e,i,r))},t.prototype.addOnce=function(e,i,r){return r===void 0&&(r=ps.NORMAL),this._addListener(new US(e,i,r,!0))},t.prototype._addListener=function(e){var i=this._head.next,r=this._head;if(!i)e.connect(r);else{for(;i;){if(e.priority>i.priority){e.connect(r);break}r=i,i=i.next}e.previous||e.connect(r)}return this._startIfPossible(),this},t.prototype.remove=function(e,i){for(var r=this._head.next;r;)r.match(e,i)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(t.prototype,"count",{get:function(){if(!this._head)return 0;for(var e=0,i=this._head;i=i.next;)e++;return e},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(e){e===void 0&&(e=performance.now());var i;if(e>this.lastTime){if(i=this.elapsedMS=e-this.lastTime,i>this._maxElapsedMS&&(i=this._maxElapsedMS),i*=this.speed,this._minElapsedMS){var r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=i,this.deltaTime=this.deltaMS*Fe.TARGET_FPMS;for(var n=this._head,o=n.next;o;)o=o.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(e){var i=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,i)/1e3,Fe.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(e){if(e===0)this._minElapsedMS=0;else{var i=Math.max(this.minFPS,e);this._minElapsedMS=1/(i/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!1,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!1,configurable:!0}),t}(),X5=function(){function t(){}return t.init=function(e){var i=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,ps.LOW)},get:function(){return this._ticker}}),this.stop=function(){i._ticker.stop()},this.start=function(){i._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Bi.shared:new Bi,e.autoStart&&this.start()},t.destroy=function(){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}},t.extension=Pt.Application,t}();Fe.PREFER_ENV=yn.any?wo.WEBGL:wo.WEBGL2;Fe.STRICT_TEXTURE_CACHE=!1;var s_=[];function eC(t,e){if(!t)return null;var i="";if(typeof t=="string"){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(var n=s_.length-1;n>=0;--n){var o=s_[n];if(o.test&&o.test(t,i))return new o(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var QS=function(t,e){return QS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},QS(t,e)};function ni(t,e){QS(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var JS=function(){return JS=Object.assign||function(e){for(var i=arguments,r,n=1,o=arguments.length;n<o;n++){r=i[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},JS.apply(this,arguments)};function uJ(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]]);return i}var tc=function(){function t(e,i){e===void 0&&(e=0),i===void 0&&(i=0),this._width=e,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new gr("setRealSize"),this.onUpdate=new gr("update"),this.onError=new gr("onError")}return t.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},t.prototype.resize=function(e,i){(e!==this._width||i!==this._height)&&(this._width=e,this._height=i,this.onResize.emit(e,i))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(e,i,r){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(e,i){return!1},t}(),lh=function(t){ni(e,t);function e(i,r){var n=this,o=r||{},a=o.width,l=o.height;if(!a||!l)throw new Error("BufferResource width or height invalid");return n=t.call(this,a,l)||this,n.data=i,n}return e.prototype.upload=function(i,r,n){var o=i.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===_n.UNPACK);var a=r.realWidth,l=r.realHeight;return n.width===a&&n.height===l?o.texSubImage2D(r.target,0,0,0,a,l,r.format,n.type,this.data):(n.width=a,n.height=l,o.texImage2D(r.target,0,n.internalFormat,a,l,0,r.format,n.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(i){return i instanceof Float32Array||i instanceof Uint8Array||i instanceof Uint32Array},e}(tc),cJ={scaleMode:cs.NEAREST,format:Oe.RGBA,alphaMode:_n.NPM},At=function(t){ni(e,t);function e(i,r){i===void 0&&(i=null),r===void 0&&(r=null);var n=t.call(this)||this;r=r||{};var o=r.alphaMode,a=r.mipmap,l=r.anisotropicLevel,h=r.scaleMode,u=r.width,c=r.height,f=r.wrapMode,d=r.format,m=r.type,v=r.target,g=r.resolution,p=r.resourceOptions;return i&&!(i instanceof tc)&&(i=eC(i,p),i.internal=!0),n.resolution=g||Fe.RESOLUTION,n.width=Math.round((u||0)*n.resolution)/n.resolution,n.height=Math.round((c||0)*n.resolution)/n.resolution,n._mipmap=a!==void 0?a:Fe.MIPMAP_TEXTURES,n.anisotropicLevel=l!==void 0?l:Fe.ANISOTROPIC_LEVEL,n._wrapMode=f||Fe.WRAP_MODE,n._scaleMode=h!==void 0?h:Fe.SCALE_MODE,n.format=d||Oe.RGBA,n.type=m||ht.UNSIGNED_BYTE,n.target=v||el.TEXTURE_2D,n.alphaMode=o!==void 0?o:_n.UNPACK,n.uid=Co(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=u>0&&c>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(i),n}return Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._mipmap},set:function(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(i,r){var n;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,n=!0),r!==void 0&&r!==this.mipmap&&(this.mipmap=r,n=!0),n&&this.dirtyStyleId++,this},e.prototype.setSize=function(i,r,n){return n=n||this.resolution,this.setRealSize(i*n,r*n,n)},e.prototype.setRealSize=function(i,r,n){return this.resolution=n||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(r)/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=q0(this.realWidth)&&q0(this.realHeight)},e.prototype.setResolution=function(i){var r=this.resolution;return r===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*r)/i,this.height=Math.round(this.height*r)/i,this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(i){this.emit("error",this,i)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Bn[this.cacheId],delete rn[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(i,r,n){n===void 0&&(n=Fe.STRICT_TEXTURE_CACHE);var o=typeof i=="string",a=null;if(o)a=i;else{if(!i._pixiId){var l=r&&r.pixiIdPrefix||"pixiid";i._pixiId=l+"_"+Co()}a=i._pixiId}var h=Bn[a];if(o&&n&&!h)throw new Error('The cacheId "'+a+'" does not exist in BaseTextureCache.');return h||(h=new e(i,r),h.cacheId=a,e.addToCache(h,a)),h},e.fromBuffer=function(i,r,n,o){i=i||new Float32Array(r*n*4);var a=new lh(i,{width:r,height:n}),l=i instanceof Float32Array?ht.FLOAT:ht.UNSIGNED_BYTE;return new e(a,Object.assign({},cJ,o||{width:r,height:n,type:l}))},e.addToCache=function(i,r){r&&(i.textureCacheIds.indexOf(r)===-1&&i.textureCacheIds.push(r),Bn[r]&&console.warn("BaseTexture added to the cache with an id ["+r+"] that already had an entry"),Bn[r]=i)},e.removeFromCache=function(i){if(typeof i=="string"){var r=Bn[i];if(r){var n=r.textureCacheIds.indexOf(i);return n>-1&&r.textureCacheIds.splice(n,1),delete Bn[i],r}}else if(i&&i.textureCacheIds){for(var o=0;o<i.textureCacheIds.length;++o)delete Bn[i.textureCacheIds[o]];return i.textureCacheIds.length=0,i}return null},e._globalBatch=0,e}(Mo.default),tC=function(t){ni(e,t);function e(i,r){var n=this,o=r||{},a=o.width,l=o.height;n=t.call(this,a,l)||this,n.items=[],n.itemDirtyIds=[];for(var h=0;h<i;h++){var u=new At;n.items.push(u),n.itemDirtyIds.push(-2)}return n.length=i,n._load=null,n.baseTexture=null,n}return e.prototype.initFromArray=function(i,r){for(var n=0;n<this.length;n++)i[n]&&(i[n].castToBaseTexture?this.addBaseTextureAt(i[n].castToBaseTexture(),n):i[n]instanceof tc?this.addResourceAt(i[n],n):this.addResourceAt(eC(i[n],r),n))},e.prototype.dispose=function(){for(var i=0,r=this.length;i<r;i++)this.items[i].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(i,r){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");return i.valid&&!this.valid&&this.resize(i.width,i.height),this.items[r].setResource(i),this},e.prototype.bind=function(i){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,i);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=i,this.items[r].on("update",i.update,i)},e.prototype.unbind=function(i){t.prototype.unbind.call(this,i);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",i.update,i)},e.prototype.load=function(){var i=this;if(this._load)return this._load;var r=this.items.map(function(o){return o.resource}).filter(function(o){return o}),n=r.map(function(o){return o.load()});return this._load=Promise.all(n).then(function(){var o=i.items[0],a=o.realWidth,l=o.realHeight;return i.resize(a,l),Promise.resolve(i)}),this._load},e}(tc),aN=function(t){ni(e,t);function e(i,r){var n=this,o=r||{},a=o.width,l=o.height,h,u;return Array.isArray(i)?(h=i,u=i.length):u=i,n=t.call(this,u,{width:a,height:l})||this,h&&n.initFromArray(h,r),n}return e.prototype.addBaseTextureAt=function(i,r){if(i.resource)this.addResourceAt(i.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this},e.prototype.bind=function(i){t.prototype.bind.call(this,i),i.target=el.TEXTURE_2D_ARRAY},e.prototype.upload=function(i,r,n){var o=this,a=o.length,l=o.itemDirtyIds,h=o.items,u=i.gl;n.dirtyId<0&&u.texImage3D(u.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,a,0,r.format,n.type,null);for(var c=0;c<a;c++){var f=h[c];l[c]<f.dirtyId&&(l[c]=f.dirtyId,f.valid&&u.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,c,f.resource.width,f.resource.height,1,r.format,n.type,f.resource.source))}return!0},e}(tC),aa=function(t){ni(e,t);function e(i){var r=this,n=i,o=n.naturalWidth||n.videoWidth||n.width,a=n.naturalHeight||n.videoHeight||n.height;return r=t.call(this,o,a)||this,r.source=i,r.noSubImage=!1,r}return e.crossOrigin=function(i,r,n){n===void 0&&r.indexOf("data:")!==0?i.crossOrigin=IS(r):n!==!1&&(i.crossOrigin=typeof n=="string"?n:"anonymous")},e.prototype.upload=function(i,r,n,o){var a=i.gl,l=r.realWidth,h=r.realHeight;if(o=o||this.source,o instanceof HTMLImageElement){if(!o.complete||o.naturalWidth===0)return!1}else if(o instanceof HTMLVideoElement&&o.readyState<=1)return!1;return a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===_n.UNPACK),!this.noSubImage&&r.target===a.TEXTURE_2D&&n.width===l&&n.height===h?a.texSubImage2D(a.TEXTURE_2D,0,0,0,r.format,n.type,o):(n.width=l,n.height=h,a.texImage2D(r.target,0,n.internalFormat,r.format,n.type,o)),!0},e.prototype.update=function(){if(!this.destroyed){var i=this.source,r=i.naturalWidth||i.videoWidth||i.width,n=i.naturalHeight||i.videoHeight||i.height;this.resize(r,n),t.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(tc),lN=function(t){ni(e,t);function e(i){return t.call(this,i)||this}return e.test=function(i){var r=globalThis.OffscreenCanvas;return r&&i instanceof r?!0:globalThis.HTMLCanvasElement&&i instanceof HTMLCanvasElement},e}(aa),hN=function(t){ni(e,t);function e(i,r){var n=this,o=r||{},a=o.width,l=o.height,h=o.autoLoad,u=o.linkBaseTexture;if(i&&i.length!==e.SIDES)throw new Error("Invalid length. Got "+i.length+", expected 6");n=t.call(this,6,{width:a,height:l})||this;for(var c=0;c<e.SIDES;c++)n.items[c].target=el.TEXTURE_CUBE_MAP_POSITIVE_X+c;return n.linkBaseTexture=u!==!1,i&&n.initFromArray(i,r),h!==!1&&n.load(),n}return e.prototype.bind=function(i){t.prototype.bind.call(this,i),i.target=el.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(i,r,n){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,r);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=el.TEXTURE_CUBE_MAP_POSITIVE_X+r,i.parentTextureArray=this.baseTexture,this.items[r]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[r]=i,this},e.prototype.upload=function(i,r,n){for(var o=this.itemDirtyIds,a=0;a<e.SIDES;a++){var l=this.items[a];(o[a]<l.dirtyId||n.dirtyId<r.dirtyId)&&(l.valid&&l.resource?(l.resource.upload(i,l,n),o[a]=l.dirtyId):o[a]<-1&&(i.gl.texImage2D(l.target,0,n.internalFormat,r.realWidth,r.realHeight,0,r.format,n.type,null),o[a]=-1))}return!0},e.test=function(i){return Array.isArray(i)&&i.length===e.SIDES},e.SIDES=6,e}(tC),iC=function(t){ni(e,t);function e(i,r){var n=this;if(r=r||{},!(i instanceof HTMLImageElement)){var o=new Image;aa.crossOrigin(o,i,r.crossorigin),o.src=i,i=o}return n=t.call(this,i)||this,!i.complete&&n._width&&n._height&&(n._width=0,n._height=0),n.url=i.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(r.createBitmap!==void 0?r.createBitmap:Fe.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,n.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,n.bitmap=null,n._load=null,r.autoLoad!==!1&&n.load(),n}return e.prototype.load=function(i){var r=this;return this._load?this._load:(i!==void 0&&(this.createBitmap=i),this._load=new Promise(function(n,o){var a=r.source;r.url=a.src;var l=function(){r.destroyed||(a.onload=null,a.onerror=null,r.resize(a.width,a.height),r._load=null,r.createBitmap?n(r.process()):n(r))};a.complete&&a.src?l():(a.onload=l,a.onerror=function(h){o(h),r.onError.emit(h)})}),this._load)},e.prototype.process=function(){var i=this,r=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var n=globalThis.createImageBitmap,o=!r.crossOrigin||r.crossOrigin==="anonymous";return this._process=fetch(r.src,{mode:o?"cors":"no-cors"}).then(function(a){return a.blob()}).then(function(a){return n(a,0,0,r.width,r.height,{premultiplyAlpha:i.alphaMode===null||i.alphaMode===_n.UNPACK?"premultiply":"none"})}).then(function(a){return i.destroyed?Promise.reject():(i.bitmap=a,i.update(),i._process=null,Promise.resolve(i))}),this._process},e.prototype.upload=function(i,r,n){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,i,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,i,r,n,this.bitmap),!this.preserveBitmap){var o=!0,a=r._glTextures;for(var l in a){var h=a[l];if(h!==n&&h.dirtyId!==r.dirtyId){o=!1;break}}o&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(i){return typeof i=="string"||i instanceof HTMLImageElement},e}(aa),uN=function(t){ni(e,t);function e(i,r){var n=this;return r=r||{},n=t.call(this,Fe.ADAPTER.createCanvas())||this,n._width=0,n._height=0,n.svg=i,n.scale=r.scale||1,n._overrideWidth=r.width,n._overrideHeight=r.height,n._resolve=null,n._crossorigin=r.crossorigin,n._load=null,r.autoLoad!==!1&&n.load(),n}return e.prototype.load=function(){var i=this;return this._load?this._load:(this._load=new Promise(function(r){if(i._resolve=function(){i.resize(i.source.width,i.source.height),r(i)},e.SVG_XML.test(i.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");i.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i.svg)))}i._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var i=this,r=new Image;aa.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(n){i._resolve&&(r.onerror=null,i.onError.emit(n))},r.onload=function(){if(i._resolve){var n=r.width,o=r.height;if(!n||!o)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var a=n*i.scale,l=o*i.scale;(i._overrideWidth||i._overrideHeight)&&(a=i._overrideWidth||i._overrideHeight/o*n,l=i._overrideHeight||i._overrideWidth/n*o),a=Math.round(a),l=Math.round(l);var h=i.source;h.width=a,h.height=l,h._pixiId="canvas_"+Co(),h.getContext("2d").drawImage(r,0,0,n,o,0,0,a,l),i._resolve(),i._resolve=null}}},e.getSize=function(i){var r=e.SVG_SIZE.exec(i),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(i,r){return r==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&e.SVG_XML.test(i)},e.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(aa),cN=function(t){ni(e,t);function e(i,r){var n=this;if(r=r||{},!(i instanceof HTMLVideoElement)){var o=document.createElement("video");o.setAttribute("preload","auto"),o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);var a=i[0].src||i[0];aa.crossOrigin(o,a,r.crossorigin);for(var l=0;l<i.length;++l){var h=document.createElement("source"),u=i[l],c=u.src,f=u.mime;c=c||i[l];var d=c.split("?").shift().toLowerCase(),m=d.slice(d.lastIndexOf(".")+1);f=f||e.MIME_TYPES[m]||"video/"+m,h.src=c,h.type=f,o.appendChild(h)}i=o}return n=t.call(this,i)||this,n.noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=r.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=r.autoPlay!==!1,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),r.autoLoad!==!1&&n.load(),n}return e.prototype.update=function(i){if(!this.destroyed){var r=Bi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var i=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(function(n){i.valid?n(i):(i._resolve=n,r.load())}),this._load},e.prototype._onError=function(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)},e.prototype._isSourcePlaying=function(){var i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()},e.prototype._isSourceReady=function(){var i=this.source;return i.readyState>2},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Bi.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Bi.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);var r=this.valid;this.resize(i.videoWidth,i.videoHeight),!r&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&(Bi.shared.remove(this.update,this),this._isConnectedToTicker=!1);var i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(Bi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Bi.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(i){i!==this._updateFPS&&(this._updateFPS=i)},enumerable:!1,configurable:!0}),e.test=function(i,r){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(aa),fN=function(t){ni(e,t);function e(i){return t.call(this,i)||this}return e.test=function(i){return!!globalThis.createImageBitmap&&typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap},e}(aa);s_.push(iC,fN,lN,cN,uN,lh,hN,aN);var dN={__proto__:null,Resource:tc,BaseImageResource:aa,INSTALLED:s_,autoDetectResource:eC,AbstractMultiResource:tC,ArrayResource:aN,BufferResource:lh,CanvasResource:lN,CubeResource:hN,ImageResource:iC,SVGResource:uN,VideoResource:cN,ImageBitmapResource:fN},fJ=function(t){ni(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.upload=function(i,r,n){var o=i.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===_n.UNPACK);var a=r.realWidth,l=r.realHeight;return n.width===a&&n.height===l?o.texSubImage2D(r.target,0,0,0,a,l,r.format,n.type,this.data):(n.width=a,n.height=l,o.texImage2D(r.target,0,n.internalFormat,a,l,0,r.format,n.type,this.data)),!0},e}(lh),$S=function(){function t(e,i){this.width=Math.round(e||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new gr("disposeFramebuffer"),this.multisample=ai.NONE}return Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),t.prototype.addColorTexture=function(e,i){return e===void 0&&(e=0),this.colorTextures[e]=i||new At(null,{scaleMode:cs.NEAREST,resolution:1,mipmap:$r.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.addDepthTexture=function(e){return this.depthTexture=e||new At(new fJ(null,{width:this.width,height:this.height}),{scaleMode:cs.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:$r.OFF,format:Oe.DEPTH_COMPONENT,type:ht.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.resize=function(e,i){if(e=Math.round(e),i=Math.round(i),!(e===this.width&&i===this.height)){this.width=e,this.height=i,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var n=this.colorTextures[r],o=n.resolution;n.setSize(e/o,i/o)}if(this.depthTexture){var o=this.depthTexture.resolution;this.depthTexture.setSize(e/o,i/o)}}},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},t}(),pN=function(t){ni(e,t);function e(i){i===void 0&&(i={});var r=this;if(typeof i=="number"){var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];i={width:n,height:o,scaleMode:a,resolution:l}}return i.width=i.width||100,i.height=i.height||100,i.multisample=i.multisample!==void 0?i.multisample:ai.NONE,r=t.call(this,null,i)||this,r.mipmap=$r.OFF,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new $S(r.realWidth,r.realHeight).addColorTexture(0,r),r.framebuffer.multisample=i.multisample,r.maskStack=[],r.filterStack=[{}],r}return e.prototype.resize=function(i,r){this.framebuffer.resize(i*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(At),mN=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(e,i,r){var n=i.width,o=i.height;if(r){var a=e.width/2/n,l=e.height/2/o,h=e.x/n+a,u=e.y/o+l;r=ci.add(r,ci.NW),this.x0=h+a*ci.uX(r),this.y0=u+l*ci.uY(r),r=ci.add(r,2),this.x1=h+a*ci.uX(r),this.y1=u+l*ci.uY(r),r=ci.add(r,2),this.x2=h+a*ci.uX(r),this.y2=u+l*ci.uY(r),r=ci.add(r,2),this.x3=h+a*ci.uX(r),this.y3=u+l*ci.uY(r)}else this.x0=e.x/n,this.y0=e.y/o,this.x1=(e.x+e.width)/n,this.y1=e.y/o,this.x2=(e.x+e.width)/n,this.y2=(e.y+e.height)/o,this.x3=e.x/n,this.y3=(e.y+e.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},t}(),Y5=new mN;function $0(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}var lt=function(t){ni(e,t);function e(i,r,n,o,a,l){var h=t.call(this)||this;if(h.noFrame=!1,r||(h.noFrame=!0,r=new Tt(0,0,1,1)),i instanceof e&&(i=i.baseTexture),h.baseTexture=i,h._frame=r,h.trim=o,h.valid=!1,h._uvs=Y5,h.uvMatrix=null,h.orig=n||r,h._rotate=Number(a||0),a===!0)h._rotate=2;else if(h._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return h.defaultAnchor=l?new Ht(l.x,l.y):new Ht(0,0),h._updateID=0,h.textureCacheIds=[],i.valid?h.noFrame?i.valid&&h.onBaseTextureUpdated(i):h.frame=r:i.once("loaded",h.onBaseTextureUpdated,h),h.noFrame&&i.on("update",h.onBaseTextureUpdated,h),h}return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(i){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=i.width,this._frame.height=i.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(i){if(this.baseTexture){if(i){var r=this.baseTexture.resource;r&&r.url&&rn[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var i=this._frame.clone(),r=this._frame===this.orig?i:this.orig.clone(),n=new e(this.baseTexture,!this.noFrame&&i,r,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=i),n},e.prototype.updateUvs=function(){this._uvs===Y5&&(this._uvs=new mN),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(i,r,n){r===void 0&&(r={}),n===void 0&&(n=Fe.STRICT_TEXTURE_CACHE);var o=typeof i=="string",a=null;if(o)a=i;else if(i instanceof At){if(!i.cacheId){var l=r&&r.pixiIdPrefix||"pixiid";i.cacheId=l+"-"+Co(),At.addToCache(i,i.cacheId)}a=i.cacheId}else{if(!i._pixiId){var l=r&&r.pixiIdPrefix||"pixiid";i._pixiId=l+"_"+Co()}a=i._pixiId}var h=rn[a];if(o&&n&&!h)throw new Error('The cacheId "'+a+'" does not exist in TextureCache.');return!h&&!(i instanceof At)?(r.resolution||(r.resolution=tl(i)),h=new e(new At(i,r)),h.baseTexture.cacheId=a,At.addToCache(h.baseTexture,a),e.addToCache(h,a)):!h&&i instanceof At&&(h=new e(i),e.addToCache(h,a)),h},e.fromURL=function(i,r){var n=Object.assign({autoLoad:!1},r==null?void 0:r.resourceOptions),o=e.from(i,Object.assign({resourceOptions:n},r),!1),a=o.baseTexture.resource;return o.baseTexture.valid?Promise.resolve(o):a.load().then(function(){return Promise.resolve(o)})},e.fromBuffer=function(i,r,n,o){return new e(At.fromBuffer(i,r,n,o))},e.fromLoader=function(i,r,n,o){var a=new At(i,Object.assign({scaleMode:Fe.SCALE_MODE,resolution:tl(r)},o)),l=a.resource;l instanceof iC&&(l.url=r);var h=new e(a);return n||(n=r),At.addToCache(h.baseTexture,n),e.addToCache(h,n),n!==r&&(At.addToCache(h.baseTexture,r),e.addToCache(h,r)),h.baseTexture.valid?Promise.resolve(h):new Promise(function(u){h.baseTexture.once("loaded",function(){return u(h)})})},e.addToCache=function(i,r){r&&(i.textureCacheIds.indexOf(r)===-1&&i.textureCacheIds.push(r),rn[r]&&console.warn("Texture added to the cache with an id ["+r+"] that already had an entry"),rn[r]=i)},e.removeFromCache=function(i){if(typeof i=="string"){var r=rn[i];if(r){var n=r.textureCacheIds.indexOf(i);return n>-1&&r.textureCacheIds.splice(n,1),delete rn[i],r}}else if(i&&i.textureCacheIds){for(var o=0;o<i.textureCacheIds.length;++o)rn[i.textureCacheIds[o]]===i&&delete rn[i.textureCacheIds[o]];return i.textureCacheIds.length=0,i}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(i){this._frame=i,this.noFrame=!1;var r=i.x,n=i.y,o=i.width,a=i.height,l=r+o>this.baseTexture.width,h=n+a>this.baseTexture.height;if(l||h){var u=l&&h?"and":"or",c="X: "+r+" + "+o+" = "+(r+o)+" > "+this.baseTexture.width,f="Y: "+n+" + "+a+" = "+(n+a)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(c+" "+u+" "+f))}this.valid=o&&a&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=i),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(i){this._rotate=i,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},Object.defineProperty(e,"EMPTY",{get:function(){return e._EMPTY||(e._EMPTY=new e(new At),$0(e._EMPTY),$0(e._EMPTY.baseTexture)),e._EMPTY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"WHITE",{get:function(){if(!e._WHITE){var i=Fe.ADAPTER.createCanvas(16,16),r=i.getContext("2d");i.width=16,i.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),e._WHITE=new e(At.from(i)),$0(e._WHITE),$0(e._WHITE.baseTexture)}return e._WHITE},enumerable:!1,configurable:!0}),e}(Mo.default),la=function(t){ni(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(i){this.framebuffer.multisample=i},enumerable:!1,configurable:!0}),e.prototype.resize=function(i,r,n){n===void 0&&(n=!0);var o=this.baseTexture.resolution,a=Math.round(i*o)/o,l=Math.round(r*o)/o;this.valid=a>0&&l>0,this._frame.width=this.orig.width=a,this._frame.height=this.orig.height=l,n&&this.baseTexture.resize(a,l),this.updateUvs()},e.prototype.setResolution=function(i){var r=this.baseTexture;r.resolution!==i&&(r.setResolution(i),this.resize(r.width,r.height,!1))},e.create=function(i){for(var r=arguments,n=[],o=1;o<arguments.length;o++)n[o-1]=r[o];return typeof i=="number"&&(Yi("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),i={width:i,height:n[0],scaleMode:n[1],resolution:n[2]}),new e(new pN(i))},e}(lt),dJ=function(){function t(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(e,i,r){r===void 0&&(r=ai.NONE);var n=new pN(Object.assign({width:e,height:i,resolution:1,multisample:r},this.textureOptions));return new la(n)},t.prototype.getOptimalTexture=function(e,i,r,n){r===void 0&&(r=1),n===void 0&&(n=ai.NONE);var o;e=Math.ceil(e*r-1e-6),i=Math.ceil(i*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||i!==this._pixelsHeight?(e=Qu(e),i=Qu(i),o=((e&65535)<<16|i&65535)>>>0,n>1&&(o+=n*4294967296)):o=n>1?-n:-1,this.texturePool[o]||(this.texturePool[o]=[]);var a=this.texturePool[o].pop();return a||(a=this.createTexture(e,i,n)),a.filterPoolKey=o,a.setResolution(r),a},t.prototype.getFilterTexture=function(e,i,r){var n=this.getOptimalTexture(e.width,e.height,i||e.resolution,r||ai.NONE);return n.filterFrame=e.filterFrame,n},t.prototype.returnTexture=function(e){var i=e.filterPoolKey;e.filterFrame=null,this.texturePool[i].push(e)},t.prototype.returnFilterTexture=function(e){this.returnTexture(e)},t.prototype.clear=function(e){if(e=e!==!1,e)for(var i in this.texturePool){var r=this.texturePool[i];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(var i in this.texturePool)if(Number(i)<0){var r=this.texturePool[i];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}},t.SCREEN_KEY=-1,t}(),Z5=function(){function t(e,i,r,n,o,a,l){i===void 0&&(i=0),r===void 0&&(r=!1),n===void 0&&(n=ht.FLOAT),this.buffer=e,this.size=i,this.normalized=r,this.type=n,this.stride=o,this.start=a,this.instance=l}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,i,r,n,o){return new t(e,i,r,n,o)},t}(),pJ=0,Ni=function(){function t(e,i,r){i===void 0&&(i=!0),r===void 0&&(r=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=i,this.id=pJ++,this.disposeRunner=new gr("disposeBuffer")}return t.prototype.update=function(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(t.prototype,"index",{get:function(){return this.type===Bs.ELEMENT_ARRAY_BUFFER},set:function(e){this.type=e?Bs.ELEMENT_ARRAY_BUFFER:Bs.ARRAY_BUFFER},enumerable:!1,configurable:!0}),t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}(),mJ={Float32Array,Uint32Array,Int32Array,Uint8Array};function gJ(t,e){for(var i=0,r=0,n={},o=0;o<t.length;o++)r+=e[o],i+=t[o].length;for(var a=new ArrayBuffer(i*4),l=null,h=0,o=0;o<t.length;o++){var u=e[o],c=t[o],f=hd(c);n[f]||(n[f]=new mJ[f](a)),l=n[f];for(var d=0;d<c.length;d++){var m=(d/u|0)*r+h,v=d%u;l[m+v]=c[d]}h+=u}return new Float32Array(a)}var K5={5126:4,5123:2,5121:1},vJ=0,_J={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},hh=function(){function t(e,i){e===void 0&&(e=[]),i===void 0&&(i={}),this.buffers=e,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=vJ++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new gr("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(e,i,r,n,o,a,l,h){if(r===void 0&&(r=0),n===void 0&&(n=!1),h===void 0&&(h=!1),!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof Ni||(i instanceof Array&&(i=new Float32Array(i)),i=new Ni(i));var u=e.split("|");if(u.length>1){for(var c=0;c<u.length;c++)this.addAttribute(u[c],i,r,n,o);return this}var f=this.buffers.indexOf(i);return f===-1&&(this.buffers.push(i),f=this.buffers.length-1),this.attributes[e]=new Z5(f,r,n,o,a,l,h),this.instanced=this.instanced||h,this},t.prototype.getAttribute=function(e){return this.attributes[e]},t.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},t.prototype.addIndex=function(e){return e instanceof Ni||(e instanceof Array&&(e=new Uint16Array(e)),e=new Ni(e)),e.type=Bs.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.indexOf(e)===-1&&this.buffers.push(e),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var e=[],i=[],r=new Ni,n;for(n in this.attributes){var o=this.attributes[n],a=this.buffers[o.buffer];e.push(a.data),i.push(o.size*K5[o.type]/4),o.buffer=0}for(r.data=gJ(e,i),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var e in this.attributes){var i=this.attributes[e],r=this.buffers[i.buffer];return r.data.length/(i.stride/4||i.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,i=0;i<this.buffers.length;i++)e.buffers[i]=new Ni(this.buffers[i].data.slice(0));for(var i in this.attributes){var r=this.attributes[i];e.attributes[i]=new Z5(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=Bs.ELEMENT_ARRAY_BUFFER),e},t.merge=function(e){for(var i=new t,r=[],n=[],o=[],a,l=0;l<e.length;l++){a=e[l];for(var h=0;h<a.buffers.length;h++)n[h]=n[h]||0,n[h]+=a.buffers[h].data.length,o[h]=0}for(var l=0;l<a.buffers.length;l++)r[l]=new _J[hd(a.buffers[l].data)](n[l]),i.buffers[l]=new Ni(r[l]);for(var l=0;l<e.length;l++){a=e[l];for(var h=0;h<a.buffers.length;h++)r[h].set(a.buffers[h].data,o[h]),o[h]+=a.buffers[h].data.length}if(i.attributes=a.attributes,a.indexBuffer){i.indexBuffer=i.buffers[a.buffers.indexOf(a.indexBuffer)],i.indexBuffer.type=Bs.ELEMENT_ARRAY_BUFFER;for(var u=0,c=0,f=0,d=0,l=0;l<a.buffers.length;l++)if(a.buffers[l]!==a.indexBuffer){d=l;break}for(var l in a.attributes){var m=a.attributes[l];(m.buffer|0)===d&&(c+=m.size*K5[m.type]/4)}for(var l=0;l<e.length;l++){for(var v=e[l].indexBuffer.data,h=0;h<v.length;h++)i.indexBuffer.data[h+f]+=u;u+=e[l].buffers[d].data.length/c,f+=v.length}}return i},t}(),yJ=function(t){ni(e,t);function e(){var i=t.call(this)||this;return i.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),i}return e}(hh),rC=function(t){ni(e,t);function e(){var i=t.call(this)||this;return i.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),i.uvs=new Float32Array([0,0,1,0,1,1,0,1]),i.vertexBuffer=new Ni(i.vertices),i.uvBuffer=new Ni(i.uvs),i.addAttribute("aVertexPosition",i.vertexBuffer).addAttribute("aTextureCoord",i.uvBuffer).addIndex([0,1,2,0,2,3]),i}return e.prototype.map=function(i,r){var n=0,o=0;return this.uvs[0]=n,this.uvs[1]=o,this.uvs[2]=n+r.width/i.width,this.uvs[3]=o,this.uvs[4]=n+r.width/i.width,this.uvs[5]=o+r.height/i.height,this.uvs[6]=n,this.uvs[7]=o+r.height/i.height,n=r.x,o=r.y,this.vertices[0]=n,this.vertices[1]=o,this.vertices[2]=n+r.width,this.vertices[3]=o,this.vertices[4]=n+r.width,this.vertices[5]=o+r.height,this.vertices[6]=n,this.vertices[7]=o+r.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(hh),xJ=0,nl=function(){function t(e,i,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=xJ++,this.static=!!i,this.ubo=!!r,e instanceof Ni?(this.buffer=e,this.buffer.type=Bs.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Ni(new Float32Array(1)),this.buffer.type=Bs.UNIFORM_BUFFER,this.autoManage=!0))}return t.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},t.prototype.add=function(e,i,r){if(!this.ubo)this.uniforms[e]=new t(i,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},t.from=function(e,i,r){return new t(e,i,r)},t.uboFrom=function(e,i){return new t(e,i!=null?i:!0,!0)},t}(),bJ=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ai.NONE,this.sourceFrame=new Tt,this.destinationFrame=new Tt,this.bindingSourceFrame=new Tt,this.bindingDestinationFrame=new Tt,this.filters=[],this.transform=null}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),e_=[new Ht,new Ht,new Ht,new Ht],GS=new Zt,gN=function(){function t(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new dJ,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new yJ,this.quadUv=new rC,this.tempRect=new Tt,this.activeState={},this.globalUniforms=new nl({outputFrame:new Tt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return t.prototype.push=function(e,i){for(var r,n,o=this.renderer,a=this.defaultFilterStack,l=this.statePool.pop()||new bJ,h=this.renderer.renderTexture,u=i[0].resolution,c=i[0].multisample,f=i[0].padding,d=i[0].autoFit,m=(r=i[0].legacy)!==null&&r!==void 0?r:!0,v=1;v<i.length;v++){var g=i[v];u=Math.min(u,g.resolution),c=Math.min(c,g.multisample),f=this.useMaxPadding?Math.max(f,g.padding):f+g.padding,d=d&&g.autoFit,m=m||((n=g.legacy)!==null&&n!==void 0?n:!0)}a.length===1&&(this.defaultFilterStack[0].renderTexture=h.current),a.push(l),l.resolution=u,l.multisample=c,l.legacy=m,l.target=e,l.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),l.sourceFrame.pad(f);var p=this.tempRect.copyFrom(h.sourceFrame);o.projection.transform&&this.transformAABB(GS.copyFrom(o.projection.transform).invert(),p),d?(l.sourceFrame.fit(p),(l.sourceFrame.width<=0||l.sourceFrame.height<=0)&&(l.sourceFrame.width=0,l.sourceFrame.height=0)):l.sourceFrame.intersects(p)||(l.sourceFrame.width=0,l.sourceFrame.height=0),this.roundFrame(l.sourceFrame,h.current?h.current.resolution:o.resolution,h.sourceFrame,h.destinationFrame,o.projection.transform),l.renderTexture=this.getOptimalFilterTexture(l.sourceFrame.width,l.sourceFrame.height,u,c),l.filters=i,l.destinationFrame.width=l.renderTexture.width,l.destinationFrame.height=l.renderTexture.height;var _=this.tempRect;_.x=0,_.y=0,_.width=l.sourceFrame.width,_.height=l.sourceFrame.height,l.renderTexture.filterFrame=l.sourceFrame,l.bindingSourceFrame.copyFrom(h.sourceFrame),l.bindingDestinationFrame.copyFrom(h.destinationFrame),l.transform=o.projection.transform,o.projection.transform=null,h.bind(l.renderTexture,l.sourceFrame,_),o.framebuffer.clear(0,0,0,0)},t.prototype.pop=function(){var e=this.defaultFilterStack,i=e.pop(),r=i.filters;this.activeState=i;var n=this.globalUniforms.uniforms;n.outputFrame=i.sourceFrame,n.resolution=i.resolution;var o=n.inputSize,a=n.inputPixel,l=n.inputClamp;if(o[0]=i.destinationFrame.width,o[1]=i.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],a[0]=Math.round(o[0]*i.resolution),a[1]=Math.round(o[1]*i.resolution),a[2]=1/a[0],a[3]=1/a[1],l[0]=.5*a[2],l[1]=.5*a[3],l[2]=i.sourceFrame.width*o[2]-.5*a[2],l[3]=i.sourceFrame.height*o[3]-.5*a[3],i.legacy){var h=n.filterArea;h[0]=i.destinationFrame.width,h[1]=i.destinationFrame.height,h[2]=i.sourceFrame.x,h[3]=i.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var u=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,i.renderTexture,u.renderTexture,Fn.BLEND,i),this.returnFilterTexture(i.renderTexture);else{var c=i.renderTexture,f=this.getOptimalFilterTexture(c.width,c.height,i.resolution);f.filterFrame=c.filterFrame;var d=0;for(d=0;d<r.length-1;++d){d===1&&i.multisample>1&&(f=this.getOptimalFilterTexture(c.width,c.height,i.resolution),f.filterFrame=c.filterFrame),r[d].apply(this,c,f,Fn.CLEAR,i);var m=c;c=f,f=m}r[d].apply(this,c,u.renderTexture,Fn.BLEND,i),d>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(f)}i.clear(),this.statePool.push(i)},t.prototype.bindAndClear=function(e,i){i===void 0&&(i=Fn.CLEAR);var r=this.renderer,n=r.renderTexture,o=r.state;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e&&e.filterFrame){var a=this.tempRect;a.x=0,a.y=0,a.width=e.filterFrame.width,a.height=e.filterFrame.height,n.bind(e,e.filterFrame,a)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var l=o.stateId&1||this.forceClear;(i===Fn.CLEAR||i===Fn.BLIT&&l)&&this.renderer.framebuffer.clear(0,0,0,0)},t.prototype.applyFilter=function(e,i,r,n){var o=this.renderer;o.state.set(e.state),this.bindAndClear(r,n),e.uniforms.uSampler=i,e.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(i._frame,i.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(vn.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(vn.TRIANGLE_STRIP))},t.prototype.calculateSpriteMatrix=function(e,i){var r=this.activeState,n=r.sourceFrame,o=r.destinationFrame,a=i._texture.orig,l=e.set(o.width,0,0,o.height,n.x,n.y),h=i.worldTransform.copyTo(Zt.TEMP_MATRIX);return h.invert(),l.prepend(h),l.scale(1/a.width,1/a.height),l.translate(i.anchor.x,i.anchor.y),l},t.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},t.prototype.getOptimalFilterTexture=function(e,i,r,n){return r===void 0&&(r=1),n===void 0&&(n=ai.NONE),this.texturePool.getOptimalTexture(e,i,r,n)},t.prototype.getFilterTexture=function(e,i,r){if(typeof e=="number"){var n=e;e=i,i=n}e=e||this.activeState.renderTexture;var o=this.texturePool.getOptimalTexture(e.width,e.height,i||e.resolution,r||ai.NONE);return o.filterFrame=e.filterFrame,o},t.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},t.prototype.emptyPool=function(){this.texturePool.clear(!0)},t.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},t.prototype.transformAABB=function(e,i){var r=e_[0],n=e_[1],o=e_[2],a=e_[3];r.set(i.left,i.top),n.set(i.left,i.bottom),o.set(i.right,i.top),a.set(i.right,i.bottom),e.apply(r,r),e.apply(n,n),e.apply(o,o),e.apply(a,a);var l=Math.min(r.x,n.x,o.x,a.x),h=Math.min(r.y,n.y,o.y,a.y),u=Math.max(r.x,n.x,o.x,a.x),c=Math.max(r.y,n.y,o.y,a.y);i.x=l,i.y=h,i.width=u-l,i.height=c-h},t.prototype.roundFrame=function(e,i,r,n,o){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(o){var a=o.a,l=o.b,h=o.c,u=o.d;if((Math.abs(l)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(u)>1e-4))return}o=o?GS.copyFrom(o):GS.identity(),o.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(o,e),e.ceil(i),this.transformAABB(o.invert(),e)}},t}(),ic=function(){function t(e){this.renderer=e}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(e){},t}(),vN=function(){function t(e){this.renderer=e,this.emptyRenderer=new ic(e),this.currentRenderer=this.emptyRenderer}return t.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},t.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.copyBoundTextures=function(e,i){for(var r=this.renderer.texture.boundTextures,n=i-1;n>=0;--n)e[n]=r[n]||null,e[n]&&(e[n]._batchLocation=n)},t.prototype.boundArray=function(e,i,r,n){for(var o=e.elements,a=e.ids,l=e.count,h=0,u=0;u<l;u++){var c=o[u],f=c._batchLocation;if(f>=0&&f<n&&i[f]===c){a[u]=f;continue}for(;h<n;){var d=i[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}a[u]=h,c._batchLocation=h,i[h]=c;break}}},t.prototype.destroy=function(){this.renderer=null},t}(),Q5=0,_N=function(){function t(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(t.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),t.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=Q5++,e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext()},t.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=Q5++,this.renderer.runners.contextChange.emit(e)},t.prototype.initFromOptions=function(e){var i=this.createContext(this.renderer.view,e);this.initFromContext(i)},t.prototype.createContext=function(e,i){var r;if(Fe.PREFER_ENV>=wo.WEBGL2&&(r=e.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl},t.prototype.getExtensions=function(){var e=this.gl,i={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),loseContext:e.getExtension("WEBGL_lose_context"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})},t.prototype.handleContextLost=function(e){e.preventDefault()},t.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},t.prototype.destroy=function(){var e=this.renderer.view;this.renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},t.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},t.prototype.validateContext=function(e){var i=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var n=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},t}(),wJ=function(){function t(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ai.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return t}(),SJ=new Tt,yN=function(){function t(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new $S(10,10),this.msaaSamples=null}return t.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Tt,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){var i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;Fe.PREFER_ENV===wo.WEBGL_LEGACY&&(i=null,r=null),i?e.drawBuffers=function(n){return i.drawBuffersWEBGL(n)}:(this.hasMRT=!1,e.drawBuffers=function(){}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},t.prototype.bind=function(e,i,r){r===void 0&&(r=0);var n=this.gl;if(e){var o=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,n.bindFramebuffer(n.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,o.mipLevel=r),o.dirtyId!==e.dirtyId&&(o.dirtyId=e.dirtyId,o.dirtyFormat!==e.dirtyFormat?(o.dirtyFormat=e.dirtyFormat,o.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):o.dirtySize!==e.dirtySize&&(o.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var a=0;a<e.colorTextures.length;a++){var l=e.colorTextures[a];this.renderer.texture.unbind(l.parentTextureArray||l)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),i){var h=i.width>>r,u=i.height>>r,c=h/i.width;this.setViewport(i.x*c,i.y*c,h,u)}else{var h=e.width>>r,u=e.height>>r;this.setViewport(0,0,h,u)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},t.prototype.setViewport=function(e,i,r,n){var o=this.viewport;e=Math.round(e),i=Math.round(i),r=Math.round(r),n=Math.round(n),(o.width!==r||o.height!==n||o.x!==e||o.y!==i)&&(o.x=e,o.y=i,o.width=r,o.height=n,this.gl.viewport(e,i,r,n))},Object.defineProperty(t.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),t.prototype.clear=function(e,i,r,n,o){o===void 0&&(o=Kf.COLOR|Kf.DEPTH);var a=this.gl;a.clearColor(e,i,r,n),a.clear(o)},t.prototype.initFramebuffer=function(e){var i=this.gl,r=new wJ(i.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r},t.prototype.resizeFramebuffer=function(e){var i=this.gl,r=e.glFramebuffers[this.CONTEXT_UID];r.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.RGBA8,e.width,e.height)),r.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height));var n=e.colorTextures,o=n.length;i.drawBuffers||(o=Math.min(o,1));for(var a=0;a<o;a++){var l=n[a],h=l.parentTextureArray||l;this.renderer.texture.bind(h,0)}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)},t.prototype.updateFramebuffer=function(e,i){var r=this.gl,n=e.glFramebuffers[this.CONTEXT_UID],o=e.colorTextures,a=o.length;r.drawBuffers||(a=Math.min(a,1)),n.multisample>1&&this.canMultisampleFramebuffer(e)?(n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.RGBA8,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));for(var l=[],h=0;h<a;h++){var u=o[h],c=u.parentTextureArray||u;this.renderer.texture.bind(c,0),!(h===0&&n.msaaBuffer)&&(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,u.target,c._glTextures[this.CONTEXT_UID].texture,i),l.push(r.COLOR_ATTACHMENT0+h))}if(l.length>1&&r.drawBuffers(l),e.depthTexture){var f=this.writeDepthTexture;if(f){var d=e.depthTexture;this.renderer.texture.bind(d,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,d._glTextures[this.CONTEXT_UID].texture,i)}}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil)):n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)},t.prototype.canMultisampleFramebuffer=function(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture},t.prototype.detectSamples=function(e){var i=this.msaaSamples,r=ai.NONE;if(e<=1||i===null)return r;for(var n=0;n<i.length;n++)if(i[n]<=e){r=i[n];break}return r===1&&(r=ai.NONE),r},t.prototype.blit=function(e,i,r){var n=this,o=n.current,a=n.renderer,l=n.gl,h=n.CONTEXT_UID;if(a.context.webGLVersion===2&&o){var u=o.glFramebuffers[h];if(u){if(!e){if(!u.msaaBuffer)return;var c=o.colorTextures[0];if(!c)return;u.blitFramebuffer||(u.blitFramebuffer=new $S(o.width,o.height),u.blitFramebuffer.addColorTexture(0,c)),e=u.blitFramebuffer,e.colorTextures[0]!==c&&(e.colorTextures[0]=c,e.dirtyId++,e.dirtyFormat++),(e.width!==o.width||e.height!==o.height)&&(e.width=o.width,e.height=o.height,e.dirtyId++,e.dirtySize++)}i||(i=SJ,i.width=o.width,i.height=o.height),r||(r=i);var f=i.width===r.width&&i.height===r.height;this.bind(e),l.bindFramebuffer(l.READ_FRAMEBUFFER,u.framebuffer),l.blitFramebuffer(i.left,i.top,i.right,i.bottom,r.left,r.top,r.right,r.bottom,l.COLOR_BUFFER_BIT,f?l.NEAREST:l.LINEAR)}}},t.prototype.disposeFramebuffer=function(e,i){var r=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(r){delete e.glFramebuffers[this.CONTEXT_UID];var o=this.managedFramebuffers.indexOf(e);o>=0&&this.managedFramebuffers.splice(o,1),e.disposeRunner.remove(this),i||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}},t.prototype.disposeAll=function(e){var i=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<i.length;r++)this.disposeFramebuffer(i[r],e)},t.prototype.forceStencil=function(){var e=this.current;if(e){var i=e.glFramebuffers[this.CONTEXT_UID];if(!(!i||i.stencil)){e.stencil=!0;var r=e.width,n=e.height,o=this.gl,a=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,a),i.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,i.multisample,o.DEPTH24_STENCIL8,r,n):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,r,n),i.stencil=a,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,a)}}},t.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Tt},t.prototype.destroy=function(){this.renderer=null},t}(),zS={5126:4,5123:2,5121:1},xN=function(){function t(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return t.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){var r=this.renderer.context.extensions.vertexArrayObject;Fe.PREFER_ENV===wo.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=function(){return r.createVertexArrayOES()},e.bindVertexArray=function(o){return r.bindVertexArrayOES(o)},e.deleteVertexArray=function(o){return r.deleteVertexArrayOES(o)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(i.webGLVersion!==2){var n=e.getExtension("ANGLE_instanced_arrays");n?(e.vertexAttribDivisor=function(o,a){return n.vertexAttribDivisorANGLE(o,a)},e.drawElementsInstanced=function(o,a,l,h,u){return n.drawElementsInstancedANGLE(o,a,l,h,u)},e.drawArraysInstanced=function(o,a,l,h){return n.drawArraysInstancedANGLE(o,a,l,h)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex},t.prototype.bind=function(e,i){i=i||this.renderer.shader.shader;var r=this.gl,n=e.glVertexArrayObjects[this.CONTEXT_UID],o=!1;n||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=n={},o=!0);var a=n[i.program.id]||this.initGeometryVao(e,i,o);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(e,i.program)),this.updateBuffers()},t.prototype.reset=function(){this.unbind()},t.prototype.updateBuffers=function(){for(var e=this._activeGeometry,i=this.renderer.buffer,r=0;r<e.buffers.length;r++){var n=e.buffers[r];i.update(n)}},t.prototype.checkCompatibility=function(e,i){var r=e.attributes,n=i.attributeData;for(var o in n)if(!r[o])throw new Error('shader and geometry incompatible, geometry missing the "'+o+'" attribute')},t.prototype.getSignature=function(e,i){var r=e.attributes,n=i.attributeData,o=["g",e.id];for(var a in r)n[a]&&o.push(a,n[a].location);return o.join("-")},t.prototype.initGeometryVao=function(e,i,r){r===void 0&&(r=!0);var n=this.gl,o=this.CONTEXT_UID,a=this.renderer.buffer,l=i.program;l.glPrograms[o]||this.renderer.shader.generateProgram(i),this.checkCompatibility(e,l);var h=this.getSignature(e,l),u=e.glVertexArrayObjects[this.CONTEXT_UID],c=u[h];if(c)return u[l.id]=c,c;var f=e.buffers,d=e.attributes,m={},v={};for(var g in f)m[g]=0,v[g]=0;for(var g in d)!d[g].size&&l.attributeData[g]?d[g].size=l.attributeData[g].size:d[g].size||console.warn("PIXI Geometry attribute '"+g+"' size cannot be determined (likely the bound shader does not have the attribute)"),m[d[g].buffer]+=d[g].size*zS[d[g].type];for(var g in d){var p=d[g],_=p.size;p.stride===void 0&&(m[p.buffer]===_*zS[p.type]?p.stride=0:p.stride=m[p.buffer]),p.start===void 0&&(p.start=v[p.buffer],v[p.buffer]+=_*zS[p.type])}c=n.createVertexArray(),n.bindVertexArray(c);for(var x=0;x<f.length;x++){var b=f[x];a.bind(b),r&&b._glBuffers[o].refCount++}return this.activateVao(e,l),this._activeVao=c,u[l.id]=c,u[h]=c,c},t.prototype.disposeGeometry=function(e,i){var r;if(this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var n=e.glVertexArrayObjects[this.CONTEXT_UID],o=this.gl,a=e.buffers,l=(r=this.renderer)===null||r===void 0?void 0:r.buffer;if(e.disposeRunner.remove(this),!!n){if(l)for(var h=0;h<a.length;h++){var u=a[h]._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!i&&l.dispose(a[h],i))}if(!i){for(var c in n)if(c[0]==="g"){var f=n[c];this._activeVao===f&&this.unbind(),o.deleteVertexArray(f)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},t.prototype.disposeAll=function(e){for(var i=Object.keys(this.managedGeometries),r=0;r<i.length;r++)this.disposeGeometry(this.managedGeometries[i[r]],e)},t.prototype.activateVao=function(e,i){var r=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=e.buffers,l=e.attributes;e.indexBuffer&&o.bind(e.indexBuffer);var h=null;for(var u in l){var c=l[u],f=a[c.buffer],d=f._glBuffers[n];if(i.attributeData[u]){h!==d&&(o.bind(f),h=d);var m=i.attributeData[u].location;if(r.enableVertexAttribArray(m),r.vertexAttribPointer(m,c.size,c.type||r.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)r.vertexAttribDivisor(m,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},t.prototype.draw=function(e,i,r,n){var o=this.gl,a=this._activeGeometry;if(a.indexBuffer){var l=a.indexBuffer.data.BYTES_PER_ELEMENT,h=l===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?a.instanced?o.drawElementsInstanced(e,i||a.indexBuffer.data.length,h,(r||0)*l,n||1):o.drawElements(e,i||a.indexBuffer.data.length,h,(r||0)*l):console.warn("unsupported index buffer type: uint32")}else a.instanced?o.drawArraysInstanced(e,r,i||a.getSize(),n||1):o.drawArrays(e,r,i||a.getSize());return this},t.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},t.prototype.destroy=function(){this.renderer=null},t}(),CJ=function(){function t(e){e===void 0&&(e=null),this.type=Pi.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Fe.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}return Object.defineProperty(t.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=Pi.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},t.prototype.copyCountersOrReset=function(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},t}();function J5(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function $5(t,e){var i=t.getShaderSource(e).split(`
`).map(function(u,c){return c+": "+u}),r=t.getShaderInfoLog(e),n=r.split(`
`),o={},a=n.map(function(u){return parseFloat(u.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(u){return u&&!o[u]?(o[u]=!0,!0):!1}),l=[""];a.forEach(function(u){i[u-1]="%c"+i[u-1]+"%c",l.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var h=i.join(`
`);l[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,l),console.groupEnd()}function MJ(t,e,i,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||$5(t,i),t.getShaderParameter(r,t.COMPILE_STATUS)||$5(t,r),console.error("PixiJS Error: Could not initialize shader."),t.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}function HS(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e}function bN(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return HS(2*e);case"bvec3":return HS(3*e);case"bvec4":return HS(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var wN={},dd=wN;function EJ(){if(dd===wN||dd&&dd.isContextLost()){var t=Fe.ADAPTER.createCanvas(),e=void 0;Fe.PREFER_ENV>=wo.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),dd=e}return dd}var t_;function TJ(){if(!t_){t_=en.MEDIUM;var t=EJ();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);t_=e.precision?en.HIGH:en.MEDIUM}}return t_}function eN(t,e,i){if(t.substring(0,9)!=="precision"){var r=e;return e===en.HIGH&&i!==en.HIGH&&(r=en.MEDIUM),"precision "+r+` float;
`+t}else if(i!==en.HIGH&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}var AJ={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function SN(t){return AJ[t]}var i_=null,tN={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function CN(t,e){if(!i_){var i=Object.keys(tN);i_={};for(var r=0;r<i.length;++r){var n=i[r];i_[t[n]]=tN[n]}}return i_[e]}var ec=[{test:function(t){return t.type==="float"&&t.size===1&&!t.isArray},code:function(t){return`
            if(uv["`+t+'"] !== ud["'+t+`"].value)
            {
                ud["`+t+'"].value = uv["'+t+`"]
                gl.uniform1f(ud["`+t+'"].location, uv["'+t+`"])
            }
            `}},{test:function(t,e){return(t.type==="sampler2D"||t.type==="samplerCube"||t.type==="sampler2DArray")&&t.size===1&&!t.isArray&&(e==null||e.castToBaseTexture!==void 0)},code:function(t){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+t+`"], t);

            if(ud["`+t+`"].value !== t)
            {
                ud["`+t+`"].value = t;
                gl.uniform1i(ud["`+t+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(t,e){return t.type==="mat3"&&t.size===1&&!t.isArray&&e.a!==void 0},code:function(t){return`
            gl.uniformMatrix3fv(ud["`+t+'"].location, false, uv["'+t+`"].toArray(true));
            `},codeUbo:function(t){return`
                var `+t+"_matrix = uv."+t+`.toArray(true);

                data[offset] = `+t+`_matrix[0];
                data[offset+1] = `+t+`_matrix[1];
                data[offset+2] = `+t+`_matrix[2];
        
                data[offset + 4] = `+t+`_matrix[3];
                data[offset + 5] = `+t+`_matrix[4];
                data[offset + 6] = `+t+`_matrix[5];
        
                data[offset + 8] = `+t+`_matrix[6];
                data[offset + 9] = `+t+`_matrix[7];
                data[offset + 10] = `+t+`_matrix[8];
            `}},{test:function(t,e){return t.type==="vec2"&&t.size===1&&!t.isArray&&e.x!==void 0},code:function(t){return`
                cv = ud["`+t+`"].value;
                v = uv["`+t+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+t+`"].location, v.x, v.y);
                }`},codeUbo:function(t){return`
                v = uv.`+t+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(t){return t.type==="vec2"&&t.size===1&&!t.isArray},code:function(t){return`
                cv = ud["`+t+`"].value;
                v = uv["`+t+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+t+`"].location, v[0], v[1]);
                }
            `}},{test:function(t,e){return t.type==="vec4"&&t.size===1&&!t.isArray&&e.width!==void 0},code:function(t){return`
                cv = ud["`+t+`"].value;
                v = uv["`+t+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+t+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(t){return`
                    v = uv.`+t+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(t){return t.type==="vec4"&&t.size===1&&!t.isArray},code:function(t){return`
                cv = ud["`+t+`"].value;
                v = uv["`+t+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+t+`"].location, v[0], v[1], v[2], v[3])
                }`}}],PJ={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},RJ={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function LJ(t,e){var i,r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var n in t.uniforms){var o=e[n];if(!o){!((i=t.uniforms[n])===null||i===void 0)&&i.group&&(t.uniforms[n].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+n+", '"+n+`');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.`+n+`, syncData);
                    `));continue}for(var a=t.uniforms[n],l=!1,h=0;h<ec.length;h++)if(ec[h].test(o,a)){r.push(ec[h].code(n,a)),l=!0;break}if(!l){var u=o.size===1&&!o.isArray?PJ:RJ,c=u[o.type].replace("location",'ud["'+n+'"].location');r.push(`
            cu = ud["`+n+`"];
            cv = cu.value;
            v = uv["`+n+`"];
            `+c+";")}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}var OJ=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function DJ(t){for(var e="",i=0;i<t;++i)i>0&&(e+=`
else `),i<t-1&&(e+="if(test == "+i+".0){}");return e}function IJ(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=e.createShader(e.FRAGMENT_SHADER);;){var r=OJ.replace(/%forloop%/gi,DJ(t));if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))t=t/2|0;else break}return t}var pd;function kJ(){if(typeof pd=="boolean")return pd;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");pd=t({a:"b"},"a","b")===!0}catch(e){pd=!1}return pd}var FJ=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,BJ=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,NJ=0,r_={},uh=function(){function t(e,i,r){r===void 0&&(r="pixi-shader"),this.id=NJ++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=i||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),r_[r]?(r_[r]++,r+="-"+r_[r]):r_[r]=1,this.vertexSrc="#define SHADER_NAME "+r+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+`
`+this.fragmentSrc,this.vertexSrc=eN(this.vertexSrc,Fe.PRECISION_VERTEX,en.HIGH),this.fragmentSrc=eN(this.fragmentSrc,Fe.PRECISION_FRAGMENT,TJ())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(t,"defaultVertexSrc",{get:function(){return BJ},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return FJ},enumerable:!1,configurable:!0}),t.from=function(e,i,r){var n=e+i,o=Y0[n];return o||(Y0[n]=o=new t(e,i,r)),o},t}(),ms=function(){function t(e,i){this.uniformBindCount=0,this.program=e,i?i instanceof nl?this.uniformGroup=i:this.uniformGroup=new nl(i):this.uniformGroup=new nl({}),this.disposeRunner=new gr("disposeShader")}return t.prototype.checkUniformExists=function(e,i){if(i.uniforms[e])return!0;for(var r in i.uniforms){var n=i.uniforms[r];if(n.group&&this.checkUniformExists(e,n))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,i,r){var n=uh.from(e,i);return new t(n,r)},t}(),WS=0,VS=1,jS=2,qS=3,XS=4,YS=5,Gs=function(){function t(){this.data=0,this.blendMode=at.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(t.prototype,"blend",{get:function(){return!!(this.data&1<<WS)},set:function(e){!!(this.data&1<<WS)!==e&&(this.data^=1<<WS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsets",{get:function(){return!!(this.data&1<<VS)},set:function(e){!!(this.data&1<<VS)!==e&&(this.data^=1<<VS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"culling",{get:function(){return!!(this.data&1<<jS)},set:function(e){!!(this.data&1<<jS)!==e&&(this.data^=1<<jS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return!!(this.data&1<<qS)},set:function(e){!!(this.data&1<<qS)!==e&&(this.data^=1<<qS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return!!(this.data&1<<YS)},set:function(e){!!(this.data&1<<YS)!==e&&(this.data^=1<<YS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<XS)},set:function(e){!!(this.data&1<<XS)!==e&&(this.data^=1<<XS)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==at.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(e){this.offsets=!!e,this._polygonOffset=e},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},t.for2d=function(){var e=new t;return e.depthTest=!1,e.blend=!0,e},t}(),UJ=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,GJ=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,xn=function(t){ni(e,t);function e(i,r,n){var o=this,a=uh.from(i||e.defaultVertexSrc,r||e.defaultFragmentSrc);return o=t.call(this,a,n)||this,o.padding=0,o.resolution=Fe.FILTER_RESOLUTION,o.multisample=Fe.FILTER_MULTISAMPLE,o.enabled=!0,o.autoFit=!0,o.state=new Gs,o}return e.prototype.apply=function(i,r,n,o,a){i.applyFilter(this,r,n,o)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(i){this.state.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(i){this._resolution=i},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return GJ},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return UJ},enumerable:!1,configurable:!0}),e}(ms),zJ=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,HJ=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,iN=new Zt,vd=function(){function t(e,i){this._texture=e,this.mapCoord=new Zt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i=="undefined"?.5:i,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(e,i){i===void 0&&(i=e);for(var r=this.mapCoord,n=0;n<e.length;n+=2){var o=e[n],a=e[n+1];i[n]=o*r.a+a*r.c+r.tx,i[n+1]=o*r.b+a*r.d+r.ty}return i},t.prototype.update=function(e){var i=this._texture;if(!i||!i.valid||!e&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;var r=i._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=i.orig,o=i.trim;o&&(iN.set(n.width/o.width,0,0,n.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(iN));var a=i.baseTexture,l=this.uClampFrame,h=this.clampMargin/a.resolution,u=this.clampOffset;return l[0]=(i._frame.x+h+u)/a.width,l[1]=(i._frame.y+h+u)/a.height,l[2]=(i._frame.x+i._frame.width-h+u)/a.width,l[3]=(i._frame.y+i._frame.height-h+u)/a.height,this.uClampOffset[0]=u/a.realWidth,this.uClampOffset[1]=u/a.realHeight,this.isSimple=i._frame.width===a.width&&i._frame.height===a.height&&i.rotate===0,!0},t}(),WJ=function(t){ni(e,t);function e(i,r,n){var o=this,a=null;return typeof i!="string"&&r===void 0&&n===void 0&&(a=i,i=void 0,r=void 0,n=void 0),o=t.call(this,i||zJ,r||HJ,n)||this,o.maskSprite=a,o.maskMatrix=new Zt,o}return Object.defineProperty(e.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(i){this._maskSprite=i,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),e.prototype.apply=function(i,r,n,o){var a=this._maskSprite,l=a._texture;l.valid&&(l.uvMatrix||(l.uvMatrix=new vd(l,0)),l.uvMatrix.update(),this.uniforms.npmAlpha=l.baseTexture.alphaMode?0:1,this.uniforms.mask=l,this.uniforms.otherMatrix=i.calculateSpriteMatrix(this.maskMatrix,a).prepend(l.uvMatrix.mapCoord),this.uniforms.alpha=a.worldAlpha,this.uniforms.maskClamp=l.uvMatrix.uClampFrame,i.applyFilter(this,r,n,o))},e}(xn),MN=function(){function t(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return t.prototype.setMaskStack=function(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)},t.prototype.push=function(e,i){var r=i;if(!r.isMaskData){var n=this.maskDataPool.pop()||new CJ;n.pooled=!0,n.maskObject=i,r=n}var o=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(o),r._colorMask=o?o._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==Pi.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Pi.SCISSOR:this.renderer.scissor.push(r);break;case Pi.STENCIL:this.renderer.stencil.push(r);break;case Pi.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Pi.COLOR:this.pushColorMask(r);break}r.type===Pi.SPRITE&&this.maskStack.push(r)},t.prototype.pop=function(e){var i=this.maskStack.pop();if(!(!i||i._target!==e)){if(i.enabled)switch(i.type){case Pi.SCISSOR:this.renderer.scissor.pop(i);break;case Pi.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case Pi.SPRITE:this.popSpriteMask(i);break;case Pi.COLOR:this.popColorMask(i);break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){var r=this.maskStack[this.maskStack.length-1];r.type===Pi.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}},t.prototype.detect=function(e){var i=e.maskObject;i?i.isSprite?e.type=Pi.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=Pi.SCISSOR:e.type=Pi.STENCIL:e.type=Pi.COLOR},t.prototype.pushSpriteMask=function(e){var i,r,n=e.maskObject,o=e._target,a=e._filters;a||(a=this.alphaMaskPool[this.alphaMaskIndex],a||(a=this.alphaMaskPool[this.alphaMaskIndex]=[new WJ]));var l=this.renderer,h=l.renderTexture,u,c;if(h.current){var f=h.current;u=e.resolution||f.resolution,c=(i=e.multisample)!==null&&i!==void 0?i:f.multisample}else u=e.resolution||l.resolution,c=(r=e.multisample)!==null&&r!==void 0?r:l.multisample;a[0].resolution=u,a[0].multisample=c,a[0].maskSprite=n;var d=o.filterArea;o.filterArea=n.getBounds(!0),l.filter.push(o,a),o.filterArea=d,e._filters||this.alphaMaskIndex++},t.prototype.popSpriteMask=function(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},t.prototype.pushColorMask=function(e){var i=e._colorMask,r=e._colorMask=i&e.colorMask;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)},t.prototype.popColorMask=function(e){var i=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)},t.prototype.destroy=function(){this.renderer=null},t}(),EN=function(){function t(e){this.renderer=e,this.maskStack=[],this.glConst=0}return t.prototype.getStackLength=function(){return this.maskStack.length},t.prototype.setMaskStack=function(e){var i=this.renderer.gl,r=this.getStackLength();this.maskStack=e;var n=this.getStackLength();n!==r&&(n===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))},t.prototype._useCurrent=function(){},t.prototype.destroy=function(){this.renderer=null,this.maskStack=null},t}(),rN=new Zt,nN=[],TN=function(t){ni(e,t);function e(i){var r=t.call(this,i)||this;return r.glConst=Fe.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST,r}return e.prototype.getStackLength=function(){var i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0},e.prototype.calcScissorRect=function(i){var r;if(!i._scissorRectLocal){var n=i._scissorRect,o=i.maskObject,a=this.renderer,l=a.renderTexture,h=o.getBounds(!0,(r=nN.pop())!==null&&r!==void 0?r:new Tt);this.roundFrameToPixels(h,l.current?l.current.resolution:a.resolution,l.sourceFrame,l.destinationFrame,a.projection.transform),n&&h.fit(n),i._scissorRectLocal=h}},e.isMatrixRotated=function(i){if(!i)return!1;var r=i.a,n=i.b,o=i.c,a=i.d;return(Math.abs(n)>1e-4||Math.abs(o)>1e-4)&&(Math.abs(r)>1e-4||Math.abs(a)>1e-4)},e.prototype.testScissor=function(i){var r=i.maskObject;if(!r.isFastRect||!r.isFastRect()||e.isMatrixRotated(r.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);var n=i._scissorRectLocal;return n.width>0&&n.height>0},e.prototype.roundFrameToPixels=function(i,r,n,o,a){e.isMatrixRotated(a)||(a=a?rN.copyFrom(a):rN.identity(),a.translate(-n.x,-n.y).scale(o.width/n.width,o.height/n.height).translate(o.x,o.y),this.renderer.filter.transformAABB(a,i),i.fit(o),i.x=Math.round(i.x*r),i.y=Math.round(i.y*r),i.width=Math.round(i.width*r),i.height=Math.round(i.height*r))},e.prototype.push=function(i){i._scissorRectLocal||this.calcScissorRect(i);var r=this.renderer.gl;i._scissorRect||r.enable(r.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()},e.prototype.pop=function(i){var r=this.renderer.gl;i&&nN.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():r.disable(r.SCISSOR_TEST)},e.prototype._useCurrent=function(){var i=this.maskStack[this.maskStack.length-1]._scissorRect,r;this.renderer.renderTexture.current?r=i.y:r=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,r,i.width,i.height)},e}(EN),AN=function(t){ni(e,t);function e(i){var r=t.call(this,i)||this;return r.glConst=Fe.ADAPTER.getWebGLRenderingContext().STENCIL_TEST,r}return e.prototype.getStackLength=function(){var i=this.maskStack[this.maskStack.length-1];return i?i._stencilCounter:0},e.prototype.push=function(i){var r=i.maskObject,n=this.renderer.gl,o=i._stencilCounter;o===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),i._stencilCounter++;var a=i._colorMask;a!==0&&(i._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,o,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,a!==0&&(i._colorMask=a,n.colorMask((a&1)!==0,(a&2)!==0,(a&4)!==0,(a&8)!==0)),this._useCurrent()},e.prototype.pop=function(i){var r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{var n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,o=n?n._colorMask:15;o!==0&&(n._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,o!==0&&(n._colorMask=o,r.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}},e.prototype._useCurrent=function(){var i=this.renderer.gl;i.stencilFunc(i.EQUAL,this.getStackLength(),4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)},e}(EN),PN=function(){function t(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Zt,this.transform=null}return t.prototype.update=function(e,i,r,n){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);var o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)},t.prototype.calculateProjection=function(e,i,r,n){var o=this.projectionMatrix,a=n?-1:1;o.identity(),o.a=1/i.width*2,o.d=a*(1/i.height*2),o.tx=-1-i.x*o.a,o.ty=-a-i.y*o.d},t.prototype.setTransform=function(e){},t.prototype.destroy=function(){this.renderer=null},t}(),ah=new Tt,md=new Tt,RN=function(){function t(e){this.renderer=e,this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Tt,this.destinationFrame=new Tt,this.viewportFrame=new Tt}return t.prototype.bind=function(e,i,r){e===void 0&&(e=null);var n=this.renderer;this.current=e;var o,a,l;e?(o=e.baseTexture,l=o.resolution,i||(ah.width=e.frame.width,ah.height=e.frame.height,i=ah),r||(md.x=e.frame.x,md.y=e.frame.y,md.width=i.width,md.height=i.height,r=md),a=o.framebuffer):(l=n.resolution,i||(ah.width=n.screen.width,ah.height=n.screen.height,i=ah),r||(r=ah,r.width=i.width,r.height=i.height));var h=this.viewportFrame;h.x=r.x*l,h.y=r.y*l,h.width=r.width*l,h.height=r.height*l,e||(h.y=n.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(r,i,l,!a),e?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(r)},t.prototype.clear=function(e,i){this.current?e=e||this.current.baseTexture.clearColor:e=e||this.clearColor;var r=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer.screen,o=r.width!==n.width||r.height!==n.height;if(o){var a=this.viewportFrame,l=a.x,h=a.y,u=a.width,c=a.height;l=Math.round(l),h=Math.round(h),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,c)}this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],i),o&&this.renderer.scissor.pop()},t.prototype.resize=function(){this.bind(null)},t.prototype.reset=function(){this.bind(null)},t.prototype.destroy=function(){this.renderer=null},t}();function VJ(t,e,i,r,n){i.buffer.update(n)}var jJ={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},LN={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function qJ(t){for(var e=t.map(function(h){return{data:h,offset:0,dataLen:0,dirty:0}}),i=0,r=0,n=0,o=0;o<e.length;o++){var a=e[o];if(i=LN[a.data.type],a.data.size>1&&(i=Math.max(i,16)*a.data.size),a.dataLen=i,r%i!==0&&r<16){var l=r%i%16;r+=l,n+=l}r+i>16?(n=Math.ceil(n/16)*16,a.offset=n,n+=i,r=i):(a.offset=n,r+=i,n+=i)}return n=Math.ceil(n/16)*16,{uboElements:e,size:n}}function XJ(t,e){var i=[];for(var r in t)e[r]&&i.push(e[r]);return i.sort(function(n,o){return n.index-o.index}),i}function YJ(t,e){if(!t.autoManage)return{size:0,syncFunc:VJ};for(var i=XJ(t.uniforms,e),r=qJ(i),n=r.uboElements,o=r.size,a=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],l=0;l<n.length;l++){for(var h=n[l],u=t.uniforms[h.data.name],c=h.data.name,f=!1,d=0;d<ec.length;d++){var m=ec[d];if(m.codeUbo&&m.test(h.data,u)){a.push("offset = "+h.offset/4+";",ec[d].codeUbo(h.data.name,u)),f=!0;break}}if(!f)if(h.data.size>1){var v=SN(h.data.type),g=Math.max(LN[h.data.type]/16,1),p=v/g,_=(4-p%4)%4;a.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+h.offset/4+`;

                t = 0;

                for(var i=0; i < `+h.data.size*g+`; i++)
                {
                    for(var j = 0; j < `+p+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+_+`;
                }

                `)}else{var x=jJ[h.data.type];a.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+h.offset/4+`;
                `+x+`;
                `)}}return a.push(`
       renderer.buffer.update(buffer);
    `),{size:o,syncFunc:new Function("ud","uv","renderer","syncData","buffer",a.join(`
`))}}var ZMe=function(){function t(){}return t}(),ZJ=function(){function t(e,i){this.program=e,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},t}();function KJ(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var o=e.getActiveAttrib(t,n);if(o.name.indexOf("gl_")!==0){var a=CN(e,o.type),l={type:a,name:o.name,size:SN(a),location:e.getAttribLocation(t,o.name)};i[o.name]=l}}return i}function QJ(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<r;n++){var o=e.getActiveUniform(t,n),a=o.name.replace(/\[.*?\]$/,""),l=!!o.name.match(/\[.*?\]$/),h=CN(e,o.type);i[a]={name:a,index:n,type:h,size:o.size,isArray:l,value:bN(h,o.size)}}return i}function JJ(t,e){var i=J5(t,t.VERTEX_SHADER,e.vertexSrc),r=J5(t,t.FRAGMENT_SHADER,e.fragmentSrc),n=t.createProgram();if(t.attachShader(n,i),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||MJ(t,n,i,r),e.attributeData=KJ(n,t),e.uniformData=QJ(n,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){var o=Object.keys(e.attributeData);o.sort(function(c,f){return c>f?1:-1});for(var a=0;a<o.length;a++)e.attributeData[o[a]].location=a,t.bindAttribLocation(n,a,o[a]);t.linkProgram(n)}t.deleteShader(i),t.deleteShader(r);var l={};for(var a in e.uniformData){var h=e.uniformData[a];l[a]={location:t.getUniformLocation(n,a),value:bN(h.type,h.size)}}var u=new ZJ(n,l);return u}var $J=0,n_={textureCount:0,uboCount:0},ON=function(){function t(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=$J++}return t.prototype.systemCheck=function(){if(!kJ())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},t.prototype.contextChange=function(e){this.gl=e,this.reset()},t.prototype.bind=function(e,i){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;var r=e.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),i||(n_.textureCount=0,n_.uboCount=0,this.syncUniformGroup(e.uniformGroup,n_)),n},t.prototype.setUniforms=function(e){var i=this.shader.program,r=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(r.uniformData,e,this.renderer)},t.prototype.syncUniformGroup=function(e,i){var r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,i))},t.prototype.syncUniforms=function(e,i,r){var n=e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e);n(i.uniformData,e.uniforms,this.renderer,r)},t.prototype.createSyncGroups=function(e){var i=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=LJ(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[i],e.syncUniforms[this.shader.program.id]},t.prototype.syncUniformBufferGroup=function(e,i){var r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;var n=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,i);e.buffer.update(),n(r.uniformData,e.uniforms,this.renderer,n_,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[i])},t.prototype.createSyncBufferGroup=function(e,i,r){var n=this.renderer.gl;this.renderer.buffer.bind(e.buffer);var o=this.gl.getUniformBlockIndex(i.program,r);i.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(i.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;var a=this.getSignature(e,this.shader.program.uniformData,"ubo"),l=this._uboCache[a];if(l||(l=this._uboCache[a]=YJ(e,this.shader.program.uniformData)),e.autoManage){var h=new Float32Array(l.size/4);e.buffer.update(h)}return i.uniformGroups[e.id]=l.syncFunc,i.uniformGroups[e.id]},t.prototype.getSignature=function(e,i,r){var n=e.uniforms,o=[r+"-"];for(var a in n)o.push(a),i[a]&&o.push(i[a].type);return o.join("-")},t.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},t.prototype.generateProgram=function(e){var i=this.gl,r=e.program,n=JJ(i,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n},t.prototype.reset=function(){this.program=null,this.shader=null},t.prototype.disposeShader=function(e){this.shader===e&&(this.shader=null)},t.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},t}();function e$(t,e){return e===void 0&&(e=[]),e[at.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.ADD]=[t.ONE,t.ONE],e[at.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.NONE]=[0,0],e[at.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[at.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[at.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[at.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[at.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[at.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[at.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[at.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[at.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[at.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[at.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}var t$=0,i$=1,r$=2,n$=3,s$=4,o$=5,DN=function(){function t(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=at.NONE,this._blendEq=!1,this.map=[],this.map[t$]=this.setBlend,this.map[i$]=this.setOffset,this.map[r$]=this.setCullFace,this.map[n$]=this.setDepthTest,this.map[s$]=this.setFrontFace,this.map[o$]=this.setDepthMask,this.checks=[],this.defaultState=new Gs,this.defaultState.blend=!0}return t.prototype.contextChange=function(e){this.gl=e,this.blendModes=e$(e),this.set(this.defaultState),this.reset()},t.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var i=this.stateId^e.data,r=0;i;)i&1&&this.map[r].call(this,!!(e.data&1<<r)),i=i>>1,r++;this.stateId=e.data}for(var r=0;r<this.checks.length;r++)this.checks[r](this,e)},t.prototype.forceState=function(e){e=e||this.defaultState;for(var i=0;i<this.map.length;i++)this.map[i].call(this,!!(e.data&1<<i));for(var i=0;i<this.checks.length;i++)this.checks[i](this,e);this.stateId=e.data},t.prototype.setBlend=function(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},t.prototype.setOffset=function(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},t.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},t.prototype.setDepthMask=function(e){this.gl.depthMask(e)},t.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},t.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},t.prototype.setBlendMode=function(e){if(e!==this.blendMode){this.blendMode=e;var i=this.blendModes[e],r=this.gl;i.length===2?r.blendFunc(i[0],i[1]):r.blendFuncSeparate(i[0],i[1],i[2],i[3]),i.length===6?(this._blendEq=!0,r.blendEquationSeparate(i[4],i[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},t.prototype.setPolygonOffset=function(e,i){this.gl.polygonOffset(e,i)},t.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},t.prototype.updateCheck=function(e,i){var r=this.checks.indexOf(e);i&&r===-1?this.checks.push(e):!i&&r!==-1&&this.checks.splice(r,1)},t.checkBlendMode=function(e,i){e.setBlendMode(i.blendMode)},t.checkPolygonOffset=function(e,i){e.setPolygonOffset(1,i.polygonOffset)},t.prototype.destroy=function(){this.gl=null},t}(),IN=function(){function t(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=Fe.GC_MAX_IDLE,this.checkCountMax=Fe.GC_MAX_CHECK_COUNT,this.mode=Fe.GC_MODE}return t.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==Wu.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},t.prototype.run=function(){for(var e=this.renderer.texture,i=e.managedTextures,r=!1,n=0;n<i.length;n++){var o=i[n];!o.framebuffer&&this.count-o.touched>this.maxIdle&&(e.destroyTexture(o,!0),i[n]=null,r=!0)}if(r){for(var a=0,n=0;n<i.length;n++)i[n]!==null&&(i[a++]=i[n]);i.length=a}},t.prototype.unload=function(e){var i=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&i.destroyTexture(r);for(var n=e.children.length-1;n>=0;n--)this.unload(e.children[n])},t.prototype.destroy=function(){this.renderer=null},t}();function a$(t){var e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p,_,x,b,y,w,S,R;return"WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?R=(e={},e[ht.UNSIGNED_BYTE]=(i={},i[Oe.RGBA]=t.RGBA8,i[Oe.RGB]=t.RGB8,i[Oe.RG]=t.RG8,i[Oe.RED]=t.R8,i[Oe.RGBA_INTEGER]=t.RGBA8UI,i[Oe.RGB_INTEGER]=t.RGB8UI,i[Oe.RG_INTEGER]=t.RG8UI,i[Oe.RED_INTEGER]=t.R8UI,i[Oe.ALPHA]=t.ALPHA,i[Oe.LUMINANCE]=t.LUMINANCE,i[Oe.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,i),e[ht.BYTE]=(r={},r[Oe.RGBA]=t.RGBA8_SNORM,r[Oe.RGB]=t.RGB8_SNORM,r[Oe.RG]=t.RG8_SNORM,r[Oe.RED]=t.R8_SNORM,r[Oe.RGBA_INTEGER]=t.RGBA8I,r[Oe.RGB_INTEGER]=t.RGB8I,r[Oe.RG_INTEGER]=t.RG8I,r[Oe.RED_INTEGER]=t.R8I,r),e[ht.UNSIGNED_SHORT]=(n={},n[Oe.RGBA_INTEGER]=t.RGBA16UI,n[Oe.RGB_INTEGER]=t.RGB16UI,n[Oe.RG_INTEGER]=t.RG16UI,n[Oe.RED_INTEGER]=t.R16UI,n[Oe.DEPTH_COMPONENT]=t.DEPTH_COMPONENT16,n),e[ht.SHORT]=(o={},o[Oe.RGBA_INTEGER]=t.RGBA16I,o[Oe.RGB_INTEGER]=t.RGB16I,o[Oe.RG_INTEGER]=t.RG16I,o[Oe.RED_INTEGER]=t.R16I,o),e[ht.UNSIGNED_INT]=(a={},a[Oe.RGBA_INTEGER]=t.RGBA32UI,a[Oe.RGB_INTEGER]=t.RGB32UI,a[Oe.RG_INTEGER]=t.RG32UI,a[Oe.RED_INTEGER]=t.R32UI,a[Oe.DEPTH_COMPONENT]=t.DEPTH_COMPONENT24,a),e[ht.INT]=(l={},l[Oe.RGBA_INTEGER]=t.RGBA32I,l[Oe.RGB_INTEGER]=t.RGB32I,l[Oe.RG_INTEGER]=t.RG32I,l[Oe.RED_INTEGER]=t.R32I,l),e[ht.FLOAT]=(h={},h[Oe.RGBA]=t.RGBA32F,h[Oe.RGB]=t.RGB32F,h[Oe.RG]=t.RG32F,h[Oe.RED]=t.R32F,h[Oe.DEPTH_COMPONENT]=t.DEPTH_COMPONENT32F,h),e[ht.HALF_FLOAT]=(u={},u[Oe.RGBA]=t.RGBA16F,u[Oe.RGB]=t.RGB16F,u[Oe.RG]=t.RG16F,u[Oe.RED]=t.R16F,u),e[ht.UNSIGNED_SHORT_5_6_5]=(c={},c[Oe.RGB]=t.RGB565,c),e[ht.UNSIGNED_SHORT_4_4_4_4]=(f={},f[Oe.RGBA]=t.RGBA4,f),e[ht.UNSIGNED_SHORT_5_5_5_1]=(d={},d[Oe.RGBA]=t.RGB5_A1,d),e[ht.UNSIGNED_INT_2_10_10_10_REV]=(m={},m[Oe.RGBA]=t.RGB10_A2,m[Oe.RGBA_INTEGER]=t.RGB10_A2UI,m),e[ht.UNSIGNED_INT_10F_11F_11F_REV]=(v={},v[Oe.RGB]=t.R11F_G11F_B10F,v),e[ht.UNSIGNED_INT_5_9_9_9_REV]=(g={},g[Oe.RGB]=t.RGB9_E5,g),e[ht.UNSIGNED_INT_24_8]=(p={},p[Oe.DEPTH_STENCIL]=t.DEPTH24_STENCIL8,p),e[ht.FLOAT_32_UNSIGNED_INT_24_8_REV]=(_={},_[Oe.DEPTH_STENCIL]=t.DEPTH32F_STENCIL8,_),e):R=(x={},x[ht.UNSIGNED_BYTE]=(b={},b[Oe.RGBA]=t.RGBA,b[Oe.RGB]=t.RGB,b[Oe.ALPHA]=t.ALPHA,b[Oe.LUMINANCE]=t.LUMINANCE,b[Oe.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,b),x[ht.UNSIGNED_SHORT_5_6_5]=(y={},y[Oe.RGB]=t.RGB,y),x[ht.UNSIGNED_SHORT_4_4_4_4]=(w={},w[Oe.RGBA]=t.RGBA,w),x[ht.UNSIGNED_SHORT_5_5_5_1]=(S={},S[Oe.RGBA]=t.RGBA,S),x),R}var ZS=function(){function t(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ht.UNSIGNED_BYTE,this.internalFormat=Oe.RGBA,this.samplerType=0}return t}(),kN=function(){function t(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new At,this.hasIntegerTextures=!1}return t.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=a$(e);var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(var r=0;r<i;r++)this.boundTextures[r]=null;this.emptyTextures={};var n=new ZS(e.createTexture());e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new ZS(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(var r=0;r<6;r++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var r=0;r<this.boundTextures.length;r++)this.bind(null,r)},t.prototype.bind=function(e,i){i===void 0&&(i=0);var r=this.gl;if(e=e==null?void 0:e.castToBaseTexture(),e&&e.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;var n=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[i]!==e&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(e.target,n.texture)),n.dirtyId!==e.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),this.updateTexture(e)):n.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[i]=e}else this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[i]=null},t.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},t.prototype.unbind=function(e){var i=this,r=i.gl,n=i.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var o=0;o<n.length;o++)n[o]===this.unknownTexture&&this.bind(null,o)}for(var o=0;o<n.length;o++)n[o]===e&&(this.currentLocation!==o&&(r.activeTexture(r.TEXTURE0+o),this.currentLocation=o),r.bindTexture(e.target,this.emptyTextures[e.target].texture),n[o]=null)},t.prototype.ensureSamplerType=function(e){var i=this,r=i.boundTextures,n=i.hasIntegerTextures,o=i.CONTEXT_UID;if(n)for(var a=e-1;a>=0;--a){var l=r[a];if(l){var h=l._glTextures[o];h.samplerType!==Qf.FLOAT&&this.renderer.texture.unbind(l)}}},t.prototype.initTexture=function(e){var i=new ZS(this.gl.createTexture());return i.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),i},t.prototype.initTextureType=function(e,i){var r,n;i.internalFormat=(n=(r=this.internalFormats[e.type])===null||r===void 0?void 0:r[e.format])!==null&&n!==void 0?n:e.format,this.webGLVersion===2&&e.type===ht.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=e.type},t.prototype.updateTexture=function(e){var i=e._glTextures[this.CONTEXT_UID];if(i){var r=this.renderer;if(this.initTextureType(e,i),e.resource&&e.resource.upload(r,e,i))i.samplerType!==Qf.FLOAT&&(this.hasIntegerTextures=!0);else{var n=e.realWidth,o=e.realHeight,a=r.gl;(i.width!==n||i.height!==o||i.dirtyId<0)&&(i.width=n,i.height=o,a.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}},t.prototype.destroyTexture=function(e,i){var r=this.gl;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!i)){var n=this.managedTextures.indexOf(e);n!==-1&&Us(this.managedTextures,n,1)}},t.prototype.updateTextureStyle=function(e){var i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===$r.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=Jr.CLAMP:i.wrapMode=e.wrapMode,e.resource&&e.resource.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)},t.prototype.setStyle=function(e,i){var r=this.gl;if(i.mipmap&&e.mipmap!==$r.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===cs.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===cs.LINEAR){var o=Math.min(e.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===cs.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===cs.LINEAR?r.LINEAR:r.NEAREST)},t.prototype.destroy=function(){this.renderer=null},t}(),FN={__proto__:null,FilterSystem:gN,BatchSystem:vN,ContextSystem:_N,FramebufferSystem:yN,GeometrySystem:xN,MaskSystem:MN,ScissorSystem:TN,StencilSystem:AN,ProjectionSystem:PN,RenderTextureSystem:RN,ShaderSystem:ON,StateSystem:DN,TextureGCSystem:IN,TextureSystem:kN},KS=new Zt,l$=function(t){ni(e,t);function e(i,r){i===void 0&&(i=Hu.UNKNOWN);var n=t.call(this)||this;return r=Object.assign({},Fe.RENDER_OPTIONS,r),n.options=r,n.type=i,n.screen=new Tt(0,0,r.width,r.height),n.view=r.view||Fe.ADAPTER.createCanvas(),n.resolution=r.resolution||Fe.RESOLUTION,n.useContextAlpha=r.useContextAlpha,n.autoDensity=!!r.autoDensity,n.preserveDrawingBuffer=r.preserveDrawingBuffer,n.clearBeforeRender=r.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,1],n._backgroundColorString="#000000",n.backgroundColor=r.backgroundColor||n._backgroundColor,n.backgroundAlpha=r.backgroundAlpha,r.transparent!==void 0&&(Yi("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),n.useContextAlpha=r.transparent,n.backgroundAlpha=r.transparent?0:1),n._lastObjectRendered=null,n.plugins={},n}return e.prototype.initPlugins=function(i){for(var r in i)this.plugins[r]=new i[r](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(i,r){this.view.width=Math.round(i*this.resolution),this.view.height=Math.round(r*this.resolution);var n=this.view.width/this.resolution,o=this.view.height/this.resolution;this.screen.width=n,this.screen.height=o,this.autoDensity&&(this.view.style.width=n+"px",this.view.style.height=o+"px"),this.emit("resize",n,o)},e.prototype.generateTexture=function(i,r,n,o){r===void 0&&(r={}),typeof r=="number"&&(Yi("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),r={scaleMode:r,resolution:n,region:o});var a=r.region,l=uJ(r,["region"]);o=a||i.getLocalBounds(null,!0),o.width===0&&(o.width=1),o.height===0&&(o.height=1);var h=la.create(JS({width:o.width,height:o.height},l));return KS.tx=-o.x,KS.ty=-o.y,this.render(i,{renderTexture:h,clear:!1,transform:KS,skipUpdateTransform:!!i.parent}),h},e.prototype.destroy=function(i){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;i&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=Hu.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(i){this._backgroundColor=i,this._backgroundColorString=sd(i),ds(i,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(i){this._backgroundColorRgba[3]=i},enumerable:!1,configurable:!0}),e}(Mo.default),h$=function(){function t(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return t}(),u$=function(){function t(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}return t.prototype.destroy=function(){this.renderer=null},t.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},t.prototype.bind=function(e){var i=this,r=i.gl,n=i.CONTEXT_UID,o=e._glBuffers[n]||this.createGLBuffer(e);r.bindBuffer(e.type,o.buffer)},t.prototype.bindBufferBase=function(e,i){var r=this,n=r.gl,o=r.CONTEXT_UID;if(this.boundBufferBases[i]!==e){var a=e._glBuffers[o]||this.createGLBuffer(e);this.boundBufferBases[i]=e,n.bindBufferBase(n.UNIFORM_BUFFER,i,a.buffer)}},t.prototype.bindBufferRange=function(e,i,r){var n=this,o=n.gl,a=n.CONTEXT_UID;r=r||0;var l=e._glBuffers[a]||this.createGLBuffer(e);o.bindBufferRange(o.UNIFORM_BUFFER,i||0,l.buffer,r*256,256)},t.prototype.update=function(e){var i=this,r=i.gl,n=i.CONTEXT_UID,o=e._glBuffers[n];if(e._updateID!==o.updateID)if(o.updateID=e._updateID,r.bindBuffer(e.type,o.buffer),o.byteLength>=e.data.byteLength)r.bufferSubData(e.type,0,e.data);else{var a=e.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;o.byteLength=e.data.byteLength,r.bufferData(e.type,e.data,a)}},t.prototype.dispose=function(e,i){if(this.managedBuffers[e.id]){delete this.managedBuffers[e.id];var r=e._glBuffers[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this),r&&(i||n.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}},t.prototype.disposeAll=function(e){for(var i=Object.keys(this.managedBuffers),r=0;r<i.length;r++)this.dispose(this.managedBuffers[i[r]],e)},t.prototype.createGLBuffer=function(e){var i=this,r=i.CONTEXT_UID,n=i.gl;return e._glBuffers[r]=new h$(n.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[r]},t}(),BN=function(t){ni(e,t);function e(i){var r=t.call(this,Hu.WEBGL,i)||this;return i=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new gr("destroy"),contextChange:new gr("contextChange"),reset:new gr("reset"),update:new gr("update"),postrender:new gr("postrender"),prerender:new gr("prerender"),resize:new gr("resize")},r.runners.contextChange.add(r),r.globalUniforms=new nl({projectionMatrix:new Zt},!0),r.addSystem(MN,"mask").addSystem(_N,"context").addSystem(DN,"state").addSystem(ON,"shader").addSystem(kN,"texture").addSystem(u$,"buffer").addSystem(xN,"geometry").addSystem(yN,"framebuffer").addSystem(TN,"scissor").addSystem(AN,"stencil").addSystem(PN,"projection").addSystem(IN,"textureGC").addSystem(gN,"filter").addSystem(RN,"renderTexture").addSystem(vN,"batch"),r.initPlugins(e.__plugins),r.multisample=void 0,i.context?r.context.initFromContext(i.context):r.context.initFromOptions({alpha:!!r.useContextAlpha,antialias:i.antialias,premultipliedAlpha:r.useContextAlpha&&r.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,PS(r.context.webGLVersion===2?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return e.create=function(i){if(RS())return new e(i);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.contextChange=function(){var i=this.gl,r;if(this.context.webGLVersion===1){var n=i.getParameter(i.FRAMEBUFFER_BINDING);i.bindFramebuffer(i.FRAMEBUFFER,null),r=i.getParameter(i.SAMPLES),i.bindFramebuffer(i.FRAMEBUFFER,n)}else{var n=i.getParameter(i.DRAW_FRAMEBUFFER_BINDING);i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),r=i.getParameter(i.SAMPLES),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,n)}r>=ai.HIGH?this.multisample=ai.HIGH:r>=ai.MEDIUM?this.multisample=ai.MEDIUM:r>=ai.LOW?this.multisample=ai.LOW:this.multisample=ai.NONE},e.prototype.addSystem=function(i,r){var n=new i(this);if(this[r])throw new Error('Whoops! The name "'+r+'" is already in use');this[r]=n;for(var o in this.runners)this.runners[o].add(n);return this},e.prototype.render=function(i,r){var n,o,a,l;if(r&&(r instanceof la?(Yi("6.0.0","Renderer#render arguments changed, use options instead."),n=r,o=arguments[2],a=arguments[3],l=arguments[4]):(n=r.renderTexture,o=r.clear,a=r.transform,l=r.skipUpdateTransform)),this.renderingToScreen=!n,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=a,!this.context.isLost){if(n||(this._lastObjectRendered=i),!l){var h=i.enableTempParent();i.updateTransform(),i.disableTempParent(h)}this.renderTexture.bind(n),this.batch.currentRenderer.start(),(o!==void 0?o:this.clearBeforeRender)&&this.renderTexture.clear(),i.render(this),this.batch.currentRenderer.flush(),n&&n.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.generateTexture=function(i,r,n,o){r===void 0&&(r={});var a=t.prototype.generateTexture.call(this,i,r,n,o);return this.framebuffer.blit(),a},e.prototype.resize=function(i,r){t.prototype.resize.call(this,i,r),this.runners.resize.emit(this.screen.height,this.screen.width)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(i){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();t.prototype.destroy.call(this,i),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return Yi("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(i,r){Yi("6.5.0","Renderer.registerPlugin() has been deprecated, please use extensions.add() instead."),Nn.add({name:i,type:Pt.RendererPlugin,ref:r})},e.__plugins={},e}(l$);Nn.handleByMap(Pt.RendererPlugin,BN.__plugins);function NN(t){return BN.create(t)}var c$=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,f$=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,UN=c$,o_=f$,KMe=function(){function t(e){Yi("6.1.0","System class is deprecated, implemement ISystem interface instead."),this.renderer=e}return t.prototype.destroy=function(){this.renderer=null},t}(),a_=function(){function t(){this.texArray=null,this.blend=0,this.type=vn.TRIANGLES,this.start=0,this.size=0,this.data=null}return t}(),l_=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var e=0;e<this.count;e++)this.elements[e]=null;this.count=0},t}(),h_=function(){function t(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(e){return this[e+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},t}(),d$=function(t){ni(e,t);function e(i){var r=t.call(this,i)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=Gs.for2d(),r.size=Fe.SPRITE_BATCH_SIZE*4,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),i.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return e.prototype.contextChange=function(){var i=this.renderer.gl;Fe.PREFER_ENV===wo.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),Fe.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=IJ(this.MAX_TEXTURES,i)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var i=e._drawCallPool,r=e._textureArrayPool,n=this.size/4,o=Math.floor(n/this.MAX_TEXTURES)+1;i.length<n;)i.push(new a_);for(;r.length<o;)r.push(new l_);for(var a=0;a<this.MAX_TEXTURES;a++)this._tempBoundTextures[a]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(i){i._texture.valid&&(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)},e.prototype.buildTexturesAndDrawCalls=function(){var i=this,r=i._bufferedTextures,n=i.MAX_TEXTURES,o=e._textureArrayPool,a=this.renderer.batch,l=this._tempBoundTextures,h=this.renderer.textureGC.count,u=++At._globalBatch,c=0,f=o[0],d=0;a.copyBoundTextures(l,n);for(var m=0;m<this._bufferSize;++m){var v=r[m];r[m]=null,v._batchEnabled!==u&&(f.count>=n&&(a.boundArray(f,l,u,n),this.buildDrawCalls(f,d,m),d=m,f=o[++c],++u),v._batchEnabled=u,v.touched=h,f.elements[f.count++]=v)}f.count>0&&(a.boundArray(f,l,u,n),this.buildDrawCalls(f,d,this._bufferSize),++c,++u);for(var m=0;m<l.length;m++)l[m]=null;At._globalBatch=u},e.prototype.buildDrawCalls=function(i,r,n){var o=this,a=o._bufferedElements,l=o._attributeBuffer,h=o._indexBuffer,u=o.vertexSize,c=e._drawCallPool,f=this._dcIndex,d=this._aIndex,m=this._iIndex,v=c[f];v.start=this._iIndex,v.texArray=i;for(var g=r;g<n;++g){var p=a[g],_=p._texture.baseTexture,x=j0[_.alphaMode?1:0][p.blendMode];a[g]=null,r<g&&v.blend!==x&&(v.size=m-v.start,r=g,v=c[++f],v.texArray=i,v.start=m),this.packInterleavedGeometry(p,l,h,d,m),d+=p.vertexData.length/2*u,m+=p.indices.length,v.blend=x}r<n&&(v.size=m-v.start,++f),this._dcIndex=f,this._aIndex=d,this._iIndex=m},e.prototype.bindAndClearTexArray=function(i){for(var r=this.renderer.texture,n=0;n<i.count;n++)r.bind(i.elements[n],i.ids[n]),i.elements[n]=null;i.count=0},e.prototype.updateGeometry=function(){var i=this,r=i._packedGeometries,n=i._attributeBuffer,o=i._indexBuffer;Fe.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(o),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(o),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var i=this._dcIndex,r=this.renderer,n=r.gl,o=r.state,a=e._drawCallPool,l=null,h=0;h<i;h++){var u=a[h],c=u.texArray,f=u.type,d=u.size,m=u.start,v=u.blend;l!==c&&(l=c,this.bindAndClearTexArray(c)),this.state.blendMode=v,o.set(this.state),n.drawElements(f,d,n.UNSIGNED_SHORT,m*2)}},e.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),Fe.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(i){var r=Qu(Math.ceil(i/8)),n=X0(r),o=r*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var a=this._aBuffers[o];return a||(this._aBuffers[o]=a=new h_(o*this.vertexSize*4)),a},e.prototype.getIndexBuffer=function(i){var r=Qu(Math.ceil(i/12)),n=X0(r),o=r*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var a=this._iBuffers[n];return a||(this._iBuffers[n]=a=new Uint16Array(o)),a},e.prototype.packInterleavedGeometry=function(i,r,n,o,a){for(var l=r.uint32View,h=r.float32View,u=o/this.vertexSize,c=i.uvs,f=i.indices,d=i.vertexData,m=i._texture.baseTexture._batchLocation,v=Math.min(i.worldAlpha,1),g=v<1&&i._texture.baseTexture.alphaMode?ih(i._tintRGB,v):i._tintRGB+(v*255<<24),p=0;p<d.length;p+=2)h[o++]=d[p],h[o++]=d[p+1],h[o++]=c[p],h[o++]=c[p+1],l[o++]=g,h[o++]=m;for(var p=0;p<f.length;p++)n[a++]=u+f[p]},e._drawCallPool=[],e._textureArrayPool=[],e}(ic),p$=function(){function t(e,i){if(this.vertexSrc=e,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},i.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(i.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(e){if(!this.programCache[e]){for(var i=new Int32Array(e),r=0;r<e;r++)i[r]=r;this.defaultGroupCache[e]=nl.from({uSamplers:i},!0);var n=this.fragTemplate;n=n.replace(/%count%/gi,""+e),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new uh(this.vertexSrc,n)}var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Zt,default:this.defaultGroupCache[e]};return new ms(this.programCache[e],o)},t.prototype.generateSampleSrc=function(e){var i="";i+=`
`,i+=`
`;for(var r=0;r<e;r++)r>0&&(i+=`
else `),r<e-1&&(i+="if(vTextureId < "+r+".5)"),i+=`
{`,i+=`
	color = texture2D(uSamplers[`+r+"], vTextureCoord);",i+=`
}`;return i+=`
`,i+=`
`,i},t}(),nC=function(t){ni(e,t);function e(i){i===void 0&&(i=!1);var r=t.call(this)||this;return r._buffer=new Ni(null,i,!1),r._indexBuffer=new Ni(null,i,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,ht.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,ht.FLOAT).addAttribute("aColor",r._buffer,4,!0,ht.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,ht.FLOAT).addIndex(r._indexBuffer),r}return e}(hh),sN=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,oN=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,m$=function(){function t(){}return t.create=function(e){var i=Object.assign({vertex:sN,fragment:oN,geometryClass:nC,vertexSize:6},e),r=i.vertex,n=i.fragment,o=i.vertexSize,a=i.geometryClass;return function(l){ni(h,l);function h(u){var c=l.call(this,u)||this;return c.shaderGenerator=new p$(r,n),c.geometryClass=a,c.vertexSize=o,c}return h}(d$)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return sN},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return oN},enumerable:!1,configurable:!0}),t}(),sC=m$.create();Object.assign(sC,{extension:{name:"batch",type:Pt.RendererPlugin}});var g$={},v$=function(t){Object.defineProperty(g$,t,{get:function(){return Yi("6.0.0","PIXI.systems."+t+" has moved to PIXI."+t),dN[t]}})};for(gd in dN)v$(gd);var gd,_$={},y$=function(t){Object.defineProperty(_$,t,{get:function(){return Yi("6.0.0","PIXI.resources."+t+" has moved to PIXI."+t),FN[t]}})};for(gd in FN)y$(gd);var gd;var x$={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ri.mixin(x$);var b$=9,u_=100,w$=0,S$=0,GN=2,zN=1,C$=-1e3,M$=-1e3,E$=2,HN=function(){function t(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(yn.tablet||yn.phone)&&this.createTouchHook();var i=document.createElement("div");i.style.width=u_+"px",i.style.height=u_+"px",i.style.position="absolute",i.style.top=w$+"px",i.style.left=S$+"px",i.style.zIndex=GN.toString(),this.div=i,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var e=this,i=document.createElement("button");i.style.width=zN+"px",i.style.height=zN+"px",i.style.position="absolute",i.style.top=C$+"px",i.style.left=M$+"px",i.style.zIndex=E$.toString(),i.style.backgroundColor="#FF0000",i.title="select to enable accessibility for this content",i.addEventListener("focus",function(){e._isMobileAccessibility=!0,e.activate(),e.destroyTouchHook()}),document.body.appendChild(i),this._hookDiv=i},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)===null||e===void 0||e.appendChild(this.div))},t.prototype.deactivate=function(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)===null||e===void 0||e.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(e){if(!(!e.visible||!e.accessibleChildren)){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);var i=e.children;if(i)for(var r=0;r<i.length;r++)this.updateAccessibleObjects(i[r])}},t.prototype.update=function(){var e=performance.now();if(!(yn.android.device&&e<this.androidUpdateCount)&&(this.androidUpdateCount=e+this.androidUpdateFrequency,!!this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var i=this.renderer.view.getBoundingClientRect(),r=i.left,n=i.top,o=i.width,a=i.height,l=this.renderer,h=l.width,u=l.height,c=l.resolution,f=o/h*c,d=a/u*c,m=this.div;m.style.left=r+"px",m.style.top=n+"px",m.style.width=h+"px",m.style.height=u+"px";for(var v=0;v<this.children.length;v++){var g=this.children[v];if(g.renderId!==this.renderId)g._accessibleActive=!1,Us(this.children,v,1),this.div.removeChild(g._accessibleDiv),this.pool.push(g._accessibleDiv),g._accessibleDiv=null,v--;else{m=g._accessibleDiv;var p=g.hitArea,_=g.worldTransform;g.hitArea?(m.style.left=(_.tx+p.x*_.a)*f+"px",m.style.top=(_.ty+p.y*_.d)*d+"px",m.style.width=p.width*_.a*f+"px",m.style.height=p.height*_.d*d+"px"):(p=g.getBounds(),this.capHitArea(p),m.style.left=p.x*f+"px",m.style.top=p.y*d+"px",m.style.width=p.width*f+"px",m.style.height=p.height*d+"px",m.title!==g.accessibleTitle&&g.accessibleTitle!==null&&(m.title=g.accessibleTitle),m.getAttribute("aria-label")!==g.accessibleHint&&g.accessibleHint!==null&&m.setAttribute("aria-label",g.accessibleHint)),(g.accessibleTitle!==m.title||g.tabIndex!==m.tabIndex)&&(m.title=g.accessibleTitle,m.tabIndex=g.tabIndex,this.debug&&this.updateDebugHTML(m))}}this.renderId++}},t.prototype.updateDebugHTML=function(e){e.innerHTML="type: "+e.type+"</br> title : "+e.title+"</br> tabIndex: "+e.tabIndex},t.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);var i=this.renderer,r=i.width,n=i.height;e.x+e.width>r&&(e.width=r-e.x),e.y+e.height>n&&(e.height=n-e.y)},t.prototype.addChild=function(e){var i=this.pool.pop();i||(i=document.createElement("button"),i.style.width=u_+"px",i.style.height=u_+"px",i.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",i.style.position="absolute",i.style.zIndex=GN.toString(),i.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?i.setAttribute("aria-live","off"):i.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?i.setAttribute("aria-relevant","additions"):i.setAttribute("aria-relevant","text"),i.addEventListener("click",this._onClick.bind(this)),i.addEventListener("focus",this._onFocus.bind(this)),i.addEventListener("focusout",this._onFocusOut.bind(this))),i.style.pointerEvents=e.accessiblePointerEvents,i.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?i.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(i.title="displayObject "+e.tabIndex),e.accessibleHint&&e.accessibleHint!==null&&i.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(i),e._accessibleActive=!0,e._accessibleDiv=i,i.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},t.prototype._onClick=function(e){var i=this.renderer.plugins.interaction,r=e.target.displayObject,n=i.eventData;i.dispatchEvent(r,"click",n),i.dispatchEvent(r,"pointertap",n),i.dispatchEvent(r,"tap",n)},t.prototype._onFocus=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive");var i=this.renderer.plugins.interaction,r=e.target.displayObject,n=i.eventData;i.dispatchEvent(r,"mouseover",n)},t.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite");var i=this.renderer.plugins.interaction,r=e.target.displayObject,n=i.eventData;i.dispatchEvent(r,"mouseout",n)},t.prototype._onKeyDown=function(e){e.keyCode===b$&&this.activate()},t.prototype._onMouseMove=function(e){e.movementX===0&&e.movementY===0||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t.extension={name:"accessibility",type:[Pt.RendererPlugin,Pt.CanvasRendererPlugin]},t}();var d_=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Ht,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(e,i,r){return e.worldTransform.applyInverse(r||this.global,i)},t.prototype.copyEvent=function(e){"isPrimary"in e&&e.isPrimary&&(this.isPrimary=!0),this.button="button"in e&&e.button;var i="buttons"in e&&e.buttons;this.buttons=Number.isInteger(i)?i:"which"in e&&e.which,this.width="width"in e&&e.width,this.height="height"in e&&e.height,this.tiltX="tiltX"in e&&e.tiltX,this.tiltY="tiltY"in e&&e.tiltY,this.pointerType="pointerType"in e&&e.pointerType,this.pressure="pressure"in e&&e.pressure,this.rotationAngle="rotationAngle"in e&&e.rotationAngle,this.twist="twist"in e&&e.twist||0,this.tangentialPressure="tangentialPressure"in e&&e.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}();var aC=function(t,e){return aC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},aC(t,e)};function T$(t,e){aC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var A$=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),oC=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(e,i){i?this._flags=this._flags|e:this._flags=this._flags&~e},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(e){this._flags=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return(this._flags&t.FLAGS.OVER)!==0},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return(this._flags&t.FLAGS.RIGHT_DOWN)!==0},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return(this._flags&t.FLAGS.LEFT_DOWN)!==0},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2}),t}(),P$=function(){function t(){this._tempPoint=new Ht}return t.prototype.recursiveFindHit=function(e,i,r,n,o){var a;if(!i||!i.visible)return!1;var l=e.data.global;o=i.interactive||o;var h=!1,u=o,c=!0;if(i.hitArea)n&&(i.worldTransform.applyInverse(l,this._tempPoint),i.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?h=!0:(n=!1,c=!1)),u=!1;else if(i._mask&&n){var f=i._mask.isMaskData?i._mask.maskObject:i._mask;f&&!(!((a=f.containsPoint)===null||a===void 0)&&a.call(f,l))&&(n=!1)}if(c&&i.interactiveChildren&&i.children)for(var d=i.children,m=d.length-1;m>=0;m--){var v=d[m],g=this.recursiveFindHit(e,v,r,n,u);if(g){if(!v.parent)continue;u=!1,g&&(e.target&&(n=!1),h=!0)}}return o&&(n&&!e.target&&!i.hitArea&&i.containsPoint&&i.containsPoint(l)&&(h=!0),i.interactive&&(h&&!e.target&&(e.target=i),r&&r(e,i,!!h))),h},t.prototype.findHit=function(e,i,r,n){this.recursiveFindHit(e,i,r,n,!1)},t}(),R$={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(t){t?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};ri.mixin(R$);var c_=1,f_={target:null,data:{global:null}},WN=function(t){T$(e,t);function e(i,r){var n=t.call(this)||this;return r=r||{},n.renderer=i,n.autoPreventDefault=r.autoPreventDefault!==void 0?r.autoPreventDefault:!0,n.interactionFrequency=r.interactionFrequency||10,n.mouse=new d_,n.mouse.identifier=c_,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[c_]=n.mouse,n.interactionDataPool=[],n.eventData=new A$,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!("PointerEvent"in globalThis),n.supportsTouchEvents="ontouchstart"in globalThis,n.supportsPointerEvents=!!globalThis.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new P$,n._tempDisplayObject=new NS,n._eventListenerOptions={capture:!0,passive:!1},n._useSystemTicker=r.useSystemTicker!==void 0?r.useSystemTicker:!0,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(i){this._useSystemTicker=i,i?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(i,r){return f_.target=null,f_.data.global=i,r||(r=this.lastObjectRendered),this.processInteractive(f_,r,null,!0),f_.target},e.prototype.setTargetElement=function(i,r){r===void 0&&(r=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=i,this.resolution=r,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Bi.system.add(this.tickerUpdate,this,ps.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(Bi.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var i=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(i.msContentZooming="none",i.msTouchAction="none"):this.supportsPointerEvents&&(i.touchAction="none"),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var i=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(i.msContentZooming="",i.msTouchAction=""):this.supportsPointerEvents&&(i.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(i){this._deltaTime+=i,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var i in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(i)){var r=this.activeInteractionData[i];if(r.originalEvent&&r.pointerType!=="touch"){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(i){i=i||"default";var r=!0;if(globalThis.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(r=!1),this.currentCursorMode!==i){this.currentCursorMode=i;var n=this.cursorStyles[i];if(n)switch(typeof n){case"string":r&&(this.interactionDOMElement.style.cursor=n);break;case"function":n(i);break;case"object":r&&Object.assign(this.interactionDOMElement.style,n);break}else r&&typeof i=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,i)&&(this.interactionDOMElement.style.cursor=i)}},e.prototype.dispatchEvent=function(i,r,n){(!n.stopPropagationHint||i===n.stopsPropagatingAt)&&(n.currentTarget=i,n.type=r,i.emit(r,n),i[r]&&i[r](n))},e.prototype.delayDispatchEvent=function(i,r,n){this.delayedEvents.push({displayObject:i,eventString:r,eventData:n})},e.prototype.mapPositionToPoint=function(i,r,n){var o;this.interactionDOMElement.parentElement?o=this.interactionDOMElement.getBoundingClientRect():o={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var a=1/this.resolution;i.x=(r-o.left)*(this.interactionDOMElement.width/o.width)*a,i.y=(n-o.top)*(this.interactionDOMElement.height/o.height)*a},e.prototype.processInteractive=function(i,r,n,o){var a=this.search.findHit(i,r,n,o),l=this.delayedEvents;if(!l.length)return a;i.stopPropagationHint=!1;var h=l.length;this.delayedEvents=[];for(var u=0;u<h;u++){var c=l[u],f=c.displayObject,d=c.eventString,m=c.eventData;m.stopsPropagatingAt===f&&(m.stopPropagationHint=!0),this.dispatchEvent(f,d,m)}return a},e.prototype.onPointerDown=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i);if(this.autoPreventDefault&&r[0].isNormalized){var n=i.cancelable||!("cancelable"in i);n&&i.preventDefault()}for(var o=r.length,a=0;a<o;a++){var l=r[a],h=this.getInteractionDataForPointerId(l),u=this.configureInteractionEventForDOMEvent(this.eventData,l,h);if(u.data.originalEvent=i,this.processInteractive(u,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",u),l.pointerType==="touch")this.emit("touchstart",u);else if(l.pointerType==="mouse"||l.pointerType==="pen"){var c=l.button===2;this.emit(c?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(i,r,n){var o=i.data,a=i.data.identifier;if(n){if(r.trackedPointers[a]||(r.trackedPointers[a]=new oC(a)),this.dispatchEvent(r,"pointerdown",i),o.pointerType==="touch")this.dispatchEvent(r,"touchstart",i);else if(o.pointerType==="mouse"||o.pointerType==="pen"){var l=o.button===2;l?r.trackedPointers[a].rightDown=!0:r.trackedPointers[a].leftDown=!0,this.dispatchEvent(r,l?"rightdown":"mousedown",i)}}},e.prototype.onPointerComplete=function(i,r,n){var o=this.normalizeToPointerData(i),a=o.length,l=i.target;i.composedPath&&i.composedPath().length>0&&(l=i.composedPath()[0]);for(var h=l!==this.interactionDOMElement?"outside":"",u=0;u<a;u++){var c=o[u],f=this.getInteractionDataForPointerId(c),d=this.configureInteractionEventForDOMEvent(this.eventData,c,f);if(d.data.originalEvent=i,this.processInteractive(d,this.lastObjectRendered,n,r||!h),this.emit(r?"pointercancel":"pointerup"+h,d),c.pointerType==="mouse"||c.pointerType==="pen"){var m=c.button===2;this.emit(m?"rightup"+h:"mouseup"+h,d)}else c.pointerType==="touch"&&(this.emit(r?"touchcancel":"touchend"+h,d),this.releaseInteractionDataForPointerId(c.pointerId))}},e.prototype.onPointerCancel=function(i){this.supportsTouchEvents&&i.pointerType==="touch"||this.onPointerComplete(i,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(i,r){var n=i.data,o=i.data.identifier;r.trackedPointers[o]!==void 0&&(delete r.trackedPointers[o],this.dispatchEvent(r,"pointercancel",i),n.pointerType==="touch"&&this.dispatchEvent(r,"touchcancel",i))},e.prototype.onPointerUp=function(i){this.supportsTouchEvents&&i.pointerType==="touch"||this.onPointerComplete(i,!1,this.processPointerUp)},e.prototype.processPointerUp=function(i,r,n){var o=i.data,a=i.data.identifier,l=r.trackedPointers[a],h=o.pointerType==="touch",u=o.pointerType==="mouse"||o.pointerType==="pen",c=!1;if(u){var f=o.button===2,d=oC.FLAGS,m=f?d.RIGHT_DOWN:d.LEFT_DOWN,v=l!==void 0&&l.flags&m;n?(this.dispatchEvent(r,f?"rightup":"mouseup",i),v&&(this.dispatchEvent(r,f?"rightclick":"click",i),c=!0)):v&&this.dispatchEvent(r,f?"rightupoutside":"mouseupoutside",i),l&&(f?l.rightDown=!1:l.leftDown=!1)}n?(this.dispatchEvent(r,"pointerup",i),h&&this.dispatchEvent(r,"touchend",i),l&&((!u||c)&&this.dispatchEvent(r,"pointertap",i),h&&(this.dispatchEvent(r,"tap",i),l.over=!1))):l&&(this.dispatchEvent(r,"pointerupoutside",i),h&&this.dispatchEvent(r,"touchendoutside",i)),l&&l.none&&delete r.trackedPointers[a]},e.prototype.onPointerMove=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i);(r[0].pointerType==="mouse"||r[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var n=r.length,o=0;o<n;o++){var a=r[o],l=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,l);h.data.originalEvent=i,this.processInteractive(h,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",h),a.pointerType==="touch"&&this.emit("touchmove",h),(a.pointerType==="mouse"||a.pointerType==="pen")&&this.emit("mousemove",h)}r[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(i,r,n){var o=i.data,a=o.pointerType==="touch",l=o.pointerType==="mouse"||o.pointerType==="pen";l&&this.processPointerOverOut(i,r,n),(!this.moveWhenInside||n)&&(this.dispatchEvent(r,"pointermove",i),a&&this.dispatchEvent(r,"touchmove",i),l&&this.dispatchEvent(r,"mousemove",i))},e.prototype.onPointerOut=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i),n=r[0];n.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var o=this.getInteractionDataForPointerId(n),a=this.configureInteractionEventForDOMEvent(this.eventData,n,o);a.data.originalEvent=n,this.processInteractive(a,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",a),n.pointerType==="mouse"||n.pointerType==="pen"?this.emit("mouseout",a):this.releaseInteractionDataForPointerId(o.identifier)}},e.prototype.processPointerOverOut=function(i,r,n){var o=i.data,a=i.data.identifier,l=o.pointerType==="mouse"||o.pointerType==="pen",h=r.trackedPointers[a];n&&!h&&(h=r.trackedPointers[a]=new oC(a)),h!==void 0&&(n&&this.mouseOverRenderer?(h.over||(h.over=!0,this.delayDispatchEvent(r,"pointerover",i),l&&this.delayDispatchEvent(r,"mouseover",i)),l&&this.cursor===null&&(this.cursor=r.cursor)):h.over&&(h.over=!1,this.dispatchEvent(r,"pointerout",this.eventData),l&&this.dispatchEvent(r,"mouseout",i),h.none&&delete r.trackedPointers[a]))},e.prototype.onPointerOver=function(i){if(!(this.supportsTouchEvents&&i.pointerType==="touch")){var r=this.normalizeToPointerData(i),n=r[0],o=this.getInteractionDataForPointerId(n),a=this.configureInteractionEventForDOMEvent(this.eventData,n,o);a.data.originalEvent=n,n.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",a),(n.pointerType==="mouse"||n.pointerType==="pen")&&this.emit("mouseover",a)}},e.prototype.getInteractionDataForPointerId=function(i){var r=i.pointerId,n;return r===c_||i.pointerType==="mouse"?n=this.mouse:this.activeInteractionData[r]?n=this.activeInteractionData[r]:(n=this.interactionDataPool.pop()||new d_,n.identifier=r,this.activeInteractionData[r]=n),n.copyEvent(i),n},e.prototype.releaseInteractionDataForPointerId=function(i){var r=this.activeInteractionData[i];r&&(delete this.activeInteractionData[i],r.reset(),this.interactionDataPool.push(r))},e.prototype.configureInteractionEventForDOMEvent=function(i,r,n){return i.data=n,this.mapPositionToPoint(n.global,r.clientX,r.clientY),r.pointerType==="touch"&&(r.globalX=n.global.x,r.globalY=n.global.y),n.originalEvent=r,i.reset(),i},e.prototype.normalizeToPointerData=function(i){var r=[];if(this.supportsTouchEvents&&i instanceof TouchEvent)for(var n=0,o=i.changedTouches.length;n<o;n++){var a=i.changedTouches[n];typeof a.button=="undefined"&&(a.button=i.touches.length?1:0),typeof a.buttons=="undefined"&&(a.buttons=i.touches.length?1:0),typeof a.isPrimary=="undefined"&&(a.isPrimary=i.touches.length===1&&i.type==="touchstart"),typeof a.width=="undefined"&&(a.width=a.radiusX||1),typeof a.height=="undefined"&&(a.height=a.radiusY||1),typeof a.tiltX=="undefined"&&(a.tiltX=0),typeof a.tiltY=="undefined"&&(a.tiltY=0),typeof a.pointerType=="undefined"&&(a.pointerType="touch"),typeof a.pointerId=="undefined"&&(a.pointerId=a.identifier||0),typeof a.pressure=="undefined"&&(a.pressure=a.force||.5),typeof a.twist=="undefined"&&(a.twist=0),typeof a.tangentialPressure=="undefined"&&(a.tangentialPressure=0),typeof a.layerX=="undefined"&&(a.layerX=a.offsetX=a.clientX),typeof a.layerY=="undefined"&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,r.push(a)}else if(!globalThis.MouseEvent||i instanceof MouseEvent&&(!this.supportsPointerEvents||!(i instanceof globalThis.PointerEvent))){var l=i;typeof l.isPrimary=="undefined"&&(l.isPrimary=!0),typeof l.width=="undefined"&&(l.width=1),typeof l.height=="undefined"&&(l.height=1),typeof l.tiltX=="undefined"&&(l.tiltX=0),typeof l.tiltY=="undefined"&&(l.tiltY=0),typeof l.pointerType=="undefined"&&(l.pointerType="mouse"),typeof l.pointerId=="undefined"&&(l.pointerId=c_),typeof l.pressure=="undefined"&&(l.pressure=.5),typeof l.twist=="undefined"&&(l.twist=0),typeof l.tangentialPressure=="undefined"&&(l.tangentialPressure=0),l.isNormalized=!0,r.push(l)}else r.push(i);return r},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e.extension={name:"interaction",type:[Pt.RendererPlugin,Pt.CanvasRendererPlugin]},e}(Mo.default);var VN=new Tt,jN=4,qN=function(){function t(e){this.renderer=e}return t.prototype.image=function(e,i,r){var n=new Image;return n.src=this.base64(e,i,r),n},t.prototype.base64=function(e,i,r){return this.canvas(e).toDataURL(i,r)},t.prototype.canvas=function(e,i){var r=this.renderer,n,o=!1,a,l=!1;e&&(e instanceof la?a=e:(a=this.renderer.generateTexture(e),l=!0)),a?(n=a.baseTexture.resolution,i=i!=null?i:a.frame,o=!1,r.renderTexture.bind(a)):(n=r.resolution,i||(i=VN,i.width=r.width,i.height=r.height),o=!0,r.renderTexture.bind(null));var h=Math.round(i.width*n),u=Math.round(i.height*n),c=new Z0(h,u,1),f=new Uint8Array(jN*h*u),d=r.gl;d.readPixels(Math.round(i.x*n),Math.round(i.y*n),h,u,d.RGBA,d.UNSIGNED_BYTE,f);var m=c.context.getImageData(0,0,h,u);if(t.arrayPostDivide(f,m.data),c.context.putImageData(m,0,0),o){var v=new Z0(c.width,c.height,1);v.context.scale(1,-1),v.context.drawImage(c.canvas,0,-u),c.destroy(),c=v}return l&&a.destroy(!0),c.canvas},t.prototype.pixels=function(e,i){var r=this.renderer,n,o,a=!1;e&&(e instanceof la?o=e:(o=this.renderer.generateTexture(e),a=!0)),o?(n=o.baseTexture.resolution,i=i!=null?i:o.frame,r.renderTexture.bind(o)):(n=r.resolution,i||(i=VN,i.width=r.width,i.height=r.height),r.renderTexture.bind(null));var l=Math.round(i.width*n),h=Math.round(i.height*n),u=new Uint8Array(jN*l*h),c=r.gl;return c.readPixels(Math.round(i.x*n),Math.round(i.y*n),l,h,c.RGBA,c.UNSIGNED_BYTE,u),a&&o.destroy(!0),t.arrayPostDivide(u,u),u},t.prototype.destroy=function(){this.renderer=null},t.arrayPostDivide=function(e,i){for(var r=0;r<e.length;r+=4){var n=i[r+3]=e[r+3];n!==0?(i[r]=Math.round(Math.min(e[r]*255/n,255)),i[r+1]=Math.round(Math.min(e[r+1]*255/n,255)),i[r+2]=Math.round(Math.min(e[r+2]*255/n,255))):(i[r]=e[r],i[r+1]=e[r+1],i[r+2]=e[r+2])}},t.extension={name:"extract",type:Pt.RendererPlugin},t}();var p_=function(){function t(e,i,r){i===void 0&&(i=!1),this._fn=e,this._once=i,this._thisArg=r,this._next=this._prev=this._owner=null}return t.prototype.detach=function(){return this._owner===null?!1:(this._owner.detach(this),!0)},t}();function XN(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var ha=function(){function t(){this._head=this._tail=void 0}return t.prototype.handlers=function(e){e===void 0&&(e=!1);var i=this._head;if(e)return!!i;for(var r=[];i;)r.push(i),i=i._next;return r},t.prototype.has=function(e){if(!(e instanceof p_))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return e._owner===this},t.prototype.dispatch=function(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var n=this._head;if(!n)return!1;for(;n;)n._once&&this.detach(n),n._fn.apply(n._thisArg,i),n=n._next;return!0},t.prototype.add=function(e,i){if(i===void 0&&(i=null),typeof e!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return XN(this,new p_(e,!1,i))},t.prototype.once=function(e,i){if(i===void 0&&(i=null),typeof e!="function")throw new Error("MiniSignal#once(): First arg must be a Function.");return XN(this,new p_(e,!0,i))},t.prototype.detach=function(e){if(!(e instanceof p_))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return e._owner!==this?this:(e._prev&&(e._prev._next=e._next),e._next&&(e._next._prev=e._prev),e===this._head?(this._head=e._next,e._next===null&&(this._tail=null)):e===this._tail&&(this._tail=e._prev,this._tail._next=null),e._owner=null,this)},t.prototype.detachAll=function(){var e=this._head;if(!e)return this;for(this._head=this._tail=null;e;)e._owner=null,e=e._next;return this},t}();function QN(t,e){e=e||{};for(var i={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=i.parser[e.strictMode?"strict":"loose"].exec(t),n={},o=14;o--;)n[i.key[o]]=r[o]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,function(a,l,h){l&&(n[i.q.name][l]=h)}),n}var lC,m_=null,L$=0,YN=200,O$=204,D$=1223,I$=2;function ZN(){}function KN(t,e,i){e&&e.indexOf(".")===0&&(e=e.substring(1)),e&&(t[e]=i)}function hC(t){return t.toString().replace("object ","")}var li=function(){function t(e,i,r){if(this._dequeue=ZN,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,typeof e!="string"||typeof i!="string")throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,i.indexOf("data:")===0),this.name=e,this.url=i,this.extension=this._getExtension(),this.data=null,this.crossOrigin=r.crossOrigin===!0?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=ZN,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new ha,this.onProgress=new ha,this.onComplete=new ha,this.onAfterMiddleware=new ha}return t.setExtensionLoadType=function(e,i){KN(t._loadTypeMap,e,i)},t.setExtensionXhrType=function(e,i){KN(t._xhrTypeMap,e,i)},Object.defineProperty(t.prototype,"isDataUrl",{get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),t.prototype.complete=function(){this._clearEvents(),this._finish()},t.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},t.prototype.load=function(e){var i=this;if(!this.isLoading){if(this.isComplete){e&&setTimeout(function(){return e(i)},1);return}else e&&this.onComplete.once(e);switch(this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:typeof lC=="undefined"&&(lC=!!(globalThis.XDomainRequest&&!("withCredentials"in new XMLHttpRequest))),lC&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},t.prototype._hasFlag=function(e){return(this._flags&e)!==0},t.prototype._setFlag=function(e,i){this._flags=i?this._flags|e:this._flags&~e},t.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},t.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t.prototype._loadElement=function(e){this.metadata.loadElement?this.data=this.metadata.loadElement:e==="image"&&typeof globalThis.Image!="undefined"?this.data=new Image:this.data=document.createElement(e),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t.prototype._loadSourceElement=function(e){if(this.metadata.loadElement?this.data=this.metadata.loadElement:e==="audio"&&typeof globalThis.Audio!="undefined"?this.data=new Audio:this.data=document.createElement(e),this.data===null){this.abort("Unsupported element: "+e);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var i=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(e,this.url[r],Array.isArray(i)?i[r]:i));else{var i=this.metadata.mimeType;this.data.appendChild(this._createSource(e,this.url,Array.isArray(i)?i[0]:i))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t.prototype._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;this.crossOrigin==="use-credentials"&&(e.withCredentials=!0),e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},t.prototype._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var e=this.xhr=new globalThis.XDomainRequest;e.timeout=this.timeout||5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXhrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout(function(){return e.send()},1)},t.prototype._createSource=function(e,i,r){r||(r=e+"/"+this._getExtension(i));var n=document.createElement("source");return n.src=i,n.type=r,n},t.prototype._onError=function(e){this.abort("Failed to load element using: "+e.target.nodeName)},t.prototype._onProgress=function(e){e&&e.lengthComputable&&this.onProgress.dispatch(this,e.loaded/e.total)},t.prototype._onTimeout=function(){this.abort("Load timed out.")},t.prototype._xhrOnError=function(){var e=this.xhr;this.abort(hC(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},t.prototype._xhrOnTimeout=function(){var e=this.xhr;this.abort(hC(e)+" Request timed out.")},t.prototype._xhrOnAbort=function(){var e=this.xhr;this.abort(hC(e)+" Request was aborted by the user.")},t.prototype._xhrOnLoad=function(){var e=this.xhr,i="",r=typeof e.status=="undefined"?YN:e.status;(e.responseType===""||e.responseType==="text"||typeof e.responseType=="undefined")&&(i=e.responseText),r===L$&&(i.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=YN:r===D$&&(r=O$);var n=r/100|0;if(n===I$)if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=i,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(i),this.type=t.TYPE.JSON}catch(l){this.abort("Error trying to parse loaded json: "+l);return}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(globalThis.DOMParser){var o=new DOMParser;this.data=o.parseFromString(i,"text/xml")}else{var a=document.createElement("div");a.innerHTML=i,this.data=a}this.type=t.TYPE.XML}catch(l){this.abort("Error trying to parse loaded xml: "+l);return}else this.data=e.response||i;else{this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL);return}this.complete()},t.prototype._determineCrossOrigin=function(e,i){if(e.indexOf("data:")===0)return"";if(globalThis.origin!==globalThis.location.origin)return"anonymous";i=i||globalThis.location,m_||(m_=document.createElement("a")),m_.href=e;var r=QN(m_.href,{strictMode:!0}),n=!r.port&&i.port===""||r.port===i.port,o=r.protocol?r.protocol+":":"";return r.host!==i.hostname||!n||o!==i.protocol?"anonymous":""},t.prototype._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},t.prototype._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},t.prototype._getExtension=function(e){e===void 0&&(e=this.url);var i="";if(this.isDataUrl){var r=e.indexOf("/");i=e.substring(r+1,e.indexOf(";",r))}else{var n=e.indexOf("?"),o=e.indexOf("#"),a=Math.min(n>-1?n:e.length,o>-1?o:e.length);e=e.substring(0,a),i=e.substring(e.lastIndexOf(".")+1)}return i.toLowerCase()},t.prototype._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},t}();(function(t){(function(e){e[e.NONE=0]="NONE",e[e.DATA_URL=1]="DATA_URL",e[e.COMPLETE=2]="COMPLETE",e[e.LOADING=4]="LOADING"})(t.STATUS_FLAGS||(t.STATUS_FLAGS={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JSON=1]="JSON",e[e.XML=2]="XML",e[e.IMAGE=3]="IMAGE",e[e.AUDIO=4]="AUDIO",e[e.VIDEO=5]="VIDEO",e[e.TEXT=6]="TEXT"}(t.TYPE||(t.TYPE={})),function(e){e[e.XHR=1]="XHR",e[e.IMAGE=2]="IMAGE",e[e.AUDIO=3]="AUDIO",e[e.VIDEO=4]="VIDEO"}(t.LOAD_TYPE||(t.LOAD_TYPE={})),function(e){e.DEFAULT="text",e.BUFFER="arraybuffer",e.BLOB="blob",e.DOCUMENT="document",e.JSON="json",e.TEXT="text"}(t.XHR_RESPONSE_TYPE||(t.XHR_RESPONSE_TYPE={})),t._loadTypeMap={gif:t.LOAD_TYPE.IMAGE,png:t.LOAD_TYPE.IMAGE,bmp:t.LOAD_TYPE.IMAGE,jpg:t.LOAD_TYPE.IMAGE,jpeg:t.LOAD_TYPE.IMAGE,tif:t.LOAD_TYPE.IMAGE,tiff:t.LOAD_TYPE.IMAGE,webp:t.LOAD_TYPE.IMAGE,tga:t.LOAD_TYPE.IMAGE,avif:t.LOAD_TYPE.IMAGE,svg:t.LOAD_TYPE.IMAGE,"svg+xml":t.LOAD_TYPE.IMAGE,mp3:t.LOAD_TYPE.AUDIO,ogg:t.LOAD_TYPE.AUDIO,wav:t.LOAD_TYPE.AUDIO,mp4:t.LOAD_TYPE.VIDEO,webm:t.LOAD_TYPE.VIDEO},t._xhrTypeMap={xhtml:t.XHR_RESPONSE_TYPE.DOCUMENT,html:t.XHR_RESPONSE_TYPE.DOCUMENT,htm:t.XHR_RESPONSE_TYPE.DOCUMENT,xml:t.XHR_RESPONSE_TYPE.DOCUMENT,tmx:t.XHR_RESPONSE_TYPE.DOCUMENT,svg:t.XHR_RESPONSE_TYPE.DOCUMENT,tsx:t.XHR_RESPONSE_TYPE.DOCUMENT,gif:t.XHR_RESPONSE_TYPE.BLOB,png:t.XHR_RESPONSE_TYPE.BLOB,bmp:t.XHR_RESPONSE_TYPE.BLOB,jpg:t.XHR_RESPONSE_TYPE.BLOB,jpeg:t.XHR_RESPONSE_TYPE.BLOB,tif:t.XHR_RESPONSE_TYPE.BLOB,tiff:t.XHR_RESPONSE_TYPE.BLOB,webp:t.XHR_RESPONSE_TYPE.BLOB,tga:t.XHR_RESPONSE_TYPE.BLOB,avif:t.XHR_RESPONSE_TYPE.BLOB,json:t.XHR_RESPONSE_TYPE.JSON,text:t.XHR_RESPONSE_TYPE.TEXT,txt:t.XHR_RESPONSE_TYPE.TEXT,ttf:t.XHR_RESPONSE_TYPE.BUFFER,otf:t.XHR_RESPONSE_TYPE.BUFFER},t.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="})(li||(li={}));function ch(){}function k$(t){return function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];if(t===null)throw new Error("Callback was already called.");var o=t;t=null,o.apply(this,r)}}var F$=function(){function t(e,i){this.data=e,this.callback=i}return t}(),uC=function(){function t(e,i){var r=this;if(i===void 0&&(i=1),this.workers=0,this.saturated=ch,this.unsaturated=ch,this.empty=ch,this.drain=ch,this.error=ch,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(n,o,a){if(a&&typeof a!="function")throw new Error("task callback must be a function");if(r.started=!0,n==null&&r.idle()){setTimeout(function(){return r.drain()},1);return}var l=new F$(n,typeof a=="function"?a:ch);o?r._tasks.unshift(l):r._tasks.push(l),setTimeout(r.process,1)},this.process=function(){for(;!r.paused&&r.workers<r.concurrency&&r._tasks.length;){var n=r._tasks.shift();r._tasks.length===0&&r.empty(),r.workers+=1,r.workers===r.concurrency&&r.saturated(),r._worker(n.data,k$(r._next(n)))}},this._worker=e,i===0)throw new Error("Concurrency must not be zero");this.concurrency=i,this.buffer=i/4}return t.prototype._next=function(e){var i=this;return function(){for(var r=arguments,n=[],o=0;o<arguments.length;o++)n[o]=r[o];i.workers-=1,e.callback.apply(e,n),n[0]!=null&&i.error(n[0],e.data),i.workers<=i.concurrency-i.buffer&&i.unsaturated(),i.idle()&&i.drain(),i.process()}},t.prototype.push=function(e,i){this._insert(e,!1,i)},t.prototype.kill=function(){this.workers=0,this.drain=ch,this.started=!1,this._tasks=[]},t.prototype.unshift=function(e,i){this._insert(e,!0,i)},t.prototype.length=function(){return this._tasks.length},t.prototype.running=function(){return this.workers},t.prototype.idle=function(){return this._tasks.length+this.workers===0},t.prototype.pause=function(){this.paused!==!0&&(this.paused=!0)},t.prototype.resume=function(){if(this.paused!==!1){this.paused=!1;for(var e=1;e<=this.concurrency;e++)this.process()}},t.eachSeries=function(e,i,r,n){var o=0,a=e.length;function l(h){if(h||o===a){r&&r(h);return}n?setTimeout(function(){i(e[o++],l)},1):i(e[o++],l)}l()},t.queue=function(e,i){return new t(e,i)},t}(),cC=100,B$=/(#[\w-]+)?$/,g_=function(){function t(e,i){var r=this;e===void 0&&(e=""),i===void 0&&(i=10),this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,u){return r._loadResource(h,u)},this.resources={},this.baseUrl=e,this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,u){return r._loadResource(h,u)},this._queue=uC.queue(this._boundLoadResource,i),this._queue.pause(),this.resources={},this.onProgress=new ha,this.onError=new ha,this.onLoad=new ha,this.onStart=new ha,this.onComplete=new ha;for(var n=0;n<t._plugins.length;++n){var o=t._plugins[n],a=o.pre,l=o.use;a&&this.pre(a),l&&this.use(l)}this._protected=!1}return t.prototype._add=function(e,i,r,n){if(this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[e])throw new Error('Resource named "'+e+'" already exists.');if(i=this._prepareUrl(i),this.resources[e]=new li(e,i,r),typeof n=="function"&&this.resources[e].onAfterMiddleware.once(n),this.loading){for(var o=r.parentResource,a=[],l=0;l<o.children.length;++l)o.children[l].isComplete||a.push(o.children[l]);var h=o.progressChunk*(a.length+1),u=h/(a.length+2);o.children.push(this.resources[e]),o.progressChunk=u;for(var l=0;l<a.length;++l)a[l].progressChunk=u;this.resources[e].progressChunk=u}return this._queue.push(this.resources[e]),this},t.prototype.pre=function(e){return this._beforeMiddleware.push(e),this},t.prototype.use=function(e){return this._afterMiddleware.push(e),this},t.prototype.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var e in this.resources){var i=this.resources[e];i._onLoadBinding&&i._onLoadBinding.detach(),i.isLoading&&i.abort("loader reset")}return this.resources={},this},t.prototype.load=function(e){if(Yi("6.5.0","@pixi/loaders is being replaced with @pixi/assets in the next major release."),typeof e=="function"&&this.onComplete.once(e),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var i=this._queue._tasks.length,r=cC/i,n=0;n<this._queue._tasks.length;++n)this._queue._tasks[n].data.progressChunk=r;this._onStart(),this._queue.resume()}return this},Object.defineProperty(t.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e},enumerable:!1,configurable:!0}),t.prototype._prepareUrl=function(e){var i=QN(e,{strictMode:!0}),r;if(i.protocol||!i.path||e.indexOf("//")===0?r=e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&e.charAt(0)!=="/"?r=this.baseUrl+"/"+e:r=this.baseUrl+e,this.defaultQueryString){var n=B$.exec(r)[0];r=r.slice(0,r.length-n.length),r.indexOf("?")!==-1?r+="&"+this.defaultQueryString:r+="?"+this.defaultQueryString,r+=n}return r},t.prototype._loadResource=function(e,i){var r=this;e._dequeue=i,uC.eachSeries(this._beforeMiddleware,function(n,o){n.call(r,e,function(){o(e.isComplete?{}:null)})},function(){e.isComplete?r._onLoad(e):(e._onLoadBinding=e.onComplete.once(r._onLoad,r),e.load())},!0)},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=cC,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(e){var i=this;e._onLoadBinding=null,this._resourcesParsing.push(e),e._dequeue(),uC.eachSeries(this._afterMiddleware,function(r,n){r.call(i,e,n)},function(){e.onAfterMiddleware.dispatch(e),i.progress=Math.min(cC,i.progress+e.progressChunk),i.onProgress.dispatch(i,e),e.error?i.onError.dispatch(e.error,i,e):i.onLoad.dispatch(i,e),i._resourcesParsing.splice(i._resourcesParsing.indexOf(e),1),i._queue.idle()&&i._resourcesParsing.length===0&&i._onComplete()},!0)},t.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(t,"shared",{get:function(){var e=t._shared;return e||(e=new t,e._protected=!0,t._shared=e),e},enumerable:!1,configurable:!0}),t.registerPlugin=function(e){return Yi("6.5.0","Loader.registerPlugin() is deprecated, use extensions.add() instead."),Nn.add({type:Pt.Loader,ref:e}),t},t._plugins=[],t}();Nn.handleByList(Pt.Loader,g_._plugins);g_.prototype.add=function(e,i,r,n){if(Array.isArray(e)){for(var o=0;o<e.length;++o)this.add(e[o]);return this}if(typeof e=="object"&&(r=e,n=i||r.callback||r.onComplete,i=r.url,e=r.name||r.key||r.url),typeof i!="string"&&(n=r,r=i,i=e),typeof i!="string")throw new Error("No url passed to add resource to loader.");return typeof r=="function"&&(n=r,r=null),this._add(e,i,r,n)};var JN=function(){function t(){}return t.init=function(e){e=Object.assign({sharedLoader:!1},e),this.loader=e.sharedLoader?g_.shared:new g_},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.extension=Pt.Application,t}(),N$=function(){function t(){}return t.add=function(){li.setExtensionLoadType("svg",li.LOAD_TYPE.XHR),li.setExtensionXhrType("svg",li.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,i){if(e.data&&(e.type===li.TYPE.IMAGE||e.extension==="svg")){var r=e.data,n=e.url,o=e.name,a=e.metadata;lt.fromLoader(r,n,o,a).then(function(l){e.texture=l,i()}).catch(i)}else i()},t.extension=Pt.Loader,t}(),U$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function G$(t){for(var e="",i=0;i<t.length;){for(var r=[0,0,0],n=[0,0,0,0],o=0;o<r.length;++o)i<t.length?r[o]=t.charCodeAt(i++)&255:r[o]=0;n[0]=r[0]>>2,n[1]=(r[0]&3)<<4|r[1]>>4,n[2]=(r[1]&15)<<2|r[2]>>6,n[3]=r[2]&63;var a=i-(t.length-1);switch(a){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64;break}for(var o=0;o<n.length;++o)e+=U$.charAt(n[o])}return e}function z$(t,e){if(!t.data){e();return}if(t.xhr&&t.xhrType===li.XHR_RESPONSE_TYPE.BLOB){if(!self.Blob||typeof t.data=="string"){var i=t.xhr.getResponseHeader("content-type");if(i&&i.indexOf("image")===0){t.data=new Image,t.data.src="data:"+i+";base64,"+G$(t.xhr.responseText),t.type=li.TYPE.IMAGE,t.data.onload=function(){t.data.onload=null,e()};return}}else if(t.data.type.indexOf("image")===0){var r=globalThis.URL||globalThis.webkitURL,n=r.createObjectURL(t.data);t.blob=t.data,t.data=new Image,t.data.src=n,t.type=li.TYPE.IMAGE,t.data.onload=function(){r.revokeObjectURL(n),t.data.onload=null,e()};return}}e()}var H$=function(){function t(){}return t.extension=Pt.Loader,t.use=z$,t}();Nn.add(N$,H$);var Kt,Rt;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR"})(Rt||(Rt={}));var x_=(Kt={},Kt[Rt.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,Kt[Rt.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,Kt[Rt.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,Kt[Rt.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,Kt[Rt.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,Kt[Rt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,Kt[Rt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,Kt[Rt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,Kt[Rt.COMPRESSED_R11_EAC]=.5,Kt[Rt.COMPRESSED_SIGNED_R11_EAC]=.5,Kt[Rt.COMPRESSED_RG11_EAC]=1,Kt[Rt.COMPRESSED_SIGNED_RG11_EAC]=1,Kt[Rt.COMPRESSED_RGB8_ETC2]=.5,Kt[Rt.COMPRESSED_RGBA8_ETC2_EAC]=1,Kt[Rt.COMPRESSED_SRGB8_ETC2]=.5,Kt[Rt.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,Kt[Rt.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,Kt[Rt.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,Kt[Rt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,Kt[Rt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,Kt[Rt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,Kt[Rt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,Kt[Rt.COMPRESSED_RGB_ETC1_WEBGL]=.5,Kt[Rt.COMPRESSED_RGB_ATC_WEBGL]=.5,Kt[Rt.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,Kt[Rt.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,Kt[Rt.COMPRESSED_RGBA_ASTC_4x4_KHR]=1,Kt);var dC=function(t,e){return dC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},dC(t,e)};function iU(t,e){dC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}function W$(t,e,i,r){function n(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(c){try{u(r.next(c))}catch(f){a(f)}}function h(c){try{u(r.throw(c))}catch(f){a(f)}}function u(c){c.done?o(c.value):n(c.value).then(l,h)}u((r=r.apply(t,e||[])).next())})}function V$(t,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(u){return function(c){return h([u,c])}}function h(u){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=u[0]&2?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){i=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(u[0]===6&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(c){u=[6,c],n=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var j$=function(t){iU(e,t);function e(i,r){r===void 0&&(r={width:1,height:1,autoLoad:!0});var n=this,o,a;return typeof i=="string"?(o=i,a=new Uint8Array):(o=null,a=i),n=t.call(this,a,r)||this,n.origin=o,n.buffer=a?new h_(a):null,n.origin&&r.autoLoad!==!1&&n.load(),a&&a.length&&(n.loaded=!0,n.onBlobLoaded(n.buffer.rawBinaryData)),n}return e.prototype.onBlobLoaded=function(i){},e.prototype.load=function(){return W$(this,void 0,Promise,function(){var i,r,n;return V$(this,function(o){switch(o.label){case 0:return[4,fetch(this.origin)];case 1:return i=o.sent(),[4,i.blob()];case 2:return r=o.sent(),[4,r.arrayBuffer()];case 3:return n=o.sent(),this.data=new Uint32Array(n),this.buffer=new h_(n),this.loaded=!0,this.onBlobLoaded(n),this.update(),[2,this]}})})},e}(lh),pC=function(t){iU(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.format=r.format,n.levels=r.levels||1,n._width=r.width,n._height=r.height,n._extension=e._formatToExtension(n.format),(r.levelBuffers||n.buffer)&&(n._levelBuffers=r.levelBuffers||e._createLevelBuffers(i instanceof Uint8Array?i:n.buffer.uint8View,n.format,n.levels,4,4,n.width,n.height)),n}return e.prototype.upload=function(i,r,n){var o=i.gl,a=i.context.extensions[this._extension];if(!a)throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var l=0,h=this.levels;l<h;l++){var u=this._levelBuffers[l],c=u.levelID,f=u.levelWidth,d=u.levelHeight,m=u.levelBuffer;o.compressedTexImage2D(o.TEXTURE_2D,c,this.format,f,d,0,m)}return!0},e.prototype.onBlobLoaded=function(){this._levelBuffers=e._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},e._formatToExtension=function(i){if(i>=33776&&i<=33779)return"s3tc";if(i>=37488&&i<=37497)return"etc";if(i>=35840&&i<=35843)return"pvrtc";if(i>=36196)return"etc1";if(i>=35986&&i<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},e._createLevelBuffers=function(i,r,n,o,a,l,h){for(var u=new Array(n),c=i.byteOffset,f=l,d=h,m=f+o-1&~(o-1),v=d+a-1&~(a-1),g=m*v*x_[r],p=0;p<n;p++)u[p]={levelID:p,levelWidth:n>1?f:m,levelHeight:n>1?d:v,levelBuffer:new Uint8Array(i.buffer,c,g)},c+=g,f=f>>1||1,d=d>>1||1,m=f+o-1&~(o-1),v=d+a-1&~(a-1),g=m*v*x_[r];return u},e}(j$),rU=function(){function t(){}return t.use=function(e,i){var r=e.data,n=this;if(e.type===li.TYPE.JSON&&r&&r.cacheID&&r.textures){for(var o=r.textures,a=void 0,l=void 0,h=0,u=o.length;h<u;h++){var c=o[h],f=c.src,d=c.format;if(d||(l=f),t.textureFormats[d]){a=f;break}}if(a=a||l,!a){i(new Error("Cannot load compressed-textures in "+e.url+", make sure you provide a fallback"));return}if(a===e.url){i(new Error("URL of compressed texture cannot be the same as the manifest's URL"));return}var m={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},v=sa.resolve(e.url.replace(n.baseUrl,""),a),g=r.cacheID;n.add(g,v,m,function(p){if(p.error){i(p.error);return}var _=p.texture,x=_===void 0?null:_,b=p.textures,y=b===void 0?{}:b;Object.assign(e,{texture:x,textures:y}),i()})}else i()},Object.defineProperty(t,"textureExtensions",{get:function(){if(!t._textureExtensions){var e=Fe.ADAPTER.createCanvas(),i=e.getContext("webgl");if(!i)return console.warn("WebGL not available for compressed textures. Silently failing."),{};var r={s3tc:i.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:i.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:i.getExtension("WEBGL_compressed_texture_etc"),etc1:i.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:i.getExtension("WEBGL_compressed_texture_atc"),astc:i.getExtension("WEBGL_compressed_texture_astc")};t._textureExtensions=r}return t._textureExtensions},enumerable:!1,configurable:!0}),Object.defineProperty(t,"textureFormats",{get:function(){if(!t._textureFormats){var e=t.textureExtensions;t._textureFormats={};for(var i in e){var r=e[i];r&&Object.assign(t._textureFormats,Object.getPrototypeOf(r))}}return t._textureFormats},enumerable:!1,configurable:!0}),t.extension=Pt.Loader,t}();function nU(t,e,i){var r={textures:{},texture:null};if(!e)return r;var n=e.map(function(o){return new lt(new At(o,Object.assign({mipmap:$r.OFF,alphaMode:_n.NO_PREMULTIPLIED_ALPHA},i)))});return n.forEach(function(o,a){var l=o.baseTexture,h=t+"-"+(a+1);At.addToCache(l,h),lt.addToCache(o,h),a===0&&(At.addToCache(l,t),lt.addToCache(o,t),r.texture=o),r.textures[h]=o}),r}var _d,zs,fC=4,v_=124,q$=32,$N=20,X$=542327876,__={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Y$={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},y_={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},Ws;(function(t){t[t.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",t[t.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",t[t.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",t[t.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",t[t.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",t[t.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",t[t.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",t[t.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",t[t.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",t[t.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",t[t.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",t[t.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",t[t.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",t[t.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",t[t.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",t[t.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",t[t.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",t[t.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",t[t.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",t[t.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",t[t.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",t[t.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",t[t.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",t[t.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",t[t.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",t[t.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",t[t.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",t[t.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",t[t.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",t[t.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",t[t.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",t[t.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",t[t.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",t[t.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",t[t.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",t[t.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",t[t.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",t[t.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",t[t.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",t[t.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",t[t.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",t[t.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",t[t.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",t[t.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",t[t.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",t[t.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",t[t.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",t[t.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",t[t.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",t[t.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",t[t.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",t[t.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",t[t.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",t[t.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",t[t.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",t[t.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",t[t.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",t[t.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",t[t.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",t[t.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",t[t.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",t[t.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",t[t.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",t[t.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",t[t.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",t[t.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",t[t.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",t[t.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",t[t.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",t[t.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",t[t.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",t[t.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",t[t.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",t[t.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",t[t.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",t[t.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",t[t.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",t[t.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",t[t.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",t[t.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",t[t.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",t[t.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",t[t.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",t[t.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",t[t.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",t[t.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",t[t.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",t[t.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",t[t.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",t[t.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",t[t.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",t[t.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",t[t.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",t[t.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",t[t.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",t[t.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",t[t.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",t[t.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",t[t.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",t[t.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",t[t.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",t[t.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",t[t.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",t[t.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",t[t.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",t[t.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",t[t.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",t[t.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",t[t.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",t[t.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",t[t.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",t[t.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"})(Ws||(Ws={}));var mC;(function(t){t[t.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",t[t.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",t[t.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"})(mC||(mC={}));var Z$=1,K$=2,Q$=4,J$=64,$$=512,eee=131072,tee=827611204,iee=861165636,ree=894720068,nee=808540228,see=4,oee=(_d={},_d[tee]=Rt.COMPRESSED_RGBA_S3TC_DXT1_EXT,_d[iee]=Rt.COMPRESSED_RGBA_S3TC_DXT3_EXT,_d[ree]=Rt.COMPRESSED_RGBA_S3TC_DXT5_EXT,_d),aee=(zs={},zs[Ws.DXGI_FORMAT_BC1_TYPELESS]=Rt.COMPRESSED_RGBA_S3TC_DXT1_EXT,zs[Ws.DXGI_FORMAT_BC1_UNORM]=Rt.COMPRESSED_RGBA_S3TC_DXT1_EXT,zs[Ws.DXGI_FORMAT_BC2_TYPELESS]=Rt.COMPRESSED_RGBA_S3TC_DXT3_EXT,zs[Ws.DXGI_FORMAT_BC2_UNORM]=Rt.COMPRESSED_RGBA_S3TC_DXT3_EXT,zs[Ws.DXGI_FORMAT_BC3_TYPELESS]=Rt.COMPRESSED_RGBA_S3TC_DXT5_EXT,zs[Ws.DXGI_FORMAT_BC3_UNORM]=Rt.COMPRESSED_RGBA_S3TC_DXT5_EXT,zs[Ws.DXGI_FORMAT_BC1_UNORM_SRGB]=Rt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,zs[Ws.DXGI_FORMAT_BC2_UNORM_SRGB]=Rt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,zs[Ws.DXGI_FORMAT_BC3_UNORM_SRGB]=Rt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,zs);function lee(t){var e=new Uint32Array(t),i=e[0];if(i!==X$)throw new Error("Invalid DDS file magic word");var r=new Uint32Array(t,0,v_/Uint32Array.BYTES_PER_ELEMENT),n=r[__.HEIGHT],o=r[__.WIDTH],a=r[__.MIPMAP_COUNT],l=new Uint32Array(t,__.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,q$/Uint32Array.BYTES_PER_ELEMENT),h=l[Z$];if(h&Q$){var u=l[Y$.FOURCC];if(u!==nee){var c=oee[u],f=fC+v_,d=new Uint8Array(t,f),m=new pC(d,{format:c,width:o,height:n,levels:a});return[m]}var v=fC+v_,g=new Uint32Array(e.buffer,v,$N/Uint32Array.BYTES_PER_ELEMENT),p=g[y_.DXGI_FORMAT],_=g[y_.RESOURCE_DIMENSION],x=g[y_.MISC_FLAG],b=g[y_.ARRAY_SIZE],y=aee[p];if(y===void 0)throw new Error("DDSParser cannot parse texture data with DXGI format "+p);if(x===see)throw new Error("DDSParser does not support cubemap textures");if(_===mC.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSParser does not supported 3D texture data");var w=new Array,S=fC+v_+$N;if(b===1)w.push(new Uint8Array(t,S));else{for(var R=x_[y],E=0,T=o,A=n,C=0;C<a;C++){var M=Math.max(1,T+3&-4),D=Math.max(1,A+3&-4),O=M*D*R;E+=O,T=T>>>1,A=A>>>1}for(var P=S,C=0;C<b;C++)w.push(new Uint8Array(t,P,E)),P+=E}return w.map(function(L){return new pC(L,{format:y,width:o,height:n,levels:a})})}throw h&J$?new Error("DDSParser does not support uncompressed texture data."):h&$$?new Error("DDSParser does not supported YUV uncompressed texture data."):h&eee?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&K$?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var sl,ua,yd,eU=[171,75,84,88,32,49,49,187,13,10,26,10],hee=67305985,Hs={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},gC=64,tU=(sl={},sl[ht.UNSIGNED_BYTE]=1,sl[ht.UNSIGNED_SHORT]=2,sl[ht.INT]=4,sl[ht.UNSIGNED_INT]=4,sl[ht.FLOAT]=4,sl[ht.HALF_FLOAT]=8,sl),uee=(ua={},ua[Oe.RGBA]=4,ua[Oe.RGB]=3,ua[Oe.RG]=2,ua[Oe.RED]=1,ua[Oe.LUMINANCE]=1,ua[Oe.LUMINANCE_ALPHA]=2,ua[Oe.ALPHA]=1,ua),cee=(yd={},yd[ht.UNSIGNED_SHORT_4_4_4_4]=2,yd[ht.UNSIGNED_SHORT_5_5_5_1]=2,yd[ht.UNSIGNED_SHORT_5_6_5]=2,yd);function fee(t,e,i){i===void 0&&(i=!1);var r=new DataView(e);if(!dee(t,r))return null;var n=r.getUint32(Hs.ENDIANNESS,!0)===hee,o=r.getUint32(Hs.GL_TYPE,n),a=r.getUint32(Hs.GL_FORMAT,n),l=r.getUint32(Hs.GL_INTERNAL_FORMAT,n),h=r.getUint32(Hs.PIXEL_WIDTH,n),u=r.getUint32(Hs.PIXEL_HEIGHT,n)||1,c=r.getUint32(Hs.PIXEL_DEPTH,n)||1,f=r.getUint32(Hs.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=r.getUint32(Hs.NUMBER_OF_FACES,n),m=r.getUint32(Hs.NUMBER_OF_MIPMAP_LEVELS,n),v=r.getUint32(Hs.BYTES_OF_KEY_VALUE_DATA,n);if(u===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(f!==1)throw new Error("WebGL does not support array textures");var g=4,p=4,_=h+3&-4,x=u+3&-4,b=new Array(f),y=h*u;o===0&&(y=_*x);var w;if(o!==0?tU[o]?w=tU[o]*uee[a]:w=cee[o]:w=x_[l],w===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var S=i?mee(r,v,n):null,R=y*w,E=R,T=h,A=u,C=_,M=x,D=gC+v,O=0;O<m;O++){for(var P=r.getUint32(D,n),L=D+4,I=0;I<f;I++){var k=b[I];k||(k=b[I]=new Array(m)),k[O]={levelID:O,levelWidth:m>1||o!==0?T:C,levelHeight:m>1||o!==0?A:M,levelBuffer:new Uint8Array(e,L,E)},L+=E}D+=P+4,D=D%4!==0?D+4-D%4:D,T=T>>1||1,A=A>>1||1,C=T+g-1&~(g-1),M=A+p-1&~(p-1),E=C*M*w}return o!==0?{uncompressed:b.map(function(B){var F=B[0].levelBuffer,W=!1;return o===ht.FLOAT?F=new Float32Array(B[0].levelBuffer.buffer,B[0].levelBuffer.byteOffset,B[0].levelBuffer.byteLength/4):o===ht.UNSIGNED_INT?(W=!0,F=new Uint32Array(B[0].levelBuffer.buffer,B[0].levelBuffer.byteOffset,B[0].levelBuffer.byteLength/4)):o===ht.INT&&(W=!0,F=new Int32Array(B[0].levelBuffer.buffer,B[0].levelBuffer.byteOffset,B[0].levelBuffer.byteLength/4)),{resource:new lh(F,{width:B[0].levelWidth,height:B[0].levelHeight}),type:o,format:W?pee(a):a}}),kvData:S}:{compressed:b.map(function(B){return new pC(null,{format:l,width:h,height:u,levels:m,levelBuffers:B})}),kvData:S}}function dee(t,e){for(var i=0;i<eU.length;i++)if(e.getUint8(i)!==eU[i])return console.error(t+" is not a valid *.ktx file!"),!1;return!0}function pee(t){switch(t){case Oe.RGBA:return Oe.RGBA_INTEGER;case Oe.RGB:return Oe.RGB_INTEGER;case Oe.RG:return Oe.RG_INTEGER;case Oe.RED:return Oe.RED_INTEGER;default:return t}}function mee(t,e,i){for(var r=new Map,n=0;n<e;){var o=t.getUint32(gC+n,i),a=gC+n+4,l=3-(o+3)%4;if(o===0||o>e-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}for(var h=0;h<o&&t.getUint8(a+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}var u=new TextDecoder().decode(new Uint8Array(t.buffer,a,h)),c=new DataView(t.buffer,a+h+1,o-h-1);r.set(u,c),n+=4+o+l}return r}li.setExtensionXhrType("dds",li.XHR_RESPONSE_TYPE.BUFFER);var sU=function(){function t(){}return t.use=function(e,i){if(e.extension==="dds"&&e.data)try{Object.assign(e,nU(e.name||e.url,lee(e.data),e.metadata))}catch(r){i(r);return}i()},t.extension=Pt.Loader,t}();li.setExtensionXhrType("ktx",li.XHR_RESPONSE_TYPE.BUFFER);var oU=function(){function t(){}return t.use=function(e,i){if(e.extension==="ktx"&&e.data)try{var r=e.name||e.url,n=fee(r,e.data,this.loadKeyValueData),o=n.compressed,a=n.uncompressed,l=n.kvData;if(o){var h=nU(r,o,e.metadata);if(l&&h.textures)for(var u in h.textures)h.textures[u].baseTexture.ktxKeyValueData=l;Object.assign(e,h)}else if(a){var c={};a.forEach(function(f,d){var m=new lt(new At(f.resource,{mipmap:$r.OFF,alphaMode:_n.NO_PREMULTIPLIED_ALPHA,type:f.type,format:f.format})),v=r+"-"+(d+1);l&&(m.baseTexture.ktxKeyValueData=l),At.addToCache(m.baseTexture,v),lt.addToCache(m,v),d===0&&(c[r]=m,At.addToCache(m.baseTexture,r),lt.addToCache(m,r)),c[v]=m}),Object.assign(e,{textures:c})}}catch(f){i(f);return}i()},t.extension=Pt.Loader,t.loadKeyValueData=!1,t}();var vC=function(t,e){return vC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},vC(t,e)};function lU(t,e){vC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var TEe=function(t){lU(e,t);function e(i,r,n,o){i===void 0&&(i=1500),n===void 0&&(n=16384),o===void 0&&(o=!1);var a=t.call(this)||this,l=16384;return n>l&&(n=l),a._properties=[!1,!0,!1,!1,!1],a._maxSize=i,a._batchSize=n,a._buffers=null,a._bufferUpdateIDs=[],a._updateID=0,a.interactiveChildren=!1,a.blendMode=at.NORMAL,a.autoResize=o,a.roundPixels=!0,a.baseTexture=null,a.setProperties(r),a._tint=0,a.tintRgb=new Float32Array(4),a.tint=16777215,a}return e.prototype.setProperties=function(i){i&&(this._properties[0]="vertices"in i||"scale"in i?!!i.vertices||!!i.scale:this._properties[0],this._properties[1]="position"in i?!!i.position:this._properties[1],this._properties[2]="rotation"in i?!!i.rotation:this._properties[2],this._properties[3]="uvs"in i?!!i.uvs:this._properties[3],this._properties[4]="tint"in i||"alpha"in i?!!i.tint||!!i.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){this._tint=i,ds(i,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(i){var r=this;!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return r.onChildrenChange(0)})),i.batch.setObjectRenderer(i.plugins.particle),i.plugins.particle.render(this))},e.prototype.onChildrenChange=function(i){for(var r=Math.floor(i/this._batchSize);this._bufferUpdateIDs.length<r;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[r]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var i=0;i<this._buffers.length;++i)this._buffers[i].destroy();this._buffers=null}},e.prototype.destroy=function(i){t.prototype.destroy.call(this,i),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e}(fi),aU=function(){function t(e,i,r){this.geometry=new hh,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;++n){var o=e[n];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||ht.FLOAT,offset:o.offset},i[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var e=this.geometry,i=0;this.indexBuffer=new Ni(OS(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];n.offset=i,i+=n.size,this.dynamicStride+=n.size}var o=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(o),this.dynamicDataUint32=new Uint32Array(o),this.dynamicBuffer=new Ni(this.dynamicData,!1,!1);var a=0;this.staticStride=0;for(var r=0;r<this.staticProperties.length;++r){var n=this.staticProperties[r];n.offset=a,a+=n.size,this.staticStride+=n.size}var l=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(l),this.staticDataUint32=new Uint32Array(l),this.staticBuffer=new Ni(this.staticData,!0,!1);for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];e.addAttribute(n.attributeName,this.dynamicBuffer,0,n.type===ht.UNSIGNED_BYTE,n.type,this.dynamicStride*4,n.offset*4)}for(var r=0;r<this.staticProperties.length;++r){var n=this.staticProperties[r];e.addAttribute(n.attributeName,this.staticBuffer,0,n.type===ht.UNSIGNED_BYTE,n.type,this.staticStride*4,n.offset*4)}},t.prototype.uploadDynamic=function(e,i,r){for(var n=0;n<this.dynamicProperties.length;n++){var o=this.dynamicProperties[n];o.uploadFunction(e,i,r,o.type===ht.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++},t.prototype.uploadStatic=function(e,i,r){for(var n=0;n<this.staticProperties.length;n++){var o=this.staticProperties[n];o.uploadFunction(e,i,r,o.type===ht.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++},t.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},t}(),gee=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vee=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`,hU=function(t){lU(e,t);function e(i){var r=t.call(this,i)||this;return r.shader=null,r.properties=null,r.tempMatrix=new Zt,r.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:r.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:r.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:r.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:r.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ht.UNSIGNED_BYTE,uploadFunction:r.uploadTint,offset:0}],r.shader=ms.from(vee,gee,{}),r.state=Gs.for2d(),r}return e.prototype.render=function(i){var r=i.children,n=i._maxSize,o=i._batchSize,a=this.renderer,l=r.length;if(l!==0){l>n&&!i.autoResize&&(l=n);var h=i._buffers;h||(h=i._buffers=this.generateBuffers(i));var u=r[0]._texture.baseTexture,c=u.alphaMode>0;this.state.blendMode=ad(i.blendMode,c),a.state.set(this.state);var f=a.gl,d=i.worldTransform.copyTo(this.tempMatrix);d.prepend(a.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=LS(i.tintRgb,i.worldAlpha,this.shader.uniforms.uColor,c),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);for(var m=!1,v=0,g=0;v<l;v+=o,g+=1){var p=l-v;p>o&&(p=o),g>=h.length&&h.push(this._generateOneMoreBuffer(i));var _=h[g];_.uploadDynamic(r,v,p);var x=i._bufferUpdateIDs[g]||0;m=m||_._updateID<x,m&&(_._updateID=i._updateID,_.uploadStatic(r,v,p)),a.geometry.bind(_.geometry),f.drawElements(f.TRIANGLES,p*6,f.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(i){for(var r=[],n=i._maxSize,o=i._batchSize,a=i._properties,l=0;l<n;l+=o)r.push(new aU(this.properties,a,o));return r},e.prototype._generateOneMoreBuffer=function(i){var r=i._batchSize,n=i._properties;return new aU(this.properties,n,r)},e.prototype.uploadVertices=function(i,r,n,o,a,l){for(var h=0,u=0,c=0,f=0,d=0;d<n;++d){var m=i[r+d],v=m._texture,g=m.scale.x,p=m.scale.y,_=v.trim,x=v.orig;_?(u=_.x-m.anchor.x*x.width,h=u+_.width,f=_.y-m.anchor.y*x.height,c=f+_.height):(h=x.width*(1-m.anchor.x),u=x.width*-m.anchor.x,c=x.height*(1-m.anchor.y),f=x.height*-m.anchor.y),o[l]=u*g,o[l+1]=f*p,o[l+a]=h*g,o[l+a+1]=f*p,o[l+a*2]=h*g,o[l+a*2+1]=c*p,o[l+a*3]=u*g,o[l+a*3+1]=c*p,l+=a*4}},e.prototype.uploadPosition=function(i,r,n,o,a,l){for(var h=0;h<n;h++){var u=i[r+h].position;o[l]=u.x,o[l+1]=u.y,o[l+a]=u.x,o[l+a+1]=u.y,o[l+a*2]=u.x,o[l+a*2+1]=u.y,o[l+a*3]=u.x,o[l+a*3+1]=u.y,l+=a*4}},e.prototype.uploadRotation=function(i,r,n,o,a,l){for(var h=0;h<n;h++){var u=i[r+h].rotation;o[l]=u,o[l+a]=u,o[l+a*2]=u,o[l+a*3]=u,l+=a*4}},e.prototype.uploadUvs=function(i,r,n,o,a,l){for(var h=0;h<n;++h){var u=i[r+h]._texture._uvs;u?(o[l]=u.x0,o[l+1]=u.y0,o[l+a]=u.x1,o[l+a+1]=u.y1,o[l+a*2]=u.x2,o[l+a*2+1]=u.y2,o[l+a*3]=u.x3,o[l+a*3+1]=u.y3,l+=a*4):(o[l]=0,o[l+1]=0,o[l+a]=0,o[l+a+1]=0,o[l+a*2]=0,o[l+a*2+1]=0,o[l+a*3]=0,o[l+a*3+1]=0,l+=a*4)}},e.prototype.uploadTint=function(i,r,n,o,a,l){for(var h=0;h<n;++h){var u=i[r+h],c=u._texture.baseTexture.alphaMode>0,f=u.alpha,d=f<1&&c?ih(u._tintRGB,f):u._tintRGB+(f*255<<24);o[l]=d,o[l+a]=d,o[l+a*2]=d,o[l+a*3]=d,l+=a*4}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e.extension={name:"particle",type:Pt.RendererPlugin},e}(ic);var ca;(function(t){t.MITER="miter",t.BEVEL="bevel",t.ROUND="round"})(ca||(ca={}));var ol;(function(t){t.BUTT="butt",t.ROUND="round",t.SQUARE="square"})(ol||(ol={}));var xd={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(e===void 0&&(e=20),!this.adaptive||!t||isNaN(t))return e;var i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},gU=function(){function t(){this.color=16777215,this.alpha=1,this.texture=lt.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=lt.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}();var xC=function(t,e){return xC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},xC(t,e)};function bC(t,e){xC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}function uU(t,e){var i,r;e===void 0&&(e=!1);var n=t.length;if(!(n<6)){for(var o=0,a=0,l=t[n-2],h=t[n-1];a<n;a+=2){var u=t[a],c=t[a+1];o+=(u-l)*(c+h),l=u,h=c}if(!e&&o>0||e&&o<=0)for(var f=n/2,a=f+f%2;a<n;a+=2){var d=n-a-2,m=n-a-1,v=a,g=a+1;i=[t[v],t[d]],t[d]=i[0],t[v]=i[1],r=[t[g],t[m]],t[m]=r[0],t[g]=r[1]}}}var vU={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var i=t.points,r=t.holes,n=e.points,o=e.indices;if(i.length>=6){uU(i,!1);for(var a=[],l=0;l<r.length;l++){var h=r[l];uU(h.points,!0),a.push(i.length/2),i=i.concat(h.points)}var u=(0,ud.default)(i,a,2);if(!u)return;for(var c=n.length/2,l=0;l<u.length;l+=3)o.push(u[l]+c),o.push(u[l+1]+c),o.push(u[l+2]+c);for(var l=0;l<i.length;l++)n.push(i[l])}}},S_={build:function(t){var e=t.points,i,r,n,o,a,l;if(t.type===nr.CIRC){var h=t.shape;i=h.x,r=h.y,a=l=h.radius,n=o=0}else if(t.type===nr.ELIP){var u=t.shape;i=u.x,r=u.y,a=u.width,l=u.height,n=o=0}else{var c=t.shape,f=c.width/2,d=c.height/2;i=c.x+f,r=c.y+d,a=l=Math.max(0,Math.min(c.radius,Math.min(f,d))),n=f-a,o=d-l}if(!(a>=0&&l>=0&&n>=0&&o>=0)){e.length=0;return}var m=Math.ceil(2.3*Math.sqrt(a+l)),v=m*8+(n?4:0)+(o?4:0);if(e.length=v,v!==0){if(m===0){e.length=8,e[0]=e[6]=i+n,e[1]=e[3]=r+o,e[2]=e[4]=i-n,e[5]=e[7]=r-o;return}var g=0,p=m*4+(n?2:0)+2,_=p,x=v;{var b=n+a,y=o,w=i+b,S=i-b,R=r+y;if(e[g++]=w,e[g++]=R,e[--p]=R,e[--p]=S,o){var E=r-y;e[_++]=S,e[_++]=E,e[--x]=E,e[--x]=w}}for(var T=1;T<m;T++){var A=Math.PI/2*(T/m),b=n+Math.cos(A)*a,y=o+Math.sin(A)*l,w=i+b,S=i-b,R=r+y,E=r-y;e[g++]=w,e[g++]=R,e[--p]=R,e[--p]=S,e[_++]=S,e[_++]=E,e[--x]=E,e[--x]=w}{var b=n,y=o+l,w=i+b,S=i-b,R=r+y,E=r-y;e[g++]=w,e[g++]=R,e[--x]=E,e[--x]=w,n&&(e[g++]=S,e[g++]=R,e[--x]=E,e[--x]=S)}}},triangulate:function(t,e){var i=t.points,r=e.points,n=e.indices;if(i.length!==0){var o=r.length/2,a=o,l,h;if(t.type!==nr.RREC){var u=t.shape;l=u.x,h=u.y}else{var c=t.shape;l=c.x+c.width/2,h=c.y+c.height/2}var f=t.matrix;r.push(t.matrix?f.a*l+f.c*h+f.tx:l,t.matrix?f.b*l+f.d*h+f.ty:h),o++,r.push(i[0],i[1]);for(var d=2;d<i.length;d+=2)r.push(i[d],i[d+1]),n.push(o++,a,o);n.push(a+1,a,o)}}},_ee={build:function(t){var e=t.shape,i=e.x,r=e.y,n=e.width,o=e.height,a=t.points;a.length=0,a.push(i,r,i+n,r,i+n,r+o,i,r+o)},triangulate:function(t,e){var i=t.points,r=e.points,n=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function rc(t,e,i){var r=e-t;return t+r*i}function b_(t,e,i,r,n,o,a){a===void 0&&(a=[]);for(var l=20,h=a,u=0,c=0,f=0,d=0,m=0,v=0,g=0,p=0;g<=l;++g)p=g/l,u=rc(t,i,p),c=rc(e,r,p),f=rc(i,n,p),d=rc(r,o,p),m=rc(u,f,p),v=rc(c,d,p),!(g===0&&h[h.length-2]===m&&h[h.length-1]===v)&&h.push(m,v);return h}var yee={build:function(t){if(Ri.nextRoundedRectBehavior){S_.build(t);return}var e=t.shape,i=t.points,r=e.x,n=e.y,o=e.width,a=e.height,l=Math.max(0,Math.min(e.radius,Math.min(o,a)/2));i.length=0,l?(b_(r,n+l,r,n,r+l,n,i),b_(r+o-l,n,r+o,n,r+o,n+l,i),b_(r+o,n+a-l,r+o,n+a,r+o-l,n+a,i),b_(r+l,n+a,r,n+a,r,n+a-l,i)):i.push(r,n,r+o,n,r+o,n+a,r,n+a)},triangulate:function(t,e){if(Ri.nextRoundedRectBehavior){S_.triangulate(t,e);return}for(var i=t.points,r=e.points,n=e.indices,o=r.length/2,a=(0,ud.default)(i,null,2),l=0,h=a.length;l<h;l+=3)n.push(a[l]+o),n.push(a[l+1]+o),n.push(a[l+2]+o);for(var l=0,h=i.length;l<h;l++)r.push(i[l],i[++l])}};function cU(t,e,i,r,n,o,a,l){var h=t-i*n,u=e-r*n,c=t+i*o,f=e+r*o,d,m;a?(d=r,m=-i):(d=-r,m=i);var v=h+d,g=u+m,p=c+d,_=f+m;return l.push(v,g),l.push(p,_),2}function fh(t,e,i,r,n,o,a,l){var h=i-t,u=r-e,c=Math.atan2(h,u),f=Math.atan2(n-t,o-e);l&&c<f?c+=Math.PI*2:!l&&c>f&&(f+=Math.PI*2);var d=c,m=f-c,v=Math.abs(m),g=Math.sqrt(h*h+u*u),p=(15*v*Math.sqrt(g)/Math.PI>>0)+1,_=m/p;if(d+=_,l){a.push(t,e),a.push(i,r);for(var x=1,b=d;x<p;x++,b+=_)a.push(t,e),a.push(t+Math.sin(b)*g,e+Math.cos(b)*g);a.push(t,e),a.push(n,o)}else{a.push(i,r),a.push(t,e);for(var x=1,b=d;x<p;x++,b+=_)a.push(t+Math.sin(b)*g,e+Math.cos(b)*g),a.push(t,e);a.push(n,o),a.push(t,e)}return p*2}function xee(t,e){var i=t.shape,r=t.points||i.points.slice(),n=e.closePointEps;if(r.length!==0){var o=t.lineStyle,a=new Ht(r[0],r[1]),l=new Ht(r[r.length-2],r[r.length-1]),h=i.type!==nr.POLY||i.closeStroke,u=Math.abs(a.x-l.x)<n&&Math.abs(a.y-l.y)<n;if(h){r=r.slice(),u&&(r.pop(),r.pop(),l.set(r[r.length-2],r[r.length-1]));var c=(a.x+l.x)*.5,f=(l.y+a.y)*.5;r.unshift(c,f),r.push(c,f)}var d=e.points,m=r.length/2,v=r.length,g=d.length/2,p=o.width/2,_=p*p,x=o.miterLimit*o.miterLimit,b=r[0],y=r[1],w=r[2],S=r[3],R=0,E=0,T=-(y-S),A=b-w,C=0,M=0,D=Math.sqrt(T*T+A*A);T/=D,A/=D,T*=p,A*=p;var O=o.alignment,P=(1-O)*2,L=O*2;h||(o.cap===ol.ROUND?v+=fh(b-T*(P-L)*.5,y-A*(P-L)*.5,b-T*P,y-A*P,b+T*L,y+A*L,d,!0)+2:o.cap===ol.SQUARE&&(v+=cU(b,y,T,A,P,L,!0,d))),d.push(b-T*P,y-A*P),d.push(b+T*L,y+A*L);for(var I=1;I<m-1;++I){b=r[(I-1)*2],y=r[(I-1)*2+1],w=r[I*2],S=r[I*2+1],R=r[(I+1)*2],E=r[(I+1)*2+1],T=-(y-S),A=b-w,D=Math.sqrt(T*T+A*A),T/=D,A/=D,T*=p,A*=p,C=-(S-E),M=w-R,D=Math.sqrt(C*C+M*M),C/=D,M/=D,C*=p,M*=p;var k=w-b,B=y-S,F=w-R,W=E-S,V=k*F+B*W,N=B*F-W*k,ne=N<0;if(Math.abs(N)<.001*Math.abs(V)){d.push(w-T*P,S-A*P),d.push(w+T*L,S+A*L),V>=0&&(o.join===ca.ROUND?v+=fh(w,S,w-T*P,S-A*P,w-C*P,S-M*P,d,!1)+4:v+=2,d.push(w-C*L,S-M*L),d.push(w+C*P,S+M*P));continue}var ie=(-T+b)*(-A+S)-(-T+w)*(-A+y),Q=(-C+R)*(-M+S)-(-C+w)*(-M+E),K=(k*Q-F*ie)/N,de=(W*ie-B*Q)/N,re=(K-w)*(K-w)+(de-S)*(de-S),Y=w+(K-w)*P,U=S+(de-S)*P,z=w-(K-w)*L,te=S-(de-S)*L,ge=Math.min(k*k+B*B,F*F+W*W),Me=ne?P:L,ze=ge+Me*Me*_,He=re<=ze;He?o.join===ca.BEVEL||re/_>x?(ne?(d.push(Y,U),d.push(w+T*L,S+A*L),d.push(Y,U),d.push(w+C*L,S+M*L)):(d.push(w-T*P,S-A*P),d.push(z,te),d.push(w-C*P,S-M*P),d.push(z,te)),v+=2):o.join===ca.ROUND?ne?(d.push(Y,U),d.push(w+T*L,S+A*L),v+=fh(w,S,w+T*L,S+A*L,w+C*L,S+M*L,d,!0)+4,d.push(Y,U),d.push(w+C*L,S+M*L)):(d.push(w-T*P,S-A*P),d.push(z,te),v+=fh(w,S,w-T*P,S-A*P,w-C*P,S-M*P,d,!1)+4,d.push(w-C*P,S-M*P),d.push(z,te)):(d.push(Y,U),d.push(z,te)):(d.push(w-T*P,S-A*P),d.push(w+T*L,S+A*L),o.join===ca.ROUND?ne?v+=fh(w,S,w+T*L,S+A*L,w+C*L,S+M*L,d,!0)+2:v+=fh(w,S,w-T*P,S-A*P,w-C*P,S-M*P,d,!1)+2:o.join===ca.MITER&&re/_<=x&&(ne?(d.push(z,te),d.push(z,te)):(d.push(Y,U),d.push(Y,U)),v+=2),d.push(w-C*P,S-M*P),d.push(w+C*L,S+M*L),v+=2)}b=r[(m-2)*2],y=r[(m-2)*2+1],w=r[(m-1)*2],S=r[(m-1)*2+1],T=-(y-S),A=b-w,D=Math.sqrt(T*T+A*A),T/=D,A/=D,T*=p,A*=p,d.push(w-T*P,S-A*P),d.push(w+T*L,S+A*L),h||(o.cap===ol.ROUND?v+=fh(w-T*(P-L)*.5,S-A*(P-L)*.5,w-T*P,S-A*P,w+T*L,S+A*L,d,!1)+2:o.cap===ol.SQUARE&&(v+=cU(w,S,T,A,P,L,!1,d)));for(var Ne=e.indices,Ye=xd.epsilon*xd.epsilon,I=g;I<v+g-2;++I)b=d[I*2],y=d[I*2+1],w=d[(I+1)*2],S=d[(I+1)*2+1],R=d[(I+2)*2],E=d[(I+2)*2+1],!(Math.abs(b*(S-E)+w*(E-y)+R*(y-S))<Ye)&&Ne.push(I,I+1,I+2)}}function bee(t,e){var i=0,r=t.shape,n=t.points||r.points,o=r.type!==nr.POLY||r.closeStroke;if(n.length!==0){var a=e.points,l=e.indices,h=n.length/2,u=a.length/2,c=u;for(a.push(n[0],n[1]),i=1;i<h;i++)a.push(n[i*2],n[i*2+1]),l.push(c,c+1),c++;o&&l.push(c,u)}}function fU(t,e){t.lineStyle.native?bee(t,e):xee(t,e)}var dU=function(){function t(){}return t.curveTo=function(e,i,r,n,o,a){var l=a[a.length-2],h=a[a.length-1],u=h-i,c=l-e,f=n-i,d=r-e,m=Math.abs(u*d-c*f);if(m<1e-8||o===0)return(a[a.length-2]!==e||a[a.length-1]!==i)&&a.push(e,i),null;var v=u*u+c*c,g=f*f+d*d,p=u*f+c*d,_=o*Math.sqrt(v)/m,x=o*Math.sqrt(g)/m,b=_*p/v,y=x*p/g,w=_*d+x*c,S=_*f+x*u,R=c*(x+b),E=u*(x+b),T=d*(_+y),A=f*(_+y),C=Math.atan2(E-S,R-w),M=Math.atan2(A-S,T-w);return{cx:w+e,cy:S+i,radius:o,startAngle:C,endAngle:M,anticlockwise:c*f>d*u}},t.arc=function(e,i,r,n,o,a,l,h,u){for(var c=l-a,f=xd._segmentsCount(Math.abs(c)*o,Math.ceil(Math.abs(c)/cd)*40),d=c/(f*2),m=d*2,v=Math.cos(d),g=Math.sin(d),p=f-1,_=p%1/p,x=0;x<=p;++x){var b=x+_*x,y=d+a+m*b,w=Math.cos(y),S=-Math.sin(y);u.push((v*w+g*S)*o+r,(v*-S+g*w)*o+n)}},t}(),wee=function(){function t(){}return t.curveLength=function(e,i,r,n,o,a,l,h){for(var u=10,c=0,f=0,d=0,m=0,v=0,g=0,p=0,_=0,x=0,b=0,y=0,w=e,S=i,R=1;R<=u;++R)f=R/u,d=f*f,m=d*f,v=1-f,g=v*v,p=g*v,_=p*e+3*g*f*r+3*v*d*o+m*l,x=p*i+3*g*f*n+3*v*d*a+m*h,b=w-_,y=S-x,w=_,S=x,c+=Math.sqrt(b*b+y*y);return c},t.curveTo=function(e,i,r,n,o,a,l){var h=l[l.length-2],u=l[l.length-1];l.length-=2;var c=xd._segmentsCount(t.curveLength(h,u,e,i,r,n,o,a)),f=0,d=0,m=0,v=0,g=0;l.push(h,u);for(var p=1,_=0;p<=c;++p)_=p/c,f=1-_,d=f*f,m=d*f,v=_*_,g=v*_,l.push(m*h+3*d*_*e+3*f*v*r+g*o,m*u+3*d*_*i+3*f*v*n+g*a)},t}(),See=function(){function t(){}return t.curveLength=function(e,i,r,n,o,a){var l=e-2*r+o,h=i-2*n+a,u=2*r-2*e,c=2*n-2*i,f=4*(l*l+h*h),d=4*(l*u+h*c),m=u*u+c*c,v=2*Math.sqrt(f+d+m),g=Math.sqrt(f),p=2*f*g,_=2*Math.sqrt(m),x=d/g;return(p*v+g*d*(v-_)+(4*m*f-d*d)*Math.log((2*g+x+v)/(x+_)))/(4*p)},t.curveTo=function(e,i,r,n,o){for(var a=o[o.length-2],l=o[o.length-1],h=xd._segmentsCount(t.curveLength(a,l,e,i,r,n)),u=0,c=0,f=1;f<=h;++f){var d=f/h;u=a+(e-a)*d,c=l+(i-l)*d,o.push(u+(e+(r-e)*d-u)*d,c+(i+(n-i)*d-c)*d)}},t}(),Cee=function(){function t(){this.reset()}return t.prototype.begin=function(e,i,r){this.reset(),this.style=e,this.start=i,this.attribStart=r},t.prototype.end=function(e,i){this.attribSize=i-this.attribStart,this.size=e-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),dh,_C=(dh={},dh[nr.POLY]=vU,dh[nr.CIRC]=S_,dh[nr.ELIP]=S_,dh[nr.RECT]=_ee,dh[nr.RREC]=yee,dh),pU=[],w_=[],mU=function(){function t(e,i,r,n){i===void 0&&(i=null),r===void 0&&(r=null),n===void 0&&(n=null),this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=i,this.matrix=n,this.type=e.type}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),nc=new Ht,Mee=function(t){bC(e,t);function e(){var i=t.call(this)||this;return i.closePointEps=1e-4,i.boundsPadding=0,i.uvsFloat32=null,i.indicesUint16=null,i.batchable=!1,i.points=[],i.colors=[],i.uvs=[],i.indices=[],i.textureIds=[],i.graphicsData=[],i.drawCalls=[],i.batchDirty=-1,i.batches=[],i.dirty=0,i.cacheDirty=-1,i.clearDirty=0,i.shapeIndex=0,i._bounds=new $u,i.boundsDirty=-1,i}return Object.defineProperty(e.prototype,"bounds",{get:function(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),w_.push(this.drawCalls[i]);this.drawCalls.length=0;for(var i=0;i<this.batches.length;i++){var r=this.batches[i];r.reset(),pU.push(r)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(i,r,n,o){r===void 0&&(r=null),n===void 0&&(n=null),o===void 0&&(o=null);var a=new mU(i,r,n,o);return this.graphicsData.push(a),this.dirty++,this},e.prototype.drawHole=function(i,r){if(r===void 0&&(r=null),!this.graphicsData.length)return null;var n=new mU(i,null,null,r),o=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=o.lineStyle,o.holes.push(n),this.dirty++,this},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(i){for(var r=this.graphicsData,n=0;n<r.length;++n){var o=r[n];if(o.fillStyle.visible&&o.shape&&(o.matrix?o.matrix.applyInverse(i,nc):nc.copyFrom(i),o.shape.contains(nc.x,nc.y))){var a=!1;if(o.holes)for(var l=0;l<o.holes.length;l++){var h=o.holes[l];if(h.shape.contains(nc.x,nc.y)){a=!0;break}}if(!a)return!0}}return!1},e.prototype.updateBatches=function(){if(!this.graphicsData.length){this.batchable=!0;return}if(this.validateBatching()){this.cacheDirty=this.dirty;var i=this.uvs,r=this.graphicsData,n=null,o=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],o=n.style);for(var a=this.shapeIndex;a<r.length;a++){this.shapeIndex++;var l=r[a],h=l.fillStyle,u=l.lineStyle,c=_C[l.type];c.build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(h.visible||u.visible)&&this.processHoles(l.holes);for(var f=0;f<2;f++){var d=f===0?h:u;if(d.visible){var m=d.texture.baseTexture,v=this.indices.length,g=this.points.length/2;m.wrapMode=Jr.REPEAT,f===0?this.processFill(l):this.processLine(l);var p=this.points.length/2-g;p!==0&&(n&&!this._compareStyles(o,d)&&(n.end(v,g),n=null),n||(n=pU.pop()||new Cee,n.begin(d,v,g),this.batches.push(n),o=d),this.addUvs(this.points,i,d.texture,g,p,d.matrix))}}}var _=this.indices.length,x=this.points.length/2;if(n&&n.end(_,x),this.batches.length===0){this.batchable=!0;return}var b=x>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&b===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=b?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},e.prototype._compareStyles=function(i,r){return!(!i||!r||i.texture.baseTexture!==r.texture.baseTexture||i.color+i.alpha!==r.color+r.alpha||!!i.native!=!!r.native)},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var i=0,r=this.graphicsData.length;i<r;i++){var n=this.graphicsData[i],o=n.fillStyle,a=n.lineStyle;if(o&&!o.texture.baseTexture.valid||a&&!a.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var i=this.batches,r=0,n=i.length;r<n;r++)for(var o=i[r],a=0;a<o.size;a++){var l=o.start+a;this.indicesUint16[l]=this.indicesUint16[l]-o.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var i=this.batches,r=0;r<i.length;r++)if(i[r].style.native)return!1;return this.points.length<e.BATCHABLE_SIZE*2},e.prototype.buildDrawCalls=function(){for(var i=++At._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),w_.push(this.drawCalls[r]);this.drawCalls.length=0;var n=this.colors,o=this.textureIds,a=w_.pop();a||(a=new a_,a.texArray=new l_),a.texArray.count=0,a.start=0,a.size=0,a.type=vn.TRIANGLES;var l=0,h=null,u=0,c=!1,f=vn.TRIANGLES,d=0;this.drawCalls.push(a);for(var r=0;r<this.batches.length;r++){var m=this.batches[r],v=8,g=m.style,p=g.texture.baseTexture;c!==!!g.native&&(c=!!g.native,f=c?vn.LINES:vn.TRIANGLES,h=null,l=v,i++),h!==p&&(h=p,p._batchEnabled!==i&&(l===v&&(i++,l=0,a.size>0&&(a=w_.pop(),a||(a=new a_,a.texArray=new l_),this.drawCalls.push(a)),a.start=d,a.size=0,a.texArray.count=0,a.type=f),p.touched=1,p._batchEnabled=i,p._batchLocation=l,p.wrapMode=Jr.REPEAT,a.texArray.elements[a.texArray.count++]=p,l++)),a.size+=m.size,d+=m.size,u=p._batchLocation,this.addColors(n,g.color,g.alpha,m.attribSize,m.attribStart),this.addTextureIds(o,u,m.attribSize,m.attribStart)}At._globalBatch=i,this.packAttributes()},e.prototype.packAttributes=function(){for(var i=this.points,r=this.uvs,n=this.colors,o=this.textureIds,a=new ArrayBuffer(i.length*3*4),l=new Float32Array(a),h=new Uint32Array(a),u=0,c=0;c<i.length/2;c++)l[u++]=i[c*2],l[u++]=i[c*2+1],l[u++]=r[c*2],l[u++]=r[c*2+1],h[u++]=n[c],l[u++]=o[c];this._buffer.update(a),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(i){if(i.holes.length)vU.triangulate(i,this);else{var r=_C[i.type];r.triangulate(i,this)}},e.prototype.processLine=function(i){fU(i,this);for(var r=0;r<i.holes.length;r++)fU(i.holes[r],this)},e.prototype.processHoles=function(i){for(var r=0;r<i.length;r++){var n=i[r],o=_C[n.type];o.build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},e.prototype.calculateBounds=function(){var i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(i,r){for(var n=0;n<i.length/2;n++){var o=i[n*2],a=i[n*2+1];i[n*2]=r.a*o+r.c*a+r.tx,i[n*2+1]=r.b*o+r.d*a+r.ty}},e.prototype.addColors=function(i,r,n,o,a){a===void 0&&(a=0);var l=(r>>16)+(r&65280)+((r&255)<<16),h=ih(l,n);i.length=Math.max(i.length,a+o);for(var u=0;u<o;u++)i[a+u]=h},e.prototype.addTextureIds=function(i,r,n,o){o===void 0&&(o=0),i.length=Math.max(i.length,o+n);for(var a=0;a<n;a++)i[o+a]=r},e.prototype.addUvs=function(i,r,n,o,a,l){l===void 0&&(l=null);for(var h=0,u=r.length,c=n.frame;h<a;){var f=i[(o+h)*2],d=i[(o+h)*2+1];if(l){var m=l.a*f+l.c*d+l.tx;d=l.b*f+l.d*d+l.ty,f=m}h++,r.push(f/c.width,d/c.height)}var v=n.baseTexture;(c.width<v.width||c.height<v.height)&&this.adjustUvs(r,n,u,a)},e.prototype.adjustUvs=function(i,r,n,o){for(var a=r.baseTexture,l=1e-6,h=n+o*2,u=r.frame,c=u.width/a.width,f=u.height/a.height,d=u.x/u.width,m=u.y/u.height,v=Math.floor(i[n]+l),g=Math.floor(i[n+1]+l),p=n+2;p<h;p+=2)v=Math.min(v,Math.floor(i[p]+l)),g=Math.min(g,Math.floor(i[p+1]+l));d-=v,m-=g;for(var p=n;p<h;p+=2)i[p]=(i[p]+d)*c,i[p+1]=(i[p+1]+m)*f},e.BATCHABLE_SIZE=100,e}(nC),Eee=function(t){bC(e,t);function e(){var i=t!==null&&t.apply(this,arguments)||this;return i.width=0,i.alignment=.5,i.native=!1,i.cap=ol.BUTT,i.join=ca.MITER,i.miterLimit=10,i}return e.prototype.clone=function(){var i=new e;return i.color=this.color,i.alpha=this.alpha,i.texture=this.texture,i.matrix=this.matrix,i.visible=this.visible,i.width=this.width,i.alignment=this.alignment,i.native=this.native,i.cap=this.cap,i.join=this.join,i.miterLimit=this.miterLimit,i},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e}(gU),Tee=new Float32Array(3),yC={},Ri=function(t){bC(e,t);function e(i){i===void 0&&(i=null);var r=t.call(this)||this;return r.shader=null,r.pluginName="batch",r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r._fillStyle=new gU,r._lineStyle=new Eee,r._matrix=null,r._holeMode=!1,r.state=Gs.for2d(),r._geometry=i||new Mee,r._geometry.refCount++,r._transformID=-1,r.tint=16777215,r.blendMode=at.NORMAL,r}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(i){this.state.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){this._tint=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(i,r,n,o,a){return i===void 0&&(i=null),r===void 0&&(r=0),n===void 0&&(n=1),o===void 0&&(o=.5),a===void 0&&(a=!1),typeof i=="number"&&(i={width:i,color:r,alpha:n,alignment:o,native:a}),this.lineTextureStyle(i)},e.prototype.lineTextureStyle=function(i){i=Object.assign({width:0,texture:lt.WHITE,color:i&&i.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:ol.BUTT,join:ca.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();var r=i.width>0&&i.alpha>0;return r?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:r},i)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var i=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new Ju,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[r-2],i[r-1]))}else this.currentPath=new Ju,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(i,r){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=r,this},e.prototype.lineTo=function(i,r){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points,o=n[n.length-2],a=n[n.length-1];return(o!==i||a!==r)&&n.push(i,r),this},e.prototype._initCurve=function(i,r){i===void 0&&(i=0),r===void 0&&(r=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,r]):this.moveTo(i,r)},e.prototype.quadraticCurveTo=function(i,r,n,o){this._initCurve();var a=this.currentPath.points;return a.length===0&&this.moveTo(0,0),See.curveTo(i,r,n,o,a),this},e.prototype.bezierCurveTo=function(i,r,n,o,a,l){return this._initCurve(),wee.curveTo(i,r,n,o,a,l,this.currentPath.points),this},e.prototype.arcTo=function(i,r,n,o,a){this._initCurve(i,r);var l=this.currentPath.points,h=dU.curveTo(i,r,n,o,a,l);if(h){var u=h.cx,c=h.cy,f=h.radius,d=h.startAngle,m=h.endAngle,v=h.anticlockwise;this.arc(u,c,f,d,m,v)}return this},e.prototype.arc=function(i,r,n,o,a,l){if(l===void 0&&(l=!1),o===a)return this;!l&&a<=o?a+=cd:l&&o<=a&&(o+=cd);var h=a-o;if(h===0)return this;var u=i+Math.cos(o)*n,c=r+Math.sin(o)*n,f=this._geometry.closePointEps,d=this.currentPath?this.currentPath.points:null;if(d){var m=Math.abs(d[d.length-2]-u),v=Math.abs(d[d.length-1]-c);m<f&&v<f||d.push(u,c)}else this.moveTo(u,c),d=this.currentPath.points;return dU.arc(u,c,i,r,n,o,a,l,d),this},e.prototype.beginFill=function(i,r){return i===void 0&&(i=0),r===void 0&&(r=1),this.beginTextureFill({texture:lt.WHITE,color:i,alpha:r})},e.prototype.beginTextureFill=function(i){i=Object.assign({texture:lt.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();var r=i.alpha>0;return r?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:r},i)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(i,r,n,o){return this.drawShape(new Tt(i,r,n,o))},e.prototype.drawRoundedRect=function(i,r,n,o,a){return this.drawShape(new V5(i,r,n,o,a))},e.prototype.drawCircle=function(i,r,n){return this.drawShape(new H5(i,r,n))},e.prototype.drawEllipse=function(i,r,n,o){return this.drawShape(new W5(i,r,n,o))},e.prototype.drawPolygon=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];var o,a=!0,l=r[0];l.points?(a=l.closeStroke,o=l.points):Array.isArray(r[0])?o=r[0]:o=r;var h=new Ju(o);return h.closeStroke=a,this.drawShape(h),this},e.prototype.drawShape=function(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===nr.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)},e.prototype._render=function(i){this.finishPoly();var r=this._geometry;r.updateBatches(),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))},e.prototype._populateBatches=function(){var i=this._geometry,r=this.blendMode,n=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(i.points);for(var o=0;o<n;o++){var a=i.batches[o],l=a.style.color,h=new Float32Array(this.vertexData.buffer,a.attribStart*4*2,a.attribSize*2),u=new Float32Array(i.uvsFloat32.buffer,a.attribStart*4*2,a.attribSize*2),c=new Uint16Array(i.indicesUint16.buffer,a.start*2,a.size),f={vertexData:h,blendMode:r,indices:c,uvs:u,_batchRGB:ds(l),_tintRGB:l,_texture:a.style.texture,alpha:a.style.alpha,worldAlpha:1};this.batches[o]=f}},e.prototype._renderBatched=function(i){if(this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var r=0,n=this.batches.length;r<n;r++){var o=this.batches[r];o.worldAlpha=this.worldAlpha*o.alpha,i.plugins[this.pluginName].render(o)}}},e.prototype._renderDirect=function(i){var r=this._resolveDirectShader(i),n=this._geometry,o=this.tint,a=this.worldAlpha,l=r.uniforms,h=n.drawCalls;l.translationMatrix=this.transform.worldTransform,l.tint[0]=(o>>16&255)/255*a,l.tint[1]=(o>>8&255)/255*a,l.tint[2]=(o&255)/255*a,l.tint[3]=a,i.shader.bind(r),i.geometry.bind(n,r),i.state.set(this.state);for(var u=0,c=h.length;u<c;u++)this._renderDrawCallDirect(i,n.drawCalls[u])},e.prototype._renderDrawCallDirect=function(i,r){for(var n=r.texArray,o=r.type,a=r.size,l=r.start,h=n.count,u=0;u<h;u++)i.texture.bind(n.elements[u],u);i.geometry.draw(o,a,l)},e.prototype._resolveDirectShader=function(i){var r=this.shader,n=this.pluginName;if(!r){if(!yC[n]){for(var o=i.plugins[n].MAX_TEXTURES,a=new Int32Array(o),l=0;l<o;l++)a[l]=l;var h={tint:new Float32Array([1,1,1,1]),translationMatrix:new Zt,default:nl.from({uSamplers:a},!0)},u=i.plugins[n]._shader.program;yC[n]=new ms(u,h)}r=yC[n]}return r},e.prototype._calculateBounds=function(){this.finishPoly();var i=this._geometry;if(i.graphicsData.length){var r=i.bounds,n=r.minX,o=r.minY,a=r.maxX,l=r.maxY;this._bounds.addFrame(this.transform,n,o,a,l)}},e.prototype.containsPoint=function(i){return this.worldTransform.applyInverse(i,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var i=ds(this.tint,Tee),r=0;r<this.batches.length;r++){var n=this.batches[r],o=n._batchRGB,a=i[0]*o[0]*255,l=i[1]*o[1]*255,h=i[2]*o[2]*255,u=(a<<16)+(l<<8)+(h|0);n._tintRGB=(u>>16)+(u&65280)+((u&255)<<16)}}},e.prototype.calculateVertices=function(){var i=this.transform._worldID;if(this._transformID!==i){this._transformID=i;for(var r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,u=r.ty,c=this._geometry.points,f=this.vertexData,d=0,m=0;m<c.length;m+=2){var v=c[m],g=c[m+1];f[d++]=n*v+a*g+h,f[d++]=l*g+o*v+u}}},e.prototype.closePath=function(){var i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this},e.prototype.setMatrix=function(i){return this._matrix=i,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,i)},e.nextRoundedRectBehavior=!1,e._TEMP_POINT=new Ht,e}(fi);var wC=function(t,e){return wC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},wC(t,e)};function Aee(t,e){wC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var bd=new Ht,Pee=new Uint16Array([0,1,2,0,2,3]),fa=function(t){Aee(e,t);function e(i){var r=t.call(this)||this;return r._anchor=new rl(r._onAnchorUpdate,r,i?i.defaultAnchor.x:0,i?i.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=at.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=i||lt.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=Pee,r.pluginName="batch",r.isSprite=!0,r._roundPixels=Fe.ROUND_PIXELS,r}return e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=oa(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=oa(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var i=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===i._updateID)){this._textureID!==i._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=i._updateID;var r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,u=r.ty,c=this.vertexData,f=i.trim,d=i.orig,m=this._anchor,v=0,g=0,p=0,_=0;if(f?(g=f.x-m._x*d.width,v=g+f.width,_=f.y-m._y*d.height,p=_+f.height):(g=-m._x*d.width,v=g+d.width,_=-m._y*d.height,p=_+d.height),c[0]=n*g+a*_+h,c[1]=l*_+o*g+u,c[2]=n*v+a*_+h,c[3]=l*_+o*v+u,c[4]=n*v+a*p+h,c[5]=l*p+o*v+u,c[6]=n*g+a*p+h,c[7]=l*p+o*g+u,this._roundPixels)for(var x=Fe.RESOLUTION,b=0;b<c.length;++b)c[b]=Math.round((c[b]*x|0)/x)}},e.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var i=this._texture,r=this.vertexTrimmedData,n=i.orig,o=this._anchor,a=this.transform.worldTransform,l=a.a,h=a.b,u=a.c,c=a.d,f=a.tx,d=a.ty,m=-o._x*n.width,v=m+n.width,g=-o._y*n.height,p=g+n.height;r[0]=l*m+u*g+f,r[1]=c*g+h*m+d,r[2]=l*v+u*g+f,r[3]=c*g+h*v+d,r[4]=l*v+u*p+f,r[5]=c*p+h*v+d,r[6]=l*m+u*p+f,r[7]=c*p+h*m+d},e.prototype._render=function(i){this.calculateVertices(),i.batch.setObjectRenderer(i.plugins[this.pluginName]),i.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var i=this._texture.trim,r=this._texture.orig;!i||i.width===r.width&&i.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(i){return this.children.length===0?(this._localBounds||(this._localBounds=new $u),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),i||(this._localBoundsRect||(this._localBoundsRect=new Tt),i=this._localBoundsRect),this._localBounds.getRectangle(i)):t.prototype.getLocalBounds.call(this,i)},e.prototype.containsPoint=function(i){this.worldTransform.applyInverse(i,bd);var r=this._texture.orig.width,n=this._texture.orig.height,o=-r*this.anchor.x,a=0;return bd.x>=o&&bd.x<o+r&&(a=-n*this.anchor.y,bd.y>=a&&bd.y<a+n)},e.prototype.destroy=function(i){t.prototype.destroy.call(this,i),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var r=typeof i=="boolean"?i:i&&i.texture;if(r){var n=typeof i=="boolean"?i:i&&i.baseTexture;this._texture.destroy(!!n)}this._texture=null},e.from=function(i,r){var n=i instanceof lt?i:lt.from(i,r);return new e(n)},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(i){var r=oa(this.scale.x)||1;this.scale.x=r*i/this._texture.orig.width,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(i){var r=oa(this.scale.y)||1;this.scale.y=r*i/this._texture.orig.height,this._height=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(i){this._anchor.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){this._tint=i,this._tintRGB=(i>>16)+(i&65280)+((i&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(i){this._texture!==i&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=i||lt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,i&&(i.baseTexture.valid?this._onTextureUpdate():i.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e}(fi);var EC=function(t,e){return EC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},EC(t,e)};function Ree(t,e){EC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var sc;(function(t){t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(sc||(sc={}));var SC={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:sc.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},Lee=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],al=function(){function t(e){this.styleID=0,this.reset(),MC(this,e,e)}return t.prototype.clone=function(){var e={};return MC(e,this,SC),new t(e)},t.prototype.reset=function(){MC(this,SC,SC)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(e){var i=CC(e);this._dropShadowColor!==i&&(this._dropShadowColor=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(e){var i=CC(e);this._fill!==i&&(this._fill=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(e){Oee(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(e){this._leading!==e&&(this._leading=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding!==e&&(this._padding=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(e){var i=CC(e);this._stroke!==i&&(this._stroke=i,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(e){this._trim!==e&&(this._trim=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var e=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,i=this.fontFamily;Array.isArray(this.fontFamily)||(i=this.fontFamily.split(","));for(var r=i.length-1;r>=0;r--){var n=i[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&Lee.indexOf(n)<0&&(n='"'+n+'"'),i[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+i.join(",")},t}();function _U(t){return typeof t=="number"?sd(t):(typeof t=="string"&&t.indexOf("0x")===0&&(t=t.replace("0x","#")),t)}function CC(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=_U(t[e]);return t}else return _U(t)}function Oee(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}function MC(t,e,i){for(var r in i)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}var C_={willReadFrequently:!0},gs=function(){function t(e,i,r,n,o,a,l,h,u){this.text=e,this.style=i,this.width=r,this.height=n,this.lines=o,this.lineWidths=a,this.lineHeight=l,this.maxLineWidth=h,this.fontProperties=u}return t.measureText=function(e,i,r,n){n===void 0&&(n=t._canvas),r=r==null?i.wordWrap:r;var o=i.toFontString(),a=t.measureFont(o);a.fontSize===0&&(a.fontSize=i.fontSize,a.ascent=i.fontSize);var l=n.getContext("2d",C_);l.font=o;for(var h=r?t.wordWrap(e,i,n):e,u=h.split(/(?:\r\n|\r|\n)/),c=new Array(u.length),f=0,d=0;d<u.length;d++){var m=l.measureText(u[d]).width+(u[d].length-1)*i.letterSpacing;c[d]=m,f=Math.max(f,m)}var v=f+i.strokeThickness;i.dropShadow&&(v+=i.dropShadowDistance);var g=i.lineHeight||a.fontSize+i.strokeThickness,p=Math.max(g,a.fontSize+i.strokeThickness)+(u.length-1)*(g+i.leading);return i.dropShadow&&(p+=i.dropShadowDistance),new t(e,i,v,p,u,c,g+i.leading,f,a)},t.wordWrap=function(e,i,r){r===void 0&&(r=t._canvas);for(var n=r.getContext("2d",C_),o=0,a="",l="",h=Object.create(null),u=i.letterSpacing,c=i.whiteSpace,f=t.collapseSpaces(c),d=t.collapseNewlines(c),m=!f,v=i.wordWrapWidth+u,g=t.tokenize(e),p=0;p<g.length;p++){var _=g[p];if(t.isNewline(_)){if(!d){l+=t.addLine(a),m=!f,a="",o=0;continue}_=" "}if(f){var x=t.isBreakingSpace(_),b=t.isBreakingSpace(a[a.length-1]);if(x&&b)continue}var y=t.getFromCache(_,u,h,n);if(y>v)if(a!==""&&(l+=t.addLine(a),a="",o=0),t.canBreakWords(_,i.breakWords))for(var w=t.wordWrapSplit(_),S=0;S<w.length;S++){for(var R=w[S],E=1;w[S+E];){var T=w[S+E],A=R[R.length-1];if(!t.canBreakChars(A,T,_,S,i.breakWords))R+=T;else break;E++}S+=R.length-1;var C=t.getFromCache(R,u,h,n);C+o>v&&(l+=t.addLine(a),m=!1,a="",o=0),a+=R,o+=C}else{a.length>0&&(l+=t.addLine(a),a="",o=0);var M=p===g.length-1;l+=t.addLine(_,!M),m=!1,a="",o=0}else y+o>v&&(m=!1,l+=t.addLine(a),a="",o=0),(a.length>0||!t.isBreakingSpace(_)||m)&&(a+=_,o+=y)}return l+=t.addLine(a,!1),l},t.addLine=function(e,i){return i===void 0&&(i=!0),e=t.trimRight(e),e=i?e+`
`:e,e},t.getFromCache=function(e,i,r,n){var o=r[e];if(typeof o!="number"){var a=e.length*i;o=n.measureText(e).width+a,r[e]=o}return o},t.collapseSpaces=function(e){return e==="normal"||e==="pre-line"},t.collapseNewlines=function(e){return e==="normal"},t.trimRight=function(e){if(typeof e!="string")return"";for(var i=e.length-1;i>=0;i--){var r=e[i];if(!t.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return typeof e!="string"?!1:t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e,i){return typeof e!="string"?!1:t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var i=[],r="";if(typeof e!="string")return i;for(var n=0;n<e.length;n++){var o=e[n],a=e[n+1];if(t.isBreakingSpace(o,a)||t.isNewline(o)){r!==""&&(i.push(r),r=""),i.push(o);continue}r+=o}return r!==""&&i.push(r),i},t.canBreakWords=function(e,i){return i},t.canBreakChars=function(e,i,r,n,o){return!0},t.wordWrapSplit=function(e){return e.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var i={ascent:0,descent:0,fontSize:0},r=t._canvas,n=t._context;n.font=e;var o=t.METRICS_STRING+t.BASELINE_SYMBOL,a=Math.ceil(n.measureText(o).width),l=Math.ceil(n.measureText(t.BASELINE_SYMBOL).width),h=Math.ceil(t.HEIGHT_MULTIPLIER*l);l=l*t.BASELINE_MULTIPLIER|0,r.width=a,r.height=h,n.fillStyle="#f00",n.fillRect(0,0,a,h),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(o,0,l);var u=n.getImageData(0,0,a,h).data,c=u.length,f=a*4,d=0,m=0,v=!1;for(d=0;d<l;++d){for(var g=0;g<f;g+=4)if(u[m+g]!==255){v=!0;break}if(!v)m+=f;else break}for(i.ascent=l-d,m=c-f,v=!1,d=h;d>l;--d){for(var g=0;g<f;g+=4)if(u[m+g]!==255){v=!0;break}if(!v)m-=f;else break}return i.descent=d-l,i.fontSize=i.ascent+i.descent,t._fonts[e]=i,i},t.clearMetrics=function(e){e===void 0&&(e=""),e?delete t._fonts[e]:t._fonts={}},Object.defineProperty(t,"_canvas",{get:function(){if(!t.__canvas){var e=void 0;try{var i=new OffscreenCanvas(0,0),r=i.getContext("2d",C_);if(r&&r.measureText)return t.__canvas=i,i;e=Fe.ADAPTER.createCanvas()}catch(n){e=Fe.ADAPTER.createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas},enumerable:!1,configurable:!0}),Object.defineProperty(t,"_context",{get:function(){return t.__context||(t.__context=t._canvas.getContext("2d",C_)),t.__context},enumerable:!1,configurable:!0}),t}();gs._fonts={};gs.METRICS_STRING="|\xC9q\xC5";gs.BASELINE_SYMBOL="M";gs.BASELINE_MULTIPLIER=1.4;gs.HEIGHT_MULTIPLIER=2;gs._newlines=[10,13];gs._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Dee={texture:!0,children:!1,baseTexture:!0},vs=function(t){Ree(e,t);function e(i,r,n){var o=this,a=!1;n||(n=Fe.ADAPTER.createCanvas(),a=!0),n.width=3,n.height=3;var l=lt.from(n);return l.orig=new Tt,l.trim=new Tt,o=t.call(this,l)||this,o._ownCanvas=a,o.canvas=n,o.context=n.getContext("2d",{willReadFrequently:!0}),o._resolution=Fe.RESOLUTION,o._autoResolution=!0,o._text=null,o._style=null,o._styleListener=null,o._font="",o.text=i,o.style=r,o.localStyleID=-1,o}return e.prototype.updateText=function(i){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!(!this.dirty&&i)){this._font=this._style.toFontString();var n=this.context,o=gs.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=o.width,l=o.height,h=o.lines,u=o.lineHeight,c=o.lineWidths,f=o.maxLineWidth,d=o.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,a)+r.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,l)+r.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=r.strokeThickness,n.textBaseline=r.textBaseline,n.lineJoin=r.lineJoin,n.miterLimit=r.miterLimit;for(var m,v,g=r.dropShadow?2:1,p=0;p<g;++p){var _=r.dropShadow&&p===0,x=_?Math.ceil(Math.max(1,l)+r.padding*2):0,b=x*this._resolution;if(_){n.fillStyle="black",n.strokeStyle="black";var y=r.dropShadowColor,w=ds(typeof y=="number"?y:od(y)),S=r.dropShadowBlur*this._resolution,R=r.dropShadowDistance*this._resolution;n.shadowColor="rgba("+w[0]*255+","+w[1]*255+","+w[2]*255+","+r.dropShadowAlpha+")",n.shadowBlur=S,n.shadowOffsetX=Math.cos(r.dropShadowAngle)*R,n.shadowOffsetY=Math.sin(r.dropShadowAngle)*R+b}else n.fillStyle=this._generateFillStyle(r,h,o),n.strokeStyle=r.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;var E=(u-d.fontSize)/2;(!e.nextLineHeightBehavior||u-d.fontSize<0)&&(E=0);for(var T=0;T<h.length;T++)m=r.strokeThickness/2,v=r.strokeThickness/2+T*u+d.ascent+E,r.align==="right"?m+=f-c[T]:r.align==="center"&&(m+=(f-c[T])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(h[T],m+r.padding,v+r.padding-x,!0),r.fill&&this.drawLetterSpacing(h[T],m+r.padding,v+r.padding-x)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(i,r,n,o){o===void 0&&(o=!1);var a=this._style,l=a.letterSpacing,h=e.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(l===0||h){h&&(this.context.letterSpacing=l,this.context.textLetterSpacing=l),o?this.context.strokeText(i,r,n):this.context.fillText(i,r,n);return}for(var u=r,c=Array.from?Array.from(i):i.split(""),f=this.context.measureText(i).width,d=0,m=0;m<c.length;++m){var v=c[m];o?this.context.strokeText(v,u,n):this.context.fillText(v,u,n);for(var g="",p=m+1;p<c.length;++p)g+=c[p];d=this.context.measureText(g).width,u+=f-d+l,f=d}},e.prototype.updateTexture=function(){var i=this.canvas;if(this._style.trim){var r=DS(i);r.data&&(i.width=r.width,i.height=r.height,this.context.putImageData(r.data,0,0))}var n=this._texture,o=this._style,a=o.trim?0:o.padding,l=n.baseTexture;n.trim.width=n._frame.width=i.width/this._resolution,n.trim.height=n._frame.height=i.height/this._resolution,n.trim.x=-a,n.trim.y=-a,n.orig.width=n._frame.width-a*2,n.orig.height=n._frame.height-a*2,this._onTextureUpdate(),l.setRealSize(i.width,i.height,this._resolution),n.updateUvs(),this.dirty=!1},e.prototype._render=function(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,i)},e.prototype.updateTransform=function(){this.updateText(!0),t.prototype.updateTransform.call(this)},e.prototype.getBounds=function(i,r){return this.updateText(!0),this._textureID===-1&&(i=!1),t.prototype.getBounds.call(this,i,r)},e.prototype.getLocalBounds=function(i){return this.updateText(!0),t.prototype.getLocalBounds.call(this,i)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(i,r,n){var o=i.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;var a,l=i.dropShadow?i.dropShadowDistance:0,h=i.padding||0,u=this.canvas.width/this._resolution-l-h*2,c=this.canvas.height/this._resolution-l-h*2,f=o.slice(),d=i.fillGradientStops.slice();if(!d.length)for(var m=f.length+1,v=1;v<m;++v)d.push(v/m);if(f.unshift(o[0]),d.unshift(0),f.push(o[o.length-1]),d.push(1),i.fillGradientType===sc.LINEAR_VERTICAL){a=this.context.createLinearGradient(u/2,h,u/2,c+h);for(var g=n.fontProperties.fontSize+i.strokeThickness,v=0;v<r.length;v++){var p=n.lineHeight*(v-1)+g,_=n.lineHeight*v,x=_;v>0&&p>_&&(x=(_+p)/2);var b=_+g,y=n.lineHeight*(v+1),w=b;v+1<r.length&&y<b&&(w=(b+y)/2);for(var S=(w-x)/c,R=0;R<f.length;R++){var E=0;typeof d[R]=="number"?E=d[R]:E=R/f.length;var T=Math.min(1,Math.max(0,x/c+E*S));T=Number(T.toFixed(5)),a.addColorStop(T,f[R])}}}else{a=this.context.createLinearGradient(h,c/2,u+h,c/2);for(var A=f.length+1,C=1,v=0;v<f.length;v++){var M=void 0;typeof d[v]=="number"?M=d[v]:M=C/A,a.addColorStop(M,f[v]),C++}}return a},e.prototype.destroy=function(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},Dee,i),t.prototype.destroy.call(this,i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(i){this.updateText(!0);var r=oa(this.scale.x)||1;this.scale.x=r*i/this._texture.orig.width,this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(i){this.updateText(!0);var r=oa(this.scale.y)||1;this.scale.y=r*i/this._texture.orig.height,this._height=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(i){i=i||{},i instanceof al?this._style=i:this._style=new al(i),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(i){i=String(i==null?"":i),this._text!==i&&(this._text=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)},enumerable:!1,configurable:!0}),e.nextLineHeightBehavior=!1,e.experimentalLetterSpacing=!1,e}(fa);Fe.UPLOADS_PER_FRAME=4;var TC=function(t,e){return TC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},TC(t,e)};function Iee(t,e){TC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var kee=function(){function t(e){this.maxItemsPerFrame=e,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function Fee(t,e){var i=!1;if(t&&t._textures&&t._textures.length){for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof lt){var n=t._textures[r].baseTexture;e.indexOf(n)===-1&&(e.push(n),i=!0)}}return i}function Bee(t,e){if(t.baseTexture instanceof At){var i=t.baseTexture;return e.indexOf(i)===-1&&e.push(i),!0}return!1}function Nee(t,e){if(t._texture&&t._texture instanceof lt){var i=t._texture.baseTexture;return e.indexOf(i)===-1&&e.push(i),!0}return!1}function Uee(t,e){return e instanceof vs?(e.updateText(!0),!0):!1}function Gee(t,e){if(e instanceof al){var i=e.toFontString();return gs.measureFont(i),!0}return!1}function zee(t,e){if(t instanceof vs){e.indexOf(t.style)===-1&&e.push(t.style),e.indexOf(t)===-1&&e.push(t);var i=t._texture.baseTexture;return e.indexOf(i)===-1&&e.push(i),!0}return!1}function Hee(t,e){return t instanceof al?(e.indexOf(t)===-1&&e.push(t),!0):!1}var Wee=function(){function t(e){var i=this;this.limiter=new kee(Fe.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){i.queue&&i.prepareItems()},this.registerFindHook(zee),this.registerFindHook(Hee),this.registerFindHook(Fee),this.registerFindHook(Bee),this.registerFindHook(Nee),this.registerUploadHook(Uee),this.registerUploadHook(Gee)}return t.prototype.upload=function(e,i){var r=this;return typeof e=="function"&&(i=e,e=null),i&&Yi("6.5.0","BasePrepare.upload callback is deprecated, use the return Promise instead."),new Promise(function(n){e&&r.add(e);var o=function(){i==null||i(),n()};r.queue.length?(r.completes.push(o),r.ticking||(r.ticking=!0,Bi.system.addOnce(r.tick,r,ps.UTILITY))):o()})},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],i=!1;if(e&&!e._destroyed){for(var r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),i=!0;break}}i||this.queue.shift()}if(this.queue.length)Bi.system.addOnce(this.tick,this,ps.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);this.completes.length=0;for(var r=0,n=o.length;r<n;r++)o[r]()}},t.prototype.registerFindHook=function(e){return e&&this.addHooks.push(e),this},t.prototype.registerUploadHook=function(e){return e&&this.uploadHooks.push(e),this},t.prototype.add=function(e){for(var i=0,r=this.addHooks.length;i<r&&!this.addHooks[i](e,this.queue);i++);if(e instanceof fi)for(var i=e.children.length-1;i>=0;i--)this.add(e.children[i]);return this},t.prototype.destroy=function(){this.ticking&&Bi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function yU(t,e){return e instanceof At?(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0):!1}function Vee(t,e){if(!(e instanceof Ri))return!1;var i=e.geometry;e.finishPoly(),i.updateBatches();for(var r=i.batches,n=0;n<r.length;n++){var o=r[n].style.texture;o&&yU(t,o.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function jee(t,e){return t instanceof Ri?(e.push(t),!0):!1}var xU=function(t){Iee(e,t);function e(i){var r=t.call(this,i)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(jee),r.registerUploadHook(yU),r.registerUploadHook(Vee),r}return e.extension={name:"prepare",type:Pt.RendererPlugin},e}(Wee),tTe=function(){function t(e){this.maxMilliseconds=e,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}();var qee=function(){function t(e,i,r){r===void 0&&(r=null),this.linkedSheets=[],this._texture=e instanceof lt?e:null,this.baseTexture=e instanceof At?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=i;var n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(e){e===void 0&&(e=null);var i=this.data.meta.scale,r=tl(e,null);return r===null&&(r=i!==void 0?parseFloat(i):1),r!==1&&this.baseTexture.setResolution(r),r},t.prototype.parse=function(e){var i=this;return e&&Yi("6.5.0","Spritesheet.parse callback is deprecated, use the return Promise instead."),new Promise(function(r){i._callback=function(n){e==null||e(n),r(n)},i._batchIndex=0,i._frameKeys.length<=t.BATCH_SIZE?(i._processFrames(0),i._processAnimations(),i._parseComplete()):i._nextBatch()})},t.prototype._processFrames=function(e){for(var i=e,r=t.BATCH_SIZE;i-e<r&&i<this._frameKeys.length;){var n=this._frameKeys[i],o=this._frames[n],a=o.frame;if(a){var l=null,h=null,u=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,c=new Tt(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);o.rotated?l=new Tt(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):l=new Tt(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(h=new Tt(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[n]=new lt(this.baseTexture,l,c,h,o.rotated?2:0,o.anchor),lt.addToCache(this.textures[n],n)}i++}},t.prototype._processAnimations=function(){var e=this.data.animations||{};for(var i in e){this.animations[i]=[];for(var r=0;r<e[i].length;r++){var n=e[i][r];this.animations[i].push(this.textures[n])}}},t.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())},0)},t.prototype.destroy=function(e){var i;e===void 0&&(e=!1);for(var r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((i=this._texture)===null||i===void 0||i.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]},t.BATCH_SIZE=1e3,t}(),bU=function(){function t(){}return t.use=function(e,i){var r,n,o=this,a=e.name+"_image";if(!e.data||e.type!==li.TYPE.JSON||!e.data.frames||o.resources[a]){i();return}var l=(n=(r=e.data)===null||r===void 0?void 0:r.meta)===null||n===void 0?void 0:n.related_multi_packs;if(Array.isArray(l))for(var h=function(v){if(typeof v!="string")return"continue";var g=v.replace(".json",""),p=sa.resolve(e.url.replace(o.baseUrl,""),v);if(o.resources[g]||Object.values(o.resources).some(function(x){return sa.format(sa.parse(x.url))===p}))return"continue";var _={crossOrigin:e.crossOrigin,loadType:li.LOAD_TYPE.XHR,xhrType:li.XHR_RESPONSE_TYPE.JSON,parentResource:e,metadata:e.metadata};o.add(g,p,_)},u=0,c=l;u<c.length;u++){var f=c[u];h(f)}var d={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},m=t.getResourcePath(e,o.baseUrl);o.add(a,m,d,function(g){if(g.error){i(g.error);return}var p=new qee(g.texture,e.data,e.url);p.parse().then(function(){e.spritesheet=p,e.textures=p.textures,i()})})},t.getResourcePath=function(e,i){return e.isDataUrl?e.data.meta.image:sa.resolve(e.url.replace(i,""),e.data.meta.image)},t.extension=Pt.Loader,t}();var AC=function(t,e){return AC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},AC(t,e)};function SU(t,e){AC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var wd=new Ht,dTe=function(t){SU(e,t);function e(i,r,n){r===void 0&&(r=100),n===void 0&&(n=100);var o=t.call(this,i)||this;return o.tileTransform=new J0,o._width=r,o._height=n,o.uvMatrix=o.texture.uvMatrix||new vd(i),o.pluginName="tilingSprite",o.uvRespectAnchor=!1,o}return Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(i){this.uvMatrix.clampMargin=i,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(i){this.tileTransform.scale.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(i){this.tileTransform.position.copyFrom(i)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(i){var r=this._texture;!r||!r.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),i.batch.setObjectRenderer(i.plugins[this.pluginName]),i.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var i=this._width*-this._anchor._x,r=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),o=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,i,r,n,o)},e.prototype.getLocalBounds=function(i){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),i||(this._localBoundsRect||(this._localBoundsRect=new Tt),i=this._localBoundsRect),this._bounds.getRectangle(i)):t.prototype.getLocalBounds.call(this,i)},e.prototype.containsPoint=function(i){this.worldTransform.applyInverse(i,wd);var r=this._width,n=this._height,o=-r*this.anchor._x;if(wd.x>=o&&wd.x<o+r){var a=-n*this.anchor._y;if(wd.y>=a&&wd.y<a+n)return!0}return!1},e.prototype.destroy=function(i){t.prototype.destroy.call(this,i),this.tileTransform=null,this.uvMatrix=null},e.from=function(i,r){var n=i instanceof lt?i:lt.from(i,r);return new e(n,r.width,r.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(i){this._width=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(i){this._height=i},enumerable:!1,configurable:!0}),e}(fa),Xee=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,wU=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Yee=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Zee=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Kee=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,M_=new Zt,CU=function(t){SU(e,t);function e(i){var r=t.call(this,i)||this;return i.runners.contextChange.add(r),r.quad=new rC,r.state=Gs.for2d(),r}return e.prototype.contextChange=function(){var i=this.renderer,r={globals:i.globalUniforms};this.simpleShader=ms.from(wU,Xee,r),this.shader=i.context.webGLVersion>1?ms.from(Zee,Kee,r):ms.from(wU,Yee,r)},e.prototype.render=function(i){var r=this.renderer,n=this.quad,o=n.vertices;o[0]=o[6]=i._width*-i.anchor.x,o[1]=o[3]=i._height*-i.anchor.y,o[2]=o[4]=i._width*(1-i.anchor.x),o[5]=o[7]=i._height*(1-i.anchor.y);var a=i.uvRespectAnchor?i.anchor.x:0,l=i.uvRespectAnchor?i.anchor.y:0;o=n.uvs,o[0]=o[6]=-a,o[1]=o[3]=-l,o[2]=o[4]=1-a,o[5]=o[7]=1-l,n.invalidate();var h=i._texture,u=h.baseTexture,c=u.alphaMode>0,f=i.tileTransform.localTransform,d=i.uvMatrix,m=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;m&&(u._glTextures[r.CONTEXT_UID]?m=u.wrapMode!==Jr.CLAMP:u.wrapMode===Jr.CLAMP&&(u.wrapMode=Jr.REPEAT));var v=m?this.simpleShader:this.shader,g=h.width,p=h.height,_=i._width,x=i._height;M_.set(f.a*g/_,f.b*g/x,f.c*p/_,f.d*p/x,f.tx/_,f.ty/x),M_.invert(),m?M_.prepend(d.mapCoord):(v.uniforms.uMapCoord=d.mapCoord.toArray(!0),v.uniforms.uClampFrame=d.uClampFrame,v.uniforms.uClampOffset=d.uClampOffset),v.uniforms.uTransform=M_.toArray(!0),v.uniforms.uColor=ld(i.tint,i.worldAlpha,v.uniforms.uColor,c),v.uniforms.translationMatrix=i.transform.worldTransform.toArray(!0),v.uniforms.uSampler=h,r.shader.bind(v),r.geometry.bind(n),this.state.blendMode=ad(i.blendMode,c),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e.extension={name:"tilingSprite",type:Pt.RendererPlugin},e}(ic);var RC=function(t,e){return RC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},RC(t,e)};function LC(t,e){RC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Qee=function(){function t(e,i){this.uvBuffer=e,this.uvMatrix=i,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(e){if(!(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var i=this.uvBuffer.data;(!this.data||this.data.length!==i.length)&&(this.data=new Float32Array(i.length)),this.uvMatrix.multiplyUvs(i,this.data),this._updateID++}},t}(),PC=new Ht,MU=new Ju,ph=function(t){LC(e,t);function e(i,r,n,o){o===void 0&&(o=vn.TRIANGLES);var a=t.call(this)||this;return a.geometry=i,a.shader=r,a.state=n||Gs.for2d(),a.drawMode=o,a.start=0,a.size=0,a.uvs=null,a.indices=null,a.vertexData=new Float32Array(1),a.vertexDirty=-1,a._transformID=-1,a._roundPixels=Fe.ROUND_PIXELS,a.batchUvs=null,a}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(i){this.shader=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(i){this.state.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(i){this.shader.tint=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(i){this.shader.texture=i},enumerable:!1,configurable:!0}),e.prototype._render=function(i){var r=this.geometry.buffers[0].data,n=this.shader;n.batchable&&this.drawMode===vn.TRIANGLES&&r.length<e.BATCHABLE_SIZE*2?this._renderToBatch(i):this._renderDefault(i)},e.prototype._renderDefault=function(i){var r=this.shader;r.alpha=this.worldAlpha,r.update&&r.update(),i.batch.flush(),r.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(r),i.state.set(this.state),i.geometry.bind(this.geometry,r),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(i){var r=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=r.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;var o=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[o]),i.plugins[o].render(this)},e.prototype.calculateVertices=function(){var i=this.geometry,r=i.buffers[0],n=r.data,o=r._updateID;if(!(o===this.vertexDirty&&this._transformID===this.transform._worldID)){this._transformID=this.transform._worldID,this.vertexData.length!==n.length&&(this.vertexData=new Float32Array(n.length));for(var a=this.transform.worldTransform,l=a.a,h=a.b,u=a.c,c=a.d,f=a.tx,d=a.ty,m=this.vertexData,v=0;v<m.length/2;v++){var g=n[v*2],p=n[v*2+1];m[v*2]=l*g+u*p+f,m[v*2+1]=h*g+c*p+d}if(this._roundPixels)for(var _=Fe.RESOLUTION,v=0;v<m.length;++v)m[v]=Math.round((m[v]*_|0)/_);this.vertexDirty=o}},e.prototype.calculateUvs=function(){var i=this.geometry.buffers[1],r=this.shader;r.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new Qee(i,r.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,PC);for(var r=this.geometry.getBuffer("aVertexPosition").data,n=MU.points,o=this.geometry.getIndex().data,a=o.length,l=this.drawMode===4?3:1,h=0;h+2<a;h+=l){var u=o[h]*2,c=o[h+1]*2,f=o[h+2]*2;if(n[0]=r[u],n[1]=r[u+1],n[2]=r[c],n[3]=r[c+1],n[4]=r[f],n[5]=r[f+1],MU.contains(PC.x,PC.y))return!0}return!1},e.prototype.destroy=function(i){t.prototype.destroy.call(this,i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(fi),Jee=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,$ee=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`,mh=function(t){LC(e,t);function e(i,r){var n=this,o={uSampler:i,alpha:1,uTextureMatrix:Zt.IDENTITY,uColor:new Float32Array([1,1,1,1])};return r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(o,r.uniforms),n=t.call(this,r.program||uh.from($ee,Jee),o)||this,n._colorDirty=!1,n.uvMatrix=new vd(i),n.batchable=r.program===void 0,n.pluginName=r.pluginName,n.tint=r.tint,n.alpha=r.alpha,n}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(i){this.uniforms.uSampler!==i&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!i.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=i,this.uvMatrix.texture=i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(i){i!==this._alpha&&(this._alpha=i,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){i!==this._tint&&(this._tint=i,this._tintRGB=(i>>16)+(i&65280)+((i&255)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var i=this.texture.baseTexture;ld(this._tint,this._alpha,this.uniforms.uColor,i.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(ms),oc=function(t){LC(e,t);function e(i,r,n){var o=t.call(this)||this,a=new Ni(i),l=new Ni(r,!0),h=new Ni(n,!0,!0);return o.addAttribute("aVertexPosition",a,2,!1,ht.FLOAT).addAttribute("aTextureCoord",l,2,!1,ht.FLOAT).addIndex(h),o._updateId=-1,o}return Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(hh);var DC=function(t,e){return DC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},DC(t,e)};function ete(t,e){DC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var T_=function(){function t(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}return t}(),tte=function(){function t(){}return t.test=function(e){return typeof e=="string"&&e.indexOf("info face=")===0},t.parse=function(e){var i=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var n in i){var o=i[n].match(/^[a-z]+/gm)[0],a=i[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(var h in a){var u=a[h].split("="),c=u[0],f=u[1].replace(/"/gm,""),d=parseFloat(f),m=isNaN(d)?f:d;l[c]=m}r[o].push(l)}var v=new T_;return r.info.forEach(function(g){return v.info.push({face:g.face,size:parseInt(g.size,10)})}),r.common.forEach(function(g){return v.common.push({lineHeight:parseInt(g.lineHeight,10)})}),r.page.forEach(function(g){return v.page.push({id:parseInt(g.id,10),file:g.file})}),r.char.forEach(function(g){return v.char.push({id:parseInt(g.id,10),page:parseInt(g.page,10),x:parseInt(g.x,10),y:parseInt(g.y,10),width:parseInt(g.width,10),height:parseInt(g.height,10),xoffset:parseInt(g.xoffset,10),yoffset:parseInt(g.yoffset,10),xadvance:parseInt(g.xadvance,10)})}),r.kerning.forEach(function(g){return v.kerning.push({first:parseInt(g.first,10),second:parseInt(g.second,10),amount:parseInt(g.amount,10)})}),r.distanceField.forEach(function(g){return v.distanceField.push({distanceRange:parseInt(g.distanceRange,10),fieldType:g.fieldType})}),v},t}(),IC=function(){function t(){}return t.test=function(e){return e instanceof XMLDocument&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},t.parse=function(e){for(var i=new T_,r=e.getElementsByTagName("info"),n=e.getElementsByTagName("common"),o=e.getElementsByTagName("page"),a=e.getElementsByTagName("char"),l=e.getElementsByTagName("kerning"),h=e.getElementsByTagName("distanceField"),u=0;u<r.length;u++)i.info.push({face:r[u].getAttribute("face"),size:parseInt(r[u].getAttribute("size"),10)});for(var u=0;u<n.length;u++)i.common.push({lineHeight:parseInt(n[u].getAttribute("lineHeight"),10)});for(var u=0;u<o.length;u++)i.page.push({id:parseInt(o[u].getAttribute("id"),10)||0,file:o[u].getAttribute("file")});for(var u=0;u<a.length;u++){var c=a[u];i.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(var u=0;u<l.length;u++)i.kerning.push({first:parseInt(l[u].getAttribute("first"),10),second:parseInt(l[u].getAttribute("second"),10),amount:parseInt(l[u].getAttribute("amount"),10)});for(var u=0;u<h.length;u++)i.distanceField.push({fieldType:h[u].getAttribute("fieldType"),distanceRange:parseInt(h[u].getAttribute("distanceRange"),10)});return i},t}(),ite=function(){function t(){}return t.test=function(e){if(typeof e=="string"&&e.indexOf("<font>")>-1){var i=new globalThis.DOMParser().parseFromString(e,"text/xml");return IC.test(i)}return!1},t.parse=function(e){var i=new globalThis.DOMParser().parseFromString(e,"text/xml");return IC.parse(i)},t}(),OC=[tte,IC,ite];function PU(t){for(var e=0;e<OC.length;e++)if(OC[e].test(t))return OC[e];return null}function rte(t,e,i,r,n,o){var a=i.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;var l,h=i.dropShadow?i.dropShadowDistance:0,u=i.padding||0,c=t.width/r-h-u*2,f=t.height/r-h-u*2,d=a.slice(),m=i.fillGradientStops.slice();if(!m.length)for(var v=d.length+1,g=1;g<v;++g)m.push(g/v);if(d.unshift(a[0]),m.unshift(0),d.push(a[a.length-1]),m.push(1),i.fillGradientType===sc.LINEAR_VERTICAL){l=e.createLinearGradient(c/2,u,c/2,f+u);for(var p=0,_=o.fontProperties.fontSize+i.strokeThickness,x=_/f,g=0;g<n.length;g++)for(var b=o.lineHeight*g,y=0;y<d.length;y++){var w=0;typeof m[y]=="number"?w=m[y]:w=y/d.length;var S=b/f+w*x,R=Math.max(p,S);R=Math.min(R,1),l.addColorStop(R,d[y]),p=R}}else{l=e.createLinearGradient(u,f/2,c+u,f/2);for(var E=d.length+1,T=1,g=0;g<d.length;g++){var A=void 0;typeof m[g]=="number"?A=m[g]:A=T/E,l.addColorStop(A,d[g]),T++}}return l}function nte(t,e,i,r,n,o,a){var l=i.text,h=i.fontProperties;e.translate(r,n),e.scale(o,o);var u=a.strokeThickness/2,c=-(a.strokeThickness/2);if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=rte(t,e,a,o,[l],i),e.strokeStyle=a.stroke,a.dropShadow){var f=a.dropShadowColor,d=ds(typeof f=="number"?f:od(f)),m=a.dropShadowBlur*o,v=a.dropShadowDistance*o;e.shadowColor="rgba("+d[0]*255+","+d[1]*255+","+d[2]*255+","+a.dropShadowAlpha+")",e.shadowBlur=m,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*v,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*v}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(l,u,c+i.lineHeight-h.descent),a.fill&&e.fillText(l,u,c+i.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function RU(t){return Array.from?Array.from(t):t.split("")}function ste(t){typeof t=="string"&&(t=[t]);for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n)){if(n.length!==2)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var o=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<o)throw new Error("[BitmapFont]: Invalid character range.");for(var l=o,h=a;l<=h;l++)e.push(String.fromCharCode(l))}else e.push.apply(e,RU(n))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}function E_(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}var ll=function(){function t(e,i,r){var n,o,a=e.info[0],l=e.common[0],h=e.page[0],u=e.distanceField[0],c=tl(h.file),f={};this._ownsTextures=r,this.font=a.face,this.size=a.size,this.lineHeight=l.lineHeight/c,this.chars={},this.pageTextures=f;for(var d=0;d<e.page.length;d++){var m=e.page[d],v=m.id,g=m.file;f[v]=i instanceof Array?i[d]:i[g],u!=null&&u.fieldType&&u.fieldType!=="none"&&(f[v].baseTexture.alphaMode=_n.NO_PREMULTIPLIED_ALPHA,f[v].baseTexture.mipmap=$r.OFF)}for(var d=0;d<e.char.length;d++){var p=e.char[d],v=p.id,_=p.page,x=e.char[d],b=x.x,y=x.y,w=x.width,S=x.height,R=x.xoffset,E=x.yoffset,T=x.xadvance;b/=c,y/=c,w/=c,S/=c,R/=c,E/=c,T/=c;var A=new Tt(b+f[_].frame.x/c,y+f[_].frame.y/c,w,S);this.chars[v]={xOffset:R,yOffset:E,xAdvance:T,kerning:{},texture:new lt(f[_].baseTexture,A),page:_}}for(var d=0;d<e.kerning.length;d++){var C=e.kerning[d],M=C.first,D=C.second,O=C.amount;M/=c,D/=c,O/=c,this.chars[D]&&(this.chars[D].kerning[M]=O)}this.distanceFieldRange=u==null?void 0:u.distanceRange,this.distanceFieldType=(o=(n=u==null?void 0:u.fieldType)===null||n===void 0?void 0:n.toLowerCase())!==null&&o!==void 0?o:"none"}return t.prototype.destroy=function(){for(var e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(var e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null},t.install=function(e,i,r){var n;if(e instanceof T_)n=e;else{var o=PU(e);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(e)}i instanceof lt&&(i=[i]);var a=new t(n,i,r);return t.available[a.font]=a,a},t.uninstall=function(e){var i=t.available[e];if(!i)throw new Error("No font found named '"+e+"'");i.destroy(),delete t.available[e]},t.from=function(e,i,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},t.defaultOptions,r),o=n.chars,a=n.padding,l=n.resolution,h=n.textureWidth,u=n.textureHeight,c=ste(o),f=i instanceof al?i:new al(i),d=h,m=new T_;m.info[0]={face:f.fontFamily,size:f.fontSize},m.common[0]={lineHeight:f.fontSize};for(var v=0,g=0,p,_,x,b=0,y=[],w=0;w<c.length;w++){p||(p=Fe.ADAPTER.createCanvas(),p.width=h,p.height=u,_=p.getContext("2d"),x=new At(p,{resolution:l}),y.push(new lt(x)),m.page.push({id:y.length-1,file:""}));var S=c[w],R=gs.measureText(S,f,!1,p),E=R.width,T=Math.ceil(R.height),A=Math.ceil((f.fontStyle==="italic"?2:1)*E);if(g>=u-T*l){if(g===0)throw new Error("[BitmapFont] textureHeight "+u+"px is too small "+("(fontFamily: '"+f.fontFamily+"', fontSize: "+f.fontSize+"px, char: '"+S+"')"));--w,p=null,_=null,x=null,g=0,v=0,b=0;continue}if(b=Math.max(T+R.fontProperties.descent,b),A*l+v>=d){if(v===0)throw new Error("[BitmapFont] textureWidth "+h+"px is too small "+("(fontFamily: '"+f.fontFamily+"', fontSize: "+f.fontSize+"px, char: '"+S+"')"));--w,g+=b*l,g=Math.ceil(g),v=0,b=0;continue}nte(p,_,R,v,g,l,f);var C=E_(R.text);m.char.push({id:C,page:y.length-1,x:v/l,y:g/l,width:A,height:T,xoffset:0,yoffset:0,xadvance:Math.ceil(E-(f.dropShadow?f.dropShadowDistance:0)-(f.stroke?f.strokeThickness:0))}),v+=(A+2*a)*l,v=Math.ceil(v)}for(var w=0,M=c.length;w<M;w++)for(var D=c[w],O=0;O<M;O++){var P=c[O],L=_.measureText(D).width,I=_.measureText(P).width,k=_.measureText(D+P).width,B=k-(L+I);B&&m.kerning.push({first:E_(D),second:E_(P),amount:B})}var F=new t(m,y,!0);return t.available[e]!==void 0&&t.uninstall(e),t.available[e]=F,F},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),ote=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,ate=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`,EU=[],TU=[],AU=[],LTe=function(t){ete(e,t);function e(i,r){r===void 0&&(r={});var n=t.call(this)||this;n._tint=16777215;var o=Object.assign({},e.styleDefaults,r),a=o.align,l=o.tint,h=o.maxWidth,u=o.letterSpacing,c=o.fontName,f=o.fontSize;if(!ll.available[c])throw new Error('Missing BitmapFont "'+c+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=a,n._tint=l,n._font=void 0,n._fontName=c,n._fontSize=f,n.text=i,n._maxWidth=h,n._maxLineHeight=0,n._letterSpacing=u,n._anchor=new rl(function(){n.dirty=!0},n,0,0),n._roundPixels=Fe.ROUND_PIXELS,n.dirty=!0,n._resolution=Fe.RESOLUTION,n._autoResolution=!0,n._textureCache={},n}return e.prototype.updateText=function(){for(var i,r=ll.available[this._fontName],n=this.fontSize,o=n/r.size,a=new Ht,l=[],h=[],u=[],c=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",f=RU(c),d=this._maxWidth*r.size/n,m=r.distanceFieldType==="none"?EU:TU,v=null,g=0,p=0,_=0,x=-1,b=0,y=0,w=0,S=0,R=0;R<f.length;R++){var E=f[R],T=E_(E);if(/(?:\s)/.test(E)&&(x=R,b=g,S++),E==="\r"||E===`
`){h.push(g),u.push(-1),p=Math.max(p,g),++_,++y,a.x=0,a.y+=r.lineHeight,v=null,S=0;continue}var A=r.chars[T];if(A){v&&A.kerning[v]&&(a.x+=A.kerning[v]);var C=AU.pop()||{texture:lt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ht};C.texture=A.texture,C.line=_,C.charCode=T,C.position.x=a.x+A.xOffset+this._letterSpacing/2,C.position.y=a.y+A.yOffset,C.prevSpaces=S,l.push(C),g=C.position.x+Math.max(A.xAdvance-A.xOffset,A.texture.orig.width),a.x+=A.xAdvance+this._letterSpacing,w=Math.max(w,A.yOffset+A.texture.height),v=T,x!==-1&&d>0&&a.x>d&&(++y,Us(l,1+x-y,1+R-x),R=x,x=-1,h.push(b),u.push(l.length>0?l[l.length-1].prevSpaces:0),p=Math.max(p,b),_++,a.x=0,a.y+=r.lineHeight,v=null,S=0)}}var M=f[f.length-1];M!=="\r"&&M!==`
`&&(/(?:\s)/.test(M)&&(g=b),h.push(g),p=Math.max(p,g),u.push(-1));for(var D=[],R=0;R<=_;R++){var O=0;this._align==="right"?O=p-h[R]:this._align==="center"?O=(p-h[R])/2:this._align==="justify"&&(O=u[R]<0?0:(p-h[R])/u[R]),D.push(O)}var P=l.length,L={},I=[],k=this._activePagesMeshData;m.push.apply(m,k);for(var R=0;R<P;R++){var B=l[R].texture,F=B.baseTexture.uid;if(!L[F]){var W=m.pop();if(!W){var V=new oc,N=void 0,ne=void 0;r.distanceFieldType==="none"?(N=new mh(lt.EMPTY),ne=at.NORMAL):(N=new mh(lt.EMPTY,{program:uh.from(ate,ote),uniforms:{uFWidth:0}}),ne=at.NORMAL_NPM);var ie=new ph(V,N);ie.blendMode=ne,W={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:ie,vertices:null,uvs:null,indices:null}}W.index=0,W.indexCount=0,W.vertexCount=0,W.uvsCount=0,W.total=0;var Q=this._textureCache;Q[F]=Q[F]||new lt(B.baseTexture),W.mesh.texture=Q[F],W.mesh.tint=this._tint,I.push(W),L[F]=W}L[F].total++}for(var R=0;R<k.length;R++)I.indexOf(k[R])===-1&&this.removeChild(k[R].mesh);for(var R=0;R<I.length;R++)I[R].mesh.parent!==this&&this.addChild(I[R].mesh);this._activePagesMeshData=I;for(var R in L){var W=L[R],K=W.total;if(!(((i=W.indices)===null||i===void 0?void 0:i.length)>6*K)||W.vertices.length<ph.BATCHABLE_SIZE*2)W.vertices=new Float32Array(4*2*K),W.uvs=new Float32Array(4*2*K),W.indices=new Uint16Array(6*K);else for(var de=W.total,re=W.vertices,Y=de*4*2;Y<re.length;Y++)re[Y]=0;W.mesh.size=6*K}for(var R=0;R<P;R++){var E=l[R],U=E.position.x+D[E.line]*(this._align==="justify"?E.prevSpaces:1);this._roundPixels&&(U=Math.round(U));var z=U*o,te=E.position.y*o,B=E.texture,ge=L[B.baseTexture.uid],Me=B.frame,ze=B._uvs,He=ge.index++;ge.indices[He*6+0]=0+He*4,ge.indices[He*6+1]=1+He*4,ge.indices[He*6+2]=2+He*4,ge.indices[He*6+3]=0+He*4,ge.indices[He*6+4]=2+He*4,ge.indices[He*6+5]=3+He*4,ge.vertices[He*8+0]=z,ge.vertices[He*8+1]=te,ge.vertices[He*8+2]=z+Me.width*o,ge.vertices[He*8+3]=te,ge.vertices[He*8+4]=z+Me.width*o,ge.vertices[He*8+5]=te+Me.height*o,ge.vertices[He*8+6]=z,ge.vertices[He*8+7]=te+Me.height*o,ge.uvs[He*8+0]=ze.x0,ge.uvs[He*8+1]=ze.y0,ge.uvs[He*8+2]=ze.x1,ge.uvs[He*8+3]=ze.y1,ge.uvs[He*8+4]=ze.x2,ge.uvs[He*8+5]=ze.y2,ge.uvs[He*8+6]=ze.x3,ge.uvs[He*8+7]=ze.y3}this._textWidth=p*o,this._textHeight=(a.y+r.lineHeight)*o;for(var R in L){var W=L[R];if(this.anchor.x!==0||this.anchor.y!==0)for(var Ne=0,Ye=this._textWidth*this.anchor.x,Ae=this._textHeight*this.anchor.y,Ft=0;Ft<W.total;Ft++)W.vertices[Ne++]-=Ye,W.vertices[Ne++]-=Ae,W.vertices[Ne++]-=Ye,W.vertices[Ne++]-=Ae,W.vertices[Ne++]-=Ye,W.vertices[Ne++]-=Ae,W.vertices[Ne++]-=Ye,W.vertices[Ne++]-=Ae;this._maxLineHeight=w*o;var Z=W.mesh.geometry.getBuffer("aVertexPosition"),j=W.mesh.geometry.getBuffer("aTextureCoord"),_e=W.mesh.geometry.getIndex();Z.data=W.vertices,j.data=W.uvs,_e.data=W.indices,Z.update(),j.update(),_e.update()}for(var R=0;R<l.length;R++)AU.push(l[R]);this._font=r,this.dirty=!1},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype._render=function(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);var r=ll.available[this._fontName],n=r.distanceFieldRange,o=r.distanceFieldType,a=r.size;if(o!=="none")for(var l=this.worldTransform,h=l.a,u=l.b,c=l.c,f=l.d,d=Math.sqrt(h*h+u*u),m=Math.sqrt(c*c+f*f),v=(Math.abs(d)+Math.abs(m))/2,g=this.fontSize/a,p=0,_=this._activePagesMeshData;p<_.length;p++){var x=_[p];x.mesh.shader.uniforms.uFWidth=v*n*g*this._resolution}t.prototype._render.call(this,i)},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){var i=ll.available[this._fontName];if(!i)throw new Error('Missing BitmapFont "'+this._fontName+'"');this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(i){if(this._tint!==i){this._tint=i;for(var r=0;r<this._activePagesMeshData.length;r++)this._activePagesMeshData[r].mesh.tint=i}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(i){this._align!==i&&(this._align=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(i){if(!ll.available[i])throw new Error('Missing BitmapFont "'+i+'"');this._fontName!==i&&(this._fontName=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){var i;return(i=this._fontSize)!==null&&i!==void 0?i:ll.available[this._fontName].size},set:function(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(i){typeof i=="number"?this._anchor.set(i):this._anchor.copyFrom(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(i){i=String(i==null?"":i),this._text!==i&&(this._text=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)},enumerable:!1,configurable:!0}),e.prototype.destroy=function(i){var r=this._textureCache,n=ll.available[this._fontName],o=n.distanceFieldType==="none"?EU:TU;o.push.apply(o,this._activePagesMeshData);for(var a=0,l=this._activePagesMeshData;a<l.length;a++){var h=l[a];this.removeChild(h.mesh)}this._activePagesMeshData=[],o.filter(function(f){return r[f.mesh.texture.baseTexture.uid]}).forEach(function(f){f.mesh.texture=lt.EMPTY});for(var u in r){var c=r[u];c.destroy(),delete r[u]}this._font=null,this._textureCache=null,t.prototype.destroy.call(this,i)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(fi),LU=function(){function t(){}return t.add=function(){li.setExtensionXhrType("fnt",li.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,i){var r=PU(e.data);if(!r){i();return}for(var n=t.getBaseUrl(this,e),o=r.parse(e.data),a={},l=function(g){a[g.metadata.pageFile]=g.texture,Object.keys(a).length===o.page.length&&(e.bitmapFont=ll.install(o,a,!0),i())},h=0;h<o.page.length;++h){var u=o.page[h].file,c=n+u,f=!1;for(var d in this.resources){var m=this.resources[d];if(m.url===c){m.metadata.pageFile=u,m.texture?l(m):m.onAfterMiddleware.add(l),f=!0;break}}if(!f){var v={crossOrigin:e.crossOrigin,loadType:li.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:u},e.metadata.imageMetadata),parentResource:e};this.add(c,v,l)}}},t.getBaseUrl=function(e,i){var r=i.isDataUrl?"":t.dirname(i.url);return i.isDataUrl&&(r==="."&&(r=""),e.baseUrl&&r&&e.baseUrl.charAt(e.baseUrl.length-1)==="/"&&(r+="/")),r=r.replace(e.baseUrl,""),r&&r.charAt(r.length-1)!=="/"&&(r+="/"),r},t.dirname=function(e){var i=e.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return i===e?".":i===""?"/":i},t.extension=Pt.Loader,t}();var kC=function(t,e){return kC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},kC(t,e)};function lte(t,e){kC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var hte=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`,ute=function(t){lte(e,t);function e(i){i===void 0&&(i=1);var r=t.call(this,UN,hte,{uAlpha:1})||this;return r.alpha=i,r}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(i){this.uniforms.uAlpha=i},enumerable:!1,configurable:!0}),e}(xn);var FC=function(t,e){return FC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},FC(t,e)};function OU(t,e){FC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var cte=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function fte(t,e){var i=Math.ceil(t/2),r=cte,n="",o;e?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<t;a++){var l=o.replace("%index%",a.toString());l=l.replace("%sampleIndex%",a-(i-1)+".0"),n+=l,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",t.toString()),r}var dte={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},pte=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function mte(t){for(var e=dte[t],i=e.length,r=pte,n="",o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",a,l=0;l<t;l++){var h=o.replace("%index%",l.toString());a=l,l>=i&&(a=t-l-1),h=h.replace("%value%",e[a].toString()),n+=h,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",t.toString()),r}var BC=function(t){OU(e,t);function e(i,r,n,o,a){r===void 0&&(r=8),n===void 0&&(n=4),o===void 0&&(o=Fe.FILTER_RESOLUTION),a===void 0&&(a=5);var l=this,h=fte(a,i),u=mte(a);return l=t.call(this,h,u)||this,l.horizontal=i,l.resolution=o,l._quality=0,l.quality=n,l.blur=r,l}return e.prototype.apply=function(i,r,n,o){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/r.width):this.uniforms.strength=1/n.height*(n.height/r.height):this.horizontal?this.uniforms.strength=1/i.renderer.width*(i.renderer.width/r.width):this.uniforms.strength=1/i.renderer.height*(i.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)i.applyFilter(this,r,n,o);else{var a=i.getFilterTexture(),l=i.renderer,h=r,u=a;this.state.blend=!1,i.applyFilter(this,h,u,Fn.CLEAR);for(var c=1;c<this.passes-1;c++){i.bindAndClear(h,Fn.BLIT),this.uniforms.uSampler=u;var f=u;u=h,h=f,l.shader.bind(this),l.geometry.draw(5)}this.state.blend=!0,i.applyFilter(this,u,n,o),i.returnFilterTexture(a)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(i){this.padding=1+Math.abs(i)*2,this.strength=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(i){this._quality=i,this.passes=i},enumerable:!1,configurable:!0}),e}(xn),gte=function(t){OU(e,t);function e(i,r,n,o){i===void 0&&(i=8),r===void 0&&(r=4),n===void 0&&(n=Fe.FILTER_RESOLUTION),o===void 0&&(o=5);var a=t.call(this)||this;return a.blurXFilter=new BC(!0,i,r,n,o),a.blurYFilter=new BC(!1,i,r,n,o),a.resolution=n,a.quality=r,a.blur=i,a.repeatEdgePixels=!1,a}return e.prototype.apply=function(i,r,n,o){var a=Math.abs(this.blurXFilter.strength),l=Math.abs(this.blurYFilter.strength);if(a&&l){var h=i.getFilterTexture();this.blurXFilter.apply(i,r,h,Fn.CLEAR),this.blurYFilter.apply(i,h,n,o),i.returnFilterTexture(h)}else l?this.blurYFilter.apply(i,r,n,o):this.blurXFilter.apply(i,r,n,o)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(i){this.blurXFilter.blur=this.blurYFilter.blur=i,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(i){this.blurXFilter.quality=this.blurYFilter.quality=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(i){this.blurXFilter.blur=i,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(i){this.blurYFilter.blur=i,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(i){this.blurYFilter.blendMode=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(i){this._repeatEdgePixels=i,this.updatePadding()},enumerable:!1,configurable:!0}),e}(xn);var NC=function(t,e){return NC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},NC(t,e)};function vte(t,e){NC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var _te=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,UC=function(t){vte(e,t);function e(){var i=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return i=t.call(this,o_,_te,r)||this,i.alpha=1,i}return e.prototype._loadMatrix=function(i,r){r===void 0&&(r=!1);var n=i;r&&(this._multiply(n,this.uniforms.m,i),n=this._colorMatrix(n)),this.uniforms.m=n},e.prototype._multiply=function(i,r,n){return i[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],i[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],i[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],i[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],i[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],i[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],i[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],i[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],i[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],i[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],i[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],i[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],i[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],i[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],i[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],i[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],i[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],i[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],i[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],i[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],i},e.prototype._colorMatrix=function(i){var r=new Float32Array(i);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},e.prototype.brightness=function(i,r){var n=[i,0,0,0,0,0,i,0,0,0,0,0,i,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.tint=function(i,r){var n=i>>16&255,o=i>>8&255,a=i&255,l=[n/255,0,0,0,0,0,o/255,0,0,0,0,0,a/255,0,0,0,0,0,1,0];this._loadMatrix(l,r)},e.prototype.greyscale=function(i,r){var n=[i,i,i,0,0,i,i,i,0,0,i,i,i,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.blackAndWhite=function(i){var r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.hue=function(i,r){i=(i||0)/180*Math.PI;var n=Math.cos(i),o=Math.sin(i),a=Math.sqrt,l=1/3,h=a(l),u=n+(1-n)*l,c=l*(1-n)-h*o,f=l*(1-n)+h*o,d=l*(1-n)+h*o,m=n+l*(1-n),v=l*(1-n)-h*o,g=l*(1-n)-h*o,p=l*(1-n)+h*o,_=n+l*(1-n),x=[u,c,f,0,0,d,m,v,0,0,g,p,_,0,0,0,0,0,1,0];this._loadMatrix(x,r)},e.prototype.contrast=function(i,r){var n=(i||0)+1,o=-.5*(n-1),a=[n,0,0,0,o,0,n,0,0,o,0,0,n,0,o,0,0,0,1,0];this._loadMatrix(a,r)},e.prototype.saturate=function(i,r){i===void 0&&(i=0);var n=i*2/3+1,o=(n-1)*-.5,a=[n,o,o,0,0,o,n,o,0,0,o,o,n,0,0,0,0,0,1,0];this._loadMatrix(a,r)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(i){var r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.sepia=function(i){var r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.technicolor=function(i){var r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.polaroid=function(i){var r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.toBGR=function(i){var r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.kodachrome=function(i){var r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.browni=function(i){var r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.vintage=function(i){var r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.colorTone=function(i,r,n,o,a){i=i||.2,r=r||.15,n=n||16770432,o=o||3375104;var l=(n>>16&255)/255,h=(n>>8&255)/255,u=(n&255)/255,c=(o>>16&255)/255,f=(o>>8&255)/255,d=(o&255)/255,m=[.3,.59,.11,0,0,l,h,u,i,0,c,f,d,r,0,l-c,h-f,u-d,0,0];this._loadMatrix(m,a)},e.prototype.night=function(i,r){i=i||.1;var n=[i*-2,-i,0,0,0,-i,0,i,0,0,0,i,i*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.predator=function(i,r){var n=[11.224130630493164*i,-4.794486999511719*i,-2.8746118545532227*i,0*i,.40342438220977783*i,-3.6330697536468506*i,9.193157196044922*i,-2.951810836791992*i,0*i,-1.316135048866272*i,-3.2184197902679443*i,-4.2375030517578125*i,7.476448059082031*i,0*i,.8044459223747253*i,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.lsd=function(i){var r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,i)},e.prototype.reset=function(){var i=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(i,!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(i){this.uniforms.m=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(i){this.uniforms.uAlpha=i},enumerable:!1,configurable:!0}),e}(xn);UC.prototype.grayscale=UC.prototype.greyscale;var GC=function(t,e){return GC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},GC(t,e)};function yte(t,e){GC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var xte=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,bte=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`,wte=function(t){yte(e,t);function e(i,r){var n=this,o=new Zt;return i.renderable=!1,n=t.call(this,bte,xte,{mapSampler:i._texture,filterMatrix:o,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this,n.maskSprite=i,n.maskMatrix=o,r==null&&(r=20),n.scale=new Ht(r,r),n}return e.prototype.apply=function(i,r,n,o){this.uniforms.filterMatrix=i.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var a=this.maskSprite.worldTransform,l=Math.sqrt(a.a*a.a+a.b*a.b),h=Math.sqrt(a.c*a.c+a.d*a.d);l!==0&&h!==0&&(this.uniforms.rotation[0]=a.a/l,this.uniforms.rotation[1]=a.b/l,this.uniforms.rotation[2]=a.c/h,this.uniforms.rotation[3]=a.d/h),i.applyFilter(this,r,n,o)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(i){this.uniforms.mapSampler=i},enumerable:!1,configurable:!0}),e}(xn);var zC=function(t,e){return zC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},zC(t,e)};function Ste(t,e){zC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Cte=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,Mte=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,Ete=function(t){Ste(e,t);function e(){return t.call(this,Cte,Mte)||this}return e}(xn);var HC=function(t,e){return HC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},HC(t,e)};function Tte(t,e){HC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Ate=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`,Pte=function(t){Tte(e,t);function e(i,r){i===void 0&&(i=.5),r===void 0&&(r=Math.random());var n=t.call(this,o_,Ate,{uNoise:0,uSeed:0})||this;return n.noise=i,n.seed=r,n}return Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(i){this.uniforms.uNoise=i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(i){this.uniforms.uSeed=i},enumerable:!1,configurable:!0}),e}(xn);var DU=new Zt;ri.prototype._cacheAsBitmap=!1;ri.prototype._cacheData=null;ri.prototype._cacheAsBitmapResolution=null;ri.prototype._cacheAsBitmapMultisample=ai.NONE;var Rte=function(){function t(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}return t}();Object.defineProperties(ri.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap!==t){this._cacheAsBitmap=t;var e;t?(this._cacheData||(this._cacheData=new Rte),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}});ri.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))};ri.prototype._initCachedDisplayObject=function(e){var i;if(!(this._cacheData&&this._cacheData.sprite)){var r=this.alpha;this.alpha=1,e.batch.flush();var n=this.getLocalBounds(null,!0).clone();if(this.filters&&this.filters.length){var o=this.filters[0].padding;n.pad(o)}n.ceil(Fe.RESOLUTION);var a=e.renderTexture.current,l=e.renderTexture.sourceFrame.clone(),h=e.renderTexture.destinationFrame.clone(),u=e.projection.transform,c=la.create({width:n.width,height:n.height,resolution:this.cacheAsBitmapResolution||e.resolution,multisample:(i=this.cacheAsBitmapMultisample)!==null&&i!==void 0?i:e.multisample}),f="cacheAsBitmap_"+Co();this._cacheData.textureCacheId=f,At.addToCache(c.baseTexture,f),lt.addToCache(c,f);var d=this.transform.localTransform.copyTo(DU).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:c,clear:!0,transform:d,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=u,e.renderTexture.bind(a,l,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;var m=new fa(c);m.transform.worldTransform=this.transform.worldTransform,m.anchor.x=-(n.x/n.width),m.anchor.y=-(n.y/n.height),m.alpha=r,m._bounds=this._bounds,this._cacheData.sprite=m,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=m.containsPoint.bind(m)}};ri.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))};ri.prototype._initCachedDisplayObjectCanvas=function(e){if(!(this._cacheData&&this._cacheData.sprite)){var i=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;var n=e.context,o=e._projTransform;i.ceil(Fe.RESOLUTION);var a=la.create({width:i.width,height:i.height}),l="cacheAsBitmap_"+Co();this._cacheData.textureCacheId=l,At.addToCache(a.baseTexture,l),lt.addToCache(a,l);var h=DU;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=i.x,h.ty-=i.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),e.context=n,e._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;var u=new fa(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(i.x/i.width),u.anchor.y=-(i.y/i.height),u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)}};ri.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};ri.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};ri.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,At.removeFromCache(this._cacheData.textureCacheId),lt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};ri.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)};ri.prototype.name=null;fi.prototype.getChildByName=function(e,i){for(var r=0,n=this.children.length;r<n;r++)if(this.children[r].name===e)return this.children[r];if(i)for(var r=0,n=this.children.length;r<n;r++){var o=this.children[r];if(o.getChildByName){var a=o.getChildByName(e,!0);if(a)return a}}return null};ri.prototype.getGlobalPosition=function(e,i){return e===void 0&&(e=new Ht),i===void 0&&(i=!1),this.parent?this.parent.toGlobal(this.position,e,i):(e.x=this.position.x,e.y=this.position.y),e};var Lte=function(){function t(){}return t.init=function(e){var i=this;Object.defineProperty(this,"resizeTo",{set:function(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){i._resizeTo&&(i.cancelResize(),i._resizeId=requestAnimationFrame(function(){return i.resize()}))},this.cancelResize=function(){i._resizeId&&(cancelAnimationFrame(i._resizeId),i._resizeId=null)},this.resize=function(){if(i._resizeTo){i.cancelResize();var r,n;if(i._resizeTo===globalThis.window)r=globalThis.innerWidth,n=globalThis.innerHeight;else{var o=i._resizeTo,a=o.clientWidth,l=o.clientHeight;r=a,n=l}i.renderer.resize(r,n)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null},t.destroy=function(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t.extension=Pt.Application,t}(),WC=function(){function t(e){var i=this;this.stage=new fi,e=Object.assign({forceCanvas:!1},e),this.renderer=NN(e),t._plugins.forEach(function(r){r.init.call(i,e)})}return t.registerPlugin=function(e){Yi("6.5.0","Application.registerPlugin() is deprecated, use extensions.add()"),Nn.add({type:Pt.Application,ref:e})},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,i){var r=this,n=t._plugins.slice(0);n.reverse(),n.forEach(function(o){o.destroy.call(r)}),this.stage.destroy(i),this.stage=null,this.renderer.destroy(e),this.renderer=null},t._plugins=[],t}();Nn.handleByList(Pt.Application,WC._plugins);Nn.add(Lte);var VC=function(t,e){return VC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},VC(t,e)};function ac(t,e){VC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Ote=function(t){ac(e,t);function e(i,r,n,o){i===void 0&&(i=100),r===void 0&&(r=100),n===void 0&&(n=10),o===void 0&&(o=10);var a=t.call(this)||this;return a.segWidth=n,a.segHeight=o,a.width=i,a.height=r,a.build(),a}return e.prototype.build=function(){for(var i=this.segWidth*this.segHeight,r=[],n=[],o=[],a=this.segWidth-1,l=this.segHeight-1,h=this.width/a,u=this.height/l,c=0;c<i;c++){var f=c%this.segWidth,d=c/this.segWidth|0;r.push(f*h,d*u),n.push(f/a,d/l)}for(var m=a*l,c=0;c<m;c++){var v=c%a,g=c/a|0,p=g*this.segWidth+v,_=g*this.segWidth+v+1,x=(g+1)*this.segWidth+v,b=(g+1)*this.segWidth+v+1;o.push(p,_,x,_,b,x)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(o),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(oc),Dte=function(t){ac(e,t);function e(i,r,n){i===void 0&&(i=200),n===void 0&&(n=0);var o=t.call(this,new Float32Array(r.length*4),new Float32Array(r.length*4),new Uint16Array((r.length-1)*6))||this;return o.points=r,o._width=i,o.textureScale=n,o.build(),o}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var i=this.points;if(i){var r=this.getBuffer("aVertexPosition"),n=this.getBuffer("aTextureCoord"),o=this.getIndex();if(!(i.length<1)){r.data.length/4!==i.length&&(r.data=new Float32Array(i.length*4),n.data=new Float32Array(i.length*4),o.data=new Uint16Array((i.length-1)*6));var a=n.data,l=o.data;a[0]=0,a[1]=0,a[2]=0,a[3]=1;for(var h=0,u=i[0],c=this._width*this.textureScale,f=i.length,d=0;d<f;d++){var m=d*4;if(this.textureScale>0){var v=u.x-i[d].x,g=u.y-i[d].y,p=Math.sqrt(v*v+g*g);u=i[d],h+=p/c}else h=d/(f-1);a[m]=h,a[m+1]=0,a[m+2]=h,a[m+3]=1}for(var _=0,d=0;d<f-1;d++){var m=d*2;l[_++]=m,l[_++]=m+1,l[_++]=m+2,l[_++]=m+2,l[_++]=m+1,l[_++]=m+3}n.update(),o.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var i=this.points;if(!(i.length<1)){for(var r=i[0],n,o=0,a=0,l=this.buffers[0].data,h=i.length,u=0;u<h;u++){var c=i[u],f=u*4;u<i.length-1?n=i[u+1]:n=c,a=-(n.x-r.x),o=n.y-r.y;var d=Math.sqrt(o*o+a*a),m=this.textureScale>0?this.textureScale*this._width/2:this._width/2;o/=d,a/=d,o*=m,a*=m,l[f]=c.x+o,l[f+1]=c.y+a,l[f+2]=c.x-o,l[f+3]=c.y-a,r=c}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(oc),fAe=function(t){ac(e,t);function e(i,r,n){n===void 0&&(n=0);var o=this,a=new Dte(i.height,r,n),l=new mh(i);return n>0&&(i.baseTexture.wrapMode=Jr.REPEAT),o=t.call(this,a,l)||this,o.autoUpdate=!0,o}return e.prototype._render=function(i){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),t.prototype._render.call(this,i)},e}(ph),Ite=function(t){ac(e,t);function e(i,r,n){var o=this,a=new Ote(i.width,i.height,r,n),l=new mh(lt.WHITE);return o=t.call(this,a,l)||this,o.texture=i,o.autoResize=!0,o}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var i=this.geometry,r=this.shader.texture,n=r.width,o=r.height;this.autoResize&&(i.width!==n||i.height!==o)&&(i.width=this.shader.texture.width,i.height=this.shader.texture.height,i.build())},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(i){this.shader.texture!==i&&(this.shader.texture=i,this._textureID=-1,i.baseTexture.valid?this.textureUpdated():i.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(i){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,i)},e.prototype.destroy=function(i){this.shader.texture.off("update",this.textureUpdated,this),t.prototype.destroy.call(this,i)},e}(ph),dAe=function(t){ac(e,t);function e(i,r,n,o,a){i===void 0&&(i=lt.EMPTY);var l=this,h=new oc(r,n,o);h.getBuffer("aVertexPosition").static=!1;var u=new mh(i);return l=t.call(this,h,u,null,a)||this,l.autoUpdate=!0,l}return Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(i){this.geometry.getBuffer("aVertexPosition").data=i},enumerable:!1,configurable:!0}),e.prototype._render=function(i){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,i)},e}(ph),A_=10,pAe=function(t){ac(e,t);function e(i,r,n,o,a){r===void 0&&(r=A_),n===void 0&&(n=A_),o===void 0&&(o=A_),a===void 0&&(a=A_);var l=t.call(this,lt.WHITE,4,4)||this;return l._origWidth=i.orig.width,l._origHeight=i.orig.height,l._width=l._origWidth,l._height=l._origHeight,l._leftWidth=r,l._rightWidth=o,l._topHeight=n,l._bottomHeight=a,l.texture=i,l}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(i){this.geometry.getBuffer("aVertexPosition").data=i},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var i=this.vertices,r=this._getMinScale();i[9]=i[11]=i[13]=i[15]=this._topHeight*r,i[17]=i[19]=i[21]=i[23]=this._height-this._bottomHeight*r,i[25]=i[27]=i[29]=i[31]=this._height},e.prototype.updateVerticalVertices=function(){var i=this.vertices,r=this._getMinScale();i[2]=i[10]=i[18]=i[26]=this._leftWidth*r,i[4]=i[12]=i[20]=i[28]=this._width-this._rightWidth*r,i[6]=i[14]=i[22]=i[30]=this._width},e.prototype._getMinScale=function(){var i=this._leftWidth+this._rightWidth,r=this._width>i?1:this._width/i,n=this._topHeight+this._bottomHeight,o=this._height>n?1:this._height/n,a=Math.min(r,o);return a},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(i){this._width=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(i){this._height=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(i){this._leftWidth=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(i){this._rightWidth=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(i){this._topHeight=i,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(i){this._bottomHeight=i,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var i=this.texture,r=this.geometry.buffers[1].data;this._origWidth=i.orig.width,this._origHeight=i.orig.height;var n=1/this._origWidth,o=1/this._origHeight;r[0]=r[8]=r[16]=r[24]=0,r[1]=r[3]=r[5]=r[7]=0,r[6]=r[14]=r[22]=r[30]=1,r[25]=r[27]=r[29]=r[31]=1,r[2]=r[10]=r[18]=r[26]=n*this._leftWidth,r[4]=r[12]=r[20]=r[28]=1-n*this._rightWidth,r[9]=r[11]=r[13]=r[15]=o*this._topHeight,r[17]=r[19]=r[21]=r[23]=1-o*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e}(Ite);var jC=function(t,e){return jC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},jC(t,e)};function kte(t,e){jC(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var yAe=function(t){kte(e,t);function e(i,r){r===void 0&&(r=!0);var n=t.call(this,i[0]instanceof lt?i[0]:i[0].texture)||this;return n._textures=null,n._durations=null,n._autoUpdate=r,n._isConnectedToTicker=!1,n.animationSpeed=1,n.loop=!0,n.updateAnchor=!1,n.onComplete=null,n.onFrameChange=null,n.onLoop=null,n._currentTime=0,n._playing=!1,n._previousFrame=null,n.textures=i,n}return e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Bi.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Bi.shared.add(this.update,this,ps.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(i){this.stop();var r=this.currentFrame;this._currentTime=i,r!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(i){var r=this.currentFrame;this._currentTime=i,r!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(i){if(this._playing){var r=this.animationSpeed*i,n=this.currentFrame;if(this._durations!==null){var o=this._currentTime%1*this._durations[this.currentFrame];for(o+=r/60*1e3;o<0;)this._currentTime--,o+=this._durations[this.currentFrame];var a=Math.sign(this.animationSpeed*i);for(this._currentTime=Math.floor(this._currentTime);o>=this._durations[this.currentFrame];)o-=this._durations[this.currentFrame]*a,this._currentTime+=a;this._currentTime+=o/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n?this.onLoop():this.animationSpeed<0&&this.currentFrame>n&&this.onLoop()),this.updateTexture())}},e.prototype.updateTexture=function(){var i=this.currentFrame;this._previousFrame!==i&&(this._previousFrame=i,this._texture=this._textures[i],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(i){this.stop(),t.prototype.destroy.call(this,i),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(i){for(var r=[],n=0;n<i.length;++n)r.push(lt.from(i[n]));return new e(r)},e.fromImages=function(i){for(var r=[],n=0;n<i.length;++n)r.push(lt.from(i[n]));return new e(r)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(i){if(i[0]instanceof lt)this._textures=i,this._durations=null;else{this._textures=[],this._durations=[];for(var r=0;r<i.length;r++)this._textures.push(i[r].texture),this._durations.push(i[r].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var i=Math.floor(this._currentTime)%this._textures.length;return i<0&&(i+=this._textures.length),i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(Bi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Bi.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),e}(fa);Nn.add(HN,qN,WN,hU,xU,sC,CU,LU,rU,sU,oU,bU,X5,JN);var IU=Qi(ta());var Bte=`
#define PHONG
#define OUTPUT_FLAT_NORMAL 0

varying vec3 vViewPosition;

#include <common>
#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#else
	varying vec3 vColor;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif

// Filament specific attributes
attribute vec3 aColor;
attribute vec3 aPos;
attribute vec3 aRot; // alpha1 = x, alpha2 = y, beta = z
attribute vec3 aSize; // w = x, h = y, L = z  x < 0 => start filament, y < 0 => End filament
uniform ivec4 splitPos;
uniform float opacity;
uniform vec3 diffuse;
#if OUTPUT_FLAT_NORMAL
  attribute vec3 face_normal;
  varying vec3 flatNormal;
#endif
const vec4 invisiblePos = vec4(-2.0, -2.0, 0.0, 1.0);
void makeInvisible() {
  gl_Position = invisiblePos;
}

void main() {
	// aColor = Filament color, color = material color
#if defined( USE_COLOR_ALPHA )
 if(gl_InstanceID >= splitPos.x && gl_InstanceID < splitPos.y) {
   makeInvisible();
   return; 
 }
	vColor = vec4( aColor, 1.0 );
#else // if defined( USE_COLOR )
#if IS_TRANSPARENT == 0
 if(gl_InstanceID < splitPos.x) {
   makeInvisible();
   return; 
 }
  if (gl_InstanceID < splitPos.y) {
  	vColor = diffuse; // color; 
  } else {
    vColor = aColor;
  }
#else  
 if(gl_InstanceID >= splitPos.x && gl_InstanceID < splitPos.y) {
   makeInvisible();
   return; 
 }
	vColor = aColor;
#endif 
#endif
	vec2 sc = vec2(sin(aRot.z), cos(aRot.z));
	float Lrec = 1.0 / aSize.z;
	vec3 transformed = position.xyz; // vec3( position );
#if FIL_NO_ENDCAPS == 0
  vec2 wh = abs(aSize.xy);	
  if(transformed.x < 0.0) { // Start cap
	  if(aSize.x >= 0.0) {
	    makeInvisible();
	    return;
	  }
	  if(transformed.x < -1.1) {
	    transformed.x = -0.5 * wh.x * Lrec;
	  } else {
	    transformed.x = 0.0;
	  }
	} else if(transformed.x > 1.5) { // end cap
	  if(aSize.y >= 0.0) {
	    makeInvisible();
	    return;
	  }
	  if(transformed.x > 2.1) {
	    transformed.x = 0.5 * wh.x * Lrec + 1.0;
	  } else {
	    transformed.x = 1.0;
	  }
	}
#else
	vec2 wh = aSize.xy;	
#endif
  vec2 scDivW = sc / wh.x;	
  vec2 scDivL = sc * Lrec;
  vec2 scMulW = sc * wh.x;	
  vec2 scMulL = sc * aSize.z;
  // mat3 rotNorm = mat3(scDivL.y, -s / w, 0.0, scDivL.x, -scDivW.y, 0.0, 0.0, 0.0, 1.0 / wh.y);
  mat3 rotNorm = mat3(scDivL.y, scDivL.x, 0.0, -scDivW.x, -scDivW.y, 0.0, 0.0, 0.0, 1.0 / wh.y);
#if OUTPUT_FLAT_NORMAL  
  flatNormal = normalize(normalMatrix * rotNorm * face_normal);
#endif  
  vNormal = normalize( normalMatrix * rotNorm * normal );

	if(transformed.x == 0.0) { // Start rotation
	  transformed.x += aRot.x * transformed.y;
	}  else if(transformed.x == 1.0) {
	  transformed.x += aRot.y * transformed.y;
	}
	mat3 rot = mat3(scMulL.y, scMulL.x, 0.0, -scMulW.x, scMulW.y, 0.0, 0.0, 0.0, wh.y);
  vec4 mvPosition = modelViewMatrix * vec4( rot * transformed + aPos, 1.0 );
  gl_Position = projectionMatrix * mvPosition;
  /* 
  gl_Position is clipped space (-1 to 1 for all axes = visible area)
  clipped = (
      any(lessThan(gl_Position.xyz, -gl_Position.www)) ||
      any(greaterThan(gl_Position.xyz, gl_Position.www))
    ) ? 1.0 : 0.0; */
	// Position is computed - adjust gl_Position

	vViewPosition = -mvPosition.xyz;

	// include <worldpos_vertex>

}
`,Nte=`
#define PHONG

uniform vec3 diffuse;
#if HAS_EMISSIVE
uniform vec3 emissive;
#endif
uniform vec3 specular;
uniform float shininess;
#if HAS_OPACITY	
uniform float opacity;
#endif

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#else
	varying vec3 vColor;	
#endif
#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

#include <bsdfs>
#include <lights_pars_begin>
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
varying vec3 vViewPosition;

struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)

// varying float vVisible;
// varying vec3 flatNormal;

void main() {
  /* if(vVisible < 1.0) {
    discard;
    return;
  } */

	// vec4 diffuseColor = vec4( diffuse, opacity );
#if HAS_OPACITY	
	vec4 diffuseColor = vec4( vColor.xyz, opacity );
#else
	vec4 diffuseColor = vec4( vColor.xyz, 1.0 );
#endif	
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

/*
#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif
*/
#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif
  float specularStrength = 1.0;
	// float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
	// bool frontFacing = dot(flatNormal, vViewPosition) > 0.0;
  /*if(!gl_FrontFacing) {
    discard;
    return;
  }*/

	// vec3 normal = normalize( flatNormal );
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
	  if(!gl_FrontFacing) {
		  normal = -normal;
		}
	#endif
#if 0
if (normal.z > 0.0) {
  // gl_FragColor = vec4( 0.0, vNormal.z, clamp(vViewPosition.z * 5.0 ,0.0, 1.0), 1.0 );
  gl_FragColor = vec4( 0.0, normal.z, 0.0, 1.0 );
} else {
  // gl_FragColor = vec4( vNormal.z, 0.0, clamp(vViewPosition.z * 5.0 ,0.0, 1.0), 1.0 );
  gl_FragColor = vec4( -normal.z, 0.0, 0.0, 1.0 );
}
return;
#endif
  // vec3 geometryNormal = normal; // unused variable  

	// accumulation
  BlinnPhongMaterial material;
  material.diffuseColor = diffuseColor.rgb;
  material.specularColor = specular;
  material.specularShininess = shininess;
  material.specularStrength = specularStrength;

  GeometricContext geometry;

  geometry.position = - vViewPosition;
  geometry.normal = normal;
  geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

  IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
  	
 	float dotNL;
  vec3 irradiance;
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		// getDirectionalLightInfo( directionalLight, geometry, directLight );
		// directLight.color = directionalLight.color;
		// directLight.direction = directionalLight.direction;
		// directLight.visible = true;
  	dotNL = saturate( dot( geometry.normal, directionalLight.direction ) );
	  irradiance = dotNL * directionalLight.color;
	  reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	  reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directionalLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
	}
	#pragma unroll_loop_end
#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif

#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif

#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular
#if HAS_EMISSIVE	 
	+ emissive
#endif	
	;
#ifdef OPAQUE
  diffuseColor.a = 1.0;
#endif

// https://github.com/mrdoob/three.js/pull/22425
#ifdef USE_TRANSMISSION
  diffuseColor.a *= transmissionAlpha + 0.1;
#endif
  gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	gl_FragColor = linearToOutputTexel( gl_FragColor );
#ifdef PREMULTIPLIED_ALPHA
	// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.
	gl_FragColor.rgb *= gl_FragColor.a;
#endif
#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif
}
`,Ute=`
#define PHONG
#define OUTPUT_FLAT_NORMAL 0

varying vec3 vViewPosition;

#include <common>
#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#else
	varying vec3 vColor;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif

// Filament specific attributes
attribute vec3 aColor;
attribute vec3 aPos; // x,y,z
attribute vec2 aSize; // x = radius, y = height
uniform ivec4 splitPos;
uniform float opacity;
uniform vec3 diffuse;
const vec4 invisiblePos = vec4(-2.0, -2.0, 0.0, 1.0);
void makeInvisible() {
  gl_Position = invisiblePos;
}

void main() {
	// aColor = Filament color, color = material color
#if defined( USE_COLOR_ALPHA )
 if(gl_InstanceID >= splitPos.x && gl_InstanceID < splitPos.y) {
  makeInvisible();
  return; 
 }
	vColor = vec4( aColor, 1.0 );
#else // if defined( USE_COLOR )
#if IS_TRANSPARENT == 0
 if(gl_InstanceID < splitPos.x) {
   makeInvisible();
   return; 
 }
 if (gl_InstanceID < splitPos.y) {
  	vColor = diffuse; // color; 
  } else {
    vColor = aColor;
  }
#else  
 if(gl_InstanceID >= splitPos.x && gl_InstanceID < splitPos.y) {
   makeInvisible();
   return; 
 }
	vColor = aColor;
#endif 
#endif
  // Compute real vertex position
	vec3 transformed = (position.xyz * aSize.xxy) + aPos.xyz;
  vNormal = normalize( normalMatrix * normal );

  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
  gl_Position = projectionMatrix * mvPosition;
	vViewPosition = -mvPosition.xyz;
}
`,Gte=`
#define PHONG

uniform vec3 diffuse;
#if HAS_EMISSIVE
uniform vec3 emissive;
#endif
uniform vec3 specular;
uniform float shininess;
#if HAS_OPACITY	
uniform float opacity;
#endif

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#else
	varying vec3 vColor;	
#endif
#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

#include <bsdfs>
#include <lights_pars_begin>
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
varying vec3 vViewPosition;

struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)

// varying float vVisible;
// varying vec3 flatNormal;

void main() {
  /* if(vVisible < 1.0) {
    discard;
    return;
  } */
 //gl_FragColor = vec4( vColor.xyz, 1.0 );
 // return;
	// vec4 diffuseColor = vec4( diffuse, opacity );
#if HAS_OPACITY	
	vec4 diffuseColor = vec4( vColor.xyz, opacity );
#else
	vec4 diffuseColor = vec4( vColor.xyz, 1.0 );
#endif	
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

/*
#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif
*/
#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif
  float specularStrength = 1.0;
	// float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
	// bool frontFacing = dot(flatNormal, vViewPosition) > 0.0;
  /*if(!gl_FrontFacing) {
    discard;
    return;
  }*/

	// vec3 normal = normalize( flatNormal );
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
	  if(!gl_FrontFacing) {
		  normal = -normal;
		}
	#endif
#if 0
if (normal.z > 0.0) {
  // gl_FragColor = vec4( 0.0, vNormal.z, clamp(vViewPosition.z * 5.0 ,0.0, 1.0), 1.0 );
  gl_FragColor = vec4( 0.0, normal.z, 0.0, 1.0 );
} else {
  // gl_FragColor = vec4( vNormal.z, 0.0, clamp(vViewPosition.z * 5.0 ,0.0, 1.0), 1.0 );
  gl_FragColor = vec4( -normal.z, 0.0, 0.0, 1.0 );
}
return;
#endif
  // vec3 geometryNormal = normal; // unused variable  

	// accumulation
  BlinnPhongMaterial material;
  material.diffuseColor = diffuseColor.rgb;
  material.specularColor = specular;
  material.specularShininess = shininess;
  material.specularStrength = specularStrength;

  GeometricContext geometry;

  geometry.position = - vViewPosition;
  geometry.normal = normal;
  geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

  IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
  	
 	float dotNL;
  vec3 irradiance;
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		// getDirectionalLightInfo( directionalLight, geometry, directLight );
		// directLight.color = directionalLight.color;
		// directLight.direction = directionalLight.direction;
		// directLight.visible = true;
  	dotNL = saturate( dot( geometry.normal, directionalLight.direction ) );
	  irradiance = dotNL * directionalLight.color;
	  reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	  reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directionalLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
	}
	#pragma unroll_loop_end
#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif

#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif

#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif

	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular
#if HAS_EMISSIVE	 
	+ emissive
#endif	
	;
#ifdef OPAQUE
  diffuseColor.a = 1.0;
#endif

// https://github.com/mrdoob/three.js/pull/22425
#ifdef USE_TRANSMISSION
  diffuseColor.a *= transmissionAlpha + 0.1;
#endif
  gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	gl_FragColor = linearToOutputTexel( gl_FragColor );
#ifdef PREMULTIPLIED_ALPHA
	// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.
	gl_FragColor.rgb *= gl_FragColor.a;
#endif
#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif
}
`;function zte(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}var lc=class extends lr{constructor(e){let i=e.sphereMaterial===!0;i&&delete e.sphereMaterial,super(),this.type="PhongShaderMaterial",this.defines={},this.uniforms={},i?(this.vertexShader=Ute,this.fragmentShader=Gte):(this.vertexShader=Bte,this.fragmentShader=Nte),this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.color=new $e(16777215),this.specular=new $e(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xh,this.normalScale=new ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=va,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zte(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(let n in this.uniforms){let a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;let r={};for(let n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}};lc.prototype.isShaderMaterial=!0;var di=!0,Hte=.7071068,P_=3*.7071068,Wte={menuId:!1,quality:3,show:0,transparentTop:!1,transparentBottom:!0,showRapidMotion:!1,showRetractions:!1,showDeretractions:!1,showSeams:!1,hideSkirtOozeShield:!1,hideSupport:!1,hideInfill:!1,smoothNozzleMove:!1,live:!1},R_=di?[{value:0,name:"Низкий"},{value:1,name:"Нормальный"},{value:2,name:"Высокие"}]:[{value:0,name:"Самый низкий - Линии"},{value:1,name:"Низкий - Лица"},{value:2,name:"Средний - Прямоугольники"},{value:3,name:"Высокий - Эллипсис"},{value:4,name:"Высший - HQ эллипсис"}],Vs=[{value:0,name:"Экструдер"},{value:1,name:"Тип характеристики"},{value:2,name:"Скорость"},{value:3,name:"Ширина"},{value:4,name:"Верх"}],Sd=[{value:0,name:"Неизвестно",color:"#ff0000"},{value:1,name:"Периметр",color:"#ffd540"},{value:2,name:"Внешний периметр",color:"#ff801a"},{value:3,name:"Периметр нависания",color:"#0f49ff"},{value:4,name:"Внутреннее заполнение",color:"#c75923"},{value:5,name:"Верхнее твердое заполнение",color:"#bf00ff"},{value:6,name:"Верхнее твердое заполнение",color:"#d93030"},{value:7,name:"Bridge Infill",color:"#845ae8"},{value:8,name:"Заполнить разрыв",color:"#ffffff"},{value:9,name:"Юбка",color:"#a9fcb4"},{value:10,name:"Вспомогательный материал",color:"#5eee48"},{value:11,name:"Интерфейс вспомогательных материалов",color:"#6fa953"},{value:12,name:"Протрите башню",color:"#bceca2"},{value:13,name:"Пользовательский",color:"#469a42"},{value:14,name:"Рафт",color:"#46a5b7"},{value:15,name:"Brim",color:"#a9fcb4"},{value:16,name:"Липкий щит",color:"#5fb77e"},{value:17,name:"Bridge",color:"#5ba8e8"},{value:18,name:"Внутренняя одиночная экструзия",color:"#caef8e"},{value:19,name:"Выгладить",color:"#fa9361"},{value:20,name:"Смешанный",color:"#8000ff"},{value:21,name:"Установите следующий шанс",color:"#005B73"},{value:22,name:"Bottom ",color:"#794419"},{value:23,name:"Support Transition",color:"#3c4234"}],hc=class{constructor(e,i){xs(this,"_renderCallback",()=>{if(this.renderCallback&&this.renderCallback(),this.nozzleMoveList.length===0&&this.setNextLiveProgress(),this.nozzleMoveList.length){let e=performance.now(),i=.001*(e-this.lastMoveTime);for(;i>1e-4&&this.nozzleMoveList.length;){let r=this.nozzleMoveList[0],n=r.x-this.nozzle.position.x,o=r.y-this.nozzle.position.y,a=r.z-this.nozzle.position.z,h=Math.sqrt(n*n+o*o+a*a)/(r.f*(1+(this.nozzleMoveList.length+this.liveProgressBuffer.length-1)*.3));if(h<i){i-=h,this.nozzle.position.x=r.x,this.nozzle.position.y=r.y,this.nozzle.position.z=r.z,this.nozzleMoveList.shift(),this.nozzleMoveList.length===0&&this.setNextLiveProgress();continue}i=i/h,this.nozzle.position.x+=n*i,this.nozzle.position.y+=o*i,this.nozzle.position.z+=a*i,i=0}return this.lastMoveTime=e,!0}return this.forceRenderLoop});xs(this,"updateView",()=>{this.view.refresh()});this.reader=null,this.container=e,this.quality=2,this.options=Wt({},Wte),this.numSpheres=0,this.setOptions(i),this.view=new Gu(this.container,this.options.slug,this.options.rootScope,this.options.menuId,!1,this.model),this.view.renderer.shadowMap.enabled=!1,i.analyser.source==="project"?this.view.addProject(i.model):this.view.addPrinter(),this.view.addLights(),this.view.refresh(),this.excludeGroup=new Xr,this.gcodeGroup=new Xr,this.view.scene.add(this.gcodeGroup),this.view.sceneBed.add(this.excludeGroup),this.analysedLayerNumber=-1,this.filamentColors=["#d28614","#005B73","#59BDBE","#D0A766","#80ff00","#0000ff","#ff00ff","#0080ff","#0080ff","#005B73","#59BDBE","#D0A766","#d28614","#005B73","#59BDBE","#D0A766"],this.rainbowColors=["#ff0000","#ff8000","#0000ff","#80ff00","#00ff00","#00ff80","#00ffff","#0080ff","#0000ff","#8000ff","#ff00ff","#0080ff"],this.seamColor="#ffffff",this.retractColor="#ff00ff",this.deretractColor="#00ffff",this.excludeColors=[12267302,12279591,12231720,9878056,2865704,2669227,2645946,4663482,9185466,12200059],this.materials=[],this.excludeMaterials=[],this.nozzle=null,this.liveLayer=0,this.crossMesh=null,this.renderCallback=null,this.forceRenderLoop=!1,this.liveComplete=!1,this.livePos={x:-99999,y:-99999},this.liveOffset={x:0,y:0,z:0},this.liveProgressBuffer=[],this.includedOffset={x:0,y:0,z:0},$(window).resize(this.updateView),this.view.addAxis(),wi.initialized.then(()=>{let r=wi.getGeometryHelper(),n=wi.getAxisMaterials(),o=this.view.tracker.add(n.nozzle.clone()),a=this.view.tracker.add(r.nozzle.clone());this.nozzle=new St(a,o),this.nozzle.visible=!1,this.view.renderCallback=this._renderCallback,this.view.scene.add(this.nozzle),this.view.setChanged()}),this.featureHeadline="",this.features=[],this.roundFeatures=[],this.featureMap={},this.maxF=10,this.lastF=10,this.nozzleMoveList=[],this.lastMoveTime=performance.now()}$destroy(){$(window).off("resize",this.updateView),this.layerData=null,this.freeGCodeStorage(),this.deleteMaterials(),this.view.disconnect(),this.container.innerHTML="",this.container=null,delete this.layerIndices}updateExcludeRegions(){this.excludeGroup.clear();let e=this.options.rootScope.RSPrinter.excludeRegions,i=this.analyser.layerInfo?this.analyser.layerInfo.layers[this.analyser.layerInfo.layers.length-1].h+1:50;this.excludeMaterials.length===0&&this.createMaterials();for(let r=0;r<e.length;r++){let n=e[r],o=new En(n.xmax-n.xmin,n.ymax-n.ymin,i),a=new St(o,this.excludeMaterials[r%this.excludeMaterials.length]);a.position.x=n.xmin+.5*(n.xmax-n.xmin),a.position.y=n.ymin+.5*(n.ymax-n.ymin),a.position.z=.15+this.options.rootScope.activeConfig.movement.zMin+.5*i,this.excludeGroup.add(a)}this.view.setChanged()}pushNozzleMove(e){this.nozzleMoveList.length===0&&(this.lastMoveTime=performance.now()),this.nozzleMoveList.push(e),this.nozzle&&(this.nozzle.visible=!0),this.view.setChanged()}createCross(){if(this.crossMesh)return;let e=[-1e3,0,0,1e3,0,0,0,-1e3,0,0,1e3,0],i=[0,1,2,3];this.crossGeom=new _t,this.crossGeom.setIndex(i),this.crossGeom.setAttribute("position",new Bt(e,3)),this.crossMesh=new cn(this.crossGeom,this.materials[14]),this.crossMesh.renderOrder=2e3,this.view.scene2.add(this.crossMesh),this.view.tracker.add(this.crossMesh)}drawCross(e){this.createCross(),this.crossMesh.position.x=e.x,this.crossMesh.position.y=e.y,this.crossMesh.position.z=this.options.rootScope.activeConfig.movement.zMin,this.crossMesh.needsUpdate=!0,this.view.setChanged()}hideCross(){this.crossMesh&&(this.view.scene2.remove(this.crossMesh),this.crossGeom.dispose(),this.view.tracker.remove(this.crossMesh),this.crossMesh=null,this.crossGeom=null,this.view.setChanged())}drawSelectionBox(e,i){if(!this.selectionBox){let r=new En(1,1,1),n=new Wi({color:16711680});this.selectionBox=new St(r,n),this.view.scene.add(this.selectionBox),this.view.tracker.add(this.selectionBox),this.view.tracker.add(n),this.view.tracker.add(r)}this.selectionBox.visible=!0,this.selectionBox.position.x=.5*(e.x+i.x),this.selectionBox.position.y=.5*(e.y+i.y),this.selectionBox.position.z=.5*(e.z+i.z),this.selectionBox.scale.x=Math.abs(e.x-i.x),this.selectionBox.scale.y=Math.abs(e.y-i.y),this.selectionBox.scale.z=Math.abs(e.z-i.z),this.selectionBox.needsUpdate=!0}hideSelectionBox(){this.selectionBox&&(this.selectionBox.visible=!1,this.selectionBox.needsUpdate=!0)}setOptions(e){this.options=Wt(Wt({},this.options),e),this.analyser=this.options.analyser,this.quality=this.options.quality,this.model=this.options.model}addFeature(e,i){if(e===void 0||i===void 0){console.log("illegal feature id");return}i===0&&this.options.show>=3||(this.featureMap[e]?this.featureMap[e].count++:this.featureMap[e]={id:e,value:parseFloat(""+e),count:1,index:-1})}sortedFeatureMapByValue(){let e=Object.values(this.featureMap);return e.sort((i,r)=>i.value>r.value?1:r.value>i.value?-1:0),e}buildFeatureList(){let e=Object.values(this.featureMap).length,i=this.sortedFeatureMapByValue();switch(i.length===0&&i.push({id:"0",value:0,count:1,index:0}),this.roundFeatures=[],this.options.showSeams&&this.roundFeatures.push({color:this.seamColor,name:"Швы"}),this.options.showRetractions&&this.roundFeatures.push({color:this.retractColor,name:"Отступления"}),this.options.showDeretractions&&this.roundFeatures.push({color:this.deretractColor,name:"Втягивание"}),this.features=i,this.options.show){case 0:this.featureInterpolate=!1,i.forEach(r=>{r.color=this.filamentColors[r.value%this.filamentColors.length],r.name="Экструдер "+(r.value+1)});break;case 1:this.featureInterpolate=!1,i.forEach(r=>{r.color=Sd[r.value].color,r.name=Sd[r.value].name});break;case 2:if(e<=this.rainbowColors.length)this.featureInterpolate=!1,i.forEach((r,n)=>{r.color=this.rainbowColors[n],r.name=r.id+" mm/s"});else{let r=[],n=i[0].value,o=i[e-1].value,a=this.rainbowColors.length,l=(o-n)/(a-1);for(let h=0;h<a;h++){let u=n+h*l;r.push({name:u.toFixed(0)+" mm/s",value:u,color:this.rainbowColors[h]})}this.features=r,this.featureInterpolate=!0}console.log("speed list",this.features);break;case 3:case 4:if(e<=this.rainbowColors.length)this.featureInterpolate=!1,i.forEach((r,n)=>{r.color=this.rainbowColors[n],r.name=r.id+" \xB5m"});else{let r=[],n=i[0].value,o=i[e-1].value,a=this.rainbowColors.length,l=(o-n)/(a-1);for(let h=0;h<a;h++){let u=n+h*l;r.push({name:u.toFixed(0)+" \xB5m",value:u,color:this.rainbowColors[h]})}this.features=r,this.featureInterpolate=!0}break}}setColorForFeatureValue(e){if(this.featureInterpolate){this.activeColor=16711680;let i=this.features.length;if(i===0)return;let r=Math.floor((i-1)*(e-this.features[0].value)/(this.features[i-1].value-this.features[0].value));r===i-1?r=i-2:r<i-1&&this.features[r+1].value<e&&r++;let n=r+1;if(r<0){this.activeColor=parseInt(this.features[0].color.replace("#","0x"));return}let o=parseInt(this.features[r].color.replace("#","0x")),a=parseInt(this.features[n].color.replace("#","0x")),l=(e-this.features[r].value)/(this.features[n].value-this.features[r].value),h=1-l,u=Math.round(l*(o>>16&255)+h*(a>>16&255)),c=Math.round(l*(o>>8&255)+h*(a>>8&255)),f=Math.round(l*(o&255)+h*(a&255));this.activeColor=(u<<16)+(c<<8)+f}else{let i=1e20;this.features.forEach(r=>{let n=Math.abs(e-r.value);n<i&&(i=n,this.activeColor=parseInt(r.color.replace("#","0x")))})}}deleteMaterials(){this.materials.forEach(e=>{e&&e.dispose()}),this.materials=[],this.excludeMaterials.forEach(e=>{e&&e.dispose()}),this.excludeMaterials=[]}createSphereMaterial(e,i){let r=Fc.merge([jr.phong.uniforms,{splitPos:new Rl(new Int32Array(4))}]);return new lc({uniforms:r,lights:!0,name:"sphere-material",vertexColors:!1,side:i?qt:Ei,opacity:i?.02:1,transparent:i,depthWrite:!i,flatShading:!1,color:new $e(e?parseInt(e.replace("#","0x")):13619151),specular:new $e(2631720),emissive:0,shininess:70,defines:{IS_TRANSPARENT:i?1:0,HAS_EMISSIVE:0,HAS_OPACITY:i?1:0},sphereMaterial:!0})}createFilamentMaterial(e,i,r){if(di){let n=Fc.merge([jr.phong.uniforms,{splitPos:new Rl(new Int32Array(4))}]),o=new lc({uniforms:n,lights:!0,name:"filament-material",vertexColors:!1,side:i?qt:Ei,opacity:i?.02:1,transparent:i,depthWrite:!i,flatShading:!1,color:new $e(e?parseInt(e.replace("#","0x")):13619151),specular:new $e(2631720),emissive:0,shininess:70,defines:{IS_TRANSPARENT:i?1:0,HAS_EMISSIVE:0,HAS_OPACITY:i?1:0}});return r===!0?o.vertexShader=o.vertexShader.replaceAll("FIL_NO_ENDCAPS","1"):o.vertexShader=o.vertexShader.replaceAll("FIL_NO_ENDCAPS","0"),o}else return this.quality>0?new lr({color:e?parseInt(e.replace("#","0x")):13619151,emissive:2105376,specular:1118481,shininess:50,side:this.quality<2?qt:Ei,flatShading:this.quality<3,vertexColors:!0,opacity:i?.05:1,transparent:i}):new Oi({color:e?parseInt(e.replace("#","0x")):0,linewidth:1,vertexColors:!e})}createMaterials(){this.deleteMaterials(),this.materials.push(new Oi({color:16711935,linewidth:1})),this.materials.push(new Wi({color:16711680,side:qt})),this.materials.push(new Wi({color:255,side:qt})),this.quality>0?(this.materials.push(new lr({color:5592405,specular:1118481,shininess:50,side:qt,flatShading:!di&&this.quality<3})),this.materials.push(new lr({color:5592405,specular:1118481,shininess:50,opacity:.05,transparent:!0,side:qt,flatShading:this.quality<3})),this.materials.push(new lr({color:5592405,specular:1118481,shininess:50,opacity:.05,transparent:!0,side:qt,flatShading:this.quality<3,vertexColors:!0}))):(this.materials.push(new Oi({color:5592405,linewidth:2})),this.materials.push(new Oi({color:5592405,linewidth:2,opacity:.5,transparent:!0})),this.materials.push(new Oi({color:5592405,linewidth:2,opacity:.1,transparent:!0,vertexColors:!0}))),this.materials.push(this.createFilamentMaterial(!1,!1,!1)),this.materials.push(this.createFilamentMaterial(!1,!1,!0)),this.materials.push(this.createFilamentMaterial("#555555",!1,!1)),this.materials.push(this.createFilamentMaterial("#555555",!1,!0)),this.materials.push(this.createFilamentMaterial(!1,!0,!1)),this.materials.push(this.createFilamentMaterial(!1,!0,!0)),this.materials.push(this.createSphereMaterial("#555555",!1)),this.materials.push(this.createSphereMaterial("#555555",!0)),this.materials.push(new Oi({color:49152,depthTest:$s}));for(let e=0;e<this.excludeColors.length;e++)this.excludeMaterials.push(new lr({color:this.excludeColors[e],opacity:.6,transparent:!0,side:qt,depthWrite:!1,specular:1118481,shininess:50}))}includeXY(e,i){this.analysis.xMin=Math.min(this.analysis.xMin,e),this.analysis.xMax=Math.max(this.analysis.xMax,e),this.analysis.yMin=Math.min(this.analysis.yMin,i),this.analysis.yMax=Math.max(this.analysis.yMax,i)}computeMemoryForBlock(e){if(e.t===2){let i=e.m.length;return i<2?{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0}:{points:i,lines:0,triangles:0,lineTravel:i-1,filEnd:0,fil:0,spheres:0}}if(e.t===3&&!this.hideGCode){let i=e.m.length;if(i<2)return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0};if(di){let r=0;this.options.showSeams&&this.lastFeature===2&&(r=2);let n=e.m.length-2,o=0;for(let a=0;a<=n;a++){let l=Math.atan2(e.m[a+1].y-e.m[a].y,e.m[a+1].x-e.m[a].x);if(a){let h=this.angleFromTo(o,l);Math.abs(h)>=P_&&i++}o=l}return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:i>=3?2:1,fil:i>3?i-3:0,spheres:r}}else switch(this.quality){case 0:return{points:i,lines:i-1,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0};case 1:return{points:2*i,lines:0,triangles:(i-1)*2,lineTravel:0,filEnd:0,fil:0,spheres:0};case 2:return{points:4*i,lines:0,triangles:(i-1)*8+4,lineTravel:0,filEnd:0,fil:0,spheres:0};case 3:return{points:4*(2*i-2)+2,lines:0,triangles:(i-1)*8+8,lineTravel:0,filEnd:0,fil:0,spheres:0};case 4:return{points:8*(2*i-2)+2,lines:0,triangles:(i-1)*16+16,lineTravel:0,filEnd:0,fil:0,spheres:0}}}if(e.t===10)this.lastFeature=e.ft,this.hideGCode=this.options.hideSkirtOozeShield&&(e.ft===9||e.ft===16),this.hideGCode|=this.options.hideSupport&&(e.ft===10||e.ft===11),this.hideGCode|=this.options.hideInfill&&e.ft===4,this.options.show===1&&this.addFeature(""+e.ft,e.ft);else if(e.t===1)this.options.show===0&&this.addFeature(e.e,e.e),this.options.show===2&&this.addFeature((e.s/60).toFixed(1),e.s/60),this.options.show===3&&this.addFeature(""+(1e3*e.w).toFixed(0),parseFloat((e.w*1e3).toFixed(0)));else if(e.t===4){if(this.options.showRetractions)return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:1}}else if(e.t===5){if(this.options.showDeretractions)return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:1}}else e.t===6?(this.maxF=Math.max(this.maxF,e.s/60),this.options.show===2&&this.addFeature((e.s/60).toFixed(1),e.s/60)):e.t===8?this.options.show===3&&this.addFeature(""+(1e3*e.w).toFixed(0),parseFloat((e.w*1e3).toFixed(0))):e.t===11?(this.options.show===3&&this.addFeature(""+(1e3*e.w).toFixed(0),parseFloat((e.w*1e3).toFixed(0))),this.options.show===4&&this.addFeature(""+(1e3*e.h).toFixed(0),parseFloat((e.h*1e3).toFixed(0)))):e.t===7&&this.options.show===0&&this.addFeature(""+e.e,e.e);return{points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0}}appendDetailedMemoryForBlock(e,i){if(e.t===2){let r=e.m.length;if(r<2)return;i.push({x:e.m[1].x,y:e.m[1].y,f:this.lastF,points:3*2,lines:0,triangles:0,lineTravel:2,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});for(let n=2;n<r;n++)i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*2,lines:0,triangles:0,lineTravel:2,filEnd:0,fil:0,spheres:0,offset:this.includedOffset})}else if(e.t===3&&!this.hideGCode){let r=e.m.length;if(r<2)return;if(di){let n=this.options.showSeams&&this.lastFeature===2?1:0,o=e.m.length-2,a=0,l;for(let h=0;h<=o;h++){let u=Math.atan2(e.m[h+1].y-e.m[h].y,e.m[h+1].x-e.m[h].x),c=0;h&&(l=this.angleFromTo(a,u),Math.abs(l)>=P_&&(c=1));let f=h===0||h===o;i.push({x:e.m[h+1].x,y:e.m[h+1].y,f:this.lastF,points:0,lines:0,triangles:0,lineTravel:0,filEnd:f?1:0,fil:f?c:1+c,spheres:n*((h===0?1:0)+(h===o?1:0)),offset:this.includedOffset}),a=u}}else for(let n=1;n<r;n++){let o=n===1,a=n===r-1;switch(this.quality){case 0:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(1+(o?1:0)),lines:2,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break;case 1:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(2+(o?2:0)),lines:0,triangles:3*2,lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break;case 2:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(4+(o?4:0)),lines:0,triangles:3*(8+(o?2:0)+(a?2:0)),lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break;case 3:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(8+(o?1:0)+(a?1:0)),lines:0,triangles:3*(8+(o?4:0)+(a?4:0)),lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break;case 4:i.push({x:e.m[n].x,y:e.m[n].y,f:this.lastF,points:3*(16+(o?1:0)+(a?1:0)),lines:0,triangles:3*(16+(o?8:0)+(a?8:0)),lineTravel:0,filEnd:0,fil:0,spheres:0,offset:this.includedOffset});break}}}else if(e.t===10)this.lastFeature=e.ft,this.hideGCode=this.options.hideSkirtOozeShield&&(e.ft===9||e.ft===16),this.hideGCode|=this.options.hideSupport&&(e.ft===10||e.ft===11),this.hideGCode|=this.options.hideInfill&&e.ft===4;else if(e.t===4){if(this.options.showRetractions){let r=i.length>0?i[i.length-1]:void 0;i.push({x:r?r.x:0,y:r?r.y:0,f:this.lastF,points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:1,offset:this.includedOffset})}}else if(e.t===5){if(this.options.showDeretractions){let r=i.length>0?i[i.length-1]:void 0;i.push({x:r?r.x:0,y:r?r.y:0,f:this.lastF,points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:1,offset:this.includedOffset})}}else e.t===1?this.lastF=e.s/60:e.t===6?this.lastF=e.s/60:e.t===12&&(this.includedOffset=e)}pushLayerIndex(){this.layerIndices.push({points:this.pointArrayPos,triangles:this.geomTrianglePos,lines:this.geomLinePos,lineTravel:this.geomTravelPos,filEnd:di?this.aPosEnd:0,fil:di?this.aPos:0,spheres:this.numSpheres})}normalize(e){let i=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);i>0&&(e.x/=i,e.y/=i,e.z/=i)}prepareExtrusionConstants(){if(!di){switch(this.quality){case 0:this.numVerticesCircumsphere=1;break;case 1:this.numVerticesCircumsphere=2;break;case 2:case 3:this.numVerticesCircumsphere=4;break;case 4:this.numVerticesCircumsphere=8;break}if(this.dh=.5*this.height,this.dw=.5*this.width,this.angles=[],this.quality===1)this.angles.push(0),this.angles.push(Math.PI);else if(this.quality===2){let e=Math.atan(this.dh/this.dw);this.angles.push(e),this.angles.push(Math.PI-e),this.angles.push(Math.PI+e),this.angles.push(-e)}else{let e=Math.PI*2/this.numVerticesCircumsphere;for(let i=0;i<this.numVerticesCircumsphere;i++)this.angles.push(i*e)}this.rad=this.quality===1?this.dw:Math.sqrt(this.dh*this.dh+this.dw*this.dw)}}angleFromTo(e,i){let r=i-e;for(;r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;return r}drawExtrusion(e){if(!(e.m.length<2||this.hideGCode))if(di){let i=this.aPos*3,r=i,n=this.aPosEnd*3,o=n,a=null,l=null,h=null,u=null,c,f=0,d=e.m.length-2,m=this.options.showSeams&&this.lastFeature===2?1:0;for(let v=0;v<=d;v++){let g=v===0,p=v===d;a=h,h={x:e.m[v].x,y:e.m[v].y,z:this.z-.5*this.height},l={x:e.m[v+1].x,y:e.m[v+1].y,z:this.z-.5*this.height},c={x:l.x-h.x,y:l.y-h.y,z:l.z-h.z};let _=Math.atan2(c.y,c.x),x=0,b=0,y=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);if(this.normalize(c),!g){let w=this.angleFromTo(f,_);if(Math.abs(w)<P_)x=Math.tan(.5*w)*this.width/y;else{x=Math.tan(.25*w)*this.width/y;let S=f+.5*w;this.aPosArray[r]=h.x,this.aPosArray[r+1]=h.y,this.aPosArray[r+2]=h.z-.5*this.height,this.aSizeArray[r]=1*this.width,this.aSizeArray[r+1]=this.height,this.aSizeArray[r+2]=.01,this.aRot[r]=x*y/.01,this.aRot[r+1]=-x*y/.01,this.aRot[r+2]=S,r+=3,this.aPos++}}if(!p){let w=Math.atan2(e.m[v+2].y-l.y,e.m[v+2].x-l.x),S=this.angleFromTo(_,w);Math.abs(S)<P_?b=-Math.tan(.5*S)*this.width/y:b=-Math.tan(.25*S)*this.width/y}p||g?(p&&(this.lastPos=l),m&&(g&&this.addSphere(Ro(Wt({},h),{z:this.z-.5*this.height}),this.width*1.3,this.seamColor),p&&this.addSphere(this.lastPos,this.width*1.3,this.seamColor)),this.aPosArrayEnd[o]=h.x,this.aPosArrayEnd[o+1]=h.y,this.aPosArrayEnd[o+2]=h.z,this.aSizeArrayEnd[o]=1*(g?-this.width:this.width),this.aSizeArrayEnd[o+1]=p?-this.height:this.height,this.aSizeArrayEnd[o+2]=y,this.aRotEnd[o]=x,this.aRotEnd[o+1]=b,this.aRotEnd[o+2]=_,o+=3,this.aPosEnd++):(this.aPosArray[r]=h.x,this.aPosArray[r+1]=h.y,this.aPosArray[r+2]=h.z,this.aSizeArray[r]=1*(g?-this.width:this.width),this.aSizeArray[r+1]=p?-this.height:this.height,this.aSizeArray[r+2]=y,this.aRot[r]=x,this.aRot[r+1]=b,this.aRot[r+2]=_,r+=3,this.aPos++),u=c,f=_}for(;i<r;)this.aColor[i++]=this.activeColor>>16&255,this.aColor[i++]=this.activeColor>>8&255,this.aColor[i++]=this.activeColor&255;for(;n<o;)this.aColorEnd[n++]=this.activeColor>>16&255,this.aColorEnd[n++]=this.activeColor>>8&255,this.aColorEnd[n++]=this.activeColor&255}else{let i=this.numVerticesCircumsphere,r=this.pointArrayPos;if(this.quality>0){let o,a=this.quality>=3,l={x:0,y:0,z:1},h,u,c,f=3*i,d=this.pointArrayPos,m=this.pointArrayPos+(a?3:0)+f*(this.quality>=3?2*e.m.length-2:e.m.length);a&&(this.pointArrayPos+=3);let v=null,g=null,p=null,_=null,x=null,b;for(let y=0;y<e.m.length;y++){let w=y===0,S=y===e.m.length-1;if(v=p,p={x:e.m[y].x,y:e.m[y].y,z:this.z},y<e.m.length-1?g={x:e.m[y+1].x,y:e.m[y+1].y,z:this.z}:g=null,_=x,g&&(x={x:g.x-p.x,y:g.y-p.y,z:0},this.normalize(x)),w){if(a){this.pointArray[d]=p.x-x.x*this.dw,this.pointArray[d+1]=p.y-x.y*this.dw,this.pointArray[d+2]=p.z-this.dh,this.normalArray[d]=-x.x,this.normalArray[d+1]=-x.y,this.normalArray[d+2]=-x.z;let M=this.pointArrayPos/3;for(let D=0;D<i;D++)this.geomIndices[this.geomTrianglePos++]=d/3,this.geomIndices[this.geomTrianglePos++]=M+D,this.geomIndices[this.geomTrianglePos++]=M+(D+1)%i}else if(this.quality===2){let M=this.pointArrayPos/3;this.geomIndices[this.geomTrianglePos++]=M,this.geomIndices[this.geomTrianglePos++]=M+1,this.geomIndices[this.geomTrianglePos++]=M+2,this.geomIndices[this.geomTrianglePos++]=M,this.geomIndices[this.geomTrianglePos++]=M+2,this.geomIndices[this.geomTrianglePos++]=M+3}}if(S){if(a){this.pointArray[m]=p.x+_.x*this.width*.5,this.pointArray[m+1]=p.y+_.y*this.width*.5,this.pointArray[m+2]=p.z-this.height*.5,this.normalArray&&(this.normalArray[m]=_.x,this.normalArray[m+1]=_.y,this.normalArray[m+2]=_.z);let M=this.pointArrayPos/3;for(let D=0;D<i;D++)this.geomIndices[this.geomTrianglePos++]=M+D,this.geomIndices[this.geomTrianglePos++]=m/3,this.geomIndices[this.geomTrianglePos++]=M+(D+1)%i}else if(this.quality===2){let M=this.pointArrayPos/3;this.geomIndices[this.geomTrianglePos++]=M+1,this.geomIndices[this.geomTrianglePos++]=M,this.geomIndices[this.geomTrianglePos++]=M+2,this.geomIndices[this.geomTrianglePos++]=M+2,this.geomIndices[this.geomTrianglePos++]=M,this.geomIndices[this.geomTrianglePos++]=M+3}}_?(b={x:_.x+x.x,y:_.y+x.y,z:0},this.normalize(b)):b=Wt({},x);let R=b.x*x.x+b.y*x.y,E=R<Hte;R=1/(R>1?1:R<.3?.3:R);let T={x:-b.y,y:b.x,z:b.z},A={x:-x.y,y:x.x,z:x.z},C=this.pointArrayPos/3+(w?0:a?i:0);for(let M=0;M<i;M++){o=this.angles[M],a?(h=-Math.sin(o)*this.dh,c=Math.cos(o)*this.dw,u=c*R):(h=-Math.sin(o)*this.rad,c=Math.cos(o)*this.rad,u=c*R);let D={x:c*A.x+h*l.x,y:c*A.y+h*l.y,z:c*A.z+h*l.z};this.normalize(D),this.pointArray[this.pointArrayPos]=p.x+u*T.x+h*l.x,this.pointArray[this.pointArrayPos+1]=p.y+u*T.y+h*l.y,this.pointArray[this.pointArrayPos+2]=p.z-this.dh+u*T.z+h*l.z,!w&&!S&&a&&(this.pointArray[this.pointArrayPos+f]=this.pointArray[this.pointArrayPos],this.pointArray[this.pointArrayPos+f+1]=this.pointArray[this.pointArrayPos+1],this.pointArray[this.pointArrayPos+f+2]=this.pointArray[this.pointArrayPos+2]),this.normalArray&&(w?(this.normalArray[this.pointArrayPos]=D.x,this.normalArray[this.pointArrayPos+1]=D.y,this.normalArray[this.pointArrayPos+2]=D.z,this.normalArray[this.pointArrayPos+f]=this.normalArray[this.pointArrayPos],this.normalArray[this.pointArrayPos+f+1]=this.normalArray[this.pointArrayPos+1],this.normalArray[this.pointArrayPos+f+2]=this.normalArray[this.pointArrayPos+2]):S||(this.normalArray[this.pointArrayPos+f]=D.x,this.normalArray[this.pointArrayPos+f+1]=D.y,this.normalArray[this.pointArrayPos+f+2]=D.z,this.normalArray[this.pointArrayPos+f+f]=this.normalArray[this.pointArrayPos+f],this.normalArray[this.pointArrayPos+f+f+1]=this.normalArray[this.pointArrayPos+f+1],this.normalArray[this.pointArrayPos+f+f+2]=this.normalArray[this.pointArrayPos+f+2])),!S&&(this.quality!==1||M===0)&&(this.geomIndices[this.geomTrianglePos++]=C+(M+1)%i,this.geomIndices[this.geomTrianglePos++]=C+M,this.geomIndices[this.geomTrianglePos++]=C+M+i,this.geomIndices[this.geomTrianglePos++]=C+(M+1)%i+i,this.geomIndices[this.geomTrianglePos++]=C+(M+1)%i,this.geomIndices[this.geomTrianglePos++]=C+M+i),this.pointArrayPos+=3}!w&&!S&&a&&(this.pointArrayPos+=f)}a&&(this.pointArrayPos=m+3)}else for(let o=0;o<e.m.length;o++)this.pointArray[this.pointArrayPos]=e.m[o].x,this.pointArray[this.pointArrayPos+1]=e.m[o].y,this.pointArray[this.pointArrayPos+2]=this.z,o>0&&(this.geomIndices[this.geomLinePos]=this.pointArrayPos/3-1,this.geomIndices[this.geomLinePos+1]=this.pointArrayPos/3,this.geomLinePos+=2),this.pointArrayPos+=3;let n=this.pointArrayPos;for(;r<n;)this.geomColor[r++]=this.activeColor>>16&255,this.geomColor[r++]=this.activeColor>>8&255,this.geomColor[r++]=this.activeColor&255}}drawBlock(e){switch(e.t){case 1:e.w>0&&e.w!==this.width&&(this.width=e.w,this.prepareExtrusionConstants(),this.options.show===3&&this.setColorForFeatureValue(Math.round(e.w*1e3))),this.options.show===0&&this.setColorForFeatureValue(e.e);break;case 2:if(e.m.length>=2){let i=e.m.length-1;for(let r=0;r<=i;r++)this.pointArray[this.pointArrayPos]=e.m[r].x,this.pointArray[this.pointArrayPos+1]=e.m[r].y,this.pointArray[this.pointArrayPos+2]=this.z,this.normalArray&&(this.normalArray[this.pointArrayPos]=0,this.normalArray[this.pointArrayPos+1]=0,this.normalArray[this.pointArrayPos+2]=1),r>0&&(this.geomIndices[this.geomTravelPos]=this.pointArrayPos/3-1,this.geomIndices[this.geomTravelPos+1]=this.pointArrayPos/3,this.geomTravelPos+=2),this.pointArrayPos+=3;this.lastPos={x:e.m[i].x,y:e.m[i].y,z:this.z-.5*this.height}}break;case 3:this.drawExtrusion(e);break;case 4:this.options.showRetractions&&this.addSphere(this.lastPos,this.width*1.3,this.retractColor);break;case 5:this.options.showDeretractions&&this.addSphere(this.lastPos,this.width*1.3,this.deretractColor);break;case 6:this.options.show===2&&this.setColorForFeatureValue(e.s/60);break;case 7:this.options.show===0&&this.setColorForFeatureValue(e.e);break;case 8:e.w>0&&this.width!==e.w&&(this.width=e.w,this.prepareExtrusionConstants(),this.options.show===3&&this.setColorForFeatureValue(Math.round(e.w*1e3)));break;case 9:this.filamentColors[e.e%this.filamentColors.length]=e.color;break;case 10:this.lastFeature=e.ft,this.hideGCode=this.options.hideSkirtOozeShield&&(e.ft===9||e.ft===16),this.hideGCode|=this.options.hideSupport&&(e.ft===10||e.ft===11),this.hideGCode|=this.options.hideInfill&&e.ft===4,this.options.show===1&&this.setColorForFeatureValue(e.ft);break;case 11:e.w>0&&(this.width=e.w),this.lastPos.z+=.5*this.height-.5*e.h,this.height=e.h,this.options.show===3&&this.setColorForFeatureValue(Math.round(e.w*1e3)),this.options.show===4&&this.setColorForFeatureValue(Math.round(e.h*1e3)),this.prepareExtrusionConstants();break}}freeGCodeStorage(){this.crossMesh&&(this.view.scene2.remove(this.crossMesh),this.crossGeom.dispose(),this.view.tracker.remove(this.crossMesh),this.crossMesh=null),this.extrudeMesh&&(this.gcodeGroup.remove(this.extrudeMesh),this.extrudeMesh=null,this.gcodeGroup.remove(this.extrudeMeshEnd),this.extrudeMeshEnd=null,this.extrudeGeometry.dispose(),this.extrudeGeometry=null,this.extrudeGeometryEnd.dispose(),this.extrudeGeometryEnd=null,this.basicGeometry.dispose(),this.basicGeometry=null,this.basicNormals=null,this.basicTriangleNormals=null,this.basicPoints=null,this.basicPointBuffer=null,this.basicNormalBuffer=null,this.basicTriangleNormalsBuffer=null,this.aPosArray=null,this.aSizeArray=null,this.aColor=null,this.aRot=null,this.aPosArrayEnd=null,this.aSizeArrayEnd=null,this.aColorEnd=null,this.aRotEnd=null),this.sphereMesh&&(this.gcodeGroup.remove(this.sphereMesh),this.sphereMesh=null,this.sphereGeometry.dispose(),this.sphereGeometry=null,this.basicSphereGeometry.dispose(),this.basicSphereGeometry=null,this.basicSphereNormals=null,this.basicSphereTriangleNormals=null,this.basicSpherePoints=null,this.basicSpherePointBuffer=null,this.basicSphereNormalBuffer=null,this.basicSphereTriangleNormalsBuffer=null,this.aPosSphere=null,this.aSizeSphere=null,this.aColorSphere=null),this.gcodeMesh&&(this.gcodeGroup.remove(this.gcodeMesh),this.gcodeMesh=null),this.gcodeTravelAdded&&(this.gcodeGroup.remove(this.gcodeTravel),this.gcodeTravelAdded=!1),this.gcodeGeometry&&this.gcodeGeometry.dispose(),this.pointBuffer&&(this.pointBuffer=null),this.normalBuffer&&(this.normalBuffer=null),this.geomBuffer&&(this.geomBuffer=null),this.colorBuffer&&(this.colorBuffer=null),this.pointArray=null,this.geomColor=null,this.geomIndices=null,this.normalArray=null}createBasicGeometry(){let e=this.quality,i=e>1?8:4,r=3*(e===0?12:4*i),n=r*3,o=this.basicPoints=new Float32Array(n),a=this.basicNormals=new Float32Array(n),l=this.basicTriangles=new Uint32Array(r),h=this.basicTriangleNormals=new Float32Array(n),u=0,c=new q,f=new q,d=new q,m=new q,v=new q,g=new q,p=new q,_=new q;function x(A,C,M){l[b++]=u/3,o[u]=A.x,a[u]=C.x,h[u++]=M.x,o[u]=A.y,a[u]=C.y,h[u++]=M.y,o[u]=A.z,a[u]=C.z,h[u++]=M.z}let b=0,y=e===0?Math.PI*.25:0,w=Math.PI*2/i,S=e===0?.5*Math.sqrt(2):.5,R=[new q(0,0,1),new q(0,-1,0),new q(0,0,-1),new q(0,-1,0)];function E(A,C,M,D,O){let P=Math.cos(A),L=Math.sin(A);M.x=C,M.y=S*P,M.z=S*L,e===0?(D.copy(R[O]),D.addScaledVector(new q(0,P,L),.2),D.normalize()):(D.x=0,D.y=P,D.z=L)}function T(){m.subVectors(d,f),_.subVectors(c,f),m.cross(_);let A=m.lengthSq();m.multiplyScalar(-1/Math.sqrt(A)),x(f,g,m),x(c,v,m),x(d,p,m)}if(e===0)c.set(-1,-.5,.5),f.set(-1,.5,.5),d.set(-1,-.5,-.5),v.set(-1,0,0),g.set(-1,0,0),p.set(-1,0,0),T(),c.set(-1,-.5,-.5),f.set(-1,.5,.5),d.set(-1,.5,-.5),v.set(-1,0,0),g.set(-1,0,0),p.set(-1,0,0),T();else for(let A=0;A<i;A++)c.set(-1.5,0,0),v.set(-1,0,0),E(y+(A+1)*w,-1,d,p),E(y+A*w,-1,f,g),T();if(e===0)c.set(-1,.5,.5),f.set(-1,-.5,.5),d.set(-1,-.5,-.5),v.set(1,0,0),g.set(1,0,0),p.set(1,0,0),T(),c.set(-1,.5,.5),f.set(-1,-.5,-.5),d.set(-1,.5,-.5),v.set(1,0,0),g.set(1,0,0),p.set(1,0,0),T();else for(let A=0;A<i;A++)E(y+(A+1)*w,2,d,p),E(y+A*w,2,c,v),f.set(2.5,0,0),g.set(1,0,0),T();this.basicCircStart=b;for(let A=0;A<i;A++)E(y+A*w,0,f,g,A),E(y+(A+1)*w,0,c,v,A),E(y+A*w,1,d,p,A),T(),E(y+(A+1)*w,0,f,g,A),E(y+(A+1)*w,1,c,v,A),E(y+A*w,1,d,p,A),T();this.basicCircEnd=b,this.basicGeometry=new _t,this.basicPointBuffer=new wt(this.basicPoints,3,!1),this.basicPointBuffer.name="Basic Points",this.basicNormalBuffer=new wt(this.basicNormals,3,!1),this.basicNormalBuffer.name="Basic normals",this.basicTriangleBuffer=new wt(this.basicTriangles,1,!1),this.basicTriangleBuffer.name="Basic triangles",this.basicTriangleNormalsBuffer=new wt(this.basicTriangleNormals,3,!1),this.basicTriangleNormalsBuffer.name="Basic triangles flat normals",this.basicGeometry.setAttribute("position",this.basicPointBuffer),this.basicGeometry.setAttribute("normal",this.basicNormalBuffer),this.basicGeometry.setAttribute("face_normal",this.basicTriangleNormalsBuffer),this.basicGeometry.setIndex(this.basicTriangleBuffer),this.basicGeometry.setDrawRange(0,r)}createBasicSphereGeometry(){let n=this.basicSpherePoints=new Float32Array(144),o=this.basicSphereNormals=new Float32Array(144),a=this.basicSphereTriangles=new Uint32Array(48),l=this.basicSphereTriangleNormals=new Float32Array(144),h=0,u=new q,c=new q,f=new q,d=new q,m=new q,v=new q,g=0,p=0,_=Math.PI*2/8;function x(w,S){a[g++]=h/3,n[h]=w.x,o[h]=S.x,l[h++]=S.x,n[h]=w.y,o[h]=S.y,l[h++]=S.y,n[h]=w.z,o[h]=S.z,l[h++]=S.z}function b(w,S,R){let E=Math.cos(w),T=Math.sin(w);S.x=E*.5,S.y=T*.5,S.z=0,R.x=E,R.y=T,R.z=0}function y(){x(u,d),x(c,m),x(f,v)}for(let w=0;w<8;w++)u.set(0,0,.5),d.set(0,0,1),b(p+(w+1)*_,f,v),b(p+w*_,c,m),y();for(let w=0;w<8;w++)b(p+(w+1)*_,f,v),b(p+w*_,u,d),c.set(0,0,-.5),m.set(0,0,-1),y();this.basicSphereGeometry=new _t,this.basicSpherePointBuffer=new wt(this.basicSpherePoints,3,!1),this.basicSpherePointBuffer.name="Basic Points",this.basicSphereNormalBuffer=new wt(this.basicSphereNormals,3,!1),this.basicSphereNormalBuffer.name="Basic normals",this.basicSphereTriangleBuffer=new wt(this.basicSphereTriangles,1,!1),this.basicSphereTriangleBuffer.name="Basic triangles",this.basicSphereTriangleNormalsBuffer=new wt(this.basicSphereTriangleNormals,3,!1),this.basicSphereTriangleNormalsBuffer.name="Basic triangles flat normals",this.basicSphereGeometry.setAttribute("position",this.basicSpherePointBuffer),this.basicSphereGeometry.setAttribute("normal",this.basicSphereNormalBuffer),this.basicSphereGeometry.setAttribute("face_normal",this.basicSphereTriangleNormalsBuffer),this.basicSphereGeometry.setIndex(this.basicSphereTriangleBuffer),this.basicSphereGeometry.setDrawRange(0,48)}addSphere(e,i,r){let n=this.numSpheres*3;this.aPosSphere[n++]=e.x,this.aPosSphere[n++]=e.y,this.aPosSphere[n++]=e.z,n=this.numSpheres*2,r===this.seamColor?(this.aSizeSphere[n++]=i*1.15,this.aSizeSphere[n]=this.height*1.1):(this.aSizeSphere[n++]=i,this.aSizeSphere[n]=this.height*1.3),n=this.numSpheres*3,r=parseInt(r.replace("#","0x")),this.aColorSphere[n++]=r>>16&255,this.aColorSphere[n++]=r>>8&255,this.aColorSphere[n]=r&255,this.numSpheres++}updateGCodeGeometry(){let e=performance.now();if(this.lastFeature=0,this.hideGCode=!1,this.featureHeadline=Vs[this.options.show].name,this.features=[],this.maxF=0,this.featureMap={},this.activeColor=parseInt(this.filamentColors[0].replace("#","0x")),this.freeGCodeStorage(),!this.analyser.id)return;di?this.createBasicGeometry():this.prepareExtrusionConstants(),this.createBasicSphereGeometry(),this.numSpheres=0,this.lastPos={x:0,y:0,z:0};let i={points:0,lines:0,triangles:0,lineTravel:0,filEnd:0,fil:0,spheres:0},r=this.analyser;r.readerPos=0,this.width=.5,this.height=.2;let n=Math.min(r.layerInfo.layers[r.totalLayer].p,r.reader.byteLength);for(;r.readerPos<n;){let p=r.readBlockObj(),_=this.computeMemoryForBlock(p);i.points+=_.points,i.lines+=_.lines,i.triangles+=_.triangles,i.lineTravel+=_.lineTravel,i.filEnd+=_.filEnd,i.fil+=_.fil,i.spheres+=_.spheres}this.options.show===3&&this.addFeature(""+(1e3*this.width).toFixed(0),parseFloat((this.width*1e3).toFixed(0))),this.options.show===4&&this.addFeature(""+(1e3*this.height).toFixed(0),parseFloat((this.height*1e3).toFixed(0))),this.buildFeatureList();let o=performance.now(),a=o-e,l=i.points*12*(this.quality>=3?di?1:2:1)+i.triangles*12+i.lineTravel*8+i.lines*8+(i.fil+i.filEnd)*39+i.spheres*23,h=i.points*3,u=i.triangles*3+i.lineTravel*2+i.lines*(di?0:2);this.pointArray=new Float32Array(h),this.aPosSphere=new Float32Array(i.spheres*3),this.aSizeSphere=new Float32Array(i.spheres*2),this.aColorSphere=new Uint8Array(i.fil*3),di&&(this.aPosArray=new Float32Array(i.fil*3),this.aSizeArray=new Float32Array(i.fil*3),this.aColor=new Uint8Array(i.fil*3),this.aRot=new Float32Array(i.fil*3),this.aPos=0,this.aPosArrayEnd=new Float32Array(i.filEnd*3),this.aSizeArrayEnd=new Float32Array(i.filEnd*3),this.aColorEnd=new Uint8Array(i.filEnd*3),this.aRotEnd=new Float32Array(i.filEnd*3),this.aPosEnd=0),this.normalArray=this.quality>=3&&!di?new Float32Array(h):null,this.geomColor=new Uint8Array(h),this.geomIndices=new Uint32Array(u),this.layerIndices=[],this.pointArrayPos=0,this.geomTrianglePos=0,this.geomLinePos=3*i.triangles,this.geomLineStart=this.geomLinePos,this.geomTravelStart=this.geomTravelPos=this.geomLinePos+(di?0:2*i.lines),this.width=.5,this.height=.2,this.z=0,this.activeColor=16711680,this.options.show===3&&this.setColorForFeatureValue(parseFloat((this.width*1e3).toFixed(0))),this.options.show===4&&this.setColorForFeatureValue(parseFloat((this.height*1e3).toFixed(0))),this.createMaterials(),this.pushLayerIndex(),this.prepareExtrusionConstants(),this.lastFeature=0,this.hideGCode=!1;for(let p=1;p<=r.totalLayer;p++){let _=r.fetchLayer(p);this.z=r.layerInfo.layers[p].h,this.lastPos.z=this.z-.5*this.height,_.forEach(x=>{this.drawBlock(x)}),this.pushLayerIndex()}let c=this.pointArrayPos;for(;c<this.pointArray.length;)this.pointArray[c++]=this.pointArray[0],this.pointArray[c++]=this.pointArray[1],this.pointArray[c++]=this.pointArray[2];let d=performance.now()-o,m=new Li,v=this.options.model;v?(m.expandByPoint(new q(v.xMinView,v.yMinView,v.zMin)),m.expandByPoint(new q(v.xMaxView,v.yMaxView,v.zMax))):m.copy(this.view.getPrinterBox()),di&&(this.extrudeGeometry=new Pl,this.extrudeGeometry.copy(this.basicGeometry),this.extrudeGeometry.setDrawRange(this.basicCircStart,this.basicCircEnd-this.basicCircStart),this.extrudeGeometry.computeBoundingBox=()=>{},this.extrudeGeometry.computeBoundingSphere=()=>{},this.extrudeGeometry.isFilament=!0,this.extrudeGeometry.name="Filament",this.extrudeGeometry.instanceCount=i.fil,this.extrudeGeometry.setAttribute("aPos",new Yr(this.aPosArray,3,!1)),this.extrudeGeometry.setAttribute("aSize",new Yr(this.aSizeArray,3,!1)),this.extrudeGeometry.setAttribute("aColor",new Yr(this.aColor,3,!0)),this.extrudeGeometry.setAttribute("aRot",new Yr(this.aRot,3,!1)),this.extrudeGeometry.boundingBox=m,this.extrudeGeometry.boundingSphere=new hn,m.getBoundingSphere(this.extrudeGeometry.boundingSphere),this.extrudeGeometry.addGroup(0,this.aPos,9),this.extrudeGeometry.addGroup(0,0,11),this.extrudeGeometry.groups[0].sx=0,this.extrudeGeometry.groups[0].sy=0,this.extrudeMesh=new St(this.extrudeGeometry,this.materials),this.extrudeMesh.renderOrder=1e3,this.gcodeGroup.add(this.extrudeMesh),this.extrudeGeometryEnd=new Pl,this.extrudeGeometryEnd.copy(this.basicGeometry),this.extrudeGeometryEnd.computeBoundingBox=()=>{},this.extrudeGeometryEnd.computeBoundingSphere=()=>{},this.extrudeGeometryEnd.isFilament=!0,this.extrudeGeometryEnd.name="FilamentEnd",this.extrudeGeometryEnd.instanceCount=i.filEnd,this.extrudeGeometryEnd.setAttribute("aPos",new Yr(this.aPosArrayEnd,3,!1)),this.extrudeGeometryEnd.setAttribute("aSize",new Yr(this.aSizeArrayEnd,3,!1)),this.extrudeGeometryEnd.setAttribute("aColor",new Yr(this.aColorEnd,3,!0)),this.extrudeGeometryEnd.setAttribute("aRot",new Yr(this.aRotEnd,3,!1)),this.extrudeGeometryEnd.boundingBox=m,this.extrudeGeometryEnd.boundingSphere=new hn,m.getBoundingSphere(this.extrudeGeometryEnd.boundingSphere),this.extrudeGeometryEnd.addGroup(0,this.aPosEnd,8),this.extrudeGeometryEnd.addGroup(0,0,10),this.extrudeGeometryEnd.groups[0].startBottom=0,this.extrudeMeshEnd=new St(this.extrudeGeometryEnd,this.materials),this.extrudeMeshEnd.renderOrder=1e3,this.gcodeGroup.add(this.extrudeMeshEnd)),this.sphereGeometry=new Pl,this.sphereGeometry.copy(this.basicSphereGeometry),this.sphereGeometry.computeBoundingBox=()=>{},this.sphereGeometry.computeBoundingSphere=()=>{},this.sphereGeometry.isFilament=!0,this.sphereGeometry.name="Spheres",this.sphereGeometry.instanceCount=i.spheres,this.sphereGeometry.setAttribute("aPos",new Yr(this.aPosSphere,3,!1)),this.sphereGeometry.setAttribute("aSize",new Yr(this.aSizeSphere,2,!1)),this.sphereGeometry.setAttribute("aColor",new Yr(this.aColorSphere,3,!0)),this.sphereGeometry.boundingBox=m,this.sphereGeometry.boundingSphere=new hn,m.getBoundingSphere(this.sphereGeometry.boundingSphere),this.sphereGeometry.addGroup(0,this.numSpheres,12),this.sphereMesh=new St(this.sphereGeometry,this.materials),this.sphereMesh.renderOrder=1002,this.gcodeGroup.add(this.sphereMesh),this.gcodeGeometry=new _t,this.pointBuffer=new wt(this.pointArray,3,!1),this.pointBuffer.name="GCode Points",this.normalArray&&(this.normalBuffer=new wt(this.normalArray,3,!1),this.normalBuffer.name="GCode normals"),this.geomBuffer=new wt(this.geomIndices,1,!1),this.geomBuffer.name="GCode triangles",this.colorBuffer=new wt(this.geomColor,3,!0),this.colorBuffer.name="GCode Colors",this.gcodeGeometry.setAttribute("position",this.pointBuffer),this.normalArray&&this.gcodeGeometry.setAttribute("normal",this.normalBuffer),this.gcodeGeometry.setAttribute("color",this.colorBuffer),this.gcodeGeometry.setIndex(this.geomBuffer),this.gcodeGeometry.addGroup(this.quality===0?this.geomLineStart:0,0,5),this.gcodeGeometry.addGroup(0,0,3),this.gcodeGeometry.addGroup(0,this.geomTrianglePos,6),this.gcodeGeometry.addGroup(this.geomTrianglePos,0,5),this.gcodeGeometry.addGroup(this.geomTravelStart,this.geomTravelPos-this.geomTravelStart,0),di||(this.quality===0?(this.gcodeMesh=new cn(this.gcodeGeometry,this.materials),this.gcodeGeometry.setDrawRange(this.geomLineStart,this.geomLinePos-this.geomLineStart)):(this.gcodeMesh=new St(this.gcodeGeometry,this.materials),this.gcodeGeometry.setDrawRange(0,this.geomTrianglePos)),this.gcodeGroup.add(this.gcodeMesh)),this.gcodeGeometryTravel=new _t,this.gcodeGeometryTravel.setAttribute("position",this.pointBuffer),this.gcodeGeometryTravel.setIndex(this.geomBuffer),this.gcodeGeometryTravel.setDrawRange(this.geomTravelStart,this.geomTravelPos-this.geomTravelStart),this.gcodeTravel=new cn(this.gcodeGeometryTravel,this.materials[0]),this.gcodeTravelAdded=!1;let g=performance.now();this.options.live&&this.setLiveProgress(this.liveLayer,this.livePos,this.liveOffset),this.view.refresh(),this.view.setChanged()}fitObject(){let e=new Li,i=this.options.model;i&&(e.expandByPoint(new q(i.xMinView,i.yMinView,i.zMin-(this.view.isZBelt?15:0))),e.expandByPoint(new q(i.xMaxView,i.yMaxView,i.zMax)),this.view.setObjectsBBox(e),this.view.fitBoundingBox(e))}analyseLayerPositions(e){if(this.analysedLayerNumber===e)return;this.analysedLayer=[],this.analyser.fetchLayer(e).forEach(r=>{this.appendDetailedMemoryForBlock(r,this.analysedLayer)});let i=this.layerIndices[e-1];this.analysedLayer.forEach(r=>{r.triangles+=i.triangles,r.lines+=i.lines,r.lineTravel+=i.lineTravel,r.points+=i.points,r.filEnd+=i.filEnd,r.fil+=i.fil,r.spheres+=i.spheres,i=r}),this.analysedLayerNumber=e,this.lastLivePos=0}setNozzlePosition(e){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))return!1;if(this.nozzle){if(this.view.isZBelt){let i=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180;this.nozzle.setRotationFromAxisAngle(new q(1,0,0),i+Math.PI),this.nozzle.position.x=e.x,this.nozzle.position.y=e.y*Math.sin(i),this.nozzle.position.z=Math.cos(i)*e.y}else this.nozzle.position.x=e.x,this.nozzle.position.y=e.y,this.nozzle.position.z=e.z;this.nozzle.visible=!0,this.nozzle.needsUpdate=!0,this.nozzle.updateMatrix(),this.view.setChanged()}return!0}setLiveProgress(e,i,r){isNaN(i.x)||isNaN(i.y)||isNaN(i.z)||(this.liveProgressBuffer.push({layer:e,pos:{x:i.x,y:i.y,z:i.z},offset:r}),this.liveProgressBuffer.length>32&&this.liveProgressBuffer.shift(),this.nozzleMoveList.length===0&&this.setNextLiveProgress(!1))}setNextLiveProgress(e){if(this.liveProgressBuffer.length===0&&!e)return;let i=0,{layer:r,pos:n,offset:o}=e?{layer:this.liveLayer,pos:this.livePos,offset:this.liveOffset}:this.liveProgressBuffer.shift();if(this.liveLayer=r,this.livePos=n,!this.gcodeMesh&&!this.extrudeMesh||r<0||r>=this.layerIndices.length)return;this.view.isZBelt&&(i=this.analyser.layerInfo.layers[r].h);let a=this.layerIndices[0],l=this.layerIndices[r-1],h=this.layerIndices[this.layerIndices.length-1];this.analyseLayerPositions(r);let u=this.analysedLayer.length,c=this.analysedLayer[this.lastLivePos],f;if(this.liveComplete)l={fil:this.aPos,filEnd:this.aPosEnd},f={fil:this.aPos,filEnd:this.aPosEnd};else if(c===void 0)l={fil:this.aPos,filEnd:this.aPosEnd},f={fil:this.aPos,filEnd:this.aPosEnd};else{let d=n.x-o.x-(c.x-c.offset.x),m=n.y-o.y-(c.y-c.offset.y),v=d*d+m*m,g=-1,p={x:0,y:0},_=0;for(let x=this.lastLivePos+1;x<u;x++){c=this.analysedLayer[x];let b=n.x-o.x-(c.x-c.offset.x),y=n.y-o.y-(c.y-c.offset.y),w=b*b+y*y;w<.0025&&(_++,w<v&&(g=x,v=w))}if(g!==-1&&(this.lastLivePos=g,c=this.analysedLayer[g],n.x+=c.offset.x-o.x,n.y+=c.offset.y-o.y,n.z+=c.offset.z-o.z),g===-1&&(g=this.lastLivePos),f=this.analysedLayer[g],f===void 0){console.log("No layer end found");return}}if(this.nozzle&&!this.liveComplete){if(this.nozzle.visible=!0,this.nozzle.matrix=new gt,this.options.smoothNozzleMove)if(this.view.isZBelt){let d=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180;this.nozzle.setRotationFromAxisAngle(new q(1,0,0),d+Math.PI),this.pushNozzleMove({x:n.x,y:n.y*Math.sin(d),z:Math.cos(d)*n.y,f:this.lastF*this.options.rootScope.active.state.speedMultiply*.01})}else this.pushNozzleMove({x:n.x,y:n.y,z:n.z,f:this.lastF*this.options.rootScope.active.state.speedMultiply*.01});else if(this.view.isZBelt){let d=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180;this.nozzle.setRotationFromAxisAngle(new q(1,0,0),d+Math.PI),this.nozzle.position.x=n.x,this.nozzle.position.y=n.y*Math.sin(d),this.nozzle.position.z=Math.cos(d)*n.y}else this.nozzle.position.x=n.x,this.nozzle.position.y=n.y,this.nozzle.position.z=n.z;this.nozzle.updateMatrix(),this.nozzle.needsUpdate=!0}else this.nozzle&&(this.nozzle.visible=!1);if(di&&(this.extrudeGeometry.groups[0].sy=l.fil,this.extrudeGeometry.groups[0].count=f.fil,this.extrudeGeometry.groups[0].sx=a.fil,this.extrudeGeometryEnd.groups[0].sy=l.filEnd,this.extrudeGeometryEnd.groups[0].count=f.filEnd,this.extrudeGeometryEnd.groups[0].sx=a.filEnd,this.extrudeGeometry.groups[1].count=0,this.extrudeGeometryEnd.groups[1].count=0,this.options.transparentTop?(this.extrudeGeometry.groups[1].sy=f.fil,this.extrudeGeometry.groups[1].count=h.fil,this.extrudeGeometryEnd.groups[1].sy=f.filEnd,this.extrudeGeometryEnd.groups[1].count=h.filEnd):(this.extrudeGeometry.groups[1].sy=h.fil,this.extrudeGeometryEnd.groups[1].sy=h.filEnd)),this.sphereGeometry.groups[0].sy=l.spheres,this.sphereGeometry.groups[0].count=f.spheres,this.sphereGeometry.groups[0].sx=a.spheres,this.options.showRapidMotion?(this.gcodeTravelAdded||(this.gcodeGroup.add(this.gcodeTravel),this.gcodeTravelAdded=!0),this.gcodeGeometryTravel.setDrawRange(a.lineTravel,f.lineTravel-a.lineTravel)):this.gcodeTravelAdded&&(this.gcodeGroup.remove(this.gcodeTravel),this.gcodeTravelAdded=!1),this.gcodeGroup.matrix=new gt,this.view.isZBelt){let d=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180;this.gcodeGroup.matrixAutoUpdate=!1;let m=new gt,v=new gt,g=new gt,p=new gt,_=new gt;g.makeRotationX(Math.PI*.25),v.makeScale(1,Math.sin(d),-1),p.makeShear(0,0,0,-Math.cos(d),0,0),_.makeTranslation(0,0,i),m.premultiply(p),m.premultiply(v),m.premultiply(_),this.gcodeGroup.applyMatrix4(m)}this.view.setChanged()}setViewRange(e,i,r){if(!this.gcodeMesh&&!this.extrudeMesh)return;let n=0,o=performance.now(),a=this.layerIndices[e-1],l=this.layerIndices[i-1],h=this.layerIndices[this.layerIndices.length-1];this.view.isZBelt&&(n=this.analyser.layerInfo.layers[i].h);let u=this.layerIndices[i];if(r!==100){if(this.analyseLayerPositions(i),u=this.analysedLayer[Math.floor(this.analysedLayer.length*r/100)],this.nozzle){if(this.nozzle.matrix=new gt,this.nozzle.visible=!0,this.view.isZBelt){let c=45*Math.PI/180;this.model?c=this.model.printerParam1*Math.PI/180:c=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180,this.nozzle.setRotationFromAxisAngle(new q(1,0,0),c+Math.PI),this.nozzle.position.x=u.x,this.nozzle.position.y=u.y*Math.sin(c),this.nozzle.position.z=n-(this.analyser.layerInfo.layers[i].h-Math.cos(c)*u.y)}else this.nozzle.position.x=u.x,this.nozzle.position.y=u.y,this.nozzle.position.z=this.analyser.layerInfo.layers[i].h;this.nozzle.updateMatrix(),this.nozzle.needsUpdate=!0}}else this.nozzle&&this.nozzle.visible&&(this.nozzle.visible=!1,this.nozzle.needsUpdate=!0);if(di||(r!==100?this.quality===0?(this.gcodeGeometry.groups[2].start=l.lines,this.gcodeGeometry.groups[2].count=u.lines-l.lines,this.gcodeGeometry.groups[1].start=a.lines,this.gcodeGeometry.groups[1].count=l.lines-a.lines):(this.gcodeGeometry.groups[2].start=l.triangles,this.gcodeGeometry.groups[2].count=u.triangles-l.triangles,this.gcodeGeometry.groups[1].start=a.triangles,this.gcodeGeometry.groups[1].count=l.triangles-a.triangles):(this.gcodeGeometry.groups[1].count=0,this.quality===0?(this.gcodeGeometry.groups[2].start=a.lines,this.gcodeGeometry.groups[2].count=u.lines-l.lines):(this.gcodeGeometry.groups[2].start=a.triangles,this.gcodeGeometry.groups[2].count=u.triangles-a.triangles)),this.options.transparentBottom?this.quality===0?this.gcodeGeometry.groups[0].count=a.lines-this.geomLineStart:this.gcodeGeometry.groups[0].count=a.triangles:this.gcodeGeometry.groups[0].count=0,this.options.transparentTop?this.quality===0?(this.gcodeGeometry.groups[3].start=u.lines,this.gcodeGeometry.groups[3].count=h.lines-u.lines):(this.gcodeGeometry.groups[3].start=u.triangles,this.gcodeGeometry.groups[3].count=h.triangles-u.triangles):this.gcodeGeometry.groups[3].count=0),di&&(r!==100?(this.extrudeGeometry.groups[0].sy=l.fil,this.extrudeGeometry.groups[0].count=u.fil,this.extrudeGeometry.groups[0].sx=a.fil,this.extrudeGeometryEnd.groups[0].sy=l.filEnd,this.extrudeGeometryEnd.groups[0].count=u.filEnd,this.extrudeGeometryEnd.groups[0].sx=a.filEnd):(this.extrudeGeometry.groups[0].sy=0,this.extrudeGeometry.groups[0].sx=a.fil,this.extrudeGeometry.groups[0].count=u.fil,this.extrudeGeometryEnd.groups[0].sy=0,this.extrudeGeometryEnd.groups[0].sx=a.filEnd,this.extrudeGeometryEnd.groups[0].count=u.filEnd),this.options.transparentBottom?(this.extrudeGeometry.groups[1].sx=a.fil,this.extrudeGeometryEnd.groups[1].sx=a.filEnd,this.extrudeGeometry.groups[1].count=a.fil,this.extrudeGeometryEnd.groups[1].count=a.filEnd,this.extrudeGeometry.groups[1].sy=h.fil,this.extrudeGeometryEnd.groups[1].sy=h.filEnd):(this.extrudeGeometry.groups[1].count=0,this.extrudeGeometryEnd.groups[1].count=0),this.options.transparentTop?(this.extrudeGeometry.groups[1].sy=u.fil,this.extrudeGeometry.groups[1].count=h.fil,this.extrudeGeometryEnd.groups[1].sy=u.filEnd,this.extrudeGeometryEnd.groups[1].count=h.filEnd):(this.extrudeGeometry.groups[1].sy=h.fil,this.extrudeGeometryEnd.groups[1].sy=h.filEnd)),r!==100?(this.sphereGeometry.groups[0].sy=l.spheres,this.sphereGeometry.groups[0].count=u.spheres,this.sphereGeometry.groups[0].sx=a.spheres):(this.sphereGeometry.groups[0].sy=0,this.sphereGeometry.groups[0].sx=a.spheres,this.sphereGeometry.groups[0].count=u.spheres),this.options.showRapidMotion?(this.gcodeTravelAdded||(this.gcodeGroup.add(this.gcodeTravel),this.gcodeTravelAdded=!0),this.gcodeGeometryTravel.setDrawRange(a.lineTravel,u.lineTravel-a.lineTravel)):this.gcodeTravelAdded&&(this.gcodeGroup.remove(this.gcodeTravel),this.gcodeTravelAdded=!1),this.gcodeGroup.matrix=new gt,this.view.isZBelt){let c=45*Math.PI/180;this.model?c=this.model.printerParam1*Math.PI/180:c=this.options.rootScope.activeConfig.shape.basicShape.angle*Math.PI/180,this.gcodeGroup.matrixAutoUpdate=!1;let f=new gt,d=new gt,m=new gt,v=new gt,g=new gt;m.makeRotationX(Math.PI*.25),d.makeScale(1,Math.sin(c),-1),v.makeShear(0,0,0,-Math.cos(c),0,0),g.makeTranslation(0,0,n),f.premultiply(v),f.premultiply(d),f.premultiply(g),this.gcodeGroup.applyMatrix4(f)}o=performance.now()-o,this.view.setChanged()}};RSBase.component("rsBedView2d",{template:'<div ng-ref="$ctrl.content" style="width:100%;height:100%;cursor:{{ $ctrl.cursorStyle()}}"></div>',controller:["$element","$rootScope","$scope",function(t,e,i){this.bedGrid=void 0,this.p={},this.x=0,this.y=0,this.x0=0,this.y0=0,this.textureFile=null,this.textureCanvas=null,this.dragMode=0,this.zoomEnabled=!1,this.minScale=25,this.maxScale=1e3,this.intervalTimer=null,this.dirty=!1,this.lastW=0,this.lastH=0,this.show=0,this.renderCount=0,this.registerSend=!1,this.rainbowColors=["#ff0000","#ff8000","#ffff00","#80ff00","#00ff00","#00ff80","#00ffff","#0080ff","#0000ff","#8000ff","#ff00ff","#ff0080"],this.featureHeadline="",this.features=[],this.roundFeatures=[],this.featureMap={},this.$onChanges=n=>{!this.live&&(n.showTravel||n.showPrint||n.showRetracts||n.showExtruder||n.show)&&this.drawPreviewLayer(this.lastPreviewData,this.lastPreviewPercent),this.content&&this.adjustPosZoom()},this.triggerFeaturesChanged=()=>{this.featureHeadline=Vs[this.show].name,this.updateLegend&&this.updateLegend({value:{headline:this.featureHeadline,features:this.features,roundFeatures:this.roundFeatures}})},this.addFeature=(n,o)=>{if(n===void 0||o===void 0){console.log("illegal feature id");return}o===0&&this.show>=3||(this.featureMap[n]?this.featureMap[n].count++:this.featureMap[n]={id:n,value:parseFloat(""+n),count:1,index:-1})},this.sortedFeatureMapByValue=()=>{let n=Object.values(this.featureMap);return n.sort((o,a)=>o.value>a.value?1:a.value>o.value?-1:0),n},this.buildFeatureList=()=>{let n=Object.values(this.featureMap).length,o=this.sortedFeatureMapByValue();switch(o.length===0&&o.push({id:"0",value:0,count:1,index:0}),this.roundFeatures=[],this.showRetracts&&(this.roundFeatures.push({color:"#"+r(this.retractColor),name:"Отступления"}),this.roundFeatures.push({color:"#"+r(this.unretractColor),name:"Втягивание"})),this.features=o,this.show){case 0:this.featureInterpolate=!1,o.forEach(a=>{a.color=this.filamentColors[a.value%this.filamentColors.length],a.name="Экструдер "+(a.value+1)});break;case 1:this.featureInterpolate=!1,o.forEach(a=>{a.color=Sd[a.value].color,a.name=Sd[a.value].name});break;case 2:if(n<=this.rainbowColors.length)this.featureInterpolate=!1,o.forEach((a,l)=>{a.color=this.rainbowColors[l],a.name=a.id+" mm/s"});else{let a=[],l=o[0].value,h=o[n-1].value,u=this.rainbowColors.length,c=(h-l)/(u-1);for(let f=0;f<u;f++){let d=l+f*c;a.push({name:d.toFixed(0)+" mm/s",value:d,color:this.rainbowColors[f]})}this.features=a,this.featureInterpolate=!0}break;case 3:case 4:if(n<=this.rainbowColors.length)this.featureInterpolate=!1,o.forEach((a,l)=>{a.color=this.rainbowColors[l],a.name=a.id+" \xB5m"});else{let a=[],l=o[0].value,h=o[n-1].value,u=this.rainbowColors.length,c=(h-l)/(u-1);for(let f=0;f<u;f++){let d=l+f*c;a.push({name:d.toFixed(0)+" \xB5m",value:d,color:this.rainbowColors[f]})}this.features=a,this.featureInterpolate=!0}break}this.triggerFeaturesChanged()};function r(n){n<0&&(n=4294967295+n+1);let o=n.toString(16);for(;o.length<6;)o="0"+o;return o}this.setColorForFeatureValue=n=>{if(this.featureInterpolate){this.activeColor="#ff0000";let o=this.features.length;if(o===0)return;let a=Math.floor((o-1)*(n-this.features[0].value)/(this.features[o-1].value-this.features[0].value));a===o-1?a=o-2:a<o-1&&this.features[a+1].value<n&&a++;let l=a+1;if(a<0){this.activeColor=this.features[0].color;return}let h=parseInt(this.features[a].color.replace("#","0x")),u=parseInt(this.features[l].color.replace("#","0x")),c=(n-this.features[a].value)/(this.features[l].value-this.features[a].value),f=1-c,d=Math.round(c*(h>>16&255)+f*(u>>16&255)),m=Math.round(c*(h>>8&255)+f*(u>>8&255)),v=Math.round(c*(h&255)+f*(u&255));this.activeColor="#"+r((d<<16)+(m<<8)+v)}else{let o=1e20;this.features.forEach(a=>{let l=Math.abs(n-a.value);l<o&&(o=l,this.activeColor=a.color)})}},this.intervalFunction=()=>{let n=this.content[0].clientWidth,o=this.content[0].clientHeight;(n!==this.lastW||o!==this.lastH)&&(n>0&&this.registerSend===!1&&this.register&&(this.registerSend=!0,this.register({value:this})),this.lastW=n,this.lastH=o,this.adjustPosZoom()),++this.renderCount>=20&&(this.dirty=!0,this.renderCount=0),this.dirty&&(this.dirty=!1,this.app.render())},this.loadTexture=async()=>{let n=new Image;if(this.pc.shape.imageExtension!=="png"){n.onload=async()=>{if(n.height===0||n.width===0){console.warn("unknown image size - this svg is not supported");return}this.textureCanvas=this.textureCanvas||document.createElement("canvas");let a=Date.now(),l=this.textureCanvas.getContext("2d"),h,u,c=wi.getMaxTextureSize();(!c||c>2048&&ao)&&(c=2048);let f=c>4096?4096:c,d=!1,m=document.createElement("canvas");m.width=1,m.height=1;let v=m.getContext("2d");do{h=this.textureCanvas.width=f,u=this.textureCanvas.height=Math.floor(f*n.height/n.width),l.fillStyle="#818283",l.fillRect(h-1,u-1,1,1),v.drawImage(this.textureCanvas,h-1,u-1,1,1,0,0,1,1);let p=v.getImageData(0,0,1,1).data;d=f<1e3||u<=c&&p[3]!==0,d||(f=f/2)}while(!d);l.clearRect(h-1,h-1,1,1),l.drawImage(n,0,0,h,u),m.remove();let g=Date.now()-a;this.textureBase&&this.textureBase.destroy(),this.textureBase=At.from(this.textureCanvas,{}),this.drawBed(),this.render(),this.textureCanvas.remove(),this.textureCanvas=null,n.remove(),n=null};let o=await IU.default.get("/printer/bed/"+this.slug+"/get_image?r="+Math.random());if(o.status===200){let h=new DOMParser().parseFromString(o.data,"text/xml").getElementsByTagName("svg")[0],u=0,c=0,f=o.data.match(/viewBox="(.*?)"/);if(f.length===2){let d=f[1].split(" ");d.length===4&&(u=Number(d[2]),c=Number(d[3]))}u!==0&&c!==0&&(h.setAttribute("width",Math.floor(u)+"px"),h.setAttribute("height",Math.floor(c)+"px")),n.src="data:image/svg+xml;base64,"+btoa(new XMLSerializer().serializeToString(h))}}else n.onload=()=>{this.textureBase&&this.textureBase.destroy(),this.textureBase=At.from(n,{}),this.drawBed(),this.render(),n.remove(),n=null},n.src="/printer/bed/"+this.slug+"/get_image?&r="+Math.random();return!0},this.cursorStyle=()=>{switch(this.dragMode){case 0:return"move";case 1:return"crosshair";case 2:return"crosshair"}return"pointer"},this.createApp=()=>{if(this.excludeColors=[12267302,12279591,12231720,9878056,2865704,2669227,2645946,4663482,9185466,12200059],this.lastPrintZ=0,this.lastLineType=-1,this.lastExtruder=-1,this.filamentColors=["#005B73","#FC00FF","#59BDBE","#D0A766","#66c231"],this.filamentColor=128,this.midColor=16777215,this.retractRadius=.5,this.retractColor=13185068,this.unretractColor=255,this.travelColor=6536543,this.travelWidth=.15,this.resolution=window.devicePixelRatio,this.points=[],il.skipHello(),this.app=new WC({resizeTo:this.content[0],antialias:!0,resolution:window.devicePixelRatio,backgroundAlpha:0,width:300,height:300,autoDensity:!0,autoStart:!1}),this.pc)this.shape=Wt({},this.pc.shape.basicShape),this.shape.gridColor=this.pc.shape.gridColor,this.shape.gridSpacing=this.pc.shape.gridSpacing,this.shape.showImage=this.pc.shape.showImage,this.shape.imageZoom=this.pc.shape.imageZoom;else if(this.info)this.shape={xMin:this.info.xMin-20,xMax:this.info.xMax+20,yMin:this.info.yMin-20,yMax:this.info.yMax+20,shape:"rectangle",showImage:!1,gridSpacing:10,color:"#dddddd",gridColor:"#454545",imageZoom:100},this.info.printerType===2&&(this.shape.shape="zbelt");else{console.error("No printer config or info model provided for rs-bed-view-2d component");return}this.bedFill=il.string2hex(this.shape.color),this.bedGrid=il.string2hex(this.shape.gridColor),this.extruderColor=16711680,this.content[0].appendChild(this.app.view),this.shape.shape==="rectangle"||this.shape.shape==="zbelt"?(this.x0=(this.shape.xMin+this.shape.xMax)*.5,this.y0=(this.shape.yMin+this.shape.yMax)*.5):(this.x0=this.shape.x,this.y0=this.shape.y),this.x=this.y=0,this.dragX=0,this.dragY=0,this.app.renderer.plugins.interaction.on("mousedown",this.onDragStart).on("mouseup",this.onDragEnd).on("mouseupoutside",this.onDragEnd).on("mousemove",this.onDragMove).on("touchstart",this.onDragStartTouch).on("touchend",this.onDragEndTouch).on("touchendoutside",this.onDragEndTouch).on("touchmove",this.onDragMoveTouch),this.app.renderer.plugins.interaction.autoPreventDefault=!1,this.app.renderer.view.style.touchAction="auto",this.bed=new fi,this.bed.addChild(new Ri),this.app.stage.addChild(this.bed),this.drawBed(),this.actLayer=new fi,this.lastLayer=new fi,this.excludeLayer=new Ri,this.selectLayer=new Ri,this.lastLayer.alpha=.3,this.actLayer.addChild(new Ri),this.actLayer.addChild(new Ri),this.lastLayer.addChild(new Ri),this.lastLayer.addChild(new Ri),this.app.stage.addChild(this.lastLayer),this.app.stage.addChild(this.actLayer),this.app.stage.addChild(this.excludeLayer),this.app.stage.addChild(this.selectLayer),this.p&&this.ensureExtruder(this.p.state.activeExtruder),this.newLayer(),this.showExtruder&&(this.lastX=this.p.state.x+this.extruderOffsetX,this.lastY=this.p.state.y+this.extruderOffsetY,this.createExtruder(),this.updateExcludeRegions()),this.intervalTimer=setInterval(this.intervalFunction,25),this.app.view.addEventListener("webglcontextlost",this.conextLost),this.fitBed(),this.adjustPosZoom(),this.shape.showImage&&this.loadTexture()},this.conextLost=n=>{console.warn("context lost",n)},this.onResize=()=>{this.adjustPosZoom()},this.clearLayer=n=>{n.getChildAt(0).destroy(!0),n.getChildAt(0).destroy(!0);let o=new fi;o.addChild(new Ri),n.addChild(o),n.addChild(new Ri)},this.newLayer=()=>{this.skipNewLayer||(this.lastLayer.getChildAt(0).destroy(!0),this.lastLayer.getChildAt(0).destroy(!0),this.lastLayer.addChild(this.actLayer.removeChildAt(0)),this.lastLayer.addChild(this.actLayer.removeChildAt(0))),this.skipNewLayer=!1;let n=new fi;this.lastG=new Ri,n.addChild(this.lastG),this.actLayer.addChild(n),this.actLayer.addChild(new Ri),this.lastLineType=-1},this.selectRectangle=()=>(this.selectPromise=new Promise((n,o)=>{this.selectResolve=n,this.selectReject=o,this.dragMode=1}),this.selectPromise),this.selectPoint=()=>(this.selectPromise=new Promise((n,o)=>{this.selectResolve=n,this.selectReject=o,this.dragMode?(this.selectLayer.clear(),this.dragMode=0,this.dragging=0,o()):this.dragMode=2}),this.selectPromise),this.extractPinch=n=>{let o={date:new Date,distance:0},a=n.data.originalEvent.targetTouches;if(!a)return null;if(o.numTouches=a.length,a.length===2){o.isPinch=!0;let c=a[0].clientX-a[1].clientX,f=a[0].clientY-a[1].clientY;o.distance=Math.sqrt(c*c+f*f)}else o.isPinch=!1;let l={x:0,y:0};for(let c=0;c<a.length;c++)l.x+=a[c].clientX/a.length,l.y+=a[c].clientY/a.length;let h={x:0,y:0};this.app.renderer.plugins.interaction.mapPositionToPoint(h,l.x,l.y);let u=this.getGraphCoordinates(h.x,h.y);return o.centerTrans={x:u.x,y:u.y},o.center=h,o},this.onDragStart=n=>{this.lastPinch=this.extractPinch(n),this.data=n.data,this.dragMode===0?this.start={x:this.data.global.x,y:this.data.global.y}:this.dragMode===2?(this.start=this.data.getLocalPosition(this.app.stage),this.dragMode=0,this.selectLayer.clear(),this.selectResolve(this.start)):this.start=this.data.getLocalPosition(this.app.stage),this.alpha=.5,this.dragging=!0},this.onDragEnd=n=>{if(this.lastPinch=this.extractPinch(n),this.dragMode===0)this.x+=this.dragX,this.y+=this.dragY,this.dragX=0,this.dragY=0,this.dragging=!1,this.data=null;else if(this.dragMode===1){this.dragMode=0,this.dragging=!1,this.data=n.data;let o=this.data.getLocalPosition(this.app.stage);this.selectLayer.clear(),this.selectResolve({start:this.start,end:o})}this.render()},this.onDragMove=n=>{let o=n.data.originalEvent.shiftKey,a=this.extractPinch(n);if(a&&this.lastPinch&&this.lastPinch.distance){let l=this.app.stage,h=a.centerTrans,u=this.content[0].clientWidth,c=this.content[0].clientHeight;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let g=Math.abs(this.shape.xMax-this.shape.xMin)+16,p=Math.abs(this.shape.yMax-this.shape.yMin),_=g/p,x=u/c;_>x?this.zoomBase=.01*u/g:this.zoomBase=.01*c/p}else this.zoomBase=.005*Math.min(u,c)/this.shape.radius;this.zoomBase*=.94;let f=a.distance/this.lastPinch.distance,d=this.zoom*f;d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),this.zoom=d,this.scale=this.zoom*this.zoomBase,l.scale.x=this.zoom*this.zoomBase,l.scale.y=-this.zoom*this.zoomBase,l.position.x=.5*u-(this.x+this.dragX+this.x0)*this.scale,l.position.y=(this.y+this.dragY+this.y0)*this.scale+.5*c;let m=l.enableTempParent();l.updateTransform(),l.disableTempParent(m);let v=this.getGraphCoordinates(a.center.x,a.center.y);this.x-=v.x-h.x,this.y-=v.y-h.y,this.adjustPosZoom(),this.lastPinch=a;return}if(this.lastPinch=null,this.dragging){if(this.data=n.data,o){let l=-n.data.originalEvent.movementY*.25,h=this.zoom+l;h<this.minScale&&(h=this.minScale),h>this.maxScale&&(h=this.maxScale),this.zoom=h,this.adjustPosZoom(),this.start={x:this.data.global.x,y:this.data.global.y};return}if(this.dragMode===0){let l=(n.data.global.x-this.start.x)/this.scale,h=(n.data.global.y-this.start.y)/this.scale;this.dragX=-l,this.dragY=h,this.adjustPosZoom()}else if(this.dragMode===1){let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y),this.selectLayer.beginFill(16711680,.7).drawRect(this.start.x,this.start.y,l.x-this.start.x,l.y-this.start.y).endFill()}else if(this.dragMode===2){this.data=n.data;let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y)}}else if(this.dragMode){this.data=n.data;let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y)}this.render()},this.onDragStartTouch=n=>{let o=this.extractPinch(n);!this.lastPinch&&o&&o.isPinch&&(this.lastPinch=o,n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault()),this.data=n.data,this.dragMode===0&&this.lastPinch?this.start={x:this.lastPinch.centerTrans.x,y:this.lastPinch.centerTrans.y}:this.dragMode===2?(n.stopPropagation(),this.start=this.data.getLocalPosition(this.app.stage),this.dragMode=0,this.selectLayer.clear(),this.selectResolve(this.start)):this.start=this.data.getLocalPosition(this.app.stage),this.alpha=.5,this.dragging=!0},this.onDragEndTouch=n=>{if(this.lastPinch=null,this.dragMode===0)this.x+=this.dragX,this.y+=this.dragY,this.dragX=0,this.dragY=0,this.dragging=!1,this.data=null;else if(this.dragMode===1){this.dragMode=0,this.dragging=!1,this.data=n.data;let o=this.data.getLocalPosition(this.app.stage);this.selectLayer.clear(),this.selectResolve({start:this.start,end:o})}this.render()},this.onDragMoveTouch=n=>{let o=n.data.originalEvent.shiftKey,a=this.extractPinch(n);if(!this.lastPinch&&a&&a.isPinch)return this.lastPinch=a,this.dragMode===0&&(this.start={x:this.lastPinch.centerTrans.x,y:this.lastPinch.centerTrans.y}),n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault(),!0;if(a&&this.lastPinch&&a.isPinch){n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault();let l=this.app.stage,h=this.getGraphCoordinates(this.lastPinch.center.x,this.lastPinch.center.y),u=this.content[0].clientWidth,c=this.content[0].clientHeight;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let g=Math.abs(this.shape.xMax-this.shape.xMin)+16,p=Math.abs(this.shape.yMax-this.shape.yMin),_=g/p,x=u/c;_>x?this.zoomBase=.01*u/g:this.zoomBase=.01*c/p}else this.zoomBase=.005*Math.min(u,c)/this.shape.radius;this.zoomBase*=.94;let f=a.distance/this.lastPinch.distance,d=this.zoom*f;d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),this.zoom=d,this.scale=this.zoom*this.zoomBase,l.scale.x=this.zoom*this.zoomBase,l.scale.y=-this.zoom*this.zoomBase,l.position.x=.5*u-(this.x+this.dragX+this.x0)*this.scale,l.position.y=(this.y+this.dragY+this.y0)*this.scale+.5*c;let m=l.enableTempParent();l.updateTransform(),l.disableTempParent(m);let v=this.getGraphCoordinates(a.center.x,a.center.y);this.x-=v.x-h.x,this.y-=v.y-h.y,this.adjustPosZoom(),this.lastPinch=a;return}if(this.lastPinch=null,this.dragging){if(this.data=n.data,o){let l=-n.data.originalEvent.movementY*.25,h=this.zoom+l;h<this.minScale&&(h=this.minScale),h>this.maxScale&&(h=this.maxScale),this.zoom=h,this.adjustPosZoom(),this.start={x:this.data.global.x,y:this.data.global.y};return}if(this.dragMode!==0){if(this.dragMode===1){let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y),this.selectLayer.beginFill(16711680,.7).drawRect(this.start.x,this.start.y,l.x-this.start.x,l.y-this.start.y).endFill(),n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault()}else if(this.dragMode===2){this.data=n.data;let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y),n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault()}}}else if(this.dragMode){this.data=n.data;let l=this.data.getLocalPosition(this.app.stage);this.showCursorCross(l.x,l.y),n.stopPropagation(),n.data.originalEvent.stopPropagation(),n.data.originalEvent.preventDefault()}this.render()},this.showCursorCross=(n,o)=>{if(this.selectLayer.clear().lineStyle(.2,6328064,.9),this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let a={x:Math.min(this.shape.xMin,this.shape.xMax),y:Math.min(this.shape.yMin,this.shape.yMax)},l={x:Math.max(this.shape.xMax,this.shape.xMin),y:Math.max(this.shape.yMax,this.shape.yMin)};n>=a.x&&n<=l.x&&this.selectLayer.moveTo(n,a.y).lineTo(n,l.y),o>=a.y&&o<=l.y&&this.selectLayer.moveTo(a.x,o).lineTo(l.x,o)}else if(this.shape.shape==="circle"){let a=this.shape.radius;if(Math.abs(n)<a){let l=Math.acos(n/a),h=a*Math.sin(l);this.selectLayer.moveTo(n,-h).lineTo(n,h)}if(Math.abs(o)<a){let l=Math.asin(o/a),h=a*Math.cos(l);this.selectLayer.moveTo(-h,o).lineTo(h,o)}}},this.updateExcludeRegions=()=>{this.excludeLayer.clear();let n=e.RSPrinter.excludeRegions;for(let o=0;o<n.length;o++){let a=n[o];this.excludeLayer.beginFill(this.excludeColors[o%10],.4).drawRect(a.xmin,a.ymin,a.xmax-a.xmin,a.ymax-a.ymin).endFill()}this.render()},this.updateExcludeRegionsDelayed=()=>{setTimeout(this.updateExcludeRegions,600),setTimeout(this.updateExcludeRegions,2e3)},this.createExtruder=()=>{this.extruder||(this.extruder=new Ri,this.extruder.beginFill(this.extruderColor,.7).moveTo(0,0).lineTo(3,3).lineTo(3,10).lineTo(-3,10).lineTo(-3,3).closePath().endFill(),this.extruder.position.x=this.lastX,this.extruder.position.y=this.lastY,this.app.stage.addChild(this.extruder))},this.fitBed=()=>{this.shape.shape==="rectangle"||this.shape.shape==="zbelt"?(this.x0=(this.shape.xMin+this.shape.xMax)*.5,this.y0=(this.shape.yMin+this.shape.yMax)*.5):(this.x0=this.shape.x,this.y0=this.shape.y),this.x=0,this.y=0,this.zoom=100,this.adjustPosZoom()},this.fitArea=(n,o,a,l,h)=>{let u=a-n+2*h,c=l-o+2*h;this.x=(n+a)*.5-this.x0,this.y=(o+l)*.5-this.y0;let f=u/c,d=this.content[0].clientWidth,m=this.content[0].clientHeight,v=d/m;f>v?this.zoom=d/u/this.zoomBase:this.zoom=m/c/this.zoomBase,this.adjustPosZoom()},this.getGraphCoordinates=(n,o)=>{let a={global:{x:n,y:o}};return d_.prototype.getLocalPosition.call(a,this.app.stage)},this.zoomHandler=n=>{if(!(n.shiftKey||this.easyZoom===!0))return!0;if(n.deltaY===void 0||(event.preventDefault(),!this.zoomEnabled))return!1;let a={x:0,y:0};this.app.renderer.plugins.interaction.mapPositionToPoint(a,n.clientX,n.clientY);let l=this.app.stage,h=this.getGraphCoordinates(a.x,a.y),u=this.content[0].clientWidth,c=this.content[0].clientHeight;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let g=Math.abs(this.shape.xMax-this.shape.xMin)+16,p=Math.abs(this.shape.yMax-this.shape.yMin),_=g/p,x=u/c;_>x?this.zoomBase=.01*u/g:this.zoomBase=.01*c/p}else this.zoomBase=.005*Math.min(u,c)/(this.shape.radius+8);this.zoomBase*=.94;let f=1+n.deltaY*.01,d=this.zoom*f;d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),this.zoom=d,this.scale=this.zoom*this.zoomBase,l.scale.x=this.zoom*this.zoomBase,l.scale.y=-this.zoom*this.zoomBase,l.position.x=.5*u-(this.x+this.dragX+this.x0)*this.scale,l.position.y=.5*c+(this.y+this.dragY+this.y0)*this.scale;let m=l.enableTempParent();l.updateTransform(),l.disableTempParent(m);let v=this.getGraphCoordinates(a.x,a.y);return this.x-=v.x-h.x,this.y-=v.y-h.y,this.adjustPosZoom(),!1},this.adjustPosZoom=()=>{let n=this.content[0].clientWidth,o=this.content[0].clientHeight;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let l=Math.abs(this.shape.xMax-this.shape.xMin)+16,h=Math.abs(this.shape.yMax-this.shape.yMin),u=l/h,c=n/o;u>c?this.zoomBase=.01*n/l:this.zoomBase=.01*o/h}else this.zoomBase=.005*Math.min(n,o)/(this.shape.radius+8);this.zoomBase*=.94,this.scale=this.zoom*this.zoomBase;let a=this.app.stage;a.scale.x=this.zoom*this.zoomBase,a.scale.y=-this.zoom*this.zoomBase,a.position.x=.5*n-(this.x+this.dragX+this.x0)*this.scale,a.position.y=.5*o+(this.y+this.dragY+this.y0)*this.scale,this.app.renderer.resize(n,o),this.app.render()},this.drawBed=()=>{let n=new Ri;for(;this.bed.children.length;)this.bed.getChildAt(0).destroy(!0);this.bed.addChild(n);let o=0;if(e.theme==="dark"&&(o=16777215),this.pc)this.shape=Wt({},this.pc.shape.basicShape),this.shape.gridColor=this.pc.shape.gridColor,this.shape.gridSpacing=this.pc.shape.gridSpacing,this.shape.showImage=this.pc.shape.showImage,this.shape.imageZoom=this.pc.shape.imageZoom;else if(this.info)this.shape={xMin:this.info.xMin-20,xMax:this.info.xMax+20,yMin:this.info.yMin-20,yMax:this.info.yMax+20,shape:"rectangle",showImage:!1,gridSpacing:10,color:"#dddddd",gridColor:"#454545",imageZoom:100},this.info.printerType===2&&(this.shape.shape="zbelt");else{console.error("No printer config or info model provided for rs-bed-view-2d component");return}this.bedFill=il.string2hex(this.shape.color),this.bedGrid=il.string2hex(this.shape.gridColor);let a,l,h,u,c;u=this.shape.gridSpacing;let f=.01*u,d=.03*u,m=u,v=this.shape.imageZoom*.01,g=(1-v)*.5;if(this.shape.shape==="rectangle"||this.shape.shape==="zbelt"){let p={x:Math.min(this.shape.xMin,this.shape.xMax),y:Math.min(this.shape.yMin,this.shape.yMax)},_={x:Math.max(this.shape.xMax,this.shape.xMin),y:Math.max(this.shape.yMax,this.shape.yMin)};if(n.lineStyle(.5,this.bedGrid,1),n.beginFill(this.bedFill),n.drawRect(p.x,p.y,_.x-p.x,_.y-p.y),n.endFill(),c=0,h=Math.max(Math.abs(this.shape.xMin),Math.abs(this.shape.xMax),Math.abs(this.shape.yMin),Math.abs(this.shape.yMax)),parseFloat(u)>1){for(n.lineStyle(d,this.bedGrid,1),0>this.shape.yMin&&0<this.shape.yMax&&n.moveTo(p.x,0).lineTo(_.x,0),0>this.shape.xMin&&0<this.shape.xMax&&n.moveTo(0,p.y).lineTo(0,_.y),n.lineStyle(.1,this.bedGrid,1);c+u<h;){c+=u;let y=parseInt(c/u)%5==0?d:f;n.lineStyle(y,this.bedGrid,1);let w=c;c>this.shape.yMin&&c<this.shape.yMax&&n.moveTo(p.x,w).lineTo(_.x,w),c>this.shape.xMin&&c<this.shape.xMax&&n.moveTo(w,p.y).lineTo(w,_.y),-c>this.shape.yMin&&c<this.shape.yMax&&n.moveTo(p.x,-w).lineTo(_.x,-w),-c>this.shape.xMin&&c<this.shape.xMax&&n.moveTo(-w,p.y).lineTo(-w,_.y)}n.beginFill(this.bedGrid).drawCircle(0,0,.1*u).endFill()}if(this.shape.showImage&&this.textureBase){this.textureTexture&&this.textureTexture.destroy(!1),this.textureTexture=lt.from(this.textureBase);let y=new Zt,w=_.x-p.x,S=_.y-p.y,R=w/S,E=this.textureTexture.width/this.textureTexture.height;if(R<E){let T=w/E;y.identity().scale(v*w/this.textureTexture.width,-v*T/this.textureTexture.height).translate(p.x+w*g,p.y-T*g+.5*(S-T)+T),n.lineStyle(0,16711680,0).beginTextureFill({matrix:y,texture:this.textureTexture,alpha:.01*this.pc.shape.imageOpacity}).drawRect(p.x+w*g,p.y+T*g+.5*(S-T),w*v,T*v).endFill()}else{let T=S*E;y.identity().scale(v*T/this.textureTexture.width,-v*S/this.textureTexture.height).translate(p.x+g*T+.5*(w-T),p.y+S-g*S),n.lineStyle(0,16711680,0).beginTextureFill({matrix:y,texture:this.textureTexture,alpha:.01*this.pc.shape.imageOpacity}).drawRect(p.x+.5*(w-T)+g*T,p.y+g*S,T*v,S*v).endFill()}}m<1&&(m=25);let x=parseInt(Math.max(this.shape.xMax-this.shape.xMin,this.shape.yMax-this.shape.yMin)/m);for(;x>8*5;)m*=2,x=parseInt(Math.max(this.shape.xMax-this.shape.xMin,this.shape.yMax-this.shape.yMin)/m);let b=5*Math.min(this.shape.xMax-this.shape.xMin,this.shape.yMax-this.shape.yMin)*.005;for(let y=-x*m*5;y<=x*m*5;y+=5*m){if(y>=this.shape.xMin&&y<=this.shape.xMax){let w=new vs(""+y,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),S=b/w.height,R=w.height,E=w.width;w.y=p.y-1,w.scale.y=-1,w.height=R*S,w.width=E*S,w.x=y-.5*w.width,this.bed.addChild(w),w=new vs(""+y,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),w.y=_.y+1+R*S,w.scale.y=-1,w.height=R*S,w.width=E*S,w.x=y-.5*w.width,this.bed.addChild(w)}if(y>=this.shape.yMin&&y<=this.shape.yMax){let w=new vs(""+y,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),S=w.height,R=w.width,E=b/w.height;w.scale.y=-1,w.height=S*E,w.width=R*E,w.x=p.x-w.width-1,w.y=y+.5*w.height,this.bed.addChild(w),w=new vs(y,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),w.scale.y=-1,w.height=S*E,w.width=R*E,w.x=_.x+1,w.y=y+.5*w.height,this.bed.addChild(w)}}}else if(this.shape.shape==="circle"){let p={x:this.shape.x,y:this.shape.y},_=this.shape.radius;if(n.lineStyle(.5,this.bedGrid,1).beginFill(this.bedFill).drawCircle(p.x,p.y,_).endFill(),this.shape.showImage&&this.textureBase){this.textureTexture&&this.textureTexture.destroy(!1),this.textureTexture=lt.from(this.textureBase);let b=new Zt,y=2*_,w=2*_,S=this.textureTexture.width/this.textureTexture.height;if(1<S){let R=y/S;b.identity().scale(v*y/this.textureTexture.width,-v*R/this.textureTexture.height).translate(-_+g*y,-_-g*R+.5*(w-R)+R),n.lineStyle(0,16711680,0).beginTextureFill({matrix:b,texture:this.textureTexture,alpha:this.pc.shape.imageOpacity}).drawRect(-_+g*y,-_+g*R+.5*(w-R),y*v,R*v).endFill()}else{let R=w*S;b.identity().scale(v*R/this.textureTexture.width,-v*w/this.textureTexture.height).translate(-_+g*R+.5*(y-R),_-g*w),n.lineStyle(0,16711680,0).beginTextureFill({matrix:b,texture:this.textureTexture,alpha:.01*this.pc.shape.imageOpacity}).drawRect(-_+g*R+.5*(y-R),-_+g*w,R*v,w*v).endFill()}}if(c=u,parseFloat(u)>=1){for(n.lineStyle(d,this.bedGrid,1),n.moveTo(p.x,p.y-_).lineTo(p.x,p.y+_),n.moveTo(p.x-_,p.y).lineTo(p.x+_,p.y),n.lineStyle(f,this.bedGrid,1);c<_;){let b=c,y=parseInt(c/u)%5==0?d:f;n.lineStyle(y,this.bedGrid,1),a=Math.asin((0-b-p.y)/_),l=_*Math.cos(a),n.moveTo(p.x-l,-b).lineTo(p.x+l,-b),a=Math.asin((b-p.x)/_),l=_*Math.cos(a),n.moveTo(b,p.y-l).lineTo(b,p.y+l),a=Math.asin((b-p.y)/_),l=_*Math.cos(a),n.moveTo(p.x-l,b).lineTo(p.x+l,b),a=Math.asin((-b-p.x)/_),l=_*Math.cos(a),n.moveTo(-b,p.y-l).lineTo(-b,p.y+l),c+=u}n.beginFill(this.bedGrid).drawCircle(0,0,.1*u).endFill()}m<1&&(m=25);let x=parseInt(_/m);for(;x>3*5;)m*=2,x=parseInt(_/m);for(let b=-m*5*x;b<=m*5*x;b+=5*m)if(b>=-_&&b<=_){let y=new vs(b,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),w=5*_*.01/y.height,S=y.height,R=y.width;y.y=-_-1,y.scale.y=-1,y.height=S*w,y.width=R*w,y.x=b-.5*y.width,this.bed.addChild(y),y=new vs(b,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),y.y=_+1+S*w,y.scale.y=-1,y.height=S*w,y.width=R*w,y.x=b-.5*y.width,this.bed.addChild(y),y=new vs(b,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),y.scale.y=-1,y.height=S*w,y.width=R*w,y.x=-_-y.width-1,y.y=b+.5*y.height,this.bed.addChild(y),y=new vs(b,{fontFamily:"Arial",fontSize:100,fill:o,align:"center"}),y.scale.y=-1,y.height=S*w,y.width=R*w,y.x=_+1,y.y=b+.5*y.height,this.bed.addChild(y)}}},this.ensureExtruder=n=>{n===void 0||n===this.lastExtruder||(this.lastExtruder=n,this.filamentColor=parseInt(this.filamentColors[n%this.filamentColors.length].replace("#","0x")),this.pc&&this.pc.extruders.length>n?(this.extruderOffsetX=this.pc.extruders[this.lastExtruder].offsetX,this.extruderOffsetY=this.pc.extruders[this.lastExtruder].offsetY):(this.extruderOffsetX=0,this.extruderOffsetY=0),this.lastLineType!==-1&&(this.lastG=new Ri,this.actLayer.getChildAt(0).addChild(this.lastG)),this.lastLineType=-1)},this.addRetract=(n,o,a)=>{n.beginFill(this.retractColor,.6).lineStyle(0).drawCircle(o,a,this.retractRadius)},this.addUnretract=(n,o,a)=>{n.beginFill(this.unretractColor,.6).lineStyle(0).drawCircle(o,a,this.retractRadius)},this.onMove=n=>{let o=Wt({},n);if(this.ensureExtruder(o.t),o.x+=this.extruderOffsetX,o.y+=this.extruderOffsetY,Math.abs(o.x-this.lastX)<.001&&Math.abs(o.y-this.lastY)<.001){let a=this.actLayer.getChildAt(1);o.de>.01?this.addUnretract(a,o.x,o.y):o.de<-.01&&this.addRetract(a,o.x,o.y),this.lastLineType=0}else if(o.de>1e-6){Math.abs(o.z-this.lastPrintZ)>1e-4&&this.newLayer();let a=this.actLayer.getChildAt(0),l=this.lastG;this.lastPrintZ=o.z,this.lastLineType!==1&&(this.lastLineType!==-1&&(l=this.lastG=new Ri,a.addChild(l)),this.points=[{x:this.lastX,y:this.lastY}],l.moveTo(this.lastX,this.lastY)),this.points.push({x:o.x,y:o.y}),l.clear().lineStyle(.4,this.filamentColor,.7).moveTo(this.points[0].x,this.points[0].y);for(let h=1;h<this.points.length;h++){let u=this.points[h];l.lineTo(u.x,u.y)}l.lineStyle(.4*.3,this.midColor,.4).moveTo(this.points[0].x,this.points[0].y);for(let h=1;h<this.points.length;h++){let u=this.points[h];l.lineTo(u.x,u.y)}this.lastLineType=1}else{let a=this.actLayer.getChildAt(0),l=this.lastG;this.lastLineType!==2&&(this.lastLineType!==-1&&(l=this.lastG=new Ri,a.addChild(l)),this.points=[{x:this.lastX,y:this.lastY}]),this.points.push({x:o.x,y:o.y}),l.clear().lineStyle(this.travelWidth,this.travelColor,1).moveTo(this.points[0].x,this.points[0].y);for(let h=1;h<this.points.length;h++){let u=this.points[h];l.lineTo(u.x,u.y)}this.lastLineType=2}this.extruder.position.x=this.lastX=o.x,this.extruder.position.y=this.lastY=o.y,this.dirty=!0},this.xyToPlainArray=(n,o)=>{let a=[];return n.forEach(l=>{o>0&&(a=a.concat([l.x,l.y])),o--}),a},this.includeFeatures=(n,o)=>{o&&(this.features=[],this.featureMap={},this.activeColor=this.filamentColors[0]),n.forEach(a=>{a.t===10?this.show===1&&this.addFeature(""+a.ft,a.ft):a.t===1?(this.show===0&&this.addFeature(a.e,a.e),this.show===2&&this.addFeature((a.s/60).toFixed(1),a.s/60),this.show===3&&this.addFeature(""+(5*Math.round(200*a.w)).toFixed(0),parseFloat((5*Math.round(200*a.w)).toFixed(0)))):a.t===4||a.t===5||(a.t===6?(this.maxF=Math.max(this.maxF,a.s/60),this.show===2&&this.addFeature((a.s/60).toFixed(1),a.s/60)):a.t===8?this.show===3&&this.addFeature(""+(5*Math.round(200*a.w)).toFixed(0),parseFloat((5*Math.round(200*a.w)).toFixed(0))):a.t===11?(this.show===3&&this.addFeature(""+(5*Math.round(200*a.w)).toFixed(0),parseFloat((5*Math.round(200*a.w)).toFixed(0))),this.show===4&&this.addFeature(""+(1e3*a.h).toFixed(0),parseFloat((a.h*1e3).toFixed(0)))):a.t===7&&this.show===0&&this.addFeature(""+a.e,a.e))})},this.drawPreviewLayer=(n,o)=>{if(this.lastPreviewData=n,this.lastPreviewPercent=o,!n||!this.actLayer)return;this.height=.2,this.width=.4,this.show===3&&this.addFeature(""+(5*Math.round(200*this.width)).toFixed(0),parseFloat((5*Math.round(200*this.width)).toFixed(0))),this.show===4&&this.addFeature(""+(1e3*this.height).toFixed(0),parseFloat((this.height*1e3).toFixed(0))),this.includeFeatures(n,!0),this.buildFeatureList(),this.clearLayer(this.actLayer);let a=this.actLayer.getChildAt(1),l=this.actLayer.getChildAt(0).getChildAt(0),h=this.filamentColors[0],u=.4;u<.001&&(u=.001);let c,f=0,d=0,m=9999999;o<100&&(n.forEach(v=>{switch(v.t){case 2:this.showTravel&&(f+=v.m.length-1);break;case 3:this.showPrint&&(f+=v.m.length-1);break;case 4:case 5:this.showRetracts&&f++}}),m=f*o/100),n.forEach(v=>{if(!(d>m))switch(v.t){case 1:v.w>0&&v.w!==this.width&&(this.width=v.w,this.show===3&&this.setColorForFeatureValue(Math.round(v.w*1e3))),this.show===0&&this.setColorForFeatureValue(v.e),c={x:v.x,y:v.y},v.w!==0&&(u=v.w);break;case 2:if(this.showTravel){let g=v.m[0];l.lineStyle(this.travelWidth,this.travelColor,1).moveTo(g.x,g.y);let p=Math.min(v.m.length,m-d+1);for(let _=1;_<p;_++){let x=v.m[_];l.lineTo(x.x,x.y)}d+=v.m.length-1}c=v.m[v.m.length-1];break;case 3:if(this.showPrint){let g=v.m[0];l.lineStyle(this.width,parseInt(this.activeColor.replace("#","0x")),.7).moveTo(g.x,g.y);let p=Math.min(v.m.length,m-d+1);for(let _=1;_<p;_++){let x=v.m[_];l.lineTo(x.x,x.y)}l.lineStyle(this.width*.3,this.midColor,.4).moveTo(g.x,g.y);for(let _=1;_<p;_++){let x=v.m[_];l.lineTo(x.x,x.y)}d+=v.m.length-1}c=v.m[v.m.length-1];break;case 4:if(!this.showRetracts)break;this.addRetract(a,c.x,c.y),d++;break;case 5:if(!this.showRetracts)break;this.addUnretract(a,c.x,c.y),d++;break;case 6:this.show===2&&this.setColorForFeatureValue(v.s/60);break;case 7:this.show===0&&this.setColorForFeatureValue(v.e);break;case 8:this.width=v.w;break;case 9:break;case 10:this.show===1&&this.setColorForFeatureValue(v.ft);break;case 11:v.w>0&&(this.width=v.w,this.show===3&&this.setColorForFeatureValue(Math.round(v.w*200)*5)),this.height=v.h,this.show===3&&this.setColorForFeatureValue(Math.round(v.w*200)*5),this.show===4&&this.setColorForFeatureValue(Math.round(v.h*1e3));break}}),this.render()},this.drawLastLayer=(n,o)=>{this.clearLayer(this.lastLayer);let a=this.lastLayer.getChildAt(1),l=this.lastLayer.getChildAt(0).getChildAt(0);this.skipNewLayer=!0,this.lastPrintZ=o;let h=parseInt(this.filamentColors[0].replace("#","0x")),u=.4;u<.001&&(u=.001);let c={x:0,y:0};for(let f in n){if(!{}.hasOwnProperty.call(n,f))continue;let d=n[f];switch(d.t){case 1:h=parseInt(this.filamentColors[d.e%this.filamentColors.length].replace("#","0x")),c={x:d.x,y:d.y},d.w!==0&&(u=d.w);break;case 2:{let m=d.m[0];l.lineStyle(this.travelWidth,this.travelColor,1).moveTo(m.x,m.y);let v=d.m.length;for(let g=1;g<v;g++){let p=d.m[g];l.lineTo(p.x,p.y)}c=d.m[d.m.length-1]}break;case 3:{let m=d.m[0];l.lineStyle(u,h,.7).moveTo(m.x,m.y);let v=d.m.length;for(let g=1;g<v;g++){let p=d.m[g];l.lineTo(p.x,p.y)}l.lineStyle(u*.3,this.midColor,.4).moveTo(m.x,m.y);for(let g=1;g<v;g++){let p=d.m[g];l.lineTo(p.x,p.y)}c=d.m[d.m.length-1]}break;case 4:this.addRetract(a,c.x,c.y);break;case 5:this.addUnretract(a,c.x,c.y);break;case 6:break;case 7:h=parseInt(this.filamentColors[d.e%this.filamentColors.length].replace("#","0x"));break;case 8:u=d.w;break}}this.dirty=!0},this.render=()=>{this.intervalTimer?this.dirty=!0:this.app.render()},this.$postLink=()=>{this.bed=void 0,this.pc=e.printerConfig[this.slug],this.p=e.printer[this.slug],this.createApp(),$(this.content[0]).on("mousewheel",this.zoomHandler),$(this.content[0]).on("wheel",this.zoomHandler),window.addEventListener("resize",this.onResize)},this.$onDestroy=()=>{window.loosect=void 0,this.register&&this.register({value:null}),$(this.content[0]).off("mousewheel"),$(this.content[0]).off("wheel"),window.removeEventListener("resize",this.onResize),this.app.view.removeEventListener("webglcontextlost",this.conextLost),this.app&&(this.intervalTimer&&clearInterval(this.intervalTimer),this.app.destroy(!0,!0))}}],controllerAs:"$ctrl",bindings:{register:"&",updateLegend:"&",zoom:"=",live:"=",easyZoom:"=",info:"=",showExtruder:"<",showTravel:"<",showRetracts:"<",showPrint:"<",slug:"<",show:"<"}});RSBase.factory("KlipperDialog",["$uibModal","$sce","User","$http",function(t,e,i,r){return function(n,o){let a=t.open({template:`<div class="modal-header">
    <h4 class="modal-title">{{headline}}</h4>
</div>
<div class="modal-body">

  <div ng-if="page === 0" class="form-group margin-top" >
    <div>
      <label>Версия клиппера</label>
      <select class="form-control" ng-model="$parent.klipperVersion" ng-options="v as v.name for v in updateVersionList"></select>
    </div>
    <div class="margin-top">
      <small class="">Выберите версию Klipper, которую Вы хотите установить. Обратите внимание, что самая новая версия Klipper может содержать изменения, которые могут нарушить установку. В этом случае используйте вторую запись.</small> 
    </div>
  </div>
    
  <div class="clearfix"></div>
  
  <div  ng-if="page === 1">
    <h4>Вывод</h4>
    <div ng-if="channel" id="terminalCommand" style="position:relative;border:0;width:100%;height:70vh">
      <rs-terminal autofocus channel="channel" callback="terminalCallback"></rs-terminal>
    </div>
  </div>
</div>
<div class="modal-footer">    
    <button type="button" ng-if="firmwareCompiled" class="btn btn-primary" ng-click="downloadFirmware()"><i class="fa fa-download rs-bigtab"></i> Загрузить файл прошивки</button>
    <button type="button" class="btn btn-default pull-left" ng-click="close()"><i class="fa fa-times rs-bigtab"></i> Закрыть</button>
    <button type="button" ng-if="page === 0 && klipperActionName === 'update'" class="btn btn-primary" ng-click="startKlipperUpdate()"><i class="fa fa-refresh"></i> Обновление</button>
    <button type="button" ng-if="page === 0 && klipperActionName === 'install'" class="btn btn-primary" ng-click="startKlipperUpdate()"><i class="fa fa-play"></i> Установить</button>
</div>
`,controller:["$scope","$rootScope","$uibModalInstance","RSCom","$timeout","User",function(l,h,u,c,f,d){l.downloadFirmware=function(){window.open("/printer/klipperfw/"+h.activeSlug+"?a=download","ihelper")},l.klipperVersion={},l.updateVersionList={},l.firmwareCompiled=!1,l.klipperActionName=n,n==="install"?l.headline="Установка Клиппера":n==="uninstall"?l.headline="Деинсталляция Klipper":n==="update"?l.headline="Обновление Клиппера":n==="restart"?l.headline="Перезапуск Клиппера":n==="installInputShaping"?l.headline="Установите зависимости для формирования входного сигнала":n==="createFirmware"?l.headline="Создание микропрограммы":n==="getKlipperLog"&&(l.headline="Бревно Клиппера"),l.channel=void 0,l.output="",this.output="";let m="",v=!1,g=p=>{this.output+=p.replace(/ /g,"&nbsp;").replace(`
`,"<br>"),$("#klipper_output").html(this.output),f(function(){var _=document.getElementById("klipper_output");_.scrollTop=_.scrollHeight})};l.startKlipperAction=function(p,_,x){l.page=1;let b=[_];x&&(b=[...b,x.git_target,""+x.format,x.url_git]),c.send("klipperAction",{action:p,config:b}).then(y=>{y.terminal_id?l.channel=y.terminal_id:l.channel=void 0})},l.startKlipperUpdate=function(){l.startKlipperAction(n,o,l.klipperVersion),v=!0},l.$on("executeOutput",(p,_)=>{_.data.name===m&&g(_.data.out)}),l.$on("executeFinished",(p,_)=>{_.data.name===m&&g(`

`+"Операция завершена с кодом выхода @".replace("@",_.data.exitCode)),n==="restart"&&l.close()}),l.terminalCallback={onClose:()=>{console.log("closed1"),c.send("sendEvent",{event:"reloadKlipperConfig"}),n==="installInputShaping"&&setTimeout(()=>{c.send("send",{cmd:"FIRMWARE_RESTART"})},5e3)},onLine:p=>{p==="Finished compiling Klipper firmware!"&&(l.firmwareCompiled=!0)}},l.startAction=function(){l.startKlipperAction(n,o)},n==="update"?(l.page=0,r.get("https://download1.repetier.com/files/server/extras/klipper-versions.json").then(p=>{l.updateVersionList=p.data.versions,l.klipperVersion=p.data.versions[0]})):n==="install"?(l.page=0,r.get("https://download1.repetier.com/files/server/extras/klipper-versions.json").then(p=>{l.updateVersionList=p.data.versions,l.klipperVersion=p.data.versions[1]})):l.startKlipperAction(n,o),l.close=function(){u.close()}}],size:"lg",backdrop:"static"});return a.result.catch(function(l){}),a.result}}]);RSBase.factory("KlipperDialogInputShaping",["$uibModal","$sce","User",function(t,e,i){return function(r,n,o){let a=t.open({template:`<div class="modal-header" xmlns="http://www.w3.org/1999/html">
          <h4 class="modal-title">Формирование входного сигнала</h4>
          <div ng-if="phase === 0">Установка зависимостей</div>
          <div ng-if="phase === 1">Настройки измерения</div>
          <div ng-if="phase === 2">Измерение резонансов</div>
          <div ng-if="phase === 3">Анализ результатов</div>
          <div ng-if="phase === 4">Графики результатов</div>
        </div>
        <div class="modal-body">
          <div ng-if="phase === 1">
            <!-- Settings -->              
            <div class="row" style="display: flex; align-items: center">
              <div class="col-sm-3 form-group checkbox">
                <label>
                  <input class="" type="checkbox" ng-model="shaperOptions.useX">Используйте ось X
                </label>
              </div>
              <div class="col-sm-3 form-group checkbox margin-top-important"  >
                <label>
                  <input class="" type="checkbox" ng-model="shaperOptions.useY">Используйте ось Y
                </label>
              </div>
            </div>
            
            <div class="row">
              <div class="col-sm-6 form-group">
                <label>Start Frequency</label>
                <input class="form-control" min="1" type="number" ng-model="shaperOptions.freqStart">
              </div> 
              <div class="col-sm-6 form-group">
                <label>End Frequency</label>
                <input class="form-control" min="1" type="number" ng-model="shaperOptions.freqEnd">
              </div>
            </div>
          </div>
          
          <div ng-if="phase === 2">
            <!-- GCode Analysis Section -->
            <h3>
              <rs-icon class="margin-right fa fa-spinner fa-spin"></rs-icon>Измерение резонансов в процессе. Это может занять некоторое время...
            </h3>
            <div class="col-xs-12">
              <div class="progress">
                <div class="progress-bar" role="progressbar" aria-valuenow="{{measuringPercentage}}" aria-valuemin="0" aria-valuemax="100" style="width:{{measuringPercentage}}%"></div>
                <div class="metertext">{{measuringPercentage}}%</div>
              </div>
            </div>
          </div>
          
          <div ng-if="(phase === 3 || phase === 0) && channel" id="terminalCommand" style="position:relative;border:0;width:100%;height:70vh">
            <!-- Bash Analysis Section -->
            <rs-terminal channel="channel" callback="terminalCallback"></rs-terminal>
            
          </div>
          <div ng-if="phase === 4">
            <div class="images-slideshow">
              <h3 ng-if="imageData.count == 0">В настоящее время нет графиков измерения резонанса. Пожалуйста, используйте помощник по формированию входного сигнала для создания графиков</h3>
              <div ng-repeat="image in imageData.images track by $index">
                <div class="image-slides">
                  <div style="margin: auto; display: block; width: 85%;">
                    <label>Ось {{image.axis}}</label>
                   
                    <div type="button" style="margin: 0;margin-left: 10px;margin-top: -3px;" ng-click="deleteImage(image)" class="margin-right btn text-danger btn-xs pull-right">
                      <i class="fa fa-trash-o" style="font-size:2em"></i>
                    </div>
                   <label class="pull-right">{{getFileDate(image)}}</label>
                  </div>
                 
                  <img ng-src="{{image.url}}" style="margin: auto; display: block; width: 85%;">
                </div>
              </div>
              <a class="slider-btn previous" ng-click="setSlides(-1)">\u276E</a>
              <a class="slider-btn next" ng-click="setSlides(1)">\u276F</a>
             
            </div>
            <div class="margin-top margin-bottom" style="display:flex; justify-content: center; text-align:center">
              <div ng-repeat="a in imageData.images track by $index">
                <span class="slideshow-dot" ng-class="{'slideshow-dot-disabled':$index !== currentIndex}" ng-click="showSlide($index)"></span>
              </div>
            </div>
          </div>
        
        <div class="modal-footer" style="padding-right: 0; padding-left: 0; padding-bottom: 0; padding-top: 15px">
          <button type="button" class="btn btn-default pull-left" ng-click="close()"><i class="fa fa-times rs-bigtab"></i> Закрыть</button>
          <button ng-if="phase === 0 && phasefinished === true" type="button" class="btn btn-primary" ng-click="proceedToSettings()"><i class="fa fa-play rs-bigtab"></i> Следующий</button>
          <button ng-if="phase === 1" type="button" class="btn btn-primary" ng-click="start()"><i class="fa fa-play rs-bigtab"></i> Следующий</button>
          <button ng-if="phase === 3 && phasefinished === true" type="button" class="btn btn-primary" ng-click="displayGallery()"><i class="fa fa-play rs-bigtab"></i> Показать графики</button>
          <div class="clearfix">
        </div>
      `,controller:["$scope","$rootScope","$uibModalInstance","RSCom","$timeout","User","Flash",function(l,h,u,c,f,d,m){l.phase=0,l.channel=void 0,l.output="",l.imageData={},l.phasefinished=!1,l.shaperOptions={useX:!0,useY:!0,freqStart:1,freqEnd:133,hzPerSec:1},this.output="";let v="";l.currentIndex=0;function g(_){if(l.imageData.count!==0){let x,b=document.getElementsByClassName("image-slides");for(l.currentIndex=Math.min(l.imageData.count-1,l.currentIndex),_>b.length-1&&(l.currentIndex=0),_<0&&(l.currentIndex=b.length-1),x=0;x<b.length;x++)b[x].style.display="none";b[l.currentIndex].style.display="block"}}l.imageURL=function(_){return"/printer/inputshapingimage/"+h.activeSlug+"/?index="+_},l.getFileDate=function(_){return"Дата создания"+new Date(_.date*1e3).toLocaleString()},l.showSlide=function(_){g(_)},l.setSlides=function(_){g(l.currentIndex+=_)},l.deleteImage=_=>{c.send("deleteInputShapingImage",{index:_.indexNumber}).then(x=>{x.ok===!0?(m.success("Изображение удалено"),l.displayGallery()):x.error&&m.error("Изображение не может быть удалено! Причина"+x.error)})};let p=_=>{this.output+=_.replace(/ /g,"&nbsp;").replace(`
`,"<br>"),$("#klipper_output").html(this.output),f(function(){var x=document.getElementById("klipper_output");x.scrollTop=x.scrollHeight})};l.$on("executeOutput",(_,x)=>{x.data.name===v&&p(x.data.out)}),l.proceedToSettings=()=>{l.phase=1},l.$on("executeFinished",(_,x)=>{console.log("KlipperDialogInputShaping.executeFinished",x),x.data.name===v&&p(`

`+"Операция завершена с кодом выхода @".replace("@",x.data.exitCode)),c.send("sendEvent",{event:"reloadKlipperConfig"})}),l.activeAxis="",l.shaperResult={},l.terminalCallback={onClose:()=>{console.log("KlipperDialogInputShaping.terminalCallback.onClose"),l.phasefinished=!0,c.send("sendEvent",{event:"reloadKlipperConfig"})},onLine:_=>{if(_==="Input Shaping Analysis: X Axis"&&(l.activeAxis="X"),_==="Input Shaping Analysis: Y Axis"&&(l.activeAxis="Y"),_.startsWith("Recommended shaper is ")){let b=_.slice(21,-2).split("@");b[0]=b[0].trim(),b[1]=b[1].trim(),l.shaperResult[l.activeAxis]={freq:b[1],shaper:b[0]}}}},l.displayGallery=function(){c.send("getInputShapingImages").then(_=>{console.log(_),_.ok===!0?(_.images.sort(function(x,b){return x.filename<b.filename?1:-1}),l.imageData=_,l.phase=4,l.imageData.count!==0&&setTimeout(()=>{g(0)},0)):_.error})},l.checkDependencies=function(){o?l.phase=1:c.send("klipperAction",{action:"installInputShaping",config:[r]}).then(_=>{_.terminal_id?l.channel=_.terminal_id:l.channel=void 0})},l.start=function(){l.phasefinished=!1,c.send("startInputShaping",l.shaperOptions).then(_=>{_.ok===!0?l.phase=2:_.error}),l.startProgressbar()},l.startProgressbar=()=>{l.measuringProgress=0,l.measuringPercentage=0;let _=0,x=0;l.shaperOptions.useX&&x++,l.shaperOptions.useY&&x++,_=x*((l.shaperOptions.freqEnd-l.shaperOptions.freqStart)/l.shaperOptions.hzPerSec+50)+10;let b=setInterval(()=>{l.measuringProgress=l.measuringProgress+_/100,l.measuringPercentage=Math.round(l.measuringProgress/_*100),l.measuringPercentage>=100&&clearInterval(b)},_*10)},l.$on("inputShapingPhase1Finished",(_,x)=>{c.send("klipperAction",{action:"inputShaping",config:[r]}).then(b=>{b.terminal_id?(l.channel=b.terminal_id,l.phase=3):l.channel=void 0})}),console.log(n),n===!0?l.displayGallery():l.checkDependencies(),l.close=function(){u.close()}}],size:"lg",backdrop:"static"});return a.result.catch(function(l){}),a.result}}]);RSBase.factory("PrinterConditionDialog",["$uibModal","$sce",function(t,e){return function(i){let r=t.open({template:`<div class="modal-header">
    <h4 class="modal-title"><span ng-bind-html="p | printerConditionIcon | unsafe"></span> {{ p | printerConditionText }}</h4>
</div>
<div class="modal-body">
<div ng-if="!p.status.active">
<p>Использование принтера деактивировано. Ты можешь спокойно использовать его с другим программным обеспечением. Чтобы подключиться, тебе нужно активировать принтер.</p>
</div>
<div ng-if="p.status.active && p.status.online===0">
<p>Принтер не подключен. Пожалуйста, подключи принтер и включи питание. Затем он должен появиться автоматически.</p>
<p>Если принтер по-прежнему не отображается, возможно, вы задали неправильные параметры подключения или они изменились.</p>
</div>
<div ng-if="p.status.active && p.status.online">
<div ng-if="p.state.condition===1"><!-- ready -->
<p>Принтер находится в рабочем состоянии.</p>
</div>

<div ng-if="p.state.condition===2"><!-- shutdown -->
<p>Ты подключен к контролирующему экземпляру.</p>
<p>Контролирующий экземпляр сообщает, что принтер находится в состоянии ошибки и нуждается во внутреннем перезапуске. Сообщение об ошибке:</p>
<p>{{p.state.conditionReason}}</p>
<p>Устрани проблему и попробуй восстановиться.</p>
</div>

<div ng-if="p.state.condition===3"><!-- killed -->
<p>Твой принтер сообщил, что он перешел в состояние ´убит´. Обычно это вызвано серьезной проблемой, обнаруженной внутри принтера.</p>
<p>Чтобы перезапустить принтер, его необходимо перезагрузить. Для большинства принтеров с 32-битным процессором мы не можем сбросить настройки удаленно. Если у принтера нет кнопки сброса, тебе нужно выключить питание принтера и, в конце концов, даже отсоединить usb-кабель.</p>
<p>Сообщение от принтера:</p>
<p>{{p.state.conditionReason}}</p>
</div>

<div ng-if="p.state.condition===4"><!-- ignoring -->
<p>Твой принтер сообщил о внутренней проблеме принтера и отключил несколько команд. Обычно это вызвано проблемой, обнаруженной внутри принтера, например, выбегом температуры.</p>
<p>Устрани проблему и попробуй восстановиться. Если источник не будет исправлен, он может снова перейти в состояние ошибки.</p>
<p>Сообщение от принтера:</p>
<p>{{p.state.conditionReason}}</p>
</div>

<div ng-if="p.state.condition===5"><!-- offline -->
<p>Принтер находится в автономном режиме. Убедись, что на него подано питание и принтер подключен. После этого он должен перейти в рабочий режим автоматически.</p>
</div>
</div>
</div><div class="modal-footer">
    <button type="button" class="btn btn-default" ng-click="close()"><i class="fa fa-times rs-bigtab"></i> Закрыть</button>
    <button ng-if="p.status.active && p.status.online!==0 && p.status.online && p.state.condition>=2 && p.state.condition<=4 && user.printPermission" type="button" class="btn btn-primary" ng-click="recoverBadCondition()"><i class="fa fa-wrench rs-bigtab"></i> Постарайся восстановиться</button>
    <button ng-if="!p.status.active && user.printPermission" type="button" class="btn btn-primary" ng-click="activate()">
      <rs-icon icon="fa fa-link fg-success"></rs-icon> 
      Активировать
    </button>
    <div ng-if="p.status.active && p.status.online===0 && user.changeConfigPermission" class="btn btn-primary" ng-click="configure()">
                <rs-icon icon="fa fa-gear"></rs-icon>
                  Настройки принтера
              </div>
</div>
`,controller:["$scope","$rootScope","$uibModalInstance","RSCom","$state",function(n,o,a,l,h){n.p=o.printer[i],n.recoverBadCondition=function(){l.send("recoverBadCondition",{},i),a.close()},n.configure=function(){a.close(),h.go("printerConfig.general",{slug:i})},n.activate=function(){l.send("activate",{printer:i}),a.close()},n.close=function(){a.close()}}],size:"400",backdrop:"static"});return r.result.catch(function(n){}),r.result}}]);RSPrinterModule.controller("PrinterController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","RSPrinter","RSPrinters","User","Flash","$uibModal","$state","PrinterConditionDialog",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v,g){let p=e.slug;t.demo=!!window.demo,r.active.state===void 0&&v.go("home"),t.printerExternalLinks=[],t.disk={},t.menuOpen=!1,t.menuFan=!1,t.menuFlow=!1,t.menuSpeed=!1,t.menuTemp=!1,t.menuBed=!1,t.menuChamber=!1,t.menuEmergency=!1,t.menuActions=!1,typeof r.active.local=="undefined"&&(r.active.local={}),typeof r.active.local.logCommands=="undefined"&&(r.active.local.logCommands=0,r.active.local.logACK=0,r.active.local.logPause=0,r.active.local.logAutoscroll=1,r.active.local.lastLogStart=0,r.active.local.logFilterM105=1),r.active.local.queueExpanded===void 0&&(r.active.local.queueExpanded=!0),t.showPage=function(w,S){S&&(S.stopPropagation(),S.preventDefault()),u.setActivePage(p,{state:w,params:{slug:p}}),v.go(w,{slug:p}),t.menuOpen=!1},t.closeMenuActions=function(){t.menuActions=!1},t.closeFan=function(){t.menuFan=!1},t.closeFlow=function(){t.menuFlow=!1},t.closeEmergency=function(){t.menuEmergency=!1},t.closeSpeed=function(){t.menuSpeed=!1},t.closeTemp=function(){t.menuTemp=!1},t.closeChamber=function(){t.menuChamber=!1},t.closeBed=function(){t.menuBed=!1},t.closeMenu=function(){t.menuOpen=!1},t.showPrinterCondition=function(){g(r.activeSlug)};function _(){t.printerExternalLinks=[],angular.forEach(r.externalLinks,function(w){w.slug===p&&w.gui&&t.printerExternalLinks.push(JSON.parse(JSON.stringify(w)))})}t.prevent=function(w){w&&(w.stopPropagation(),w.preventDefault())},t.$on("int_externalLinksChanged",_),t.executeExternalLink=function(w){t.menuOpen=!1,w.openExternal?window.open(w.href,"_blank"):v.go("printer.externalLink",{slug:p,id:w.id})},t.canPrint=f.printPermission,t.moveDistance=10,t.moveToXPos=20,t.moveToYPos=50,t.moveToZPos=0,t.idle=!0,t.printerData={moveDistance:10,moveToXPos:20,moveToYPos:50,moveToZPos:0,idle:!0,canPrint:f.printPermission},r.frontend.setVisible("showConsole",f.printPermission),r.frontend.setVisible("showTimelapseTab",r.isPro()||r.isOEM()||r.isLight()),r.titlePrepend=r.active.status.name+"@";let x=!1;t.slug=p,h.selectPrinter(p),t.cmd="",t.$on("$destroy",function(){i.send("hideMoves",{}),r.titlePrepend="",x=!0}),t.checkDisk=function(){i.send("freeSpace",{}).then(function(w){t.disk=w,t.disk.usage=100-100*(w.available/w.capacity),w.capacity<1e3*1024*1024?t.disk.class="progress-bar-warning":w.capacity<500*1024*1024?t.disk.class="progress-bar-danger":t.disk.class="progress-bar-success"})},t.$watch("active.state.isJobActive",function(){!t.active||!t.active.state||(t.printing=t.active.state.isJobActive,t.idle=r.active.status.paused||!t.active.state.isJobActive)}),t.$watch("active.status.paused",function(){!r.active||!r.active.state||!r.active.status||(t.printerData.idle=t.idle=r.active.status.paused||!t.active.state.isJobActive)}),t.$on("log",function(w,S){p===S.printer&&(r.active.local.lastLogStart=t.lastLogStart=S.data.id)}),r.$watch("active.local.logACK",function(){r.active&&r.active.local&&i.send("setLoglevel",{level:t.getLoglevel()}).then(function(){t.$broadcast("logLevelChanged",r.active)})}),r.$watch("active.local.logCommands",function(){r.active&&r.active.local&&i.send("setLoglevel",{level:t.getLoglevel()}).then(function(){t.$broadcast("logLevelChanged",r.active)})}),r.$watchCollection("activeConfig.webcams",function(){r.activeConfig&&r.activeConfig.webcams&&r.frontend.setVisible("activeWebcam",r.activeConfig.webcams.length>0)}),t.getLoglevel=function(){return 12+(r.active.local.logCommands!==0?1:0)+(r.active.local.logACK!==0?2:0)},t.previewData=0,t.$on("move",function(w,S){t.printerData.moveToXPos=t.moveToXPos=S.data.x,t.printerData.moveToYPos=t.moveToYPos=S.data.y,t.printerData.moveToZPos=t.moveToZPos=S.data.z,r.active.state.f=S.data.f,t.$broadcast("extruderPos",{x:t.moveToXPos,y:t.moveToYPos,z:t.moveToZPos})}),t.exactMoves=function(){m.open({templateUrl:"/views/printer/control/printer.control.move.php?lang="+lang,scope:t,size:"sm"})},t.stopPrint=function(){l("Требуется подтверждение","Действительно остановить текущую печать?","Да","Нет",!0).then(function(){t.active.status.jobid&&i.send("stopJob",{id:t.active.status.jobid})})},t.recover=function(){v.go("printer.rescue")},t.runCall=function(w){w.question?l("Контрольный вопрос",w.question).then(function(){i.send("webCallExecute",{name:w.name,params:["Test"]})}):i.send("webCallExecute",{name:w.name,params:["Test"]})};let b=function(){if(!i.connected||p!==t.activeSlug||x)return;let w=12+(r.active.local.logCommands>0?1:0)+(r.active.local.logACK>0?2:0);i.send("response",{filter:w,start:(r.active.local.lastLogStart===0,-1)}).then(function(S){typeof S.state!="undefined"&&(S.list&&S.list.length>0&&(r.active.local.lastLogStart=t.lastLogStart=S.list[S.list.length-1].id),t.printerData.moveToXPos=t.moveToXPos=S.state.x,t.printerData.moveToYPos=t.moveToYPos=S.state.y,t.printerData.moveToZPos=t.moveToZPos=S.state.z,t.$broadcast("extruderPos",{x:t.moveToXPos,y:t.moveToYPos,z:t.moveToZPos})),n(b,3e3)})};t.reduceConextMenu=!1;function y(){let w=0;angular.forEach(t.externalCommandsFiltered,function(S){S.remote&&S.slug===t.activeSlug&&w++}),angular.forEach(t.webCalls,function(S){S.show_in_menu&&S.slug===t.activeSlug&&w++}),t.reduceConextMenu=w>4}t.$on("connected",function(){h.selectPrinter(p),i.send("setLoglevel",{level:t.getLoglevel()}),b(),t.checkDisk(),y()}),y(),b(),t.checkDisk(),_()}]);RSPrinterModule.controller("PrinterCameraController",["$scope","$stateParams","RSCom","RSPrinter","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","User","$interval","RSPrinterConfig","Flash","SelectProject","Fullscreen",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p){let _=!1,x=function(){if(typeof n.activeConfig!="undefined")switch(t.webcammode===1&&!w&&(b(),w=!0),t.webcammode){case 1:t.webcamRotate=n.activeConfig.webcams[t.activeCam].orientation,t.webcamUrl="/printer/camjpg/"+n.activeSlug+"?cam="+t.activeCam+"&rand="+RSUtils.createAlphaID(10);break;case 2:t.webcamRotate=n.activeConfig.webcams[t.activeCam].orientation,S=RSUtils.createAlphaID(10),t.webcamUrl="/printer/cammjpg/"+n.activeSlug+"?cam="+t.activeCam+"&wcid="+S;break;default:t.webcamRotate=0,t.webcamUrl="/img/nowebcam.png";break}},b=function(){if(t.refreshWebcamImage(),t.webcammode!==1){w=!1;return}o(b,1e3*n.activeConfig.webcams[t.activeCam].reloadInterval)},y=function(){if(n.activeConfig.webcams.length){if(t.edit){let L=n.activeConfig.webcams[t.edit.webcamId||0];D("#editimage",t.edit.webcamOrientation!==void 0?t.edit.webcamOrientation:L?L.orientation:0)}D("#editvideo",0)}};t.vmode=0,t.webcammode=0,n.active.local.selectedWebcam=n.active.local.selectedWebcam!==void 0?n.active.local.selectedWebcam:0,t.activeCam=n.active.local.selectedWebcam,t.saveActiveCam=function(){n.active.local.selectedWebcam=t.activeCam},n.globals.timelapseView||(n.globals.timelapseView={viewMode:parseInt(f.getSetting("timelapseViewMode","1")),hideFailed:parseInt(f.getSetting("timelapseViewFailed","0"))}),t.tabs=[!0,!1,!1,!1],t.activeTab=0,m.selectPrinter(t.activeSlug).then(function(){t.config=m.config}),t.selectTab=function(L){t.tabs=[!1,!1,!1,!1],t.tabs[L]=!0,t.activeTab=L};let w=!1;t.renderingVersion=0,t.toggleAll=!1,t.webcamUrl="/img/nowebcam.png",t.webcamRotate=0,t.webcammode=0,t.showCam=!0,t.webcamFull=!1,t.enableMode1=!1,t.enableMode2=!1,t.index=0,t.webcamRotateClass="",t.framerates=[{v:1,n:"1 fps"},{v:5,n:"5 fps"},{v:10,n:"10 fps"},{v:12,n:"12 fps"},{v:15,n:"15 fps"},{v:24,n:"24 fps"},{v:25,n:"25 fps"},{v:30,n:"30 fps"},{v:50,n:"50 fps"},{v:60,n:"60 fps"}],t.saveTimelapseCamera=function(){m.saveTimelapse()},t.videos={timelapses:[]},t.toggleVideos=function(){angular.forEach(t.videos.timelapses,function(L){L.selected=t.toggleAll})};let S="",R=function(){S.length>0&&(i.send("webcamCloseStream",{wcid:S}),S="")},E=function(){t.renderingVersion++,angular.forEach(t.videos.timelapses,function(L){switch(L.dateText=a("date")(L.createdSeconds*1e3,"medium"),L.enc=encodeURIComponent(L.dir),L.selected=!1,L.videoLink="/timelapse/video/"+n.activeSlug+"?entry="+L.enc+"&rand="+RSUtils.createAlphaID(10),L.renderVersion?L.renderVersion++:L.renderVersion=0,L.conversionMode){case-1:L.icon="fa fa-spinner fa-spin",L.edit=!1,L.sizeText='Захват';break;case 0:L.icon="fa fa-spinner fa-spin",L.edit=!0,L.sizeText='Конвертирование';break;case 1:L.icon="fa fa-spinner fa-spin",L.edit=!0,L.sizeText='Конвертирование';break;case 2:L.sizeText=a("byte")(L.videoLength),L.edit=!0,L.icon=void 0;break;case 3:L.icon="fa fa-warning",L.edit=!0,L.sizeText='Ошибка';break;case 4:L.sizeText=a("byte")(L.videoLength),L.edit=!0,L.icon=void 0;break}})};t.$on("fullscreenChanged",function(){t.webcamFull=n.isFullscreen?t.webcamFull:!1,y()}),t.toggleFullscreen=function(){n.isFullscreen||(t.webcamFull=!0),p.toggleFullscreen($("#webcamArea")[0])};let T=function(){i.send("getTimelapseVideos",{}).then(function(L){t.videos=L,E()})};t.archiveVideo=function(L){g("",'Копирование видео в проект').then(function(I){i.send("projectMovieToProject",{serveruuid:I.serveruuid,projectuuid:I.uuid,timelapse:L.dir})},function(){})},t.edit=void 0,t.sliderOptions={floor:1,disableAnimation:!0,model:1,onChange:(L,I,k,B)=>{t.setImagePos(I)}},t.setImageUrl=function(){t.editimage="/timelapse/viewImage/"+n.activeSlug+"?entry="+t.edit.enc+"&image="+t.editImage};let A=!0;t.addImagePos=function(L){A&&(A=!1,L<0&&(L+=t.edit.imageCounter),t.editImage=(t.editImage+L)%t.edit.imageCounter,t.sliderOptions.model=t.editImage,t.setImageUrl())},t.setImagePos=function(L){t.editImage=L%t.edit.imageCounter,t.sliderOptions.model=t.editImage,t.setImageUrl()};let C,M=function(){t.editPlay>0?t.addImagePos(1):t.addImagePos(-1)};t.setPlay=function(L){t.editPlay=L,C&&(d.cancel(C),C=void 0),L!==0&&(t.editFPS=Math.abs(L)*10,C===void 0&&(C=d(M,1e3/t.editFPS)))},t.imageShown=function(){A=!0},t.updateViewMode=function(){f.setSetting("timelapseViewMode",n.globals.timelapseView.viewMode.toString())},t.updateHideFailed=function(){f.setSetting("timelapseViewFailed",n.globals.timelapseView.hideFailed.toString())},t.editVideo=function(L){t.edit=L,t.sliderOptions.ceil=L.imageCounter,t.index=1,t.editMode=0,t.editImage=0,t.editPlay=0,t.editFPS=10,t.setImageUrl()},t.deselectEditVideo=function(){t.edit=void 0,t.sliderOptions.ceil=0,t.index=0,t.editMode=0,t.editImage=0,t.editPlay=0,t.editFPS=10},t.toggleRecordSelection=function(L){L.selected=!L.selected},t.selectAllRecods=function(){angular.forEach(t.videos.timelapses,function(L){L.selected=!0})},t.deselectAllRecods=function(){angular.forEach(t.videos.timelapses,function(L){L.selected=!1})},t.deleteSelectedRecords=function(){h('Контрольный вопрос','Действительно удалить выбранные видео?','Да','Нет',!0).then(function(){t.edit=void 0,t.selectTab(1),angular.forEach(t.videos.timelapses,function(L){L.selected&&l.get("/timelapse/delvideo/"+n.activeSlug+"?entry="+L.enc)})})},t.deleteVideo=function(L){h('Контрольный вопрос','Действительно удалить видео?','Да','Нет',!0).then(function(){t.edit=void 0,t.selectTab(1),l.get("/timelapse/delvideo/"+n.activeSlug+"?entry="+L.enc).then(function(){v.success('Видео удалено'),t.deselectEditVideo()})})},t.deleteImages=function(L){h('Контрольный вопрос','Действительно удалить все изображения?','Да','Нет',!0).then(function(){l.get("/timelapse/delimages/"+n.activeSlug+"?entry="+L.enc).then(function(){v.success('Изображения удалены'),L.conversionMode=4})})},t.closeEdit=function(){t.setPlay(0),t.deselectEditVideo(),t.edit=void 0},t.recreateVideo=function(L){l.get("/timelapse/recreateVideo/"+n.activeSlug+"?entry="+L.enc)},t.stopRecording=function(L){if(typeof L=="number"){angular.forEach(t.videos.timelapses,I=>{L===I.webcamId&&I.conversionMode===-1&&l.get("/timelapse/stoprecording/"+n.activeSlug+"?entry="+I.enc)}),T();return}l.get("/timelapse/stoprecording/"+n.activeSlug+"?entry="+L.enc),T()},t.startTimelapse=function(L){typeof L=="number"&&(l.get("/timelapse/startrecording/"+n.activeSlug+"?cam="+L),T())},t.$on("timelapseChanged",function(L,I){t.videos=I.data,E(),t.edit&&angular.forEach(t.videos.timelapses,function(k){if(k.dir===t.edit.dir){k.enc=encodeURIComponent(k.dir);let B=t.edit.conversionMode<2&&k.conversionMode>=2;t.edit=k,t.sliderOptions.ceil=k.imageCounter,B&&(t.edit.videoLink="/timelapse/video/"+n.activeSlug+"?entry="+k.enc+"&rand="+RSUtils.createAlphaID(10))}})}),T(),t.selectCam=function(){t.showCam=!0,x()},t.deselectCam=function(){t.showCam=!1,t.webcamUrl="/img/empty.png"},t.deselectVideo=function(){t.setPlay(0)},n.activeConfig.webcams&&n.activeConfig.webcams.length&&((n.activeConfig.webcams[t.activeCam].method&1)===1&&(t.webcammode=1,t.enableMode1=!0),(n.activeConfig.webcams[t.activeCam].method&2)===2&&(t.webcammode=2,t.enableMode2=!0)),t.$watch("webcammode",x);let D=function(L,I){let k=$(L);if(k.length===0)return;let B=k.parent();k[0].nodeName==="WEBSOCKET-CAMERA"&&(k=$("img",k));let F=k.width(),W=k.height(),V=0,N=B.width(),ne=1,ie,Q;switch(I){case 0:case 180:ie=F,Q=W;break;case 90:case 270:V=(F-W)/2,ie=W,Q=F;break}let K=$(window).height()-(t.webcamFull?0:80),de=0;t.webcamFull?(ne=N/ie,ne=Math.min(K/Q,ne),de=(K/2+-W/2).toFixed(0)+"px"):(N<ie&&(ne=N/ie),K<Q&&(ne=Math.min(K/Q,ne)));let re="translateY("+de+") scale("+ne+") rotate("+I+"deg) ";k.css("-webkit-transform",re),k.css("-ms-transform",re),k.css("transform",re),t.webcamFull?k.css("margin-top",0):(k.css("margin-top",((Q*ne-W)/2).toFixed(0)+"px"),ne*Q>0?B.height(ne*Q):B.css("height","auto"),$("#webcamArea").css("position","relative")),$(".reccam").css("left",(N-F-2)/2+5+"px")},O=d(y,100),P=function(){!n.activeConfig||n.activeConfig.webcams.length===0||(t.webcammodes=[{id:0,name:'Отключено'}],(n.activeConfig.webcams[t.activeCam].method&1)===1&&t.webcammodes.push({id:1,name:'Список изображений'}),(n.activeConfig.webcams[t.activeCam].method&2)===2&&t.webcammodes.push({id:2,name:'Динамический JPG'}))};t.refreshWebcamImage=function(){t.webcammode===1&&t.showCam&&(t.webcamUrl="/printer/camjpg/"+n.activeSlug+"?cam="+t.activeCam+"&rand="+RSUtils.createAlphaID(10))},t.$on("connected",function(){P(),x()}),t.$watch("activeConfig",function(){P()}),t.$watch("activeCam",function(){n.activeConfig.webcams&&n.activeConfig.webcams.length&&((n.activeConfig.webcams[t.activeCam].method&2)===2?(t.webcammode=2,t.enableMode2=!0,R(),S=RSUtils.createAlphaID(10),t.webcamUrl="/printer/cammjpg/"+n.activeSlug+"?cam="+t.activeCam+"&wcid="+S,t.webcamRotate=n.activeConfig.webcams[t.activeCam].orientation):(n.activeConfig.webcams[t.activeCam].method&1)===1?(t.webcammode=1,t.enableMode1=!0,w||(b(),w=!0)):t.webcamUrl="/img/nowebcam.png",y())}),t.$on("$destroy",function(){_=!0,t.webcammode=0,t.webcamUrl="/img/empty.png",t.setPlay(0),R(),d.cancel(O)}),t.formWebcam={$valid:!0},t.$watch("formWebcam.$valid",function(L){typeof L!="undefined"&&m.setError("webcam",t.formWebcam.$invalid)})}]);RSPrinterModule.controller("PrinterConsoleController",["$scope","$stateParams","RSCom","$rootScope","$timeout","RSOverview","P","$state","$interval","RSPrinter","User",function(t,e,i,r,n,o,a,l,h,u,c){let f=t.slug,d=!1,m=!0,v=0;t.dummy=0;let g=1,p="",_=-1,x=-1;t.local=u.local(),t.menuCommands=!1,t.wizardCommands=!1,t.closeCommands=function(){t.menuCommands=!1},t.closeWizards=function(){t.wizardCommands=!1},t.lastLogStart=0,t.webcam={};let b=/\b[TB]\d*:\s*[\d-]/,y=function(T){if(!(T.type&8)&&r.active.local.logFilterM105&&(T.text.indexOf("M105")!==-1||T.text.indexOf("M408")!==-1||T.text.indexOf("M409")!==-1||b.test(T.text)))return;let A=T.text.replace(/[<>]/ig,function(M){return"&"+(M===">"?"g":"l")+"t;"}),C=T.time+": "+A;p!==A?(r.active.log.push('<div class="log'+T.type+'">'+C+"</div>"),r.active.log.splice(0,r.active.log.length-500),g=1,p=A):(g++,r.active.log[r.active.log.length-1]='<div class="log'+T.type+'">'+C+" ("+g+")</div>"),m=!0,t.lastLogStart=T.id};t.checkCopyCommand=function(T){if(T.type==="click"&&T.target.className==="log1"){let A=T.target.innerHTML.split(": ");A=A.slice(1,A.length);let C=A.join(" "),M=D=>{let O=D.split(" ");O=O.slice(1,O.length);let P=O.join(" ");return P[0]==="N"?M(P):P};C[0]==="N"?t.cmd=M(C):t.cmd=C}},t.clearLog=function(){r.active.log=[],p="",v=t.lastLogStart,$("#logpanel").html("")},t.prefillLog=function(){let T=12+(r.active.local.logCommands>0?1:0)+(r.active.local.logACK>0?2:0);T===_&&x===r.active.local.logFilterM105||(_=T,x=r.active.local.logFilterM105,t.clearLog(),i.send("response",{filter:T,start:v}).then(function(A){r.active.log=[],angular.forEach(A.lines,function(C){y(C)})}))},t.prefillLog("firstInit"),t.$on("log",function(T,A){A.printer===f&&(r.active.local.logPause||y(A.data))}),n(function(){let T=document.getElementById("logpanel");T&&(T.scrollTop=T.scrollHeight)},200);let w=function(){if(!d){if(m){$("#logpanel").html(r.active.log.join(""));let T=document.getElementById("logpanel");T&&(T.scrollTop=T.scrollHeight),m=!1}n(w,100)}};r.cmdHistory||(r.cmdHistory=[]);let S=-1,R=function(T){r.cmdHistory.unshift(T),r.cmdHistory.length>100&&r.cmdHistory.pop(),S=-1};t.sendCmd=function(){R(t.cmd),i.send("send",{cmd:t.cmd}),t.cmd=""},t.walkHistory=function(T){T.key==="ArrowUp"&&S<r.cmdHistory.length-1?(S++,t.cmd=r.cmdHistory[S]):T.key==="ArrowDown"&&S>0&&(S--,t.cmd=r.cmdHistory[S])},t.sendGCode=function(T){R(T),i.send("send",{cmd:T})},t.sendQuickCommand=function(T){R('@quickCommand "'+T+'"'),i.send("sendQuickCommand",{name:T})},t.$on("$destroy",function(){i.send("hideMoves",{}),d=!0}),w(),t.local.openControl||(t.local.openControl={printJob:!0,temperatures:!1,temperaturesAcc:!0,controlExtruder:!0,controlMove:!0,bed:!0});let E=function(){let T=r.active.state.activeExtruder,A=r.active.state.extruder?r.active.state.extruder.length:0;T!==void 0&&A>0&&(T=Math.min(T,A-1),t.retractSpeed=r.activeConfig.extruders[T].retractSpeed,t.extrudeSpeed=r.activeConfig.extruders[T].extrudeSpeed),t.extrudeDistance=10};t.$watch("active.state.activeExtruder",function(){E()}),t.$on("connected",function(){i.send("sendMoves",{})}),i.send("sendMoves",{}),E()}]);RSPrinterModule.controller("PrinterFilamentChangeController",["$scope","$stateParams","RSCom","$rootScope","$timeout","RSOverview","P","$state","$interval","RSPrinter","User",function(t,e,i,r,n,o,a,l,h,u,c){t.local=u.local(),t.menuCommands=!1,t.closeCommands=function(){t.menuCommands=!1},t.webcam={},t.local.openControl||(t.local.openControl={printJob:!0,temperatures:!0,controlExtruder:!1,controlMove:!1,bed:!0}),r.frontend.setVisible("showFilamentchange",!0),r.active.status.online!==1&&l.go("printer.print",{slug:r.activeSlug}),function(){let d=r.active.state.activeExtruder;r.active&&r.active.state&&r.active.state.extruder&&r.active.state.extruder.length>0&&(t.retractSpeed=r.activeConfig.extruders[d].retractSpeed,t.extrudeSpeed=r.activeConfig.extruders[d].extrudeSpeed),t.extrudeDistance=10}(),t.$on("$destroy",function(){r.frontend.setVisible("showFilamentchange",!1)})}]);RSPrinterModule.controller("PrinterControlController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","$uibModal","User","RSPrinter","$state","$interval","$q","Flash","Fullscreen",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p,_){let x=null;t.webcam={},t.excludeColors=["#BB2F26","#BB5F27","#BAA428","#96BA28","#2BBA28","#28BAAB","#285FBA","#4728BA","#8C28BA","#BA287B"],t.sliderPos={x:0,y:0,z:0},t.preview2d=!0;let b=null;t.togglePreview2d=function(){event&&(event.stopPropagation(),event.preventDefault()),t.preview2d=!t.preview2d,t.preview2d&&y()},t.register3dView=F=>{b=F},t.menuCommands=!1,t.closeCommands=function(){t.menuCommands=!1},t.posText="",t.show3dMode=0,t.xSlider={floor:r.activeConfig.movement.xMin,ceil:r.activeConfig.movement.xMax,step:.01,precision:2,enforceStep:!1,showTicks:25,hideLimitLabels:!0,onlyBindHandles:!0,translate:function(F){return F.toFixed(2)},onEnd:function(){!r.active.state.isJobActive&&f.printPermission&&t.idle?t.xMoveTo(t.sliderPos.x):t.sliderPos.x=moveToXPos}},t.ySlider={floor:r.activeConfig.movement.yMin,ceil:r.activeConfig.movement.yMax,step:.01,precision:2,enforceStep:!1,showTicks:25,vertical:!0,hideLimitLabels:!0,onlyBindHandles:!0,translate:function(F){return F.toFixed(2)},onEnd:function(){!r.active.state.isJobActive&&f.printPermission&&t.idle?t.yMoveTo(t.sliderPos.y):t.sliderPos.y=moveToYPos}},t.zSlider={floor:r.activeConfig.movement.zMin,ceil:r.activeConfig.movement.zMax,step:.01,precision:2,enforceStep:!1,showTicks:25,vertical:!0,hideLimitLabels:!0,onlyBindHandles:!0,translate:function(F){return F.toFixed(2)},onEnd:function(){!r.active.state.isJobActive&&f.printPermission&&t.idle?t.zMoveTo(t.sliderPos.z):t.sliderPos.z=moveToZPos}},t.setPreview=function(F){var W;x=F,F&&(x.zoomEnabled=!0,x.fitBed(),x.onMove({x:t.moveToXPos,y:t.moveToYPos,z:t.moveToZPos,de:0,t:(W=r.active.state.activeExtruder)!=null?W:0,w:0}),x.render())};let y=function(){if(r.active.status.jobid===0){t.layerData={};return}a.get("/printer/layeranalysis_job/"+e.slug+"?id="+r.active.status.jobid).then(function(F){let W=r.active.state.layer;t.layerData=I=F.data,I.totalLayer=I.layers.length-1,I.totalDuration=I.layers[I.totalLayer].t,I.totalHeight=I.layers[I.totalLayer].h,I.totalLines=I.layers[I.totalLayer].l;let V=I.layers.length-1;if(W>=V)return;let N=I.layers[W-1],ne=I.layers[W];a.get("/printer/layer_job/"+r.activeSlug+"?id="+r.active.status.jobid+"&start="+N.p+"&end="+ne.p).then(function(ie){let Q=ie.data;x&&x.drawLastLayer(Q,ne.h)},function(){})},function(){})},w=()=>{let F=$(window).height(),W=$("#center-page").width();F===C&&W===A||(A=W,C=F,t.display=A<900?0:1,P(),E())},S=function(F){},R=function(F,W,V){let N=F.toFixed(V);return"&nbsp;".repeat(W+V+1-N.length)+N},E=function(){if(P(),L(),S(f.printPermission&&t.idle),r.active.status.job!=="none"){let W=function(V){if(r.active.state.layer!==void 0){y();return}V>12||n(()=>{W(V+1)},500)};var F=W;W(0)}};t.local=d.local(),t.local===void 0&&m.go("home"),r.active.status.online!==1&&m.go("printer.print",{slug:r.activeSlug}),t.local.openControl||(t.local.openControl={printJob:!0,temperatures:!1,temperaturesAcc:!0,controlExtruder:!0,controlMove:!0,bed:!0,hideSkirtOozeShield:!1}),t.menuList={},t.closeMenu=function(F){t.menuList[F]=!1},t.showExcludeRegion=!1,t.hsliderSize=300,t.display=-1,r.globals||(r.globals={}),angular.isObject(r.globals.control)||(r.globals.control={tempDiag:parseInt(f.getSetting("tempDiagMode","0")),tempDiagActive:parseInt(f.getSetting("tempDiagActive","0")),tempDiagAll:parseInt(f.getSetting("tempDiagAll","0")),tempDiagBed:parseInt(f.getSetting("tempDiagBed","0")),tempDiagChamber:parseInt(f.getSetting("tempDiagChamber","0"))}),function(){var V,N;let F=r.active.state.activeExtruder,W=r.active.state.extruder?r.active.state.extruder.length:0;F!==void 0&&W>0&&(F=Math.min(F,W-1),t.retractSpeed=(V=r.activeConfig.extruders[F].retractSpeed)!=null?V:r.activeConfig.extruders[W-1].retractSpeed,t.extrudeSpeed=(N=r.activeConfig.extruders[F].extrudeSpeed)!=null?N:r.activeConfig.extruders[W-1].extrudeSpeed),t.extrudeDistance=10}();let A=0,C=0,M=-1,D=function(){M=-1};t.goFilamentchange=()=>{m.go("printer.filamentchange",{slug:t.activeSlug})};let O=function(){},P=function(){},L=()=>{var W;t.sliderPos.x=t.moveToXPos,t.sliderPos.y=t.moveToYPos,t.sliderPos.z=t.moveToZPos;let F=r.active.local.showAbsolutePositions;t.posText="<small>"+(F?"Глобальная позиция":"Местная позиция")+"</small><br><span class='reduced-text'>X:</span><span class='coord-text'>"+R(t.moveToXPos-(F?0:r.active.state.xOff),5,2)+" &nbsp;</span><span class='reduced-text'>Y:</span><span class='coord-text'>"+R(t.moveToYPos-(F?0:r.active.state.yOff),5,2)+" &nbsp;</span><span class='reduced-text'>Z:</span><span class='coord-text'>"+R(t.moveToZPos-(F?0:r.active.state.zOff),4,3)+"</span>"+(window.innerWidth>=900&&((W=r.active.state)!=null&&W.f)?"&nbsp;&nbsp;<span class='reduced-text'>F:</span><span class='coord-text-4'>"+R(r.active.state.f/60,4,0)+"</span><span class='reduced-text'> mm/s</span>":"")};t.toggleCoordinateSystem=function(F){t.prevent(F),r.active.local.showAbsolutePositions=!r.active.local.showAbsolutePositions,L()},t.addExcludeRegion=function(){x?(x.selectRectangle().then(function(F){let W={xmin:Math.min(F.start.x,F.end.x),xmax:Math.max(F.start.x,F.end.x),ymin:Math.min(F.start.y,F.end.y),ymax:Math.max(F.start.y,F.end.y)};W.xmax-W.xmin<=2||W.ymax-W.ymin<=2||i.send("addExcludeRegion",W)}),p.info("Выберите область на сетке печати.","",1e4,!0)):b&&b.toggleExcludeRegion()},t.delExcludeRegion=function(F){i.send("delExcludeRegion",d.excludeRegions[F])},t.$on("excludeRegionsStored",function(){x&&x.updateExcludeRegions()}),t.xMoveTo=function(F){t.$parent.moveToXPos=F,L(),r.active.state.x=F,i.send("move",{x:F,relative:!1})},t.yMoveTo=function(F){t.$parent.moveToYPos=F,L(),r.active.state.y=F,i.send("move",{y:F,relative:!1})},t.zMoveTo=function(F){t.$parent.moveToZPos=F,L(),r.active.state.z=F,i.send("move",{z:F,relative:!1})},t.prevent=function(F,W){F&&(F.stopPropagation(),F.preventDefault()),W&&(t.menuList[W]=!t.menuList[W])},t.toggle2DFullscreen=function(){_.toggleFullscreen($("#container-2d")[0])},t.fitPrinter=function(F){F&&(F.stopPropagation(),F.preventDefault()),x&&x.fitBed()},t.fitObject=function(F){F&&(F.stopPropagation(),F.preventDefault()),x&&I.xmin!==void 0&&x.fitArea(I.xmin,I.ymin,I.xmax,I.ymax,5)},t.menu2d={opt2d:!1,view:!1,info:!1},t.toggle2DMenu=(F,W)=>{F==="opt2d"?t.menu2d.opt2d=!t.menu2d.opt2d:t.menu2d.opt2d=!1,F==="view"?t.menu2d.view=!t.menu2d.view:t.menu2d.view=!1,F==="info"?t.menu2d.info=!t.menu2d.info:t.menu2d.info=!1,F&&W&&W.stopPropagation()},t.$on("$destroy",function(){i.send("hideMoves",{}),D()}),t.$watch("idle",function(){S(f.printPermission&&t.idle)}),w(),n(O,0),t.$on("windowResized",function(){w()}),t.$watch("activeConfig",function(){w()}),t.$watch("active.status.online",function(){w()}),t.$on("move",function(F,W){x&&x.onMove(W.data)}),t.speedChange=function(F){t.active.state.speedMultiply=F,i.send("setSpeedMultiply",{speed:t.active.state.speedMultiply})},t.$on("extruderPos",function(){L()}),t.extrudeDialog=function(F){i.send("send",{cmd:"T"+F+`
G92 E0`}),c.open({templateUrl:"/views/printer/control/printer.control.extrude.php?lang="+lang,scope:t,size:"sm",controller:["$scope",function(W){r.active.state.extruder.length>0&&(W.retractSpeed=r.activeConfig.extruders[F].retractSpeed,W.extrudeSpeed=r.activeConfig.extruders[F].extrudeSpeed),W.extrudeDistance=10}]})},t.$on("connected",function(){i.send("sendMoves",{})});let I={};i.send("sendMoves",{}),L(),r.cmdHistory||(r.cmdHistory=[]),t.cmd="";let k=-1,B=function(F){r.cmdHistory.unshift(F),r.cmdHistory.length>100&&r.cmdHistory.pop(),k=-1};t.sendCmd=function(){B(t.cmd),i.send("send",{cmd:t.cmd}),t.cmd=""},t.walkHistory=function(F){F.key==="ArrowUp"&&k<r.cmdHistory.length-1?(k++,t.cmd=r.cmdHistory[k]):F.key==="ArrowDown"&&k>0&&(k--,t.cmd=r.cmdHistory[k])},t.sendGCode=function(F){B(F),i.send("send",{cmd:F})},t.sendQuickCommand=function(F){B('@quickCommand "'+F+'"'),i.send("sendQuickCommand",{name:F})}}]);RSPrinterModule.controller("PrinterEepromController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","Flash","User","RSPrinter",function(t,e,i,r,n,o,a,l,h,u,c,f,d){r.frontend.setVisible("activeEEPROM",!0);let m=function(){let g=$(this),p=g.val().replace(/\\/g,"/").replace(/.*\//,"");t.uploading=!0,i.extendPing(300),$("#formuploadeeprom").ajaxSubmit({success:function(){t.uploading=!1,i.extendPing(0)},headers:{"X-Csrf-Token":i.getCookie("Csrf-Token")}}),p!==""&&g.val(""),t.$apply()};t.$on("$destroy",function(){r.frontend.setVisible("activeEEPROM",!1)});let v=function(){let g=$("#eepromFilenameUpload");g.length>0?g.on("change",m):setTimeout(v,100)};v(),d.readEEPROM()}]);RSPrinterModule.controller("PrinterKlipperConfigController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","Flash","User","RSPrinter","KlipperDialog","KlipperDialogInputShaping","StringDialog","$uibModal",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p){r.frontend.setVisible("activeKlipperConfig",!0),t.$on("$destroy",function(){r.frontend.setVisible("activeKlipperConfig",!1)}),t.page=0,t.actKlipper="",t.klipperConfig="",t.infoMsg="",t.klipperMenu=!1,t.showInstall=!1,t.configs=[],t.closeKlipperMenu=function(){t.klipperMenu=!1};function _(y){i.send("getKlipperStatus",{}).then(w=>{t.klipper=w,t.actKlipper&&(t.klipper.configs.filter(R=>R===t.actKlipper).length>0||(t.actKlipper="")),t.actKlipper.length===0&&t.klipper.configs.forEach(S=>{S===r.activeSlug&&(t.actKlipper=r.activeSlug)}),t.actKlipper.length===0&&t.klipper.configs.length>0&&(t.actKlipper=t.klipper.configs[0]),y&&b(t.actKlipper)},()=>{})}let x=/^.*-\d{8}_\d{6}$/,b=y=>{let w=!1;t.infoMsg="",y!==""?(t.klipper.installations.forEach(S=>{w|=S===y}),y===r.activeSlug?t.infoMsg="Такова конфигурация этого принтера.":w?t.infoMsg="Это конфигурация другой активной установки klipper":t.actKlipper.match(x)?t.infoMsg="Это резервная копия конфигурации.":t.infoMsg="Это неиспользуемая в настоящее время конфигурация.",i.send("getKlipperConfig",{config:y}).then(S=>{S.ok&&(t.klipperConfig=S.content)},()=>{})):(t.klipperConfig="",t.infoMsg=""),t.showInstall=!w};t.$watch("actKlipper",y=>{b(y)}),t.$on("reloadKlipperConfig",(y,w)=>{_(!0)}),t.goPage=function(y){t.page=y},t.showSampleConfigs=function(){t.closeKlipperMenu(),t.configs.length===0?i.send("getKlipperSampleConfigs",{}).then(y=>{t.configs=y.configs,console.log("configs",t.configs),t.actSample=t.configs[0],t.page=1},()=>{}):t.page=1},t.backupConfig=function(){t.closeKlipperMenu(),p.open({template:`<div class="modal-header">
    <h4 class="modal-title">Настройки резервного копирования Klipper</h4>
</div>
<div class="modal-body">

  <div class="form-group margin-top" >
    <div>
      <div class="checkbox">
        <label>
          <input type="checkbox" ng-model="edit.hideBackups"> Скрыть резервные копии конфигурации
        </label>
      </div>
      <div class="checkbox">
        <label>
          <input type="checkbox" ng-model="edit.delOldConfigBackups"> Удаление старых конфигураций
        </label>
      </div>
      <label>Версия клиппера</label>
      <select class="form-control" ng-model="edit.maxConfigBackups" ng-options="v.n as v.name for v in keepList"></select>
    </div>
    <div class="margin-top">
      <small class="">Будут доступны самые последние резервные копии конфигурации x.</small> 
    </div>
  </div>
    
  <div class="clearfix"></div>
  
</div>
<div class="modal-footer">    
    <button type="button" class="btn btn-default pull-left" ng-click="close()"><i class="fa fa-times rs-bigtab"></i> Закрыть</button>
  </div>
`,controller:["$scope","$rootScope","$uibModalInstance","RSCom","$timeout","User",function(y,w,S,R,E,T){y.keepList=[{n:0,name:"Отсутствие резервных копий"},{n:1,name:"1"},{n:2,name:"2"},{n:3,name:"3"},{n:4,name:"4"},{n:5,name:"5"},{n:6,name:"6"},{n:7,name:"7"},{n:8,name:"8"},{n:9,name:"9"},{n:10,name:"10"}],y.edit=Object.assign({},{maxConfigBackups:5,delOldConfigBackups:!1,hideBackups:!1},w.activeConfig.properties.klipperBackups),y.close=function(){R.send("setPrinterSetting",{key:"klipperBackups",value:y.edit},w.activeSlug).then(()=>{_(!0)},()=>{}),S.close()}}],size:"lg",backdrop:"static"})},t.startInputShaping=function(){t.closeKlipperMenu(),v(t.actKlipper,!1,t.klipper.inputShapingInstalled).then(()=>{_(!0)})},t.installInputShaping=function(){t.closeKlipperMenu(),m("installInputShaping",t.actKlipper).then(()=>{_(!0)})},t.showInputShapingResults=function(){t.closeKlipperMenu(),v(t.actKlipper,!0).then(()=>{_(!1)})},t.installKlipper=function(){t.closeKlipperMenu(),m("install",t.actKlipper).then(()=>{_(!0)})},t.getKlipperLog=function(){t.closeKlipperMenu(),m("getKlipperLog",t.actKlipper).then(()=>{_(!0)})},t.updateKlipper=function(){t.closeKlipperMenu(),m("update",t.actKlipper).then(()=>{_(!0)})},t.uninstallKlipper=function(){t.closeKlipperMenu(),l("Контрольный вопрос","Действительно удалить этот экземпляр Клиппера?","Да","Нет",!0).then(function(){m("uninstall",t.actKlipper).then(()=>{_(!1)})})},t.restartKlipper=function(){t.closeKlipperMenu(),i.send("klipperAction",{action:"restart",config:[t.actKlipper]})},t.createFirmware=function(){t.closeKlipperMenu(),m("createFirmware",t.actKlipper).then(()=>{_(!1)})},t.saveAs=function(y=!1){t.closeKlipperMenu(),g("Создай новую конфигурацию Клиппера","Сохрани конфигурацию с новым именем. Обрати внимание, что тебе нужно установить экземпляр klipper, если это делается для нового принтера. Автоматически используются только экземпляры klipper с slug-именем твоего принтера.","","Сохранить").then(w=>{console.log("input",w),t.klipper.configs.includes(w)?c.error("","Конфигурация с таким именем уже существует!",1e4,!0):i.send("setKlipperConfig",{createNew:y,content:y?"":t.klipperConfig,config:w}).then(S=>{S.ok&&(t.klipper.configs.push(w),t.actKlipper=w,c.success("","Конфигурация сохранена",2e3))})})},t.deleteConfig=function(){t.closeKlipperMenu(),l("Контрольный вопрос","Действительно удалить эту конфигурацию?","Да","Нет",!0).then(function(){i.send("klipperAction",{action:"deleteConfig",config:[t.actKlipper]}).then(y=>{y.ok&&(t.actKlipper="",t.klipperConfig="",i.send("sendEvent",{event:"reloadKlipperConfig"}),c.success("","Конфигурация удалена",2e3))})},function(){})},t.saveConfig=function(){t.closeKlipperMenu(),t.actKlipper!==""&&i.send("setKlipperConfig",{config:t.actKlipper,content:t.klipperConfig}).then(y=>{y.ok&&(c.success("","Конфигурация сохранена",2e3),t.actKlipper!==r.activeSlug||t.showInstall||!t.klipper.supportsRestart||i.send("send",{cmd:"FIRMWARE_RESTART"}))},()=>{})},t.downloadFirmware=function(){t.klipper.createdFirmware?window.open("/printer/klipperfw/"+r.activeSlug+"?a=download","ihelper"):c.error("Cannot download Firmware. Must create first!")},_(!0)}]);function uc(t){let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},i=/[&<>"'/]/ig;return t.replace(i,r=>e[r])}function Ci(t,e,i,r){let n='<span class="'+i+'">'+(r===void 0?e:r)+"</span>",o="",a="",l="",h="",u=0,c=function(){return u===3||u===4?'<span class="v">'+uc(h)+"</span>":u===2?'<span class="p">'+uc(l)+"</span>":u===0?'<span class="cmd">'+uc(o)+"</span>":""};if(t.length>1&&(t[0]==="@"||t[1]==="@"))return n+'<span class="server">'+uc(t)+"</span>";for(let f=0;f<t.length;f++){let d=t[f];if(u===1){a+=d;continue}if(d===";"&&(n+=c(),u=1,a=";"),u===4){h+=d;continue}if(u===0){o+=d,d===" "&&(u=2,n+='<span class="cmd">'+uc(o)+"</span>",(d==="M117 "||d==="M118 "||d==="M23 "||d==="M28 "||d==="M29 "||d==="M30 "||d==="M32 ")&&(u=4,l=""));continue}if(u===2&&(l+=d,d>="A"&&d<="Z"||d>="a"&&d<="z")){n+=c(),u=3,h="";continue}u===3&&(h+=d,d===" "&&(n+=c(),u=2,l=""))}return a.length>0&&(a='<span class="comment">'+uc(a)+"</span>"),n+c()+a}RSPrinterModule.controller("PrinterRecoverController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","P","Flash","User","RSPrinter","$state",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m){let v=!1;r.frontend.setVisible("activeRecover",!0),t.$on("$destroy",function(){r.frontend.setVisible("activeRecover",!1)});let g=r.active.recover,p=function(){g=r.active.recover,g.state===3?t.reason="Соединение с принтером потерянно":g.state===4?t.reason="Принтер выключен":g.state===2?t.reason="Неизвестная причина":g.state===-1&&!v?n(p,20):g.state===0&&m.go("printer.print"),t.startPos=g.lastACKPos};n(p,20);let _=function(){g=r.active.recover,g.lastExecKnown&&(t.startPos=g.lastExecPos);let b=0,y=[];angular.forEach(g.lines,function(w,S){t.startPos===w.p?(S&1)===1?y[S]='<div class="odd" id="marked_line">'+Ci(w.g,b++,"line_add",w.p)+"</div>":y[S]='<div id="marked_line">'+Ci(w.g,b++,"line_add",w.p)+"</div>":(S&1)===1?y[S]='<div class="odd">'+Ci(w.g,b++,"line",w.p)+"</div>":y[S]="<div>"+Ci(w.g,b++,"line",w.p)+"</div>"}),setTimeout(function(){$("#layercode").html(y.join(""));let w=document.getElementById("marked_line"),S=document.getElementById("layercode");S&&w&&(S.scrollTop=w.offsetTop-(S.offsetHeight-w.offsetHeight)*.5)},1)};_(),t.setStartPos=function(b){if(b.originalEvent.target?!b.originalEvent.target.className.startsWith("line"):!b.originalEvent.srcElement.className.startsWith("line"))return;let y=b.originalEvent.target?b.originalEvent.target.innerText:b.originalEvent.srcElement.innerText;console.log("select pos",y),t.startPos=y,_()},t.setStartPosDirectly=function(b){t.startPos=b,_()},t.startRecover=function(){r.active.recover.lastExecKnown&&(t.startPos=r.active.recover.lastExecPos),i.send("startRecover",{pos:t.startPos}).then(function(){m.go("printer.print")})},t.sendRecoverConnect=function(){i.send("sendRecoverConnect",{})},t.stopRecover=function(){l("Требуется подтверждение","Действительно отменить прерванную печать?","Да","Нет",!0).then(function(){i.send("cancelRecover",{}).then(function(){m.go("printer.print")})})};let x=r.$on("recoverChanged",function(b,y){y.printer===r.activeSlug&&y.data.state!==2&&y.data.state!==3&&y.data.state!==3&&m.go("printer.print"),y.printer===r.activeSlug&&_()});t.$on("$destroy",function(){v=!0,x()})}]);var gh=Qi(ta());var hl=class{constructor(e){this.options=e,this.loadingFullData=!1,this.id=0}assignModel(e,i){this.slug=e,this.id=i,this.source="model",this.info=null,this.layerData=null,this.layerInfo=null,this.layerInfoPromise=new Promise((r,n)=>{this.layerInfoResolve=r,this.layerInfoReject=n})}assignProject(e,i,r){this.serverid=e,this.projectid=i,this.id=r,this.source="project",this.info=null,this.layerData=null,this.layerInfo=null,this.layerInfoPromise=new Promise((n,o)=>{this.layerInfoResolve=n,this.layerInfoReject=o})}guess3dMemory(){let e=this.layerInfo.segments;return e?23*(e.countRetractions+e.countUnretractions+e.countSeams)+8*e.travelMoves+12*(e.travelSegments+e.travelMoves)+39*(e.extrusionMovesRegular+e.extrusionMovesSharp):0}async loadInfo(){if(await this.options.user.sessionStarted(),this.id===0){this.layerInfoResolve(this);return}if(this.source==="model"){let e=await gh.default.get("/printer/layeranalysis/"+this.slug+"?id="+this.id);this.layerInfo=e.data,this.totalLayer=this.layerInfo.layers.length-1,this.totalDuration=this.layerInfo.layers[this.totalLayer].t,this.totalHeight=this.layerInfo.layers[this.totalLayer].h,this.totalLines=this.layerInfo.layers[this.totalLayer].l,this.layerInfo.layers[this.layerInfo.layers.length-1].p<100*1024*1024?(await this.loadData(),this.layerInfoResolve(this)):this.layerInfoResolve(this)}else if(this.source==="project"){let e=await gh.default.get(`/project/${this.serverid}/layeranalysis/${this.projectid}?id=`+encodeURIComponent(this.id));this.layerInfo=e.data,this.totalLayer=this.layerInfo.layers.length-1,this.totalDuration=this.layerInfo.layers[this.totalLayer].t,this.totalHeight=this.layerInfo.layers[this.totalLayer].h,this.totalLines=this.layerInfo.layers[this.totalLayer].l,this.layerInfo.layers[this.layerInfo.layers.length-1].p<100*1024*1024?(await this.loadData(),this.layerInfoResolve(this)):this.layerInfoResolve(this)}else{let e=await gh.default.get("/printer/layeranalysis_job/"+this.slug+"?id="+this.id);this.layerInfo=e.data,this.totalLayer=this.layerInfo.layers.length-1,this.totalDuration=this.layerInfo.layers[this.totalLayer].t,this.totalHeight=this.layerInfo.layers[this.totalLayer].h,this.totalLines=this.layerInfo.layers[this.totalLayer].l}}async loadData(){if(!(this.layerData||this.loadingFullData))if(this.loadingFullData=!0,await this.options.user.sessionStarted(),this.source==="model"){let e=await gh.default.get("/printer/layer_model_bin/"+this.slug+"?id="+this.id,{responseType:"arraybuffer"});this.layerData=e.data,this.reader=new DataView(this.layerData),this.readerPos=0,this.readerMaxPos=this.reader.byteLength}else if(this.source==="project"){let e=await gh.default.get(`/project/${this.serverid}/layer_bin/${this.projectid}?id=`+encodeURIComponent(this.id),{responseType:"arraybuffer"});this.layerData=e.data,this.reader=new DataView(this.layerData),this.readerPos=0,this.readerMaxPos=this.reader.byteLength}else{let e=await gh.default.get("/printer/layer_job_bin/"+this.slug+"?id="+this.id,{responseType:"arraybuffer"});this.layerData=e.data,this.reader=new DataView(this.layerData),this.readerPos=0,this.readerMaxPos=this.reader.byteLength}}readInt(){let e=this.reader.getInt32(this.readerPos,!0);return this.readerPos+=4,e}readFloat(){let e=this.reader.getFloat32(this.readerPos,!0);return this.readerPos+=4,e}readBlockObj(){let e=this.readInt(),i=e>>24,r=e&16777215,n=r/4,o=this.readerPos+r,a={t:i};switch(i){case 1:a.e=this.readInt(),a.s=this.readFloat(),a.w=this.readFloat(),a.x=this.readFloat(),a.y=this.readFloat();break;case 2:a.m=[],n/=2;for(let l=0;l<n;++l)a.m.push({x:this.readFloat(),y:this.readFloat()});break;case 3:a.m=[],n/=2;for(let l=0;l<n;++l)a.m.push({x:this.readFloat(),y:this.readFloat()});break;case 4:break;case 5:break;case 6:a.s=this.readFloat();break;case 7:a.e=this.readInt();break;case 8:a.w=this.readFloat();break;case 9:a.e=this.readInt(),a.color="#"+this.readInt().toString(16).padStart(6,"0");break;case 10:a.ft=this.readInt();break;case 11:a.w=this.readFloat(),a.h=this.readFloat();break;case 12:a.x=this.readFloat(),a.y=this.readFloat(),a.z=this.readFloat();break}return this.readerPos=o,a}fetchLayer(e){let i=this.layerInfo.layers[e-1],r=this.layerInfo.layers[e];if(r.p>this.reader.byteLength)return[];if(!i)return console.log("no previous layer",e),[];this.readerPos=i.p;let n=[];for(;this.readerPos<r.p;)n.push(this.readBlockObj());return n}};RSPrinterModule.controller("PrinterPreviewController",["$scope","$stateParams","$rootScope","$http","User","RSCom","$uibModal","$timeout","Fullscreen","Confirm","Flash",function(t,e,i,r,n,o,a,l,h,u,c){let f=new hl({user:n}),d=!1;t.featureNameMap=Vs,t.dummy=7,t.analyser=f,t.menuList={opt3d:!1},t.closeMenu=function(P){t.menuList[P]=!1},t.prevent=function(P,L){P&&(P.stopPropagation(),P.preventDefault()),L&&(t.menuList[L]=!t.menuList[L])},f.assignModel(e.slug,parseInt(e.model));let m=f.loadInfo(),v=null,g=["#005B73","#FC00FF","#59BDBE","#D0A766","#66c231","#005B73","#FC00FF","#59BDBE","#D0A766","#66c231","#005B73","#FC00FF","#59BDBE","#D0A766","#66c231","#005B73"],p=null;t.gcodeChanged=!1,t.activeLayer=-1,t.editLayer=1,t.zoom2d=100;let _={},x=null,b=-1,y=0;t.percentSlider={percent:100,options:{floor:0,ceil:100,step:.01,precision:2,enforceStep:!1,hideLimitLabels:!0,onlyBindHandles:!0,showTicks:10,translate:function(P){return P.toFixed(0)}}},t.layerSlider={value:1,options:{floor:1,ceil:1,step:1,precision:0,enforceStep:!0,showTicks:100,hideLimitLabels:!0,onlyBindHandles:!0,vertical:!0,translate:function(P){return P.toFixed(0)}}},t.previewOptions={showPrint:!0,showTravel:!0,showRetract:!0,showGcode:e.tab.length===0?0:parseInt(e.tab),extrusionWidth:.4,showExtruder:!1,show:0},t.previewOptions=Wt(Wt({},t.previewOptions),JSON.parse(n.getSetting("preview2dOptions",JSON.stringify(t.previewOptions)))),e.tab.length&&(t.previewOptions.showGcode=parseInt(e.tab)),t.$parent.previewData=e.model,t.exlist=[],t.model={},t.show3dLegend=document.body.clientWidth>500,t.show2dLegend=!0,t.featureHeadline="Экструдер",t.features=[],t.roundFeatures=[{name:"Откат нити",color:"#C9302C"},{name:"Прогрессивная нить",color:"#0000ff"}],t.updateLegend=({headline:P,features:L,roundFeatures:I})=>{t.featureHeadline=P,t.features=L,t.roundFeatures=I},t.toggle2DLegend=function(){t.show2dLegend=!t.show2dLegend},t.menu2d={opt2d:!1,view:!1,info:!1},t.toggle2DMenu=(P,L)=>{P==="opt2d"?t.menu2d.opt2d=!t.menu2d.opt2d:t.menu2d.opt2d=!1,P==="view"?t.menu2d.view=!t.menu2d.view:t.menu2d.view=!1,P==="info"?t.menu2d.info=!t.menu2d.info:t.menu2d.info=!1,P&&L&&L.stopPropagation()},t.saveDefault2dView=()=>{n.setSetting("preview2dOptions",JSON.stringify(t.previewOptions))},t.toggle2DFullscreen=function(){h.toggleFullscreen($("#container-2d")[0])},t.setPreview=function(P){p=P,P&&(p.zoomEnabled=!0,p.adjustPosZoom(),t.fitObject(),p.drawPreviewLayer(x,t.percentSlider.percent),t.refreshSlider())},t.height2d="70vh",t.heightGCode="70vh";let w=P=>{P===void 0&&(P=10),t.previewOptions.showGcode===0&&(window.innerHeight>500?l(()=>{let L=$("#container-2d");if(L.length){let I=L[0].getBoundingClientRect();t.height2d=Math.max(window.innerHeight-I.top-1,300).toFixed(0)+"px",window.scrollY=0}else P>0&&l(()=>{w(P-1)},50)},10):t.height2d="70vh"),t.previewOptions.showGcode===1&&(window.innerHeight>500?l(()=>{let L=$("#layercode");if(L.length){let I=L[0].getBoundingClientRect();t.heightGCode=Math.max(300,window.innerHeight-I.top-12).toFixed(0)+"px",window.scrollY=0}else P>0&&l(()=>{w(P-1)},50)},10):t.heightGCode="70vh")};t.$on("windowResized",()=>{w()}),t.imgurl=function(){return i.hasFeature(1)?"/dyn/render_image?q=models&id="+e.model+"&slug="+t.activeSlug+"&t=l":"/img/pro_l.png"};let S=0,R=0,E=function(P){if(P===t.activeLayer)return;let L=f.layerInfo.layers[P-1],I=f.layerInfo.layers[P];if(f.layerData)t.editLayer=t.activeLayer=P,t.durationElapsed=L.t,t.durationRemaining=f.layerInfo.layers[f.layerInfo.layers.length-1].t-I.t,t.duration=I.t-L.t,t.startTime=L.t,t.height=I.h,t.lineCount=I.l-L.l,x=f.fetchLayer(P),p&&p.drawPreviewLayer(x,t.percentSlider.percent);else{let k=++S;r.get("/printer/layer/"+i.activeSlug+"?id="+e.model+"&start="+L.p+"&end="+I.p).then(function(B){k<R||(R=k,t.editLayer=t.activeLayer=P,t.durationElapsed=L.t,t.durationRemaining=f.layerInfo.layers[f.layerInfo.layers.length-1].t-I.t,t.duration=I.t-L.t,t.startTime=L.t,t.height=I.h,t.lineCount=I.l-L.l,x=B.data,p&&p.drawPreviewLayer(x,t.percentSlider.percent))},function(){})}t.previewOptions.showGcode&&D(P)};t.update2dView=()=>{p&&p.drawPreviewLayer(x,t.percentSlider.percent)},t.percentSlider.options.onChange=()=>{p&&i.$applyAsync(()=>{p.drawPreviewLayer(x,t.percentSlider.percent)})};function T(){t.layerSlider.options.ceil=f.totalLayer,angular.forEach(i.activeConfig.extruders,function(P,L){t.exlist.push({col:g[L%g.length],name:"Печатающий экструдер @".replace("@",L+1)})}),E(1)}t.$on("gcodeInfoUpdated",function(P,L){L.data.modelId===e.model&&r.get("/printer/layeranalysis/"+e.slug+"?id="+e.model).then(function(I){setLayerdata(I.data)},function(){})});let A=[],C=0,M=function(){let P=C,L=[];angular.forEach(A,function(I,k){let B=_[""+(k+C)];if(B){let F=B.r.split(`
`);L[k]="",angular.forEach(F,function(W){W=W.trim(),W.length!==0&&((k&1)===1?L[k]+='<div class="odd">'+Ci(W,P,"line_add")+"</div>":L[k]+="<div>"+Ci(W,P,"line_add")+"</div>")}),B.d?(k&1)===1?L[k]+='<div class="odd" style="text-decoration: line-through;">'+Ci(I,P++,"line_del")+"</div>":L[k]+='<div style="text-decoration: line-through;">'+Ci(I,P++,"line_del")+"</div>":(k&1)===1?L[k]+='<div class="odd">'+Ci(I,P++,"line")+"</div>":L[k]+="<div>"+Ci(I,P++,"line")+"</div>"}else(k&1)===1?L[k]='<div class="odd">'+Ci(I,P++,"line")+"</div>":L[k]="<div>"+Ci(I,P++,"line")+"</div>"}),$("#layercode").html(L.join(""))},D=function(P){if(b===P||P<1||P>f.totalLayer)return;++y;let L=y,I=f.layerInfo.layers[P-1],k=f.layerInfo.layers[P];r.get("/printer/gcode/"+i.activeSlug+"?id="+e.model+"&start="+I.g+"&end="+k.g).then(function(B){L<y||(y=L,b=P,A=B.data.substring(0,B.data.length-1).split(`
`),C=I.l,M())},function(){})};t.download=function(){window.open("/printer/model/"+i.activeSlug+"?a=download&id="+e.model,"ihelper")},t.$watchCollection("previewOptions",function(P,L){P.showGcode!==L.showGcode&&t.toggle2DMenu(""),t.previewOptions.showGcode===1&&D(t.activeLayer),t.refreshSlider(),w()}),t.fitPrinter=function(){p&&p.fitBed()},t.fitObject=function(){p&&p.fitArea(f.layerInfo.xmin,f.layerInfo.ymin,f.layerInfo.xmax,f.layerInfo.ymax,2)},t.nextLayer=function(){t.activeLayer<f.totalLayer&&E(t.activeLayer+1)},t.prevLayer=function(){t.activeLayer>1&&E(t.activeLayer-1)},t.layerChanged=function(){t.editLayer=parseInt(t.editLayer),t.editLayer<1&&(t.editLayer=1),t.editLayer>f.totalLayer&&(t.editLayer=f.totalLayer),E(t.editLayer)},t.layerSlider.options.onChange=()=>{t.layerChanged()},t.editLine=function(P){if(!i.user.canAddFiles||(P.originalEvent.target?!P.originalEvent.target.className.startsWith("line"):!P.originalEvent.srcElement.className.startsWith("line")))return;let L=P.originalEvent.target?P.originalEvent.target.innerText:P.originalEvent.srcElement.innerText;a.open({templateUrl:"/views/printer/control/printer.editgcode.dialog.php?lang="+lang,scope:t,size:"lg",controller:["$scope",function(I){I.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},I.edit=angular.copy(_[L]),I.edit||(I.edit={d:!1,r:""}),I.addOrig=function(){I.edit.r=(I.edit.r.trim()+`
`+I.orig).trim()+`
`,I.edit.d=!0},I.addPause=function(){I.edit.r=(I.edit.r.trim()+`
@pause Do your stuff`).trim()+`
`},I.line=L,I.orig=A[parseInt(L)-C],I.$on("modal.closing",function(){I.edit.r=I.edit.r.trim(),I.edit.d||I.edit.r.length>0?(!_[L]||angular.toJson(_[L])!==angular.toJson(I.edit))&&(_[L]=I.edit,t.gcodeChanged=!0,M()):_[L]&&(delete _[L],t.gcodeChanged=!0,M())})}]}).result.catch(function(I){})},t.refreshSlider=function(){l(function(){t.$broadcast("rzSliderForceRender")})},t.saveGCode=function(){t.model.gcodePatch=angular.toJson(_),o.send("setModelInfo",t.model).then(function(){t.gcodeChanged=!1})},t.printGCode=function(P,L){if(!L&&!i.activeConfig.general.enableQueue){c.error("Очередь отключена");return}if(i.active.state.condition!==1&&(L=!1),P.fits)t.preparePrint=!0,o.send("copyModel",{id:P.id,autostart:L}).then(function(){t.preparePrint=!1}),L?c.success("Начало печати."):c.success("Печать скопирована в очередь печати.");else{let I=i.activeConfig.shape.basicShape,k=i.activeConfig.movement,B=`<table class="table table-bordered table-hover"><tr><th>Параметр</th><th>Печать</th><th>Принтер</th></tr>`;I.shape==="circle"?B+=`<tr class="${P.radius>I.radius?"bg-danger":""}"><td>Радиус печатный</td><td>${P.radius}</td><td>${I.radius}</td></tr>`:(B+=`<tr class="${P.xMin<I.xMin||P.xMax>I.xMax?"bg-danger":""}"><td>Печать X</td><td>${P.xMin.toFixed(2)}..${P.xMax.toFixed(2)}</td><td>${I.xMin.toFixed(2)}..${I.xMax.toFixed(2)}</td></tr>`,B+=`<tr class="${P.yMin<I.yMin||P.yMax>I.yMax?"bg-danger":""}"><td>Печать Y</td><td>${P.yMin.toFixed(2)}..${P.yMax.toFixed(2)}</td><td>${I.yMin.toFixed(2)}..${I.yMax.toFixed(2)}</td></tr>`),I.shape!=="zbelt"&&(B+=`<tr class="${P.zMin<k.zMin||P.zMax>k.zMax?"bg-danger":""}"><td>Печать Z</td><td>${P.zMin.toFixed(2)}..${P.zMax.toFixed(2)}</td><td>${k.zMin.toFixed(2)}..${k.zMax.toFixed(2)}</td></tr>`),B+=`<tr class="${P.xMinMove<k.xMin||P.xMaxMove>k.xMax?"bg-danger":""}"><td>Перемещение X</td><td>${P.xMinMove.toFixed(2)}..${P.xMaxMove.toFixed(2)}</td><td>${k.xMin.toFixed(2)}..${k.xMax.toFixed(2)}</td></tr>`,B+=`<tr class="${P.yMinMove<k.yMin||P.yMaxMove>k.yMax?"bg-danger":""}"><td>Перемещение Y</td><td>${P.yMinMove.toFixed(2)}..${P.yMaxMove.toFixed(2)}</td><td>${k.yMin.toFixed(2)}..${k.yMax.toFixed(2)}</td></tr>`,B+="</table>",u("Контрольный вопрос","Внимание! В соответствии с заданными вами значениями печатного стола эта модель не будет помещаться внутри вашего принтера. Печатать в любом случае?",null,null,null,B).then(function(){t.preparePrint=!0,o.send("copyModel",{id:P.id,autostart:L}).then(function(F){t.preparePrint=!1,F.ok?L?c.success("Начало печати."):c.success("Печать скопирована в очередь печати."):c.error(F.error)})})}},t.$on("$destroy",function(){d=!0,t.$parent.previewData=0});let O=o.send("modelInfo",{id:parseInt(e.model)}).then(function(P){t.model=P,_=angular.fromJson(t.model.gcodePatch)});Promise.all([O,m]).then(()=>{T()}),w()}]);var iT=Qi(uz());RSPrinterModule.controller("PrinterGCodesController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$http","Confirm","RSOverview","$state","P","$uibModal","Flash","GSettings","$filter","User","RSPrinter","StringDialog","WaitSelectorAppear","GoogleDrive","RSDropbox","RSBrowseFolder","SelectProject",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p,_,x,b,y,w){let S=function(){t.delAnimation=!1},R=function(){E.sortModelsBy=r.globals.gcodeView.sortBy,E.modelFilter=r.globals.gcodeView.filter,E.activeGroup=r.globals.gcodeView.group,g.sortModelsFor(r.activeSlug)};t.activeQueue=!1,t.uploading=!1,t.preparePrint=!1,t.delAnimation=!1,t.groups=[],t.dbox=b,t.selectSFile=!1,t.bfolder=y,t.in={openUrl:""},t.disk={},t.menuDirect=!1,t.menuReprint=!1,t.menuUpload=!1,t.menuAction=!1,t.menuModel={},t.uploadProgress=0,t.recentPrints=[],t.recentPrintsGroup="#",t.toggleAutostartZbelt=function(){g.setAutostartNextPrint(r.active.state.autostartNextPrint)},t.closeDirect=function(){t.menuDirect=!1},t.closeUpload=function(){t.menuUpload=!1},t.closeReprint=function(){t.menuReprint=!1},t.closeAction=function(){t.menuAction=!1},t.closeModel=function(O){t.menuModel[O]=!1},t.downloadGCode=function(O){t.menuModel[O]=!1,window.open("/printer/model/"+r.activeSlug+"?a=download&id="+O,"ihelper")};let E=g.local();E===void 0&&h.go("home"),t.$on("$destroy",function(){window.handleUpload&&delete window.handleUpload,window.quickuploadHandler&&delete window.quickuploadHandler}),r.globals||(r.globals={});let T=()=>{i.send("listLastPrints",{}).then(O=>{t.recentPrints=O.prints})};t.$on("lastPrintsChanged",()=>{T()}),T(),t.printRecent=O=>{i.send("lastPrintAction",{action:"print",file:O.name}).then(P=>{P.ok&&f.success("Начало печати")}),t.menuReprint=!1},t.queueRecent=O=>{i.send("lastPrintAction",{action:"queue",file:O.name}).then(P=>{P.ok&&f.success("G-код в очереди")}),t.menuReprint=!1},t.copyRecent=O=>{i.send("lastPrintAction",{action:"copy",file:O.name,group:t.recentPrintsGroup}).then(P=>{P.ok&&f.success("Копирование G-кода")}),t.menuReprint=!1},t.deleteRecent=O=>{i.send("lastPrintAction",{action:"delete",file:O.name}).then(P=>{P.ok&&f.success("G-код удален")}),t.menuReprint=!1};let A=angular.fromJson(v.getSetting("gcodeGroup","{}"));r.globals.gcodeView||(r.globals.gcodeView={sortBy:parseInt(v.getSetting("gcodeSortBy","0")),viewMode:parseInt(v.getSetting("gcodeViewMode","0")),filter:"",page:1,perPage:20}),r.globals.gcodeView.group=A[t.activeSlug]?A[t.activeSlug]:"#",E.sortModelsBy=r.globals.gcodeView.sortBy,E.modelFilter=r.globals.gcodeView.filter,E.activeGroup=r.globals.gcodeView.group;let C=function(){i.send("listModelGroups",{}).then(function(O){let P=r.globals.gcodeView.group==="*";t.groups=[{id:"*",name:"Группа: все"}],angular.forEach(O.groupNames,function(L){P=P||L===r.globals.gcodeView.group,L==="#"?t.groups.push({id:"#",name:"Группа: по умолчанию"}):t.groups.push({id:L,name:"Группа: "+L})}),P||(r.globals.gcodeView.group="#",t.selectGroup()),t.groupsel=angular.copy(t.groups),t.groupsel.splice(0,1)})};C(),t.$on("modelGroupListChanged",function(){C()}),t.addGroup=function(){p("Создать группу","Имя группы (мин. 2 симв.)","").then(function(O){i.send("addModelGroup",{groupName:O}).then(function(P){P.ok===!0&&(r.globals.gcodeView.group=O,t.selectGroup())})},function(){})},t.renameGroup=function(){p("Переименовать группу","Имя группы (мин. 2 симв.)",r.globals.gcodeView.group).then(function(O){if(O.length<2){f.error("Имя группы слишком короткое.");return}i.send("renameModelGroup",{oldGroupName:r.globals.gcodeView.group,newGroupName:O}).then(function(P){P.ok===!0&&(r.globals.gcodeView.group=O,t.selectGroup())},function(){})},function(){})},t.delFilesInGroup=function(){a("Контрольный вопрос","Вы действительно хотите удалить все файлы в этой группе?").then(function(){t.delAnimation=!0;let O=0;n(function(){let P=angular.copy(t.active.models);angular.forEach(P,function(L){i.send("removeModel",{id:L.id}).then(function(){O++,O===P.length&&n(S,500),t.checkDisk()})})},50)},function(){})},t.delGroup=function(){if(!(r.globals.gcodeView.group==="#"||r.globals.gcodeView.group==="*")){if(t.active.models.length===0){i.send("delModelGroup",{groupName:r.globals.gcodeView.group,delFiles:!1}).then(function(){r.globals.gcodeView.group="#",t.selectGroup(),t.checkDisk()});return}c.open({templateUrl:"/views/printer/control/printer.print.delgroup.html?lang="+lang,size:"sm",controller:["$scope",function(O){O.infoText="Really delete group $1?".replace("$1",r.globals.gcodeView.group),O.delFiles=!1,O.confirmYes=function(){i.send("delModelGroup",{groupName:r.globals.gcodeView.group,delFiles:O.delFiles}).then(function(){r.globals.gcodeView.group="#",t.selectGroup(),O.$close()},function(){})}}]})}},t.selectGroup=function(){r.globals.gcodeView.page=1,A[t.activeSlug]!==r.globals.gcodeView.group&&(A[t.activeSlug]=r.globals.gcodeView.group,v.setSetting("gcodeGroup",angular.toJson(A))),R(r.globals.gcodeView.sortBy)},t.updateViewMode=function(){v.setSetting("gcodeViewMode",r.globals.gcodeView.viewMode.toString())},t.sortIcon=function(O){let P=O&254;return P===(r.globals.gcodeView.sortBy&254)?P===r.globals.gcodeView.sortBy?"fa-sort-asc":"fa-sort-desc":"fa-unsorted"},t.SortBy=function(O){let P=r.globals.gcodeView.sortBy,L=r.globals.gcodeView.sortBy&1,I=O&254;I===(r.globals.gcodeView.sortBy&254)?r.globals.gcodeView.sortBy=I+(1-L):r.globals.gcodeView.sortBy=O,P!==r.globals.gcodeView.sortBy&&v.setSetting("gcodeSortBy",r.globals.gcodeView.sortBy.toString()),R()},t.selectQueue=function(O,P){let L=P.target;t.activeQueue=O,$(L).tooltip({title:`<div style="width:200px;text-align:left"><h4>Информация о задании</h4>Время печати: `+m("hms")(O.printTime)+"<br>Extrusion: "+Math.ceil(O.filamentTotal)+" mm</div>",html:!0,placement:"right",trigger:"hover click"})},t.dequeQueue=function(O){i.send("removeJob",{id:O.id}).then(function(){t.activeQueue=!1})};let M=!0,D;t.queueOrderMoved=O=>{t.queueNotActive().splice(O,1)},t.onQueueDragStart=function(O){M=!1},t.onQueueDragEnd=function(O){let P=[];r.active.status.jobid&&P.push(r.active.status.jobid),P.push(...t.queueNotActive().map(L=>L.id)),M=!0,i.send("reorderJobs",{jobs:P}).then(function(){g.fetchPrintqueueFor(r.activeSlug)})},t.queueActive=function(){let O=r.active.status.jobid;return r.active.queue.filter(P=>P.id===O)},t.queueNotActive=function(){if(!M&&D)return D;let O=r.active.status.jobid,P=r.active.queue.filter(I=>I.id!==O),L=!D||D.length!==P.length;if(!L)for(let I=0;I<D.length;I++)L|=D[I]!==P[I];return L&&(D=P),D},t.printQueue=function(O){t.preparePrint=!0,i.send("startJob",{id:O.id}).then(function(){t.preparePrint=!1})},t.setQueueRepeat=function(O,P){P=P<1?1:P,i.send("setRepeatJob",{id:O.id,repeat:P}).then(function(){g.fetchPrintqueueFor(r.activeSlug),O.repeat=P})},t.$on("jobFinished",()=>{g.fetchPrintqueueFor(r.activeSlug)}),t.uploadGCode=function(){c.open({templateUrl:"/views/printer/dialog/uploadGCode.php?lang="+lang,controller:["$scope","$uibModalInstance","Flash",function(O,P,L){O.uploadGCode=function(I){$("#formuploadgcode").ajaxSubmit({success:function(){P.close();let k=typeof I=="object"?I:JSON.parse(I);k.error===void 0?L.success("Загрузка завершена"):L.error("Сбой при загрузке: "+k.error)},headers:{"X-Csrf-Token":i.getCookie("Csrf-Token")}})},O.close=function(){P.dismiss()},O.noFile=function(){return $("#gcodeFilenameUpload").val().length===0}}]})},t.preparing=!1,t.$on("prepareJob",function(O,P){P.printer===r.activeSlug&&(t.preparing=!0)}),t.$on("prepareJobFinished",function(O,P){P.printer===r.activeSlug&&(t.preparing=!1)}),t.printGCode=function(O,P){if(!P&&!r.activeConfig.general.enableQueue){f.error("Queue is disabled");return}if(r.active.state.condition!==1&&(P=!1),O.fits)t.preparePrint=!0,i.send("copyModel",{id:O.id,autostart:P}).then(function(){t.preparePrint=!1});else{let L=r.activeConfig.shape.basicShape,I=r.activeConfig.movement,k=`<table class="table table-bordered table-hover"><tr><th>Параметр</th><th>Печать</th><th>Принтер</th></tr>`;L.shape==="circle"?k+=`<tr class="${O.radius>L.radius?"bg-danger":""}"><td>Радиус печатный</td><td>${O.radius}</td><td>${L.radius}</td></tr>`:(k+=`<tr class="${O.xMin<L.xMin||O.xMax>L.xMax?"bg-danger":""}"><td>Печать X</td><td>${O.xMin.toFixed(2)}..${O.xMax.toFixed(2)}</td><td>${L.xMin.toFixed(2)}..${L.xMax.toFixed(2)}</td></tr>`,k+=`<tr class="${O.yMin<L.yMin||O.yMax>L.yMax?"bg-danger":""}"><td>Печать Y</td><td>${O.yMin.toFixed(2)}..${O.yMax.toFixed(2)}</td><td>${L.yMin.toFixed(2)}..${L.yMax.toFixed(2)}</td></tr>`),L.shape!=="zbelt"&&(k+=`<tr class="${O.zMin<I.zMin||O.zMax>I.zMax?"bg-danger":""}"><td>Печать Z</td><td>${O.zMin.toFixed(2)}..${O.zMax.toFixed(2)}</td><td>${I.zMin.toFixed(2)}..${I.zMax.toFixed(2)}</td></tr>`),k+=`<tr class="${O.xMinMove<I.xMin||O.xMaxMove>I.xMax?"bg-danger":""}"><td>Перемещение X</td><td>${O.xMinMove.toFixed(2)}..${O.xMaxMove.toFixed(2)}</td><td>${I.xMin.toFixed(2)}..${I.xMax.toFixed(2)}</td></tr>`,k+=`<tr class="${O.yMinMove<I.yMin||O.yMaxMove>I.yMax?"bg-danger":""}"><td>Перемещение Y</td><td>${O.yMinMove.toFixed(2)}..${O.yMaxMove.toFixed(2)}</td><td>${I.yMin.toFixed(2)}..${I.yMax.toFixed(2)}</td></tr>`,k+="</table>",a("Контрольный вопрос","Внимание! В соответствии с заданными вами значениями печатного стола эта модель не будет помещаться внутри вашего принтера. Печатать в любом случае?",null,null,null,k).then(function(){t.preparePrint=!0,i.send("copyModel",{id:O.id,autostart:P}).then(function(){t.preparePrint=!1})})}},t.queueFileSelected=function(O){return O.id===t.activeQueue.id},t.previewGCode=function(O,P){h.go("printer.preview",{model:O,tab:P})},t.copyToProject=function(O){w("","Копирование G-кода в проект").then(function(P){i.send("projectGCodeToProject",{serveruuid:P.serveruuid,projectuuid:P.uuid,modelid:O.id})},function(){})},t.tryDeleteModel=function(O){a("Контрольный вопрос","Вы действительно хотите удалить $1?".replace("$1",O.name)).then(function(){t.delAnimation=!0,n(function(){i.send("removeModel",{id:O.id}).then(function(){f.success("Файл удален"),n(S,500),t.checkDisk()})},50)})},t.newModelName=function(O){O.name.length===0&&(O.name="Unknown"),i.send("renameModel",{id:O.id,newName:O.name}).then(P=>{P.ok||f.error("Переименование не удалось!")})},t.info=function(O){c.open({templateUrl:"/views/printer/control/printer.price.dialog.php?lang="+window.lang,scope:t,controller:["$scope",function(P){P.plist=[],P.noteEdit=!1,P.model=O,P.groupsel=angular.copy(t.groups),P.groupsel.splice(0,1);let L=r.serverSettings.pricing,I=L.map;P.$on("modal.closing",function(){angular.forEach(P.plist,function(B){P.model.materials[B.idx]=B.filament.u}),i.send("setModelInfo",P.model)});function k(B){if(!B)return 0;let F=0;return angular.forEach(L.filaments,function(W,V){W.u===B&&(F=V)}),F}P.filaments=L.filaments,P.currency=L.currency,angular.forEach(O.volumeUsage,function(B,F){B<=0||P.plist.push({idx:F,extruder:F+1,mm:O.extruderUsage[F],volume:B*.001,price:0,filament:L.filaments[k(O.materials[F])],weight:0})}),P.updateCalc=function(){P.weightTotal=0,P.total=L.perPrint+L.perHour*O.printTime/3600,angular.forEach(P.plist,function(B){B.weight=B.volume*B.filament.w,P.weightTotal+=B.weight,B.price=B.weight*B.filament.p/1e3,P.total+=B.price})},P.selectGroup=function(){i.send("moveModelFileToGroup",{id:O.id,groupName:O.group}).then(function(){t.selectGroup()})},P.close=function(){angular.forEach(P.plist,function(B,F){I[F.toString()+"_"+t.slug]=B.filament.u}),P.$close()},P.updateCalc()}]})},t.updateFilter=function(){t.delAnimation=!0,n(function(){E.modelFilter=r.globals.gcodeView.filter,g.sortModelsFor(r.activeSlug),n(S,500)},50)},g.sortModelsFor(r.activeSlug),t.handleUpload=function(){let O=$("#gcodeFilenameUpload"),P=O.val().replace(/\\/g,"/").replace(/.*\//,""),L=P.lastIndexOf("."),I="";L>0&&(I=P.substring(L+1)),(I==="g"||I==="gco"||I==="gcode")&&(P=P.substring(0,L));let k=O.get(0).files[0].size;i.send("canUploadGCodeWithSize",{size:k}).then(function(B){if(B.ok){t.uploading=!0,t.uploadProgress=0;let F=()=>{t.uploading=!1,O.val(""),n(t.checkDisk,180*1e3)},W=ne=>{t.uploadProgress=ne},V="/printer/model/"+t.activeSlug,N=[];for(let ne of O.get(0).files)N.push({name:ne.name.replace(/\\/g,"/").replace(/.*\//,""),filename:ne});i.uploadFiles({url:V,a:"upload",group:r.globals.gcodeView.group,files:N},W).then(F).catch(function(ne){console.log(ne)}),P!==""&&O.val("")}else f.error("","Диск переполнен. Сначала удалите другие файлы.",1e4,!0)})},window.handleUpload=t.handleUpload,window.quickuploadHandler=function(){let O=$("#quickFilenameUpload"),P=O.val().replace(/\\/g,"/").replace(/.*\//,""),L=P.lastIndexOf("."),I="";L>0&&(I=P.substr(L+1)),(I==="g"||I==="gco"||I==="gcode")&&(P=P.substr(0,L)),$("#quickUploadName").val(P);let k=O.get(0).files[0].size;i.send("canUploadGCodeWithSize",{size:k}).then(function(B){if(B.ok){t.uploading=!0,t.uploadProgress=0;let F=()=>{t.uploading=!1,O.val(""),n(t.checkDisk,180*1e3)},W=ne=>{t.uploadProgress=ne},V="/printer/job/"+t.activeSlug,N=[];for(let ne of O.get(0).files)N.push({name:ne.name.replace(/\\/g,"/").replace(/.*\//,""),filename:ne});i.uploadFiles({url:V,a:"upload",autostart:N.length===1?"1":"0",files:N},W).then(F).catch(function(ne){console.log(ne)}),P!==""&&O.val("")}else f.error("","Диск переполнен. Сначала удалите другие файлы.",1e4,!0)})},t.importLink=function(O,P){if((0,iT.isURL)(t.in.openUrl,{protocols:["http","https"],require_tld:!0,require_protocol:!0,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,host_whitelist:!1,host_blacklist:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,disallow_auth:!0,validate_length:!0})){let L=[{name:"",url:t.in.openUrl,job:O,autostart:P}];console.log("arr",L),i.send("importURL",{files:L,folder:r.globals.gcodeView.group}).then(function(){f.success("Начался импорт файла(ов)")})}},t.importUrlValid=!1,t.$watch("in.openUrl",()=>{t.importUrlValid=(0,iT.isURL)(t.in.openUrl,{protocols:["http","https"],require_tld:!0,require_protocol:!0,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,host_whitelist:!1,host_blacklist:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,disallow_auth:!0,validate_length:!0})}),t.dropbox=function(O){Dropbox.choose({success:function(P){let L=[],I=0;angular.forEach(P,function(k){L.push({name:k.name,url:k.link,job:O}),I+=k.bytes}),i.send("canUploadGCodeWithSize",{size:I}).then(function(k){k.ok?(_.show("Uploading Files",10),i.send("importURL",{files:L,folder:r.globals.gcodeView.group}).then(function(B){B.ok?_.bindToMsgId(B.msgId):_.hide()},function(){_.hide()})):f.error("","Диск переполнен. Сначала удалите другие файлы.",1e4,!0)})},cancel:function(){},linkType:"direct",multiselect:!0})},t.googledrive=function(){x.select().then(function(O){console.log("returned selection ",O)})},t.importFolderPath=function(O){if(O.isDir){y.activeFolderPath=O.path,y.updateFiles("");return}if(!r.activeConfig.general.enableQueue&&t.importAsJob&&r.active.status.jobid!==0)return;_.show("Uploading Files",10);let P=[{name:O.name,url:"folder://"+y.selectedFolder+O.path,job:t.importAsJob}];i.send("importURL",{files:P,folder:r.globals.gcodeView.group}).then(function(L){L.ok?_.bindToMsgId(L.msgId):_.hide()},function(){_.hide()}),t.selectSFile=!1},t.abortFileSelection=function(){t.selectSFile=!1},t.selectedFolderChanged=function(){y.activeFolderPath="",y.updateFiles()},t.importPath=function(O,P){t.selectSFile=!0,t.importAsJob=P,y.selectedFolder=O.id,y.activeFolderPath="",y.filter="gcode",y.updateFiles()},t.importSelectedFiles=function(O){let P=[],L=0;angular.forEach(y.filesInPath,function(I){I.selected&&(P.push({name:I.name,url:"folder://"+y.selectedFolder+I.path,job:t.importAsJob,autostart:O}),L+=I.size)}),P.length!==0&&(O===void 0&&(O=P.length===1),!(!r.activeConfig.general.enableQueue&&t.importAsJob&&(P.length!==1||r.active.status.jobid!==0))&&i.send("canUploadGCodeWithSize",{size:L}).then(function(I){I.ok?(_.show("Uploading Files",10),i.send("importURL",{files:P,folder:r.globals.gcodeView.group}).then(function(k){k.ok?_.bindToMsgId(k.msgId):_.hide()},function(){_.hide()}),t.selectSFile=!1):f.error("","Диск переполнен. Сначала удалите другие файлы.",1e4,!0)}))},t.importAllFiles=function(){angular.forEach(y.filesInPath,function(O){O.isDir||(O.selected=!0)}),t.importSelectedFiles(void 0)}}]);RSPrinterModule.controller("PrinterLogsController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","RSOverview","P","Flash","GSettings",function(t,e,i,r,n,o,a,l,h,u,c){t.printLogs=[],r.frontend.setVisible("logs",!0),t.$on("$destroy",function(){r.frontend.setVisible("logs",!1)}),t.refreshLogs=function(){i.send("listLogs",{}).then(function(f){t.printLogs=f.logs,t.active=f.active})},t.deleteLog=function(f){i.send("removeLog",{log:f.name}).then(function(){t.refreshLogs()})},t.deleteAllLogs=function(){let f=angular.copy(t.printLogs);angular.forEach(f,function(d){t.deleteLog(d)})},t.encName=function(f){return encodeURIComponent(f.name)},t.refreshLogs(),r.$watch("serverSettings.logIdle",function(){c.serverSettingsChanged()}),r.$watch("serverSettings.logPrint",function(){c.serverSettingsChanged()})}]);RSPrinterModule.controller("PrinterHistoryController",["$scope","$uibModal","RSCom","$rootScope","$timeout","$filter","RSOverview","P","Flash","User",function(t,e,i,r,n,o,a,l,h,u){r.frontend.setVisible("history",!0),t.$on("$destroy",function(){r.frontend.setVisible("history",!1)}),t.stateTexts=["Печать","Напечатанный","Отменено"],t.filter={start:0,limit:50,slug:t.activeSlug,uuid:"",allPrinter:!1,page:0},t.list=[],t.summary=[],t.year=new Date().getFullYear(),t.monthNames=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];function c(){i.send("historyList",t.filter).then(function(d){if(d.list.length===0&&t.filter.start>0){t.filter.start-=t.filter.limit;return}t.list=d.list})}function f(d){i.send("historySummary",{year:t.year,slug:t.filter.slug,allPrinter:t.filter.allPrinter}).then(function(m){t.summary=[],angular.forEach(t.monthNames,function(g,p){t.summary.push({month:g,start:new Date(d,p+1,1)/1e3,end:new Date(p===11?d+1:d,p===11?1:p+2,1)/1e3,filament:0,realTime:0,computedTime:0,numPrints:0,numAborted:0,numFinished:0,costs:0,style:{}})}),t.summary.push({month:"Всего",filament:0,realTime:0,computedTime:0,numPrints:0,numAborted:0,numFinished:0,costs:0,style:{"font-weight":"bold"}});let v=t.summary[12];angular.forEach(m.list,function(g){let p=t.summary[g.month-1];p.filament+=g.filament,p.realTime+=g.real>0?g.real:0,p.computedTime+=g.computed,p.numPrints+=g.num,p.numFinished+=g.finished,p.numAborted+=g.aborted,p.costs+=g.costs,v.filament+=g.filament,v.realTime+=g.real>0?g.real:0,v.computedTime+=g.computed,v.numPrints+=g.num,v.numFinished+=g.finished,v.numAborted+=g.aborted,v.costs+=g.costs})},function(){})}t.historyForward=function(){t.filter.start>0&&(t.filter.start-=t.filter.limit,c())},t.historyBack=function(){t.filter.start+=t.filter.limit,c()},t.statAddYear=function(d){t.year+=d,f(t.year)},t.deleteHistory=function(d){r.user.canHistory()&&i.send("historyDeleteEntry",{id:d.id}).then(function(){c(),f(t.year)})},t.editHistory=function(d){(r.user.canHistory||d.username===r.user.login)&&e.open({templateUrl:"/views/printer/control/printer.edithistory.dialog.php?lang="+lang,scope:t,size:"lg",controller:["$scope",function(m){m.edit={id:d.id,notes:d.notes},m.$on("modal.closing",function(){i.send("historySetNote",m.edit).then(function(){d.notes=m.edit.notes})}),setTimeout(function(){let v=document.getElementById("historyNote");v&&v.focus()},200)}]})},t.updateAll=function(){t.filter.start=0,c(),f(t.year)},t.export=function(){if(!r.hasWebcamSupport)return;let d=t.filter;d.page===0?window.open("/printer/export/"+d.slug+"?a=history_entries&all="+(d.allPrinter?"1":"0"),"ihelper"):window.open("/printer/export/"+d.slug+"?a=history_summary&all="+(d.allPrinter?"1":"0")+"&year="+t.year,"ihelper")},t.showReport=function({id:d,printerSlug:m}){window.open("/printer/export/"+m+"?a=history_report&id="+d,"_blank")},c(),f(t.year)}]);var J_=Qi(ta());RSPrinterModule.factory("SelectPrinters",["$uibModal",function(t){return function(e){let i=t.open({templateUrl:"/views/printer/config/selectPrinters.php?lang="+lang,controller:["$scope","$uibModalInstance","$rootScope","RSPrinter",function(r,n,o,a){r.headline=e,r.slug=o.activeSlug,r.selections={},r.checkAll=!1,r.cancel=function(){n.dismiss()},r.unselectCheckAll=()=>{r.checkAll=!1},r.selectAllPrinters=()=>{angular.forEach(o.printerList,function(l){l&&(r.selections[l.slug]=!r.checkAll)})},r.selectPrinters=function(){let l=[];angular.forEach(r.selections,function(h,u){h&&(console.log(o.printerConfig[u]),l.push(o.printer[u].status))}),n.close({list:l})}}],size:"lg"});return i.result.catch(function(r){}),i.result}}]);RSPrinterModule.factory("RSPrinterConfig",["$rootScope","$q","RSCom","RSOverview","Flash",function(t,e,i,r,n){let o={},a="",l={},h={editSlug:"",scriptNames:[{name:"activate",title:"Запуск при активации принтера"},{name:"deactivate",title:"Запуск при деактивации принтера"},{name:"start",title:"Выполнить перед заданием"},{name:"end",title:"Запуск после задания"},{name:"kill",title:"Запуск, если задание прервано"},{name:"pause",title:"Запуск во время паузы"},{name:"continue",title:"Запуск при подолжении"},{name:"connect",title:"Запуск при подключении"},{name:"connectReset",title:"Запуск при перезагрузке"},{name:"shutdown",title:"Отключение принтера"},{name:"remove_filament",title:"Убрать нить"},{name:"insert_filament",title:"Вставить нить"},{name:"insert_filament_finished",title:"После вставки нити накаливания"},{name:"before_snapshot",title:"Перед снимком"},{name:"after_snapshot",title:"После снимка"},{name:"door_opened",title:"Дверь открылась"},{name:"door_closed",title:"Дверь закрыта"}],toolNames:["Экструдер","Фрезерная головка","Лазер","Шприц","Камера с подогревом"],toolIcons:["rs rs-extruder","rs rs-mill","rs rs-laser","rs rs-syringe","rs rs-chamber"],toolDiameterName:["Диаметр сопла","Ширина фрезерования","Диаметр лазера","Диаметр шприца","Диаметр"],scripts:{},scriptChanged:function(c){return this.scripts[c]!==o[c]},config:{buttonCommands:!1,movement:{},gcodeReplacements:[],responseEvents:[],flowPresets:[],fanPresets:[],speedPresets:[],quickCommands:[],wizardCommands:[],wizardTemplates:[],general:{},connection:{connectionMethod:0},shape:{basicShape:{}}}},u=function(){let c=0,f=e.defer(),d=!0;return c=h.scriptNames.length,angular.forEach(h.scriptNames,function(m){i.send("getScript",{name:m.name}).then(function(v){o[m.name]=h.scripts[m.name]=v.script,c--,c===0&&(d?f.resolve():f.reject())},function(){c--,d=!1,c===0&&f.reject()})}),f.promise};return h.refreshWizards=function(){h.config.wizardCommands=angular.copy(t.printerConfig[h.editSlug].wizardCommands)||{}},h.hasErrors=function(){let c=!1;return angular.forEach(l,function(f){c|=f}),c},h.setError=function(c,f){l[c]=f},h.selectPrinter=function(c){let f=e.defer();return r.printerListLoadedPromise.then(function(){r.selectPrinter(c),h.editSlug=c,h.config=angular.copy(t.printerConfig[c])||{},h.config.buttonCommands&&h.config.buttonCommands.sort(function(d,m){return d.name<m.name?-1:1}),a=angular.toJson(h.config),o={},h.refreshPorts().then(u).then(function(){f.resolve()}).catch(function(){f.reject()}),l={}}),f.promise},h.hasConfigChanged=function(){let c=a!==angular.toJson(h.config);return angular.forEach(h.scriptNames,function(f){c|=h.scriptChanged(f.name)}),c},h.save=function(c){let f=e.defer(),d=h.config.extruders.length-1;angular.forEach(h.config.extruders,function(v,g){v.num=g,v.tempMaster>d&&(v.tempMaster=v.num),v.num!==v.tempMaster&&(v.maxTemp=h.config.extruders[v.tempMaster].maxTemp)});let m=0;return t.activeConfig.general&&(h.config.general.active=t.activeConfig.general.active),i.send("setPrinterConfig",h.config,h.editSlug).then(function(){angular.forEach(h.scriptNames,function(v){m++,h.scriptChanged(v.name)?i.send("setScript",{name:v.name,script:h.scripts[v.name]}).then(function(){o[v.name]=h.scripts[v.name],m--,m===0&&(n.success("Конфигурация сохранена","",2e3),f.resolve())}):m--}),m===0&&((typeof c=="undefined"||c!==!1)&&n.success("Конфигурация сохранена","",2e3),f.resolve())}),f.promise.then(function(){a=angular.toJson(h.config)}),f.promise},h.savePrinterSetup=function(c){let f=e.defer();return i.send("savePrinterSetup",h.config,h.editSlug).then(function(){(typeof c=="undefined"||c!==!1)&&n.success("Настройка сохранена","",2e3),f.resolve()}),f.promise},h.saveTimelapse=function(){let c=e.defer();return i.send("setPrinterTimelapseConfig",h.config,h.editSlug).then(function(){c.resolve()}),c.promise.then(function(){a=angular.toJson(h.config)}),c.promise},h.reset=function(){angular.copy(t.printerConfig[slug],h.config),angular.copy(o,h.scripts),l={}},h.refreshPorts=function(){let c=e.defer();return i.send("listPorts",{}).then(function(f){h.ports=f,c.resolve()}).catch(function(){c.reject()}),c.promise},h}]).controller("PrinterConfigController",["RSPrinterConfig","$scope","resA","RSFirmware","RSCom","RSPrinter","$state","PrinterConditionDialog","$rootScope",function(t,e,i,r,n,o,a,l,h){e.menuPort=!1,e.$watch("editor.general.name",function(){e.cheadline="Настройки принтера $".replace("$",e.editor.general.name)}),e.showFilamentsensorNames=!1,e.actFirmware=null,e.isKlipper=!1,e.$watch("editor.general.firmwareName",function(){e.actFirmware=r.firmwareInfoMap[e.editor.general.firmwareName],e.actFirmware&&(e.isKlipper=e.actFirmware.style=="klipper",e.showFilamentsensorNames=e.actFirmware.style=="klipper",e.isKlipper&&(e.editor.connection.serial.pingPong=!0,e.editor.connection.connectionMethod=0))}),e.conMethods=[{i:0,n:"Последовательное соединение"},{i:1,n:"Pipe\/UNIX Socket"},{i:2,n:"Подключение по TCP\/IP"},{i:3,n:"DuetControlServer"}],e.doorModes=[{i:0,n:"Игнорировать состояние двери"},{i:1,n:"Показать предупреждение"},{i:2,n:"Приостановка и предотвращение XYZ-движений"}],e.serverSettings.ServerOS===0&&(e.conMethods.splice(1,1),e.conMethods.splice(2,1)),e.resetOrder=[{i:0,n:"От низкого к высокому"},{i:1,n:"От высокого к низкому"},{i:2,n:"Низкий"},{i:3,n:"Высокие"}],e.maxParallelCommands=[{i:0,n:"Без ограничений"}];for(let u=1;u<=128;u++)e.maxParallelCommands.push({i:u,n:""+u});e.showPrinterCondition=function(){l(h.activeSlug)},e.editor=t.config,e.config=t,e.firmware=r,e.menuOpen=!1,e.testsOpen=0,e.openConTests=[],e.conTestResults=[],e.editor.connection.serial.dtr<0&&(e.editor.connection.serial.dtr=0),e.editor.connection.serial.rts<0&&(e.editor.connection.serial.rts=0),e.closeMenu=function(){e.menuOpen=!1},e.showPrinter=function(u){let c=o.getActivePage(u,{state:"printer.print",params:{slug:u}});a.get(c.state)?a.go(c.state,c.params):a.go("printer.print",c.params)},e.sendNextTest=function(){if(e.openConTests.length>0){let u=e.openConTests.shift();e.runningTest=u,n.send("communicationTest",u).then(function(){},function(){e.testsOpen--})}},e.$on("communicationTestResult",function(u,c){!c.data.error&&c.data.resendsShort<.5&&c.data.resends<.5&&c.data.resends<.5?c.data.bgClass="bg-success":!c.data.error&&c.data.resendsShort<1&&c.data.resends<1&&c.data.resends<1?c.data.bgClass="bg-warning":c.data.bgClass="bg-danger",e.conTestResults.push(c.data),e.testsOpen--,e.sendNextTest()}),e.testThisConfig=function(){e.testsOpen||(e.openConTests=[{pingPong:e.editor.connection.serial.pingPong,buffer:e.editor.connection.serial.inputBufferSize,parallelCommands:e.editor.connection.serial.maxParallelCommands}],e.testsOpen=1,e.sendNextTest())},e.testMultipleConfigs=function(){if(e.testsOpen)return;e.openConTests=[{pingPong:!0,buffer:127,parallelCommands:e.editor.connection.serial.maxParallelCommands},{pingPong:!1,buffer:63,parallelCommands:e.editor.connection.serial.maxParallelCommands},{pingPong:!1,buffer:127,parallelCommands:e.editor.connection.serial.maxParallelCommands},{pingPong:!1,buffer:255,parallelCommands:e.editor.connection.serial.maxParallelCommands}];let u=e.editor.connection.serial.inputBufferSize;!e.editor.connection.serial.pingPong&&u!==63&&u!==127&&u!==255&&u!==511&&e.openConTests.push({pingPong:e.editor.connection.serial.pingPong,buffer:e.editor.connection.serial.inputBufferSize,parallelCommands:e.editor.connection.serial.maxParallelCommands}),e.testsOpen=e.openConTests.length,e.sendNextTest()},e.clearTests=function(){e.conTestResults=[]},e.assignTest=function(u){e.editor.connection.serial.pingPong=u.pingPong,e.editor.connection.serial.inputBufferSize=u.bufferSize},e.templateAdd=function(u){u.push({name:"",value:100})},e.templateDel=function(u,c){u.splice(c,1)}}]).controller("PrinterConfigAdvancedController",["RSPrinterConfig","$scope","RSCom","$rootScope",function(t,e,i,r){e.activeCam=e.editor.webcams.length>0?0:-1,e.webcamMethods=[{id:0,t:"Нет веб-камеры"},{id:1,t:"JPG изображения"},{id:2,t:"MJPG поток"},{id:3,t:"JPG + MJPG поток"}],e.frameratesTimelapse=[{v:1,n:"1 fps"},{v:5,n:"5 fps"},{v:10,n:"10 fps"},{v:12,n:"12 fps"},{v:15,n:"15 fps"},{v:24,n:"24 fps"},{v:25,n:"25 fps"},{v:30,n:"30 fps"},{v:50,n:"50 fps"},{v:60,n:"60 fps"}],e.resolutions=[{id:1,w:640,h:480,n:"640x480"},{id:2,w:320,h:240,n:"320x240"},{id:3,w:160,h:120,n:"160x120"},{id:4,w:800,h:600,n:"800x600"},{id:5,w:960,h:720,n:"960x720"},{id:6,w:1280,h:720,n:"1280x720"},{id:7,w:1280,h:960,n:"1280x960"},{id:26,w:1280,h:1024,n:"1280x1024"},{id:8,w:1920,h:1080,n:"1920x1080"},{id:27,w:2560,h:2160,n:"2560x1440"},{id:28,w:3840,h:2160,n:"3840x2160"},{id:29,w:4096,h:2160,n:"4096x2160"},{id:9,w:176,h:144,n:"176x144"},{id:10,w:320,h:176,n:"320x176"},{id:11,w:432,h:240,n:"432x240"},{id:12,w:352,h:288,n:"352x288"},{id:13,w:544,h:288,n:"544x288"},{id:14,w:640,h:360,n:"640x360"},{id:15,w:752,h:416,n:"752x416"},{id:16,w:800,h:448,n:"800x448"},{id:17,w:864,h:480,n:"864x480"},{id:18,w:960,h:544,n:"960x544"},{id:19,w:1024,h:576,n:"1024x576"},{id:20,w:1184,h:656,n:"1184x656"},{id:21,w:1392,h:768,n:"1392x768"},{id:22,w:1504,h:832,n:"1504x832"},{id:23,w:1600,h:896,n:"1600x896"},{id:24,w:1712,h:960,n:"1712x960"},{id:25,w:1792,h:1008,n:"1792x1008"}],e.wcm={manageable:!1,mode:"",framerate:15,version:0},e.cam={resolution:e.resolutions[0],framerate:0,selectedWebcam:void 0},e.framerates=[1,5,10,15,20,24,25,30],e.addWebcam=function(){e.editor.webcams.push({dynamicUrl:"",method:3,orientation:0,pos:0,reloadInterval:3,staticUrl:"",timelapseBitrate:1e3,timelapseFramerate:30,timelapseHeight:.1,timelapseInterval:20,timelapseLayer:1,timelapseMethod:1,timelapseSelected:0,forceSnapshotPosition:!1,snapshotX:.5*(e.editor.movement.xMin+e.editor.movement.xMax),snapshotY:e.editor.movement.yMax,snapshotDelay:800,snapshotStabilizeTime:50}),e.activeCam=e.editor.webcams.length-1},e.delWebcam=function(){e.activeCam<0||(e.editor.webcams.splice(e.activeCam,1),e.editor.webcams.length<=e.activeCam&&(e.activeCam=e.editor.webcams.length-1))},e.$watch("formWebcam.$valid",function(o){typeof o!="undefined"&&t.setError("webcam",e.formWebcam.$invalid)});let n=function(o){e.wcm=o;let a=!1;angular.forEach(e.wcm.webcams,function(l){!a&&l.accessible&&(e.cam.selectedWebcam===void 0||e.cam.selectedWebcam.port===l.port)&&(e.cam.selectedWebcam=l)}),e.wcm.version>=2&&(e.cam.framerate=e.wcm.framerate,e.cam.resolution=e.resolutions[0],angular.forEach(e.resolutions,function(l){l.w===e.wcm.width&&l.h===e.wcm.height&&(e.cam.resolution=l)}))};e.updateWCM=function(){i.send("webcamStatus",{cmd:"status"}).then(function(o){n(o)})},e.canOpenStreamer=()=>e.cam.selectedWebcam&&e.cam.selectedWebcam.accessible,e.openStreamer=()=>{let o=`http://${location.hostname}:${e.cam.selectedWebcam.port}/stream.html`;console.log("open streamer",o),window.open(o,"_blank")},e.wcmAssign=function(){let o=e.cam.selectedWebcam;e.editor.webcams[e.activeCam].method=3,e.editor.webcams[e.activeCam].dynamicUrl="http://127.0.0.1:"+o.port+"/?action=stream",e.editor.webcams[e.activeCam].staticUrl="http://127.0.0.1:"+o.port+"/?action=snapshot"},e.wcmSetResolution=function(){i.send("webcam",{cmd:"setResolution",width:e.cam.resolution.w,height:e.cam.resolution.h,framerate:e.cam.framerate}).then(function(){r.$broadcast("refreshWebcam",null)})},e.wcmCmd=function(o){i.send("webcam",{cmd:o}).then(function(){o==="remove"&&(e.editor.webcams[e.activeCam].method=0),o==="restart"&&r.$broadcast("refreshWebcam",null)})},e.$on("webcamChanged",function(o,a){n(a.data)}),e.updateWCM()}]).controller("PrinterConfigExtruderController",["RSPrinterConfig","$scope","$timeout","RSPrinter","Confirm","$rootScope","RSFirmware",function(t,e,i,r,n,o,a){e.hswStep=0;let l=!1;e.config=t,e.generalSettingsExtruder=[],e.generalSettingsFans=[],e.firmware=a.firmwareInfoMap[e.editor.general.firmwareName],e.showHeaterName=e.firmware&&e.firmware.style==="klipper",e.showFanName=e.firmware&&e.firmware.style==="klipper",e.showFilamentsensorNames=e.firmware&&e.firmware.style==="klipper",e.$on("$destroy",function(){l=!0}),e.gcodeManualEntrys=[{i:0,n:"Вентилятор охлаждения филамента"},{i:1,n:"Вентилятор, управляемый нагревателем"},{i:2,n:"Вентилятор охлаждения платы"},{i:3,n:"Generic Fan"}],e.bedTempUp=function(c,f){let d=e.editor.heatedBeds[c].temperatures[f-1],m=e.editor.heatedBeds[c].temperatures[f];e.editor.heatedBeds[c].temperatures.splice(f-1,2,m,d)},e.bedTempDown=function(c,f){let d=e.editor.heatedBeds[c].temperatures[f],m=e.editor.heatedBeds[c].temperatures[f+1];e.editor.heatedBeds[c].temperatures.splice(f,2,m,d)},e.bedTempDel=function(c,f){e.editor.heatedBeds[c].temperatures.splice(f,1)},e.bedTempAdd=function(c){e.editor.heatedBeds[c].temperatures.push({name:"",temp:50})},e.chamberTempUp=function(c,f){let d=e.editor.heatedChambers[c].temperatures[f-1],m=e.editor.heatedChambers[c].temperatures[f];e.editor.heatedChambers[c].temperatures.splice(f-1,2,m,d)},e.chamberTempDown=function(c,f){let d=e.editor.heatedChambers[c].temperatures[f],m=e.editor.heatedChambers[c].temperatures[f+1];e.editor.heatedChambers[c].temperatures.splice(f,2,m,d)},e.chamberTempDel=function(c,f){e.editor.heatedChambers[c].temperatures.splice(f,1)},e.chamberTempAdd=function(c){e.editor.heatedChambers[c].temperatures.push({name:"",temp:50})},e.extTempUp=function(c,f){let d=c.temperatures[f-1],m=c.temperatures[f];c.temperatures.splice(f-1,2,m,d)},e.extTempDown=function(c,f){let d=c.temperatures[f],m=c.temperatures[f+1];c.temperatures.splice(f,2,m,d)},e.extTempDel=function(c,f){c.temperatures.splice(f,1)},e.extTempAdd=function(c){c.temperatures.push({name:"",temp:"50"})},e.moveExtruder=function(c,f){console.log("move",c,f),e.editor.extruders[c].temperatures.splice(f,1)},e.addBed=function(){e.editor.heatedBeds.push({heatupPerSecond:.1,lastTemp:0,offset:0,maxTemp:110,cooldownPerSecond:.1,temperatures:e.editor.heatedBeds.length===0?[]:angular.copy(e.editor.heatedBeds[0].temperatures)})},e.delBed=function(c,f){e.editor.heatedBeds.splice(c,1),f&&f.preventDefault()},e.addChamber=function(){e.editor.heatedChambers.push({heatupPerSecond:.1,lastTemp:0,offset:0,maxTemp:110,cooldownPerSecond:.1,temperatures:e.editor.heatedChambers.length===0?[]:angular.copy(e.editor.heatedChambers[0].temperatures)})},e.delChamber=function(c,f){e.editor.heatedChambers.splice(c,1),f&&f.preventDefault()},e.addExtruder=function(){let c=e.editor.extruders.length,f=e.editor.extruders.length===0?!1:e.editor.extruders[e.editor.extruders.length-1];e.editor.extruders.push({num:c,eJerk:f?f.eJerk:40,maxSpeed:f?f.maxSpeed:30,acceleration:f?f.acceleration:5e3,extrudeSpeed:f?f.extrudeSpeed:2,retractSpeed:f?f.retractSpeed:20,heatupPerSecond:f?f.heatupPerSecond:1.5,lastTemp:0,maxTemp:f?f.maxTemp:260,cooldownPerSecond:f?f.cooldownPerSecond:1,offsetX:0,offsetY:0,offset:f?f.offset:0,toolType:f?f.toolType:0,toolDiameter:f?f.toolDiameter:.4,supportTemperature:f?f.supportTemperature:!0,tempMaster:c,changeFastDistance:f?f.changeFastDistance:20,changeSlowDistance:f?f.changeSlowDistance:20,filamentDiameter:f?f.filamentDiameter:1.75,temperatures:f?angular.copy(f.temperatures):[]})},e.addFan=function(){e.editor.fans.push({alias:"",firmwareName:"",fanType:0,firmwareId:e.editor.fans.length,min:0,max:100,readOnly:!1})},e.delFan=function(c,f){e.editor.fans.splice(c,1),f&&f.preventDefault()},e.removeExtruder=function(c,f){n("Контрольный вопрос","Действительно удалить этот экструдер?",null,null,!0).then(function(){e.editor.extruders.splice(c,1)}),f&&f.preventDefault()},e.$watch("formExtruder.$valid",function(c){typeof c!="undefined"&&t.setError("extruder",e.formExtruder.$invalid)}),e.hswStart1=function(){e.hswStep=1,e.config.save(),e.hwsMeasurements=[],angular.forEach(e.editor.heatedBeds,function(c,f){e.hwsMeasurements.push({id:1e3+f,name:"Подогреваемый стол",target:Math.min(50,c.maxTemp)})}),angular.forEach(e.editor.extruders,function(c,f){c.num===c.tempMaster&&c.supportTemperature&&e.hwsMeasurements.push({id:f,name:"Экструдер "+(f+1),target:Math.min(200,c.maxTemp)})})};let h=function(c){return c===0?"Нагрев":c===1?"Удержание":c===2?"Охлаждение":"Завершено"},u=function(){let c=!0,f=new Date().getTime();angular.forEach(e.hwsMeasurements,function(d){if(d.actTemp=d.id>=1e3?o.active.state.heatedBeds[d.id-1e3].tempRead:o.active.state.extruder[d.id].tempRead,d.mode===0)c=!1,d.actTemp>=d.target&&(d.mode=1,d.modeText=h(1),d.upEndTime=f,d.holdEndTime=f+d.holdTime);else if(d.mode===1)f>d.holdEndTime&&(d.mode=2,d.modeText=h(2),d.holdEndTime=f,d.cooldownStartTemp=d.actTemp,d.id>=1e3?o.RSPrinter.setBedTemperature(0,d.id-1e3):o.RSPrinter.setExtruderTemperature(d.id,0)),c=!1;else if(d.mode===2&&(c=!1,d.actTemp<=d.coolTarget)){d.mode=3,d.modeText=h(3),d.downEndTime=f;let m=d.id>=1e3?e.editor.heatedBeds[d.id-1e3]:e.editor.extruders[d.id];m.heatupPerSecond=(d.target-d.startTemp)*1e3/(d.upEndTime-d.startTime),m.cooldownPerSecond=(d.cooldownStartTemp-d.coolTarget)*1e3/(d.downEndTime-d.holdEndTime)}}),!c&&!l?i(u,500):c&&(e.hswStep=3,angular.forEach(e.editor.extruders,function(d){d.num!==d.tempMaster&&(d.heatupPerSecond=e.editor.extruders[d.tempMaster].heatupPerSecond,d.cooldownPerSecond=e.editor.extruders[d.tempMaster].cooldownPerSecond)}),e.config.save())};e.hswStart2=function(){let c=new Date().getTime();r.sendGCode("M80"),angular.forEach(e.hwsMeasurements,function(f){f.startTime=c,f.mode=0,f.modeText=h(0),f.id>=1e3?(f.startTemp=f.actTemp=o.active.state.heatedBeds[f.id-1e3].tempRead,f.coolTarget=f.startTemp+10,f.holdTime=6e4,o.RSPrinter.setBedTemperature(f.target,f.id-1e3)):(f.startTemp=f.actTemp=o.active.state.extruder[f.id].tempRead,f.coolTarget=Math.max(f.startTemp+10,f.target-20),f.holdTime=3e4,r.setExtruderTemperature(f.id,f.target))}),e.hswStep=2,u()},i(r.updateFirmwareAutoset,100)}]).controller("PrinterSetupController",["RSPrinterConfig","$scope","$timeout","RSPrinter","Flash","$interval","RSPrinters","$sce","$rootScope",function(t,e,i,r,n,o,a,l,h){e.$watch("formSetup.$valid",function(){e.formSetup&&t.setError("setup",e.formSetup.$invalid)}),t.selectPrinter(h.activeSlug).then(function(){e.config=t,e.editor=t.config}),h.frontend.setVisible("activePrinterSetup",!0),e.$on("$destroy",function(){h.frontend.setVisible("activePrinterSetup",!1)})}]).controller("PrinterConfigGeneralController",["RSPrinterConfig","$scope","$timeout","RSPrinter","Flash","$interval","RSPrinters","$sce","RSCom",function(t,e,i,r,n,o,a,l,h){e.lcdModes=[{id:0,t:"Не задавать состояние"},{id:1,t:"Показать ETA"},{id:2,t:"Показать ЕТЕ"},{id:3,t:"Показать слой"},{id:4,t:"Повернуть"},{id:5,t:"Только важные сообщения"}],e.pauseModes=[{id:0,t:"Просто пауза"},{id:1,t:"Пауза и отключение экструдеров через X секунд"},{id:2,t:"Пауза и отключение нагреваемого стола, а так же экструдеров через X секунд"},{id:3,t:"Приостановить и отключить нагрев станины, экструдеров и камеры через х секунд"}],e.usbReconnectModes=[{id:0,t:"Никогда"},{id:1,t:"Рано"},{id:2,t:"Консервативность"}],e.emergencySolutions=[{id:0,t:"Отправьте M112 и попробуйте выполнить аппаратный сброс"},{id:1,t:"Отправьте M112 и попробуйте выполнить аппаратный сброс через 1 секунду"},{id:2,t:"Отправьте M112 и попробуйте выполнить аппаратный сброс через 2 секунды"},{id:3,t:"Отправляйте только M112"},{id:4,t:"Попробуйте только аппаратный сброс"}],e.baudrates=[19200,38400,56e3,57600,76800,111112,115200,230400,25e4,256e3,460800,5e5,1e6],i(r.updateFirmwareAutoset,100),e.$watch("formGeneral.$valid",function(){e.formGeneral&&t.setError("general",e.formGeneral.$invalid)}),e.portWarning=!1,e.klipperApiWarning=!1;let u=function(){e.portWarning=a.printersUsingPort(e.editor.connection.serial.device,e.activeSlug),e.portWarning&&l.trustAsHtml(e.portWarning),e.editor.connection.connectionMethod===0&&e.isKlipper?h.send("hasKlipperApi",{port:e.editor.connection.serial.device}).then(function(f){f.hasApi?e.klipperApiWarning=!1:e.klipperApiWarning=" В настоящее время виден только обычный порт. Чтобы обеспечить наилучший опыт работы с Klipper, мы рекомендуем включить сокет API и настроить его так, чтобы он указывал на @, для оптимальной производительности.".replace("@",`'${e.editor.connection.serial.device}.api'`)},()=>{}):e.klipperApiWarning=!1};e.$watch("editor.connection.serial.device",function(){u()}),e.$watch("editor.general.firmwareName",function(){u()}),u();let c=o(t.refreshPorts,1500);e.$on("$destroy",function(){o.cancel(c)})}]).controller("PrinterConfigGCodesController",["RSPrinterConfig","$scope","$http","$rootScope","RSCom","Flash","SelectPrinters","User",function(t,e,i,r,n,o,a,l){e.editor=t.config,e.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},e.btn={activeButton:e.editor.buttonCommands[0],activeButtonDefault:""},e.gcodeManualEntrys={computedExpressions:"Подсчитать выдавливание",serverCommands:"Команды сервера",repetierFirmwareGcodes:"G-коды прошивки Repetier",regularExpressions:"Регулярные выражения",gcodeEditor:"Редактор G-кода"},e.selectedManualSection="serverCommands",e.setSelectedManualSection=function(h){e.selectedManualSection=h},e.showHelp=!1,e.setShowHelp=h=>{e.showHelp=h,r.setOverride("fullscreen",h)},e.showRegularExpression=()=>{e.selectedManualSection="regularExpressions",e.showHelp=!0,r.setOverride("fullscreen",!0)},e.copyToSelectedPrinters=function(h,u){a("Копирование G-кода на выбранные принтеры").then(c=>{if(c.list.length!==0){let f=[r.activeSlug];c.list.forEach(d=>{f.push(d.slug)}),n.send("setNewGCodesInConfig",{slugArray:f,scriptGroup:h,data:u}).then(d=>{d.ok?o.success("Копирование на выбранные принтеры","",2e3):o.error("Копирование на выбранные принтеры не удалось",2e3,!0)})}})},e.exportLocalWizard=function(h){window.open("/printer/wizards/"+r.activeSlug+'?a=export&uuid=["'+h.uuid+'"]&custom=1',"ihelper")},e.saveAsWizardTemplate=function(h){n.send("exportWizardAsTemplate",{uuid:h.uuid}).then(u=>{u.ok?o.success("Созданный шаблон мастера","",2e3):o.error("Не удалось создать шаблон мастера",2e3,!0)})},e.updateButtonDefault=function(h){e.btn.activeButton=h,n.send("getDefaultButtonCommand",{name:e.btn.activeButton.name}).then(function(u){u.ok&&(e.btn.activeButtonDefault=u.command)})},e.updateButtonDefault(e.editor.buttonCommands[0]),e.activeScript=e.config.scriptNames[0],e.activeResponseEvent=e.editor.responseEvents.length>0?e.editor.responseEvents[0]:!1,e.activeReplacement=e.editor.gcodeReplacements.length>0?e.editor.gcodeReplacements[0]:!1,e.selectedCommand=e.editor.quickCommands.length>0?e.editor.quickCommands[0]:!1,e.selectedWizardCommand=e.editor.wizardCommands.length>0?e.editor.wizardCommands[0]:!1,e.idxName=function(h,u,c){return u||(u=c),parseInt(h)+1+": "+u},e.addResponseEvent=function(){e.editor.responseEvents.push({event:"",expression:"",script:""}),e.activeResponseEvent=e.editor.responseEvents[e.editor.responseEvents.length-1]},e.delResponseEvent=function(h){for(let u=0;u<e.editor.responseEvents.length;u++)if(e.editor.responseEvents[u]===h){e.editor.responseEvents.splice(u,1),e.activeResponseEvent=e.editor.responseEvents.length>0?e.editor.responseEvents[0]:!1;return}},e.addReplacement=function(){e.editor.gcodeReplacements.push({comment:"",expression:"",script:""}),e.activeReplacement=e.editor.gcodeReplacements[e.editor.gcodeReplacements.length-1]},e.delReplacement=function(h){for(let u=0;u<e.editor.gcodeReplacements.length;u++)if(e.editor.gcodeReplacements[u]===h){e.editor.gcodeReplacements.splice(u,1),e.activeReplacement=e.editor.gcodeReplacements.length>0?e.editor.gcodeReplacements[0]:!1;return}},e.onDragEndQuickCommand=function(){if(e.selectedCommand){let h=e.selectedCommand;angular.forEach(e.editor.quickCommands,function(u){u.name===h.name&&u.command===h.command&&(e.selectedCommand=u)})}},e.selectQuickCommand=function(h){e.selectedCommand=h},e.addQuickCommand=function(){e.selectedCommand={name:"",command:"",icon:""},e.editor.quickCommands.push(e.selectedCommand)},e.delQuickCommand=function(h){h||(h=e.selectedCommand);for(let u=0;u<e.editor.quickCommands.length;u++)if(e.editor.quickCommands[u]===h){e.editor.quickCommands.splice(u,1),e.selectedCommand=e.editor.quickCommands.length>0?e.editor.quickCommands[0]:!1;return}},e.quickUp=function(h){let u=e.editor.quickCommands[h];e.editor.quickCommands[h]=e.editor.quickCommands[h-1],e.editor.quickCommands[h-1]=u},e.onDragEndWizardCommand=function(){if(e.selectedCommand){let h=e.selectedCommand;angular.forEach(e.editor.wizardCommands,function(u){u.name===h.name&&u.command===h.command&&(e.selectedWizardCommand=u)})}},e.selectWizardCommand=function(h){e.selectedWizardCommand=h},e.addWizardCommand=function(){e.selectedWizardCommand={name:"",command:"",icon:""},e.editor.wizardCommands.push(e.selectedWizardCommand)},e.delWizardCommand=function(h){h||(h=e.selectedCommand);for(let u=0;u<e.editor.wizardCommands.length;u++)if(e.editor.wizardCommands[u]===h){e.editor.wizardCommands.splice(u,1),e.selectedWizardCommand=e.editor.wizardCommands.length>0?e.editor.wizardCommands[0]:!1;return}},e.saveAndTest=function(h,u){t.save(),h==="wizardCommands"&&(t.refreshWizards(),n.send("sendWizardCommand",{uuid:e.selectedWizardCommand.uuid})),h==="quickCommands"&&n.send("sendQuickCommand",{name:e.selectedCommand.name})},e.$on("config",function(h,u){let c=e.selectedWizardCommand;t.refreshWizards();let f=e.editor.wizardCommands.findIndex(d=>d.command==c.command);f===-1?e.selectedWizardCommand=e.editor.wizardCommands.length>0?e.editor.wizardCommands[0]:!1:e.selectWizardCommand(e.editor.wizardCommands[f])}),e.$on("$destroy",()=>{r.setOverride("fullscreen",!1)}),e.$watch("formGCodes.$valid",function(){e.formGCodes&&t.setError("gcodes",e.formGCodes.$invalid)})}]).controller("PrinterConfigRecoverController",["RSPrinterConfig","$scope",function(t,e){e.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},e.activeScript=e.config.scriptNames[0],e.selectedCommand=!1,e.selectScript=function(i){e.activeScript=i},e.selectQuickCommand=function(i){e.selectedCommand=i},e.addQuickCommand=function(){e.selectedCommand={name:"",command:"",script:""},e.editor.quickCommands.push(e.selectedCommand)},e.delQuickCommand=function(i){i||(i=e.selectedCommand);for(let r=0;r<e.editor.quickCommands.length;r++)if(e.editor.quickCommands[r]===i){e.editor.quickCommands.splice(r,1),e.selectedCommand=!1;return}},e.quickUp=function(i){let r=e.editor.quickCommands[i];e.editor.quickCommands[i]=e.editor.quickCommands[i-1],e.editor.quickCommands[i-1]=r},e.$watch("formRescue.$valid",function(){e.formRescue&&t.setError("rescue",e.formRescue.$invalid)})}]).controller("PrinterConfigShapeController",["RSPrinterConfig","$scope","$timeout","RSPrinter","$rootScope",function(t,e,i,r,n){let o=null;e.sizeWarning=!1;let a=null,l=null,h=null,u=0;e.percentSlider={floor:0,ceil:100,step:1,precision:0,enforceStep:!0,showTicks:10,translate:function(g){return g.toFixed(0)}};function c(){if(!a)return;l=angular.copy(a);let g=o.x0,p=o.y0;l.forEach(_=>{if(_.m)for(let x=0;x<_.m.length;x++)_.m[x].x+=g,_.m[x].y+=p})}function f(){o&&l&&(u+=.2,u>100&&(u=0),o.drawPreviewLayer(l,u))}async function d(){let g=await J_.default.get("/img/demolayer.json");g.status===200&&(a=g.data,c(),h=setInterval(f,25))}function m(){if(o){let g=e.editor.shape.basicShape,p=e.editor.movement;e.sizeWarning=!1,g.shape==="rectangle"||g.shape==="zbelt"?(g.xMin<p.xMin||g.xMax>p.xMax||g.yMin<p.yMin||g.yMax>p.yMax)&&(e.sizeWarning="Кровать больше, чем определенная зона досягаемости. Это может привести к неожиданной интерпретации возможных положений предметов на кровати!"):(-g.radius<p.xMin||g.radius.xMax>p.xMax||-g.radius<p.yMin||g.radius>p.yMax)&&(e.sizeWarning="Кровать больше, чем определенная зона досягаемости. Это может привести к неожиданной интерпретации возможных положений предметов на кровати!"),o.zoomEnabled=!0,o.pc=e.editor,o.drawBed(),o.fitBed(),c(),o.render(),v()}}e.setPreview=function(g){o=g,m(),g&&(g.loadTexture(),a||d())},e.uploadBedImage=async function(g){let p=g.target.files;if(p.length){let _=p[0],x=_.name.substr(_.name.length-3).toLowerCase();if(x!=="svg"&&x!=="png")return;let b={headers:{"Content-Type":"multipart/form-data"},maxContentLength:1/0,maxBodyLength:1/0},y=new FormData;y.append("filename",_);let w="/printer/bed/"+n.activeSlug+"/upload_image";(await J_.default.post(w,y,b)).data.ok&&(e.editor.shape.imageExtension=x,await t.save(!1),e.editor=t.config,g.target.value="",o.pc=e.editor,o.loadTexture())}},e.deleteBedImage=async function(){let g={maxContentLength:1/0,maxBodyLength:1/0},p=new FormData,_="/printer/bed/"+n.activeSlug+"/del_image";(await J_.default.post(_,p,g)).data.ok&&(e.editor.shape.imageExtension="",await t.save(!1),e.editor=t.config,o.pc=e.editor,o.loadTexture())};let v=function(){if(!o)return;let g=$(window).height();document.body.clientWidth>=992&&g>300?$("#shapePreview").css("height",g-200+"px"):$("#shapePreview").css("height","50vh")};e.$on("windowResized",function(){v()}),v(),e.$on("$destroy",function(){h&&clearInterval(h)}),e.$watch("formShape.$valid",function(g){typeof g!="undefined"&&t.setError("shape",e.formShape.$invalid)}),e.$watchCollection("editor.shape",function(){m()}),e.$watchCollection("editor.shape.basicShape",function(){m()}),e.$watchCollection("editor.movement",function(){m()}),i(r.updateFirmwareAutoset,100)}]).controller("ConfigWizardController",["RSPrinterConfig","$scope","$timeout","RSPrinter","RSFirmware","Confirm","$state","RSPrinters","Flash","$rootScope","RSCom","$interval","$sce","KlipperDialog",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m){let v=function(){!e.editor||!e.editor.connection||!e.editor.connection.serial||(e.portWarning=l.printersUsingPort(e.editor.connection.serial.device,u.activeSlug),e.portWarning&&d.trustAsHtml(e.portWarning),e.editor.connection.connectionMethod===0&&e.isKlipper?c.send("hasKlipperApi",{port:e.editor.connection.serial.device}).then(function(E){E.hasApi?e.klipperApiWarning=!1:e.klipperApiWarning=" В настоящее время виден только обычный порт. Чтобы обеспечить наилучший опыт работы с Klipper, мы рекомендуем включить сокет API и настроить его так, чтобы он указывал на @, для оптимальной производительности.".replace("@",`'${e.editor.connection.serial.device}.api'`)},()=>{}):e.klipperApiWarning=!1)};e.klipperApiWarning=!1,e.didInstallKlipper=!1,e.menuPort=!1,e.step=1,e.substep=0,e.newprinter={name:"",slug:""},e.editor=t.config,w(),e.config=t,window.rsc=t,e.firmware=n,e.connectionDataWrong=!1,e.portWrong=!1,e.autodetectingBaudrate=!1,e.autodetectingBaudrateFailed=!1,e.testBaudrate=115200,e.extruder={num:1,diameter:1.75,bed:!1},e.correctResponse=!0,e.correctFirmware=!0,e.correctFirmwareName="",e.progress=5,e.extras={heatedBed:!1,heatedChamber:!1},e.wizardsToInstall={},e.baudrates=[{id:0,t:"Автоопределение"},{id:19200,t:"19200 бод"},{id:38400,t:"38400 бод"},{id:56e3,t:"56000 бод"},{id:57600,t:"57600 бод"},{id:76800,t:"76800 бод"},{id:111112,t:"111112 бод"},{id:115200,t:"115200 бод"},{id:230400,t:"230400 бод"},{id:25e4,t:"250000 бод"},{id:256e3,t:"256000 бод"},{id:460800,t:"460800 бод"},{id:5e5,t:"500000 бод"},{id:1e6,t:"1000000 бод"}],e.conMethods=[{i:0,n:"Последовательное соединение"},{i:1,n:"Pipe\/UNIX Socket"},{i:2,n:"Подключение по TCP\/IP"},{i:3,n:"DuetControlServer"}],e.serverSettings.ServerOS===0&&(e.conMethods.splice(1,1),e.conMethods.splice(2,1)),e.resetOrder=[{i:-1,n:"Автоопределение"},{i:0,n:"От низкого к высокому"},{i:1,n:"От высокого к низкому"},{i:2,n:"Низкий"},{i:3,n:"Высокие"}],e.rtsDtrTestOrder=[0,1];let g=0,p=[115200,25e4,230400,256e3,1e6,76800,38400,19200,57600,56e3],_=0,x=null;function b(){c.send("getKlipperStatus",{}).then(E=>{e.klipper=E,e.didInstallKlipper=!1,e.klipper.installations.forEach(T=>{e.didInstallKlipper|=T===e.newprinter.slug})},()=>{})}b(),e.installKlipper=function(){m("install",e.newprinter.slug).then(()=>{b(),e.editor.connection.serial.device="/var/lib/klipper/sockets/"+e.newprinter.slug})},e.uninstallKlipper=function(){m("uninstall",e.newprinter.slug).then(()=>{b()})};let y=f(function(){e.step===2&&t.refreshPorts()},1500);e.$on("$destroy",function(){f.cancel(y),e.substep=-1});function w(){n.firmwareInfo.forEach(E=>{E.name===e.editor.general.firmwareName&&(e.editor.general.firmwareInfo=E)}),e.isKlipper=e.editor.general.firmwareInfo?e.editor.general.firmwareInfo.style==="klipper":!1}e.$on("config",function(E,T){T.data.general.slug===e.newprinter.slug&&(u.printerConfig[T.data.general.slug]=T.data,t.selectPrinter(e.newprinter.slug).then(function(){e.editor=t.config,w();let A="";e.step===1&&(angular.forEach(t.ports,function(C){A===""&&(C.indexOf("/dev/tty.usbmodem")===0||C.indexOf("COM")===0||C.indexOf("/dev/serial/by-id")===0)&&(A=C)}),A!==""&&(e.editor.connection.serial.device=A),e.editor.connection.serial.baudrate=0,e.step=2)}))}),e.step1=function(){e.autodetectingBaudrate=!1,e.autodetectingBaudrateFailed=!1,e.autodetectRts="",e.autodetectDtr="",e.newprinter.errors={},e.newprinter.name.length===0&&(e.newprinter.errors.name="Имя принтера не дано."),!(Object.keys(e.newprinter.errors).length>0)&&(e.newprinter.slug=l.autocreateSlug(e.newprinter.name),c.send("createConfiguration",e.newprinter))},e.$watch("editor.connection.connectionMethod",E=>{E===0&&v(),E===3&&(e.editor.connection.pipe.file="/var/run/dsf/dcs.sock"),E===1&&(e.editor.connection.pipe.file==="/var/run/dsf/dcs.sock"||e.editor.connection.pipe.file==="/run/dsf/dcs.sock")&&(e.editor.connection.pipe.file="")});let S=function(){let E=e.conTests[g];e.editor.connection.serial.baudrate=e.testBaudrate=E.baud,e.editor.connection.serial.rts=E.rts,e.editor.connection.serial.dtr=E.dtr,angular.forEach(e.resetOrder,function(T){T.i===E.dtr&&(e.autodetectDtr=T.n),T.i===E.rts&&(e.autodetectRts=T.n)}),t.save(!1),e.editor=t.config,w()},R=function(){if(x=null,_++,e.active.status&&e.active.status.online===1){console.log("connection found - fetching settings"),e.substep=2,e.autodetectingBaudrate=!1,i(r.updateFirmwareSettings().then(function(){if(r.firmwareSettings.hasOwnProperty("extruderCountSend"))e.extruder.num=r.firmwareSettings.extruderCountSend;else{let E=0;for(;r.firmwareSettings.hasOwnProperty("extrMaxSpeed["+E+"]");)E++;E>0&&(e.extruder.num=E)}t.save(!1),e.editor=t.config,w(),r.firmwareSettings.hasOwnProperty("firmwareCommunicationWorking")&&r.firmwareSettings.firmwareCommunicationWorking?r.firmwareSettings.hasOwnProperty("differentFirmware")?(e.correctFirmware=!1,e.correctFirmwareName=r.firmwareSettings.differentFirmware,e.substep=0):e.step3Start():(e.correctResponse=!1,e.substep=0),r.firmwareSettings.hasOwnProperty("differentFirmware")&&(e.correctFirmware=!1,e.correctFirmwareName=r.firmwareSettings.differentFirmware,e.substep=0)}),200);return}_>70&&e.active.status.online===2&&(e.autodetectingBaudrate&&e.editor.connection.connectionMethod===0?g<e.conTests.length-1?(g++,_=-20,S(),e.progress++):(e.autodetectingBaudrateFailed=!0,e.autodetectingBaudrate=!1):(e.editor.connection.connectionMethod===0?e.connectionDataWrong=!0:e.portWrong=!0,e.substep=0)),_>120&&(e.editor.connection.connectionMethod===0?e.connectionDataWrong=!0:e.portWrong=!0,e.substep=0),e.substep===1&&(x=i(R,200))};e.step2=function(){e.substep=1,e.progress=20,e.portWrong=!1,e.connectionDataWrong=!1,e.autodetectingBaudrate=!1,e.autodetectingBaudrateFailed=!1,e.editor=t.config,e.editor.general.firmwareName=e.editor.general.firmwareInfo.name,w(),e.conTests=[],e.curTest=0,e.correctResponse=!0,e.correctFirmware=!0,e.editor.general.firmwareInfo.style==="klipper"&&(e.editor.connection.serial.baudrate=115200,e.editor.connection.serial.rts=2,e.editor.connection.serial.dtr=2,e.conTestMode=3);function E(C,M){e.editor.connection.serial.rts===-1?e.conTests.push({baud:C,dtr:M,rts:M}):e.conTests.push({baud:C,dtr:M,rts:e.editor.connection.serial.rts})}function T(C,M){e.editor.connection.serial.rts===-1&&e.conTests.push({baud:C,dtr:M,rts:1-M})}function A(C){e.editor.connection.serial.dtr===-1?(E(C,e.rtsDtrTestOrder[0]),E(C,e.rtsDtrTestOrder[1]),T(C,e.rtsDtrTestOrder[0]),T(C,e.rtsDtrTestOrder[1])):E(C,e.editor.connection.serial.dtr)}if(e.conTests=[],e.editor.connection.connectionMethod===0){if(e.editor.connection.serial.baudrate===0)for(let C=0;C<p.length;C++)A(p[C]);else A(e.editor.connection.serial.baudrate);e.conTests.length>1&&(e.autodetectingBaudrate=!0,e.autodetectingBaudrateFailed=!1),g=0,S(),console.log("Tests",JSON.stringify(e.conTests))}else e.editor.connection.connectionMethod===3?(e.editor.connection.serial.inputBufferSize=8e3,e.editor.connection.serial.maxParallelCommands=24,e.editor.connection.serial.pingPong=!1,t.save(!1),e.editor=t.config,w()):(t.save(!1),e.editor=t.config,w());_=0,v(),e.connectionDataWrong=!1,x==null&&(x=i(R,200))},e.step4=function(){e.progress=65,e.step=5;let E=t.config,T=r.firmwareSettings;t.config.shape.basicShape.shape==="rectangle"||t.config.shape.basicShape.shape==="zbelt"?(T.hasOwnProperty("printerType")||(t.config.general.printerVariant="cartesian"),T.hasOwnProperty("XMin")||(t.config.movement.xMin=E.shape.basicShape.xMin,T.hasOwnProperty("XLength")||(t.config.movement.xMax=E.shape.basicShape.xMax)),T.hasOwnProperty("YMin")||(t.config.movement.yMin=E.shape.basicShape.yMin,T.hasOwnProperty("YLength")||(t.config.movement.yMax=E.shape.basicShape.yMax))):(T.hasOwnProperty("printerType")||(E.general.printerVariant="delta"),T.hasOwnProperty("XMin")||(t.config.movement.xMin=-E.shape.basicShape.radius,t.config.movement.xMax=E.shape.basicShape.radius),T.hasOwnProperty("YMin")||(t.config.movement.yMin=-E.shape.basicShape.radius,t.config.movement.yMax=E.shape.basicShape.radius)),t.save(!1),e.editor=t.config,w(),e.editor.extruders=[];for(let A=0;A<e.extruder.num;A++){let C={filamentDiameter:e.extruder.diameter,cooldownPerSecond:.5,extrudeSpeed:2,heatupPerSecond:2,tempMaster:A,acceleration:5e3,lastTemp:0,maxTemp:260,offsetX:0,offsetY:0,offset:0,eJerk:30,maxSpeed:30,toolType:0,toolDiameter:.4,supportTemperature:!0,retractSpeed:30,changeFastDistance:20,changeSlowDistance:20,temperatures:[{name:"ABS 245",temp:245},{name:"PLA 210",temp:210},{name:"PLA 195",temp:195}]},M="["+A+"]";T.hasOwnProperty("extrAcceleration"+M)?C.acceleration=T["extrAcceleration"+M]:T.hasOwnProperty("extrAcceleration")&&(C.acceleration=T.extrAcceleration),T.hasOwnProperty("extrMaxSpeed"+M)?C.maxSpeed=T["extrMaxSpeed"+M]:T.hasOwnProperty("extrMaxSpeed")&&(C.maxSpeed=T.extrMaxSpeed),T.hasOwnProperty("extrJerk"+M)?C.eJerk=T["extrJerk"+M]:T.hasOwnProperty("extrJerk")&&(C.eJerk=T.extrJerk),C.retractSpeed>C.maxSpeed&&(C.retractSpeed=C.maxSpeed),e.editor.extruders.push(C)}T.hasOwnProperty("hasHeatedBed")&&(e.extras.heatedBed=T.hasHeatedBed),T.hasOwnProperty("hasHeatedChamber")&&(e.extras.heatedChamber=T.hasHeatedChamber)},e.step5=function(){e.progress=80,e.editor.extruders=[];let E=r.firmwareSettings;for(let T=0;T<e.extruder.num;T++){let A={filamentDiameter:e.extruder.diameter,cooldownPerSecond:.5,extrudeSpeed:2,heatupPerSecond:2,tempMaster:T,supportTemperature:!0,acceleration:5e3,lastTemp:0,maxTemp:260,offsetX:0,offsetY:0,eJerk:30,maxSpeed:30,retractSpeed:30,toolType:0,toolDiameter:.4,changeFastDistance:20,changeSlowDistance:20,temperatures:[{name:"ABS 255",temp:255},{name:"PLA 215",temp:215},{name:"PET 230",temp:230}]},C="["+T+"]";E.hasOwnProperty("extrAcceleration"+C)?A.acceleration=E["extrAcceleration"+C]:E.hasOwnProperty("extrAcceleration")&&(A.acceleration=E.extrAcceleration),E.hasOwnProperty("extrMaxSpeed"+C)?A.maxSpeed=E["extrMaxSpeed"+C]:E.hasOwnProperty("extrMaxSpeed")&&(A.maxSpeed=E.extrMaxSpeed),E.hasOwnProperty("extrJerk"+C)?A.eJerk=E["extrJerk"+C]:E.hasOwnProperty("extrJerk")&&(A.eJerk=E.extrJerk),A.retractSpeed>A.maxSpeed&&(A.retractSpeed=A.maxSpeed),e.editor.extruders.push(A)}e.step=6,t.save(!1),e.editor=t.config,w()},e.step6=function(){e.editor=t.config,w(),e.progress=90,e.extras.heatedBed&&e.editor.heatedBeds.length===0?e.editor.heatedBeds.push({cooldownPerSecond:.02,heatupPerSecond:.2,offset:0,alias:"",lastTemp:0,maxTemp:120,temperatures:[{name:"ABS",temp:100},{name:"PLA",temp:60},{name:"PET",temp:55}]}):e.extras.heatedBed===!1&&(e.editor.heatedBeds=[]),e.extras.heatedChamber&&e.editor.heatedChambers.length===0?e.editor.heatedChambers.push({heatupPerSecond:.1,lastTemp:0,maxTemp:110,offset:0,alias:"",cooldownPerSecond:.1,temperatures:[]}):e.extras.heatedChamber===!1&&(e.editor.heatedChambers=[]),e.editor.fans=[];for(let D=0;D<e.editor.general.numFans;D++)e.editor.fans.push({pos:0,min:0,max:100,firmwareId:D,readOnly:!1,fanType:0,alias:"",firmwareName:""});let E=`M400 ; Wait for current moves to finish, clearing the buffer
`,T,A=t.config;for(T=0;T<e.editor.extruders.length;T++)E+="M104 T"+T+` S0 ; Disable extruder
`;e.editor.heatedBeds.length>0&&(E+=`M140 S0 ; Disable bed
`),e.editor.heatedChambers.length>0&&(E+=`M141 S0 ; Disable chamber
`);let C=`G91
@if {{state.pos_z + 5 < config.move_z_max }}
G1 Z5 F600
@endif
G90
`,M=`M84 ; Disable motor
`;t.config.shape.basicShape.shape==="rectangle"||t.config.shape.basicShape.shape==="zbelt"?(C="G1 X"+A.shape.basicShape.xMin+" Y"+A.shape.basicShape.yMax+` F9000
`,t.config.shape.basicShape.shape==="zbelt"&&(M=`; M84 ; Disable motor
`)):(A.general.printerVariant==="delta"&&(M=`; M84 ; Disable motor
`),C+="G1 X0 Y-"+A.shape.basicShape.radius+` F9000
`),t.scripts.activate=`; Runs when printer gets activated.
; At that point the printer is often not connected, so you should only use server commands here.
`,t.scripts.deactivate=`; Runs when printer gets deactivated.
; At that point the printer is likely not connected, so you should only use server commands here.
; Also runtime is limited to 5 seconds until a connection is forced to go down.
`,t.scripts.end=`; Sample end code - modify to your needs!
`+E+C+M,t.scripts.kill=`; Sample stop code - modify to your needs!
`+E+C+M,t.scripts.pause=`; Sample pause code - modify to your needs!
M83 ; relative extrusion mode
G1 E-3 F1800 ; Retract a bit to reduce oozing
`+C,t.scripts.insert_filament_finished=`; Retract to be at same retraction with new filament
; as you would be after pause start.
; Remove if you also remove the corresponding line in pause event script.
@ifPaused
G92 E0
G1 E-3 F1800
G92 E0 ; // continue will restore old extruder position
@endif        
        `,console.log("wizardsToInstall",e.wizardsToInstall),angular.forEach(e.wizardsToInstall,(D,O)=>{if(D){let P=e.editor.wizardTemplates.find(L=>L.uuid===O);console.log("adding",P),e.editor.wizardCommands.push(P)}}),t.save(!1),e.editor=t.config,w(),h.success("Настройка принтера завершена."),e.editor.general.firmwareInfo.style==="klipper"&&e.didInstallKlipper?a.go("printer.klipperConfig",{slug:e.editor.general.slug}):a.go("home")},e.portWarning=!1,e.$watch("editor.connection.serial.device",function(){v()}),e.$watch("editor.general.firmwareInfo",function(){e.isKlipper=e.editor.general.firmwareInfo?e.editor.general.firmwareInfo.style==="klipper":!1,v()}),e.abort=function(){if(e.step===1){a.go("home");return}o("Прервать мастер","Отмена конфигурации мастера удалит параметры, созданные в процессе. Действительно прервать?",!1,!1,!0).then(function(){c.send("removeConfiguration",{slug:e.newprinter.slug}).then(function(){delete u.printerConfig[e.newprinter.slug],delete u.printer[e.newprinter.slug],h.success("Мастер конфигурации прерван"),a.go("home")})})},e.conTestMode=0,e.testsOpen=0,e.openConTests=[],e.conTestResults=[],e.sendNextTest=function(){if(e.openConTests.length>0){let E=e.openConTests.shift();e.runningTest=E,c.send("communicationTest",E).then(function(){},function(){e.testsOpen--})}},e.$on("communicationTestResult",function(E,T){e.progress+=5,!T.data.error&&T.data.resendsShort<.5&&T.data.resends<.5&&T.data.resends<.5?T.data.bgClass="bg-success":!T.data.error&&T.data.resendsShort<1&&T.data.resends<1&&T.data.resends<1?T.data.bgClass="bg-warning":T.data.bgClass="bg-danger",e.conTestResults.push(T.data),e.testsOpen--,e.sendNextTest()}),e.step3=function(E){e.editor.connection.serial.pingPong=E.pingPong,e.editor.connection.serial.inputBufferSize=E.bufferSize,e.step=4,e.progress=65,t.save(!1)},e.step3Start=function(){if(e.editor.connection.connectionMethod===3){e.step=4,e.progress=65,t.save(!1);return}switch(e.progress=30,e.conTestMode){case 1:e.step3({pingPong:!0,bufferSize:127});return;case 2:e.step3({pingPong:!1,bufferSize:63});return;case 3:e.step3({pingPong:!1,bufferSize:127});return;case 4:e.step3({pingPong:!1,bufferSize:255});return}e.step=3,e.openConTests=[{pingPong:!0,buffer:127,parallelCommands:0},{pingPong:!1,buffer:63,parallelCommands:0},{pingPong:!1,buffer:127,parallelCommands:0},{pingPong:!1,buffer:255,parallelCommands:0}];let E=e.editor.connection.serial.inputBufferSize;!e.editor.connection.serial.pingPong&&E!==63&&E!==127&&E!==255&&E!==511&&e.openConTests.push({pingPong:e.editor.connection.serial.pingPong,buffer:e.editor.connection.serial.inputBufferSize,parallelCommands:0}),e.testsOpen=e.openConTests.length,e.sendNextTest()},e.repeatTests=function(){e.conTestResults=[],e.progress-=20,e.step3Start()}}]);RSPrinterModule.component("rsSidebarTemperatures",{templateUrl:"/views/printer/control/RsSidebarTemperatures.php?lang="+window.lang,controller:["$rootScope","User",function(t,e){this.mopen={},this.closeMenu=function(i){this.mopen[i]=!1},this.canPrint=e.printPermission,this.idle=!0,this.printing=!1,t.$watch("active.state.isJobActive",()=>{!t.active||!t.active.state||(this.printing=t.active.state.isJobActive,this.idle=t.active.status.paused||!t.active.state.isJobActive)}),t.$watch("active.status.paused",()=>{!t.active||!t.active.state||!t.active.status||(this.idle=t.active.status.paused||!t.active.state.isJobActive)})}]});RSPrinterModule.component("rsSidebarExtrude",{templateUrl:"/views/printer/control/RsSidebarExtrude.php?lang="+window.lang,controller:["$rootScope","User",function(t,e){this.canPrint=e.canPrint(),this.retractSpeed=10,this.extrudeSpeed=2,this.extrudeDistance=10;let i=()=>{if(!t.active||!t.active.state)return;let r=t.active.state.activeExtruder,n=t.active.state.extruder?t.active.state.extruder.length:0;r!==void 0&&n>0&&(r=Math.min(r,n-1),this.retractSpeed=t.activeConfig.extruders[r].retractSpeed,this.extrudeSpeed=t.activeConfig.extruders[r].extrudeSpeed)};t.$watch("active.state.activeExtruder",i),i()}]});RSPrinterModule.component("rsSidebarWebcam",{template:`<div>
<div class="row">
            <div class="col-sm-12" style="text-align: center;position:relative">
            <div style="position: relative;max-width:300px;display: inline-block">
              <img ng-src="{{$root.RSPrinter.printingImage('m')}}" style="width:100%;max-height:201px;max-width:268px;margin-right:10px;" ng-hide="($root.update.free && $ctrl.showWebcam) || !$ctrl.printing" ng-click="$ctrl.setShowWebcam(true)">
              <websocket-camera img-url="{{$ctrl.webcamUrl}}" img-style="width:100%;" rotate="$ctrl.webcamRotate" ng-show="$root.update.free && ($ctrl.showWebcam || !$ctrl.printing)" ng-click="$ctrl.toggleWebcam()"></websocket-camera>
              <img class="reccam" src="/img/REC.png" ng-show="$root.active.state.webcams[$ctrl.activeCam].rec && ($root.update.free && ($ctrl.showWebcam || !$ctrl.printing))" title="Захват" style="left:90%; position: absolute;width:21px;height:21px;top:5px">
              </div>
            </div>
            <div class="col-sm-12 margin-top" ng-if="$ctrl.printing">
                              <div class="progress active" style="margin-bottom: 0">
                    <div class="metertext">{{$root.active.status.done | number:2}}%</div>
                    <div class="progress-bar progress-bar-success" role="progressbar"
                         style="width:{{$root.active.status.done}}%"></div>
                  </div>

              <ul class="list-group condensed" style="margin-bottom:0">
                <li class="list-group-item no-border">
                  <i class="fa fa-clock-o rs-bigtab"></i> ETA
                  <span class="pull-right">{{($root.stateTime + 1000*($root.active.status.printTime-$root.active.status.printedTimeComp))
                        | date:'short'}}</span></li>
                <li class="list-group-item no-border">
                  <i class="fa fa-clock-o rs-bigtab"></i> ETE
                  <span class="pull-right">{{$root.active.status.printTime-$root.active.status.printedTimeComp | dhms}}</span>
                </li>
                <li class="list-group-item no-border">
                  <i class="fa fa-arrows-v rs-bigtab"></i> Положение по Z
                  <span class="pull-right">{{$root.active.state.z | number:2}} mm</span></li>
                <li class="list-group-item no-border">
                  <i class="fa fa-arrows-v rs-bigtab"></i> Слой
                  <span class="pull-right">{{$root.active.state.layer}} / {{$root.active.status.ofLayer}}</span>
                </li>
              </ul>
            </div>
          </div>
          <div class="row" ng-if="$root.user.fullStopPermission && $ctrl.printing">
            <div class="col-xs-6">
              <button ng-click="$ctrl.stopPrint()" class="btn btn-danger btn-block btn-sm">
                <i
                            class="fa fa-stop"></i> Стоп
              </button>
            </div>
            <div class="col-xs-6">
              <button ng-if="!$root.active.status.paused" ng-click="$root.RSPrinter.pausePrint()" class="btn btn-primary btn-block btn-sm">
                <i
                            class="fa fa-pause"></i>
                  Пауза
              </button>
              <button ng-show="$root.user.printPermission && $root.active.status.paused" ng-click="$root.RSPrinter.unpausePrint()" ng-disabled="$root.active.status.pauseState==3" class="btn btn-primary btn-block btn-sm">
                <i
                            class="fa fa-play"></i>
                {{$root.RSPrinter.pauseNames[$root.active.status.pauseState]}}
              </button>
            </div>
          </div>
</div>
  `,controller:["$rootScope","User","RSCom","Confirm","$scope",function(t,e,i,r,n){this.showWebcam=!1,this.webcamUrl="/img/empty.png",this.showTimelapseSettings=!1,this.webcamRotate=0,this.webcammode=0,this.activeCam=0,this.stopped=!1,this.hasWebcam=t.activeConfig.webcams.length>0&&t.activeConfig.webcams[this.activeCam].method!==0;let o=!1,a="";this.stopOldStream=()=>{a.length>0&&(i.send("webcamCloseStream",{wcid:a}),a="")},this.stopPrint=()=>{r("Требуется подтверждение","Действительно остановить текущую печать?","Да","Нет",!0).then(function(){t.active.status.jobid&&i.send("stopJob",{id:t.active.status.jobid})})},this.setShowWebcam=(u,c)=>{c&&(c.preventDefault(),c.stopPropagation()),(!this.hasWebcam||!t.update.free||!this.visible)&&(u=!1),!u&&this.printing===!1&&this.visible&&(u=!0),this.showWebcam!==u&&(this.showWebcam=u,u&&t.activeConfig.webcams[this.activeCam]?(t.activeConfig.webcams[this.activeCam].method&2)===2?(this.webcammode=2,this.enableMode2=!0,this.stopOldStream(),a=RSUtils.createAlphaID(10),this.webcamUrl="/printer/cammjpg/"+t.activeSlug+"?cam="+this.activeCam+"&wcid="+a,this.webcamRotate=t.activeConfig.webcams[this.activeCam].orientation):(t.activeConfig.webcams[this.activeCam].method&1)===1?(this.webcammode=1,this.enableMode1=!0,o||(h(),o=!0)):(this.webcamUrl="/img/nowebcam.png",this.webcamRotate=0):this.webcamUrl="/img/empty.png"),u||(this.webcamUrl="/img/empty.png")},this.toggleWebcam=()=>{if(t.activeConfig.webcams.length===1)this.setShowWebcam(!1);else{if(this.activeCam++,this.activeCam>=(t.isPro()?t.activeConfig.webcams.length:1)&&(this.activeCam=0,this.printing)){this.setShowWebcam(!1);return}(t.activeConfig.webcams[this.activeCam].method&2)===2?(this.enableMode2=!0,this.stopOldStream(),a=RSUtils.createAlphaID(10),this.webcamUrl="/printer/cammjpg/"+t.activeSlug+"?cam="+this.activeCam+"&wcid="+a,this.webcamRotate=t.activeConfig.webcams[this.activeCam].orientation):(t.activeConfig.webcams[this.activeCam].method&1)===1?(this.webcammode=1,this.enableMode1=!0,o||(h(),o=!0)):this.webcamUrl="/img/nowebcam.png"}};let l=()=>{this.webcamUrl="/printer/camjpg/"+t.activeSlug+"?cam="+this.activeCam+"&rand="+RSUtils.createAlphaID(10)},h=()=>{if(l(),this.webcammode!==1){o=!1;return}this.stopped||$timeout(h,1e3*t.activeConfig.webcams[this.activeCam].reloadInterval)};this.jobChanged=(u,c)=>{c.printer===t.activeSlug&&this.setShowWebcam(!this.printing)},this.subscriptions=[],this.$onDestroy=()=>{this.webcammode=0,this.webcamUrl="",this.stopped=!0,this.webcam.comp=null,this.subscriptions.forEach(u=>u())},this.$onInit=()=>{this.subscriptions.push(t.$on("jobDeactivated",this.jobChanged)),this.subscriptions.push(t.$on("jobStarted",this.jobChanged)),this.webcam.comp=this,this.setShowWebcam(!this.printing)}}],bindings:{webcam:"=",printing:"<",visible:"<"}});RSPrinterModule.component("rsSidebarMove",{templateUrl:"/views/printer/control/RsSidebarMove.php?lang="+window.lang,bindings:{data:"="},controller:["$rootScope","$scope","User",function(t,e,i){e.printing=t.active.state.isJobActive,e.idle=t.active.status.paused||!t.active.state.isJobActive,e.$watch("active.state.isJobActive",function(){!e.active||!e.active.state||(e.printing=t.active.state.isJobActive,e.idle=t.active.status.paused||!t.active.state.isJobActive)})}]});RSPrinterModule.component("rsTemperatures",{template:`<div ng-if="$root.active.state.extruder">
<div class="table-responsive">
  <table class="table table-hover table-striped">
    <tr>
      <th style="width:40px"><rs-icon icon="fa fa-eye"></rs-icon></th>
      <th style="width:40px"></th>
      <th>Имя</th>
      <th>Питание</th>
      <th>Текущий</th>
      <th>Цель</th>
    </tr>
    <tr ng-repeat="e in $root.activeConfig.extruders track by 'e'+$index" ng-if="e.supportTemperature">
      <td><input type="checkbox" ng-model="$root.active.tempSettings.extruders[$index].show"></td>
      <td style="text-align: center"><i ng-class="$root.RSPrinter.extruderIcon($index)"></i></td>
      <td>{{$root.RSPrinter.extruderName($index)}}</td>
      <td>{{$ctrl.extruderOutput($index)}}</td>
      <td>{{$ctrl.asTemp($root.active.state.extruder[$index])}}</td>
      <td>
        <div ng-if="$root.user.printPermission" class="btn-group" rs-dropdown dropdown-append-to-body style="margin-top: -7px;margin-bottom: -7px;max-width: 100%;margin-right:10px" is-open="$ctrl.menuList['E'+$index]">
          <button type="button" class="btn btn-default btn-sm" rs-dropdown-toggle style="width: 100px">
            {{$ctrl.asTempSet($root.active.state.extruder[$index])}}
            <span class="caret"></span>
          </button>
          <ul rs-dropdown-menu role="menu" style="text-align: left">
            <li ng-click="$event.stopPropagation()" style="height:80px">
              <knob min="0" max="{{e.maxTemp}}" value="$root.active.state.extruder[$index].tempSet" changed="$root.RSPrinter.setExtruderTemperature($index,value)"></knob>              
            </li>
            <li class="divider"></li>
            <li>
              <a href="javascript:void(0)" ng-click="$ctrl.closeMenu('E'+$index);$ctrl.extrudeDialog($index)" a-disabled="!($root.active.status.paused || !$root.active.state.isJobActive)">Выдавливание &amp; откат</a>
            </li>
            <li>
              <a href="javascript:void(0)" ng-click="$root.RSPrinter.setExtruderTemperature($index,0);$ctrl.closeMenu('E'+$index)">Выкл</a>
            </li>
            <li class="divider" ng-show="e.temperatures.length>0"></li>
            <li ng-repeat="t in e.temperatures track by $index">
               <a href="javascript:void(0)"
                 ng-click="$root.RSPrinter.setExtruderTemperature($parent.$index,t.temp);$ctrl.closeMenu('E'+$parent.$index)">{{t.name}}</a>
            </li>
          </ul>
        </div>
        <div ng-show="!$root.user.printPermission">{{$ctrl.asTempSet($root.active.state.extruder[$index])}}</div>
    </td>
    </tr>
    <tr ng-repeat="e in $root.activeConfig.heatedBeds track by 'b'+$index">
      <td><input type="checkbox" ng-model="$root.active.tempSettings.heatedBeds[$index].show"></td>
      <td style="text-align: center"><i class="rs rs-bed"></i></td>
      <td>Подогреваемый стол</td>
      <td>{{$ctrl.bedOutput($index)}}</td>
      <td>{{$ctrl.asTemp($root.active.state.heatedBeds[$index])}}</td>
      <td>
        <div ng-if="$root.user.printPermission" class="btn-group" rs-dropdown dropdown-append-to-body style="max-width: 100%;margin-right:10px;margin-bottom: -7px;margin-top:-7px" is-open="$ctrl.menuList['B'+$index]">
          <button type="button" class="btn btn-default btn-sm" rs-dropdown-toggle style="width: 100px;">
            {{$ctrl.asTempSet($root.active.state.heatedBeds[$index])}}
            <span class="caret"></span>
          </button>
          <ul rs-dropdown-menu role="menu" style="text-align: left">
            <li ng-click="$event.stopPropagation()" style="height:80px">
              <knob min="0" max="{{e.maxTemp}}" value="$root.active.state.heatedBeds[$index].tempSet" changed="$root.RSPrinter.setBedTemperature(value)"></knob>              
            </li>
            <li class="divider"></li>
            <li>
              <a href="javascript:void(0)" ng-click="$root.RSPrinter.setBedTemperature(0);$ctrl.closeMenu('B'+$index)">Выкл</a>
            </li>
            <li class="divider" ng-show="e.temperatures.length>0"></li>
            <li ng-repeat="t in e.temperatures track by $index">
               <a href="javascript:void(0)"
                 ng-click="$root.RSPrinter.setBedTemperature(t.temp);$ctrl.closeMenu('B'+$parent.$index)">{{t.name}}</a>
            </li>
          </ul>
        </div>
        <div ng-if="!$root.user.printPermission">{{$ctrl.asTempSet($root.active.state.heatedBeds[$index])}}</div>  
      </td>
    </tr>
    <tr ng-repeat="e in $root.activeConfig.heatedChambers track by 'b'+$index">
      <td><input type="checkbox" ng-model="$root.active.tempSettings.heatedChambers[$index].show"></td>
      <td style="text-align: center"><i class="rs rs-chamber"></i></td>
      <td>Камера с подогревом</td>
      <td>{{$ctrl.chamberOutput($index)}}</td>
      <td>{{$ctrl.asTemp($root.active.state.heatedChambers[$index])}}</td>
      <td>
        <div ng-if="$root.user.printPermission" class="btn-group" rs-dropdown dropdown-append-to-body style="max-width: 100%;margin-right:10px;margin-bottom: -7px;margin-top:-7px" is-open="$ctrl.menuList['C'+$index]">
          <button type="button" class="btn btn-default btn-sm" rs-dropdown-toggle style="width: 100px">
            {{$ctrl.asTempSet($root.active.state.heatedChambers[$index])}}
            <span class="caret"></span>
          </button>
          <ul rs-dropdown-menu role="menu" style="text-align: left">
            <li ng-click="$event.stopPropagation()" style="height:80px">
              <knob min="0" max="{{e.maxTemp}}" value="$root.active.state.heatedChambers[$index].tempSet" changed="$root.RSPrinter.setChamberTemperature(value)"></knob>              
            </li>
            <li class="divider"></li>
            <li>
              <a href="javascript:void(0)" ng-click="$root.RSPrinter.setChamberTemperature(0);$ctrl.closeMenu('C'+$index)">Выкл</a>
            </li>
            <li class="divider" ng-show="e.temperatures.length>0"></li>
            <li ng-repeat="t in e.temperatures track by $index">
               <a href="javascript:void(0)"
                 ng-click="$root.RSPrinter.setChamberTemperature(t.temp);$ctrl.closeMenu('C'+$parent.$index)">{{t.name}}</a>
            </li>
          </ul>
        </div>
        <div ng-if="!$root.user.printPermission">{{$ctrl.asTempSet($root.active.state.heatedChambers[$index])}}</div>  
      </td>
    </tr>
  </table>
  </div>
  <div class="margin-left margin-right">
    <div class="checkbox visible-lg">
      <label>
        <input type="checkbox" ng-model="$root.active.tempSettings.showGraphFullWidth">
        Показывайте графики температуры во всю ширину
    </label>
    </div>
    <div class="row">
     <div ng-if="e.supportTemperature && $root.active.tempSettings.extruders[$index].show" class="margin-top col-xs-12 {{$root.active.tempSettings.showGraphFullWidth ? '' : 'col-lg-6'}}" style="position: relative;overflow:hidden" ng-repeat="e in $root.activeConfig.extruders track by $index">
      <h4>
        <i ng-class="$root.RSPrinter.extruderIcon($index)"></i> {{$root.RSPrinter.extruderName($index)}}
      </h4>
      <temp-chart history="$root.active.state.extruder[$index].history" style="height:200px;width:100%"></temp-chart>
    </div>
    <div ng-if="$root.active.tempSettings.heatedBeds[0].show" class="margin-top col-xs-12 {{$root.active.tempSettings.showGraphFullWidth ? '' : 'col-lg-6'}}" style="position: relative;overflow:hidden" ng-if="$root.activeConfig.heatedBeds.length>0">
      <h4>
        <i class="rs rs-bed"></i> Подогреваемый стол
      </h4>
      <temp-chart history="$root.active.state.heatedBeds[0].history" style="height:200px;width:100%"></temp-chart>
    </div>
    <div ng-if="$root.active.tempSettings.heatedChambers[0].show" class="margin-top col-xs-12 {{$root.active.tempSettings.showGraphFullWidth ? '' : 'col-lg-6'}}" style="position: relative;overflow:hidden" ng-if="$root.activeConfig.heatedChambers.length>0">
      <h4>
        <i class="rs rs-chamber"></i> Камера с подогревом
      </h4>
      <temp-chart history="$root.active.state.heatedChambers[0].history" style="height:200px;width:100%"></temp-chart>
    </div>
    </div>
    <div class="well margin-top">
      <div class="row">
        <div class="col-xs-6 col-md-4">
          <i class="fa fa-minus" style="color:#2D7495"></i> Текущая температура</div>
        <div class="col-xs-6 col-md-4">
          <i class="fa fa-minus" style="color:#A541B4"></i> Заданная температура</div>
        <div class="col-xs-6 col-md-4">
          <i class="fa fa-area-chart" style="color:#3E714A"></i> Вывод</div>
      </div>
    </div>
  </div>
</div>`,controller:["$rootScope","User","RSCom","Confirm","$scope","$uibModal",function(t,e,i,r,n,o){this.menuList={},this.closeMenu=l=>{this.menuList[l]=!1};function a(l){return l.tempSet===0?"Выкл":l.output.toFixed(0)+"%"}this.asTemp=l=>l.tempRead===-333?"DEF":l.tempRead===-444?"DEC":l.tempRead.toFixed(1)+"\xB0C",this.asTempSet=l=>l.tempSet===0?"Выкл":l.tempSet.toFixed(0)+"\xB0C",this.extruderOutput=l=>a(t.active.state.extruder[l]),this.bedOutput=l=>a(t.active.state.heatedBeds[l]),this.chamberOutput=l=>a(t.active.state.heatedChambers[l]),this.extrudeDialog=l=>{i.send("send",{cmd:"T"+l+`
G92 E0`}),o.open({templateUrl:"/views/printer/control/printer.control.extrude.php?lang="+lang,scope:n,size:"sm",controller:["$scope",function(h){t.active.state.extruder.length>0&&(h.retractSpeed=t.activeConfig.extruders[l].retractSpeed,h.extrudeSpeed=t.activeConfig.extruders[l].extrudeSpeed),h.extrudeDistance=10}]})},this.fixExtraEntries=()=>{t.active.tempSettings||(t.active.tempSettings={extruders:[],heatedBeds:[],heatedChambers:[],showGraphFullWidth:!1});let l=t.active.tempSettings,h=t.activeConfig;for(;l.extruders.length<h.extruders.length;)l.extruders.push({show:!0});for(;l.heatedBeds.length<h.heatedBeds.length;)l.heatedBeds.push({show:!0});for(;l.heatedChambers.length<h.heatedChambers.length;)l.heatedChambers.push({show:!0})},this.$onDestroy=()=>{},this.$onInit=()=>{this.fixExtraEntries()}}]});RSPrinterModule.factory("SelectWizards",["$uibModal",function(t){return function(){let e=t.open({templateUrl:"/views/printer/dialog/selectWizards.php?lang="+lang,controller:["$scope","$uibModalInstance","$rootScope","RSPrinter","RSCom","Flash","User",function(i,r,n,o,a,l,h){i.wizards=[n.activeConfig.wizardCommands,n.activeConfig.wizardTemplates],i.wizardSelections=[{},{}],i.showSelectedButtons=[!1,!1],i.checkAll=[!1,!1],i.tabIndex=0;let u=0;angular.forEach(i.wizards,f=>{angular.forEach(f,d=>{i.wizardSelections[u][d.uuid]=!1}),u++}),a.send("refreshWizard");let c=()=>{i.checkAll[i.tabIndex]=!1,i.showSelectedButtons[i.tabIndex]=!1,angular.forEach(i.wizardSelections[i.tabIndex],(f,d)=>{i.wizardSelections[i.tabIndex][d]=!1})};i.cancel=function(){r.dismiss()},n.$on("config",function(f,d){i.wizards=[n.activeConfig.wizardCommands,n.activeConfig.wizardTemplates]}),i.selectSingleWizard=f=>{i.checkAll[i.tabIndex]=!1,i.showSelectedButtons[i.tabIndex]=!1,angular.forEach(i.wizards[i.tabIndex],d=>{let m=d.uuid===f?!i.wizardSelections[i.tabIndex][d.uuid]:i.wizardSelections[i.tabIndex][d.uuid];i.showSelectedButtons[i.tabIndex]=i.showSelectedButtons[i.tabIndex]||m})},i.selectAllWizards=()=>{if(i.wizards[i.tabIndex].length===0){i.checkAll[i.tabIndex]=!1;return}angular.forEach(i.wizards[i.tabIndex],(f,d)=>{i.wizardSelections[i.tabIndex][f.uuid]=!i.checkAll[i.tabIndex]}),i.showSelectedButtons[i.tabIndex]=!i.checkAll[i.tabIndex],i.checkAll[i.tabIndex]=!i.checkAll[i.tabIndex]},i.wizardIsInstalled=f=>{let d=!1;return angular.forEach(i.wizards[0],(m,v)=>{m.uuid===f&&(d=!0)}),d},i.uninstallWizard=f=>{f==="selected"?angular.forEach(i.wizardSelections[i.tabIndex],(d,m)=>{d&&i.wizardIsInstalled(m)&&a.send("uninstallWizard",{uuid:m})}):a.send("uninstallWizard",{uuid:f}),c()},i.installWizard=f=>{f==="selected"?angular.forEach(i.wizardSelections[i.tabIndex],(d,m)=>{d&&!i.wizardIsInstalled(m)&&a.send("installWizard",{uuid:m})}):a.send("installWizard",{uuid:f}),c()},i.deleteWizard=f=>{let d=!1;f==="selected"?angular.forEach(i.wizardSelections[i.tabIndex],(m,v)=>{angular.forEach(i.wizards[i.tabIndex],(g,p)=>{g.uuid===v&&g.source!==1&&(d=!0)}),m&&d&&a.send("deleteWizard",{uuid:v})}):(angular.forEach(i.wizards[i.tabIndex],(m,v)=>{m.uuid===f&&m.source!==1&&(d=!0)}),d&&a.send("deleteWizard",{uuid:f})),c()},i.importWizard=()=>{let f=$("#WizardFileImport"),d=f.val().replace(/\\/g,"/").replace(/.*\//,""),m=f.get(0).files[0].size;a.send("projectsCanUploadWithSize",{size:m}).then(function(v){v.ok?($("#UploadName").val(d),i.uploading=!0,a.extendPing(300),$("#wizardimport").ajaxSubmit({success:function(){l.success("Загрузка завершена"),i.uploading=!1,a.extendPing(0),f.val(""),a.send("refreshWizard"),c()},uploadProgress:function(g,p,_,x){i.uploadProgress=x},headers:{"X-Csrf-Token":a.getCookie("Csrf-Token")}}),d!==""&&f.val("")):l.error("",v.error?v.error:"Диск переполнен. Сначала удалите другие файлы.",1e4,!0)})},window.importWizard=i.importWizard,i.exportWizard=f=>{let d=[];if(f==="selected"?angular.forEach(i.wizardSelections[i.tabIndex],(m,v)=>{m&&d.push('"'+v+'"')}):d.push('"'+f+'"'),d.length!==0){let m="/printer/wizards/"+n.activeSlug+"?a=export&uuid=["+d.toString()+"]&custom=";m+=i.tabIndex===0?"1":"0",console.log(m),window.open(m,"ihelper")}}}],size:"lg"});return e.result.catch(function(i){}),e.result}}]);RSPrinterModule.factory("AdvertisementController",["$uibModal","$q","$http",function(t,e,i){return function(){let r=e.defer();return i.get("/reminder/reminder.json").then(n=>{let o=t.open({templateUrl:"/views/printer/dialog/AdvertisementDialog.php?lang="+lang,backdrop:"static",keyboard:!1,controller:["$scope","$uibModalInstance","$sce",function(a,l,h){a.sliderJSONData=n.data,a.trustedContent=[],a.slideIndex=0,a.timer=5,a.sliderJSONData.contents.forEach(f=>{f.trans[window.lang]?a.trustedContent.push(h.trustAsHtml(f.trans[window.lang])):a.trustedContent.push(h.trustAsHtml(f.trans.en))}),a.slideIndex=Math.floor(Math.random()*(a.sliderJSONData.contents.length-1));let u=["Пропустить","Закрыть","Не сейчас","Nah, I\xB4m fine","Отменить"],c=["Поддержать нас","Купить сейчас","Upgrade to pro"];a.buttonBuyText=c[Math.floor(Math.random()*c.length)],a.buttonCloseText=u[Math.floor(Math.random()*u.length)],a.moveSlide=f=>{a.slideIndex+=f,a.showSlide(a.slideIndex)},a.cancel=function(){l.close(!0)},a.$on("$destroy",()=>{r.resolve(),clearInterval(this.intervalTimer)}),a.showSlide=f=>{a.slideIndex=f,a.slideIndex<0&&(a.slideIndex=a.sliderJSONData.contents.length-1),a.slideIndex>=a.sliderJSONData.contents.length&&(a.slideIndex=0)},a.getButtonCloseText=()=>a.timer>0?"@ осталось секунд".replace("@",a.timer.toString()):a.buttonCloseText,a.startTimer=()=>{a.timer>0?a.timer--:clearInterval(this.intervalTimer)},a.automaticSlideshow=()=>{a.sliderJSONData.contents&&(a.slideIndex>=a.sliderJSONData.contents.length-1?a.slideIndex=0:a.slideIndex++)},this.intervalTimer=setInterval(a.startTimer,1e3)}]})}),r.promise}}]);RSBase.component("rsPrintProgress3d",{template:`
<div>
<div style=" margin: 0;height:70vh;padding:0;touch-action: auto; width:100%;position:relative">
<div id="container-3d"
        class="threeDView"
        style="position:relative; margin:0;width:100%;padding:0;touch-action: none;"
        oncontextmenux="return false;"
        ng-click="toggle3DMenu('')"
   >
     <div id="gcode3dview" ng-style="{height: $root.isFullscreen ? '100vh' : $ctrl.glHeight}">
        <canvas></canvas>
        <div class="axis"><canvas></canvas></div>
     </div>     
     <div class="gc-features" ng-if="$ctrl.analyser.id && $ctrl.gcodeLoaded">
       <h3 ng-click="$ctrl.toggleLegend()">{{$ctrl.preview3d.featureHeadline}}
         <span class="pull-right margin-left">
           <i class="fa" ng-class="{'fa-caret-down':$ctrl.show3dLegend, 'fa-caret-right':!$ctrl.show3dLegend}"></i>
         </span>
       </h3>
       <div ng-if="$ctrl.show3dLegend">
       <div ng-repeat="f in $ctrl.preview3d.features track by $index">
         <div class="ft-color" ng-style="{background:f.color}"></div>
         {{f.name}}
       </div>        
        <hr ng-if="$ctrl.preview3d.roundFeatures.length">
       <div ng-repeat="f in $ctrl.preview3d.roundFeatures track by $index">
         <div class="ft-color-round" ng-style="{background:f.color}"></div>
         {{f.name}}
       </div>                
       </div>
     </div>
     <!-- Menu -->
     <div style="position: absolute;top:10px;right:10px;z-index:100">
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('opt3d', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <i class="fa fa-bars gl-2" style="position: relative"></i>
         </div>
       </div>
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('view', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'" color-class="gl-2" style="position: relative"></rs-icon>
         </div>
       </div>
       <div ng-if="$ctrl.analyser.id" class="d-inline-block" ng-click="$ctrl.toggle3DMenu('info', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <i class="fa fa-info-circle gl-2" style="position: relative"></i>
         </div>
       </div>
       <div ng-if="$root.supportsFullscreen" class="gl-btn"  style="position:relative" title3="Включить полноэкранный режим" ng-click="$ctrl.toggleFullscreen()">
         <i class="rs gl-2" style="position: relative" ng-class="{'rs-fullscreen':!$root.isFullscreen,'rs-normalscreen':$root.isFullscreen}"></i>
       </div>
     </div>
     <!-- settings menu -->
     <div class="gc-menu" ng-if="$ctrl.menu3d.opt3d" ng-click="$event.stopPropagation()">
         <div class="form-group">
           <label>Качество</label>
           <select class="form-control" ng-change="$ctrl.update3dOptions(true)" 
                   ng-model="$ctrl.options3d.quality" 
                   ng-options="f.value as f.name for f in $ctrl.qualityNameMap"></select>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showRapidMotion" 
                    ng-change="$ctrl.update3dOptions(false)">
               Показать движения перемещения
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.transparentTop" 
                    ng-change="$ctrl.update3dOptions(false)">
             Показать прозрачный верх
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.orbitIfPrinting" 
                    ng-change="$ctrl.update3dOptions(false)">
             Поворот во время печати
           </label>
         </div>         
         <div class="margin-bottom">
           <label>Предупреждение, если требуемая память превышает</label><br>
           <input type="number" style="width:120px;background: #00000080;color: #ffffff;" ng-model="$ctrl.options3d.memoryWarnSize"> MB
         </div>
         <div>
          <div class="btn btn-primary btn-block" ng-click="$ctrl.saveDefault()"><i class="fa fa-save"></i> Стандартный предварительный просмотр</div> 
        </div>
     </div>
     <div class="gc-menu" ng-if="$ctrl.menu3d.view" xng-click="$event.stopPropagation()">
       <ul>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientIsometric();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-iso.svg'" color-class="text-primary"></rs-icon>
             </div>
             Изометрическая проекция</a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientTop();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-top.svg'" color-class="text-primary"></rs-icon>
             </div>
             Вид сверху
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientFront();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-front.svg'" color-class="text-primary"></rs-icon>
             </div>
             Вид спереди
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientLeft();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-left.svg'" color-class="text-primary"></rs-icon>
             </div>
             Вид слева
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientRight();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-right.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             Вид справа
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientBack();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-back.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             Вид сзади
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientBottom();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-bottom.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             Вид снизу
           </a>
         </li>
         <li class="hr"></li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.fitPrinter();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
               Подогнать принтер
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.fitObject();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-object.svg'"></rs-icon>
             </div>
               Подходящий объект
           </a>
         </li>
         <li class="hr" ng-if="!$root.activeConfig.isZBelt"></li>
         <li role="menuitem" ng-if="!$root.activeConfig.isZBelt">
           <a href="#" ng-click="$ctrl.toggleExcludeRegion();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon="rs rs-killregion"></rs-icon>
             </div>
               Исключить G-коды
           </a>
         </li>
       </ul>
     </div>
     <!-- info menu -->
     <div class="gc-menu" ng-if="$ctrl.menu3d.info" ng-click="$event.stopPropagation()">
        <ul class="list-group" style="text-align: left">
          <li class="list-group-item active">
            <h4 style="margin:0">Анализ G-кода</h4>
          </li>
          <li class="list-group-item">
            <span>Количество слоев:</span>
            <span >{{$ctrl.analyser.totalLayer}}</span>
          </li>
          <li class="list-group-item">
            <span>Общая высота по Z:</span>
            <span>{{$ctrl.analyser.totalHeight | number:3}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape!=='circle'">
            <span>X Напечатанный:</span>
            <span>{{$ctrl.analyser.layerInfo.xmin | number:2}} - {{$ctrl.analyser.layerInfo.xmax | number:2}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape!=='circle'">
            <span>Y Напечатанный:</span>
            <span>{{$ctrl.analyser.layerInfo.ymin | number:2}} - {{$ctrl.analyser.layerInfo.ymax | number:2}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape==='circle'">
            <span>Радиус печатный:</span>
            <span>{{$ctrl.analyser.layerInfo.radius | number:2}} mm</span>
          </li>
          <li class="list-group-item">
            <span>Общее время печати:</span>
            <span>{{$ctrl.analyser.totalDuration | dhms}}</span>
          </li>
          <li class="list-group-item">
            <span>Общее число линий:</span>
            <span>{{$ctrl.analyser.totalLines}}</span>
          </li>
          <li class="list-group-item">
            <span>Слайсер:</span>
            <span>{{$ctrl.model.slicer}}</span>
          </li>
          <li class="list-group-item">
            <span>Объемная экструзия:</span>
            <span>{{$ctrl.model.volumetric | yesno}}</span>
          </li>
        </ul>
     </div>
     <div ng-if="$ctrl.showMemoryWarning" class="bg-warning text-warning" 
     style="position: absolute; max-width: calc( min(80%, 300px));;top:50px;    left: 0;
    right: 0;
    margin: 0 auto;padding:10px">
     <p>Чтобы показать это 3d-превью, требуется больше памяти, чем установленный порог. Если ты продолжишь, и оно не поместится в память, это приведет к краху окна браузера.
     На печать не повлияет возможный сбой браузера!
     </p>
     <p>{{$ctrl.sizeMessage}}</p>
     <br>
     <div class="btn btn-warning" style="width:100%" ng-click="$ctrl.continueShow()">Continue</div>
    </div>
     <div ng-if="$root.active.status.jobid>0 && $root.active.status.analysed===0" class="bg-info text-info" 
     style="position: absolute; max-width: calc( min(80%, 300px));;top:50px;    left: 0;
    right: 0;
    margin: 0 auto;padding:10px">
     <div style="display: flex;flex-wrap: nowrap;align-items: center;">
     <div><i class="fa fa-spinner fa-spin fa-2x"></i></div>
     <div style="padding-left:10px">Данные предварительного просмотра вычисляются. Они появятся автоматически, как только вычисления будут завершены.</div>     
     </div>
    </div>
     </div>
     </div>
     <div ng-if="$ctrl.excludeRegionActive" class="bg-info text-info" 
            style="padding: 5px;">
     Отметь область для исключения, нарисовав прямоугольник на кровати с нажатой левой кнопкой мыши.     
     <div class="btn btn-info btn-block margin-top" ng-click="$ctrl.toggleExcludeRegion()">Abort</div>
     </div>
     </div>
`,controllerAs:"$ctrl",bindings:{slug:"<",model:"<",mode:"@",register3dView:"<"},controller:["$element","$interval","$rootScope","RSCom","$document","$sce","Fullscreen","Flash","$scope","$timeout",function(t,e,i,r,n,o,a,l,h,u){let c=!1,f=null,d=null,m=!1;this.glHeight="70vh",this.memoryGuessed=0,this.gcodeLoaded=!1,this.showMemoryWarning=!1,this.sizeMessage="",this.qualityNameMap=R_,this.featureNameMap=Vs,this.show3dLegend=document.body.clientWidth>500,this.analyser=new hl({user:i.user}),this.model=null,this.excludeRegionActive=!1,this.memoryAccepted=0,this.toggleLegend=()=>{this.show3dLegend=!this.show3dLegend},this.options3d={quality:di?1:2,show:1,transparentTop:!1,transparentBottom:!1,showRapidMotion:!1,showRetractions:!1,showDeretractions:!1,showSeams:!1,hideSkirtOozeShield:!1,hideSupport:!1,hideInfill:!1,smoothNozzleMove:!0,orbitIfPrinting:!1,memoryWarnSize:ao?20:200},this.menu3d={opt3d:!1,view:!1,info:!1};let v=window.localStorage.getItem("gcode3dOptions");v&&(v=JSON.parse(v));let g=window.localStorage.getItem("gcodelive3dOptions");g&&(this.options3d=Wt(Wt({},this.options3d),JSON.parse(g))),v&&v.memoryWarnSize&&(this.options3d=Ro(Wt({},this.options3d),{memoryWarnSize:v.memoryWarnSize})),this.saveDefault=()=>{window.localStorage.setItem("gcodelive3dOptions",JSON.stringify(this.options3d)),v=window.localStorage.getItem("gcode3dOptions"),v&&(v=JSON.parse(v)),v&&v.memoryWarnSize?v.memoryWarnSize=this.options3d.memoryWarnSize:v={memoryWarnSize:this.options3d.memoryWarnSize},window.localStorage.setItem("gcode3dOptions",JSON.stringify(v)),l.success("Настройки просмотра, сохраненные по умолчанию для этого браузера")},this.toggle3DMenu=(_,x)=>{_==="opt3d"?this.menu3d.opt3d=!this.menu3d.opt3d:this.menu3d.opt3d=!1,_==="view"?this.menu3d.view=!this.menu3d.view:this.menu3d.view=!1,_==="info"?this.menu3d.info=!this.menu3d.info:this.menu3d.info=!1,_&&x&&x.stopPropagation()},this.updateAnimation=()=>{let _=this.options3d.orbitIfPrinting;this.preview3d.liveComplete&&(_=!1),_?this.preview3d.view.startAnimate(4):this.preview3d.view.stopAnimate()},this.update3dOptions=_=>{f.updateExcludeRegions(),this.gcodeLoaded&&(f.setOptions(this.options3d),_?f.updateGCodeGeometry():f.setNextLiveProgress(!0),this.updateAnimation())},h.$on("excludeRegionsStored",function(){f&&f.updateExcludeRegions()}),this.toggleFullscreen=function(){a.toggleFullscreen($("#container-3d")[0])};let p=!1;this.loadGCode=async()=>{if(f.model=this.model,this.showMemoryWarning=!1,this.analyser.layerData=null,this.analyser.loadingFullData=!1,await this.analyser.loadData(),this.gcodeLoaded=!0,this.update3dOptions(!0),this.analyser.layerData&&i.active.status.jobid){let _=i.active.state;this.preview3d.setLiveProgress(_.layer,_,{x:_.xOff,y:_.yOff,z:_.zOff}),this.preview3d.setNextLiveProgress()}},this.checkMemoryAndLoad=()=>{this.memoryGuessed=this.analyser.guess3dMemory()/1024/1024,this.memoryGuessed===0&&(this.memoryGuessed=this.analyser.totalLines*37/1024/1024),this.memoryGuessed>this.options3d.memoryWarnSize&&this.memoryGuessed>this.memoryAccepted?(this.sizeMessage="Угаданная требуемая память составляет @1 МБ. Установленный тобой предел предупреждения для этого браузера составляет @2 МБ.".replace("@1",this.memoryGuessed.toFixed(0)).replace("@2",this.options3d.memoryWarnSize.toFixed(0)),this.showMemoryWarning=!0):this.loadGCode()},this.selectExcludeStart=()=>{let _=this.preview3d.view.ray.ray,x={x:_.origin.x+_.direction.x*(_.origin.z-i.activeConfig.movement.zMin),y:_.origin.y+_.direction.y*(_.origin.z-i.activeConfig.movement.zMin),z:i.activeConfig.movement.zMin};this.preview3d.drawCross(x),this.excludeRegionP1?(this.excludeRegionP2=Ro(Wt({},x),{z:i.activeConfig.movement.zMax}),this.preview3d.drawSelectionBox(this.excludeRegionP1,this.excludeRegionP2)):this.preview3d.hideSelectionBox()},this.excludeClickCallback=_=>{if(_.shiftKey===!1&&_.handleAsLeftButton){let x=this.preview3d.view.ray.ray,b={x:x.origin.x+x.direction.x*(x.origin.z-i.activeConfig.movement.zMin),y:x.origin.y+x.direction.y*(x.origin.z-i.activeConfig.movement.zMin),z:i.activeConfig.movement.zMin};this.excludeRegionP1=b}else this.excludeRegionP1=void 0},this.excludeUnclickCallback=_=>{if(this.excludeRegionP1&&_.handleAsLeftButton){let x={xmin:Math.min(this.excludeRegionP1.x,this.excludeRegionP2.x),xmax:Math.max(this.excludeRegionP1.x,this.excludeRegionP2.x),ymin:Math.min(this.excludeRegionP1.y,this.excludeRegionP2.y),ymax:Math.max(this.excludeRegionP1.y,this.excludeRegionP2.y)};if(x.xmax-x.xmin<=2||x.ymax-x.ymin<=2){this.excludeRegionP1=void 0;return}r.send("addExcludeRegion",x),this.toggleExcludeRegion()}this.excludeRegionP1=void 0},this.excludeCancelCallback=_=>{this.excludeRegionP1=void 0},this.toggleExcludeRegion=()=>{this.excludeRegionActive?(this.excludeRegionActive=!1,this.preview3d.liveComplete=!1,this.preview3d.hideSelectionBox(),this.preview3d.hideCross(),this.preview3d.view.orbitParallel.mouseButtons.LEFT=0,this.preview3d.view.orbitParallel.touches.ONE=0,this.preview3d.view.disableRaycasts(),this.preview3d.view.disablePointerCallbacks(),this.preview3d.forceRenderLoop=!1,this.preview3d.renderCallback=!1,this.preview3d.view.selectCamera(!0),this.preview3d.setNextLiveProgress(!0),this.updateAnimation()):(this.excludeRegionActive=!0,this.excludeRegionP1=null,this.preview3d.forceRenderLoop=!0,this.preview3d.view.enableRaycasts(),this.preview3d.view.clickCallback=this.excludeClickCallback,this.preview3d.view.unclickCallback=this.excludeUnclickCallback,this.preview3d.renderCallback=this.selectExcludeStart,this.preview3d.view.cancelCallback=this.excludeCancelCallback,this.preview3d.view.selectCamera(!1),this.preview3d.view.orbitParallel.mouseButtons.LEFT=-1,this.preview3d.view.orbitParallel.touches.ONE=-1,this.preview3d.view.orientTop(),this.preview3d.fitObject(),this.preview3d.liveComplete=!0,this.preview3d.hideCross(),this.preview3d.setNextLiveProgress(!0),this.updateAnimation())},this.showGcode3d=async()=>{if(f||c||p)return;let _=$("#gcode3dview");if(_.length===0||_[0].clientWidth===0||_[0].children.length===0){setTimeout(this.showGcode3d,25);return}p=!0,f=new hc(_,Wt({slug:this.slug,live:!0,rootScope:i,analyser:this.analyser,model:null},this.options3d)),this.preview3d=f,this.preview3d.view.orbit.requireShiftZoom=!0,f.view.orientIsometric(),this.fitObjectOrPrinter(),this.gcodeLoaded=!1,d=new IntersectionObserver(x=>{x[0].isIntersecting&&!m&&(m=!0),this.adjustSize()},{}),d.observe($("#gcode3dview")[0]),this.adjustSize(),wi.initialized.then(()=>{let x=()=>{!c&&!this.preview3d.setNozzlePosition(i.active.state)&&u(x,200)};u(x)}),this.preview3d.updateExcludeRegions(),this.checkForChangedJob()},this.continueShow=()=>{this.memoryAccepted=this.memoryGuessed+10,this.loadGCode()},this.adjustSize=()=>{window.innerHeight>500&&this.mode==="preview"?u(()=>{let _=t.get()[0].getBoundingClientRect();this.glHeight=Math.floor(window.innerHeight-_.top).toFixed(0)+"px",window.scrollY=0},10):this.glHeight="70vh"},h.$on("windowResized",()=>{this.adjustSize()}),this.fitObjectOrPrinter=()=>{this.preview3d.fitObject();let _=this.preview3d.options.model;f.view.isZBelt&&_&&_.zMax>i.activeConfig.movement.zMax&&f.view.fitPrinter()},this.checkForChangedJob=()=>{this.preview3d&&this.analyser.id!==i.active.status.jobid&&(i.active.status.jobid===0?(this.analyser.assignModel(this.slug,i.active.status.jobid),this.analyser.source="job",this.preview3d.updateGCodeGeometry(),this.preview3d.liveLayer=0,this.preview3d.livePos={x:-99999,y:-99999},this.preview3d.liveComplete=!0,this.updateAnimation()):i.active.status.analysed===1&&(this.analyser.assignModel(this.slug,i.active.status.jobid),this.analyser.source="job",this.preview3d.liveLayer=0,this.preview3d.livePos={x:-99999,y:-99999},this.preview3d.liveComplete=!1,this.updateAnimation(),this.analyser.id&&r.send("jobInfo",{id:i.active.status.jobid},this.slug).then(_=>{this.model=_,this.preview3d.options.model=_,this.fitObjectOrPrinter()}),this.analyser.loadInfo().then(()=>{this.checkMemoryAndLoad()})))},h.$on("jobDeactivated",()=>{this.preview3d&&(this.preview3d.liveComplete=!0,this.updateAnimation())}),h.$on("xgcodeAnalysisFinished",(_,x)=>{console.log("gcodeAnalysisFinished",x),x.data.slug===i.activeSlug&&x.data.modelId===i.active.status.jobid&&x.data.list==="jobs"&&(console.log("Loading new generated data"),this.analyser.assignModel(this.slug,i.active.status.jobid),this.analyser.source="job",this.preview3d.liveLayer=0,this.preview3d.livePos={x:-99999,y:-99999},this.preview3d.liveComplete=!1,this.updateAnimation(),this.analyser.id&&r.send("jobInfo",{id:i.active.status.jobid},this.slug).then(b=>{this.model=b,this.preview3d.options.model=b,this.fitObjectOrPrinter()}),this.analyser.loadInfo().then(()=>{this.checkMemoryAndLoad()}))}),h.$on("move",(_,x)=>{if(x.printer===i.activeSlug&&(this.checkForChangedJob(),this.preview3d)){let b=i.active.state;this.analyser.layerData&&i.active.status.jobid?this.preview3d.setLiveProgress(x.data.l,x.data,{x:b.xOff,y:b.yOff,z:b.zOff}):(this.preview3d.liveLayer=x.data.l,this.preview3d.livePos=x.data,this.preview3d.liveOffset={x:b.xOff,y:b.yOff,z:b.zOff},this.preview3d.pushNozzleMove({x:x.data.x,y:x.data.y,z:x.data.z,f:i.activeConfig.movement.maxXYSpeed*i.active.state.speedMultiply*.01}))}}),this.$onDestroy=()=>{c=!0,d&&d.disconnect(),f&&(f.$destroy(),f=null),this.analyser=null,this.register3dView&&this.register3dView(null)},this.$onChanges=_=>{},this.$onInit=()=>{this.adjustSize(),this.showGcode3d(),this.register3dView&&this.register3dView(this)}}]});var cz=ta();RSPrinterModule.controller("ProjectController",["$scope","$stateParams","RSCom","$rootScope","$timeout","$filter","$http","Confirm","RSOverview","StringDialog","RSPrinters","User","Flash","$uibModal","$state","$anchorScroll","$sce","$interval","SelectProjectFolder","SelectPrinterGroup","SelectPrinter",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p,_,x,b,y){r.globals||(r.globals={}),t.$on("userSettingsChanged",function(){r.globals.projectView=JSON.parse(f.getSetting("projectView",'{"viewStyle":2}'))}),r.globals.projectView||(r.globals.projectView=JSON.parse(f.getSetting("projectView",'{"viewStyle":2}'))),t.savedProjectView=function(){f.setSetting("projectView",JSON.stringify(r.globals.projectView))};let w=function(E){t.activeproject=E,t.licensetext=p.trustAsHtml(E.licenseHtml);function T(A,C){return A.nameic>C.nameic?1:A.nameic<C.nameic?-1:0}t.activeproject.gcodes||(t.activeproject.gcodes=[]),angular.forEach(t.activeproject.models,function(A){var C;A.nameic=A.n.toLowerCase(),A.f=(C=A.f)!=null?C:255,A.hasImage=(A.f&&1)===1,A.hasInfo=(A.f&&2)===2,A.has3d=(A.f&&4)===4}),angular.forEach(t.activeproject.gcodes,function(A){var C;A.nameic=A.n.toLowerCase(),A.f=(C=A.f)!=null?C:255,A.hasImage=(A.f&&1)===1,A.hasInfo=(A.f&&2)===2,A.has3d=(A.f&&4)===4}),angular.forEach(t.activeproject.others,function(A){var C;A.nameic=A.n.toLowerCase(),A.f=(C=A.f)!=null?C:255,A.hasImage=(A.f&&1)===1,A.hasInfo=(A.f&&2)===2,A.has3d=(A.f&&4)===4}),t.activeproject.models.sort(T),t.activeproject.gcodes.sort(T),t.activeproject.others.sort(T),t.editmode||(t.editproject=angular.copy(t.activeproject)),S()};t.serverList=[],t.activeServer={},t.folderTree=[],t.foldersIdx=0,t.activeFolder={},t.activeproject=!1,t.editproject=!1,t.editmode=!1,t.editTags=!1,t.tags=[],t.newTagName="",t.uploading=!1,t.uploadingZip=!1,t.imageList=[],t.activeImageIndex=0,t.activeImage={n:""},t.view3d=!1,t.comment={comment:"",user:""},t.uploadProgress=0,t.menuGCode1={},t.menuGCode2={},t.closeGCode1=function(E){t.menuGCode1[E.n]=!1},t.closeGCode2=function(E){t.menuGCode2[E.n]=!1},t.go=function(E){g(E)},t.editProject=function(){t.editproject=angular.copy(t.activeproject),t.editmode=!0},t.toggleEditTags=function(){t.editTags=!t.editTags,t.editTags&&i.send("projectListTags",{serveruuid:t.activeServer.uuid}).then(function(E){if(E.ok){let A=function(C,M){return C.c>M.c?-1:C.c<M.c?1:0};var T=A;E.tags.sort(A),t.tags=E.tags}})},t.copyGCode=function(E){b("Копирование G-кода модели").then(function(T){i.send("projectGCodeFromProject",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,file:E.n,group:T.group},T.slug).then(function(A){A.ok?d.info("Копировать G-Код ...","Копирование G-кода началось.",3e4,!0):d.error("",A.error,1e4,!0)})},function(){})},t.printGCode=function(E){y("Печатать G-кода").then(function({list:T,autostart:A}){angular.forEach(T,function(C){i.send("projectPrintFromProject",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,file:E.n,autostart:A},C.slug).then(function(M){M.ok?M.print?d.info("Печать G-кода ...","Начало печати.",3e4,!0):d.info("Печать G-кода ...","Печать добавлена в очередь печати.",3e4,!0):d.error("",M.error,1e4,!0)})})},function(){})},t.addTag=function(){let E=!1;t.activeproject.tags.forEach(function(T){E|=T===t.newTagName}),!E&&i.send("projectAddTag",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,tag:t.newTagName,format:2}).then(function(T){T.ok?(t.activeproject.tags.push(t.newTagName),t.newTagName=""):d.error("",T.error,1e4,!0)})},t.addComment=function(){let E=!1;t.activeproject.tags.forEach(function(T){E|=T===t.newTagName}),!E&&i.send("projectAddComment",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,comment:t.comment.comment,username:t.comment.user,format:2}).then(function(T){T.ok?(w(T.project),t.comment.comment=""):d.error("",T.error,1e4,!0)},function(){})},t.deleteComment=function(E){l("Контрольный вопрос","Действительно удалить комментарий?","Да","Нет",!0).then(function(){i.send("projectDelComment",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,comment:E.comment,username:E.user,format:2}).then(function(T){T.ok?w(T.project):d.error("",T.error,1e4,!0)},function(){})},function(){})},t.delTag=function(E,T){i.send("projectDelTag",{servername:t.activeServer.name,serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,tag:E,format:2}).then(function(A){A.ok?t.activeproject.tags.splice(T,1):d.error("",A.error,1e4,!0)})},t.cancelProject=function(){t.editproject=angular.copy(t.activeproject),t.editmode=!1},t.saveProject=function(){i.send("projectsUpdateProject",{serveruuid:t.activeServer.uuid,project:t.editproject,format:2}).then(function(E){E.ok?(w(E.project),t.editproject=angular.copy(t.activeproject),t.editmode=!1):d.error("",E.error,1e4,!0)})},t.show3d=function(E){E.stopPropagation(),t.view3d=!0},t.selectView=function(E){t.view3d=!1,t.activeImageIndex=E,t.activeImage=t.imageList[E]},t.selectFolderLevel=function(E){v.go("browse_projects",{serverid:t.activeServer.uuid,folderid:t.activeproject.parents[E].idx})};let S=function(){t.imageList=[],t.activeImageIndex=0,angular.forEach(t.activeproject.models,function(E){E.n===t.activeImage.n&&(t.activeImageIndex=t.imageList.length);let T=encodeURIComponent(E.n);E.mt="/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,t.imageList.push(Ro(Wt({},E),{t:"/project/"+t.activeServer.uuid+"/thumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,mt:"/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,i:"/project/"+t.activeServer.uuid+"/image/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,m:0,tp:0,t3model:"/project/"+t.activeServer.uuid+"/downloadModel/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,n:E.n}))}),angular.forEach(t.activeproject.gcodes,function(E){E.n===t.activeImage.n&&(t.activeImageIndex=t.imageList.length);let T=encodeURIComponent(E.n);E.mt="/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,t.imageList.push(Ro(Wt({},E),{t:"/project/"+t.activeServer.uuid+"/thumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,mt:"/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,i:"/project/"+t.activeServer.uuid+"/image/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,m:0,tp:2,gcode:!0,t3model:"/project/"+t.activeServer.uuid+"/downloadModel/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,n:E.n}))}),angular.forEach(t.activeproject.images,function(E){E.n===t.activeImage.n&&(t.activeImageIndex=t.imageList.length);let T=encodeURIComponent(E.n);E.mt="/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,t.imageList.push(Ro(Wt({},E),{t:"/project/"+t.activeServer.uuid+"/thumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,mt:"/project/"+t.activeServer.uuid+"/mthumb/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,i:"/project/"+t.activeServer.uuid+"/image/"+t.activeproject.uuid+"/"+T+"?v="+t.activeproject.version,m:0,tp:1,n:E.n}))}),t.imageList.length===0&&t.imageList.push({t:"/img/emptyproject.png",i:"/img/emptyproject.png",m:0,n:"No files"}),angular.forEach(t.activeproject.others,function(E){let T=E.n.substring(E.n.lastIndexOf(".")).toLowerCase();E.viewable=T===".txt"||T===".md"||T===".htm"||T===".html"||T===".pdf"||T===".mp4",E.gcode=T===".gcode"||T===".gco"||T===".g"||T===".nc"||T===".tap"||T===".cnc"})};t.refreshProject=function(){let E=t.activeproject.uuid;i.send("projectsGetProject",{serveruuid:t.activeServer.uuid,uuid:E,format:2}).then(function(T){T.ok&&E===t.activeproject.uuid?w(T.project):v.go("browse_projects",{serverid:t.activeServer.uuid,folderid:1})})},t.$on("projectChanged",function(E,T){T.data.uuid===t.activeproject.uuid&&t.refreshProject()}),t.$on("projectDeleted",function(E,T){T.data.uuid===t.activeproject.uuid&&v.go("browse_projects",{serverid:t.activeServer.uuid,folderid:1})}),t.previewGCode=function(E,T){E.f&2&&v.go("projectgcodepreview",{serverid:t.activeServer.uuid,projectid:t.activeproject.uuid,model:E.n,tab:T})},t.recomputeGCodeInfo=function(E){E.f&2&&i.send("projectReparseGCode",{serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,id:E.n})},t.info=async function(E){if(E.f&2){let T=await i.send("projectGetGCodeInfo",{serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,id:E.n});if(T.ok){let A=T.info;A.name=E.n,A.printer=E.p,m.open({templateUrl:"/views/projects/GCodeSummary.php?lang="+window.lang,scope:t,controller:["$scope",function(C){C.plist=[],C.noteEdit=!1,C.model=A;let M=r.serverSettings.pricing,D=M.map;C.$on("modal.closing",function(){angular.forEach(C.plist,function(P){C.model.materials[P.idx]=P.filament.u}),i.send("projectSetGCodeInfo",{id:E.n,serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,info:C.model})});function O(P){if(!P)return 0;let L=0;return angular.forEach(M.filaments,function(I,k){I.u===P&&(L=k)}),L}C.filaments=M.filaments,C.currency=M.currency,angular.forEach(A.volumeUsage,function(P,L){P<=0||C.plist.push({idx:L,extruder:L+1,mm:A.extruderUsage[L],volume:P*.001,price:0,filament:M.filaments[O(A.materials[L])],weight:0})}),C.updateCalc=function(){C.weightTotal=0,C.total=M.perPrint+M.perHour*A.printTime/3600,angular.forEach(C.plist,function(P){P.weight=P.volume*P.filament.w,C.weightTotal+=P.weight,P.price=P.weight*P.filament.p/1e3,C.total+=P.price})},C.close=function(){angular.forEach(C.plist,function(P,L){D[L.toString()+"_"+t.slug]=P.filament.u}),C.$close()},C.updateCalc()}]})}}},t.selectProject=function(E){i.send("projectsGetProject",{serveruuid:t.activeServer.uuid,uuid:E,format:2}).then(function(T){T.ok?(w(T.project),t.activeImage.n.length===0&&(t.activeImage={n:T.project.preview},S())):v.go("browse_projects",{serverid:t.activeServer.uuid,folderid:1})})};let R=_(function(){r.serverSettings.serveruuid!==t.activeServer.uuid&&i.send("projectGetProjectVersion",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid}).then(function(E){E.ok&&E.version!==t.activeproject.version&&t.refreshProject()})},1e4);t.$on("$destroy",function(){R&&(_.cancel(R),R=null)}),t.newProjectName=function(E,T,A){i.send("projectsRenameProject",{servername:t.activeServer.name,serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,uuid:A.uuid,newName:T}).then(function(C){C.ok?t.folderTree[t.foldersIdx]=t.activeFolder=C.folder:d.error("",C.error,1e4,!0)})},t.newFileName=function(E,T){i.send("projectsRenameFile",{serveruuid:t.activeServer.uuid,uuid:t.activeproject.uuid,newName:T,oldName:E,format:2}).then(function(A){A.ok?w(A.project):d.error("",A.error,1e4,!0)})},t.tryDeleteFile=function(E,T){T.stopPropagation(),l("Контрольный вопрос","Действительно удалить файл @?".replace("@",E.n),"Да","Нет",!0).then(function(){i.send("projectsDeleteFile",{serveruuid:t.activeServer.uuid,name:E.n,uuid:t.activeproject.uuid,format:2}).then(function(A){A.ok?w(A.project):d.error("",A.error,1e4,!0)})})},t.downloadFile=function(E,T){T&&T.stopPropagation(),window.open("/project/"+t.activeServer.uuid+"/download/"+t.activeproject.uuid+"/"+encodeURIComponent(E.n))},t.editGCode=async E=>{let T=await i.send("projectGetGCodeInfo",{serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,id:E.n});m.open({templateUrl:"/views/projects/editGCode.dialog.php",windowTemplateUrl:"/views/base/fullsizeDialog.html?lang="+window.lang,controller:["$scope","$uibModalInstance",function(A,C){A.file=E,A.mode=0,A.info=T.info,A.loadFile=()=>{A.mode=1,cz.get("/project/"+t.activeServer.uuid+"/download/"+t.activeproject.uuid+"/"+encodeURIComponent(E.n)).then(M=>{M.status===200&&(A.code=M.data,A.mode=2)})},A.removeGCodePatch=()=>{A.info.gcodePatch="{}",i.send("projectSetGCodeInfo",{id:E.n,serveruuid:t.activeServer.uuid,projectid:t.activeproject.uuid,info:A.info})},A.cancel=function(){C.dismiss()},A.save=function(){A.mode=3;let M=new FormData;M.append("name",E.n),M.append("filename",new Blob([A.code],{type:"text/plain"}),E.n),A.percent=0,cz.post("/project/"+t.activeServer.uuid+"/replace/"+t.editproject.uuid,M,{onUploadProgress:D=>{A.percent=Math.round(D.loaded/D.total*100)},headers:{"Content-Type":"multipart/form-data"},maxContentLength:1/0,maxBodyLength:1/0}).then(()=>{C.close()})}}]}).result.catch(function(A){})},t.viewFile=function(E,T){T&&T.stopPropagation(),window.open("/project/"+t.activeServer.uuid+"/view/"+t.activeproject.uuid+"/"+encodeURIComponent(E.n),"_blank")},t.viewFileLink=function(E){let T="/project/"+t.activeServer.uuid+"/view/"+t.activeproject.uuid+"/"+encodeURIComponent(E.n);return E.n.endsWith(".mp4")&&(T+="/show.html"),T},t.selectServer=function(E){if(t.activeServer=t.loadedServer=E,e.serverid!==E.uuid){v.go("browse_projects",{serverid:E.uuid,folderid:0});return}t.selectProject(e.projectid)},t.updateServer=function(){i.send("projectsListServer",{}).then(function(E){if(E.ok){t.serverList=E.server;let T=t.serverList[0];if(angular.forEach(t.serverList,function(A){e.serverid===A.uuid&&(T=A)}),e.serverid!==T.uuid){v.go("browse_projects",{serverid:T.uuid,folderid:0});return}t.selectServer(T)}})},t.$on("remoteServersChanged",function(){t.updateServer()}),t.fullsizeImageDialog=function(E,T){m.open({templateUrl:"/views/projects/previewimage.dialog.php",windowTemplateUrl:"/views/base/fullsizeDialog.html?lang="+window.lang,controller:["$scope","$uibModalInstance",function(A){A.title=E,A.image=T}]}).result.catch(function(A){})},t.updateServer(),t.handleUpload=function(){let E=$("#FilenameUpload"),T=E.val().replace(/\\/g,"/").replace(/.*\//,""),A=E.get(0).files[0].size;i.send("projectsCanUploadWithSize",{size:A}).then(function(C){if(C.ok){t.uploading=!0;let M=()=>{t.uploading=!1,E.val(""),t.refreshProject()},D=L=>{t.uploadProgress=L},O="/project/"+t.activeServer.uuid+"/upload/"+t.editproject.uuid,P=[];for(let L of E.get(0).files)P.push({name:L.name.replace(/\\/g,"/").replace(/.*\//,""),filename:L});i.uploadFiles({url:O,a:"upload",files:P},D).then(M),T!==""&&E.val("")}else d.error("",C.error?C.error:"Диск переполнен. Сначала удалите другие файлы.",1e4,!0)})},window.handleUpload=t.handleUpload,t.$on("$destroy",()=>{delete window.handleUpload}),t.downloadAll=function(){window.open("/project/"+t.activeServer.uuid+"/downloadProject/"+t.activeproject.uuid,"ihelper"),d.info("Создание архива ...","Загрузка начнется автоматически, когда проект будет упакован.",3e4,!0)},t.exportProject=function(){window.open("/project/"+t.activeServer.uuid+"/export/"+t.activeproject.uuid,"ihelper"),d.info("Создание архива ...","Загрузка начнется автоматически, когда проект будет упакован.",3e4,!0)},t.downloadImage=function(E,T){T.stopPropagation(),window.open("/project/"+t.activeServer.uuid+"/downloadImage/"+t.activeproject.uuid+"/"+encodeURIComponent(E.n),"ihelper")},t.deleteImage=function(E,T){T.stopPropagation(),t.tryDeleteFile(E,T)},t.makePreview=function(E,T){T.stopPropagation(),(E.f&1)===1&&i.send("projectMarkPreview",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,image:E.n,format:2}).then(function(A){A.ok&&d.success("Новый набор изображений для предварительного просмотра.")})},t.selectLicense=function(){i.send("getLicenseTemplates",{}).then(function(E){m.open({templateUrl:"/views/projects/selectlicense.dialog.php",controller:["$scope","$uibModalInstance",function(T,A){T.licenses=E.licenses;function C(D,O){return D.nameic>O.nameic?1:D.nameic<O.nameic?-1:0}angular.forEach(T.licenses,function(D){D.nameic=D.name.toLowerCase()}),T.licenses.sort(C);let M=null;T.licenses.forEach(function(D){M===null&&D.name==="No License"&&(M=D),D.name===t.activeproject.licenseFile&&(M=D)}),T.data={name:t.activeproject.name,author:t.activeproject.author?t.activeproject.author:f.isRealUser?f.getLogin():"",license:M},T.setLicense=function(){let D=T.data.license.text.replace(/\$model/gi,T.data.name).replace(/\$author/gi,T.data.author);i.send("projectSetLicense",{serveruuid:t.activeServer.uuid,projectuuid:t.activeproject.uuid,license:D,licenseFile:T.data.license.name,author:T.data.author,format:2}).then(function(O){w(O.project),A.close()})}}]}).result.catch(function(T){})})}}]);var M2e=ta();RSPrinterModule.controller("BrowseProjectController",["$scope","$stateParams","RSCom","$rootScope","$interval","$filter","$http","Confirm","RSOverview","StringDialog","RSPrinters","User","Flash","$uibModal","$state","$anchorScroll","WaitSelectorAppear","SelectProjectFolder",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v,g,p,_){r.globals||(r.globals={}),t.$on("userSettingsChanged",function(){r.globals.projectView=JSON.parse(f.getSetting("projectView",'{"viewStyle":2}'))}),r.globals.projectView||(r.globals.projectView=JSON.parse(f.getSetting("projectView",'{"viewStyle":2}')));let x=function(){i.send("projectsGetFolder",{serveruuid:t.activeServer.uuid,idx:parseInt(e.folderid)}).then(function(S){S.ok?(t.folderTree=S.folder.parents,t.folderTree.push(S.folder),t.foldersIdx=t.folderTree.length-1,t.activeFolder=S.folder,y(t.activeFolder)):v.go("browse_projects",{serverid:t.activeServer.uuid,folderid:1})})};t.projectMenuOpen={},t.serverList=[],t.activeServer={},t.folderTree=[],t.foldersIdx=1,t.activeFolder={},t.uploadProgress=0,t.uploading=!1;let b=null;t.go=function(S){g(S)},t.selectFolderLevel=function(S){v.go("browse_projects",{serverid:t.activeServer.uuid,folderid:t.folderTree[S].idx})};let y=function(S){t.sort(),angular.forEach(S.projects,function(R){R.preview?R.previewUrl="/project/"+t.activeServer.uuid+"/mthumb/"+R.uuid+"/"+encodeURIComponent(R.preview)+"?v="+R.version:R.previewUrl="/img/emptyproject.png"})};t.selectFolder=function(S){v.go("browse_projects",{serverid:t.activeServer.uuid,folderid:S.idx})},t.selectProject=function(S){v.go("project",{projectid:S.uuid,serverid:t.activeServer.uuid})},t.search=function(){v.go("search_projects",{tag:"",search:"",serverid:t.activeServer.uuid})},t.downloadAll=function(S){t.projectMenuOpen[S.uuid]=!1,window.open("/project/"+t.activeServer.uuid+"/downloadProject/"+S.uuid,"ihelper"),d.info("Создание архива ...","Загрузка начнется автоматически, когда проект будет упакован.",3e4,!0)},t.exportProject=function(S){t.projectMenuOpen[S.uuid]=!1,window.open("/project/"+t.activeServer.uuid+"/export/"+S.uuid,"ihelper"),d.info("Создание архива ...","Загрузка начнется автоматически, когда проект будет упакован.",3e4,!0)},t.moveProject=function(S){t.projectMenuOpen[S.uuid]=!1,_(t.activeServer.uuid,"Переместить проект в").then(function(R){i.send("projectCopy",{projectuuid:S.uuid,target_folder:R.idx,target_server:R.serveruuid,serveruuid:t.activeServer.uuid,move:!0}).then(function(E){E.ok?d.info("Переместить проект","Движение началось. Запущен как фоновый процесс и может занять некоторое время!",3e4,!0):d.error("",E.error,1e4,!0)},function(){})},function(){})},t.copyProject=function(S){t.projectMenuOpen[S.uuid]=!1,_(t.activeServer.uuid,"Копировать Проект в").then(function(R){i.send("projectCopy",{projectuuid:S.uuid,target_folder:R.idx,target_server:R.serveruuid,serveruuid:t.activeServer.uuid,move:!1}).then(function(E){E.ok?d.info("Копировать Проект","Запущен процесс копирования проекта. Идет работа в фоновом режиме которая может занять некоторое время!",3e4,!0):d.error("",E.error,1e4,!0)},function(){})},function(){})},t.addProject=function(){u("Добавить проект","Имя проекта","","Создайте").then(function(S){i.send("projectsCreateProject",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,projectname:S,format:2}).then(function(R){R.ok?x():d.error("",R.error,1e4,!0)},function(){})})},t.addFolder=function(){u("Добавить gапку","Название папки","","Создайте").then(function(S){i.send("projectsCreateFolder",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,foldername:S}).then(function(R){R.ok?(t.folderTree[t.foldersIdx]=t.activeFolder=R.folder,angular.forEach(R.folder.folders,function(E){E.name===S&&t.selectFolder(E)})):d.error("",R.error,1e4,!0)},function(){})})},t.sort=function(){function S(R,E){return R.nameic>E.nameic?1:R.nameic<E.nameic?-1:0}angular.forEach(t.activeFolder.folders,function(R){R.nameic=R.name.toLowerCase()}),angular.forEach(t.activeFolder.projects,function(R){R.nameic=R.name.toLowerCase()}),t.activeFolder.folders.sort(S),t.activeFolder.projects.sort(S)},t.tryDeleteFolder=function(S,R){S.empty?i.send("projectsDeleteFolder",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,folderidx:S.idx}).then(function(E){E.ok?t.folderTree[t.foldersIdx]=t.activeFolder=E.folder:d.error("",E.error,1e4,!0)}):l("Контрольный вопрос","Папка содержит другие папки или проекты, которые также будут удалены. Действительно удалить их все?".replace("@",S.name),"Да","Нет",!0).then(function(){i.send("projectsDeleteFolder",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,folderidx:S.idx}).then(function(E){E.ok?t.folderTree[t.foldersIdx]=t.activeFolder=E.folder:d.error("",E.error,1e4,!0)})}),R.stopPropagation()},t.tryDeleteProject=function(S,R){l("Контрольный вопрос","Действительно удалить проект @?".replace("@",S.name),"Да","Нет",!0).then(function(){i.send("projectsDeleteProject",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,uuid:S.uuid}).then(function(E){E.ok?(t.folderTree[t.foldersIdx]=E.folder,t.activeFolder=E.folder):d.error("",E.error,1e4,!0)})}),R.stopPropagation()},t.newFolderName=function(S,R,E){i.send("projectsRenameFolder",{serveruuid:t.activeServer.uuid,idx:E.idx,newName:R}).then(function(T){T.ok?(t.folderTree[t.foldersIdx]=t.activeFolder=T.folder,y(t.activeFolder)):d.error("",T.error,1e4,!0)})},t.newProjectName=function(S,R,E){i.send("projectsRenameProject",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx,uuid:E.uuid,newName:R}).then(function(T){T.ok?(t.folderTree[t.foldersIdx]=t.activeFolder=T.folder,y(t.activeFolder)):d.error("",T.error,1e4,!0)})},t.selectServer=function(S){if(!S)return;if(r.globals.projectView.lastServer=S.uuid,f.setSetting("projectView",JSON.stringify(r.globals.projectView)),t.activeServer.uuid===S.uuid){t.activeServer=t.loadedServer=S;return}t.activeServer=t.loadedServer=S;let R=0;if(e.serverid===S.uuid)e.folderid&&(R=parseInt(e.folderid));else{v.go("browse_projects",{serverid:S.uuid,folderid:1});return}i.send("projectsGetFolder",{serveruuid:S.uuid,idx:R}).then(function(E){E.ok?(t.folderTree=E.folder.parents,t.folderTree.push(E.folder),t.foldersIdx=t.folderTree.length-1,t.activeFolder=E.folder,y(t.activeFolder)):v.go("browse_projects",{serverid:S.uuid,folderid:0})})},t.$on("projectFolderChanged",function(S,R){R.data.idx===t.activeFolder.idx&&R.data.server_uuid===t.activeServer.uuid&&x()}),b=n(function(){r.serverSettings.serveruuid!==t.activeServer.uuid&&i.send("projectGetFolderVersion",{serveruuid:t.activeServer.uuid,folder:parseInt(e.folderid)}).then(function(S){S.ok&&S.version!==t.activeFolder.version&&i.send("projectsGetFolder",{serveruuid:t.activeServer.uuid,idx:parseInt(e.folderid)}).then(function(R){R.ok?(t.folderTree=R.folder.parents,t.folderTree.push(R.folder),t.foldersIdx=t.folderTree.length-1,t.activeFolder=R.folder,y(t.activeFolder)):v.go("browse_projects",{serverid:s.uuid,folderid:0})})})},1e4),t.$on("$destroy",function(){b&&(n.cancel(b),b=null),delete window.handleUpload,delete window.handleUploadZip,delete window.handleUpload2,delete window.handleUploadZip2});let w=!1;t.updateServer=function(){w||(w=!0,i.send("projectsListServer",{}).then(function(S){if(S.ok){t.serverList=S.server;let R=t.serverList[0],E=r.globals.projectView.lastServer;if(e.serverid&&(E=e.serverid),angular.forEach(t.serverList,function(T){E===T.uuid&&(R=T)}),e.serverid!==R.uuid){v.go("browse_projects",{serverid:R.uuid,folderid:1});return}t.selectServer(R)}w=!1},function(){w=!1}))},t.$on("remoteServersChanged",function(){t.updateServer()}),t.updateServer(),t.uploadProject=function(S,R){let E=S.val().replace(/\\/g,"/").replace(/.*\//,""),T=0,A=[];for(let C of S.get(0).files)A.push({name:C.name.replace(/\\/g,"/").replace(/.*\//,""),filename:C}),T=C.size;i.send("projectsCanUploadWithSize",{size:5*T}).then(function(C){if(C.ok){R==="uploadZIP"?t.uploadingZip=!0:t.uploading=!0,p.show("<i class='fa fa-spinner fa-spin'></i> Импорт…"),t.uploadProgress=0;let M=()=>{R==="uploadZIP"?t.uploadingZip=!1:t.uploading=!1,S.val(""),i.send("projectsGetFolder",{serveruuid:t.activeServer.uuid,idx:t.activeFolder.idx}).then(function(P){P.ok?(t.folderTree=P.folder.parents,t.folderTree.push(P.folder),t.foldersIdx=t.folderTree.length-1,t.activeFolder=P.folder,y(t.activeFolder)):d.error("",P.error,1e4,!0)}),p.hide()},D=P=>{t.uploadProgress=P,p.setProgress(P)},O="/project/"+t.activeServer.uuid+"/import/"+t.activeFolder.idx;i.uploadFiles({url:O,a:R,files:A},D).then(M).catch(function(P){console.log(P)}),E!==""&&S.val("")}else d.error("","Диск переполнен. Сначала удалите другие файлы.",1e4,!0)})},t.handleUpload=function(){let S=$("#FilenameUpload");t.uploadProject(S,"uploadProject")},t.handleUpload2=function(){let S=$("#FilenameUpload2");t.uploadProject(S,"uploadProject")},t.handleUploadZip=function(){let S=$("#FilenameUploadZip");t.uploadProject(S,"uploadZIP")},t.handleUploadZip2=function(){let S=$("#FilenameUploadZip2");t.uploadProject(S,"uploadZIP")},window.handleUpload=t.handleUpload,window.handleUploadZip=t.handleUploadZip,window.handleUpload2=t.handleUpload2,window.handleUploadZip2=t.handleUploadZip2}]);RSPrinterModule.controller("SearchProjectController",["$scope","$stateParams","RSCom","$rootScope","Confirm","RSOverview","StringDialog","User","Flash","$uibModal","$state","$anchorScroll",function(t,e,i,r,n,o,a,l,h,u,c,f){t.serverList=[],t.activeServer={},t.projects=[],t.activeProjects=[],t.page=1,t.perPage=24,t.maxSize=7,t.go=function(v){f(v)};let d=function(){angular.forEach(t.projects,function(v){v.preview?v.previewUrl="/project/"+t.activeServer.uuid+"/mthumb/"+v.uuid+"/"+v.preview:v.previewUrl="/img/emptyproject.png"})};t.selectProject=function(v){c.go("project",{projectid:v.uuid,serverid:t.activeServer.uuid})},t.browse=function(){c.go("browse_projects",{folderid:1,serverid:t.activeServer.uuid})},t.tryDeleteProject=function(v,g){n("Контрольный вопрос","Действительно удалить проект @?".replace("@",v.name),"Да","Нет",!0).then(function(){i.send("projectsDeleteProject",{serveruuid:t.activeServer.uuid,idx:v.folder,uuid:v.uuid}).then(function(p){if(p.ok){let _=t.page;t.updateSearch(),t.pageChanged(_)}})}),g.stopPropagation()},t.pageChanged=function(v){v*t.perPage>t.projects.length&&(v=parseInt((t.projects.length-1)/t.perPage)+1),t.page=v,t.activeProjects=t.projects.slice((t.page-1)*t.perPage,t.page*t.perPage)},t.newProjectName=function(v,g,p){i.send("projectsRenameProject",{serveruuid:t.activeServer.uuid,idx:p.folder,uuid:p.uuid,newName:g}).then(function(_){if(_.ok){let x=t.page;t.updateSearch(),t.pageChanged(x)}})},t.updateParams=function(){c.transitionTo("search_projects",{serveruuid:t.activeServer.uuid,tag:t.tag,search:t.search},{location:"replace",inherit:!0,relative:c.$current,notify:!1})},t.updateSearch=function(){if(t.tag===""&&t.search===""){t.projects=[],t.pageChanged(1);return}i.send("projectSearch",{serveruuid:t.activeServer.uuid,tag:t.tag,search:t.search}).then(function(v){if(v.ok){let p=function(_,x){return _.nameic>x.nameic?1:_.nameic<x.nameic?-1:0};var g=p;angular.forEach(v.projects,function(_){_.nameic=_.name.toLowerCase()}),v.projects.sort(p),t.projects=v.projects,t.pageChanged(1),d(t.activeFolder),t.updateParams()}})},t.selectTag=function(v){t.tag=v,t.updateSearch()},t.selectServer=function(v){t.activeServer.uuid!==v.uuid&&(t.activeServer=t.loadedServer=v,e.serverid===v.uuid?t.updateSearch():c.go("search_projects",{serverid:v.uuid,tag:t.tag,search:t.search}))},t.tags=[];let m=function(){i.send("projectListTags",{serveruuid:e.serverid}).then(function(v){if(v.ok){let p=function(_,x){return _.c>x.c?-1:_.c<x.c?1:0};var g=p;v.tags.sort(p),t.tags=v.tags}})};t.updateServer=function(){i.send("projectsListServer",{}).then(function(v){if(v.ok){t.serverList=v.server;let g=t.serverList[0];if(angular.forEach(t.serverList,function(p){e.serverid===p.uuid&&(g=p)}),e.serverid!==g.uuid){c.go("search_projects",{serverid:g.uuid,tag:t.tag,search:t.search});return}t.selectServer(g)}})},t.tag=e.tag,t.search=e.search,m(),t.updateServer()}]);RSPrinterModule.component("rsModelView",{template:`<div style="width:100%;height:100%;position:relative" class="model3d"><div ng-if="$root.supportsFullscreen" class="gl-btn right" ng-class="{glactive:plate.WorkMode==0}" title2="{{$ctrl.tToggleFS}}" style="top:10px;right:52px;" ng-click="$ctrl.toggleFullscreen()"><i class="rs gl-2" ng-class="{'rs-fullscreen':!$root.isFullscreen,'rs-normalscreen':$root.isFullscreen}"></i></div><div class="gl-btn" ng-class="{glactive:plate.WorkMode==1}" title2="{{$ctrl.tAutomaticRotation}}" style="top:10px;left:10px;width:34px;" ng-click="$ctrl.toggleAnimation()"><i class="rs gl-2" style="width:34px" ng-class="{'rs-3d-play':!$ctrl.playing,'rs-3d-pause':$ctrl.playing}"></i></div><div class="gl-btn" style="top:10px;left:52px;width: 33px;" title2="{{$ctrl.tCenterView}}" ng-click="$ctrl.centerView()"><i class="rs rs-3d-centerview gl-2"></i></div><div ng-if="!$root.isFullscreen" class="gl-btn" id="cpicon" style="top:10px;left:94px;width:32px" title2="{{$ctrl.tChangeColor}}" ng-click="$ctrl.showColorpicker()"><input type="text" id="previewcp" ng-model="$ctrl.modelColor" style="display:none" colorpicker required ng-change="$ctrl.colorChanged()"><i class="rs rs-3d-colorpicker gl-2" ></i></div><div class="threeDView" style="position: absolute;left:0;right:0;top:0;bottom:0"><canvas></canvas><div class="axis"><canvas></canvas></div></div></div>`,bindings:{url:"<"},controller:["$rootScope","Fullscreen","$element",function(t,e,i){let r,n,o,a,l,h,u,c,f=this;this.geometryHelper={},this.tToggleFS="Включить полноэкранный режим",this.tChangeColor="Сменить цвет",this.tCenterView="Вид по центру",this.tAutomaticRotation="Автоматический поворот",this.modelColor="#c07100",this.$onInit=function(){},this.$onDestroy=function(){this.geometryHelper={},r!==void 0&&r.disconnect(),a=null,l=null,u=null,c=null,r=null,i.innerHTML=""},this.$onChanges=function(m){m.url&&this.updateModel()},this.toggleFullscreen=function(){e.toggleFullscreen($(".model3d")[0])},this.showColorpicker=function(){setTimeout(function(){jQuery("#previewcp").spectrum("show")},10)},this.colorChanged=function(){f.geometryHelper.modelMat.color=new $e(parseInt(this.modelColor.replace("#","0x"))),r.setChanged()};let d=0;this.helpersLoaded=function(){return d===0},this.playing=!1,this.toggleAnimation=function(){r.toggleAnimate(4),this.playing=!this.playing},this.updateBed=m=>{r.zMin=0,r.addSquareBed(m)},this.updateModel=()=>{new Hh().load(this.url,function(v){if(!v){console.error("error loading model!");return}for(r===void 0&&(o=$(".threeDView"),r=new Gu(o,!1,t,!1,!1),n=r.scene,l=new Xr,n.add(l),r.addAxis(),h=r.tracker.add(new lr({color:12611840,shininess:70,vertexColors:!1,specular:2631720,flatShading:!0,side:qt,transparent:!1})),f.geometryHelper.modelMat=h),u=new Li;l.children.length;){let _=l.children[0];l.remove(_),r.tracker.remove(_),r.tracker.remove(_.geometry)}v.forEach(_=>{let x=r.tracker.add(_.geometry),b=new St(x,h);b.castShadow=!1,b.receiveShadow=!1,l.add(b),u.expandByObject(l,!1)});let g=new q;u.getCenter(g),l.translateX(-g.x),l.translateY(-g.y),l.translateZ(-u.min.z),u=new Li().setFromObject(l),r.setObjectsBBox(u),r.setPrinterBox(u);let p=new q;u.getSize(p),r.setSize(p.x,p.y,p.z),f.updateBed(Math.max(p.x,p.y)),r.addLights(),r.setObjectsBBox(u),r.orientIsometric()})},this.centerView=function(){r&&(r.setObjectsBBox(u),r.orientIsometric())}}]});RSPrinterModule.component("rsLeftRightScroller",{template:'<div class="lrScroller"><div class="box"><div class="scroller scroller-left" ng-click="$ctrl.scrollLeft()"><i class="fa fa-chevron-left fa-3x"></i></div><div class="scroller scroller-right" ng-click="$ctrl.scrollRight()"><i class="fa fa-chevron-right fa-3x"></i></div><div class="wrapper"><div class="list"><ng-transclude></ng-transclude></div></div></div></div>',bindings:{},transclude:!0,controller:["$rootScope","$element","$timeout",function(t,e,i){let r=null,n=!1,o=function(){return $(".list",e).outerWidth()},a=function(){return $(".list",e).position().left},l=function(){let c=a(),f=$(".wrapper",e).outerWidth()-138;-c+f<o()?$(".scroller-right",e).fadeIn(300):$(".scroller-right",e).fadeOut(300),c<0?$(".scroller-left").fadeIn(300):($(".item",e).animate({left:"-="+c+"px"},"slow"),$(".scroller-left",e).fadeOut(300))};this.$onInit=function(){$(window).resize(l)},this.$onDestroy=function(){$(window).off("resize",l),r&&i.cancel(r)};let h=0;function u(){let c=o();c!==h&&(h=c,l()),r=i(u,1e3)}this.$postLink=function(){i(u,500)},this.scrollLeft=function(){if(n)return;n=!0;let c=$(".wrapper",e).outerWidth()-138,f=a();f+c>0&&(c=-f),$(".list",e).animate({left:"+="+c+"px"},400,function(){n=!1,l()})},this.scrollRight=function(){if(n)return;let c=$(".wrapper",e).outerWidth()-138,f=a(),d=o();n=!0,-f+c>d&&(c=-(d+f)),$(".list",e).animate({left:"+="+-c+"px"},400,function(){n=!1,l()})}}]});RSPrinterModule.factory("SelectProjectFolder",["$uibModal","RSCom",function(t,e){return function(i,r){let n=t.open({templateUrl:"/views/projects/selectProjectFolder.php?lang="+lang,controller:["$scope","$uibModalInstance",function(o,a){o.headline=r,o.serverList=[],o.activeServer={},o.folderTree=[],o.foldersIdx=1,o.activeFolder={},o.cancel=function(){a.dismiss()},o.selectFolder=function(){a.close({idx:o.activeFolder.idx,serveruuid:o.activeServer.uuid})},o.sort=function(){function l(h,u){return h.nameic>u.nameic?1:h.nameic<u.nameic?-1:0}angular.forEach(o.activeFolder.folders,function(h){h.nameic=h.name.toLowerCase()}),angular.forEach(o.activeFolder.projects,function(h){h.nameic=h.name.toLowerCase()}),o.activeFolder.folders.sort(l)},o.selectServer=function(l){o.activeServer.uuid!==l.uuid&&(o.activeServer=o.loadedServer=l,e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:1}).then(function(h){h.ok&&(o.folderTree=h.folder.parents,o.folderTree.push(h.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=h.folder,o.sort())}))},o.goFolder=function(l){e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:l.idx}).then(function(h){h.ok&&(o.folderTree=h.folder.parents,o.folderTree.push(h.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=h.folder,o.sort())})},o.$on("projectFolderChanged",function(l,h){h.data.idx===o.activeFolder.idx&&h.data.server_uuid===o.activeServer.uuid&&e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:o.activeFolder.idx}).then(function(u){u.ok&&(o.folderTree=u.folder.parents,o.folderTree.push(u.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=u.folder,o.sort())})}),o.updateServer=function(){e.send("projectsListServer",{}).then(function(l){if(l.ok){o.serverList=l.server;let h=o.serverList[0];angular.forEach(o.serverList,function(u){i===u.uuid&&(h=u)}),o.selectServer(h)}})},o.updateServer()}],size:"lg"});return n.result.catch(function(o){}),n.result}}]);RSPrinterModule.factory("SelectProject",["$uibModal","RSCom",function(t,e){return function(i,r){let n=t.open({templateUrl:"/views/projects/selectProject.php?lang="+lang,controller:["$scope","$uibModalInstance",function(o,a){o.headline=r,o.serverList=[],o.activeServer={},o.folderTree=[],o.foldersIdx=1,o.activeFolder={},o.activeProject=void 0,o.setActive=function(l){o.activeProject=l},o.cancel=function(){a.dismiss()},o.selectProject=function(){a.close({uuid:o.activeProject.uuid,serveruuid:o.activeServer.uuid})},o.sort=function(){function l(h,u){return h.nameic>u.nameic?1:h.nameic<u.nameic?-1:0}angular.forEach(o.activeFolder.folders,function(h){h.nameic=h.name.toLowerCase()}),angular.forEach(o.activeFolder.projects,function(h){h.nameic=h.name.toLowerCase()}),o.activeFolder.folders.sort(l),o.activeFolder.projects.sort(l)},o.selectServer=function(l){o.activeServer.uuid!==l.uuid&&(o.activeServer=o.loadedServer=l,e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:1}).then(function(h){h.ok&&(o.folderTree=h.folder.parents,o.folderTree.push(h.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=h.folder,o.sort())}))},o.goFolder=function(l){e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:l.idx}).then(function(h){h.ok&&(o.activeProject=void 0,o.folderTree=h.folder.parents,o.folderTree.push(h.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=h.folder,o.sort())})},o.$on("projectFolderChanged",function(l,h){h.data.idx===o.activeFolder.idx&&h.data.server_uuid===o.activeServer.uuid&&e.send("projectsGetFolder",{serveruuid:o.activeServer.uuid,idx:o.activeFolder.idx}).then(function(u){u.ok&&(o.folderTree=u.folder.parents,o.folderTree.push(u.folder),o.foldersIdx=o.folderTree.length-1,o.activeFolder=u.folder,o.sort())})}),o.updateServer=function(){e.send("projectsListServer",{}).then(function(l){if(l.ok){o.serverList=l.server;let h=o.serverList[0];angular.forEach(o.serverList,function(u){i===u.uuid&&(h=u)}),o.selectServer(h)}})},o.updateServer()}],size:"lg"});return n.result.catch(function(o){}),n.result}}]);RSPrinterModule.factory("SelectPrinter",["$uibModal",function(t){return function(e){let i=t.open({templateUrl:"/views/projects/selectPrinter.php?lang="+lang,controller:["$scope","$uibModalInstance","$rootScope","RSPrinter",function(r,n,o,a){r.headline=e,r.selections={},r.checkAllIdle=!1,r.checkAll=!1;for(let l in o.printer)o.printer.hasOwnProperty(l)&&a.fetchPrintqueueFor(l);r.cancel=function(){n.dismiss()},r.selectPrinter=function(l,h){n.close({list:[l],autostart:h})},r.unselectCheckAll=()=>{r.checkAll=!1,r.checkAllIdle=!1},r.selectAllPrinters=l=>{angular.forEach(o.printerList,function(h,u){h&&h.active&&h.online&&(l?(r.selections[h.slug]=h.job=="none",r.checkAll=!1):(r.selections[h.slug]=!0,r.checkAllIdle=!1))})},r.selectPrinters=function(l){let h=[];angular.forEach(r.selections,function(u,c){u&&h.push(o.printer[c].status)}),n.close({list:h,autostart:l})}}],size:"lg"});return i.result.catch(function(r){}),i.result}}]);RSPrinterModule.factory("SelectPrinterGroup",["$uibModal","RSCom",function(t,e){return function(i){let r=t.open({templateUrl:"/views/projects/selectPrinterGroup.php?lang="+lang,controller:["$scope","$uibModalInstance","$rootScope",function(n,o,a){n.headline=i,n.cancel=function(){o.dismiss()},n.selectPrinter=function(h,u){o.close({slug:h,group:u})},n.groupsBySlug={};let l=function(){angular.forEach(a.printerList,function(h){n.groupsBySlug[h.slug]=[{id:"#",name:"Группа: по умолчанию"}],e.send("listModelGroups",{},h.slug).then(function(u){angular.forEach(u.groupNames,function(c){c!=="#"&&n.groupsBySlug[h.slug].push({id:c,name:"Группа: "+c})})})})};l(),n.$on("modelGroupListChanged",function(){l()})}],size:"lg"});return r.result.catch(function(n){}),r.result}}]);RSPrinterModule.controller("ProjectGCodePreviewController",["$scope","$stateParams","$rootScope","$http","User","RSCom","$uibModal","$timeout","Fullscreen","Confirm","Flash","$state",function(t,e,i,r,n,o,a,l,h,u,c,f){let d=new hl({user:n}),m=!1;t.featureNameMap=Vs,t.dummy=7,t.analyser=d,t.menuList={opt3d:!1},t.closeMenu=function(L){t.menuList[L]=!1},t.prevent=function(L,I){L&&(L.stopPropagation(),L.preventDefault()),I&&(t.menuList[I]=!t.menuList[I])},d.assignProject(e.serverid,e.projectid,e.model);let v=d.loadInfo(),g=null,p=["#005B73","#FC00FF","#59BDBE","#D0A766","#66c231"],_=null;t.gcodeChanged=!1,t.activeLayer=-1,t.editLayer=1,t.zoom2d=100;let x={},b=null,y=-1,w=0;t.percentSlider={percent:100,options:{floor:0,ceil:100,step:.01,precision:2,enforceStep:!1,hideLimitLabels:!0,onlyBindHandles:!0,showTicks:10,translate:function(L){return L.toFixed(0)}}},t.layerSlider={value:1,options:{floor:1,ceil:1,step:1,precision:0,enforceStep:!0,showTicks:100,hideLimitLabels:!0,onlyBindHandles:!0,vertical:!0,translate:function(L){return L.toFixed(0)}}},t.previewOptions={showPrint:!0,showTravel:!0,showRetract:!0,showGcode:e.tab.length===0?0:parseInt(e.tab),extrusionWidth:.4,showExtruder:!1,show:0},t.previewOptions=Wt(Wt({},t.previewOptions),JSON.parse(n.getSetting("preview2dOptions",JSON.stringify(t.previewOptions)))),e.tab.length&&(t.previewOptions.showGcode=parseInt(e.tab)),t.$parent.previewData=e.model,t.exlist=[],t.model=!1,t.show3dLegend=document.body.clientWidth>500,t.show2dLegend=!0,t.featureHeadline="Экструдер",t.features=[],t.roundFeatures=[{name:"Откат нити",color:"#C9302C"},{name:"Прогрессивная нить",color:"#0000ff"}],t.updateLegend=({headline:L,features:I,roundFeatures:k})=>{t.featureHeadline=L,t.features=I,t.roundFeatures=k},t.toggle2DLegend=function(){t.show2dLegend=!t.show2dLegend},t.menu2d={opt2d:!1,view:!1,info:!1},t.toggle2DMenu=(L,I)=>{L==="opt2d"?t.menu2d.opt2d=!t.menu2d.opt2d:t.menu2d.opt2d=!1,L==="view"?t.menu2d.view=!t.menu2d.view:t.menu2d.view=!1,L==="info"?t.menu2d.info=!t.menu2d.info:t.menu2d.info=!1,L&&I&&I.stopPropagation()},t.saveDefault2dView=()=>{n.setSetting("preview2dOptions",JSON.stringify(t.previewOptions))},t.toggle2DFullscreen=function(){h.toggleFullscreen($("#container-2d")[0])},t.setPreview=function(L){_=L,L&&(_.zoomEnabled=!0,_.adjustPosZoom(),t.fitObject(),_.drawPreviewLayer(b,t.percentSlider.percent),t.refreshSlider())},t.height2d="70vh",t.heightGCode="70vh";let S=L=>{L===void 0&&(L=10),t.previewOptions.showGcode===0&&(window.innerHeight>500?l(()=>{let I=$("#container-2d");if(I.length){let k=I[0].getBoundingClientRect();t.height2d=Math.max(window.innerHeight-k.top-1,300).toFixed(0)+"px",window.scrollY=0}else L>0&&l(()=>{S(L-1)},50)},10):t.height2d="70vh"),t.previewOptions.showGcode===1&&(window.innerHeight>500?l(()=>{let I=$("#layercode");if(I.length){let k=I[0].getBoundingClientRect();t.heightGCode=Math.max(300,window.innerHeight-k.top-12).toFixed(0)+"px",window.scrollY=0}else L>0&&l(()=>{S(L-1)},50)},10):t.heightGCode="70vh")};t.$on("windowResized",()=>{S()}),t.imgurl=function(){return`/project/${e.serverid}/image/${e.projectid}/`+encodeURIComponent(e.model)};let R=0,E=0,T=function(L){if(L===t.activeLayer)return;let I=d.layerInfo.layers[L-1],k=d.layerInfo.layers[L];if(d.layerData)t.editLayer=t.activeLayer=L,t.durationElapsed=I.t,t.durationRemaining=d.layerInfo.layers[d.layerInfo.layers.length-1].t-k.t,t.duration=k.t-I.t,t.startTime=I.t,t.height=k.h,t.lineCount=k.l-I.l,b=d.fetchLayer(L),_&&_.drawPreviewLayer(b,t.percentSlider.percent);else{let B=++R;r.get(`/project/${e.serverid}/layer/${e.projectid}?id=`+encodeURIComponent(e.model)+"&start="+I.p+"&end="+k.p).then(function(F){B<E||(E=B,t.editLayer=t.activeLayer=L,t.durationElapsed=I.t,t.durationRemaining=d.layerInfo.layers[d.layerInfo.layers.length-1].t-k.t,t.duration=k.t-I.t,t.startTime=I.t,t.height=k.h,t.lineCount=k.l-I.l,b=F.data,_&&_.drawPreviewLayer(b,t.percentSlider.percent))},function(){})}t.previewOptions.showGcode&&O(L)};t.update2dView=()=>{_&&_.drawPreviewLayer(b,t.percentSlider.percent)},t.percentSlider.options.onChange=()=>{_&&i.$applyAsync(()=>{_.drawPreviewLayer(b,t.percentSlider.percent)})};function A(){t.layerSlider.options.ceil=d.totalLayer;for(let L=0;L<t.model.extruderUsage.length;L++)t.exlist.push({col:p[L%p.length],name:"Печатающий экструдер @".replace("@",L+1)});T(1)}t.$on("gcodeInfoUpdated",function(L,I){I.data.modelId===e.model&&r.get(`/project/${e.serverid}/layeranalysis/${e.projectid}?id=`+encodeURIComponent(e.model)).then(function(k){setLayerdata(k.data)},function(){})});let C=[],M=0,D=function(){let L=M,I=[];angular.forEach(C,function(k,B){let F=x[""+(B+M)];if(F){let W=F.r.split(`
`);I[B]="",angular.forEach(W,function(V){V=V.trim(),V.length!==0&&((B&1)===1?I[B]+='<div class="odd">'+Ci(V,L,"line_add")+"</div>":I[B]+="<div>"+Ci(V,L,"line_add")+"</div>")}),F.d?(B&1)===1?I[B]+='<div class="odd" style="text-decoration: line-through;">'+Ci(k,L++,"line_del")+"</div>":I[B]+='<div style="text-decoration: line-through;">'+Ci(k,L++,"line_del")+"</div>":(B&1)===1?I[B]+='<div class="odd">'+Ci(k,L++,"line")+"</div>":I[B]+="<div>"+Ci(k,L++,"line")+"</div>"}else(B&1)===1?I[B]='<div class="odd">'+Ci(k,L++,"line")+"</div>":I[B]="<div>"+Ci(k,L++,"line")+"</div>"}),$("#layercode").html(I.join(""))},O=function(L){if(y===L||L<1||L>d.totalLayer)return;++w;let I=w,k=d.layerInfo.layers[L-1],B=d.layerInfo.layers[L];r.get(`/project/${e.serverid}/gcode/${e.projectid}?id=`+encodeURIComponent(e.model)+"&start="+k.g+"&end="+B.g).then(function(F){I<w||(w=I,y=L,C=F.data.substring(0,F.data.length-1).split(`
`),M=k.l,D())},function(){})};t.download=function(){let L=`/project/${e.serverid}/download/${e.projectid}/${encodeURIComponent(e.model)}`;window.open(L,"ihelper")},t.$watchCollection("previewOptions",function(L,I){L.showGcode!==I.showGcode&&t.toggle2DMenu(""),t.previewOptions.showGcode===1&&O(t.activeLayer),t.refreshSlider(),S()}),t.fitPrinter=function(){_&&_.fitBed()},t.fitObject=function(){_&&_.fitArea(d.layerInfo.xmin,d.layerInfo.ymin,d.layerInfo.xmax,d.layerInfo.ymax,2)},t.nextLayer=function(){t.activeLayer<d.totalLayer&&T(t.activeLayer+1)},t.prevLayer=function(){t.activeLayer>1&&T(t.activeLayer-1)},t.layerChanged=function(){t.editLayer=parseInt(t.editLayer),t.editLayer<1&&(t.editLayer=1),t.editLayer>d.totalLayer&&(t.editLayer=d.totalLayer),T(t.editLayer)},t.layerSlider.options.onChange=()=>{t.layerChanged()},t.editLine=function(L){if(!i.user.canAddFiles||(L.originalEvent.target?!L.originalEvent.target.className.startsWith("line"):!L.originalEvent.srcElement.className.startsWith("line")))return;let I=L.originalEvent.target?L.originalEvent.target.innerText:L.originalEvent.srcElement.innerText;a.open({templateUrl:"/views/printer/control/printer.editgcode.dialog.php?lang="+lang,scope:t,size:"lg",controller:["$scope",function(k){k.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},k.edit=angular.copy(x[I]),k.edit||(k.edit={d:!1,r:""}),k.addOrig=function(){k.edit.r=(k.edit.r.trim()+`
`+k.orig).trim()+`
`,k.edit.d=!0},k.addPause=function(){k.edit.r=(k.edit.r.trim()+`
@pause Do your stuff`).trim()+`
`},k.line=I,k.orig=C[parseInt(I)-M],k.$on("modal.closing",function(){k.edit.r=k.edit.r.trim(),k.edit.d||k.edit.r.length>0?(!x[I]||angular.toJson(x[I])!==angular.toJson(k.edit))&&(x[I]=k.edit,t.gcodeChanged=!0,D()):x[I]&&(delete x[I],t.gcodeChanged=!0,D())})}]}).result.catch(function(k){})},t.refreshSlider=function(){l(function(){t.$broadcast("rzSliderForceRender")})},t.saveGCode=function(){t.model.gcodePatch=angular.toJson(x),o.send("projectSetGCodeInfo",{id:e.model,serveruuid:e.serverid,projectid:e.projectid,info:t.model}).then(function(){t.gcodeChanged=!1})},t.printGCode=function(L,I){if(!I&&!i.activeConfig.general.enableQueue){c.error("Очередь отключена");return}if(i.active.state.condition!==1&&(I=!1),L.fits)t.preparePrint=!0,o.send("copyModel",{id:L.id,autostart:I}).then(function(){t.preparePrint=!1}),I?c.success("Начало печати."):c.success("Печать скопирована в очередь печати.");else{let k=i.activeConfig.shape.basicShape,B=i.activeConfig.movement,F=`<table class="table table-bordered table-hover"><tr><th>Параметр</th><th>Печать</th><th>Принтер</th></tr>`;k.shape==="circle"?F+=`<tr class="${L.radius>k.radius?"bg-danger":""}"><td>Радиус печатный</td><td>${L.radius}</td><td>${k.radius}</td></tr>`:(F+=`<tr class="${L.xMin<k.xMin||L.xMax>k.xMax?"bg-danger":""}"><td>Печать X</td><td>${L.xMin.toFixed(2)}..${L.xMax.toFixed(2)}</td><td>${k.xMin.toFixed(2)}..${k.xMax.toFixed(2)}</td></tr>`,F+=`<tr class="${L.yMin<k.yMin||L.yMax>k.yMax?"bg-danger":""}"><td>Печать Y</td><td>${L.yMin.toFixed(2)}..${L.yMax.toFixed(2)}</td><td>${k.yMin.toFixed(2)}..${k.yMax.toFixed(2)}</td></tr>`),k.shape!=="zbelt"&&(F+=`<tr class="${L.zMin<B.zMin||L.zMax>B.zMax?"bg-danger":""}"><td>Печать Z</td><td>${L.zMin.toFixed(2)}..${L.zMax.toFixed(2)}</td><td>${B.zMin.toFixed(2)}..${B.zMax.toFixed(2)}</td></tr>`),F+=`<tr class="${L.xMinMove<B.xMin||L.xMaxMove>B.xMax?"bg-danger":""}"><td>Перемещение X</td><td>${L.xMinMove.toFixed(2)}..${L.xMaxMove.toFixed(2)}</td><td>${B.xMin.toFixed(2)}..${B.xMax.toFixed(2)}</td></tr>`,F+=`<tr class="${L.yMinMove<B.yMin||L.yMaxMove>B.yMax?"bg-danger":""}"><td>Перемещение Y</td><td>${L.yMinMove.toFixed(2)}..${L.yMaxMove.toFixed(2)}</td><td>${B.yMin.toFixed(2)}..${B.yMax.toFixed(2)}</td></tr>`,F+="</table>",u("Контрольный вопрос","Внимание! В соответствии с заданными вами значениями печатного стола эта модель не будет помещаться внутри вашего принтера. Печатать в любом случае?",null,null,null,F).then(function(){t.preparePrint=!0,o.send("copyModel",{id:L.id,autostart:I}).then(function(W){t.preparePrint=!1,W.ok?I?c.success("Начало печати."):c.success("Печать скопирована в очередь печати."):c.error(W.error)})})}},t.backProject=()=>{f.go("project",{serverid:e.serverid,projectid:e.projectid})},t.$on("$destroy",function(){m=!0,t.$parent.previewData=0});let P=o.send("projectGetGCodeInfo",{id:e.model,serveruuid:e.serverid,projectid:e.projectid}).then(function(L){t.model=L.info,x=angular.fromJson(t.model.gcodePatch)});Promise.all([P,v]).then(()=>{A()}),S()}]);RSBase.component("rsGcode3d",{template:`
<div id="container-3d"
        class="threeDView"
        style="position:relative; margin:0;width:100%;padding:0px;touch-action: none;"
        oncontextmenux="return false;"
        ng-click="toggle3DMenu('')"
   >
     <div id="gcode3dview" ng-style="{height: $root.isFullscreen ? '100vh' : $ctrl.glHeight}">
        <canvas></canvas>
        <div class="axis"><canvas></canvas></div>
     </div>     
     <div class="gc-features" ng-if="$ctrl.gcodeLoaded">
       <h3 ng-click="$ctrl.toggleLegend()">{{$ctrl.preview3d.featureHeadline}}
         <span class="pull-right margin-left">
           <i class="fa" ng-class="{'fa-caret-down':$ctrl.show3dLegend, 'fa-caret-right':!$ctrl.show3dLegend}"></i>
         </span>
       </h3>
       <div ng-if="$ctrl.show3dLegend">
       <div ng-repeat="f in $ctrl.preview3d.features track by $index">
         <div class="ft-color" ng-style="{background:f.color}"></div>
         {{f.name}}
       </div>        
        <hr ng-if="$ctrl.preview3d.roundFeatures.length">
       <div ng-repeat="f in $ctrl.preview3d.roundFeatures track by $index">
         <div class="ft-color-round" ng-style="{background:f.color}"></div>
         {{f.name}}
       </div>                
       </div>
     </div>
     <div ng-if="$ctrl.showSlider" style="position: absolute;right:-20px;width:60px;top:5px;bottom:40px" class="slidervr rsslider label_z_range slider-autohide">
       <rzslider rz-slider-model="$ctrl.layerRangeSlider.minValue" rz-slider-high="$ctrl.layerRangeSlider.maxValue" rz-slider-options="$ctrl.layerRangeSlider.options"></rzslider>
     </div>
     <div ng-if="$ctrl.showSlider" style="padding-right:0;bottom:0;position:absolute;left:5px;right:40px" class="sliderhb rsslider label_percent slider-autohide">
       <rzslider rz-slider-model="$ctrl.percentSlider3d.percent" rz-slider-options="$ctrl.percentSlider3d.options"></rzslider>
     </div>
     <!-- Menu -->
     <div style="position: absolute;top:10px;right:60px;z-index:100">
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('opt3d', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <i class="fa fa-bars gl-2" style="position: relative"></i>
         </div>
       </div>
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('view', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'" color-class="gl-2" style="position: relative"></rs-icon>
         </div>
       </div>
       <div class="d-inline-block" ng-click="$ctrl.toggle3DMenu('info', $event)">
         <div class="gl-btn"  style="position:relative;margin-right:10px">
           <i class="fa fa-info-circle gl-2" style="position: relative"></i>
         </div>
       </div>
       <div ng-if="$root.supportsFullscreen" class="gl-btn"  style="position:relative" title3="Включить полноэкранный режим" ng-click="$ctrl.toggleFullscreen()">
         <i class="rs gl-2" style="position: relative" ng-class="{'rs-fullscreen':!$root.isFullscreen,'rs-normalscreen':$root.isFullscreen}"></i>
       </div>
     </div>
     <!-- settings menu -->
     <div class="gc-menu" ng-if="$ctrl.menu3d.opt3d" ng-click="$event.stopPropagation()">
         <div class="form-group">
           <label>Качество</label>
           <select class="form-control" ng-change="$ctrl.update3dOptions(true)" 
                   ng-model="$ctrl.options3d.quality" 
                   ng-options="f.value as f.name for f in $ctrl.qualityNameMap"></select>
         </div>
         <div class="form-group">
           <label>Цветовая схема</label>
           <select class="form-control" ng-change="$ctrl.update3dOptions(true)" 
                   ng-model="$ctrl.options3d.show" 
                   ng-options="f.value as f.name for f in $ctrl.featureNameMap"></select>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showRapidMotion" 
                    ng-change="$ctrl.update3dOptions(false)">
               Показать движения перемещения
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showRetractions" 
                    ng-change="$ctrl.update3dOptions(true)">
             Показать отступления
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showDeretractions" 
                    ng-change="$ctrl.update3dOptions(true)">
             Покажите деретракцию
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.showSeams" 
                    ng-change="$ctrl.update3dOptions(true)">
             Показать швы
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.hideSkirtOozeShield" 
                    ng-change="$ctrl.update3dOptions(true)">
             Юбка из шкуры\/ореховый щит
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.hideSupport" 
                    ng-change="$ctrl.update3dOptions(true)">
             Скрыть поддержку
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.hideInfill" 
                    ng-change="$ctrl.update3dOptions(true)">
             Скрыть внутреннее заполнение
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.transparentTop" 
                    ng-change="$ctrl.update3dOptions(false)">
             Показать прозрачный верх
           </label>
         </div>
         <div class="checkbox">
           <label>
             <input type="checkbox" ng-model="$ctrl.options3d.transparentBottom" ng-change="$ctrl.update3dOptions(false)">
             Показать прозрачный низ
           </label>
         </div>
         <div class="margin-bottom">
           <label>Предупреждение, если требуемая память превышает</label><br>
           <input type="number" style="width:120px;background: #00000080;color: #ffffff;" ng-model="$ctrl.options3d.memoryWarnSize"> MB
         </div>
         <div>
          <div class="btn btn-primary btn-block" ng-click="$ctrl.saveDefault()"><i class="fa fa-save"></i> Стандартный предварительный просмотр</div> 
        </div>
     </div>
     <div class="gc-menu" ng-if="$ctrl.menu3d.view" xng-click="$event.stopPropagation()">
       <ul>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientIsometric();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-iso.svg'" color-class="text-primary"></rs-icon>
             </div>
             Изометрическая проекция</a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientTop();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-top.svg'" color-class="text-primary"></rs-icon>
             </div>
             Вид сверху
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientFront();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-front.svg'" color-class="text-primary"></rs-icon>
             </div>
             Вид спереди
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientLeft();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-left.svg'" color-class="text-primary"></rs-icon>
             </div>
             Вид слева
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientRight();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-right.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             Вид справа
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientBack();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-back.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             Вид сзади
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.orientBottom();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-bottom.svg'" color-class="text-primary"></rs-icon>
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
             Вид снизу
           </a>
         </li>
         <li class="hr"></li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.view.fitPrinter();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-orientation-cube.svg'"></rs-icon>
             </div>
               Подогнать принтер
           </a>
         </li>
         <li role="menuitem">
           <a href="#" ng-click="$ctrl.preview3d.fitObject();$ctrl.toggle3DMenu('')">
             <div class="stack">
               <rs-icon icon-img="'/img/svg/rs-object.svg'"></rs-icon>
             </div>
               Подходящий объект
           </a>
         </li>
       </ul>
     </div>
     <!-- info menu -->
     <div class="gc-menu" ng-if="$ctrl.menu3d.info" ng-click="$event.stopPropagation()">
        <ul class="list-group" style="text-align: left">
          <li class="list-group-item active">
            <h4 style="margin:0">Анализ G-кода</h4>
          </li>
          <li class="list-group-item">
            <span>Количество слоев:</span>
            <span >{{$ctrl.analyser.totalLayer}}</span>
          </li>
          <li class="list-group-item">
            <span>Общая высота по Z:</span>
            <span>{{$ctrl.analyser.totalHeight | number:3}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape!=='circle'">
            <span>X Напечатанный:</span>
            <span>{{$ctrl.analyser.layerInfo.xmin | number:2}} - {{$ctrl.analyser.layerInfo.xmax | number:2}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape!=='circle'">
            <span>Y Напечатанный:</span>
            <span>{{$ctrl.analyser.layerInfo.ymin | number:2}} - {{$ctrl.analyser.layerInfo.ymax | number:2}} mm</span>
          </li>
          <li class="list-group-item" ng-if="activeConfig.shape.basicShape.shape==='circle'">
            <span>Радиус печатный:</span>
            <span>{{$ctrl.analyser.layerInfo.radius | number:2}} mm</span>
          </li>
          <li class="list-group-item">
            <span>Общее время печати:</span>
            <span>{{$ctrl.analyser.totalDuration | dhms}}</span>
          </li>
          <li class="list-group-item">
            <span>Общее число линий:</span>
            <span>{{$ctrl.analyser.totalLines}}</span>
          </li>
          <li class="list-group-item">
            <span>Слайсер:</span>
            <span>{{$ctrl.model.slicer}}</span>
          </li>
          <li class="list-group-item">
            <span>Объемная экструзия:</span>
            <span>{{$ctrl.model.volumetric | yesno}}</span>
          </li>
        </ul>
     </div>
     <div ng-if="$ctrl.showMemoryWarning" class="bg-warning text-warning" 
     style="position: absolute; max-width: calc( min(80%, 300px));;top:50px;    left: 0;
    right: 0;
    margin: 0 auto;padding:10px">
     <p>Чтобы показать это 3d-превью, требуется больше памяти, чем установленный порог. Если ты продолжишь, и оно не поместится в память, это приведет к краху окна браузера.</p>
     <p>{{$ctrl.sizeMessage}}</p>
     <br>
     <div class="btn btn-warning" style="width:100%" ng-click="$ctrl.continueShow()">Continue</div>
    </div>
     </div>`,controllerAs:"$ctrl",bindings:{analyser:"<",slug:"<",model:"<",mode:"@"},controller:["$element","$interval","$rootScope","RSCom","$document","$sce","Fullscreen","Flash","$scope","$timeout",function(t,e,i,r,n,o,a,l,h,u){let c=!1,f="",d=null,m=null,v=!1;this.glHeight="70vh",this.memoryGuessed=0,this.gcodeLoaded=!1,this.showMemoryWarning=!1,this.sizeMessage="The guessed memory required is 56 MB",this.qualityNameMap=R_,this.featureNameMap=Vs,this.show3dLegend=document.body.clientWidth>500,this.showSlider=!1,this.toggleLegend=()=>{this.show3dLegend=!this.show3dLegend},this.range3DChanged=()=>{let _=this.layerRangeSlider.minValue+"#"+this.layerRangeSlider.maxValue+"#"+this.percentSlider3d.percent;_!==f&&(f=_,d.setViewRange(this.layerRangeSlider.minValue,this.layerRangeSlider.maxValue,this.percentSlider3d.percent))},this.layerRangeSlider={minValue:1,maxValue:1,options:{floor:1,ceil:1,step:1,precision:0,minRange:0,maxRange:1,pushRange:!0,enforceStep:!0,showTicks:100,hideLimitLabels:!0,onlyBindHandles:!0,vertical:!0,translate:function(_){return _.toFixed(0)},onChange:()=>{this.range3DChanged()}}},this.percentSlider3d={percent:100,options:{floor:0,ceil:100,step:.01,precision:2,enforceStep:!1,hideLimitLabels:!0,onlyBindHandles:!0,showTicks:10,translate:function(_){return _.toFixed(0)},onChange:()=>{this.range3DChanged()}}},this.options3d={quality:di?1:2,show:1,transparentTop:!1,transparentBottom:!0,showRapidMotion:!1,showRetractions:!1,showDeretractions:!1,showSeams:!1,hideSkirtOozeShield:!1,hideSupport:!1,hideInfill:!1,memoryWarnSize:ao?20:200},this.menu3d={opt3d:!1,view:!1,info:!1};let g=window.localStorage.getItem("gcode3dOptions");g&&(this.options3d=Wt(Wt({},this.options3d),JSON.parse(g))),this.saveDefault=()=>{window.localStorage.setItem("gcode3dOptions",JSON.stringify(this.options3d)),l.success("Настройки предварительного просмотра, сохраненные по умолчанию для этого браузера")},this.toggle3DMenu=(_,x)=>{_==="opt3d"?this.menu3d.opt3d=!this.menu3d.opt3d:this.menu3d.opt3d=!1,_==="view"?this.menu3d.view=!this.menu3d.view:this.menu3d.view=!1,_==="info"?this.menu3d.info=!this.menu3d.info:this.menu3d.info=!1,_&&x&&x.stopPropagation()},this.update3dOptions=_=>{this.gcodeLoaded&&(d.setOptions(this.options3d),_&&d.updateGCodeGeometry(),d.setViewRange(this.layerRangeSlider.minValue,this.layerRangeSlider.maxValue,this.percentSlider3d.percent))},this.toggleFullscreen=function(){a.toggleFullscreen($("#container-3d")[0])};let p=!1;this.loadGCode=async()=>{this.showMemoryWarning=!1,await this.analyser.loadData(),this.gcodeLoaded=!0,this.update3dOptions(!0)},this.showGcode3d=async()=>{if(d||c||p)return;let _=$("#gcode3dview");if(_.length===0||_[0].clientWidth===0||_[0].children.length===0){console.log("wait dom 3d"),setTimeout(this.showGcode3d,25);return}p=!0,this.layerRangeSlider.maxValue=this.analyser.totalLayer,this.layerRangeSlider.options.ceil=this.analyser.totalLayer,this.layerRangeSlider.options.maxRange=this.analyser.totalLayer;let x=1;for(;this.analyser.totalLayer>0&&this.analyser.totalLayer/x>10;)x*=10;this.layerRangeSlider.options.showTicks=x,this.showSlider=this.mode==="preview",d=new hc(_,Wt({slug:this.slug,rootScope:i,analyser:this.analyser,model:this.model},this.options3d)),this.preview3d=d,this.memoryGuessed=this.analyser.guess3dMemory()/1024/1024,this.memoryGuessed===0&&(this.memoryGuessed=this.analyser.totalLines*37/1024/1024,console.log("fallback memory guess",this.memoryGuessed)),d.view.orientIsometric(),d.fitObject(),this.gcodeLoaded=!1,m=new IntersectionObserver(b=>{b[0].isIntersecting&&!v&&(v=!0),this.adjustSize()},{}),m.observe($("#gcode3dview")[0]),this.adjustSize(),i.$broadcast("rzSliderForceRender"),this.memoryGuessed>this.options3d.memoryWarnSize?(this.sizeMessage="Угаданная требуемая память составляет @1 МБ. Установленный тобой предел предупреждения для этого браузера составляет @2 МБ.".replace("@1",this.memoryGuessed.toFixed(0)).replace("@2",this.options3d.memoryWarnSize.toFixed(0)),this.showMemoryWarning=!0):await this.loadGCode()},this.continueShow=()=>{this.loadGCode()},this.adjustSize=()=>{window.innerHeight>500&&this.mode==="preview"?u(()=>{let _=t.get()[0].getBoundingClientRect();this.glHeight=Math.floor(window.innerHeight-_.top).toFixed(0)+"px",window.scrollY=0},10):this.glHeight="70vh"},h.$on("windowResized",()=>{this.adjustSize()}),this.$onDestroy=()=>{c=!0,m&&m.disconnect(),d&&(d.$destroy(),d=null),this.analyser=null},this.$onChanges=_=>{_.analyser&&this.analyser&&this.analyser.layerInfoPromise.then(()=>{this.showGcode3d()})},this.$onInit=()=>{this.adjustSize(),this.analyser&&this.analyser.layerInfoPromise.then(()=>{this.showGcode3d()})}}]});Gt.PackerPos=function(t,e){this.x=t||0,this.y=e||0};Gt.PackerPos.prototype.isEqual=function(t){return this.x===t.x&&this.y===t.y};Gt.PackerRect=function(t,e,i,r,n){this.x=t,this.y=e,this.w=i,this.h=r,this.obj=n};Gt.PackerRect.prototype.containsPoint=function(t){return t.x>=this.x&&t.y>=this.y&&t.x<this.x+this.w&&t.y<this.y+this.h};Gt.PackerRect.prototype.containsRect=function(t){return t.x>=this.x&&t.y>=this.y&&t.x+t.w<=this.x+this.w&&t.y+t.h<=this.y+this.h};Gt.PackerRect.prototype.intersects=function(t){return this.w>0&&this.h>0&&t.w>0&&t.h>0&&t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h};Gt.PackerRect.prototype.greater=function(t,e){return t.w>e.w&&t.w>e.h||t.h>e.w&&t.h>e.h};Gt.RectPacker=function(t,e){this.size=new Gt.PackerRect(0,0,t,e,null),this.vRects=[],this.vPositions=[],this.vPositions.push(new Gt.PackerPos(0,0)),this.area=0};Gt.RectPacker.prototype.end=function(){this.vPositions=[],this.vRects=[],this.size.w=0};Gt.RectPacker.prototype.isOK=function(){return this.size.w>0};Gt.RectPacker.prototype.w=function(){return this.size.w};Gt.RectPacker.prototype.h=function(){return this.size.h};Gt.RectPacker.prototype.totalArea=function(){return this.size.w*this.size.h};Gt.RectPacker.prototype.isFree=function(t){if(!this.size.containsRect(t))return!1;let e=!0;return angular.forEach(this.vRects,function(i){i.intersects(t)&&(e=!1)}),e};Gt.RectPacker.prototype.addPosition=function(t){let e=!1,i=0,r;angular.forEach(this.vPositions,function(n){t.x+t.y<n.x+n.y&&(e=!0,r=i),i++}),e?this.vPositions.splice(i,0,t):this.vPositions.push(t)};Gt.RectPacker.prototype.addRect=function(t){this.vRects.push(t),this.area+=t.w*t.h,this.addPosition(new Gt.PackerPos(t.x,t.y+t.h)),this.addPosition(new Gt.PackerPos(t.x+t.w,t.y))};Gt.RectPacker.prototype.addAtEmptySpot=function(t){let e=!1,i;for(i=0;i<this.vPositions.length;i++){let r=this.vPositions[i],n=new Gt.PackerRect(r.x,r.y,t.w,t.h,t.obj);if(this.isFree(n)){t=n,e=!0;break}i++}if(e){this.vPositions.splice(i,1);let r,n;for(r=1;r<=t.x&&this.isFree(new Gt.PackerRect(t.x-r,t.y,t.w,t.h,t.obj));r++);for(n=1;n<=t.y&&this.isFree(new Gt.PackerRect(t.x,t.y-n,t.w,t.h,t.obj));n++);n>r?t.y-=n-1:t.x-=r-1,this.addRect(t)}return e};Gt.RectPacker.prototype.addAtEmptySpotAutoGrow=function(t,e,i){if(t.w<=0)return!0;let r=this.size.w,n=this.size.h;for(;!this.addAtEmptySpot(t);){let o=this.size.w,a=this.size.h;if(o>=e&&a>=i)return this.size.w=r,this.size.h=n,!1;if(o<e&&(o<a||o===a&&t.w>=t.h)?this.size.w=Math.min(e,o+10):this.size.h=Math.min(i,a+10),this.addAtEmptySpot(t)||(o!==this.size.w?(this.size.w=o,a<e&&(this.size.h=Math.min(i,a+10))):(this.size.h=a,o<e&&(this.size.w=Math.min(e,o+10))),(o!==this.size.w||a!==this.size.h)&&this.addAtEmptySpot(t)))break;this.size.w=o,this.size.h=a,o<e&&(this.size.w=Math.min(e,o+10)),a<i&&(this.size.h=Math.min(i,a+10))}return!0};var $_=class{constructor(e,i){xs(this,"loadModel",()=>{this.group=new THREE.Group,this.group2=new THREE.Group,this.group3=new THREE.Group,this.plate.view.scene2.add(this.group2),this.plate.view.scene2.add(this.group3),this.plate.view.getScene().add(this.group),this.data.format===".stl"&&new THREE.STLLoader().load("/slicer/getmodel/"+this.plate.slug+"/"+this.plate.plateId+"?id="+this.data.id,i=>{this.geometry=i,this.material=new THREE.MeshPhongMaterial({color:16733491,specular:1118481,shininess:200});let r=new THREE.Mesh(i,this.material);r.castShadow=!0,r.receiveShadow=!1,r.model=this,this.glModel=r,this.glId=r.id,this.selMaterial=new THREE.MeshBasicMaterial({transparent:!0,opacity:.8,color:16776960,side:THREE.BackSide}),this.plate.centerIfNeeded(this),this.updatePosition(),this.group.add(r),this.plate.view.refresh(),this.plate.saveSetup(),this.plate.selectModel(this,!0)})});this.data=e,this.plate=i,this.color=16733491,this.glModel=null,this.selectionModel=null,this.group=null,this.selected=!1,this._arrX=null,this._arrY=null,this._arrZ=null,this._rotX=null,this._rotY=null,this._rotZ=null,this.quaternionZ=new THREE.Quaternion,this.quaternionX=new THREE.Quaternion,this.quaternionY=new THREE.Quaternion,this.hoverActive=!1,this.activeWorkMode=this.plate.WorkModes.NONE,this.group=null,this.group2=null,this.group3=null,this.actionStart=null,this.actionLast=null,this.lastAngle=0,this.startRotX=null,this.startRotY=null,this.startRotZ=null,setTimeout(this.loadModel,0)}destroy(){this.updateWorkMode(plate.WorkModes.NONE),this.group&&(this.plate.view.getScene().remove(this.group),this.plate.view.scene2.remove(this.group2),this.plate.view.scene2.remove(this.group3)),this.plate.primary===this&&(this.plate.primary=null),this.plate=null,this.geometry=null}hover(e){!this.glModel||e===this.hoverActive||(this.hoverActive=e,this.hoverActive?this.glModel.material.color.setHex(16776960):this.glModel.material.color.setHex(this.color),this.glModel.material.needsUpdate=!0)}nearestPointToRay(e,i){let r=this.plate.view.ray.ray,n=r.direction.dot(r.direction),o=r.direction.dot(i),a=i.dot(i),l=r.origin.clone().sub(e),h=l.dot(r.direction),u=l.dot(i),c=n*a-o*o;if(c===0)return;let f=(n*u-o*h)/c;return i.clone().multiplyScalar(f)}moveActionStart(e){this.actionStart=this.group.position.clone();let i=this.nearestPointToRay(this.actionStart,ks[e]);i!==void 0&&(this.actionLast=i)}moveActionMove(e){let i=this.nearestPointToRay(this.actionStart,ks[e]);if(i!==void 0){let r=i.clone().sub(this.actionLast);switch(e){case 0:if(r.x===0)return;this.data.posx+=r.x;break;case 1:if(r.y===0)return;this.data.posy+=r.y;break;case 2:if(r.z===0)return;this.data.posz+=r.z;break}this.actionLast=i,this.plate.setupChanged()}}scaleActionStart(e){let i=this.nearestPointToRay(this.group.position,ks[e]);i!==void 0&&(this.actionStart=i.clone(),this.actionLast=i)}scaleActionMove(e){let i=this.nearestPointToRay(this.group.position,ks[e]);if(i!==void 0){let r=i.clone().sub(this.actionLast),n=1;this.plate.view.ctrlKey&&(n=.01),this.plate.view.shiftKey&&(n=5);let o=100*(r.getComponent(e)/this.actionStart.getComponent(e));if(o===0)return;let a=this.data.scalex,l=this.data.scaley,h=this.data.scalez;if(this.plate.lockScale)a=Math.max(n,Math.round((a+o)/n)*n),l=Math.max(n,Math.round((l+o)/n)*n),h=Math.max(n,Math.round((h+o)/n)*n);else switch(e){case 0:a=Math.max(n,Math.round((a+o)/n)*n);break;case 1:l=Math.max(n,Math.round((l+o)/n)*n);break;case 2:h=Math.max(n,Math.round((h+o)/n)*n);break}if(a===this.data.scalex&&l===this.data.scaley&&h===this.data.scalez)return;this.data.scalex=a,this.data.scaley=l,this.data.scalez=h,this.actionLast=i,this.plate.setupChanged()}}rayPlaneIntersection(e,i){let r=ks[i],n=e.direction.dot(r);if(n!==0){let o=-e.origin.dot(ks[i])/n;return e.direction.clone().multiplyScalar(o).add(e.origin)}}rayPlaneDir(e,i){let r=this.rayPlaneIntersection(e,i);if(r!==void 0)switch(r.sub(this.group.position),i){case 0:return-Math.atan2(r.y,r.z)*180/Math.PI;case 1:return Math.atan2(r.x,r.z)*180/Math.PI;case 2:return-Math.atan2(r.x,r.y)*180/Math.PI}}rotateActionStart(e){this.startRotX=this.data.rotx,this.startRotY=this.data.roty,this.startRotZ=this.data.rotz,this.lastAngle=this.rayPlaneDir(this.plate.view.ray.ray,e)}rotateAxis(e,i){let r=new THREE.Euler(this.data.rotx*Math.PI/180,this.data.roty*Math.PI/180,this.data.rotz*Math.PI/180,"XYZ");this.quaternionX.setFromAxisAngle(e,i),this.quaternionY.setFromEuler(r),this.quaternionZ.multiplyQuaternions(this.quaternionX,this.quaternionY),this.quaternionZ.normalize(),r.setFromQuaternion(this.quaternionZ,"XYZ"),this.data.rotx=r.x*180/Math.PI,this.data.roty=r.y*180/Math.PI,this.data.rotz=r.z*180/Math.PI,this.updatePosition()}rotateActionMove(e){let i=this.rayPlaneDir(this.plate.view.ray.ray,e);if(Number.isNaN(i))return;let r=i-this.lastAngle,n=.1;this.plate.view.shiftKey&&(n=15),r=Math.round(r/n)*n;let o=new THREE.Euler(this.startRotX*Math.PI/180,this.startRotY*Math.PI/180,this.startRotZ*Math.PI/180,"XYZ");this.quaternionX.setFromAxisAngle(ks[e],r*Math.PI/180),this.quaternionY.setFromEuler(o),this.quaternionY.multiplyQuaternions(this.quaternionX,this.quaternionY),this.quaternionY.normalize(),o.setFromQuaternion(this.quaternionY,"XYZ"),this.data.rotx=o.x*180/Math.PI,this.data.roty=o.y*180/Math.PI,this.data.rotz=o.z*180/Math.PI,this.plate.setupChanged()}updateWorkMode(e){this.plate.view.disposed||e!==this.activeWorkMode&&(this._arrX&&(this.group2.remove(this._arrX,this._arrY,this._arrZ),this.group3.remove(this._arrX,this._arrY,this._arrZ),this.plate.removeActionObject(this._arrX),this.plate.removeActionObject(this._arrY),this.plate.removeActionObject(this._arrZ),this._arrX=this._arrY=this._arrZ=null),this._rotX&&(this.group2.remove(this._rotX,this._rotY,this._rotZ),this.plate.removeActionObject(this._rotX),this.plate.removeActionObject(this._rotY),this.plate.removeActionObject(this._rotZ),this._rotX=this._rotY=this._rotZ=null),wi.initialized.then(()=>{if(this.activeWorkMode=e,!this.selected)return;let i=wi.getGeometryHelper(),r=wi.getAxisMaterials();switch(e){case this.plate.WorkModes.MOVE_OBJECT:this._arrX=new THREE.Mesh(i.arrowX,r.x),this._arrY=new THREE.Mesh(i.arrowY,r.y),this._arrZ=new THREE.Mesh(i.arrowZ,r.z),this._arrX.actionSelect=()=>{this.moveActionStart(0)},this._arrX.actionMove=()=>{this.moveActionMove(0)},this._arrY.actionSelect=()=>{this.moveActionStart(1)},this._arrY.actionMove=()=>{this.moveActionMove(1)},this._arrZ.actionSelect=()=>{this.moveActionStart(2)},this._arrZ.actionMove=()=>{this.moveActionMove(2)},this.group2.add(this._arrX),this.group2.add(this._arrY),this.group2.add(this._arrZ),this.plate.addActionObject(this._arrX),this.plate.addActionObject(this._arrY),this.plate.addActionObject(this._arrZ);break;case this.plate.WorkModes.SCALE_OBJECT:this._arrX=new THREE.Mesh(i.scaleX,r.x.clone()),this._arrY=new THREE.Mesh(i.scaleY,r.y.clone()),this._arrZ=new THREE.Mesh(i.scaleZ,r.z.clone()),this._arrX.actionSelect=()=>{this.scaleActionStart(0)},this._arrX.actionMove=()=>{this.scaleActionMove(0)},this._arrY.actionSelect=()=>{this.scaleActionStart(1)},this._arrY.actionMove=()=>{this.scaleActionMove(1)},this._arrZ.actionSelect=()=>{this.scaleActionStart(2)},this._arrZ.actionMove=()=>{this.scaleActionMove(2)},this.group3.add(this._arrX),this.group3.add(this._arrY),this.group3.add(this._arrZ),this.plate.addActionObject(this._arrX),this.plate.addActionObject(this._arrY),this.plate.addActionObject(this._arrZ);break;case this.plate.WorkModes.ROTATE_OBJECT:this._rotX=new THREE.Mesh(i.rotateX,r.x.clone()),this._rotY=new THREE.Mesh(i.rotateY,r.y.clone()),this._rotZ=new THREE.Mesh(i.rotateZ,r.z.clone()),this._rotX.actionSelect=()=>{this.rotateActionStart(0)},this._rotX.actionMove=()=>{this.rotateActionMove(0)},this._rotY.actionSelect=()=>{this.rotateActionStart(1)},this._rotY.actionMove=()=>{this.rotateActionMove(1)},this._rotZ.actionSelect=()=>{this.rotateActionStart(2)},this._rotZ.actionMove=()=>{this.rotateActionMove(2)},this.group2.add(this._rotX),this.group2.add(this._rotY),this.group2.add(this._rotZ),this.plate.addActionObject(this._rotX),this.plate.addActionObject(this._rotY),this.plate.addActionObject(this._rotZ);break}}))}rescaleGroups(){if(!this.group)return;let i=this.group.position.distanceTo(this.plate.view.camera.position)*.002;this.group2.scale.set(i,i,i),this.group3.scale.set(i,i,i),this.group2.updateMatrix(),this.group3.updateMatrix()}landObject(){let e=new THREE.Box3().setFromObject(this.glModel);this.data.posz-=e.min.z,this.plate.setupChanged()}centerObject(){let e=new THREE.Box3().setFromObject(this.glModel),i=new q;e.getCenter(i);let r=new q;this.plate.view.getPrinterBox().getCenter(r),this.data.posx+=r.x-i.x,this.data.posy+=r.y-i.y,this.plate.setupChanged()}resetScale(){this.data.scalex=this.data.scaley=this.data.scalez=100,this.plate.setupChanged()}resetRotation(){this.data.rotx=this.data.roty=this.data.rotz=0,this.plate.setupChanged()}setSelected(e){e!==this.selected&&(this.selected=e,e?this.updateWorkMode(this.plate.WorkMode):this.updateWorkMode(this.plate.WorkModes.NONE))}deepestPoint(){let e=null,i=new THREE.Vector3;{let r=this.glModel.geometry.attributes.position,n=r.count,o=r.array;for(let a=0;a<n;a+=3)i.set(o[a],o[a+1],o[a+2]).applyMatrix4(this.glModel.matrixWorld),e===null?e=i.clone():i.z<e.z&&e.copy(i)}return e}smallestAngleTo(e,i){let r,n,o=1e3,a=new THREE.Vector3,l=new THREE.Vector3;{let h=this.glModel.geometry.attributes.position,u=h.count,c=h.array;for(let f=0;f<u;f+=3)a.set(c[f],c[f+1],c[f+2]).applyMatrix4(this.glModel.matrixWorld).sub(e),r=a.length(),n=a.z/r,n<o&&r>=i&&(o=n,l.copy(a))}return{v:l,alpha:Math.asin(o)}}smallestYZAngleTo(e,i){let r,n,o=1e3,a=new THREE.Vector3,l=new THREE.Vector3;{let h=this.glModel.geometry.attributes.position,u=h.count,c=h.array;for(let f=0;f<u;f+=3)a.set(c[f],c[f+1],c[f+2]).applyMatrix4(this.glModel.matrixWorld).sub(e),r=Math.sqrt(a.z*a.z+a.y*a.y),n=a.z/r,Math.abs(a.z)>.01&&n<o&&r>=i&&(o=n,l.copy(a))}return{v:l,alpha:Math.asin(o)}}layFlat(){this.boundingBox=new THREE.Box3().setFromObject(this.glModel);let e=this.boundingBox.size().length()*.025,i=this.deepestPoint(),r=this.smallestAngleTo(i,e);this.rotateAxis(ks[2],-Math.atan2(r.v.y,r.v.x)),this.rotateAxis(ks[1],r.alpha),i=this.deepestPoint(),r=this.smallestYZAngleTo(i,e),this.rotateAxis(ks[0],r.v.y>0?-r.alpha:r.alpha),this.landObject()}updatePosition(){if(this.glModel===null)return;let e=this.data,i=this.group;i.position.set(e.posx,e.posy,e.posz),i.rotation.set(e.rotx*Math.PI/180,e.roty*Math.PI/180,e.rotz*Math.PI/180),i.scale.set(e.scalex*.01,e.scaley*.01,e.scalez*.01),i.updateMatrix(),i=this.glModel,i.position.set(e.transx,e.transy,e.transz),this.group2.position.set(e.posx,e.posy,e.posz),this.group3.position.set(e.posx,e.posy,e.posz),this.group3.rotation.set(e.rotx*Math.PI/180,e.roty*Math.PI/180,e.rotz*Math.PI/180),this.group2.updateMatrix(),this.group3.updateMatrix(),this.group.updateMatrixWorld(),this.glModel.updateMatrixWorld()}};var ey=class{constructor(e,i,r,n,o,a){xs(this,"savePlate",()=>{this.saveTimeout=null,this.ignoreRefresh=!0,this.RSCom.send("plateSet",{setup:this.plate,id:this.plateId}),this.dataDirty=!1});xs(this,"refreshPlate",()=>{if(this.ignoreRefresh){this.ignoreRefresh=!1;return}this.RSCom.send("plateGet",{id:this.plateId}).then(e=>{this.plate=e.setup,this.name=e.name;let i=this.$scope.activeConfig.extruders.length;for(this.plate.filaments||(this.plate.filaments=[]);this.plate.filaments.length<i;)this.plate.filaments.push({});this.plate.printSetup||(this.plate.printSetup=""),this.updateLoadedModels(),this.$scope.$emit("intPlateChanged",this.plate)})});xs(this,"updateCallback",()=>{angular.forEach(this.models,r=>{r.rescaleGroups()});let e,i;if(this.dragObject===null&&(e=this.view.ray.intersectObjects(this.actionObjects),e.length>0?(i=e[0].object,this.hoverObject!==i&&(this.hoverObject&&this.hoverObject.material.color.setHex(this.hoverOldColor),this.hoverOldColor=i.material.color.getHex(),this.hoverObject=i,i.material.color.setHex(this.hoverColor))):(this.hoverObject&&this.hoverObject.material.color.setHex(this.hoverOldColor),this.hoverObject=null)),this.view.orbit.enabled=this.dragObject===null,this.hoverObject===null){let r=[];angular.forEach(this.models,n=>{n.glModel&&r.push(n.glModel)}),e=this.view.ray.intersectObjects(r),i=null,e.length>0&&(i=e[0].object.model),angular.forEach(this.models,n=>{n.hover(n===i)})}this.dragObject&&(this.dragObject.actionMove(),this.view.orbit.resetState())});xs(this,"clickCallback",e=>{this.hoverObject?this.hoverObject.actionSelect&&(this.view.orbit.resetState(),this.dragObject=this.hoverObject,this.dragObject.actionSelect(e)):this.dragObject=null});xs(this,"unclickCallback",()=>{this.dragObject=null});this.slug=e,this.$scope=a,this.plateId=i,this.RSCom=r,this.view=n,this.User=o,this.models=[],this.plate={},this.lockScale=!0,this.name="unknown",this.primary=void 0,this.hoverColor=16776960,this.wireframe=!1,this.loadedModels={},this.dataDirty=!0,this.config={},this.ignoreRefresh=!1,this.centerWhenLoaded=[],this.actionObjects=[],this.saveTimeout=null,this.WorkModes={NONE:-1,MOVE_OBJECT:0,ROTATE_OBJECT:1,SCALE_OBJECT:2},this.WorkMode=this.WorkModes.MOVE_OBJECT,this.hoverOldColor=null,this.hoverObject=null,this.dragObject=null,this.refreshPlate(),this.view.renderCallback=this.updateCallback,this.view.clickCallback=this.clickCallback,this.view.unclickCallback=this.unclickCallback,wi.initialized.then(()=>{let l=wi.getGeometryHelper(),h=wi.getAxisMaterials();this.view.sceneAxis.add(new THREE.Mesh(l.arrowX,h.x)),this.view.sceneAxis.add(new THREE.Mesh(l.arrowY,h.y)),this.view.sceneAxis.add(new THREE.Mesh(l.arrowZ,h.z))})}setWorkMode(e){this.WorkMode=e,angular.forEach(this.models,i=>{i.updateWorkMode(e)})}resetScale(){angular.forEach(this.models,e=>{e.selected&&e.resetScale()})}resetRotation(){angular.forEach(this.models,e=>{e.selected&&e.resetRotation()})}requiresCentering(e){this.centerWhenLoaded.push(e)}selectObjectRotateMode(){this.setWorkMode(this.WorkModes.ROTATE_OBJECT)}selectObjectScaleMode(){this.setWorkMode(this.WorkModes.SCALE_OBJECT)}selectObjectMoveMode(){this.setWorkMode(this.WorkModes.MOVE_OBJECT)}selectModel(e,i){this.primary=e,i&&angular.forEach(this.models,r=>{r.setSelected(r===e)}),setTimeout(()=>{this.$scope.$apply()},0)}fitObject(e){let i=new THREE.Box3().setFromObject(e.glModel);this.view.fitBoundingBox(i)}saveSetup(){this.dataDirty&&(this.saveTimeout!==null&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(this.savePlate,300))}startSlicing(e){let i={targetModels:e,gcodeName:this.plate.sliceName,inputFiles:[]};angular.forEach(this.models,r=>{let n=r.glModel.matrixWorld.elements;i.inputFiles.push({file:r.data.file,trans:[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]],extruder:r.data.extruder})}),this.RSCom.send("plateSlice",{id:this.plateId,config:this.config})}setupChanged(){angular.forEach(this.models,e=>{e.updatePosition()}),this.view.refresh(),this.dataDirty=!0,this.saveSetup(),setTimeout(()=>{this.$scope.$apply()},0)}duplicate(){angular.forEach(this.models,e=>{e.selected&&this.RSCom.send("plateDuplicateModel",{id:this.plateId,modelId:e.data.id}).then(i=>{i.ok&&this.centerWhenLoaded.push(i.id)})})}centerIfNeeded(e){let i=-1;angular.forEach(this.centerWhenLoaded,(r,n)=>{r===e.data.id&&(i=n)}),i!==-1&&(this.autoposition(),this.centerWhenLoaded.splice(i,1))}autoposition(){if(this.models.length===0)return;let e=this.view.getPrinterBox(),i=new THREE.Vector3;if(e.getCenter(i),this.models.length===1){let f=this.models[0],d=new THREE.Box3().setFromObject(f.glModel),m=new THREE.Vector3;d.getCenter(m);let v=f.data;v.transx=-m.x,v.transy=-m.y,v.transz=-m.z,v.posx+=i.x,v.posy+=i.y,v.posz+=m.z-d.min.z,f.glModel.position.set(v.posx,v.posy,v.posz),f.glModel.updateMatrix(),this.setupChanged();return}let r=new Gt.RectPacker(1,1),n=3,o=e.max.x-e.min.x,a=e.max.y-e.min.y,l=e.min.x,h=e.min.y;if(this.autosizeFailed=!1,angular.forEach(this.models,f=>{f.boundingBox=new THREE.Box3().setFromObject(f.glModel);let d=2*n+Math.ceil(f.boundingBox.max.x-f.boundingBox.min.x),m=2*n+Math.ceil(f.boundingBox.max.y-f.boundingBox.min.y);r.addAtEmptySpotAutoGrow(new Gt.PackerRect(0,0,d,m,f),o,a)||(this.autosizeFailed=!0)}),this.autosizeFailed)return;let u=(o-r.w())/2,c=(a-r.h())/2;angular.forEach(r.vRects,f=>{let d=f.obj,m=l+u+f.x+n,v=h+c+f.y+n;d.data.posx+=m-d.boundingBox.min.x,d.data.posy+=v-d.boundingBox.min.y}),this.setupChanged()}updateLoadedModels(){angular.forEach(this.loadedModels,e=>{e.deleted=!0}),angular.forEach(this.plate.models,e=>{console.log("updateLoadedModels",e),this.loadedModels[e.id]||(console.log("updateLoadedLoadinf",e),this.loadedModels[e.id]=new $_(e,this));let i=this.loadedModels[e.id];i.deleted=!1,angular.extend(i.data,e),i.updatePosition()}),this.models=[],this.plate.models=[],angular.forEach(this.loadedModels,e=>{e.deleted?(e.destroy(),delete this.loadedModels[e.data.id]):(this.plate.sliceName||(this.plate.sliceName=e.data.name),this.models.push(e),this.plate.models.push(e.data))})}landObjects(){angular.forEach(this.models,e=>{e.selected&&e.landObject()})}centerObjects(){angular.forEach(this.models,e=>{e.selected&&e.centerObject()})}layFlat(){angular.forEach(this.models,e=>{e.selected&&e.layFlat()})}removeActionObject(e){let i=-1;angular.forEach(this.actionObjects,(r,n)=>{r===e&&(i=n)}),i!==-1&&this.actionObjects.splice(i,1)}addActionObject(e){this.removeActionObject(e),this.actionObjects.push(e)}};function Qce(){return{lists:{infillPattern:[{id:0,text:"Automatic"},{id:1,text:"Lines"},{id:2,text:"Grid"}]},groups:[{id:0,name:"Printer",key:"printer",vis:"p"},{id:1,name:"Extruder",key:"extruder",vis:"e"},{id:2,name:"Filament",key:"filament",vis:"f"},{id:3,name:"Layer and Perimeter",key:"layer",vis:"po"},{id:4,name:"Speed",key:"speed",vis:"po"},{id:5,name:"Support",key:"support",vis:"po"},{id:6,name:"Skirt and Brim",key:"skirt",vis:"po"},{id:7,name:"Multiple Extruders",key:"multiple",vis:"po"},{id:8,name:"Infill",key:"infill",vis:"po"},{id:9,name:"G-Codes",key:"gcodes",vis:"po"}],params:[{name:"nozzleWidth",type:"float",group:"extruder",text:"Nozzle Width",unit:"mm",min:.05,max:100,step:.05,default:.4,vis:"e"},{name:"offsetX",type:"float",group:"extruder",text:"Offset X",unit:"mm",min:-1e5,max:1e5,step:1,default:0,vis:"e"},{name:"offsetY",type:"float",group:"extruder",text:"Offset Y",unit:"mm",min:-1e5,max:1e5,step:1,default:0,vis:"e"},{name:"retractLength",type:"float",group:"extruder",text:"Retraction Length",unit:"mm",min:0,max:100,step:.5,default:4,vis:"e"},{name:"retractSpeed",type:"float",group:"extruder",text:"Retraction Length",unit:"mm",min:1,max:1e3,step:1,default:40,vis:"e"},{name:"retractZLift",type:"float",group:"extruder",text:"Z Lift on Retraction",unit:"mm",min:1,max:1e3,step:1,default:40,vis:"e"},{name:"filamentDiameter",type:"int",group:"filament",text:"Filament Diameter",unit:"mm",min:0,max:1e3,step:1,default:1.75,vis:"f"},{name:"extrusionMultiplier",type:"int",group:"filament",text:"Extrusion Multiplier",unit:"%",min:1,max:1e3,step:1,default:100,vis:"f"},{name:"filamentTemperature",type:"int",group:"filament",text:"Filament Temperature",unit:"\xB0C",min:0,max:1e3,step:1,default:190,vis:"f"},{name:"bedTemperature",type:"int",group:"filament",text:"Heated Bed Temperature",unit:"\xB0C",min:0,max:1e3,step:1,default:0,vis:"f"},{name:"filamentMinSpeed",type:"float",group:"filament",text:"Minimum Print Speed",unit:"mm/s",min:0,step:1,default:10,vis:"f"},{name:"filamentMaxSpeed",type:"float",group:"filament",text:"Maximum Print Speed",unit:"mm/s, 0 = off",min:0,step:1,default:0,vis:"f"},{name:"filamentMaxVolume",type:"int",group:"filament",text:"Maximum Print Volume",unit:"mm^3/s, 0 = off",min:0,step:1,default:0,vis:"f"},{name:"fanAlwaysOn",type:"bool",group:"filament",text:"Keep Fan Always On",default:!1,vis:"f"},{name:"automaticFan",type:"bool",group:"filament",text:"Automatic Fan Cooling",default:!1,vis:"f"},{name:"minFanSpeed",type:"int",group:"filament",text:"Minimum Fan Speed",unit:"%",min:0,max:100,step:1,default:40,vis:"f"},{name:"maxFanSpeed",type:"int",group:"filament",text:"Maximum Fan Speed",unit:"%",min:0,max:100,step:1,default:40,vis:"f"},{name:"bridgesFanSpeed",type:"int",group:"filament",text:"Bridges Fan Speed",unit:"%",min:0,max:100,step:1,default:40,vis:"f"},{name:"disbaleFanFirstLayer",type:"int",group:"filament",text:"Disable Fan on First x Layer",unit:"%",min:0,max:100,step:1,default:2,vis:"f"},{name:"retractOnLayerChange",type:"bool",group:"printer",text:"Retract on Layer Change",vis:"e",default:!0},{name:"firmwareRetraction",type:"bool",group:"printer",text:"Firmware Retraction",vis:"p",default:!1},{name:"volumetricExtrusion",type:"bool",group:"printer",text:"Volumetric Extrusion",vis:"p",default:!1},{name:"layerHeight",type:"float",group:"layer",text:"Layer Height",unit:"mm",min:.001,max:100,step:.01,default:.2,vis:"po"},{name:"firstLayerHeight",type:"float",group:"layer",text:"First Layer Height",unit:"mm",min:.001,max:100,step:.01,default:.2,vis:"po"},{name:"numPerimeter",type:"int",group:"layer",text:"Number of Perimeters",unit:"",min:1,max:1e3,default:3,vis:"po"},{name:"numBottomSolidLayer",type:"int",group:"layer",text:"Number of Solid Bottom Layer",unit:"",min:0,max:1e3,default:3,vis:"po"},{name:"numTopSolidLayer",type:"int",group:"layer",text:"Number of Solid Top Layer",unit:"",min:0,max:1e3,default:3,vis:"po"},{name:"avoidCrossingPerimeter",type:"bool",group:"layer",text:"Avoid Crossing Perimeter",default:!0,vis:"po"},{name:"externalPerimeterFirst",type:"bool",group:"layer",text:"External Perimeter First",default:!1,vis:"po"},{name:"startGCode",type:"gcode",group:"gcodes",text:"Start G-Code",vis:"p",default:""},{name:"infillDensity",type:"float",group:"infill",text:"Infill Density",unit:"%",min:0,max:100,step:1,default:30,vis:"po"},{name:"infillPattern",type:"list",group:"infill",text:"Infill Pattern",list:"infillPattern",vis:"po",default:0},{name:"infillWidth",type:"float",group:"infill",text:"Infill Width",unit:"mm, 0 = auto",min:0,max:100,step:.01,default:0,vis:"po"},{name:"solidInfillWidth",type:"float",group:"infill",text:"Solid Infill Width",unit:"mm, 0 = auto",min:0,max:100,step:.01,default:0,vis:"po"},{name:"infillAngle",type:"float",group:"infill",text:"Infill Angle",unit:"%",min:0,max:360,step:1,default:45,vis:"po"},{name:"infillPerimeterOverlap",type:"float",group:"infill",text:"Infill Perimeter Overlap",unit:"%",min:0,max:100,step:1,default:15,vis:"po"},{name:"speedDefault",type:"float",group:"speed",text:"Default Speed for Unset Speeds",unit:"mm/s, 0 = default",min:1,step:1,default:30,vis:"po"},{name:"speedFirstLayer",type:"float",group:"speed",text:"First Layer Speed",unit:"mm/s, 0 = default",min:1,step:1,default:25,vis:"po"},{name:"speedPerimeter",type:"float",group:"speed",text:"Speed for Perimeter",unit:"mm/s, 0 = default",min:1,step:1,default:40,vis:"po"},{name:"speedOuterPerimeter",type:"float",group:"extruder",text:"Speed Outer Perimeter",unit:"mm/s, 0 = default",min:1,step:1,default:30,vis:"po"},{name:"speedInfill",type:"float",group:"speed",text:"Speed for Infill",unit:"mm/s, 0 = default",min:1,step:1,default:60,vis:"po"},{name:"speedSolidInfill",type:"float",group:"speed",text:"Speeds for Solid Infills",unit:"mm/s, 0 = default",min:1,step:1,default:40,vis:"po"},{name:"speedOuterSolidInfill",type:"float",group:"speed",text:"Speeds for Outer Solid Infills",unit:"mm/s, 0 = default",min:1,step:1,default:30,vis:"po"},{name:"speedGapInfill",type:"float",group:"speed",text:"Speeds for Gap Infills",unit:"mm/s, 0 = default",min:1,step:1,default:20,vis:"po"},{name:"speedSupport",type:"float",group:"speed",text:"Speed for Support",unit:"mm/s, 0 = default",min:1,step:1,default:45,vis:"po"},{name:"speedBridges",type:"float",group:"speed",text:"Speed for Bridges",unit:"mm/s, 0 = default",min:1,step:1,default:30,vis:"po"},{name:"speedTravel",type:"float",group:"speed",text:"Speed for Travel Moves",unit:"mm/s, 0 = default",min:1,step:1,default:150,vis:"po"},{name:"addSkirt",type:"bool",group:"skirt",text:"Add Skirt",default:!0,vis:"po"},{name:"skirtDistance",type:"float",group:"skirt",text:"Distance between Skirt and Print",unit:"mm",min:0,max:1e4,step:1,default:6,vis:"po"},{name:"minSkirtExtrusion",type:"float",group:"skirt",text:"Minimum Extrusion for Skirt",unit:"mm",min:0,max:1e4,step:1,default:10,vis:"po"},{name:"addBrim",type:"bool",group:"skirt",text:"Add Brim",default:!1,vis:"po"},{name:"brimWidth",type:"float",group:"skirt",text:"Brim Width",unit:"mm",min:0,max:1e4,step:1,default:10,vis:"po"},{name:"endGCode",type:"gcode",group:"gcodes",text:"End G-Code",vis:"p",default:""},{name:"beforeLayerGCode",type:"gcode",group:"gcodes",text:"Before Layer Change G-Code",vis:"p",default:""},{name:"afterLayerGCode",type:"gcode",group:"gcodes",text:"After Layer Change G-Code",vis:"p",default:""}]}}RSBase.factory("SlicerOptions",[function(){let t={all:Qce(),print:[],extruder:[],filament:[],group:[],paramByName:{},printGroups:[],overrideGroups:[]};return angular.forEach(t.all.params,function(e){e.vis.indexOf("p")>-1&&t.print.push(e),e.vis.indexOf("e")>-1&&t.extruder.push(e),e.vis.indexOf("f")>-1&&t.filament.push(e),e.vis.indexOf("g")>-1&&t.group.push(e),t.paramByName[e.name]=e}),angular.forEach(t.all.groups,function(e){e.vis.indexOf("p")>=0&&t.printGroups.push(e),e.vis.indexOf("o")>=0&&t.overrideGroups.push(e)}),t.newBasicConfig=function(e,i,r){let n={name:e,id:i,extruder:[]};for(angular.forEach(t.print,function(o){n[o.name]=o.default});n.extruder.length<r;)n.extruder.push({});return angular.forEach(t.extruder,function(o){for(let a=0;a<r;a++)n.extruder[a][o.name]=o.default}),n},t.repairBasicConfig=function(e,i){for(;e.extruder.length<i;)e.extruder.push({});return e.extruder.splice(i,e.extruder.length-i),angular.forEach(t.print,function(r){typeof e[r.name]=="undefined"&&(e[r.name]=r.default)}),angular.forEach(t.extruder,function(r){for(let n=0;n<i;n++)typeof e.extruder[n][r.name]=="undefined"&&(e.extruder[n][r.name]=r.default)}),e},t.newFilamentConfig=function(e,i){let r={name:e,id:i};return angular.forEach(t.filament,function(n){r[n.name]=n.default}),r},t.repairFilamentConfig=function(e,i){return angular.forEach(t.filament,function(r){typeof e[r.name]=="undefined"&&(e[r.name]=r.default)}),e},t.newId=function(e,i){let r=0;return angular.forEach(e,function(n){let o=parseInt(n.id.substr(1));o>r&&(r=o)}),i+(r+1)},t.indexForId=function(e,i){for(let r=0;r<e.length;r++)if(e[r].id===i)return r;return 0},t.entryForId=function(e,i){for(let r=0;r<e.length;r++)if(e[r].id===i)return e[r];return e[0]},t}]);RSBase.directive("rsSlicerOption",["$compile","SlicerOptions",function(t,e){let i=function(r){if(r.type==="bool")return'<div class="checkbox"><label><input type="checkbox" ng-model="value[v]" ng-change="changed()">'+r.text+"</label></div>";if(r.type==="float")return r.unit&&r.unit.length>0?'<div class="form-group"><label>'+r.text+'</label><div class="input-group"><input type="number" class="nospin form-control" step="any" ng-model="value[v]" ng-change="changed()"><span class="input-group-addon">'+r.unit+"</span></div></div>":'<div class="form-group"><label>'+r.text+'</label><input type="number" class="nospin form-control" step="any" ng-model="value[v]" ng-change="changed()"></div>';if(r.type==="int")return r.unit&&r.unit.length>0?'<div class="form-group"><label>'+r.text+'</label><div class="input-group"><input type="number" class="form-control" step="1" ng-model="value[v]" ng-change="changed()"><span class="input-group-addon">'+r.unit+"</span></div></div>":'<div class="form-group"><label>'+r.text+'</label><input type="number" class="form-control" step="1" ng-model="value[v]" ng-change="changed()"></div>';if(r.type==="gcode")return"<div><label>"+r.text+'</label><rs-gcode-editor ng-model="value[v]" ng-change="changed()" style="width:100%; overflow-y: auto; "></rs-gcode-editor><!--<ui-codemirror ui-codemirror-opts="editorOptions" ng-model="value[v]" ng-change="changed()" style="width:100%;height:100px"></ui-codemirror>--></div>';if(r.type==="list")return'<div class="form-group"><label>'+r.text+'</label><select class="form-control" ng-model="value[v]" ng-options="o.id as o.text for o in so.all.lists.'+r.list+'"></select></div>'};return{restrict:"E",replace:!0,scope:{value:"=",changed:"&"},link:function(r,n,o){r.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0},r.so=e;let a=e.paramByName[o.name?o.name:value.id];r.v=o.name?o.name:"val",n.html(i(a)).show(),t(n.contents())(r)}}}]);RSPrinterModule.controller("PlatesController",["$scope","RSCom","$state","Confirm","P","Flash","User",function(t,e,i,r,n,o,a){t.plates=[],t.plateName="",t.addPrivatePlate=function(){e.send("plateCreate",{name:t.plateName,user:a.getLogin()}).then(function(h){t.editPlate(h.plateId)})},t.addPublicPlate=function(){e.send("plateCreate",{name:t.plateName,user:""}).then(function(h){console.log("Plate id created",h.plateId)})},t.editPlate=function(h){i.go("slicer",{slug:t.activeSlug,plateid:h})},t.deletePlate=function(h){r("Контрольный вопрос","Действительно удалить площадь $1?".replace("$1",h.name),null,null,!0).then(function(){e.send("plateDelete",{id:h.id}).then(function(){o.success("Площадь удалена")})})};let l=function(){e.send("platesList",{}).then(function(h){t.plates=h.plates})};t.$on("platesChanged",l),l()}]);RSPrinterModule.controller("EditPlateController",["$scope","RSCom","$state","Confirm","Flash","User","RSOverview","$timeout","P","resA","$rootScope","$uibModal","$http","StringDialog","SlicerOptions",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m,v){let g=function(V){if(C===V||V<1||V>t.totalLayer)return;++M;let N=M,ne=t.layerData.layers[V-1],ie=t.layerData.layers[V];d.get("/slicer/gcode/"+c.activeSlug+"/"+t.plate.plateId+"?start="+ne.g+"&end="+ie.g).then(function(Q){let K=Q.data;if(N<M)return;M=N,C=V;let de=K.substr(0,K.length-1).split(`
`),re=ne.l;angular.forEach(de,function(Y,U){(U&1)===1?de[U]='<div class="odd">'+D(Y,re++)+"</div>":de[U]="<div>"+D(Y,re++)+"</div>"}),$("#layercode").html(de.join(""))})},_,x,b=function(V){if(V===t.activeLayer)return;let N=++O,ne=t.layerData.layers[V-1],ie=t.layerData.layers[V];d.get("/slicer/layer/"+t.activeSlug+"/"+t.plate.plateId+"?start="+ne.p+"&end="+ie.p).then(function(Q){let K=Q.data;N<P||(P=N,t.activeLayer=V,t.duration=ie.t-ne.t,t.startTime=ne.t,t.height=ie.h,t.lineCount=ie.l-ne.l,x=K,w.setPos(V),null.controls.batchDraw(),null.drawPreviewLayer(x,_))}),t.previewOptions.showGcode&&g(V)},y,w=null.createSlider(1,function(V){b(Math.round(V))});a.selectPrinter(i.params.slug);let S=i.params.plateid,R=!1,E;t.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"gcode",readOnly:!1,theme:"neat",autoRefresh:!0};let T=function(){let V=$(".threeDView");if(V.length===0){l(T,30);return}if(y){E=new Gu(V,i.params.slug,c,"#openglgroup");let ne=new THREE.Scene;E.setScene(ne),E.addPrinter(),E.addLights(),y=!1,t.plate=new ey(t.activeSlug,S,e,E,o,t),t.$on("plateChanged",t.plate.refreshPlate),t.$on("connected",t.plate.refreshPlate)}let N=$(window).height();V.height(N-100),$(".slicerLeft").height(N-50),$(".slicerRight").height(N-70),E.refresh()};t.uploadFile=function(){f.open({templateUrl:"/views/printer/slicer/uploadModel.php?lang="+lang,scope:t,controller:["$scope","$uibModalInstance","Flash",function(V,N,ne){V.uploading=!1;let ie=function(){let K=$(this),de=K.val().replace(/\\/g,"/").replace(/.*\//,"");$("#modelUploadName").val(de),V.uploading=!0,e.extendPing(300),$("#formuploadmodel").ajaxSubmit({success:function(re){console.log("upload data",re),re.ok&&t.plate.requiresCentering(re.id),ne.success("Загрузка завершена"),V.uploading=!1,e.extendPing(0),K.val(""),N.close()},headers:{"X-Csrf-Token":e.getCookie("Csrf-Token")}}),de!==""&&K.val(""),t.$apply()},Q=function(){let K=$("#modelFilenameUpload");K.length>0?K.on("change",ie):setTimeout(Q,100)};Q(),t.close=function(){N.dismiss()}}]}).result.catch(function(V){})},t.uploadUrl=function(){},t.deleteModel=function(V){r("Контрольный вопрос","Вы действительно хотите удалить $1?".replace("$1",V.name)).then(function(){e.send("plateDeleteModel",{id:S,modelId:V.id})})},t.$on("windowResized",T),l(T,100),t.$on("$destroy",function(){console.log("destroy scope"),E!==void 0&&E.disconnect()}),t.activeLayer=-1,null.connectPrinter(c.activeConfig),null.zoomEnabled=!0,null.disableCursor();let A=["#000080","#FC00FF","59BDBE","D0A766"];t.exlist=[],t.model={},angular.forEach(c.activeConfig.extruders,function(V,N){t.exlist.push({col:A[N%A.length],name:"Печатающий экструдер @".replace("@",N+1)})}),x=null;let C=-1,M=0;_=100,t.previewOptions={showPrint:!0,showTravel:!0,showRetract:!0,showGcode:0,extrusionWidth:.4},null.preparePreview(t.previewOptions);let D=function(V,N){let ne='<span class="line">'+N+"</span>",ie="",Q="",K="",de="",re=0,Y=function(){return re===3||re===4?'<span class="v">'+de+"</span>":re===2?'<span class="p">'+K+"</span>":re===0?'<span class="cmd">'+ie+"</span>":""};if(V.length>1&&(V[0]==="@"||V[1]==="@"))return ne+'<span class="server">'+V+"</span>";for(let U=0;U<V.length;U++){let z=V[U];if(re===1){Q+=z;continue}if(z===";"&&(ne+=Y(),re=1,Q=";"),re===4){de+=z;continue}if(re===0){ie+=z,z===" "&&(re=2,ne+='<span class="cmd">'+ie+"</span>",(z==="M117 "||z==="M23 "||z==="M28 "||z==="M29 "||z==="M30 "||z==="M32 ")&&(re=4,K=""));continue}if(re===2&&(K+=z,z>="A"&&z<="Z"||z>="a"&&z<="z")){ne+=Y(),re=3,de="";continue}re===3&&(de+=z,z===" "&&(ne+=Y(),re=2,K=""))}return Q.length>0&&(Q='<span class="comment">'+Q+"</span>"),ne+Y()+Q};t.$watchCollection("previewOptions",function(){t.previewOptions.showGcode===1&&g(t.activeLayer),x&&null.drawPreviewLayer(x,_)}),t.fitPrinter=function(){null.fitPrinter()},t.fitObject=function(){null.fitArea(t.layerData.xmin,t.layerData.ymin,t.layerData.xmax,t.layerData.ymax,2)};let O=0,P=0,L=function(V){_=V,null.drawPreviewLayer(x,_)},I=null.createSlider(3,function(V){L(Math.round(V))});I.setMinMax(0,100,"%:","%"),I.setPos(_),I.callbackDelay=0,t.$on("$destroy",function(){null.$destroy(),t.$parent.previewData=0}),t.nextLayer=function(){t.activeLayer<t.totalLayer&&b(t.activeLayer+1)},t.prevLayer=function(){t.activeLayer>1&&b(t.activeLayer-1)},t.showGCode=function(){o.sessionStarted().then(function(){d.get("/slicer/layeranalysis/"+t.activeSlug+"/"+t.plate.plateId).then(function(V){t.layerData=V.data,t.totalLayer=t.layerData.layers.length-1,t.totalDuration=t.layerData.layers[t.totalLayer].t,t.totalHeight=t.layerData.layers[t.totalLayer].h,t.totalLines=t.layerData.layers[t.totalLayer].l,w.setMinMax(1,t.layerData.layers.length-1,"L:","L"),t.fitObject(),t.viewmode=2,b(1)})})},t.viewmode=0,t.$on("intPlateChanged",function(V,N){console.log("intPlateChanged",N),N.slicerRunning?t.viewmode=1:t.viewmode===1&&N.hasSlice&&t.showGCode()}),t.printGCode=function(){e.send("platePrintGCode",{id:t.plate.plateId}).then(function(){i.go("printer.print",{slug:t.activeSlug})})},t.storeGCode=function(){e.send("plateStoreGCode",{id:t.plate.plateId}).then(function(){i.go("printer.print",{slug:t.activeSlug})})},t.slicerConfig={},t.so=v,t.editSlicer=!1,t.slicerEditorActive=[!0,!1,!1,!1],t.extruderNames=[],t.ss={PID:void 0,FID:void 0,pGroup:0,groupMode:0,editGroupCat:0,editGroupGroup:void 0};let k=c.activeConfig.extruders.length;if(k===0)t.extruderNames.push({id:0,name:"Инструменты 1"});else for(let V=1;V<=k;V++)t.extruderNames.push({id:V-1,name:"Экструдер "+V});y=!0;let B=!1,F=function(V){angular.forEach(t.slicerEditorActive,function(N,ne){t.slicerEditorActive[ne]=!1}),t.slicerEditorActive[V]=!0,t.editSlicer=!0};t.updateSlicerPos=function(){t.ss.PID||angular.forEach(t.slicerConfig.printConfigs,function(V){t.ss.PID||(t.ss.PID=V.id)}),t.ss.FID||angular.forEach(t.slicerConfig.filamentConfigs,function(V){t.ss.FID||(t.ss.FID=V.id)}),t.ss.P=v.indexForId(t.slicerConfig.printConfigs,t.ss.PID),t.ss.F=v.indexForId(t.slicerConfig.filamentConfigs,t.ss.FID),t.activePrintConfig=t.slicerConfig.printConfigs[t.ss.P],t.activeFilamentConfig=t.slicerConfig.filamentConfigs[t.ss.F]},t.selectPrintGroup=function(V){t.ss.pGroup=V;let N=v.printGroups[V];t.ss.pParams=[],angular.forEach(v.print,function(ne){ne.group===N.key&&t.ss.pParams.push(ne)})},t.selectFilamentGroup=function(V){t.ss.fGroup=V};let W=function(){if(B){B=!1;return}e.send("getSlicerConfig",{}).then(function(V){t.slicerConfig=V,angular.forEach(t.slicerConfig.printConfigs,function(N){v.repairBasicConfig(N,t.activeConfig.extruders.length)}),t.slicerConfig.filamentConfigs.length===0&&t.slicerConfig.filamentConfigs.push(v.newFilamentConfig("Default","F1")),angular.forEach(t.slicerConfig.filamentConfigs,function(N){v.repairFilamentConfig(N)}),t.slicerConfig.categories.length===0&&t.slicerConfig.categories.push({name:"Misc",id:"C1",ref:0}),t.updateSlicerPos(),console.log("slicer config",t.slicerConfig)})};t.sendChangedSlicerConfig=function(){B=!0,e.send("setSlicerConfig",t.slicerConfig),console.log("slicer config",t.slicerConfig)},t.$on("slicerConfigChanged",function(){W()}),t.selectPrintGroup(0),W(),t.editPrintConfigs=function(){t.activePrintConfig=v.entryForId(t.slicerConfig.printConfigs,t.plate.plate.printSetup),F(0)},t.closeSlicerEditor=function(){t.editSlicer=!1},t.newBasicConfig=function(){m("Создание базовой конфигурации","Имя конфигурации","","Создайте").then(function(V){let N=v.newId(t.slicerConfig.printConfigs,"P"),ne=v.newBasicConfig(V,N,k);console.log("Config "+V,ne),t.slicerConfig.printConfigs.push(ne),t.slicerConfig.printConfigs.sortOn("name"),t.ss.PID=ne.id,t.updateSlicerPos(),t.sendChangedSlicerConfig()})},t.delBasicConfig=function(){t.slicerConfig.printConfigs.length<2||(t.slicerConfig.printConfigs.splice(t.ss.F,1),t.ss.PID=void 0,t.updateSlicerPos(),t.sendChangedSlicerConfig())},t.newFilamentConfig=function(){m("Создание конфигурации нити","Имя конфигурации","","Создайте").then(function(V){let N=v.newId(t.slicerConfig.filamentConfigs,"F"),ne=v.newFilamentConfig(V,N);console.log("Config "+V,ne),t.slicerConfig.filamentConfigs.push(ne),t.slicerConfig.filamentConfigs.sortOn("name"),t.ss.FID=ne.id,t.updateSlicerPos(),t.sendChangedSlicerConfig()})},t.delFilamentConfig=function(){t.slicerConfig.filamentConfigs.length<2||(t.slicerConfig.filamentConfigs.splice(t.ss.F,1),t.ss.FID=void 0,t.updateSlicerPos(),t.sendChangedSlicerConfig())},t.addCategory=function(){m("Создать новую категорию","Назване категории","","Создайте").then(function(V){let N=v.newId(t.slicerConfig.categories,"C"),ne={name:V,id:N,ref:0};t.slicerConfig.categories.push(ne),t.slicerConfig.categories.sortOn("name"),t.sendChangedSlicerConfig()})},t.delCategory=function(V){t.slicerConfig.categories[V].ref===0&&t.slicerConfig.categories.splice(V,1)},t.categoryNameChanged=function(V){V.name.length===0&&(V.name="Unknown"),t.slicerConfig.categories.sortOn("name"),t.sendChangedSlicerConfig()},t.selectEditGroupGroup=function(V){t.ss.editGroupCat=V;let N=t.slicerConfig.categories[V];t.ss.gParams=[],angular.forEach(t.slicerConfig.groups,function(ne){ne.cat===N.id&&t.ss.gParams.push(ne)})},t.addGroup=function(){m("Создать новую группу","Имя группы","","Создайте").then(function(V){let N=v.newId(t.slicerConfig.groups,"G"),ne=t.slicerConfig.groups[t.ss.editGroupCat];ne.ref++;let ie={name:V,id:N,cat:ne.id,params:[]};t.slicerConfig.groups.push(ie),t.slicerConfig.groups.sortOn("name"),t.ss.GID=N,t.sendChangedSlicerConfig()})}}]);var ty=Wt({showTerminal:!0},window.uiOptions);function fz(){return"0"}window.RSGSettingsModule=angular.module("RSGSettings",["ui.router","RSBase"]).config(["$stateProvider","RSRegistryProvider",function(t,e){t.state("gsettings.pushMessages",{url:"/pushMessages",templateUrl:"/views/gsettings/pushMessages.php?lang="+window.lang,controller:"PushMessageController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings",{url:"/gsettings",templateUrl:"/views/gsettings/gsettings.php?lang="+window.lang,controller:["RSGS",function(i){}],resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.price",{url:"/price",templateUrl:"/views/gsettings/price.php?lang="+window.lang,controller:"PriceController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.mqtt",{url:"/mqtt",templateUrl:"/views/gsettings/mqtt.php?lang="+window.lang,controller:"MQTTController"}).state("gsettings.webserver",{url:"/webserver",templateUrl:"/views/gsettings/webserver.php?lang="+window.lang,controller:"WebserverController",resolve:{IPS:["RSCom",function(i){return i.send("networkInterfaces",{})}]}}).state("gsettings.loginTerminal",{url:"/login-terminal",templateUrl:"/views/gsettings/loginTerminal.php?lang="+window.lang,controller:"LoginTerminalController"}).state("gsettings.connectivity",{url:"/connectivity",templateUrl:"/views/gsettings/connectivity.php?lang="+window.lang,controller:"ConnectivityController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.wlan",{url:"/wlan",templateUrl:"/views/gsettings/wlan.php?lang="+window.lang,controller:"WLANController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.timelapse",{url:"/timelapse",templateUrl:"/views/gsettings/timelapse.php?lang="+window.lang,controller:"TimelapseController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.folders",{url:"/folders",templateUrl:"/views/gsettings/folders.php?lang="+window.lang,controller:"FolderController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.previewimages",{url:"/previewimages",templateUrl:"/views/gsettings/previewimages.php?lang="+window.lang,controller:"PreviewImagesController",resolve:{PSetting:["RSCom",function(i){return i.send("getRenderSettings",{})}]}}).state("gsettings.cloud",{url:"/cloud",templateUrl:"/views/gsettings/cloud.php?lang="+window.lang,controller:"CloudController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.gui",{url:"/gui",templateUrl:"/views/gsettings/gui.php?lang="+window.lang,controller:"GUIController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.reports",{url:"/reports",templateUrl:"/views/gsettings/reports.php?lang="+window.lang,controller:"ReportsController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.web_actions",{url:"/web_actions",templateUrl:"/views/gsettings/webActions.php?lang="+window.lang,controller:"WebActionController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.gpio",{url:"/gpio",templateUrl:"/views/gsettings/gpio.php?lang="+window.lang,controller:"GPIOController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}).state("gsettings.externalLinks",{url:"/externalLinks",templateUrl:"/views/gsettings/externalLinks.php?lang="+window.lang,controller:"ExternalLinksController",resolve:{RSGS:["GSettings",function(i){return i.promise}]}}),e.registerGlobalSettingsDialog("Соединение","gsettings.connectivity","fa fa-signal",0),e.registerGlobalSettingsDialog("GUI","gsettings.gui","fa fa-desktop",0),e.registerGlobalSettingsDialog("Сеть\/Время","gsettings.wlan","fa fa-wifi",0),e.registerGlobalSettingsDialog("Ускоренная съемка","gsettings.timelapse","rs rs-timelapse",0),e.registerGlobalSettingsDialog("Push-уведомления","gsettings.pushMessages","rs rs-pushmessage",0),e.registerGlobalSettingsDialog("Предварительный просмотр изображений","gsettings.previewimages","fa fa-image",1),e.registerGlobalSettingsDialog("Затраты на печать","gsettings.price","fa fa-money",0),e.registerGlobalSettingsDialog("MQTT","gsettings.mqtt","rs rs-mqtt",0),e.registerGlobalSettingsDialog("Веб-сервер","gsettings.webserver","fa fa-shield",0),fz()!=="0"&&ty.showTerminal&&e.registerGlobalSettingsDialog("Терминал","gsettings.loginTerminal","fa fa-terminal",0),e.registerGlobalSettingsDialog("Папки","gsettings.folders","fa fa-folder-o",0),e.registerGlobalSettingsDialog("Печать отчетов","gsettings.reports","fa fa-file-pdf-o",0),e.registerGlobalSettingsDialog("Веб-действия","gsettings.web_actions","fa fa-globe",0),fz()==="2"&&e.registerGlobalSettingsDialog("Контакты GPIO","gsettings.gpio","rs rs-gpio",0),e.registerGlobalSettingsDialog("Внешние ссылки","gsettings.externalLinks","fa fa-globe",0)}]);RSGSettingsModule.controller("PriceController",["$scope","$rootScope","RSGS","GSettings","Flash","$filter",function(t,e,i,r,n,o){t.price=angular.copy(e.serverSettings.pricing),t.save=function(){e.serverSettings.pricing=t.price,r.serverSettingsChanged().then(function(){n.success("Цены сохранены","",2e3)},function(){})},t.onDragEnd=function(){},t.addFilament=function(){t.price.filaments.push({u:RSUtils.createAlphaID(10),n:"Материал",p:25,w:1.2})},t.delFilament=function(a){a<0||a>=t.price.filaments.length||t.price.filaments.length<2||t.price.filaments.splice(a,1)}}]);RSGSettingsModule.controller("MQTTController",["$scope","$rootScope","RSCom","Flash","$filter",function(t,e,i,r,n){t.mqttVersion=[{id:0,name:"Default 3.1.1 with fallback to 3.1"},{id:3,name:"3.1"},{id:4,name:"3.1.1"},{id:5,name:"5.0"}],t.readMQTT=function(){i.send("getMQTTConfig",{}).then(function(a){console.log("MQTT setting:",a),a.ok&&(t.mqtt=a.mqtt)})},t.readMQTT();function o(){i.send("getMQTTState",{}).then(a=>{t.mqttState=a.mqtt})}o(),t.$on("mqttState",(a,l)=>{console.log("mqttState",l),t.mqttState=l.data}),t.$on("connected",()=>{t.readMQTT(),o()}),t.saveMQTT=function(){i.send("setMQTTConfig",{mqtt:t.mqtt}).then(function(a){a.ok&&(t.mqtt=a.mqtt,r.success("Настройки MQTT сохранены","",2e3))})},t.addEventException=function(a){a.length>0&&t.mqtt.eventExceptions.indexOf(a)===-1&&t.mqtt.eventExceptions.push(a)}}]);RSGSettingsModule.controller("LoginTerminalController",["$scope","$rootScope","Flash","RSCom",function(t,e,i,r){t.userRequired=!1,t.channel="";let n=function(){e.user.adminPermission&&(t.userRequired=!0,r.send("loginTerminal",{}).then(o=>{o.terminal_id&&(t.channel=o.terminal_id)}))};ty.showTerminal&&n()}]);RSGSettingsModule.controller("PreviewImagesController",["$scope","$rootScope","GSettings","Flash","$filter","RSCom","PSetting","$uibModal",function(t,e,i,r,n,o,a,l){t.preview=a,t.preview.overrideOrientation===void 0&&(t.preview.overrideOrientation=!1,t.preview.overrideTheta=72,t.preview.overridePhi=225,t.preview.overrideThetaBelt=132,t.preview.overridePhiBelt=155),t.resetOrientation=function(){t.preview.overrideTheta=72,t.preview.overridePhi=225,t.preview.overrideThetaBelt=132,t.preview.overridePhiBelt=155},t.colors=[{v:"",n:"Индивидуальный"},{v:"#ff9800",n:"Золотой"},{v:"#ff5B01",n:"Медный"},{v:"#b06026",n:"Коричневый"},{v:"#ff3131",n:"Красный"},{v:"#ff019d",n:"Розовый"},{v:"#CC01ff",n:"Фиолетовый"},{v:"#292eff",n:"Синий"},{v:"#016dff",n:"Светло-синий"},{v:"#ffff00",n:"Желтый"},{v:"#c6ff01",n:"Лимонный"},{v:"#43e743",n:"Зелёный"},{v:"#5ca082",n:"Оливковый"},{v:"#ffffff",n:"Белый"},{v:"#aeaeae",n:"Серебряный"},{v:"#272727",n:"Чёрный"},{v:"#42ccd6",n:"Бирюзовый"}],t.aliasOptions=[{id:1,t:"Без сглаживания"},{id:2,t:"Низкий"},{id:3,t:"Хорошо"},{id:4,t:"Высокие"}],t.shadowOptions=[{v:0,n:"Жесткий (скорость вычисления: быстро)"},{v:1,n:"Мягкий (скорость вычисления: медленный)"},{v:2,n:"Индивидуальные дополнительные параметры (вы можете настроить все параметры)"}],t.computationMethods=[{v:!0,n:"Визуализации - жесткие тени (скорость вычисления: быстро)"},{v:!1,n:"Трассировка лучей - мягкие тени (скорость вычисления: медленно)"}],t.fullsizeImage=function(u){let c='<div class="modal-body pointer" ng-click="$dismiss()"><img src="'+u+'" alt="" style="max-width:100%"></div>';l.open({template:c,windowTemplateUrl:"/views/basic/fullsizeImage.html?lang="+window.lang}).result.catch(function(f){})},t.fullsizeDialog=function(u){l.open({templateUrl:"/views/gsettings/"+u+"?lang="+window.lang,windowTemplateUrl:"/views/base/fullsizeDialog.html?lang="+window.lang}).result.catch(function(c){})};let h=function(){let u=l.open({templateUrl:"/views/gsettings/preview.1.dialog.php?lang="+window.lang,windowTemplateUrl:"/views/base/fullsizeDialog.html?lang="+window.lang,controller:["$scope",function(c){c.use=function(f){c.$close(f)},c.imgheight=function(){return $("#colorimg").height()}}]}).result;return u.catch(function(c){}),u};t.matColor=function(u){h().then(function(c){t.preview.colors[u]=c},function(){})},t.save=function(){let u=t.preview;u.shadow===0?(u.renderShadows=!0,u.raytraceReflections=!0,u.gcodeAntialiasFactor=3,u.renderModels=!0):u.shadow===1&&(u.renderShadows=!0,u.raytraceReflections=!0,u.gcodeAntialiasFactor=3,u.renderModels=!1,u.raytraceShadowSamples=10,u.raytraceReflectionSamples=10),u.raytraceAntialias=u.renderAntialiasFactor=u.gcodeAntialiasFactor,u.raytraceShadows=u.renderShadows,u.raytraceReflections=u.renderReflections,o.send("setRenderSettings",u).then(function(){r.success("Просмотр параметров изображения сохранены")})},t.reset=function(){o.send("resetRenderSettings",t.preview).then(function(u){t.preview=u,r.success("Сброс настроек изображения предварительного просмотра")})},t.recompute=function(){o.send("updateAllRenderings",t.preview).then(function(){r.success("Обновление визуализации начато")})}}]);RSGSettingsModule.controller("ConnectivityController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","$uibModal","Confirm","$interval","InputText","Info",function(t,e,i,r,n,o,a,l,h,u,c){t.connect={},t.externalAccess=angular.copy(e.serverSettings.externalAccess),r.send("getCommunicationSettings",{}).then(function(m){t.connect=m}),t.newServerName=function(){u.input(t.connect.servername,{headline:"Изменить имя сервера",inputText:"Новое имя",regex:"^[a-zA-Z0-9][a-zA-Z0-9-]*$"}).then(function(m){r.send("newServerName",{name:m}).then(function(v){t.connect=v})},function(){})},t.newServerUUID=function(){e.serverSettings.backend_uuid.length>0?c("Информация","Ваша учетная запись уже связана с этим UUID. Вам нужно удалить подключения к облаку, прежде чем изменять свой идентификатор UUID."):r.send("newServerUUID",{}).then(function(m){t.connect=m})},t.newAPIKey=function(){r.send("newAPIKey",{}).then(function(m){t.connect=m})},t.saveRemoteServer=function(){r.send("setRemoteServer",{remoteServer:t.connect.remoteServer}).then(function(m){t.connect=m,o.success("Изменения сохранены")})},t.remoteUp=function(m){t.connect.remoteServer.splice(m-1,0,t.connect.remoteServer.splice(m,1)[0]),t.saveRemoteServer()},t.remoteDown=function(m){t.connect.remoteServer.splice(m+1,0,t.connect.remoteServer.splice(m,1)[0]),t.saveRemoteServer()},t.newRemote=function(){t.connect.remoteServer.push({name:"",apikey:"",port:3344,ip:"",computations:!0,projects:!0}),t.editRemote(t.connect.remoteServer.length-1)},t.editRemote=function(m){a.open({backdrop:"static",templateUrl:"/views/gsettings/connectivity.remote.php?lang="+lang,scope:t,size:"lg",controller:["$scope",function(v){v.e=angular.copy(t.connect.remoteServer[m]),v.applyChanges=function(){v.$close(),t.connect.remoteServer.splice(m,1,v.e),t.saveRemoteServer()},v.delete=function(){l("Требуется подтверждение","Действительно удалить этот удаленный сервер?",null,null,!0).then(function(){v.$close(),t.connect.remoteServer.splice(m,1),t.saveRemoteServer()},function(){})}}]}).result.catch(function(v){})},t.remoteStatus={};let f=function(){r.send("getCloudStatus",{}).then(function(m){t.remoteStatus={},angular.forEach(m.remoteServer,function(v){t.remoteStatus[v.ip+":"+v.port]=v,v.info="",v.reachable?v.apiKeyStatus<1?v.info="Недопустимый API ключ":(v.info="Предоставляемые услуги:<ul>",angular.forEach(v.services,function(g){v.info+="<li>"+g.name+"</li>"}),v.info+="</ul>"):v.apiKeyStatus===-2?v.info="Ожидание следующего запроса!":v.info="Сервер недоступен!"})})};t.findStatus=function(m){return t.remoteStatus[m.ip+":"+m.port]};let d=h(f,5e3);t.$on("$destroy",function(){h.cancel(d)}),t.saveDomain=function(){e.serverSettings.externalAccess=t.externalAccess,n.serverSettingsChanged().then(function(){o.success("Настройки домена сохранены","",2e3)},function(){})},f()}]);RSGSettingsModule.controller("TimelapseController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","$uibModal","Confirm","$interval","User","$http",function(t,e,i,r,n,o,a,l,h,u,c){t.timelapse=angular.extend({ffmpeg:"",threads:1,includeWatermark:!0,watermarkPosition:0,minFreeStorage:500,firstFrameSec:1,lastFrameSec:1,delImageAfterConversion:!0},angular.copy(e.serverSettings.timelapse));let f=function(){t.watermarkImage="/timelapse/watermark/"+RSUtils.createAlphaID(8)};f(),t.threads=[{id:1,name:"1 поток"},{id:2,name:"2 потока"},{id:3,name:"3 потока"},{id:4,name:"4 потока"}],t.save=function(){e.serverSettings.timelapse=angular.copy(t.timelapse),n.serverSettingsChanged().then(function(){o.success("Настройки ускоренного видео сохранены","",2e3)},function(){})};let d=function(){let v=$(this),g=v.val().replace(/\\/g,"/").replace(/.*\//,""),p=g.lastIndexOf("."),_="";if(p>0&&(_=g.substr(p+1)),_!=="png"){o.error("Неверный формат файла");return}$("#quickUploadName").val(g),t.uploading=!0,r.extendPing(300),$("#formuploadquick").ajaxSubmit({success:function(x){console.log("finished",x),x.ok?o.success("Загрузка завершена"):o.error(x.msg),t.uploading=!1,r.extendPing(0),f(),t.$apply()},headers:{"X-Csrf-Token":r.getCookie("Csrf-Token")}}),g!==""&&v.val(""),t.$apply()},m=function(){let v=$("#quickFilenameUpload");v.length>0?v.on("change",d):setTimeout(m,100)};m(),t.deleteWatermark=function(){c.get("/timelapse/deleteWatermark").then(f,function(){})}}]);RSGSettingsModule.controller("FolderController",["$scope","$rootScope","RSGS","Flash","$filter","RSCom",function(t,e,i,r,n,o){t.folders=[],t.browsing=!1,t.browseFolder="",t.browseFiles=[],function(){o.send("getFolders",{}).then(function(h){t.folders=h.folders})}(),t.newFolder={name:"",dir:""};let l=function(){e.serverSettings.folders=angular.copy(t.folders),o.send("setFolders",{folders:t.folders}).then(function(){r.success("Папки сохранены","",2e3)})};t.addFolder=function(){let h=1;angular.forEach(t.folders,function(u){u.id>=h&&(h=u.id+1)}),t.folders.push({id:h,name:t.newFolder.name,dir:t.newFolder.dir}),l()},t.onDragEnd=function(){l()},t.delFolder=function(h){h<0||h>=t.folders.length||(t.folders.splice(h,1),l())},t.browseTo=function(h,u){o.send("listFilesystemFolders",{root:h,next:u}).then(function(c){c.ok?(t.browseFiles=c.folders,t.browseFolder=c.root):(t.browseFiles=[],t.browseFolder="",t.browseTo("",""))})},t.selectDir=function(){t.browsing=!0,t.browseTo(t.newFolder.dir,"")},t.selectBrowse=function(){t.newFolder.dir=t.browseFolder,t.browsing=!1},t.abortBrowse=function(){t.browsing=!1}}]);RSGSettingsModule.controller("WebActionController",["$scope","$rootScope","RSGS","GSettings","Flash","Confirm","RSCom",function(t,e,i,r,n,o,a){let l=new RegExp("^https?:\\/\\/((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?))","i");t.edit=!1;let h=!1;t.editCall=function(c){t.edit=angular.copy(c),h=angular.copy(c)},t.addCall=function(){h=!1,t.edit={name:"",show_name:"",slug:"",method:"GET",post:"",url:"",icon:"",pos:-1,show_in_menu:!0,content_type:"application/json",question:""}},t.save=function(){h!==!1&&t.edit.name!==h.name?a.send("webCallRemove",{name:h.name}).then(function(){a.send("webCallSet",t.edit),t.edit=!1}):(a.send("webCallSet",t.edit),t.edit=!1)},t.remove=function(c){o("Контрольный вопрос","Реально удалить веб-экшен за $1?".replace("$1",c.show_name)).then(function(){a.send("webCallRemove",{name:c.name})})},t.onMoveWebaction=function(c){t.webCalls.splice(c,1)},t.onDragEnd=function(){let c={};for(let f=0;f<e.webCalls.length;f++)e.webCalls[f].pos=f,c[e.webCalls[f].name]=f;a.send("webCallsReorder",{order:c})},t.up=function(c){let f=!1;angular.forEach(e.webCalls,function(d){if(d.name===c.name){let m={};m[d.name]=f.pos,m[f.name]=d.pos,a.send("webCallsReorder",{order:m})}f=d})},t.down=function(c){let f=!1;angular.forEach(e.webCalls,function(d){if(f&&f.name===c.name){let m={};m[d.name]=f.pos,m[f.name]=d.pos,a.send("webCallsReorder",{order:m})}f=d})},t.cancel=function(){t.edit=!1},t.runCall=function(c){c.question?o("Контрольный вопрос",c.question).then(function(){a.send("webCallExecute",{name:c.name,params:["Test"]})}):a.send("webCallExecute",{name:c.name,params:["Test"]})},t.testSave=function(){let c=!0;return(!t.edit.name||t.edit.name.length===0)&&(c=!1),(!t.edit.show_name||t.edit.show_name.length===0)&&(c=!1),angular.forEach(e.webCalls,function(f){f.name===t.edit.name&&f.pos!==t.edit.pos&&(c=!1)}),(!t.edit.url||!l.test(t.edit.url))&&(c=!1),!c};function u(){let c=[{n:"Глобальная функция",s:""}];angular.forEach(e.printerList,function(f){c.push({n:f.name,s:f.slug})}),t.slugList=c}u()}]);RSGSettingsModule.controller("GPIOController",["$scope","$rootScope","RSGS","GSettings","Flash","Confirm","RSCom",function(t,e,i,r,n,o,a){let l=!1;t.operations=[{id:0,name:"Запуск G-кода при изменении"},{id:1,name:"Запустить внешнюю команду при изменении"},{id:2,name:"Запустите веб-действие при изменении"},{id:3,name:"Настройте включение\/выключение выхода"},{id:4,name:"Установи выход ШИМ"}],t.edge=[{id:0,name:"Растущий"},{id:1,name:"Падение"},{id:2,name:"Оба"}],t.bias=[{id:0,name:"По умолчанию"},{id:1,name:"Подтягивания"},{id:2,name:"Потяни вниз"},{id:2,name:"Отключить"}],t.drive=[{id:0,name:"По умолчанию"},{id:1,name:"Открытый дренаж"},{id:2,name:"Открытый исходный код"}],t.createData={operation:0,name:""},t.edit=!1;let h=!1;t.editCall=function(c){t.edit=angular.copy(c),h=angular.copy(c)},t.addGPIO=function(){l=!0,a.send("GPIOCreate",t.createData).then(function(){t.createData.name=""})},t.$on("gpioChanged",function(){e.gpio.length&&l&&(l=!1,t.editCall(e.gpio[e.gpio.length-1]))}),t.save=function(){a.send("GPIOUpdate",t.edit),t.edit=!1},t.remove=function(c){o("Контрольный вопрос","Действительно удалить операцию GPIO $1?".replace("$1",c.name)).then(function(){a.send("GPIODelete",{uuid:c.uuid})})},t.onDragEnd=function(){let c={};angular.forEach(e.gpio,function(f,d){c[f.uuid]=d}),a.send("GPIOReorder",{order:c})},t.up=function(c){let f=!1;angular.forEach(e.gpio,function(d){if(d.uuid===c.uuid){let m={};m[d.uuid]=f.pos,m[f.uuid]=d.pos,a.send("GPIOReorder",{order:m})}f=d})},t.down=function(c){let f=!1;angular.forEach(e.gpio,function(d){if(f&&f.uuid===c.uuid){let m={};m[d.uuid]=f.pos,m[f.uuid]=d.pos,a.send("GPIOReorder",{order:m})}f=d})},t.cancel=function(){t.edit=!1},t.testSave=function(){let c=!0;return(!t.edit.name||t.edit.name.length===0)&&(c=!1),!c};function u(){let c=[{n:"Глобальная функция",s:""}],f=[{n:"Пожалуйста выберите",s:""}];angular.forEach(e.printerList,function(d){c.push({n:d.name,s:d.slug}),f.push({n:d.name,s:d.slug})}),t.slugList=c,t.slugList2=f}u()}]);RSGSettingsModule.controller("ExternalLinksController",["$scope","$rootScope","RSGS","GSettings","Flash","Confirm","RSCom",function(t,e,i,r,n,o,a){t.editLinks=[],t.edit=!1;function l(){t.editLinks=[],angular.forEach(e.externalLinks,function(u){u.modifyable&&t.editLinks.push(JSON.parse(JSON.stringify(u)))})}l(),t.$on("int_externalLinksChanged",function(){l()}),t.edit=!1,t.permSettings={config:!1,print:!1},t.setConfigPermBitmapOptions=function(u){t.permSettings.config=(8&u)===8||u===0,t.permSettings.print=(1&u)===1||u===0},t.editLink=function(u){t.edit=u,t.setConfigPermBitmapOptions(u.configPerm),console.log(t.edit.configPerm)},t.addLink=function(){t.edit={href:"",title:"",icon:"",modifyable:!0,slug:"",openExternal:!0,touchscreen:!1,gui:!0,configPerm:0},t.setConfigPermBitmapOptions(0),t.editLinks.push(t.edit)},t.getConfigPermBitmap=function(){let u=0;return t.permSettings.config&&(u+=8),t.permSettings.print&&(u+=1),u},t.save=function(){t.testSave()&&(t.edit.configPerm=t.getConfigPermBitmap(),a.send("setExternalLinks",{list:t.editLinks}),t.edit=!1)},t.remove=function(u){o("Контрольный вопрос","Реально удалить внешнюю ссылку $1?".replace("$1",u.title)).then(function(){let c=t.editLinks.indexOf(u);c!==-1&&t.editLinks.splice(c,1),t.save()})},t.onDragEnd=function(){t.save()},t.cancel=function(){t.edit=!1,l()},t.testSave=function(){let u=!0;return t.edit&&(!t.edit.title||t.edit.href.length===0)&&(u=!1),u},t.$on("int_externalLinksChanged",()=>{l()});function h(){let u=[{n:"Глобальная функция",s:""}],c=[{n:"Пожалуйста выберите",s:""}];angular.forEach(e.printerList,function(f){u.push({n:f.name,s:f.slug}),c.push({n:f.name,s:f.slug})}),t.slugList=u,t.slugList2=c}h()}]);RSGSettingsModule.controller("ExternalLinkPrinterController",["$scope","$rootScope","$stateParams","$interval","$sce",function(t,e,i,r,n){let o=parseInt(i.id);t.link={};function a(){if(t.link=e.externalLinks[o],t.link){let u=window.location.host.match(/(.*?)(:\d+)?$/)[1];t.linkFixed=t.link.href.replace("0.0.0.0",u),e.frontend.setPrinterTabNameByState("printer.externalLink",t.link.title),e.frontend.setPrinterTabIconByState("printer.externalLink",t.link.icon?t.link.icon:"fa fa-external-link rs-bigtab")}}t.$on("int_externalLinksChanged",a,o),t.trustSrc=function(u){return n.trustAsResourceUrl(u)},t.iframeHeight="200px";function l(){let u=$("#externalLinkFrame")[0];if(u){let c=u.getBoundingClientRect();t.iframeHeight=window.innerHeight-c.top-25+"px"}}a(),e.frontend.setVisible("externalLink",!0);let h=r(l,1e3);t.$on("$destroy",function(){e.frontend.setVisible("externalLink",!1),r.cancel(h)})}]);RSGSettingsModule.controller("TerminalCommandController",["$scope","$rootScope","Flash","$stateParams","RSCom","$interval","$sce","$timeout",function(t,e,i,r,n,o,a,l){let h=parseInt(r.id),u=-1;t.link={},t.channel="",t.terminalCallback={onLine:m=>{}};function c(){let m=e.externalCommands.filter(v=>v.id==h);if(m.length){if(t.link=m[0],t.link.id===u)return;u=t.link.id,e.frontend.setPrinterTabNameByState("printer.terminalCommand",t.link.name),e.frontend.setPrinterTabIconByState("printer.terminalCommand",t.link.icon?t.link.icon:"fa fa-terminal rs-bigtab"),n.send("runExternalCommand",{id:t.link.id}).then(v=>{v.terminal_id&&(t.channel=v.terminal_id)})}}t.trustSrc=function(m){return a.trustAsResourceUrl(m)},t.iframeHeight="200px";function f(){let m=$("#terminalCommand")[0];if(m){let v=m.getBoundingClientRect(),g=window.innerHeight-v.top-25+"px";g!==t.iframeHeight&&(t.iframeHeight=g,l(()=>{e.$broadcast("windowResized")},0))}}t.$on("int_externalLinksChanged",c),c(),e.frontend.setVisible("terminalCommand",!0);let d=o(f,1e3);t.$on("$destroy",function(){e.frontend.setVisible("terminalCommand",!1),o.cancel(d)})}]);var Jce=/^$|^((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\/\d+$/,$ce=/^$|^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/\d+$/,dl=/^$|^((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])$/,dz=/^$|^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,pz=/^\d+$/;RSGSettingsModule.controller("WLANController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","$uibModal","Confirm","Wifi","InputText",function(t,e,i,r,n,o,a,l,h,u){t.wlanstate={active:0,hideIgnored:!0},t.wifi=h,t.edit=!1,t.eth={ok:!1},t.passwordMethods=[{v:"none",n:'Без шифрования'},{v:"psk2",n:'PSK2'},{v:"psk",n:'PSK'}];let c=new Date;function f(d){return d=d.toFixed(0),d.length===1?"0"+d:d}t.settime={},t.settime.datetime=1+c.getMonth()+"/"+c.getDate()+"/"+c.getFullYear()+" "+c.getHours()+":"+f(c.getMinutes())+":"+f(c.getSeconds()),h.updateRouterList(),t.$on("connected",function(){h.updateRouterList()}),t.editHostname=function(){u.input(h.getHostname(),{headline:'Изменить имя хоста',inputText:'Новое имя хоста',regex:"^[a-zA-Z0-9][a-zA-Z0-9-]{0,63}$"}).then(function(d){d!==h.getHostname()&&h.setHostname(d)},function(){})},t.editSSID=function(){u.input(h.getAPSSID(),{headline:'Изменение  SSID точки доступа',inputText:'Новый SSID',regex:"^[a-zA-Z0-9:_-]{0,32}$"}).then(function(d){d!==h.getAPSSID()&&h.setAPSSID(d)},function(){})},t.editAPPassword=function(){u.input("",{headline:'Изменить пароль',inputText:'Новый пароль'}).then(function(d){h.setAPPassword(d)},function(){})},t.editChannel=function(){a.open({templateUrl:"/views/gsettings/wlan.channel.modal.php?lang="+lang,size:"sm",scope:t,controller:["$scope",function(d){d.wifi=h,d.activeChannel=h.getAPChannel(),d.set=function(){d.activeChannel!==h.getAPChannel()&&h.setAPChannel(d.activeChannel),d.$close()}}]}).result.catch(function(d){})},t.editMode=function(){a.open({templateUrl:"/views/gsettings/wlan.mode.modal.php?lang="+lang,size:"sm",scope:t,controller:["$scope",function(d){d.wifi=h,d.activeMode=h.getAPMode(),d.set=function(){d.activeMode!==h.getAPMode()&&h.setAPMode(d.activeMode),d.$close()}}]}).result.catch(function(d){})},t.editRegion=function(){a.open({templateUrl:"/views/gsettings/wlan.region.modal.php?lang="+lang,size:"sm",scope:t,controller:["$scope",function(d){d.wifi=h,d.activeCountry=h.getRegion(),d.set=function(){d.activeMode!==h.getRegion()&&h.setRegion(d.activeCountry),d.$close()}}]}).result.catch(function(d){})},t.verifyWifiEdit=function(){let d=t.edit.data;t.err_wifi_ipv4Address=dl.test(d.ipv4Address)?"":"Нелегальный синтаксис. Пример: @".replace("@","192.168.1.89"),t.err_wifi_ipv4Nameserver=dl.test(d.ipv4Nameserver)?"":"Нелегальный синтаксис. Пример: @".replace("@","8.8.8.8"),t.err_wifi_ipv4Gateway=dl.test(d.ipv4Gateway)?"":"Нелегальный синтаксис. Пример: @".replace("@","192.168.1.1"),t.err_wifi_ipv4MaskBits=pz.test(d.ipv4MaskBits)?"":"Нелегальный синтаксис. Пример: @".replace("@","24"),t.err_wifi_ipv6Address=dl.test(d.ipv6Address)?"":"Нелегальный синтаксис. Пример: @".replace("@","fe80::dea6:32ff:fe16:987"),t.err_wifi_ipv6Nameserver=dl.test(d.ipv6Nameserver)?"":"Нелегальный синтаксис. Пример: @".replace("@","2001:4860:4860::8888"),t.err_wifi_ipv6Gateway=dl.test(d.ipv6Gateway)?"":"Нелегальный синтаксис. Пример: @".replace("@","fe80::3a64:edfa:fe2d:32c4"),t.err_wifi_ipv6MaskBits=pz.test(d.ipv6MaskBits)?"":"Нелегальный синтаксис. Пример: @".replace("@","64"),t.wifiValidated=!0,t.wifiHasErrors=(t.err_wifi_ipv4Address+t.err_wifi_ipv4Nameserver+t.err_wifi_ipv4Gateway+t.err_wifi_ipv4MaskBits+t.err_wifi_ipv6Address+t.err_wifi_ipv6Nameserver+t.err_wifi_ipv6Gateway+t.err_wifi_ipv6MaskBits).length!==0},t.editConnection=function(d){t.edit=Object.assign({},d),t.err_wifi_ipv4Address="",t.err_wifi_ipv4Nameserver="",t.err_wifi_ipv4Gateway="",t.err_wifi_ipv4MaskBits="",t.err_wifi_ipv6Address="",t.err_wifi_ipv6Nameserver="",t.err_wifi_ipv6Gateway="",t.err_wifi_ipv6MaskBits="",t.wifiValidated=!1,t.wlanstate.active=2},t.disableEdit=function(){t.edit=!1},t.updateConnection=function(){t.verifyWifiEdit(),t.wifiHasErrors?o.error('Недопустимые значения. Пожалуйста, исправь их перед сохранением.'):r.send("wifiSetSSIDData",t.edit.data).then(function(d){d.ok&&(t.edit.data=d.data,o.success('Новые данные подключения сохранены.'))})},t.disconnect=function(){t.edit.data.active=!1,r.send("wifiSetSSIDData",t.edit.data),t.wlanstate.active=0,t.edit=!1},t.canConnect=function(){return!t.edit||!t.edit.data?!1:t.edit.data.passwordMethod==="none"?!0:t.edit.data.password.length>0},t.connect=function({SSID:d}){t.verifyWifiEdit(),t.wifiHasErrors?o.error('Недопустимые значения. Пожалуйста, исправь их перед сохранением.'):r.send("wifiSetSSIDData",t.edit.data).then(function(){t.edit=!1,t.wlanstate.active=0,h.connect(d).then(function(m){},function(){}),o.success("Connection request send")})},t.refresh=function(){h.refreshRouterList(),o.success('Обновление станции wlan')},t.tzMode=0,t.editTimezone=function(){r.send("timezoneList",{}).then(function(d){t.tzList=d.list,t.tzList1=[];let m={};angular.forEach(d.list,function(v){let g=v.split("/")[0];m[g]||(m[g]=!0,t.tzList1.push(g))}),t.tzMode=1})},t.setDateTime=function(){r.send("setDateTime",{datetime:t.settime.datetime})},t.selectRegion=function(d){t.tzRegion=d,t.tzList2=[];let m=d+"/";angular.forEach(t.tzList,function(v){v.indexOf(m)===0&&t.tzList2.push(v.substr(m.length))}),t.tzList2.length?t.tzMode=2:t.setTimezone("")},t.setTimezone=function(d){d&&(t.tzRegion+="/"+d),r.send("timezoneSet",{timezone:t.tzRegion}).then(function(m){m.ok&&(h.routerListResponse.timezone=t.tzRegion,o.success('Новый часовой пояс установлен.')),t.tzMode=0})},t.verifyEth=function(){let d=h.routerListResponse.ethernet;t.err_eth_ipv4_addresses=Jce.test(d.ipv4_addresses)?"":"Нелегальный синтаксис. Пример: @".replace("@","192.168.1.89/24"),t.err_eth_ipv4_dns=dl.test(d.ipv4_dns)?"":"Нелегальный синтаксис. Пример: @".replace("@","8.8.8.8"),t.err_eth_ipv4_gateway=dl.test(d.ipv4_gateway)?"":"Нелегальный синтаксис. Пример: @".replace("@","192.168.1.1"),t.err_eth_ipv6_addresses=$ce.test(d.ipv6_addresses)?"":"Нелегальный синтаксис. Пример: @".replace("@","fe80::dea6:32ff:fe16:987/64"),t.err_eth_ipv6_dns=dz.test(d.ipv6_dns)?"":"Нелегальный синтаксис. Пример: @".replace("@","2001:4860:4860::8888"),t.err_eth_ipv6_gateway=dz.test(d.ipv6_gateway)?"":"Нелегальный синтаксис. Пример: @".replace("@","fe80::3a64:edfa:fe2d:32c4"),t.hasEthErrors=(t.err_eth_ipv4_addresses+t.err_eth_ipv4_dns+t.err_eth_ipv4_gateway+t.err_eth_ipv6_addresses+t.err_eth_ipv6_dns+t.err_eth_ipv6_gateway).length!==0,t.ethValidated=!0},t.getEth=function(){t.err_eth_ipv4_addresses="",t.err_eth_ipv4_dns="",t.err_eth_ipv4_gateway="",t.err_eth_ipv6_addresses="",t.err_eth_ipv6_dns="",t.err_eth_ipv6_gateway=""},t.setEth=function(){t.verifyEth(),t.hasEthErrors?o.error('Недопустимые значения. Пожалуйста, исправь их перед сохранением.'):r.send("ethernetSet",h.routerListResponse.ethernet).then(function(){o.success('Новые данные подключения сохранены.')})},t.getEth()}]);RSBase.controller("WebserverController",["$scope","$rootScope","$http","RSCom","IPS",function(t,e,i,r,n){t.loaded=!1,t.edit={newDNS:"",newIP:""},t.ips=n,t.fetchWebserverState=function(){r.send("webserverGetHTTPSConfig",{}).then(function(o){t.webserverState=o.state,t.webserverData=o.data,t.loaded=!0})},t.dataChanged=function(){console.log("webserverSetHTTPSConfig",t.webserverData),r.send("webserverSetHTTPSConfig",t.webserverData).then(function(o){t.webserverState=o.state,t.webserverData=o.data,t.loaded=!0})},t.removeIp=function(o){console.log("removeIp",o),t.webserverData.ipList.splice(t.webserverData.ipList.indexOf(o),1),t.dataChanged()},t.removeDNS=function(o){console.log("removeDNS",o),t.webserverData.dnsList.splice(t.webserverData.dnsList.indexOf(o),1),t.dataChanged()},t.addDNS=function(){t.edit.newDNS!==""&&t.webserverData.dnsList.indexOf(t.edit.newDNS)===-1&&t.webserverData.dnsList.push(t.edit.newDNS),t.edit.newDNS="",t.dataChanged()},t.addIp=function(){t.edit.newIp!==""&&t.webserverData.ipList.indexOf(t.edit.newIp)===-1&&t.webserverData.ipList.push(t.edit.newIp),t.edit.newIp="",t.dataChanged()},t.addActiveIPs=function(){n.ipv4.forEach(function(o){t.webserverData.ipList.indexOf(o.ip)===-1&&t.webserverData.ipList.push(o.ip)}),n.ipv6.forEach(function(o){t.webserverData.ipList.indexOf(o.ip)===-1&&t.webserverData.ipList.push(o.ip)}),t.dataChanged()},t.generateCertificate=function(){t.dataChanged(),r.send("webserverCreateCert",{}).then(function(o){console.log("webserverGenerateCertificate",o)})},t.deleteCert=function(){r.send("webserverDeleteCert",{}).then(function(o){console.log("webserverDeleteCert",o)})},t.noFile=function(){return document.getElementById("keyFile").files.length===0||document.getElementById("certFile").files.length===0},t.certFile=function(){let o=document.getElementById("certFile").files;return o.length===0?"Перетащите файл сюда":o[0].name},t.keyFile=function(){let o=document.getElementById("keyFile").files;return o.length===0?"Перетащите файл сюда":o[0].name},t.uploadCert=function(){let o=new FormData;o.append("keyfile",document.getElementById("keyFile").files[0]),o.append("certfile",document.getElementById("certFile").files[0]),i.post("/global/webserver/uploadCerts",o,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){t.dataChanged()})},e.$on("connected",function(){t.fetchWebserverState()}),e.$on("webserverSettingChanged",function(){t.fetchWebserverState()}),t.fetchWebserverState()}]);RSGSettingsModule.controller("CloudController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","$uibModal","Confirm","Wifi","InputText",function(t,e,i,r,n,o,a,l,h,u){t.login={login:"",password:""},t.error=!1,t.createCloud=function(){console.log("create cloud"),r.send("globalCloudRegister",t.login).then(function(c){console.log("rcr",c),c.ok?t.error="":t.error=c.error})}}]);RSGSettingsModule.controller("GUIController",["$scope","$rootScope","RSGS","RSCom","GSettings","Flash","User",function(t,e,i,r,n,o,a){e.$watchCollection("serverSettings.gui",function(){n.serverSettingsChanged()}),e.$watch("serverSettings.animatedLogin",function(){n.serverSettingsChanged()}),t.setLeftPrinterList=function(h){a.setSetting("leftPrinterList",h)};let l=function(){let h=e.serverSettings.frontSetting;h||(h={goWebInterface:!1,language:"en",listPerPage:10,listSort:0,listType:0,showEmergency:!0,showFullscreen:!1,unlockPin:"",lockOnScreensaver:!1,autopopupMessages:!1},e.serverSettings.frontSetting=h),t.lockScreen=h.lockOnScreensaver===void 0?!1:h.lockOnScreensaver,t.unlockPin=h.unlockPin===void 0||h.unlockPin===""?"":"######",h.autopopupMessages=h.autopopupMessages===void 0?!1:h.autopopupMessages,e.serverSettings.gui.printerNamePos=e.serverSettings.gui.printerNamePos===void 0?1:e.serverSettings.gui.printerNamePos,t.canSaveDisplay=!0,t.hideLeftSide=a.getSetting("leftPrinterList","0")};l(),t.saveDisplay=function(){t.canSaveDisplay&&(e.serverSettings.frontSetting.lockOnScreensaver=t.lockScreen,t.unlockPin!=="######"&&(e.serverSettings.frontSetting.unlockPin=t.unlockPin===""||!e.serverSettings.frontSetting.lockOnScreensaver?"":CryptoJS.SHA512(t.unlockPin).toString()),n.serverSettingsChanged(),o.success("ННастройки сохранены","",3e3,!0),l())},e.$watch("serverSettings.frontSetting",function(){l()}),t.$watch("unlockPin",function(){t.unlockPin==="#####"&&(t.unlockPin=""),t.canSaveDisplay=t.unlockPin==="######"||/^\d?\d?\d?\d?\d?\d?$/.test(t.unlockPin)})}]);RSGSettingsModule.controller("ReportsController",["$scope","$rootScope","RSGS","Flash","GSettings",function(t,e,i,r,n){t.reportMode=e.serverSettings.reportMode,t.reportWebcam=e.serverSettings.reportWebcam,t.reportCosts=e.serverSettings.reportCosts,t.reportMessage=e.serverSettings.reportMessage,t.save=function(){e.serverSettings.reportMode=t.reportMode,e.serverSettings.reportWebcam=t.reportWebcam,e.serverSettings.reportCosts=t.reportCosts,e.serverSettings.reportMessage=t.reportMessage,n.serverSettingsChanged().then(function(){r.success("Настройки отчета о печати сохранены","",2e3)},function(){})}}]);RSBase.controller("AboutController",["$scope","$rootScope","$http","$sce",function(t,e,i,r){t.licenseMap={MIT:'<p>The MIT License (MIT)</p><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p><p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p><p>THE SOFTWARE IS PROVIDED "AS IS" , WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>',"Apache-2.0":'<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this work except in compliance with the License. You may obtain a copy of the License in the LICENSE file, or at:</p> <a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank">https://www.apache.org/licenses/LICENSE-2.0.html</a> <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an AS IS  BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>'},t.thirdParty='стороннее программное обеспечение, используемое в @'.replace("@",'Repetier-Server Free'),t.extraLicenses=[],i.get("/licenses.json").then(function(n){angular.forEach(n,function(o,a){t.extraLicenses.push({name:a,license:t.licenseMap[o.licenses],home:o.repository})})},function(){}),t.supporter=!1,i.get("/global/supporter").then(function(n){n.data.ok&&(t.supporter=r.trustAsHtml(n.data.supporter||""))},function(){})}]);(function(){let t={name:"Мастер настройки",icon:"fa fa-magic rs-bigtab",visible:"showWizard",state:"printer.wizards",prio:4990,requireOnline:!1,requireActive:!0},e={name:"Калибровка смещения",icon:"rs rs-extruder",visible:"showWizardMic",state:"printer.microscope",prio:4990,requireOnline:!1,requireActive:!0},i={name:"Мастер настройки",icon:"fa fa-magic",visible:"user.printPermission",prio:4990,requireOnline:!1,requireActive:!0};window.RSWizardModule=angular.module("RSWizard",["ui.router","RSBase","RSPrinter"]).run(["$state","RSFrontend","$rootScope",function(r,n,o){i.exec=function(){r.go("printer.wizards",{slug:o.activeSlug})}}]).config(["$stateProvider","RSFrontendProvider",function(r,n){n.registerPrinterMenuEntry(i),n.registerPrinterTab(t),n.registerPrinterTab(e),n.setVisible("showWizard",!1),r.state("printer.wizards",{url:"/wizards",templateUrl:"/views/wizards/wizards.php?lang="+window.lang,controller:"WizardController"}).state("printer.microscope",{url:"/microscope",templateUrl:"/views/wizards/microscopeWizard.php?lang="+window.lang,controller:"MicroscopeWizardController"})}])})();RSWizardModule.controller("WizardController",["$scope","$rootScope","RSCom","Flash","GSettings","$timeout","RSPrinter","SelectWizards","KlipperDialog",function(t,e,i,r,n,o,a,l,h){e.frontend.setVisible("showWizard",!0),t.actKlipper="",t.didInstallKlipper=!1;function u(){i.send("getKlipperStatus",{}).then(f=>{t.klipper=f,t.actKlipper.length===0&&t.klipper.configs.forEach(d=>{d===e.activeSlug&&(t.actKlipper=e.activeSlug)}),t.actKlipper.length===0&&t.klipper.configs.length>0&&(t.actKlipper=t.klipper.configs[0])},()=>{})}function c(){i.send("getKlipperStatus",{}).then(f=>{t.klipper=f,t.didInstallKlipper=!1,t.klipper.installations.forEach(d=>{t.didInstallKlipper|=d===t.newprinter.slug})},()=>{})}u(),t.inputShaping=function(){console.log(t.actKlipper),h("inputShaping",t.actKlipper).then(()=>{u()})},a.setActivePage(e.activeSlug,{state:"printer.wizards",params:{slug:e.activeSlug}}),t.$on("$destroy",function(){e.frontend.setVisible("showWizard",!1)}),t.openManager=function(){l()}}]);RSWizardModule.controller("MicroscopeWizardController",["$scope","$rootScope","RSCom","Flash","GSettings","$timeout","$interval","User","RSPrinter","Confirm",function(t,e,i,r,n,o,a,l,h,u){let c=function(){if(t.refreshWebcamImage(),t.webcammode!==1){_=!1;return}o(c,1e3*e.activeConfig.webcams[t.activeCam].reloadInterval)},f=function(){let b=$("#webcamimage");if(b.length===0)return;let y=b.parent();if(t.setShowWebcam(!0),t.showWebcam===!1){y.css("height","auto");return}let w=b.width(),S=b.height(),R=0,E=y.width(),T=1,A,C;switch(e.activeConfig.webcams[t.activeCam].orientation){case 0:case 180:A=w,C=S;break;case 90:case 270:R=(w-S)/2,A=S,C=w;break}E<A&&(T=E/A);let M="scale("+T+") rotate("+e.activeConfig.webcams[t.activeCam].orientation+"deg)";b.css("-webkit-transform",M),b.css("-ms-transform",M),b.css("transform",M),b.css("margin-left",(E-w-2)/2+"px"),b.css("margin-top",(C*T-S)/2+"px"),T*C>0?y.height(T*C):y.css("height","auto"),$(".reccam").css("left",(E-w-2)/2+20+"px")},d=a(f,100),m="",v=function(){m.length>0&&(i.send("webcamCloseStream",{wcid:m}),m="")};t.step=1,t.errorStepsKnown=!1,t.step2=function(){t.step=2,t.firstExtruder=e.active.state.activeExtruder},t.step3=function(){t.step=3,t.x1=t.moveToXPos,t.y1=t.moveToYPos,t.z1=t.moveToZPos},t.step4=function(){t.step=4,t.x2=t.moveToXPos,t.y2=t.moveToYPos,t.z2=t.moveToZPos,t.diffx=t.x1-t.x2,t.diffy=t.y1-t.y2,t.diffz=t.z1-t.z2,t.secondExtruder=e.active.state.activeExtruder,t.var1=!1,angular.forEach(h.eepromData,function(b){b.text==="Steps per mm"&&(t.errorStepsKnown=!0,t.errorXSteps=Math.round(b.value*t.diffx),t.errorYSteps=Math.round(b.value*t.diffy),t.errorZSteps=Math.round(b.value*t.diffz)),b.text.indexOf("X-axis steps per mm")===0&&(t.errorStepsKnown=!0,t.errorXSteps=Math.round(b.value*t.diffx)),b.text.indexOf("Y-axis steps per mm")===0&&(t.errorStepsKnown=!0,t.errorYSteps=Math.round(b.value*t.diffy)),b.text.indexOf("Z-axis steps per mm")===0&&(t.errorStepsKnown=!0,t.errorZSteps=Math.round(b.value*t.diffz)),b.text.indexOf("Extr.1 X-offset [steps]")===0&&e.activeConfig.general.eepromType==="repetier"&&t.errorStepsKnown&&(t.var1=!0)}),t.autoUpdate=t.var1},t.home=function(){u("Домашняя позиция принтера","Убедись, что на пути самонаведения нет препятствий! Начинаешь самонаведение?").then(function(){h.sendGCode("@runButtonCommand homeAll")},function(){})},t.setEntryAutomatic=function(){if(t.var1){let b="Extr."+(t.secondExtruder+1)+" ";angular.forEach(h.eepromData,function(y){y.text.indexOf(b+"X-offset [steps]")===0&&(y.value=""+Math.round(parseFloat(y.value)+t.errorXSteps)),y.text.indexOf(b+"Y-offset [steps]")===0&&(y.value=""+Math.round(parseFloat(y.value)+t.errorYSteps)),y.text.indexOf(b+"Z-offset [steps]")===0&&(y.value=""+Math.round(parseFloat(y.value)+t.errorZSteps))}),h.saveEeprom(),t.autoUpdate=!1}},t.activeCam=0;let g=!1,p=!1;t.hasWebcam=t.activeConfig.webcams.length>0&&t.activeConfig.webcams[t.activeCam].method!==0,t.webcamUrl="/img/empty.png",t.showWebcam=!1,t.webcammode=0,t.$on("$destroy",function(){t.webcammode=0,t.webcamUrl="/img/empty.png",g!==!1&&$(g).attr("src","/img/empty.png"),a.cancel(d),p=!0});let _=!1;t.setShowWebcam=function(b,y){(!t.hasWebcam||!e.update.free)&&(b=!1),!b&&t.printing===!1&&(b=!0),t.showWebcam!==b&&(t.showWebcam=b,b?(e.activeConfig.webcams[t.activeCam].method&2)===2?(t.webcammode=2,t.enableMode2=!0,v(),m=RSUtils.createAlphaID(10),t.webcamUrl="/printer/cammjpg/"+e.activeSlug+"?cam="+t.activeCam+"&wcid="+m):(e.activeConfig.webcams[t.activeCam].method&1)===1?(t.webcammode=1,t.enableMode1=!0,_||(c(),_=!0)):t.webcamUrl="/img/nowebcam.png":t.webcamUrl="/img/empty.png"),b||(t.webcamUrl="/img/empty.png"),y&&(y.preventDefault(),y.stopPropagation())},t.toggleWebcam=function(){e.activeConfig.webcams.length===1?t.setShowWebcam(!1,$event):(t.activeCam++,t.activeCam>=e.activeConfig.webcams.length&&(t.activeCam=0),(e.activeConfig.webcams[t.activeCam].method&2)===2?(t.webcammode=2,t.enableMode2=!0,v(),m=RSUtils.createAlphaID(10),t.webcamUrl="/printer/cammjpg/"+e.activeSlug+"?cam="+t.activeCam+"&wcid="+m):(e.activeConfig.webcams[t.activeCam].method&1)===1?(t.webcammode=1,t.enableMode1=!0,_||(c(),_=!0)):t.webcamUrl="/img/nowebcam.png",f())},t.refreshWebcamImage=function(){t.webcamUrl="/printer/camjpg/"+e.activeSlug+"?cam="+t.activeCam+"&rand="+RSUtils.createAlphaID(10)};let x=function(){let b=$("#webcamimage");b.length===0?o(x,10):(g=b[0],t.printing||t.setShowWebcam(!0))};t.hasWebcam&&(x(),t.setShowWebcam(!0,void 0)),e.frontend.setVisible("showWizardMic",!0),t.$on("$destroy",function(){e.frontend.setVisible("showWizardMic",!1),v()}),h.readEEPROM()}]);RSUserModule.config(["$stateProvider",function(t){t.state("login",{url:"/login",templateUrl:"/views/user/login.php?lang="+window.lang,controller:"UserLoginController"}).state("userconfig",{url:"/userconfig",templateUrl:"/views/user/user.php?lang="+window.lang,controller:"UserConfigController"}).state("userprofile",{url:"/userprofile",templateUrl:"/views/user/editProfile.php?lang="+window.lang,controller:"UserProfileController",resolve:{P:["RSOverview",function(e){return e.printerListLoadedPromise}]}})}]).controller("UserLoginController",["$scope","$rootScope","RSCom","User","$location","$http","$state",function(t,e,i,r,n,o,a){if(r.isLoggedIn){a.go("home");return}t.login="",t.password="",t.animatedLogin=!1,t.rememberMe=!1,e.loginerror=!1,t.sendLogin=function(){o.post("/global/user/verify",{}).then(function(l){o.post("/global/user/login",{login:t.login,password:CryptoJS.SHA512(i.getCookie("Csrf-Token")+CryptoJS.MD5(t.login+t.password).toString()).toString(),rememberMe:t.rememberMe}).then(function(h){h=h.data,h.error?e.loginerror=h.error:(r.setCredentials(h),(typeof e.pathAfterLogin=="undefined"||e.pathAfterLogin==="/login")&&(e.pathAfterLogin="/"),n.path(e.pathAfterLogin),i.startConnection(),e.$broadcast("connected"),i.updateImportant())})})},window.scrollTo(0,0),setTimeout(function(){$("#login").focus()},1e3),r.recheckLogin()}]).controller("UserConfigController",["$scope","$rootScope","RSCom","$state","Confirm","$uibModal","User","RSPasswordCheck",function(t,e,i,r,n,o,a,l){if(!a.manageAccountsPermission&&!a.adminPermission){r.go("home");return}t.userlist=!1;let h=function(){i.send("userlist",{}).then(function(u){t.userlist=u})};h(),t.createUser=function(){let u=t.userlist===!1||t.userlist.users.length===0&&a.adminPermission;o.open({backdrop:"static",templateUrl:"/views/user/createUserDialog.php?lang="+lang,controller:["$scope",function(c){c.error="",c.ro=u,c.roa=u,c.passwordError=!1,c.passwordError2=!1,c.loginError=!1,c.edituser={login:"",name:"",print:a.printPermission?1:0,readfiles:a.readPermission?1:0,addfiles:a.addPermission?1:0,deletefiles:a.delPermission?1:0,configure:a.changeConfigPermission?1:0,history:a.historyPermission?1:0,seeprojects:a.seeProjectsPermission?1:0,editprojects:a.editProjectsPermission?1:0,seeallprinters:1,fullStop:a.fullStopPermission?1:0,changePasswords:a.changePasswordPermission?1:0,manageAccounts:u?1:0,admin:u?1:0,password:"",password2:""},c.$watchCollection("edituser",function(f,d){d.admin===0&&f.admin===1?(c.ro=!0,c.roa=!1,f.print=1,f.readfiles=1,f.addfiles=1,f.deletefiles=1,f.configure=1,f.history=1,f.seeprojects=1,f.editprojects=1,f.seeallprinters=1,f.fullStop=1,f.manageAccounts=1):d.admin===1&&f.admin===0&&(c.ro=!1)}),c.checkValid=function(){c.edituser.editprojects&&!c.edituser.seeprojects&&(c.edituser.editprojects=0)},c.sendCreateUser=function(){c.error="";let f=0;if(c.edituser.print===1&&(f+=1),c.edituser.addfiles===1&&(f+=2),c.edituser.deletefiles===1&&(f+=4),c.edituser.configure===1&&(f+=8),c.edituser.history===1&&(f+=16),c.edituser.seeprojects===1&&(f+=32),c.edituser.editprojects===1&&(f+=64),c.edituser.seeallprinters===1&&(f+=128),c.edituser.readfiles===1&&(f+=256),c.edituser.fullStop===1&&(f+=512),c.edituser.manageAccounts===1&&(f+=1024),c.edituser.admin===1&&(f+=2048),c.edituser.changePasswords===1&&(f+=4096),c.passwordError=!1,c.passwordError2=!1,c.loginError=!1,c.edituser.login.length===0){c.loginError=!0;return}if(c.edituser.password.length===0){c.passwordError2=!0;return}if(c.edituser.password!==c.edituser.password2){c.passwordError=!0;return}let d=l(c.edituser.password);if(d){c.error=d;return}i.send("createUser",{login:c.edituser.login,name:c.edituser.name,password:CryptoJS.MD5(c.edituser.login+c.edituser.password).toString(),permissions:f}).then(function(m){m.success?(h(),c.$close()):c.error=m.error})}}]}).result.catch(function(c){})},t.editUser=function(u){o.open({backdrop:"static",templateUrl:"/views/user/editUserDialog.php?lang="+lang,controller:["$scope",function(c){c.error="",c.passwordError=!1,c.ro=u.login===a.getLogin()||u.permissions&2048,c.roa=u.login===a.getLogin(),c.edituser={apikey:u.apikey,login:u.login,name:u.name,print:u.permissions&1?1:0,addfiles:u.permissions&2?1:0,deletefiles:u.permissions&4?1:0,configure:u.permissions&8?1:0,history:u.permissions&16?1:0,seeprojects:u.permissions&32?1:0,editprojects:u.permissions&64?1:0,seeallprinters:u.permissions&128?1:0,readfiles:u.permissions&256?1:0,fullStop:u.permissions&512?1:0,manageAccounts:u.permissions&1024?1:0,admin:u.permissions&2048?1:0,changePasswords:u.permissions&4096?1:0,password:"",password2:""},c.$watchCollection("edituser",function(f,d){d.admin===0&&f.admin===1?(c.ro=!0,c.roa=!1,f.print=1,f.readfiles=1,f.addfiles=1,f.deletefiles=1,f.configure=1,f.history=1,f.seeprojects=1,f.editprojects=1,f.seeallprinters=1,f.fullStop=1,f.manageAccounts=1,f.changePasswords=1):d.admin===1&&f.admin===0&&(c.ro=!1)}),i.send("canDeleteUser",{login:u.login}).then(f=>{c.cdu=f}),c.sendEditUser=function(){c.error="";let f=0;if(c.edituser.print===1&&(f+=1),c.edituser.addfiles===1&&(f+=2),c.edituser.deletefiles===1&&(f+=4),c.edituser.configure===1&&(f+=8),c.edituser.history===1&&(f+=16),c.edituser.seeprojects===1&&(f+=32),c.edituser.editprojects===1&&(f+=64),c.edituser.seeallprinters===1&&(f+=128),c.edituser.readfiles===1&&(f+=256),c.edituser.fullStop===1&&(f+=512),c.edituser.manageAccounts===1&&(f+=1024),c.edituser.admin===1&&(f+=2048),c.edituser.changePasswords===1&&(f+=4096),c.edituser.password.length>0){let d=l(c.edituser.password);if(d){c.error=d;return}}c.passwordError=!1,i.send("updateUser",{login:c.edituser.login,name:c.edituser.name,password:c.edituser.password.length===0?"":CryptoJS.MD5(c.edituser.login+c.edituser.password).toString(),permissions:f}).then(function(d){d.ok?(h(),c.$close()):c.error=d.error})},c.checkValid=function(){c.edituser.editprojects&&!c.edituser.seeprojects&&(c.edituser.editprojects=0)},c.deleteUser=function(f){c.cdu.canDelete&&n('Удалить пользователя','Действительно удалить этого пользователя?','Да, удалить пользователя','Нет',!0).then(function(){c.cdu.managedUsers>0?n('Удалить пользователя','У пользователя есть @ управляемых пользователей. Удалить и их тоже?'.replace("@",c.cdu.managedUsers),'Удаление управляемых пользователей','Держите управляемых пользователей',!0).then(()=>{console.log("del managed"),i.send("deleteUser",{login:f,deleteManaged:!0}).then(function(){h(),c.$close()})},()=>{console.log("keep managed"),i.send("deleteUser",{login:f,deleteManaged:!1}).then(function(){h(),c.$close()})}):i.send("deleteUser",{login:f,deleteManaged:!1}).then(function(){h(),c.$close()})})},c.renewApiKey=function(){i.send("newUserAPIKey",{login:u.login}).then(function(f){c.edituser.apikey=f.apikey})}}]}).result.catch(function(c){})}}]).controller("UserProfileController",["$scope","$rootScope","RSCom","$state","Confirm","RSPasswordCheck","Flash",function(t,e,i,r,n,o,a){if(!e.user.isRealUser){r.go("home");return}t.error="",t.errorPw="";let l=function(){i.send("userProfile",{}).then(function(h){t.passwordError=!1,t.u=h,t.edituser={login:h.login,name:h.name,print:h.permissions&1?1:0,addfiles:h.permissions&2?1:0,deletefiles:h.permissions&4?1:0,configure:h.permissions&8?1:0,history:h.permissions&16?1:0,seeprojects:h.permissions&32?1:0,editprojects:h.permissions&64?1:0,seeallprinters:h.permissions&128?1:0,readfiles:h.permissions&256?1:0,fullStop:h.permissions&512?1:0,manageAccounts:h.permissions&1024?1:0,changePasswords:h.permissions&4096?1:0,admin:h.permissions&2048?1:0,password:"",password2:"",oldPassword:""},i.send("canDeleteUser",{login:h.login}).then(u=>{t.cdu=u})})};l(),t.sendEditUser=function(){t.error="",t.errorPw="";let h=0;if(t.edituser.print===1&&(h+=1),t.edituser.addfiles===1&&(h+=2),t.edituser.deletefiles===1&&(h+=4),t.edituser.configure===1&&(h+=8),t.edituser.history===1&&(h+=16),t.edituser.seeprojects===1&&(h+=32),t.edituser.editprojects===1&&(h+=64),t.edituser.seeallprinters===1&&(h+=128),t.edituser.readfiles===1&&(h+=256),t.edituser.fullStop===1&&(h+=512),t.passwordError=!1,t.edituser.password.length>0){if(t.edituser.password!==t.edituser.password2){t.errorPw="Пароль и повторный пароль не совпадают!";return}let u=o(t.edituser.password);if(u){t.errorPw=u;return}}i.send("updateUser",{login:t.edituser.login,name:t.edituser.name,password:t.edituser.password.length===0?"":CryptoJS.MD5(t.edituser.login+t.edituser.password).toString(),oldPassword:t.edituser.oldPassword.length===0?"":CryptoJS.MD5(t.edituser.login+t.edituser.oldPassword).toString(),permissions:h}).then(function(u){u.ok?(l(),t.edituser.password.length===0?a.success("Имя пользователя изменено."):a.success("Установлен новый пароль.")):t.edituser.password.length===0?t.error=u.error:t.errorPw="Старый пароль неверен!"})},t.deleteUser=function(h){t.cdu.canDelete&&n('Удалить пользователя','Действительно удалить этого пользователя?','Да, удалить пользователя','Нет',!0).then(function(){t.cdu.managedUsers>0?n('Удалить пользователя','У пользователя есть @ управляемых пользователей. Удалить и их тоже?'.replace("@",t.cdu.managedUsers),'Удаление управляемых пользователей','Держите управляемых пользователей',!0).then(()=>{console.log("del managed"),i.send("deleteUser",{login:h,deleteManaged:!0})},()=>{console.log("keep managed"),i.send("deleteUser",{login:h,deleteManaged:!1})}):i.send("deleteUser",{login:h,deleteManaged:!1})})},t.renewApiKey=function(){i.send("newUserAPIKey",{login:t.u.login}).then(function(h){t.u.apikey=h.apikey})}}]);RSBase.factory("RSDropbox",["$rootScope","$timeout",function(t,e){let i={hasDropbox:!1};if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){$("body").append('<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="0ql2jlxr9mc57yn"><\/script>');let r=0,n=function(){i.hasDropbox=typeof window.Dropbox=="object",r++,r<50&&!i.hasDropbox&&e(n,200)};e(n,200)}return t.db=i,i}]);RSBase.factory("GoogleDrive",["$rootScope","$q",function(t,e){var i={},r="AIzaSyA4tBIY1Kmads1Zex7Qj6DkZrZND2-GBlY",n="769905759455-eug2a9066m1np11lfsh35s5kum78870v.apps.googleusercontent.com",o=["https://www.googleapis.com/auth/drive.readonly"],a=!1,l;function h(){gapi.load("auth",{callback:u}),gapi.load("picker",{callback:c})}function u(){console.log("onAuthApiLoad"),window.gapi.auth.authorize({client_id:n,scope:o,immediate:!1},f)}function c(){console.log("onPickerApiLoad"),a=!0,d()}function f(g){console.log("handleAuthResult",g),g&&!g.error&&(l=g.access_token,d())}function d(){if(console.log("createPicker"),a&&l){var g=new google.picker.PickerBuilder().addView(google.picker.ViewId.DOCS).setOAuthToken(l).setDeveloperKey(r).enableFeature("MULTISELECT_ENABLED").setCallback(v).build();g.setVisible(!0)}}var m=null;i.select=function(){return m=e.defer(),a==!1?h():d(),m.promise};function v(g){var p="nothing";if(g[google.picker.Response.ACTION]==google.picker.Action.PICKED){var _=g[google.picker.Response.DOCUMENTS][0];p=_[google.picker.Document.URL]}console.log(g),m.resolve(g)}return i}]);RSBase.factory("WaitSelectorAppear",["$rootScope",function(t){let e="",i={};window.prg=i;let r='<div id="progressWindow" style="display:none"><div class="modal-backdrop in" style="z-index:5000;"></div><div class="progressWin"><h1></h1><div class="progress" style="display:block"><div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" style="width: 0;"></div></div></div></div>';return $(r).prependTo($("body")),i.show=function(n,o){i.setProgress(o),i.setTitle(n),$("#progressWindow").show()},i.hide=function(){$("#progressWindow").hide()},i.setProgress=function(n){typeof n=="undefined"&&(n=-1),n<0?$("#progressWindow .progress").hide():($("#progressWindow .progress").show(),$("#progressWindow .progress-bar").css("width",n+"%"))},i.setTitle=function(n){typeof n=="undefined"&&(n=""),$("#progressWindow h1").html(n)},i.bindToMsgId=function(n){e=n},t.$on("progressUpdate",function(n,o){o.data.msgId===e&&(o.data.finished&&i.hide(),i.setProgress(o.data.progress))}),t.$on("disconnected",function(){i.hide()}),i}]);RSBase.factory("InputText",["$uibModal",function(t){let e={};return e.input=function(i,r){let n={headline:"",okText:"Ок",newString:i,inputText:"",regex:void 0};n=angular.extend(n,r),n.regex&&(n.regex=RegExp(n.regex));let o=t.open({backdrop:"static",templateUrl:"/views/services/inputString.modal.php?lang="+lang,size:"sm",controller:["$scope",function(a){a.data=n,a.isInvalid=function(){return n.regex?!n.regex.test(n.newString):!1},a.set=function(){a.isInvalid()||a.$close(a.data.newString)}}]}).result;return o.catch(function(a){}),o},e}]);RSBase.controller("PrivacyPolicyController",["$scope","$rootScope","$timeout","$http","RSCom","$state","User","RSOverview","RSMessages","RSRegistry","GSettings","RSFrontend","$uibModal","Flash",function(t,e,i,r,n,o,a,l,h,u,c,f,d,m){t.policy="Loading policy ...",t.accepted=e.serverSettings.policy_accepted,r.get("/privacypolicy/privacypolicy."+lang+".txt").then(function(v){t.policy=v.data}),t.accept=function(){e.serverSettings.policy_accepted=!0,c.serverSettingsChanged().then(function(){m.success("Благодарим Вас за принятие политики конфиденциальности","",5e3),o.go("home")})}}]);})();
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

event-lite/event-lite.js:
  (**
   * event-lite.js - Light-weight EventEmitter (less than 1KB when gzipped)
   *
   * @copyright Yusuke Kawasaki
   * @license MIT
   * @constructor
   * @see https://github.com/kawanet/event-lite
   * @see http://kawanet.github.io/event-lite/EventLite.html
   * @example
   * var EventLite = require("event-lite");
   *
   * function MyClass() {...}             // your class
   *
   * EventLite.mixin(MyClass.prototype);  // import event methods
   *
   * var obj = new MyClass();
   * obj.on("foo", function() {...});     // add event listener
   * obj.once("bar", function() {...});   // add one-time event listener
   * obj.emit("foo");                     // dispatch event
   * obj.emit("bar");                     // dispatch another event
   * obj.off("foo");                      // remove event listener
   *)

object-assign/index.js:
  (*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  *)

punycode/punycode.js:
  (*! https://mths.be/punycode v1.3.2 by @mathias *)

@pixi/polyfill/dist/esm/polyfill.mjs:
  (*!
   * @pixi/polyfill - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/polyfill is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/constants/dist/esm/constants.mjs:
  (*!
   * @pixi/constants - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/constants is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/settings/dist/esm/settings.mjs:
  (*!
   * @pixi/settings - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/settings is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/utils/dist/esm/utils.mjs:
  (*!
   * @pixi/utils - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/utils is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/math/dist/esm/math.mjs:
  (*!
   * @pixi/math - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/math is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/display/dist/esm/display.mjs:
  (*!
   * @pixi/display - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/display is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/extensions/dist/esm/extensions.mjs:
  (*!
   * @pixi/extensions - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/extensions is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/runner/dist/esm/runner.mjs:
  (*!
   * @pixi/runner - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/runner is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/ticker/dist/esm/ticker.mjs:
  (*!
   * @pixi/ticker - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/ticker is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/core/dist/esm/core.mjs:
  (*!
   * @pixi/core - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/core is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/accessibility/dist/esm/accessibility.mjs:
  (*!
   * @pixi/accessibility - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/accessibility is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/interaction/dist/esm/interaction.mjs:
  (*!
   * @pixi/interaction - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/interaction is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/extract/dist/esm/extract.mjs:
  (*!
   * @pixi/extract - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/extract is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/loaders/dist/esm/loaders.mjs:
  (*!
   * @pixi/loaders - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/loaders is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/compressed-textures/dist/esm/compressed-textures.mjs:
  (*!
   * @pixi/compressed-textures - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/compressed-textures is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/particle-container/dist/esm/particle-container.mjs:
  (*!
   * @pixi/particle-container - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/particle-container is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/graphics/dist/esm/graphics.mjs:
  (*!
   * @pixi/graphics - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/graphics is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/sprite/dist/esm/sprite.mjs:
  (*!
   * @pixi/sprite - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/sprite is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/text/dist/esm/text.mjs:
  (*!
   * @pixi/text - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/text is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/prepare/dist/esm/prepare.mjs:
  (*!
   * @pixi/prepare - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/prepare is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/spritesheet/dist/esm/spritesheet.mjs:
  (*!
   * @pixi/spritesheet - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/spritesheet is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/sprite-tiling/dist/esm/sprite-tiling.mjs:
  (*!
   * @pixi/sprite-tiling - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/sprite-tiling is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/mesh/dist/esm/mesh.mjs:
  (*!
   * @pixi/mesh - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/mesh is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/text-bitmap/dist/esm/text-bitmap.mjs:
  (*!
   * @pixi/text-bitmap - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/text-bitmap is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-alpha/dist/esm/filter-alpha.mjs:
  (*!
   * @pixi/filter-alpha - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/filter-alpha is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-blur/dist/esm/filter-blur.mjs:
  (*!
   * @pixi/filter-blur - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/filter-blur is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-color-matrix/dist/esm/filter-color-matrix.mjs:
  (*!
   * @pixi/filter-color-matrix - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/filter-color-matrix is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-displacement/dist/esm/filter-displacement.mjs:
  (*!
   * @pixi/filter-displacement - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/filter-displacement is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-fxaa/dist/esm/filter-fxaa.mjs:
  (*!
   * @pixi/filter-fxaa - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/filter-fxaa is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/filter-noise/dist/esm/filter-noise.mjs:
  (*!
   * @pixi/filter-noise - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/filter-noise is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/mixin-cache-as-bitmap/dist/esm/mixin-cache-as-bitmap.mjs:
  (*!
   * @pixi/mixin-cache-as-bitmap - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/mixin-cache-as-bitmap is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/mixin-get-child-by-name/dist/esm/mixin-get-child-by-name.mjs:
  (*!
   * @pixi/mixin-get-child-by-name - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/mixin-get-child-by-name is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/mixin-get-global-position/dist/esm/mixin-get-global-position.mjs:
  (*!
   * @pixi/mixin-get-global-position - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/mixin-get-global-position is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/app/dist/esm/app.mjs:
  (*!
   * @pixi/app - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/app is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)

@pixi/mesh-extras/dist/esm/mesh-extras.mjs:
  (*!
   * @pixi/mesh-extras - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/mesh-extras is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@pixi/sprite-animated/dist/esm/sprite-animated.mjs:
  (*!
   * @pixi/sprite-animated - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * @pixi/sprite-animated is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

pixi.js/dist/esm/pixi.mjs:
  (*!
   * pixi.js - v6.5.8
   * Compiled Sun, 23 Oct 2022 23:01:45 UTC
   *
   * pixi.js is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   *)
*/
